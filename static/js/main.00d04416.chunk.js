(this.webpackJsonptiny_matrix_client=this.webpackJsonptiny_matrix_client||[]).push([[0],{150:function(e,t,s){},151:function(e,t,s){"use strict";s.r(t);var n=s(0),a=s(18),r=s(79),o=s.n(r),c=(s(86),s(56)),i=s(31),l=s(23),u=s(24),d=s(26),m=s(25),j=s(80),h=s.n(j),p=(s(150),function(e){Object(d.a)(s,e);var t=Object(m.a)(s);function s(e){var n;return Object(l.a)(this,s),(n=t.call(this,e)).setupClient=function(e){n.setState({client:e}),e.startClient(),e.once("sync",(function(e,t,s){console.log(e),n.setState({isClientReady:!0})}))},n.state={client:null,isClientReady:!1},n}return Object(u.a)(s,[{key:"render",value:function(){return Object(n.jsxs)("div",{className:"container",children:[Object(n.jsx)(x,{}),this.state.isClientReady?Object(n.jsx)(g,{client:this.state.client}):Object(n.jsx)(b,{setupClient:this.setupClient})]})}}]),s}(a.Component)),b=function(e){Object(d.a)(s,e);var t=Object(m.a)(s);function s(e){var n;return Object(l.a)(this,s),(n=t.call(this,e)).handleChange=function(e){return n.setState(Object(i.a)({},e.target.id,e.target.value))},n.handleSubmit=function(e){n.setState({isLoading:!0},(function(){var e=h.a.createClient(n.state.server);e.login("m.login.password",{user:n.state.username,password:n.state.password}).then((function(t){return n.props.setupClient(e)})).catch((function(e){alert(e.message),n.setState({isLoading:!1})}))})),e.preventDefault()},n.state={server:"https://matrix.org",username:"",password:"",isLoading:!1},n}return Object(u.a)(s,[{key:"render",value:function(){return Object(n.jsx)("div",{className:"col-sm-5 mx-auto",children:Object(n.jsxs)("form",{onSubmit:this.handleSubmit,children:[Object(n.jsx)("div",{className:"form-group",children:Object(n.jsxs)("div",{className:"input-group flex-nowrap",children:[Object(n.jsx)("div",{className:"input-group-prepend",children:Object(n.jsx)("span",{className:"input-group-text",children:Object(n.jsx)("i",{className:"fas fa-at fa-fw"})})}),Object(n.jsx)("input",{className:"form-control",id:"server",type:"url",autoComplete:"url",placeholder:"Server URL",value:this.state.server,onChange:this.handleChange,required:!0})]})}),Object(n.jsx)("div",{className:"form-group",children:Object(n.jsxs)("div",{className:"input-group flex-nowrap",children:[Object(n.jsx)("div",{className:"input-group-prepend",children:Object(n.jsx)("span",{className:"input-group-text",children:Object(n.jsx)("i",{className:"fas fa-user fa-fw"})})}),Object(n.jsx)("input",{className:"form-control",id:"username",type:"text",autoComplete:"username",placeholder:"Username",value:this.state.username,onChange:this.handleChange,required:!0})]})}),Object(n.jsx)("div",{className:"form-group",children:Object(n.jsxs)("div",{className:"input-group flex-nowrap",children:[Object(n.jsx)("div",{className:"input-group-prepend",children:Object(n.jsx)("span",{className:"input-group-text",children:Object(n.jsx)("i",{className:"fas fa-key fa-fw"})})}),Object(n.jsx)("input",{className:"form-control",id:"password",type:"password",autoComplete:"current-password",placeholder:"Password",value:this.state.password,onChange:this.handleChange,required:!0})]})}),this.state.isLoading?Object(n.jsxs)("button",{className:"btn btn-outline-secondary btn-block disabled",type:"button",children:["Loading...",Object(n.jsx)("div",{className:"spinner-border spinner-border-sm float-right",role:"status","aria-hidden":"true"})]}):Object(n.jsx)("input",{className:"btn btn-outline-primary btn-block",type:"submit",value:"Log in"})]})})}}]),s}(a.Component),g=function(e){Object(d.a)(s,e);var t=Object(m.a)(s);function s(e){var n;return Object(l.a)(this,s),(n=t.call(this,e)).setCurrentRoomId=function(e){n.setState({currentRoomId:e})},n.sendMessage=function(e){var t=n.state.currentRoomId;if(null!==t){var s={body:e,msgtype:"m.text"};n.props.client.sendEvent(t,"m.room.message",s,"").then((function(e){console.log("message sent successfully")})).catch((function(e){console.log(e)}))}},n.state={messages:{},currentRoomId:null},n}return Object(u.a)(s,[{key:"componentDidMount",value:function(){var e=this;this.props.client.on("Room.timeline",(function(t,s,n){if("m.room.message"===t.getType()){var a=e.state.messages,r=s.roomId in a?a[s.roomId]:[];r.push({eventId:t.getId(),date:t.getDate().toLocaleString(),body:t.getContent().body,senderName:t.sender.name}),e.setState((function(e){return{messages:Object(c.a)(Object(c.a)({},e.messages),{},Object(i.a)({},s.roomId,r))}}))}}))}},{key:"render",value:function(){var e=this.state,t=e.currentRoomId,s=e.messages,a=t in s?s[t]:[];return Object(n.jsxs)("div",{className:"chat",children:[Object(n.jsx)(f,{client:this.props.client,setCurrentRoomId:this.setCurrentRoomId}),Object(n.jsx)(v,{messages:a}),Object(n.jsx)(O,{sendMessage:this.sendMessage})]})}}]),s}(a.Component),f=function(e){Object(d.a)(s,e);var t=Object(m.a)(s);function s(e){var n;return Object(l.a)(this,s),(n=t.call(this,e)).handleChange=function(e){var t=e.target.value;n.selectRoomId(t)},n.state={rooms:[],selectedRoomId:void 0},n}return Object(u.a)(s,[{key:"componentDidMount",value:function(){var e=this.props.client.getRooms();this.setState({rooms:e}),this.selectRoomId(e[0].roomId)}},{key:"selectRoomId",value:function(e){this.setState({selectedRoomId:e}),this.props.setCurrentRoomId(e)}},{key:"listRooms",value:function(){return this.state.rooms.map((function(e){return Object(n.jsx)("option",{value:e.roomId,children:e.name},e.roomId)}))}},{key:"render",value:function(){var e=this.listRooms();return Object(n.jsxs)("div",{className:"input-group flex-nowrap mb-3",children:[Object(n.jsx)("div",{className:"input-group-prepend",children:Object(n.jsx)("span",{className:"input-group-text",children:"Current room"})}),Object(n.jsx)("select",{className:"custom-select",value:this.state.selectedRoomId,onChange:this.handleChange,children:e})]})}}]),s}(a.Component),v=function(e){Object(d.a)(s,e);var t=Object(m.a)(s);function s(){return Object(l.a)(this,s),t.apply(this,arguments)}return Object(u.a)(s,[{key:"listMessages",value:function(){return this.props.messages.map((function(e){return Object(n.jsxs)("li",{className:"message",children:[Object(n.jsxs)("div",{children:[e.senderName," - ",e.date]}),Object(n.jsx)("div",{children:e.body})]},e.eventId)}))}},{key:"render",value:function(){var e=this.listMessages();return Object(n.jsx)("ul",{className:"message-list",children:e})}}]),s}(a.Component),O=function(e){Object(d.a)(s,e);var t=Object(m.a)(s);function s(e){var n;return Object(l.a)(this,s),(n=t.call(this,e)).handleChange=function(e){n.setState({message:e.target.value})},n.handleSubmit=function(e){n.props.sendMessage(n.state.message),n.setState({message:""}),e.preventDefault()},n.state={message:""},n}return Object(u.a)(s,[{key:"render",value:function(){return Object(n.jsx)("form",{onSubmit:this.handleSubmit,children:Object(n.jsxs)("div",{className:"input-group flex-nowrap",children:[Object(n.jsx)("input",{className:"form-control",type:"text",placeholder:"Type your message",value:this.state.message,onChange:this.handleChange}),Object(n.jsx)("div",{className:"input-group-append",children:Object(n.jsx)("button",{className:"btn btn-outline-secondary",type:"submit",children:Object(n.jsx)("i",{className:"fas fa-comment-dots"})})})]})})}}]),s}(a.Component);function x(){return Object(n.jsx)("header",{className:"text-center mb-3",children:Object(n.jsxs)("h1",{children:["Tiny ",Object(n.jsx)("a",{href:"https://matrix.org/",children:Object(n.jsx)("img",{src:"https://matrix.org/images/matrix-logo.svg",alt:""})})," client"]})})}var y=p;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(Object(n.jsx)(y,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},86:function(e,t,s){}},[[151,1,2]]]);
//# sourceMappingURL=main.00d04416.chunk.js.map