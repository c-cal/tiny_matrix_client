/*! For license information please see 2.b4d193f4.chunk.js.LICENSE.txt */
(this.webpackJsonptiny_matrix_client=this.webpackJsonptiny_matrix_client||[]).push([[2],[function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,n){"use strict";e.exports=n(179)},function(e,t,n){"use strict";var r=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.logger=void 0;var i=r(n(100)),o="matrix";i.default.methodFactory=function(e,t,n){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.prefix&&n.unshift(this.prefix);var i,o,a="error"===e||"warn"===e||"trace"===e||"info"===e;return a?(i=console)[e].apply(i,n):(o=console).log.apply(o,n)}};var a=i.default.getLogger(o);function s(e){e.withPrefix=function(e){return function(e){var t=i.default.getLogger("".concat(o,"-").concat(e));t.prefix!==e&&(s(t),t.prefix=e,t.setLevel(i.default.levels.DEBUG,!1));return t}((this.prefix||"")+e)}}t.logger=a,a.setLevel(i.default.levels.DEBUG,!1),s(a)},function(e,t,n){e.exports=n(99)},function(e,t){function n(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,i)}e.exports=function(e){return function(){var t=this,r=arguments;return new Promise((function(i,o){var a=e.apply(t,r);function s(e){n(a,i,o,s,u,"next",e)}function u(e){n(a,i,o,s,u,"throw",e)}s(void 0)}))}}},function(e,t,n){var r=n(46);e.exports=function(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,u=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw a}}}}},function(e,t,n){var r=n(47);e.exports=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},function(e,t,n){var r=n(30),i=n(65),o=n(107);e.exports=function(e){var t=i();return function(){var n,i=r(e);if(t){var a=r(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return o(this,n)}}},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t,n){"use strict";var r=n(21),i=n(6),o=n(7),a=n(64),s=n(13),u=n(8),c=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.encodeParams=function(e){return new URLSearchParams(e).toString()},t.decodeParams=function(e){var t,n={},r=new URLSearchParams(e),i=u(r.keys());try{for(i.s();!(t=i.n()).done;){var o=t.value,a=r.getAll(o);n[o]=1===a.length?a[0]:a}}catch(s){i.e(s)}finally{i.f()}return n},t.encodeUri=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e=e.replace(n,encodeURIComponent(t[n])));return e},t.removeElement=function(e,t,n){var r,i;if(n){for(r=e.length-1;r>=0;r--)if(t(e[r],r,e))return i=e[r],e.splice(r,1),i}else for(r=0;r<e.length;r++)if(t(e[r],r,e))return i=e[r],e.splice(r,1),i;return!1},t.isFunction=function(e){return"[object Function]"===Object.prototype.toString.call(e)},t.checkObjectHasKeys=function(e,t){for(var n=0;n<t.length;n++)if(!e.hasOwnProperty(t[n]))throw new Error("Missing required key: "+t[n])},t.checkObjectHasNoAdditionalKeys=function(e,t){for(var n in e)if(e.hasOwnProperty(n)&&-1===t.indexOf(n))throw new Error("Unknown key: "+n)},t.deepCopy=function(e){return JSON.parse(JSON.stringify(e))},t.deepCompare=function e(t,n){if(t===n)return!0;if(typeof t!==typeof n)return!1;if("number"===typeof t&&isNaN(t)&&isNaN(n))return!0;if(null===t||null===n)return t===n;if(!(t instanceof Object))return!1;if(t.constructor!==n.constructor||t.prototype!==n.prototype)return!1;if(t instanceof RegExp||t instanceof Date)return t.toString()===n.toString();if(t instanceof Array){if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(!e(t[r],n[r]))return!1}else{var i;for(i in n)if(n.hasOwnProperty(i)!==t.hasOwnProperty(i))return!1;for(i in n){if(n.hasOwnProperty(i)!==t.hasOwnProperty(i))return!1;if(!e(t[i],n[i]))return!1}}return!0},t.deepSortedObjectEntries=function e(t){if("object"!==typeof t)return t;if(null===t||void 0===t||Array.isArray(t))return t;for(var n=[],r=0,i=Object.entries(t);r<i.length;r++){var o=s(i[r],2),a=o[0],u=o[1];n.push([a,e(u)])}return n.sort((function(e,t){return w(e[0],t[0])})),n},t.extend=function(){for(var e=(arguments.length<=0?void 0:arguments[0])||{},t=1;t<arguments.length;t++){var n=t<0||arguments.length<=t?void 0:arguments[t];if(n)for(var r in n)e[r]=n[r]}return e},t.inherits=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},t.polyfillSuper=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];try{t.call.apply(t,[e].concat(r))}catch(s){var o=a(t,r);Object.assign(e,o)}},t.isNumber=function(e){return"number"===typeof e&&isFinite(e)},t.removeHiddenChars=f,t.normalize=function(e){return f(e.toLowerCase()).replace(/[\\'!"#$%&()*+,\-./:;<=>?@[\]^_`{|}~\u2000-\u206f\u2e00-\u2e7f]/g,"").toLowerCase()},t.escapeRegExp=v,t.globToRegexp=function(e,t){t="boolean"!==typeof t||t;var n=v(e);n=(n=n.replace(/\\\*/g,".*")).replace(/\?/g,"."),t&&(n=n.replace(/\\\[(!|)(.*)\\]/g,(function(e,t,n,r,i){return"["+(t?"^":"")+n.replace(/\\-/,"-")+"]"})));return n},t.ensureNoTrailingSlash=function(e){return e&&e.endsWith("/")?e.substr(0,e.length-1):e},t.sleep=function(e,t){return new Promise((function(n){setTimeout(n,e,t)}))},t.isNullOrUndefined=function(e){return null===e||void 0===e},t.defer=function(){var e,t,n=new Promise((function(n,r){e=n,t=r}));return{resolve:e,reject:t,promise:n}},t.promiseMapSeries=function(e,t){return g.apply(this,arguments)},t.promiseTry=function(e){return new Promise((function(t){return t(e())}))},t.chunkPromises=function(e,t){return y.apply(this,arguments)},t.simpleRetryOperation=function(e){return(0,d.default)((function(t){return e(t)}),{forever:!0,factor:2,minTimeout:3e3,maxTimeout:15e3})},t.setCrypto=function(e){h=e},t.getCrypto=function(){return h},t.alphabetPad=k,t.baseToString=b,t.stringToBase=S,t.averageBetweenStrings=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m,r=Math.max(e.length,t.length),i=S(k(e,r,n),n),o=S(k(t,r,n),n),a=(i+o)/BigInt(2);if(a===i||a==o)return b(a,n)+n[0];return b(a,n)},t.nextString=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m;return b(S(e,t)+BigInt(1),t)},t.prevString=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m;return b(S(e,t)-BigInt(1),t)},t.lexicographicCompare=w,t.compare=function(e,t){return E.compare(e,t)},t.recursivelyAssign=function e(t,n){for(var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=0,o=Object.entries(n);i<o.length;i++){var a=s(o[i],2),u=a[0],c=a[1];t[u]instanceof Object&&c?e(t[u],c):(null!==c&&void 0!==c||!r)&&(t[u]=c)}return t},t.DEFAULT_ALPHABET=void 0;var l=c(n(104)),d=c(n(66));function f(e){return"string"===typeof e?(0,l.default)(e.normalize("NFD").replace(p,"")):""}var h,p=/[\u2000-\u200F\u202A-\u202F\u0300-\u036F\uFEFF\u061C\s]/g;function v(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function g(){return(g=o(i.mark((function e(t,n){var r,o,a;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=u(t),e.prev=1,r.s();case 3:if((o=r.n()).done){e.next=13;break}return a=o.value,e.t0=n,e.next=8,a;case 8:return e.t1=e.sent,e.next=11,(0,e.t0)(e.t1);case 11:e.next=3;break;case 13:e.next=18;break;case 15:e.prev=15,e.t2=e.catch(1),r.e(e.t2);case 18:return e.prev=18,r.f(),e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[1,15,18,21]])})))).apply(this,arguments)}function y(){return(y=o(i.mark((function e(t,n){var o,a;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=[],a=0;case 2:if(!(a<t.length)){e.next=14;break}return e.t0=o.push,e.t1=o,e.t2=r,e.next=8,Promise.all(t.slice(a,a+n).map((function(e){return e()})));case 8:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t0.apply.call(e.t0,e.t1,e.t4);case 11:a+=n,e.next=2;break;case 14:return e.abrupt("return",o);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var m=function(){for(var e="",t=32;t<=126;t++)e+=String.fromCharCode(t);return e}();function k(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m;return e.padEnd(t,n[0])}function b(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m,r=BigInt(n.length);if(e<=r)return null!==(t=n[Number(e)-1])&&void 0!==t?t:"";var i=e/r,o=Number(e%r)-1;return o<0&&(i-=BigInt(Math.abs(o)),o=Number(r)-1),b(i,n)+n[o]}function S(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m,n=BigInt(t.length),r=BigInt(0),i=e.length-1,o=BigInt(0);i>=0;i--,o++){var a=e.charCodeAt(i)-t.charCodeAt(0);r+=BigInt(1+a)*Math.pow(n,o)}return r}function w(e,t){return e<t?-1:e===t?0:1}t.DEFAULT_ALPHABET=m;var E=new Intl.Collator},function(e,t,n){var r=n(96),i=n(97),o=n(46),a=n(98);e.exports=function(e,t){return r(e)||i(e,t)||o(e,t)||a()}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(r){"object"===typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";var r,i="object"===typeof Reflect?Reflect:null,o=i&&"function"===typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&"function"===typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!==e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"===typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}y(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"===typeof e.on&&y(e,"error",t,n)}(e,i,{once:!0})}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var u=10;function c(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function d(e,t,n,r){var i,o,a,s;if(c(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if("function"===typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(i=l(e))>0&&a.length>i&&!a.warned){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,s=u,console&&console.warn&&console.warn(s)}return e}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=f.bind(r);return i.listener=n,r.wrapFn=i,i}function p(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"===typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):g(i,i.length)}function v(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"===typeof n)return 1;if(void 0!==n)return n.length}return 0}function g(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function y(e,t,n,r){if("function"===typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!==typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){r.once&&e.removeEventListener(t,i),n(o)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!==typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var u=i[e];if(void 0===u)return!1;if("function"===typeof u)o(u,this,t);else{var c=u.length,l=g(u,c);for(n=0;n<c;++n)o(l[n],this,t)}return!0},s.prototype.addListener=function(e,t){return d(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return d(this,e,t,!0)},s.prototype.once=function(e,t){return c(t),this.on(e,h(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return c(t),this.prependListener(e,h(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,r,i,o,a;if(c(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!==typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},s.prototype.listeners=function(e){return p(this,e,!0)},s.prototype.rawListeners=function(e){return p(this,e,!1)},s.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):v.call(e,t)},s.prototype.listenerCount=v,s.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UNSTABLE_ELEMENT_FUNCTIONAL_USERS=t.UNSTABLE_MSC3089_BRANCH=t.UNSTABLE_MSC3089_LEAF=t.UNSTABLE_MSC3089_TREE_SUBTYPE=t.UNSTABLE_MSC3088_ENABLED=t.UNSTABLE_MSC3088_PURPOSE=t.RoomType=t.RoomCreateTypeField=t.MsgType=t.RelationType=t.EventType=void 0;var r,i,o,a=n(68);t.EventType=r,function(e){e.RoomCanonicalAlias="m.room.canonical_alias",e.RoomCreate="m.room.create",e.RoomJoinRules="m.room.join_rules",e.RoomMember="m.room.member",e.RoomThirdPartyInvite="m.room.third_party_invite",e.RoomPowerLevels="m.room.power_levels",e.RoomName="m.room.name",e.RoomTopic="m.room.topic",e.RoomAvatar="m.room.avatar",e.RoomPinnedEvents="m.room.pinned_events",e.RoomEncryption="m.room.encryption",e.RoomHistoryVisibility="m.room.history_visibility",e.RoomGuestAccess="m.room.guest_access",e.RoomServerAcl="m.room.server_acl",e.RoomTombstone="m.room.tombstone",e.RoomAliases="m.room.aliases",e.SpaceChild="m.space.child",e.SpaceParent="m.space.parent",e.RoomRedaction="m.room.redaction",e.RoomMessage="m.room.message",e.RoomMessageEncrypted="m.room.encrypted",e.Sticker="m.sticker",e.CallInvite="m.call.invite",e.CallCandidates="m.call.candidates",e.CallAnswer="m.call.answer",e.CallHangup="m.call.hangup",e.CallReject="m.call.reject",e.CallSelectAnswer="m.call.select_answer",e.CallNegotiate="m.call.negotiate",e.CallSDPStreamMetadataChanged="m.call.sdp_stream_metadata_changed",e.CallSDPStreamMetadataChangedPrefix="org.matrix.call.sdp_stream_metadata_changed",e.CallReplaces="m.call.replaces",e.CallAssertedIdentity="m.call.asserted_identity",e.CallAssertedIdentityPrefix="org.matrix.call.asserted_identity",e.KeyVerificationRequest="m.key.verification.request",e.KeyVerificationStart="m.key.verification.start",e.KeyVerificationCancel="m.key.verification.cancel",e.KeyVerificationMac="m.key.verification.mac",e.KeyVerificationDone="m.key.verification.done",e.RoomMessageFeedback="m.room.message.feedback",e.Reaction="m.reaction",e.Typing="m.typing",e.Receipt="m.receipt",e.Presence="m.presence",e.FullyRead="m.fully_read",e.Tag="m.tag",e.SpaceOrder="org.matrix.msc3230.space_order",e.PushRules="m.push_rules",e.Direct="m.direct",e.IgnoredUserList="m.ignored_user_list",e.RoomKey="m.room_key",e.RoomKeyRequest="m.room_key_request",e.ForwardedRoomKey="m.forwarded_room_key",e.Dummy="m.dummy"}(r||(t.EventType=r={})),t.RelationType=i,function(e){e.Annotation="m.annotation",e.Replace="m.replace",e.Thread="io.element.thread"}(i||(t.RelationType=i={})),t.MsgType=o,function(e){e.Text="m.text",e.Emote="m.emote",e.Notice="m.notice",e.Image="m.image",e.File="m.file",e.Audio="m.audio",e.Location="m.location",e.Video="m.video"}(o||(t.MsgType=o={}));var s;t.RoomCreateTypeField="type",t.RoomType=s,function(e){e.Space="m.space"}(s||(t.RoomType=s={}));var u=new a.UnstableValue("m.room.purpose","org.matrix.msc3088.purpose");t.UNSTABLE_MSC3088_PURPOSE=u;var c=new a.UnstableValue("m.enabled","org.matrix.msc3088.enabled");t.UNSTABLE_MSC3088_ENABLED=c;var l=new a.UnstableValue("m.data_tree","org.matrix.msc3089.data_tree");t.UNSTABLE_MSC3089_TREE_SUBTYPE=l;var d=new a.UnstableValue("m.leaf","org.matrix.msc3089.leaf");t.UNSTABLE_MSC3089_LEAF=d;var f=new a.UnstableValue("m.branch","org.matrix.msc3089.branch");t.UNSTABLE_MSC3089_BRANCH=f;var h=new a.UnstableValue("io.element.functional_members","io.element.functional_members");t.UNSTABLE_ELEMENT_FUNCTIONAL_USERS=h},function(e,t,n){"use strict";var r=n(6),i=n(7),o=n(13),a=n(0),s=n(2),u=n(11),c=n(9),l=n(10),d=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixEvent=t.EventStatus=void 0;var f,h=d(n(3)),p=n(15),v=n(5),g=n(17),y=n(12),m=n(72),k=n(38);t.EventStatus=f,function(e){e.NOT_SENT="not_sent",e.ENCRYPTING="encrypting",e.SENDING="sending",e.QUEUED="queued",e.SENT="sent",e.CANCELLED="cancelled"}(f||(t.EventStatus=f={}));var b={};function S(e){return b[e]||(b[e]=e),b[e]}var w=function(e){c(n,e);var t=l(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,n),(e=t.call(this)).event=r,(0,h.default)(u(e),"pushActions",null),(0,h.default)(u(e),"_replacingEvent",null),(0,h.default)(u(e),"_localRedactionEvent",null),(0,h.default)(u(e),"_isCancelled",!1),(0,h.default)(u(e),"clearEvent",void 0),(0,h.default)(u(e),"senderCurve25519Key",null),(0,h.default)(u(e),"claimedEd25519Key",null),(0,h.default)(u(e),"forwardingCurve25519KeyChain",[]),(0,h.default)(u(e),"untrusted",null),(0,h.default)(u(e),"_decryptionPromise",null),(0,h.default)(u(e),"retryDecryption",!1),(0,h.default)(u(e),"txnId",null),(0,h.default)(u(e),"thread",null),(0,h.default)(u(e),"localTimestamp",void 0),(0,h.default)(u(e),"sender",null),(0,h.default)(u(e),"target",null),(0,h.default)(u(e),"status",null),(0,h.default)(u(e),"error",null),(0,h.default)(u(e),"forwardLooking",!0),(0,h.default)(u(e),"verificationRequest",null),(0,h.default)(u(e),"reEmitter",void 0),["state_key","type","sender","room_id","membership"].forEach((function(e){"string"===typeof r[e]&&(r[e]=S(r[e]))})),["membership","avatar_url","displayname"].forEach((function(e){var t;"string"===typeof(null===(t=r.content)||void 0===t?void 0:t[e])&&(r.content[e]=S(r.content[e]))})),["rel_type"].forEach((function(e){var t,n;"string"===typeof(null===(t=r.content)||void 0===t||null===(n=t["m.relates_to"])||void 0===n?void 0:n[e])&&(r.content["m.relates_to"][e]=S(r.content["m.relates_to"][e]))})),e.txnId=r.txn_id||null,e.localTimestamp=Date.now()-e.getAge(),e.reEmitter=new k.ReEmitter(u(e)),e}return s(n,[{key:"getEffectiveEvent",value:function(){var e=Object.assign({},this.getContent());if(this.getWireType()===g.EventType.RoomMessageEncrypted)for(var t=0,n=Object.entries(this.getWireContent());t<n.length;t++){var r=o(n[t],2),i=r[0],a=r[1];["algorithm","ciphertext","device_id","sender_key","session_id"].includes(i)||void 0===e[i]&&(e[i]=a)}return Object.assign({},this.event,this.clearEvent,{content:e})}},{key:"getId",value:function(){return this.event.event_id}},{key:"getSender",value:function(){return this.event.sender||this.event.user_id}},{key:"getType",value:function(){return this.clearEvent?this.clearEvent.type:this.event.type}},{key:"getWireType",value:function(){return this.event.type}},{key:"getRoomId",value:function(){return this.event.room_id}},{key:"getTs",value:function(){return this.event.origin_server_ts}},{key:"getDate",value:function(){return this.event.origin_server_ts?new Date(this.event.origin_server_ts):null}},{key:"getOriginalContent",value:function(){return this._localRedactionEvent?{}:this.clearEvent?this.clearEvent.content||{}:this.event.content||{}}},{key:"getContent",value:function(){return this._localRedactionEvent?{}:this._replacingEvent?this._replacingEvent.getContent()["m.new_content"]||{}:this.getOriginalContent()}},{key:"getWireContent",value:function(){return this.event.content||{}}},{key:"threadRootId",get:function(){var e,t=null===(e=this.getWireContent())||void 0===e?void 0:e["m.relates_to"];if((null===t||void 0===t?void 0:t.rel_type)===g.RelationType.Thread)return t.event_id}},{key:"isThreadRelation",get:function(){return!!this.threadRootId}},{key:"isThreadRoot",get:function(){var e=this.getThread();return(null===e||void 0===e?void 0:e.id)===this.getId()}},{key:"parentEventId",get:function(){var e,t=this.getWireContent()["m.relates_to"];return(null===t||void 0===t||null===(e=t["m.in_reply_to"])||void 0===e?void 0:e.event_id)||(null===t||void 0===t?void 0:t.event_id)}},{key:"replyEventId",get:function(){var e,t=this.getWireContent()["m.relates_to"];return null===t||void 0===t||null===(e=t["m.in_reply_to"])||void 0===e?void 0:e.event_id}},{key:"getPrevContent",value:function(){return this.getUnsigned().prev_content||this.event.prev_content||{}}},{key:"getDirectionalContent",value:function(){return this.forwardLooking?this.getContent():this.getPrevContent()}},{key:"getAge",value:function(){return this.getUnsigned().age||this.event.age}},{key:"getLocalAge",value:function(){return Date.now()-this.localTimestamp}},{key:"getStateKey",value:function(){return this.event.state_key}},{key:"isState",value:function(){return void 0!==this.event.state_key}},{key:"makeEncrypted",value:function(e,t,n,r){this.clearEvent={type:this.event.type,content:this.event.content},this.event.type=e,this.event.content=t,this.senderCurve25519Key=n,this.claimedEd25519Key=r}},{key:"isBeingDecrypted",value:function(){return null!=this._decryptionPromise}},{key:"getDecryptionPromise",value:function(){return this._decryptionPromise}},{key:"isDecryptionFailure",value:function(){var e,t;return"m.bad.encrypted"===(null===(e=this.clearEvent)||void 0===e||null===(t=e.content)||void 0===t?void 0:t.msgtype)}},{key:"shouldAttemptDecryption",value:function(){return this.isEncrypted()&&!this.isBeingDecrypted()&&!this.clearEvent}},{key:"attemptDecryption",value:function(){var e=i(r.mark((function e(t){var n,i=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("boolean"===typeof(n=i.length>1&&void 0!==i[1]?i[1]:{})&&(n={isRetry:n}),this.isEncrypted()){e.next=4;break}throw new Error("Attempt to decrypt event which isn't encrypted");case 4:if(!this.clearEvent||this.isDecryptionFailure()){e.next=6;break}throw new Error("Attempt to decrypt event which has already been decrypted");case 6:if(!this._decryptionPromise){e.next=10;break}return v.logger.log("Event ".concat(this.getId()," already being decrypted; queueing a retry")),this.retryDecryption=!0,e.abrupt("return",this._decryptionPromise);case 10:return this._decryptionPromise=this.decryptionLoop(t,n),e.abrupt("return",this._decryptionPromise);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"cancelAndResendKeyRequest",value:function(e,t){var n=this.getWireContent();return e.requestRoomKey({algorithm:n.algorithm,room_id:this.getRoomId(),session_id:n.session_id,sender_key:n.sender_key},this.getKeyRequestRecipients(t),!0)}},{key:"getKeyRequestRecipients",value:function(e){var t=this.getWireContent(),n=[{userId:e,deviceId:"*"}],r=this.getSender();return r!==e&&n.push({userId:r,deviceId:t.device_id}),n}},{key:"decryptionLoop",value:function(){var e=i(r.mark((function e(t){var n,i,o,a,s=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:{},e.next=3,Promise.resolve();case 3:if(this.retryDecryption=!1,i=void 0,o=void 0,e.prev=7,t){e.next=12;break}i=this.badEncryptedMessage("Encryption not enabled"),e.next=16;break;case 12:return e.next=14,t.decryptEvent(this);case 14:i=e.sent,!0===n.isRetry&&v.logger.info("Decrypted event on retry (id=".concat(this.getId(),")"));case 16:e.next=32;break;case 18:if(e.prev=18,e.t0=e.catch(7),"DecryptionError"===e.t0.name){e.next=26;break}return a=n.isRetry?"re":"",v.logger.error("Error ".concat(a,"decrypting event ")+"(id=".concat(this.getId(),"): ").concat(e.t0.stack||e.t0)),this._decryptionPromise=null,this.retryDecryption=!1,e.abrupt("return");case 26:if(o=e.t0,!this.retryDecryption){e.next=30;break}return v.logger.log("Got error decrypting event (id=".concat(this.getId(),": ")+"".concat(e.t0,"), but retrying")),e.abrupt("continue",3);case 30:v.logger.warn("Error decrypting event (id=".concat(this.getId(),"): ").concat(e.t0.detailedString)),i=this.badEncryptedMessage(e.t0.message);case 32:return this._decryptionPromise=null,this.retryDecryption=!1,this.setClearData(i),this.setPushActions(null),!1!==n.emit&&this.emit("Event.decrypted",this,o),e.abrupt("return");case 40:case"end":return e.stop()}}),e,this,[[7,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"badEncryptedMessage",value:function(e){return{clearEvent:{type:"m.room.message",content:{msgtype:"m.bad.encrypted",body:"** Unable to decrypt: "+e+" **"}}}}},{key:"setClearData",value:function(e){this.clearEvent=e.clearEvent,this.senderCurve25519Key=e.senderCurve25519Key||null,this.claimedEd25519Key=e.claimedEd25519Key||null,this.forwardingCurve25519KeyChain=e.forwardingCurve25519KeyChain||[],this.untrusted=e.untrusted||!1}},{key:"getClearContent",value:function(){return this.clearEvent?this.clearEvent.content:null}},{key:"isEncrypted",value:function(){return!this.isState()&&"m.room.encrypted"===this.event.type}},{key:"getSenderKey",value:function(){return this.senderCurve25519Key}},{key:"getKeysClaimed",value:function(){return{ed25519:this.claimedEd25519Key}}},{key:"getClaimedEd25519Key",value:function(){return this.claimedEd25519Key}},{key:"getForwardingCurve25519KeyChain",value:function(){return this.forwardingCurve25519KeyChain}},{key:"isKeySourceUntrusted",value:function(){return this.untrusted}},{key:"getUnsigned",value:function(){return this.event.unsigned||{}}},{key:"unmarkLocallyRedacted",value:function(){var e=this._localRedactionEvent;return this._localRedactionEvent=null,this.event.unsigned&&(this.event.unsigned.redacted_because=null),!!e}},{key:"markLocallyRedacted",value:function(e){this._localRedactionEvent||(this.emit("Event.beforeRedaction",this,e),this._localRedactionEvent=e,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event)}},{key:"makeRedacted",value:function(e){if(!e.event)throw new Error("invalid redactionEvent in makeRedacted");var t;for(t in this._localRedactionEvent=null,this.emit("Event.beforeRedaction",this,e),this._replacingEvent=null,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event,this.event)this.event.hasOwnProperty(t)&&(E.has(t)||delete this.event[t]);var n=_[this.getType()]||{},r=this.getContent();for(t in r)r.hasOwnProperty(t)&&(n[t]||delete r[t])}},{key:"isRedacted",value:function(){return Boolean(this.getUnsigned().redacted_because)}},{key:"isRedaction",value:function(){return"m.room.redaction"===this.getType()}},{key:"getRedactionEvent",value:function(){var e,t;return this.isRedacted()?null!==(e=this.clearEvent)&&void 0!==e&&e.unsigned?null===(t=this.clearEvent)||void 0===t?void 0:t.unsigned.redacted_because:this.event.unsigned.redacted_because?this.event.unsigned.redacted_because:{}:null}},{key:"getPushActions",value:function(){return this.pushActions}},{key:"setPushActions",value:function(e){this.pushActions=e}},{key:"handleRemoteEcho",value:function(e){var t=this.getUnsigned(),n=this.getId();this.event=e,t.redacted_because&&(this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=t.redacted_because),this.setStatus(null),this.getId()!==n&&this.emit("Event.localEventIdReplaced",this)}},{key:"isSending",value:function(){return!!this.status}},{key:"setStatus",value:function(e){this.status=e,this.emit("Event.status",this,e)}},{key:"replaceLocalEventId",value:function(e){this.event.event_id=e,this.emit("Event.localEventIdReplaced",this)}},{key:"isRelation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=this.getWireContent(),n=t&&t["m.relates_to"];return n&&n.rel_type&&n.event_id&&(e&&n.rel_type===e||!e)}},{key:"getRelation",value:function(){return this.isRelation()?this.getWireContent()["m.relates_to"]:null}},{key:"makeReplaced",value:function(e){this.isRedacted()&&e||this._replacingEvent!==e&&(this._replacingEvent=e,this.emit("Event.replaced",this))}},{key:"getAssociatedStatus",value:function(){return this._replacingEvent?this._replacingEvent.status:this._localRedactionEvent?this._localRedactionEvent.status:this.status}},{key:"getServerAggregatedRelation",value:function(e){var t=this.getUnsigned()["m.relations"];if(t)return t[e]}},{key:"replacingEventId",value:function(){var e=this.getServerAggregatedRelation(g.RelationType.Replace);return e?e.event_id:this._replacingEvent?this._replacingEvent.getId():void 0}},{key:"replacingEvent",value:function(){return this._replacingEvent}},{key:"replacingEventDate",value:function(){var e=this.getServerAggregatedRelation(g.RelationType.Replace);if(e){var t=e.origin_server_ts;if(Number.isFinite(t))return new Date(t)}else if(this._replacingEvent)return this._replacingEvent.getDate()}},{key:"localRedactionEvent",value:function(){return this._localRedactionEvent}},{key:"getAssociatedId",value:function(){var e=this.getRelation();return e?e.event_id:this.isRedaction()?this.event.redacts:void 0}},{key:"hasAssocation",value:function(){return!!this.getAssociatedId()}},{key:"updateAssociatedId",value:function(e){var t=this.getRelation();t?t.event_id=e:this.isRedaction()&&(this.event.redacts=e)}},{key:"flagCancelled",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isCancelled=e}},{key:"isCancelled",value:function(){return this._isCancelled}},{key:"toSnapshot",value:function(){for(var e=new n(JSON.parse(JSON.stringify(this.event))),t=0,r=Object.entries(this);t<r.length;t++){var i=o(r[t],2),a=i[0],s=i[1];"event"!==a&&(e[a]=s)}return e}},{key:"isEquivalentTo",value:function(e){if(!e)return!1;if(e===this)return!0;var t=(0,y.deepSortedObjectEntries)(this.event),n=(0,y.deepSortedObjectEntries)(e.event);return JSON.stringify(t)===JSON.stringify(n)}},{key:"toJSON",value:function(){var e=this.getEffectiveEvent();return this.isEncrypted()?{decrypted:e,encrypted:this.event}:e}},{key:"setVerificationRequest",value:function(e){this.verificationRequest=e}},{key:"setTxnId",value:function(e){this.txnId=e}},{key:"getTxnId",value:function(){return this.txnId}},{key:"setThread",value:function(e){this.thread=e,this.reEmitter.reEmit(e,[m.ThreadEvent.Ready,m.ThreadEvent.Update])}},{key:"getThread",value:function(){return this.thread}}]),n}(p.EventEmitter);t.MatrixEvent=w;var E=new Set(["event_id","type","room_id","user_id","sender","state_key","prev_state","content","unsigned","origin_server_ts"]),_={"m.room.member":{membership:1},"m.room.create":{creator:1},"m.room.join_rules":{join_rule:1},"m.room.power_levels":{ban:1,events:1,events_default:1,kick:1,redact:1,state_default:1,users:1,users_default:1},"m.room.aliases":{aliases:1}}},function(e,t,n){"use strict";(function(e,r){var i=n(21),o=n(8),a=n(13),s=n(6),u=n(7),c=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptMessageForDevice=function(e,t,n,r,i,o,a){return m.apply(this,arguments)},t.getExistingOlmSessions=function(e,t,n){return k.apply(this,arguments)},t.ensureOlmSessionsForDevices=function(e,t,n){return b.apply(this,arguments)},t.verifySignature=E,t.pkSign=function(t,n,r,i){var o=!1;if(n instanceof Uint8Array){var a=new e.Olm.PkSigning;i=a.init_with_seed(n),n=a,o=!0}var s=t.signatures||{};delete t.signatures;var u=t.unsigned;t.unsigned&&delete t.unsigned;try{var c=s[r]||{};return s[r]=c,c["ed25519:"+i]=n.sign(d.default.stringify(t))}finally{t.signatures=s,u&&(t.unsigned=u),o&&n.free()}},t.pkVerify=function(t,n,r){var i="ed25519:"+n;if(!(t.signatures&&t.signatures[r]&&t.signatures[r][i]))throw new Error("No signature");var o=t.signatures[r][i],a=new e.Olm.Utility,s=t.signatures;delete t.signatures;var u=t.unsigned;t.unsigned&&delete t.unsigned;try{a.ed25519_verify(n,d.default.stringify(t),o)}finally{t.signatures=s,u&&(t.unsigned=u),a.free()}},t.encodeBase64=x,t.encodeUnpaddedBase64=function(e){return x(e).replace(/=+$/g,"")},t.decodeBase64=function(e){return r.from(e,"base64")},t.MEGOLM_BACKUP_ALGORITHM=t.MEGOLM_ALGORITHM=t.OLM_ALGORITHM=void 0;var l,d=c(n(40)),f=n(5),h=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=p(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}r.default=e,n&&n.set(e,r);return r}(n(12));function p(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(p=function(e){return e?n:t})(e)}!function(e){e.Olm="m.olm.v1.curve25519-aes-sha2",e.Megolm="m.megolm.v1.aes-sha2",e.MegolmBackup="m.megolm_backup.v1.curve25519-aes-sha2"}(l||(l={}));var v=l.Olm;t.OLM_ALGORITHM=v;var g=l.Megolm;t.MEGOLM_ALGORITHM=g;var y=l.MegolmBackup;function m(){return(m=u(s.mark((function e(t,n,r,i,o,a,u){var c,l,d;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=a.getIdentityKey(),e.next=3,i.getSessionIdForDevice(c);case 3:if(null!==(l=e.sent)){e.next=6;break}return e.abrupt("return");case 6:return f.logger.log("Using sessionid "+l+" for device "+o+":"+a.deviceId),d={sender:n,sender_device:r,keys:{ed25519:i.deviceEd25519Key},recipient:o,recipient_keys:{ed25519:a.getFingerprint()}},h.extend(d,u),e.next=11,i.encryptMessage(c,l,JSON.stringify(d));case 11:t[c]=e.sent;case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(){return(k=u(s.mark((function e(t,n,r){var i,c,l,d,f,h;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i={},c={},l=[],d=function(){var e,n=a(h[f],2),r=n[0],d=n[1],p=o(d);try{var v=function(){var n=e.value,o=n.deviceId,a=n.getIdentityKey();l.push(u(s.mark((function e(){var u;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getSessionIdForDevice(a,!0);case 2:null===(u=e.sent)?(i[r]=i[r]||[],i[r].push(n)):(c[r]=c[r]||{},c[r][o]={device:n,sessionId:u});case 4:case"end":return e.stop()}}),e)})))())};for(p.s();!(e=p.n()).done;)v()}catch(g){p.e(g)}finally{p.f()}},f=0,h=Object.entries(r);f<h.length;f++)d();return e.next=7,Promise.all(l);case 7:return e.abrupt("return",[i,c]);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(){return(b=u(s.mark((function e(t,n,r){var u,c,l,d,h,p,v,g,y,m,k,b,w,E,_,x,I,T,R,O,C,P,D,A,M,U,N,L,j,B,K,F,q,V,G,W,H,$=arguments;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u=$.length>3&&void 0!==$[3]&&$[3],c=$.length>4?$[4]:void 0,l=$.length>5?$[5]:void 0,d=$.length>6&&void 0!==$[6]?$[6]:f.logger,"number"===typeof u&&(d=l,l=c,c=u,u=!1),h=[],p={},v={},g=0,y=Object.entries(r);case 9:if(!(g<y.length)){e.next=32;break}m=a(y[g],2),k=m[1],b=o(k),e.prev=12,E=function(){var e=w.value.getIdentityKey();if(e===t.deviceCurve25519Key)return"continue";t.sessionsInProgress[e]||(t.sessionsInProgress[e]=new Promise((function(n){v[e]=function(r){delete t.sessionsInProgress[e],n(r)}})))},b.s();case 15:if((w=b.n()).done){e.next=21;break}if("continue"!==E()){e.next=19;break}return e.abrupt("continue",19);case 19:e.next=15;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(12),b.e(e.t0);case 26:return e.prev=26,b.f(),e.finish(26);case 29:g++,e.next=9;break;case 32:_=0,x=Object.entries(r);case 33:if(!(_<x.length)){e.next=67;break}I=a(x[_],2),T=I[0],R=I[1],p[T]={},O=o(R),e.prev=37,O.s();case 39:if((C=O.n()).done){e.next=56;break}if(P=C.value,D=P.deviceId,(A=P.getIdentityKey())!==t.deviceCurve25519Key){e.next=47;break}return d.info("Attempted to start session with ourself! Ignoring"),p[T][D]={device:P,sessionId:null},e.abrupt("continue",54);case 47:return M="for ".concat(A," (").concat(T,":").concat(D,")"),e.next=50,t.getSessionIdForDevice(A,!!v[A],d);case 50:null!==(U=e.sent)&&v[A]&&v[A](),(null===U||u)&&(u?d.info("Forcing new Olm session ".concat(M)):d.info("Making new Olm session ".concat(M)),h.push([T,D])),p[T][D]={device:P,sessionId:U};case 54:e.next=39;break;case 56:e.next=61;break;case 58:e.prev=58,e.t1=e.catch(37),O.e(e.t1);case 61:return e.prev=61,O.f(),e.finish(61);case 64:_++,e.next=33;break;case 67:if(0!==h.length){e.next=69;break}return e.abrupt("return",p);case 69:return N="signed_curve25519",j="one-time keys for ".concat(h.length," devices"),e.prev=71,d.debug("Claiming ".concat(j)),e.next=75,n.claimOneTimeKeys(h,N,c);case 75:L=e.sent,d.debug("Claimed ".concat(j)),e.next=84;break;case 79:for(e.prev=79,e.t2=e.catch(71),B=0,K=Object.values(v);B<K.length;B++)(0,K[B])();throw d.log("Failed to claim ".concat(j),e.t2,h),e.t2;case 84:l&&"failures"in L&&(F=l).push.apply(F,i(Object.keys(L.failures))),q=L.one_time_keys||{},V=[],G=function(){for(var e=a(H[W],2),n=e[0],r=e[1],i=q[n]||{},o=function(e){var o=r[e],a=o.deviceId,s=o.getIdentityKey();if(s===t.deviceCurve25519Key)return"continue";if(p[n][a].sessionId&&!u)return"continue";var c=i[a]||{},l=null;for(var f in c)0===f.indexOf(N+":")&&(l=c[f]);if(!l)return d.warn("No one-time keys (alg=".concat(N,") ")+"for device ".concat(n,":").concat(a)),v[s]&&v[s](),"continue";V.push(S(t,l,n,o).then((function(e){v[s]&&v[s](e),p[n][a].sessionId=e}),(function(e){throw v[s]&&v[s](),e})))},s=0;s<r.length;s++)o(s)};for(W=0,H=Object.entries(r);W<H.length;W++)G();return j="Olm sessions for ".concat(V.length," devices"),d.debug("Starting ".concat(j)),e.next=93,Promise.all(V);case 93:return d.debug("Started ".concat(j)),e.abrupt("return",p);case 95:case"end":return e.stop()}}),e,null,[[12,23,26,29],[37,58,61,64],[71,79]])})))).apply(this,arguments)}function S(e,t,n,r){return w.apply(this,arguments)}function w(){return(w=u(s.mark((function e(t,n,r,i){var o,a;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=i.deviceId,e.prev=1,e.next=4,E(t,n,r,o,i.getFingerprint());case 4:e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(1),f.logger.error("Unable to verify signature on one-time key for device "+r+":"+o+":",e.t0),e.abrupt("return",null);case 10:return e.prev=10,e.next=13,t.createOutboundSession(i.getIdentityKey(),n.key);case 13:a=e.sent,e.next=20;break;case 16:return e.prev=16,e.t1=e.catch(10),f.logger.error("Error starting olm session with device "+r+":"+o+": "+e.t1),e.abrupt("return",null);case 20:return f.logger.log("Started new olm sessionid "+a+" for device "+r+":"+o),e.abrupt("return",a);case 22:case"end":return e.stop()}}),e,null,[[1,6],[10,16]])})))).apply(this,arguments)}function E(e,t,n,r,i){return _.apply(this,arguments)}function _(){return(_=u(s.mark((function e(t,n,r,i,o){var a,u,c,l,f,h;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a="ed25519:"+i,u=n.signatures||{},c=u[r]||{},l=c[a]){e.next=6;break}throw Error("No signature");case 6:"unsigned"in(f=Object.assign({},n))&&delete f.unsigned,delete f.signatures,h=d.default.stringify(f),t.verifySignature(o,h,l);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return r.from(e).toString("base64")}t.MEGOLM_BACKUP_ALGORITHM=y}).call(this,n(14),n(24).Buffer)},function(e,t,n){"use strict";e.exports=n(91)},function(e,t,n){var r=n(101),i=n(102),o=n(46),a=n(103);e.exports=function(e){return r(e)||i(e)||o(e)||a()}},function(e,t,n){"use strict";(function(e){var r=n(0),i=n(2),o=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedDBCryptoStore=void 0;var a=o(n(3)),s=n(5),u=n(134),c=n(45),l=p(n(135)),d=n(39),f=p(n(79));function h(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(h=function(e){return e?n:t})(e)}function p(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=h(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}var v=function(){function t(e,n){r(this,t),this.indexedDB=e,this.dbName=n,(0,a.default)(this,"backendPromise",null),(0,a.default)(this,"backend",null)}return i(t,[{key:"startup",value:function(){var n=this;return this.backendPromise||(this.backendPromise=new Promise((function(e,t){if(n.indexedDB){s.logger.log("connecting to indexeddb ".concat(n.dbName));var r=n.indexedDB.open(n.dbName,l.VERSION);r.onupgradeneeded=function(e){var t=r.result,n=e.oldVersion;l.upgradeDatabase(t,n)},r.onblocked=function(){s.logger.log("can't yet open IndexedDBCryptoStore because it is open elsewhere")},r.onerror=function(e){s.logger.log("Error connecting to indexeddb",e),t(r.error)},r.onsuccess=function(){var t=r.result;s.logger.log("connected to indexeddb ".concat(n.dbName)),e(new l.Backend(t))}}else t(new Error("no indexeddb support available"))})).then((function(e){return e.doTxn("readonly",[t.STORE_INBOUND_GROUP_SESSIONS,t.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(function(t){e.getEndToEndInboundGroupSession("","",t,(function(){}))})).then((function(){return e}))})).catch((function(t){if("VersionError"===t.name)throw s.logger.warn("Crypto DB is too new for us to use!",t),new d.InvalidCryptoStoreError(d.InvalidCryptoStoreError.TOO_NEW);s.logger.warn("unable to connect to indexeddb ".concat(n.dbName)+": falling back to localStorage store: ".concat(t));try{return new u.LocalStorageCryptoStore(e.localStorage)}catch(t){return s.logger.warn("unable to open localStorage: falling back to in-memory store: ".concat(t)),new c.MemoryCryptoStore}})).then((function(e){return n.backend=e,e}))),this.backendPromise}},{key:"deleteAllData",value:function(){var e=this;return new Promise((function(t,n){if(e.indexedDB){s.logger.log("Removing indexeddb instance: ".concat(e.dbName));var r=e.indexedDB.deleteDatabase(e.dbName);r.onblocked=function(){s.logger.log("can't yet delete IndexedDBCryptoStore because it is open elsewhere")},r.onerror=function(e){s.logger.log("Error deleting data from indexeddb",e),n(r.error)},r.onsuccess=function(){s.logger.log("Removed indexeddb instance: ".concat(e.dbName)),t()}}else n(new Error("no indexeddb support available"))})).catch((function(e){s.logger.warn("unable to delete IndexedDBCryptoStore: ".concat(e))}))}},{key:"getOrAddOutgoingRoomKeyRequest",value:function(e){return this.backend.getOrAddOutgoingRoomKeyRequest(e)}},{key:"getOutgoingRoomKeyRequest",value:function(e){return this.backend.getOutgoingRoomKeyRequest(e)}},{key:"getOutgoingRoomKeyRequestByState",value:function(e){return this.backend.getOutgoingRoomKeyRequestByState(e)}},{key:"getAllOutgoingRoomKeyRequestsByState",value:function(e){return this.backend.getAllOutgoingRoomKeyRequestsByState(e)}},{key:"getOutgoingRoomKeyRequestsByTarget",value:function(e,t,n){return this.backend.getOutgoingRoomKeyRequestsByTarget(e,t,n)}},{key:"updateOutgoingRoomKeyRequest",value:function(e,t,n){return this.backend.updateOutgoingRoomKeyRequest(e,t,n)}},{key:"deleteOutgoingRoomKeyRequest",value:function(e,t){return this.backend.deleteOutgoingRoomKeyRequest(e,t)}},{key:"getAccount",value:function(e,t){this.backend.getAccount(e,t)}},{key:"storeAccount",value:function(e,t){this.backend.storeAccount(e,t)}},{key:"getCrossSigningKeys",value:function(e,t){this.backend.getCrossSigningKeys(e,t)}},{key:"getSecretStorePrivateKey",value:function(e,t,n){this.backend.getSecretStorePrivateKey(e,t,n)}},{key:"storeCrossSigningKeys",value:function(e,t){this.backend.storeCrossSigningKeys(e,t)}},{key:"storeSecretStorePrivateKey",value:function(e,t,n){this.backend.storeSecretStorePrivateKey(e,t,n)}},{key:"countEndToEndSessions",value:function(e,t){this.backend.countEndToEndSessions(e,t)}},{key:"getEndToEndSession",value:function(e,t,n,r){this.backend.getEndToEndSession(e,t,n,r)}},{key:"getEndToEndSessions",value:function(e,t,n){this.backend.getEndToEndSessions(e,t,n)}},{key:"getAllEndToEndSessions",value:function(e,t){this.backend.getAllEndToEndSessions(e,t)}},{key:"storeEndToEndSession",value:function(e,t,n,r){this.backend.storeEndToEndSession(e,t,n,r)}},{key:"storeEndToEndSessionProblem",value:function(e,t,n){return this.backend.storeEndToEndSessionProblem(e,t,n)}},{key:"getEndToEndSessionProblem",value:function(e,t){return this.backend.getEndToEndSessionProblem(e,t)}},{key:"filterOutNotifiedErrorDevices",value:function(e){return this.backend.filterOutNotifiedErrorDevices(e)}},{key:"getEndToEndInboundGroupSession",value:function(e,t,n,r){this.backend.getEndToEndInboundGroupSession(e,t,n,r)}},{key:"getAllEndToEndInboundGroupSessions",value:function(e,t){this.backend.getAllEndToEndInboundGroupSessions(e,t)}},{key:"addEndToEndInboundGroupSession",value:function(e,t,n,r){this.backend.addEndToEndInboundGroupSession(e,t,n,r)}},{key:"storeEndToEndInboundGroupSession",value:function(e,t,n,r){this.backend.storeEndToEndInboundGroupSession(e,t,n,r)}},{key:"storeEndToEndInboundGroupSessionWithheld",value:function(e,t,n,r){this.backend.storeEndToEndInboundGroupSessionWithheld(e,t,n,r)}},{key:"storeEndToEndDeviceData",value:function(e,t){this.backend.storeEndToEndDeviceData(e,t)}},{key:"getEndToEndDeviceData",value:function(e,t){this.backend.getEndToEndDeviceData(e,t)}},{key:"storeEndToEndRoom",value:function(e,t,n){this.backend.storeEndToEndRoom(e,t,n)}},{key:"getEndToEndRooms",value:function(e,t){this.backend.getEndToEndRooms(e,t)}},{key:"getSessionsNeedingBackup",value:function(e){return this.backend.getSessionsNeedingBackup(e)}},{key:"countSessionsNeedingBackup",value:function(e){return this.backend.countSessionsNeedingBackup(e)}},{key:"unmarkSessionsNeedingBackup",value:function(e,t){return this.backend.unmarkSessionsNeedingBackup(e,t)}},{key:"markSessionsNeedingBackup",value:function(e,t){return this.backend.markSessionsNeedingBackup(e,t)}},{key:"addSharedHistoryInboundGroupSession",value:function(e,t,n,r){this.backend.addSharedHistoryInboundGroupSession(e,t,n,r)}},{key:"getSharedHistoryInboundGroupSessions",value:function(e,t){return this.backend.getSharedHistoryInboundGroupSessions(e,t)}},{key:"doTxn",value:function(e,t,n,r){return this.backend.doTxn(e,t,n,r)}}],[{key:"exists",value:function(e,t){return f.exists(e,t)}}]),t}();t.IndexedDBCryptoStore=v,(0,a.default)(v,"STORE_ACCOUNT","account"),(0,a.default)(v,"STORE_SESSIONS","sessions"),(0,a.default)(v,"STORE_INBOUND_GROUP_SESSIONS","inbound_group_sessions"),(0,a.default)(v,"STORE_INBOUND_GROUP_SESSIONS_WITHHELD","inbound_group_sessions_withheld"),(0,a.default)(v,"STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS","shared_history_inbound_group_sessions"),(0,a.default)(v,"STORE_DEVICE_DATA","device_data"),(0,a.default)(v,"STORE_ROOMS","rooms"),(0,a.default)(v,"STORE_BACKUP","sessions_needing_backup")}).call(this,n(14))},function(e,t,n){"use strict";var r=n(8),i=n(16),o=n(0),a=n(2),s=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.EventTimeline=t.Direction=void 0;var u,c=s(n(3)),l=n(70),d=n(17);t.Direction=u,function(e){e.Backward="b",e.Forward="f"}(u||(t.Direction=u={}));var f=function(){function e(t){var n,r,a;o(this,e),this.eventTimelineSet=t,(0,c.default)(this,"roomId",void 0),(0,c.default)(this,"name",void 0),(0,c.default)(this,"events",[]),(0,c.default)(this,"baseIndex",0),(0,c.default)(this,"startState",void 0),(0,c.default)(this,"endState",void 0),(0,c.default)(this,"prevTimeline",void 0),(0,c.default)(this,"nextTimeline",void 0),(0,c.default)(this,"paginationRequests",(i(n={},u.Backward,null),i(n,u.Forward,null),n)),this.roomId=null!==(r=null===(a=t.room)||void 0===a?void 0:a.roomId)&&void 0!==r?r:null,this.startState=new l.RoomState(this.roomId),this.startState.paginationToken=null,this.endState=new l.RoomState(this.roomId),this.endState.paginationToken=null,this.prevTimeline=null,this.nextTimeline=null,this.paginationRequests={b:null,f:null},this.name=this.roomId+":"+(new Date).toISOString()}return a(e,[{key:"initialiseState",value:function(e){if(this.events.length>0)throw new Error("Cannot initialise state after events are added");var t,n=r(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;Object.freeze(i)}}catch(o){n.e(o)}finally{n.f()}this.startState.setStateEvents(e),this.endState.setStateEvents(e)}},{key:"forkLive",value:function(t){var n=this.getState(t),r=new e(this.eventTimelineSet);return r.startState=n.clone(),r.endState=n,this.endState=n.clone(),r}},{key:"fork",value:function(t){var n=this.getState(t),r=new e(this.eventTimelineSet);return r.startState=n.clone(),r.endState=n.clone(),r}},{key:"getRoomId",value:function(){return this.roomId}},{key:"getFilter",value:function(){return this.eventTimelineSet.getFilter()}},{key:"getTimelineSet",value:function(){return this.eventTimelineSet}},{key:"getBaseIndex",value:function(){return this.baseIndex}},{key:"getEvents",value:function(){return this.events}},{key:"getState",value:function(t){if(t==e.BACKWARDS)return this.startState;if(t==e.FORWARDS)return this.endState;throw new Error("Invalid direction '"+t+"'")}},{key:"getPaginationToken",value:function(e){return this.getState(e).paginationToken}},{key:"setPaginationToken",value:function(e,t){this.getState(t).paginationToken=e}},{key:"getNeighbouringTimeline",value:function(t){if(t==e.BACKWARDS)return this.prevTimeline;if(t==e.FORWARDS)return this.nextTimeline;throw new Error("Invalid direction '"+t+"'")}},{key:"setNeighbouringTimeline",value:function(t,n){if(this.getNeighbouringTimeline(n))throw new Error("timeline already has a neighbouring timeline - cannot reset neighbour (direction: "+n+")");if(n==e.BACKWARDS)this.prevTimeline=t;else{if(n!=e.FORWARDS)throw new Error("Invalid direction '"+n+"'");this.nextTimeline=t}this.setPaginationToken(null,n)}},{key:"addEvent",value:function(t,n,r){r||(r=n?this.startState:this.endState);var i,o=this.getTimelineSet();o.room&&(e.setEventMetadata(t,r,n),t.isState()&&o.room.getUnfilteredTimelineSet()===o&&(r.setStateEvents([t]),t.sender&&("m.room.member"!==t.getType()||n)||e.setEventMetadata(t,r,n))),i=n?0:this.events.length,this.events.splice(i,0,t),n&&this.baseIndex++}},{key:"removeEvent",value:function(e){for(var t=this.events.length-1;t>=0;t--){var n=this.events[t];if(n.getId()==e)return this.events.splice(t,1),t<this.baseIndex&&this.baseIndex--,n}return null}},{key:"toString",value:function(){return this.name}}],[{key:"setEventMetadata",value:function(e,t,n){var r,i,o,a;null!==(r=e.sender)&&void 0!==r&&null!==(i=r.events)&&void 0!==i&&i.member||(e.sender=t.getSentinelMember(e.getSender())),null!==(o=e.target)&&void 0!==o&&null!==(a=o.events)&&void 0!==a&&a.member||e.getType()!==d.EventType.RoomMember||(e.target=t.getSentinelMember(e.getStateKey())),e.isState()&&n&&(e.forwardLooking=!1)}}]),e}();t.EventTimeline=f,(0,c.default)(f,"BACKWARDS",u.Backward),(0,c.default)(f,"FORWARDS",u.Forward)},function(e,t,n){"use strict";(function(e){var r=n(130),i=n(131),o=n(132);function a(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(a()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(null===e&&(e=new u(t)),e.length=t),e}function u(e,t,n){if(!u.TYPED_ARRAY_SUPPORT&&!(this instanceof u))return new u(e,t,n);if("number"===typeof e){if("string"===typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return c(this,e,t,n)}function c(e,t,n,r){if("number"===typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!==typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);u.TYPED_ARRAY_SUPPORT?(e=t).__proto__=u.prototype:e=f(e,t);return e}(e,t,n,r):"string"===typeof t?function(e,t,n){"string"===typeof n&&""!==n||(n="utf8");if(!u.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(t,n),i=(e=s(e,r)).write(t,n);i!==r&&(e=e.slice(0,i));return e}(e,t,n):function(e,t){if(u.isBuffer(t)){var n=0|h(t.length);return 0===(e=s(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!==typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!==typeof t.length||(r=t.length)!==r?s(e,0):f(e,t);if("Buffer"===t.type&&o(t.data))return f(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!==typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t){if(l(t),e=s(e,t<0?0:0|h(t)),!u.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function f(e,t){var n=t.length<0?0:0|h(t.length);e=s(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function h(e){if(e>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|e}function p(e,t){if(u.isBuffer(e))return e.length;if("undefined"!==typeof ArrayBuffer&&"function"===typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!==typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return F(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return q(e).length;default:if(r)return F(e).length;t=(""+t).toLowerCase(),r=!0}}function v(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return C(this,t,n);case"utf8":case"utf-8":return I(this,t,n);case"ascii":return R(this,t,n);case"latin1":case"binary":return O(this,t,n);case"base64":return x(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function g(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function y(e,t,n,r,i){if(0===e.length)return-1;if("string"===typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"===typeof t&&(t=u.from(t,r)),u.isBuffer(t))return 0===t.length?-1:m(e,t,n,r,i);if("number"===typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"===typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):m(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function m(e,t,n,r,i){var o,a=1,s=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;a=2,s/=2,u/=2,n/=2}function c(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var l=-1;for(o=n;o<s;o++)if(c(e,o)===c(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*a}else-1!==l&&(o-=o-l),l=-1}else for(n+u>s&&(n=s-u),o=n;o>=0;o--){for(var d=!0,f=0;f<u;f++)if(c(e,o+f)!==c(t,f)){d=!1;break}if(d)return o}return-1}function k(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;if(o%2!==0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var a=0;a<r;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[n+a]=s}return a}function b(e,t,n,r){return V(F(t,e.length-n),e,n,r)}function S(e,t,n,r){return V(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function w(e,t,n,r){return S(e,t,n,r)}function E(e,t,n,r){return V(q(t),e,n,r)}function _(e,t,n,r){return V(function(e,t){for(var n,r,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)r=(n=e.charCodeAt(a))>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function x(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function I(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,a,s,u,c=e[i],l=null,d=c>239?4:c>223?3:c>191?2:1;if(i+d<=n)switch(d){case 1:c<128&&(l=c);break;case 2:128===(192&(o=e[i+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=e[i+1],a=e[i+2],128===(192&o)&&128===(192&a)&&(u=(15&c)<<12|(63&o)<<6|63&a)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128===(192&o)&&128===(192&a)&&128===(192&s)&&(u=(15&c)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&u<1114112&&(l=u)}null===l?(l=65533,d=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=d}return function(e){var t=e.length;if(t<=T)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=T));return n}(r)}t.Buffer=u,t.SlowBuffer=function(e){+e!=e&&(e=0);return u.alloc(+e)},t.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"===typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(t){return!1}}(),t.kMaxLength=a(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,n){return c(null,e,t,n)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!==typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(e,t,n){return function(e,t,n,r){return l(t),t<=0?s(e,t):void 0!==n?"string"===typeof r?s(e,t).fill(n,r):s(e,t).fill(n):s(e,t)}(null,e,t,n)},u.allocUnsafe=function(e){return d(null,e)},u.allocUnsafeSlow=function(e){return d(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=u.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var a=e[n];if(!u.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(r,i),i+=a.length}return r},u.byteLength=p,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?I(this,0,e):v.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},u.prototype.compare=function(e,t,n,r,i){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),a=(n>>>=0)-(t>>>=0),s=Math.min(o,a),c=this.slice(r,i),l=e.slice(t,n),d=0;d<s;++d)if(c[d]!==l[d]){o=c[d],a=l[d];break}return o<a?-1:a<o?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},u.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"===typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return k(this,e,t,n);case"utf8":case"utf-8":return b(this,e,t,n);case"ascii":return S(this,e,t,n);case"latin1":case"binary":return w(this,e,t,n);case"base64":return E(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var T=4096;function R(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function O(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function C(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=K(e[o]);return i}function P(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function D(e,t,n){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function A(e,t,n,r,i,o){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function M(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function U(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function N(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function L(e,t,n,r,o){return o||N(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function j(e,t,n,r,o){return o||N(e,0,n,8),i.write(e,t,n,r,52,8),n+8}u.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=u.prototype;else{var i=t-e;n=new u(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+e]}return n},u.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},u.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},u.prototype.readUInt8=function(e,t){return t||D(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||D(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||D(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||D(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||D(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},u.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},u.prototype.readInt8=function(e,t){return t||D(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||D(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(e,t){t||D(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(e,t){return t||D(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||D(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||D(e,4,this.length),i.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||D(e,4,this.length),i.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||D(e,8,this.length),i.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||D(e,8,this.length),i.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||A(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},u.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||A(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},u.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):M(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):M(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):U(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):U(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);A(this,e,t,n,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<n&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},u.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);A(this,e,t,n,i-1,-i)}var o=n-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):M(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):M(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):U(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):U(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,n){return L(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return L(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return j(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return j(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,o=r-n;if(this===e&&n<t&&t<r)for(i=o-1;i>=0;--i)e[i+t]=this[i+n];else if(o<1e3||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},u.prototype.fill=function(e,t,n,r){if("string"===typeof e){if("string"===typeof t?(r=t,t=0,n=this.length):"string"===typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!==typeof r)throw new TypeError("encoding must be a string");if("string"===typeof r&&!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"===typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"===typeof e)for(o=t;o<n;++o)this[o]=e;else{var a=u.isBuffer(e)?e:F(new u(e,r).toString()),s=a.length;for(o=0;o<n-t;++o)this[o+t]=a[o%s]}return this};var B=/[^+\/0-9A-Za-z-_]/g;function K(e){return e<16?"0"+e.toString(16):e.toString(16)}function F(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function q(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(B,"")).length<2)return"";for(;e.length%4!==0;)e+="=";return e}(e))}function V(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(14))},function(e,t,n){var r=n(30),i=n(47),o=n(109),a=n(64);function s(t){var n="function"===typeof Map?new Map:void 0;return e.exports=s=function(e){if(null===e||!o(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return a(e,arguments,r(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i(t,e)},s(t)}e.exports=s},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e){return(i="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return!t||"object"!==i(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=r(e);if(t){var a=r(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return o(this,n)}}n.d(t,"a",(function(){return a}))},function(e,t,n){"use strict";function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function i(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}n.d(t,"a",(function(){return i}))},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){"use strict";var r=n(0),i=n(2),o=n(11),a=n(9),s=n(10),u=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.User=void 0;var c=u(n(3)),l=function(e){a(n,e);var t=s(n);function n(e){var i;return r(this,n),(i=t.call(this)).userId=e,(0,c.default)(o(i),"modified",void 0),(0,c.default)(o(i),"displayName",void 0),(0,c.default)(o(i),"rawDisplayName",void 0),(0,c.default)(o(i),"avatarUrl",void 0),(0,c.default)(o(i),"presenceStatusMsg",null),(0,c.default)(o(i),"presence","offline"),(0,c.default)(o(i),"lastActiveAgo",0),(0,c.default)(o(i),"lastPresenceTs",0),(0,c.default)(o(i),"currentlyActive",!1),(0,c.default)(o(i),"events",{presence:null,profile:null}),(0,c.default)(o(i),"unstable_statusMessage",""),i.displayName=e,i.rawDisplayName=e,i.avatarUrl=null,i.updateModifiedTime(),i}return i(n,[{key:"setPresenceEvent",value:function(e){if("m.presence"===e.getType()){var t=null===this.events.presence;this.events.presence=e;var n=[];(e.getContent().presence!==this.presence||t)&&n.push("User.presence"),e.getContent().avatar_url&&e.getContent().avatar_url!==this.avatarUrl&&n.push("User.avatarUrl"),e.getContent().displayname&&e.getContent().displayname!==this.displayName&&n.push("User.displayName"),void 0!==e.getContent().currently_active&&e.getContent().currently_active!==this.currentlyActive&&n.push("User.currentlyActive"),this.presence=e.getContent().presence,n.push("User.lastPresenceTs"),e.getContent().status_msg&&(this.presenceStatusMsg=e.getContent().status_msg),e.getContent().displayname&&(this.displayName=e.getContent().displayname),e.getContent().avatar_url&&(this.avatarUrl=e.getContent().avatar_url),this.lastActiveAgo=e.getContent().last_active_ago,this.lastPresenceTs=Date.now(),this.currentlyActive=e.getContent().currently_active,this.updateModifiedTime();for(var r=0;r<n.length;r++)this.emit(n[r],e,this)}}},{key:"setDisplayName",value:function(e){var t=this.displayName;this.displayName="string"===typeof e?e:void 0,e!==t&&this.updateModifiedTime()}},{key:"setRawDisplayName",value:function(e){this.rawDisplayName="string"===typeof e?e:void 0}},{key:"setAvatarUrl",value:function(e){var t=this.avatarUrl;this.avatarUrl=e,e!==t&&this.updateModifiedTime()}},{key:"updateModifiedTime",value:function(){this.modified=Date.now()}},{key:"getLastModifiedTime",value:function(){return this.modified}},{key:"getLastActiveTs",value:function(){return this.lastPresenceTs-this.lastActiveAgo}},{key:"unstable_updateStatusMessage",value:function(e){e.getContent()?this.unstable_statusMessage=e.getContent().status:this.unstable_statusMessage="",this.updateModifiedTime(),this.emit("User.unstable_statusMessage",this)}}]),n}(n(15).EventEmitter);t.User=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.randomString=function(e){return o(e,i+r+"0123456789")},t.randomLowercaseString=function(e){return o(e,r)},t.randomUppercaseString=function(e){return o(e,i)};var r="abcdefghijklmnopqrstuvwxyz",i="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function o(e,t){for(var n="",r=0;r<e;++r)n+=t.charAt(Math.floor(Math.random()*t.length));return n}},function(e,t,n){"use strict";(function(e){var r=n(6),i=n(13),o=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAES=y,t.decryptAES=function(e,t,n){return u?function(e,t,n){return p.apply(this,arguments)}(e,t,n):function(e,t,n){return d.apply(this,arguments)}(e,t,n)},t.calculateKeyCheck=function(e,t){return y("\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",e,"",t)};var a=n(12),s=n(19),u="undefined"!==typeof window&&window.crypto?window.crypto.subtle||window.crypto.webkitSubtle:null,c=new Uint8Array(8);function l(){return(l=o(r.mark((function t(n,o,u,c){var l,d,h,p,v,g,y,m,k;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(l=(0,a.getCrypto)()){t.next=3;break}throw new Error("No usable crypto implementation");case 3:return c?d=(0,s.decodeBase64)(c):(d=l.randomBytes(16))[8]&=127,h=f(o,u),p=i(h,2),v=p[0],g=p[1],y=l.createCipheriv("aes-256-ctr",v,d),m=e.concat([y.update(n,"utf8"),y.final()]),k=l.createHmac("sha256",g).update(m).digest("base64"),t.abrupt("return",{iv:(0,s.encodeBase64)(d),ciphertext:m.toString("base64"),mac:k});case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function d(){return(d=o(r.mark((function t(n,o,u){var c,l,d,h,p,v;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c=(0,a.getCrypto)()){t.next=3;break}throw new Error("No usable crypto implementation");case 3:if(l=f(o,u),d=i(l,2),h=d[0],p=d[1],c.createHmac("sha256",p).update(e.from(n.ciphertext,"base64")).digest("base64").replace(/=+$/g,"")===n.mac.replace(/=+$/g,"")){t.next=7;break}throw new Error("Error decrypting secret ".concat(u,": bad MAC"));case 7:return v=c.createDecipheriv("aes-256-ctr",h,(0,s.decodeBase64)(n.iv)),t.abrupt("return",v.update(n.ciphertext,"base64","utf8")+v.final("utf8"));case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function f(t,n){var r=(0,a.getCrypto)(),i=r.createHmac("sha256",c).update(t).digest(),o=e.alloc(1,1),s=r.createHmac("sha256",i).update(n,"utf8").update(o).digest();return o[0]=2,[s,r.createHmac("sha256",i).update(s).update(n,"utf8").update(o).digest()]}function h(){return(h=o(r.mark((function e(t,n,o,a){var c,l,d,f,h,p,g,y;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a?c=(0,s.decodeBase64)(a):(c=new Uint8Array(16),window.crypto.getRandomValues(c),c[8]&=127),e.next=3,v(n,o);case 3:return l=e.sent,d=i(l,2),f=d[0],h=d[1],p=(new TextEncoder).encode(t),e.next=10,u.encrypt({name:"AES-CTR",counter:c,length:64},f,p);case 10:return g=e.sent,e.next=13,u.sign({name:"HMAC"},h,g);case 13:return y=e.sent,e.abrupt("return",{iv:(0,s.encodeBase64)(c),ciphertext:(0,s.encodeBase64)(g),mac:(0,s.encodeBase64)(y)});case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(){return(p=o(r.mark((function e(t,n,o){var a,c,l,d,f,h;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v(n,o);case 2:return a=e.sent,c=i(a,2),l=c[0],d=c[1],f=(0,s.decodeBase64)(t.ciphertext),e.next=9,u.verify({name:"HMAC"},d,(0,s.decodeBase64)(t.mac),f);case 9:if(e.sent){e.next=11;break}throw new Error("Error decrypting secret ".concat(o,": bad MAC"));case 11:return e.next=13,u.decrypt({name:"AES-CTR",counter:(0,s.decodeBase64)(t.iv),length:64},l,f);case 13:return h=e.sent,e.abrupt("return",(new TextDecoder).decode(new Uint8Array(h)));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e,t){return g.apply(this,arguments)}function g(){return(g=o(r.mark((function e(t,n){var i,o,a,s,l,d;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.importKey("raw",t,{name:"HKDF"},!1,["deriveBits"]);case 2:return i=e.sent,e.next=5,u.deriveBits({name:"HKDF",salt:c,info:(new TextEncoder).encode(n),hash:"SHA-256"},i,512);case 5:return o=e.sent,a=o.slice(0,32),s=o.slice(32),l=u.importKey("raw",a,{name:"AES-CTR"},!1,["encrypt","decrypt"]),d=u.importKey("raw",s,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign","verify"]),e.next=12,Promise.all([l,d]);case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e,t,n,r){return u?function(e,t,n,r){return h.apply(this,arguments)}(e,t,n,r):function(e,t,n,r){return l.apply(this,arguments)}(e,t,n,r)}}).call(this,n(24).Buffer)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.newVerificationError=i,t.errorFactory=o,t.errorFromEvent=function(e){var t=e.getContent();if(t){var n=t.code,r=t.reason;return{code:n,reason:r}}return{code:"Unknown error",reason:"m.unknown"}},t.newInvalidMessageError=t.newUserMismatchError=t.newKeyMismatchError=t.newUnexpectedMessageError=t.newUnknownMethodError=t.newUnknownTransactionError=t.newTimeoutError=t.newUserCancelledError=void 0;var r=n(18);function i(e,t,n){var i=Object.assign({},{code:e,reason:t},n);return new r.MatrixEvent({type:"m.key.verification.cancel",content:i})}function o(e,t){return function(n){return i(e,t,n)}}var a=o("m.user","Cancelled by user");t.newUserCancelledError=a;var s=o("m.timeout","Timed out");t.newTimeoutError=s;var u=o("m.unknown_transaction","Unknown transaction");t.newUnknownTransactionError=u;var c=o("m.unknown_method","Unknown method");t.newUnknownMethodError=c;var l=o("m.unexpected_message","Unexpected message");t.newUnexpectedMessageError=l;var d=o("m.key_mismatch","Key mismatch");t.newKeyMismatchError=d;var f=o("m.user_error","User mismatch");t.newUserMismatchError=f;var h=o("m.invalid_message","Invalid message");t.newInvalidMessageError=h},function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";(function(e){var r=n(16),i=n(8),o=n(13),a=n(6),s=n(7),u=n(0),c=n(2),l=n(11),d=n(9),f=n(10),h=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixClient=t.RoomVersionStability=t.PendingEventOrdering=t.CRYPTO_ENABLED=void 0;var p=h(n(3)),v=n(15),g=n(114),y=n(18),m=n(119),k=n(52),b=n(50),S=n(122),w=Z(n(12)),E=n(23),_=n(75),x=n(78),I=Z(n(19)),T=n(38),R=n(133),O=n(5),C=n(80),P=n(53),D=n(138),A=n(57),M=n(56),U=n(31),N=n(37),L=n(151),j=n(85),B=n(44),K=n(153),F=n(77),q=Z(n(87)),V=n(17),G=n(71),W=n(154),H=n(32),$=n(86),z=n(155),Y=n(157),Q=n(76),J=n(158);function X(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(X=function(e){return e?n:t})(e)}function Z(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=X(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}function ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(n),!0).forEach((function(t){(0,p.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ne=(0,D.isCryptoAvailable)();t.CRYPTO_ENABLED=ne;var re,ie,oe,ae=216e5,se=6e5;t.PendingEventOrdering=re,function(e){e.Chronological="chronological",e.Detached="detached"}(re||(t.PendingEventOrdering=re={})),t.RoomVersionStability=ie,function(e){e.Stable="stable",e.Unstable="unstable"}(ie||(t.RoomVersionStability=ie={})),function(e){e.MasterKey="master_key",e.SelfSigningKey="self_signing_key",e.UserSigningKey="user_signing_key"}(oe||(oe={}));var ue=function(t){d(h,t);var n=f(h);function h(e){var t;u(this,h),t=n.call(this),(0,p.default)(l(t),"reEmitter",new T.ReEmitter(l(t))),(0,p.default)(l(t),"olmVersion",null),(0,p.default)(l(t),"usingExternalCrypto",!1),(0,p.default)(l(t),"store",void 0),(0,p.default)(l(t),"deviceId",void 0),(0,p.default)(l(t),"credentials",void 0),(0,p.default)(l(t),"pickleKey",void 0),(0,p.default)(l(t),"scheduler",void 0),(0,p.default)(l(t),"clientRunning",!1),(0,p.default)(l(t),"timelineSupport",!1),(0,p.default)(l(t),"urlPreviewCache",{}),(0,p.default)(l(t),"unstableClientRelationAggregation",!1),(0,p.default)(l(t),"identityServer",void 0),(0,p.default)(l(t),"sessionStore",void 0),(0,p.default)(l(t),"http",void 0),(0,p.default)(l(t),"crypto",void 0),(0,p.default)(l(t),"cryptoCallbacks",void 0),(0,p.default)(l(t),"callEventHandler",void 0),(0,p.default)(l(t),"supportsCallTransfer",!1),(0,p.default)(l(t),"forceTURN",!1),(0,p.default)(l(t),"iceCandidatePoolSize",0),(0,p.default)(l(t),"idBaseUrl",void 0),(0,p.default)(l(t),"baseUrl",void 0),(0,p.default)(l(t),"canSupportVoip",!1),(0,p.default)(l(t),"peekSync",null),(0,p.default)(l(t),"isGuestAccount",!1),(0,p.default)(l(t),"ongoingScrollbacks",{}),(0,p.default)(l(t),"notifTimelineSet",null),(0,p.default)(l(t),"cryptoStore",void 0),(0,p.default)(l(t),"verificationMethods",void 0),(0,p.default)(l(t),"fallbackICEServerAllowed",!1),(0,p.default)(l(t),"roomList",void 0),(0,p.default)(l(t),"syncApi",void 0),(0,p.default)(l(t),"pushRules",void 0),(0,p.default)(l(t),"syncLeftRoomsPromise",void 0),(0,p.default)(l(t),"syncedLeftRooms",!1),(0,p.default)(l(t),"clientOpts",void 0),(0,p.default)(l(t),"clientWellKnownIntervalID",void 0),(0,p.default)(l(t),"canResetTimelineCallback",void 0),(0,p.default)(l(t),"pushProcessor",new _.PushProcessor(l(t))),(0,p.default)(l(t),"serverVersionsPromise",void 0),(0,p.default)(l(t),"cachedCapabilities",void 0),(0,p.default)(l(t),"clientWellKnown",void 0),(0,p.default)(l(t),"clientWellKnownPromise",void 0),(0,p.default)(l(t),"turnServers",[]),(0,p.default)(l(t),"turnServersExpiry",0),(0,p.default)(l(t),"checkTurnServersIntervalID",void 0),(0,p.default)(l(t),"exportedOlmDeviceToImport",void 0),(0,p.default)(l(t),"txnCtr",0),(0,p.default)(l(t),"mediaHandler",new J.MediaHandler),(0,p.default)(l(t),"startCallEventHandler",(function(){t.isInitialSyncComplete()&&(t.callEventHandler.start(),t.off("sync",t.startCallEventHandler))})),e.baseUrl=w.ensureNoTrailingSlash(e.baseUrl),e.idBaseUrl=w.ensureNoTrailingSlash(e.idBaseUrl),t.baseUrl=e.baseUrl,t.idBaseUrl=e.idBaseUrl,t.usingExternalCrypto=e.usingExternalCrypto,t.store=e.store||new m.StubStore,t.deviceId=e.deviceId||null;var r=e.userId||null;return t.credentials={userId:r},t.http=new P.MatrixHttpApi(l(t),{baseUrl:e.baseUrl,idBaseUrl:e.idBaseUrl,accessToken:e.accessToken,request:e.request,prefix:P.PREFIX_R0,onlyData:!0,extraParams:e.queryParams,localTimeoutMs:e.localTimeoutMs,useAuthorizationHeader:e.useAuthorizationHeader}),e.deviceToImport?t.deviceId?O.logger.warn("not importing device because device ID is provided to constructor independently of exported data"):t.credentials.userId?O.logger.warn("not importing device because user ID is provided to constructor independently of exported data"):e.deviceToImport.deviceId?(t.deviceId=e.deviceToImport.deviceId,t.credentials.userId=e.deviceToImport.userId,t.exportedOlmDeviceToImport=e.deviceToImport.olmDevice):O.logger.warn("not importing device because no device ID in exported data"):e.pickleKey&&(t.pickleKey=e.pickleKey),t.scheduler=e.scheduler,t.scheduler&&t.scheduler.setProcessFunction(function(){var e=s(a.mark((function e(n){var r,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.getRoom(n.getRoomId()),n.status!==y.EventStatus.SENDING&&t.updatePendingEventStatus(r,n,y.EventStatus.SENDING),e.next=4,t.sendEventHttpRequest(n);case 4:return i=e.sent,r&&r.updatePendingEvent(n,y.EventStatus.SENT,i.event_id),e.abrupt("return",i);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,k.createNewMatrixCall)(l(t),void 0,void 0)&&(t.callEventHandler=new S.CallEventHandler(l(t)),t.canSupportVoip=!0,t.on("sync",t.startCallEventHandler)),t.timelineSupport=Boolean(e.timelineSupport),t.unstableClientRelationAggregation=!!e.unstableClientRelationAggregation,t.cryptoStore=e.cryptoStore,t.sessionStore=e.sessionStore,t.verificationMethods=e.verificationMethods,t.cryptoCallbacks=e.cryptoCallbacks||{},t.forceTURN=e.forceTURN||!1,t.iceCandidatePoolSize=void 0===e.iceCandidatePoolSize?0:e.iceCandidatePoolSize,t.supportsCallTransfer=e.supportsCallTransfer||!1,t.fallbackICEServerAllowed=e.fallbackICEServerAllowed||!1,t.roomList=new R.RoomList(t.cryptoStore),t.on("Event.decrypted",(function(e){var n=e.getPushActions(),r=t.pushProcessor.actionsForEvent(e);e.setPushActions(r);var i=t.getRoom(e.getRoomId());if(i){var o=i.getUnreadNotificationCount(B.NotificationCountType.Highlight),a=!(!n||!n.tweaks)&&!!n.tweaks.highlight,s=!(!r||!r.tweaks)&&!!r.tweaks.highlight;if((a!==s||o>0)&&!i.hasUserReadEvent(t.getUserId(),e.getId())){var u=o;s&&!a&&u++,!s&&a&&u--,i.setUnreadNotificationCount(B.NotificationCountType.Highlight,u),i.getUnreadNotificationCount(B.NotificationCountType.Total)<u&&i.setUnreadNotificationCount(B.NotificationCountType.Total,u)}}})),t.on("Room.receipt",(function(e,n){if(n&&t.isRoomEncrypted(n.roomId)){var r=e.getContent();if(!(Object.keys(r).filter((function(e){return Object.keys(r[e]["m.read"]).includes(t.getUserId())})).length>0))return;for(var i=n.getLiveTimeline().getEvents(),o=0,a=i.length-1;a>=0;a--){if(a===i.length-20)return;var s=i[a];if(n.hasUserReadEvent(t.getUserId(),s.getId()))break;var u=t.getPushActionsForEvent(s);o+=u.tweaks&&u.tweaks.highlight?1:0}n.setUnreadNotificationCount("highlight",o)}})),t}return c(h,[{key:"startClient",value:function(){var e=s(a.mark((function e(t){var n,r=this;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.clientRunning){e.next=2;break}return e.abrupt("return");case 2:this.clientRunning=!0,"number"===typeof t&&(t={initialSyncLimit:t}),(n=this.getUserId())&&this.store.storeUser(new U.User(n)),this.crypto&&(this.crypto.uploadDeviceKeys(),this.crypto.start()),this.canSupportVoip&&(this.checkTurnServersIntervalID=setInterval((function(){r.checkTurnServers()}),se),this.checkTurnServers()),this.syncApi&&(O.logger.error("Still have sync object whilst not running: stopping old one"),this.syncApi.stop()),this.clientOpts=Object.assign({},t),this.clientOpts.crypto=this.crypto,this.clientOpts.canResetEntireTimeline=function(e){return!!r.canResetTimelineCallback&&r.canResetTimelineCallback(e)},this.syncApi=new g.SyncApi(this,this.clientOpts),this.syncApi.sync(),void 0!==this.clientOpts.clientWellKnownPollPeriod&&(this.clientWellKnownIntervalID=setInterval((function(){r.fetchClientWellKnown()}),1e3*this.clientOpts.clientWellKnownPollPeriod),this.fetchClientWellKnown());case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopClient",value:function(){var t,n,r,i;O.logger.log("stopping MatrixClient"),this.clientRunning=!1,null===(t=this.syncApi)||void 0===t||t.stop(),this.syncApi=null,null===(n=this.crypto)||void 0===n||n.stop(),null===(r=this.peekSync)||void 0===r||r.stopPeeking(),null===(i=this.callEventHandler)||void 0===i||i.stop(),this.callEventHandler=null,e.clearInterval(this.checkTurnServersIntervalID),void 0!==this.clientWellKnownIntervalID&&e.clearInterval(this.clientWellKnownIntervalID)}},{key:"rehydrateDevice",value:function(){var t=s(a.mark((function t(){var n,r,i,o,s;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.crypto){t.next=2;break}throw new Error("Cannot rehydrate device after crypto is initialized");case 2:if(this.cryptoCallbacks.getDehydrationKey){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,this.getDehydratedDevice();case 6:if(n=t.sent){t.next=9;break}return t.abrupt("return");case 9:if(n.device_data&&n.device_id){t.next=12;break}return O.logger.info("no dehydrated device found"),t.abrupt("return");case 12:if(r=new e.Olm.Account,t.prev=13,(i=n.device_data).algorithm===j.DEHYDRATION_ALGORITHM){t.next=18;break}return O.logger.warn("Wrong algorithm for dehydrated device"),t.abrupt("return");case 18:return O.logger.log("unpickling dehydrated device"),t.next=21,this.cryptoCallbacks.getDehydrationKey(i,(function(e){r.unpickle(new Uint8Array(e),i.account)}));case 21:return o=t.sent,r.unpickle(o,i.account),O.logger.log("unpickled device"),t.next=26,this.http.authedRequest(void 0,"POST","/dehydrated_device/claim",void 0,{device_id:n.device_id},{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"});case 26:if(!0!==t.sent.success){t.next=36;break}return this.deviceId=n.device_id,O.logger.info("using dehydrated device"),s=this.pickleKey||"DEFAULT_KEY",this.exportedOlmDeviceToImport={pickledAccount:r.pickle(s),sessions:[],pickleKey:s},r.free(),t.abrupt("return",this.deviceId);case 36:return r.free(),O.logger.info("not using dehydrated device"),t.abrupt("return");case 39:t.next=45;break;case 41:t.prev=41,t.t0=t.catch(13),r.free(),O.logger.warn("could not unpickle",t.t0);case 45:case"end":return t.stop()}}),t,this,[[13,41]])})));return function(){return t.apply(this,arguments)}}()},{key:"getDehydratedDevice",value:function(){var e=s(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.http.authedRequest(void 0,"GET","/dehydrated_device",void 0,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"});case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),O.logger.info("could not get dehydrated device",e.t0.toString()),e.abrupt("return");case 10:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"setDehydrationKey",value:function(){var e=s(a.mark((function e(t,n,r){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.crypto){e.next=3;break}return O.logger.warn("not dehydrating device if crypto is not enabled"),e.abrupt("return");case 3:return e.next=5,this.crypto.dehydrationManager.setKeyAndQueueDehydration(t,n,r);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"createDehydratedDevice",value:function(){var e=s(a.mark((function e(t,n,r){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.crypto){e.next=3;break}return O.logger.warn("not dehydrating device if crypto is not enabled"),e.abrupt("return");case 3:return e.next=5,this.crypto.dehydrationManager.setKey(t,n,r);case 5:return e.next=7,this.crypto.dehydrationManager.dehydrateDevice();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"exportDevice",value:function(){var e=s(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.crypto){e.next=3;break}return O.logger.warn("not exporting device if crypto is not enabled"),e.abrupt("return");case 3:return e.t0=this.credentials.userId,e.t1=this.deviceId,e.next=7,this.crypto.olmDevice.export();case 7:return e.t2=e.sent,e.abrupt("return",{userId:e.t0,deviceId:e.t1,olmDevice:e.t2});case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"clearStores",value:function(){if(this.clientRunning)throw new Error("Cannot clear stores while client is running");var e=[];return e.push(this.store.deleteAllData()),this.cryptoStore&&e.push(this.cryptoStore.deleteAllData()),Promise.all(e).then()}},{key:"getUserId",value:function(){return this.credentials&&this.credentials.userId?this.credentials.userId:null}},{key:"getDomain",value:function(){return this.credentials&&this.credentials.userId?this.credentials.userId.replace(/^.*?:/,""):null}},{key:"getUserIdLocalpart",value:function(){return this.credentials&&this.credentials.userId?this.credentials.userId.split(":")[0].substring(1):null}},{key:"getDeviceId",value:function(){return this.deviceId}},{key:"supportsVoip",value:function(){return this.canSupportVoip}},{key:"getMediaHandler",value:function(){return this.mediaHandler}},{key:"setForceTURN",value:function(e){this.forceTURN=e}},{key:"setSupportsCallTransfer",value:function(e){this.supportsCallTransfer=e}},{key:"createCall",value:function(e){return(0,k.createNewMatrixCall)(this,e)}},{key:"getSyncState",value:function(){return this.syncApi?this.syncApi.getSyncState():null}},{key:"getSyncStateData",value:function(){return this.syncApi?this.syncApi.getSyncStateData():null}},{key:"isInitialSyncComplete",value:function(){var e=this.getSyncState();return!!e&&(e===F.SyncState.Prepared||e===F.SyncState.Syncing)}},{key:"isGuest",value:function(){return this.isGuestAccount}},{key:"setGuest",value:function(e){this.isGuestAccount=e}},{key:"getScheduler",value:function(){return this.scheduler}},{key:"retryImmediately",value:function(){return this.syncApi.retryImmediately()}},{key:"getNotifTimelineSet",value:function(){return this.notifTimelineSet}},{key:"setNotifTimelineSet",value:function(e){this.notifTimelineSet=e}},{key:"getCapabilities",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=(new Date).getTime();return this.cachedCapabilities&&!t&&n<this.cachedCapabilities.expiration?(O.logger.log("Returning cached capabilities"),Promise.resolve(this.cachedCapabilities.capabilities)):this.http.authedRequest(void 0,"GET","/capabilities").catch((function(e){return O.logger.error(e),null})).then((function(t){t||(t={});var r=t.capabilities||{},i=Object.keys(r).length?ae:6e4+5e3*Math.random();return e.cachedCapabilities={capabilities:r,expiration:n+i},O.logger.log("Caching capabilities: ",r),r}))}},{key:"initCrypto",value:function(){var e=s(a.mark((function e(){var t,n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,D.isCryptoAvailable)()){e.next=2;break}throw new Error("End-to-end encryption not supported in this js-sdk build: did you remember to load the olm library?");case 2:if(!this.crypto){e.next=5;break}return O.logger.warn("Attempt to re-initialise e2e encryption on MatrixClient"),e.abrupt("return");case 5:if(this.sessionStore){e.next=7;break}throw new Error("Cannot enable encryption: no sessionStore provided");case 7:if(this.cryptoStore){e.next=9;break}throw new Error("Cannot enable encryption: no cryptoStore provided");case 9:return O.logger.log("Crypto: Starting up crypto store..."),e.next=12,this.cryptoStore.startup();case 12:return O.logger.log("Crypto: initialising roomlist..."),e.next=15,this.roomList.init();case 15:if(null!==(t=this.getUserId())){e.next=18;break}throw new Error("Cannot enable encryption on MatrixClient with unknown userId: ensure userId is passed in createClient().");case 18:if(null!==this.deviceId){e.next=20;break}throw new Error("Cannot enable encryption on MatrixClient with unknown deviceId: ensure deviceId is passed in createClient().");case 20:return n=new D.Crypto(this,this.sessionStore,t,this.deviceId,this.store,this.cryptoStore,this.roomList,this.verificationMethods),this.reEmitter.reEmit(n,["crypto.keyBackupFailed","crypto.keyBackupSessionsRemaining","crypto.roomKeyRequest","crypto.roomKeyRequestCancellation","crypto.warning","crypto.devicesUpdated","crypto.willUpdateDevices","deviceVerificationChanged","userTrustStatusChanged","crossSigning.keysChanged"]),O.logger.log("Crypto: initialising crypto object..."),e.next=25,n.init({exportedOlmDevice:this.exportedOlmDeviceToImport,pickleKey:this.pickleKey});case 25:delete this.exportedOlmDeviceToImport,this.olmVersion=D.Crypto.getOlmVersion(),n.registerEventHandlers(this),this.crypto=n;case 29:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isCryptoEnabled",value:function(){return!!this.crypto}},{key:"getDeviceEd25519Key",value:function(){return this.crypto?this.crypto.getDeviceEd25519Key():null}},{key:"getDeviceCurve25519Key",value:function(){return this.crypto?this.crypto.getDeviceCurve25519Key():null}},{key:"uploadKeys",value:function(){var e=s(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.crypto){e.next=2;break}throw new Error("End-to-end encryption disabled");case 2:return e.next=4,this.crypto.uploadDeviceKeys();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"downloadKeys",value:function(e,t){return this.crypto?this.crypto.downloadKeys(e,t):Promise.reject(new Error("End-to-end encryption disabled"))}},{key:"getStoredDevicesForUser",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getStoredDevicesForUser(e)||[]}},{key:"getStoredDevice",value:function(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getStoredDevice(e,t)||null}},{key:"setDeviceVerified",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.setDeviceVerification(e,t,n,null,null);return e==this.credentials.userId&&this.checkKeyBackup(),r}},{key:"setDeviceBlocked",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.setDeviceVerification(e,t,null,n,null)}},{key:"setDeviceKnown",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.setDeviceVerification(e,t,null,null,n)}},{key:"setDeviceVerification",value:function(){var e=s(a.mark((function e(t,n,r,i,o){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.crypto){e.next=2;break}throw new Error("End-to-end encryption disabled");case 2:return e.next=4,this.crypto.setDeviceVerification(t,n,r,i,o);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}()},{key:"requestVerificationDM",value:function(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestVerificationDM(e,t)}},{key:"findVerificationRequestDMInProgress",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.findVerificationRequestDMInProgress(e)}},{key:"getVerificationRequestsToDeviceInProgress",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getVerificationRequestsToDeviceInProgress(e)}},{key:"requestVerification",value:function(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestVerification(e,t)}},{key:"beginKeyVerification",value:function(e,t,n){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.beginKeyVerification(e,t,n)}},{key:"checkSecretStorageKey",value:function(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkSecretStorageKey(e,t)}},{key:"setGlobalBlacklistUnverifiedDevices",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.setGlobalBlacklistUnverifiedDevices(e)}},{key:"getGlobalBlacklistUnverifiedDevices",value:function(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getGlobalBlacklistUnverifiedDevices()}},{key:"setGlobalErrorOnUnknownDevices",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.setGlobalErrorOnUnknownDevices(e)}},{key:"getGlobalErrorOnUnknownDevices",value:function(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getGlobalErrorOnUnknownDevices()}},{key:"getCrossSigningId",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K.CrossSigningKey.Master;if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getCrossSigningId(e)}},{key:"getStoredCrossSigningForUser",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getStoredCrossSigningForUser(e)}},{key:"checkUserTrust",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkUserTrust(e)}},{key:"checkDeviceTrust",value:function(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkDeviceTrust(e,t)}},{key:"checkOwnCrossSigningTrust",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkOwnCrossSigningTrust(e)}},{key:"checkCrossSigningPrivateKey",value:function(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkCrossSigningPrivateKey(e,t)}},{key:"legacyDeviceVerification",value:function(e,t,n){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.legacyDeviceVerification(e,t,n)}},{key:"prepareToEncrypt",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.prepareToEncrypt(e)}},{key:"isCrossSigningReady",value:function(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.isCrossSigningReady()}},{key:"bootstrapCrossSigning",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.bootstrapCrossSigning(e)}},{key:"getCryptoTrustCrossSignedDevices",value:function(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getCryptoTrustCrossSignedDevices()}},{key:"setCryptoTrustCrossSignedDevices",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.setCryptoTrustCrossSignedDevices(e)}},{key:"countSessionsNeedingBackup",value:function(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.countSessionsNeedingBackup()}},{key:"getEventEncryptionInfo",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getEventEncryptionInfo(e)}},{key:"createRecoveryKeyFromPassphrase",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.createRecoveryKeyFromPassphrase(e)}},{key:"isSecretStorageReady",value:function(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.isSecretStorageReady()}},{key:"bootstrapSecretStorage",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.bootstrapSecretStorage(e)}},{key:"addSecretStorageKey",value:function(e,t,n){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.addSecretStorageKey(e,t,n)}},{key:"hasSecretStorageKey",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.hasSecretStorageKey(e)}},{key:"storeSecret",value:function(e,t,n){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.storeSecret(e,t,n)}},{key:"getSecret",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getSecret(e)}},{key:"isSecretStored",value:function(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.isSecretStored(e,t)}},{key:"requestSecret",value:function(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestSecret(e,t)}},{key:"getDefaultSecretStorageKeyId",value:function(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getDefaultSecretStorageKeyId()}},{key:"setDefaultSecretStorageKeyId",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.setDefaultSecretStorageKeyId(e)}},{key:"checkSecretStoragePrivateKey",value:function(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkSecretStoragePrivateKey(e,t)}},{key:"getEventSenderDeviceInfo",value:function(){var e=s(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.crypto){e.next=2;break}return e.abrupt("return",null);case 2:return e.abrupt("return",this.crypto.getEventSenderDeviceInfo(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isEventSenderVerified",value:function(){var e=s(a.mark((function e(t){var n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getEventSenderDeviceInfo(t);case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return",!1);case 5:return e.abrupt("return",n.isVerified());case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"cancelAndResendEventRoomKeyRequest",value:function(e){return e.cancelAndResendKeyRequest(this.crypto,this.getUserId())}},{key:"setRoomEncryption",value:function(e,t){if(!this.crypto)throw new Error("End-to-End encryption disabled");return this.crypto.setRoomEncryption(e,t)}},{key:"isRoomEncrypted",value:function(e){var t=this.getRoom(e);return!!t&&(!!t.currentState.getStateEvents(V.EventType.RoomEncryption,"")||this.roomList.isRoomEncrypted(e))}},{key:"forceDiscardSession",value:function(e){if(!this.crypto)throw new Error("End-to-End encryption disabled");this.crypto.forceDiscardSession(e)}},{key:"exportRoomKeys",value:function(){return this.crypto?this.crypto.exportRoomKeys():Promise.reject(new Error("End-to-end encryption disabled"))}},{key:"importRoomKeys",value:function(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.importRoomKeys(e,t)}},{key:"checkKeyBackup",value:function(){return this.crypto.backupManager.checkKeyBackup()}},{key:"getKeyBackupVersion",value:function(){var e=s(a.mark((function e(){var t;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.http.authedRequest(void 0,"GET","/room_keys/version",void 0,void 0,{prefix:P.PREFIX_UNSTABLE});case 3:t=e.sent,e.next=13;break;case 6:if(e.prev=6,e.t0=e.catch(0),"M_NOT_FOUND"!==e.t0.errcode){e.next=12;break}return e.abrupt("return",null);case 12:throw e.t0;case 13:e.prev=13,$.BackupManager.checkBackupVersion(t),e.next=20;break;case 17:throw e.prev=17,e.t1=e.catch(13),e.t1;case 20:return e.abrupt("return",t);case 21:case"end":return e.stop()}}),e,this,[[0,6],[13,17]])})));return function(){return e.apply(this,arguments)}}()},{key:"isKeyBackupTrusted",value:function(e){return this.crypto.backupManager.isKeyBackupTrusted(e)}},{key:"getKeyBackupEnabled",value:function(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.getKeyBackupEnabled()}},{key:"enableKeyBackup",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.enableKeyBackup(e)}},{key:"disableKeyBackup",value:function(){if(!this.crypto)throw new Error("End-to-end encryption disabled");this.crypto.backupManager.disableKeyBackup()}},{key:"prepareKeyBackupVersion",value:function(){var e=s(a.mark((function e(t){var n,r,i,o,s,u,c=arguments;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=c.length>1&&void 0!==c[1]?c[1]:{secureSecretStorage:!1},this.crypto){e.next=3;break}throw new Error("End-to-end encryption disabled");case 3:return e.next=5,this.crypto.backupManager.prepareKeyBackupVersion(t);case 5:if(r=e.sent,i=r.algorithm,o=r.auth_data,s=r.recovery_key,u=r.privateKey,!n.secureSecretStorage){e.next=14;break}return e.next=13,this.storeSecret("m.megolm_backup.v1",(0,I.encodeBase64)(u));case 13:O.logger.info("Key backup private key stored in secret storage");case 14:return e.abrupt("return",{algorithm:i,auth_data:o,recovery_key:s});case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isKeyBackupKeyStored",value:function(){return Promise.resolve(this.isSecretStored("m.megolm_backup.v1",!1))}},{key:"createKeyBackupVersion",value:function(){var e=s(a.mark((function e(t){var n,r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.crypto){e.next=2;break}throw new Error("End-to-end encryption disabled");case 2:return e.next=4,this.crypto.backupManager.createKeyBackupVersion(t);case 4:return n={algorithm:t.algorithm,auth_data:t.auth_data},e.next=7,this.crypto.signObject(n.auth_data);case 7:if(!this.cryptoCallbacks.getCrossSigningKey||!this.crypto.crossSigningInfo.getId()){e.next=10;break}return e.next=10,this.crypto.crossSigningInfo.signObject(n.auth_data,"master");case 10:return e.next=12,this.http.authedRequest(void 0,"POST","/room_keys/version",void 0,n,{prefix:P.PREFIX_UNSTABLE});case 12:return r=e.sent,e.next=15,this.checkKeyBackup();case 15:return this.getKeyBackupEnabled()||O.logger.error("Key backup not usable even though we just created it"),e.abrupt("return",r);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteKeyBackupVersion",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");this.crypto.backupManager.version&&this.crypto.backupManager.disableKeyBackup();var t=w.encodeUri("/room_keys/version/$version",{$version:e});return this.http.authedRequest(void 0,"DELETE",t,void 0,void 0,{prefix:P.PREFIX_UNSTABLE})}},{key:"makeKeyBackupPath",value:function(e,t,n){return{path:void 0!==t?w.encodeUri("/room_keys/keys/$roomId/$sessionId",{$roomId:e,$sessionId:t}):void 0!==e?w.encodeUri("/room_keys/keys/$roomId",{$roomId:e}):"/room_keys/keys",queryData:void 0===n?void 0:{version:n}}}},{key:"sendKeyBackup",value:function(e,t,n,r){if(!this.crypto)throw new Error("End-to-end encryption disabled");var i=this.makeKeyBackupPath(e,t,n);return this.http.authedRequest(void 0,"PUT",i.path,i.queryData,r,{prefix:P.PREFIX_UNSTABLE})}},{key:"scheduleAllGroupSessionsForBackup",value:function(){var e=s(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.crypto){e.next=2;break}throw new Error("End-to-end encryption disabled");case 2:return e.next=4,this.crypto.backupManager.scheduleAllGroupSessionsForBackup();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"flagAllGroupSessionsForBackup",value:function(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.flagAllGroupSessionsForBackup()}},{key:"isValidRecoveryKey",value:function(e){try{return(0,A.decodeRecoveryKey)(e),!0}catch(t){return!1}}},{key:"keyBackupKeyFromPassword",value:function(e,t){return(0,M.keyFromAuthData)(t.auth_data,e)}},{key:"keyBackupKeyFromRecoveryKey",value:function(e){return(0,A.decodeRecoveryKey)(e)}},{key:"restoreKeyBackupWithPassword",value:function(){var e=s(a.mark((function e(t,n,r,i,o){var s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,M.keyFromAuthData)(i.auth_data,t);case 2:return s=e.sent,e.abrupt("return",this.restoreKeyBackup(s,n,r,i,o));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}()},{key:"restoreKeyBackupWithSecretStorage",value:function(){var e=s(a.mark((function e(t,n,r,i){var s,u,c,l,d,f;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSecret("m.megolm_backup.v1");case 2:if(s=e.sent,!(u=(0,D.fixBackupKey)(s))){e.next=12;break}return e.next=7,this.crypto.getSecretStorageKey();case 7:return c=e.sent,l=o(c,1),d=l[0],e.next=12,this.storeSecret("m.megolm_backup.v1",u,[d]);case 12:return f=(0,I.decodeBase64)(u||s),e.abrupt("return",this.restoreKeyBackup(f,n,r,t,i));case 14:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"restoreKeyBackupWithRecoveryKey",value:function(e,t,n,r,i){var o=(0,A.decodeRecoveryKey)(e);return this.restoreKeyBackup(o,t,n,r,i)}},{key:"restoreKeyBackupWithCache",value:function(){var e=s(a.mark((function e(t,n,r,i){var o;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.crypto.getSessionBackupPrivateKey();case 2:if(o=e.sent){e.next=5;break}throw new Error("Couldn't get key");case 5:return e.abrupt("return",this.restoreKeyBackup(o,t,n,r,i));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"restoreKeyBackup",value:function(){var e=s(a.mark((function e(t,n,u,c,l){var d,f,p,v,g,y,m,k,b,S,w,E,_,x,I,T,R,C,D,A,M,U;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d=null===l||void 0===l?void 0:l.cacheCompleteCallback,f=null===l||void 0===l?void 0:l.progressCallback,this.crypto){e.next=4;break}throw new Error("End-to-end encryption disabled");case 4:return p=0,v=[],g=this.makeKeyBackupPath(n,u,c.version),e.next=9,$.BackupManager.makeAlgorithm(c,s(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)}))));case 9:return y=e.sent,m=y.untrusted,e.prev=11,e.next=14,y.keyMatches(t);case 14:if(e.sent){e.next=16;break}return e.abrupt("return",Promise.reject(new P.MatrixError({errcode:h.RESTORE_BACKUP_ERROR_BAD_KEY})));case 16:return this.crypto.storeSessionBackupPrivateKey(t).catch((function(e){O.logger.warn("Error caching session backup key:",e)})).then(d),f&&f({stage:"fetch"}),e.next=20,this.http.authedRequest(void 0,"GET",g.path,g.queryData,void 0,{prefix:P.PREFIX_UNSTABLE});case 20:if(!(k=e.sent).rooms){e.next=38;break}b=0,S=Object.entries(k.rooms);case 23:if(!(b<S.length)){e.next=36;break}if(w=o(S[b],2),E=w[0],(_=w[1]).sessions){e.next=27;break}return e.abrupt("continue",33);case 27:return p+=Object.keys(_.sessions).length,e.next=30,y.decryptSessions(_.sessions);case 30:x=e.sent,I=i(x);try{for(I.s();!(T=I.n()).done;)(R=T.value).room_id=E,v.push(R)}catch(N){I.e(N)}finally{I.f()}case 33:b++,e.next=23;break;case 36:e.next=62;break;case 38:if(!k.sessions){e.next=47;break}return p=Object.keys(k.sessions).length,e.next=42,y.decryptSessions(k.sessions);case 42:v=e.sent,C=i(v);try{for(C.s();!(D=C.n()).done;)D.value.room_id=n}catch(N){C.e(N)}finally{C.f()}e.next=62;break;case 47:return p=1,e.prev=48,e.next=51,y.decryptSessions(r({},u,k));case 51:A=e.sent,M=o(A,1),(U=M[0]).room_id=n,U.session_id=u,v.push(U),e.next=62;break;case 59:e.prev=59,e.t0=e.catch(48),O.logger.log("Failed to decrypt megolm session from backup",e.t0);case 62:return e.prev=62,y.free(),e.finish(62);case 65:return e.next=67,this.importRoomKeys(v,{progressCallback:f,untrusted:m,source:"backup"});case 67:return e.next=69,this.checkKeyBackup();case 69:return e.abrupt("return",{total:p,imported:v.length});case 70:case"end":return e.stop()}}),e,this,[[11,,62,65],[48,59]])})));return function(t,n,r,i,o){return e.apply(this,arguments)}}()},{key:"deleteKeysFromBackup",value:function(e,t,n){if(!this.crypto)throw new Error("End-to-end encryption disabled");var r=this.makeKeyBackupPath(e,t,n);return this.http.authedRequest(void 0,"DELETE",r.path,r.queryData,void 0,{prefix:P.PREFIX_UNSTABLE})}},{key:"sendSharedHistoryKeys",value:function(){var e=s(a.mark((function e(t,n){var r,i,s,u,c,l,d,f,h;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.crypto){e.next=2;break}throw new Error("End-to-end encryption disabled");case 2:if(r=this.roomList.getRoomEncryption(t)){e.next=6;break}return O.logger.error("Unknown room.  Not sharing decryption keys"),e.abrupt("return");case 6:return e.next=8,this.crypto.downloadKeys(n);case 8:for(i=e.sent,s={},u=0,c=Object.entries(i);u<c.length;u++)l=o(c[u],2),d=l[0],f=l[1],s[d]=Object.values(f);if(!(h=this.crypto.getRoomDecryptor(t,r.algorithm)).sendSharedHistoryInboundSessions){e.next=17;break}return e.next=15,h.sendSharedHistoryInboundSessions(s);case 15:e.next=18;break;case 17:O.logger.warn("Algorithm does not support sharing previous keys",r.algorithm);case 18:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getGroup",value:function(e){return this.store.getGroup(e)}},{key:"getGroups",value:function(){return this.store.getGroups()}},{key:"getMediaConfig",value:function(e){return this.http.authedRequest(e,"GET","/config",void 0,void 0,{prefix:P.PREFIX_MEDIA_R0})}},{key:"getRoom",value:function(e){return this.store.getRoom(e)}},{key:"getRooms",value:function(){return this.store.getRooms()}},{key:"getVisibleRooms",value:function(){var e,t=this.store.getRooms(),n=new Set,r=i(t);try{for(r.s();!(e=r.n()).done;){var o=e.value.currentState.getStateEvents(V.EventType.RoomCreate,"");if(o){var a=o.getContent().predecessor;a&&a.room_id&&n.add(a.room_id)}}}catch(s){r.e(s)}finally{r.f()}return t.filter((function(e){return!e.currentState.getStateEvents(V.EventType.RoomTombstone,"")||!n.has(e.roomId)}))}},{key:"getUser",value:function(e){return this.store.getUser(e)}},{key:"getUsers",value:function(){return this.store.getUsers()}},{key:"setAccountData",value:function(e,t,n){var r=this,i=w.encodeUri("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:e}),o=(0,P.retryNetworkOperation)(5,(function(){return r.http.authedRequest(void 0,"PUT",i,void 0,t)}));return n&&o.then((function(e){return n(null,e)}),n),o}},{key:"getAccountData",value:function(e){return this.store.getAccountData(e)}},{key:"getAccountDataFromServer",value:function(){var e=s(a.mark((function e(t){var n,r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isInitialSyncComplete()){e.next=5;break}if(n=this.store.getAccountData(t)){e.next=4;break}return e.abrupt("return",null);case 4:return e.abrupt("return",n.getContent());case 5:return r=w.encodeUri("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:t}),e.prev=6,e.next=9,this.http.authedRequest(void 0,"GET",r,void 0);case 9:return e.abrupt("return",e.sent);case 12:if(e.prev=12,e.t0=e.catch(6),!e.t0.data||"M_NOT_FOUND"!==e.t0.data.errcode){e.next=16;break}return e.abrupt("return",null);case 16:throw e.t0;case 17:case"end":return e.stop()}}),e,this,[[6,12]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getIgnoredUsers",value:function(){var e=this.getAccountData("m.ignored_user_list");return e&&e.getContent()&&e.getContent().ignored_users?Object.keys(e.getContent().ignored_users):[]}},{key:"setIgnoredUsers",value:function(e,t){var n={ignored_users:{}};return e.map((function(e){return n.ignored_users[e]={}})),this.setAccountData("m.ignored_user_list",n,t)}},{key:"isUserIgnored",value:function(e){return this.getIgnoredUsers().includes(e)}},{key:"joinRoom",value:function(){var e=s(a.mark((function e(t,n,r){var i,o,s,u,c,l,d,f,h,p,v;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!w.isFunction(n)){e.next=2;break}throw new Error("Expected 'opts' object, got function.");case 2:if(void 0===(n=n||{}).syncRoom&&(n.syncRoom=!0),!(i=this.getRoom(t))||!i.hasMembershipState(this.credentials.userId,"join")){e.next=7;break}return e.abrupt("return",Promise.resolve(i));case 7:return o=Promise.resolve(),n.inviteSignUrl&&(o=this.http.requestOtherUrl(void 0,"POST",n.inviteSignUrl,{mxid:this.credentials.userId})),s={},n.viaServers&&(s.server_name=n.viaServers),u={qsStringifyOptions:{arrayFormat:"repeat"}},e.prev=12,c={},e.next=16,o;case 16:return(l=e.sent)&&(c.third_party_signed=l),d=w.encodeUri("/join/$roomid",{$roomid:t}),e.next=21,this.http.authedRequest(void 0,"POST",d,s,c,u);case 21:return f=e.sent,h=f.room_id,p=new g.SyncApi(this,this.clientOpts),v=p.createRoom(h),n.syncRoom,null===r||void 0===r||r(null,v),e.abrupt("return",v);case 30:throw e.prev=30,e.t0=e.catch(12),null===r||void 0===r||r(e.t0),e.t0;case 34:case"end":return e.stop()}}),e,this,[[12,30]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"resendEvent",value:function(e,t){return this.updatePendingEventStatus(t,e,y.EventStatus.SENDING),this.encryptAndSendEvent(t,e)}},{key:"cancelPendingEvent",value:function(e){if([y.EventStatus.QUEUED,y.EventStatus.NOT_SENT].indexOf(e.status)<0)throw new Error("cannot cancel an event with status "+e.status);this.scheduler&&this.scheduler.removeEventFromQueue(e);var t=this.getRoom(e.getRoomId());this.updatePendingEventStatus(t,e,y.EventStatus.CANCELLED)}},{key:"setRoomName",value:function(e,t,n){return this.sendStateEvent(e,V.EventType.RoomName,{name:t},void 0,n)}},{key:"setRoomTopic",value:function(e,t,n){return this.sendStateEvent(e,V.EventType.RoomTopic,{topic:t},void 0,n)}},{key:"getRoomTags",value:function(e,t){var n=w.encodeUri("/user/$userId/rooms/$roomId/tags/",{$userId:this.credentials.userId,$roomId:e});return this.http.authedRequest(t,"GET",n,void 0)}},{key:"setRoomTag",value:function(e,t,n,r){var i=w.encodeUri("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this.http.authedRequest(r,"PUT",i,void 0,n)}},{key:"deleteRoomTag",value:function(e,t,n){var r=w.encodeUri("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this.http.authedRequest(n,"DELETE",r,void 0,void 0)}},{key:"setRoomAccountData",value:function(e,t,n,r){var i=w.encodeUri("/user/$userId/rooms/$roomId/account_data/$type",{$userId:this.credentials.userId,$roomId:e,$type:t});return this.http.authedRequest(r,"PUT",i,void 0,n)}},{key:"setPowerLevel",value:function(e,t,n,r,i){var o={users:{}};(null===r||void 0===r?void 0:r.getType())===V.EventType.RoomPowerLevels&&(o=w.deepCopy(r.getContent())),o.users[t]=n;var a=w.encodeUri("/rooms/$roomId/state/m.room.power_levels",{$roomId:e});return this.http.authedRequest(i,"PUT",a,void 0,o)}},{key:"sendEvent",value:function(e,t,n,r,i){return this.sendCompleteEvent(e,{type:t,content:n},r,i)}},{key:"sendCompleteEvent",value:function(e,t,n,r){w.isFunction(n)&&(r=n,n=void 0),n||(n=this.makeTxnId());var i=new y.MatrixEvent(Object.assign(t,{event_id:"~"+e+":"+n,user_id:this.credentials.userId,sender:this.credentials.userId,room_id:e,origin_server_ts:(new Date).getTime()})),o=this.getRoom(e),a=i.getAssociatedId();if(a&&a.startsWith("~")){var s=o.getPendingEvents().find((function(e){return e.getId()===a}));s.once("Event.localEventIdReplaced",(function(){i.updateAssociatedId(s.getId())}))}var u=i.getType();return O.logger.log("sendEvent of type ".concat(u," in ").concat(e," with txnId ").concat(n)),i.setTxnId(n),i.setStatus(y.EventStatus.SENDING),o&&o.addPendingEvent(i,n),i.status===y.EventStatus.NOT_SENT?Promise.reject(new Error("Event blocked by other events not yet sent")):this.encryptAndSendEvent(o,i,r)}},{key:"encryptAndSendEvent",value:function(e,t,n){var r=this;return Promise.resolve().then((function(){var n=r.encryptEventIfNeeded(t,e);return n?(r.updatePendingEventStatus(e,t,y.EventStatus.ENCRYPTING),n.then((function(){return r.updatePendingEventStatus(e,t,y.EventStatus.SENDING)}))):null})).then((function(){var n;return r.scheduler&&(n=r.scheduler.queueEvent(t))&&r.scheduler.getQueueForEvent(t).length>1&&r.updatePendingEventStatus(e,t,y.EventStatus.QUEUED),n||(n=r.sendEventHttpRequest(t),e&&(n=n.then((function(n){return e.updatePendingEvent(t,y.EventStatus.SENT,n.event_id),n})))),n})).then((function(e){return null===n||void 0===n||n(null,e),e})).catch((function(i){O.logger.error("Error sending event",i.stack||i);try{t.error=i,r.updatePendingEventStatus(e,t,y.EventStatus.NOT_SENT),i.event=t,null===n||void 0===n||n(i)}catch(o){O.logger.error("Exception in error handler!",o.stack||i)}throw i}))}},{key:"encryptEventIfNeeded",value:function(e,t){if(e.isEncrypted())return null;if(!this.isRoomEncrypted(e.getRoomId()))return null;if(!this.crypto&&this.usingExternalCrypto)return null;if(e.getType()===V.EventType.Reaction)return null;if(!this.crypto)throw new Error("This room is configured to use encryption, but your client does not support encryption.");return this.crypto.encryptEvent(e,t)}},{key:"getEncryptedIfNeededEventType",value:function(e,t){return t===V.EventType.Reaction?t:this.isRoomEncrypted(e)?V.EventType.RoomMessageEncrypted:t}},{key:"updatePendingEventStatus",value:function(e,t,n){e?e.updatePendingEvent(t,n):t.setStatus(n)}},{key:"sendEventHttpRequest",value:function(e){var t=e.getTxnId();t||(t=this.makeTxnId(),e.setTxnId(t));var n,r={$roomId:e.getRoomId(),$eventType:e.getWireType(),$stateKey:e.getStateKey(),$txnId:t};if(e.isState()){var i="/rooms/$roomId/state/$eventType";e.getStateKey()&&e.getStateKey().length>0&&(i="/rooms/$roomId/state/$eventType/$stateKey"),n=w.encodeUri(i,r)}else if(e.isRedaction()){n=w.encodeUri("/rooms/$roomId/redact/$redactsEventId/$txnId",Object.assign({$redactsEventId:e.event.redacts},r))}else n=w.encodeUri("/rooms/$roomId/send/$eventType/$txnId",r);return this.http.authedRequest(void 0,"PUT",n,void 0,e.getWireContent()).then((function(t){return O.logger.log("Event sent to ".concat(e.getRoomId()," with event id ").concat(t.event_id)),t}))}},{key:"redactEvent",value:function(e,t,n,r){var i=("object"===typeof r?r:{}).reason,o="function"===typeof r?r:void 0;return this.sendCompleteEvent(e,{type:V.EventType.RoomRedaction,content:{reason:i},redacts:t},n,o)}},{key:"sendMessage",value:function(e,t,n,r){return w.isFunction(n)&&(r=n,n=void 0),this.sendEvent(e,V.EventType.RoomMessage,t,n,r)}},{key:"sendTextMessage",value:function(e,t,n,r){var i=q.makeTextMessage(t);return this.sendMessage(e,i,n,r)}},{key:"sendNotice",value:function(e,t,n,r){var i=q.makeNotice(t);return this.sendMessage(e,i,n,r)}},{key:"sendEmoteMessage",value:function(e,t,n,r){var i=q.makeEmoteMessage(t);return this.sendMessage(e,i,n,r)}},{key:"sendImageMessage",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Image",i=arguments.length>4?arguments[4]:void 0;w.isFunction(r)&&(i=r,r=void 0);var o={msgtype:V.MsgType.Image,url:t,info:n,body:r};return this.sendMessage(e,o,void 0,i)}},{key:"sendStickerMessage",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Sticker",i=arguments.length>4?arguments[4]:void 0;w.isFunction(r)&&(i=r,r=void 0);var o={url:t,info:n,body:r};return this.sendEvent(e,V.EventType.Sticker,o,void 0,i)}},{key:"sendHtmlMessage",value:function(e,t,n,r){var i=q.makeHtmlMessage(t,n);return this.sendMessage(e,i,void 0,r)}},{key:"sendHtmlNotice",value:function(e,t,n,r){var i=q.makeHtmlNotice(t,n);return this.sendMessage(e,i,void 0,r)}},{key:"sendHtmlEmote",value:function(e,t,n,r){var i=q.makeHtmlEmote(t,n);return this.sendMessage(e,i,void 0,r)}},{key:"sendReceipt",value:function(e,t,n,r){if("function"===typeof n&&(r=n,n={}),this.isGuest())return Promise.resolve({});var i=w.encodeUri("/rooms/$roomId/receipt/$receiptType/$eventId",{$roomId:e.getRoomId(),$receiptType:t,$eventId:e.getId()}),o=this.http.authedRequest(r,"POST",i,void 0,n||{}),a=this.getRoom(e.getRoomId());return a&&a.addLocalEchoReceipt(this.credentials.userId,e,t),o}},{key:"sendReadReceipt",value:function(){var e=s(a.mark((function e(t,n,r){var i,o,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"===typeof n&&(r=n,n={}),n||(n={}),i=t.getId(),!(o=this.getRoom(t.getRoomId()))||!o.hasPendingEvent(i)){e.next=6;break}throw new Error("Cannot set read receipt to a pending event (".concat(i,")"));case 6:return s={"org.matrix.msc2285.hidden":Boolean(n.hidden)},e.abrupt("return",this.sendReceipt(t,"m.read",s,r));case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"setRoomReadMarkers",value:function(){var e=s(a.mark((function e(t,n,r,i){var o,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(o=this.getRoom(t))||!o.hasPendingEvent(n)){e.next=3;break}throw new Error("Cannot set read marker to a pending event (".concat(n,")"));case 3:if(!r){e.next=8;break}if(s=r.getId(),!o||!o.hasPendingEvent(s)){e.next=7;break}throw new Error("Cannot set read receipt to a pending event (".concat(s,")"));case 7:o&&o.addLocalEchoReceipt(this.credentials.userId,r,"m.read");case 8:return e.abrupt("return",this.setRoomReadMarkersHttpRequest(t,n,s,i));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"getUrlPreview",value:function(e,t,n){t=6e4*Math.floor(t/6e4);var r=new URL(e);r.hash="";var i=t+"_"+(e=r.toString()),o=this.urlPreviewCache[i];if(o)return n&&o.then(n).catch(n),o;var a=this.http.authedRequest(n,"GET","/preview_url",{url:e,ts:t},void 0,{prefix:P.PREFIX_MEDIA_R0});return this.urlPreviewCache[i]=a,a}},{key:"sendTyping",value:function(e,t,n,r){if(this.isGuest())return Promise.resolve({});var i=w.encodeUri("/rooms/$roomId/typing/$userId",{$roomId:e,$userId:this.credentials.userId}),o={typing:t};return t&&(o.timeout=n||2e4),this.http.authedRequest(r,"PUT",i,void 0,o)}},{key:"getRoomUpgradeHistory",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.getRoom(e);if(!n)return[];for(var r=[n],i=n.currentState.getStateEvents(V.EventType.RoomCreate,"");i;){var o=i.getContent().predecessor;if(!o||!o.room_id)break;var a=this.getRoom(o.room_id);if(!a)break;if(t){var s=a.currentState.getStateEvents(V.EventType.RoomTombstone,"");if(!s||s.getContent().replacement_room!==a.roomId)break}r.splice(0,0,a),i=a.currentState.getStateEvents(V.EventType.RoomCreate,"")}for(var u=n.currentState.getStateEvents(V.EventType.RoomTombstone,"");u;){var c=this.getRoom(u.getContent().replacement_room);if(!c)break;if(c.roomId===n.roomId)break;if(t){if(!(i=c.currentState.getStateEvents(V.EventType.RoomCreate,""))||!i.getContent().predecessor)break;var l=i.getContent().predecessor;if(l.room_id!==n.roomId)break}r.push(c);var d=new Set(r.map((function(e){return e.roomId})));if(d.size<r.length)return r.slice(0,r.length-1);u=(n=c).currentState.getStateEvents(V.EventType.RoomTombstone,"")}return r}},{key:"invite",value:function(e,t,n,r){return this.membershipChange(e,t,"invite",r,n)}},{key:"inviteByEmail",value:function(e,t,n){return this.inviteByThreePid(e,"email",t,n)}},{key:"inviteByThreePid",value:function(){var e=s(a.mark((function e(t,n,r,i){var o,s,u,c;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=w.encodeUri("/rooms/$roomId/invite",{$roomId:t}),s=this.getIdentityServerUrl(!0)){e.next=4;break}return e.abrupt("return",Promise.reject(new P.MatrixError({error:"No supplied identity server URL",errcode:"ORG.MATRIX.JSSDK_MISSING_PARAM"})));case 4:if(u={id_server:s,medium:n,address:r},e.t0=this.identityServer&&this.identityServer.getAccessToken,!e.t0){e.next=10;break}return e.next=9,this.doesServerAcceptIdentityAccessToken();case 9:e.t0=e.sent;case 10:if(!e.t0){e.next=15;break}return e.next=13,this.identityServer.getAccessToken();case 13:(c=e.sent)&&(u.id_access_token=c);case 15:return e.abrupt("return",this.http.authedRequest(i,"POST",o,void 0,u));case 16:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"leave",value:function(e,t){return this.membershipChange(e,void 0,"leave",void 0,t)}},{key:"leaveRoomChain",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.getRoomUpgradeHistory(e),o=r;if(!n){o=[];var a,s=i(r);try{for(s.s();!(a=s.n()).done;){var u=a.value;if(o.push(u),u.roomId===e)break}}catch(v){s.e(v)}finally{s.f()}}var c,l={},d=[],f=function(e){return t.leave(e).then((function(){l[e]=null})).catch((function(t){return l[e]=t,null}))},h=i(o);try{for(h.s();!(c=h.n()).done;){var p=c.value;d.push(f(p.roomId))}}catch(v){h.e(v)}finally{h.f()}return Promise.all(d).then((function(){return l}))}},{key:"ban",value:function(e,t,n,r){return this.membershipChange(e,t,"ban",n,r)}},{key:"forget",value:function(e,t,n){var r=this;void 0===t&&(t=!0);var i=this.membershipChange(e,void 0,"forget",void 0,n);return t?i.then((function(t){return r.store.removeRoom(e),r.emit("deleteRoom",e),t})):i}},{key:"unban",value:function(e,t,n){var r=w.encodeUri("/rooms/$roomId/unban",{$roomId:e}),i={user_id:t};return this.http.authedRequest(n,"POST",r,void 0,i)}},{key:"kick",value:function(e,t,n,r){var i=w.encodeUri("/rooms/$roomId/kick",{$roomId:e}),o={user_id:t,reason:n};return this.http.authedRequest(r,"POST",i,void 0,o)}},{key:"setMembershipState",value:function(e,t,n,r,i){w.isFunction(r)&&(i=r,r=void 0);var o=w.encodeUri("/rooms/$roomId/state/m.room.member/$userId",{$roomId:e,$userId:t});return this.http.authedRequest(i,"PUT",o,void 0,{membership:n,reason:r})}},{key:"membershipChange",value:function(e,t,n,r,i){w.isFunction(r)&&(i=r,r=void 0);var o=w.encodeUri("/rooms/$room_id/$membership",{$room_id:e,$membership:n});return this.http.authedRequest(i,"POST",o,void 0,{user_id:t,reason:r})}},{key:"getPushActionsForEvent",value:function(e){return e.getPushActions()||e.setPushActions(this.pushProcessor.actionsForEvent(e)),e.getPushActions()}},{key:"setProfileInfo",value:function(e,t,n){var r=w.encodeUri("/profile/$userId/$info",{$userId:this.credentials.userId,$info:e});return this.http.authedRequest(n,"PUT",r,void 0,t)}},{key:"setDisplayName",value:function(){var e=s(a.mark((function e(t,n){var r,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setProfileInfo("displayname",{displayname:t},n);case 2:return r=e.sent,(i=this.getUser(this.getUserId()))&&(i.displayName=t,i.emit("User.displayName",i.events.presence,i)),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setAvatarUrl",value:function(){var e=s(a.mark((function e(t,n){var r,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setProfileInfo("avatar_url",{avatar_url:t},n);case 2:return r=e.sent,(i=this.getUser(this.getUserId()))&&(i.avatarUrl=t,i.emit("User.avatarUrl",i.events.presence,i)),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"mxcUrlToHttp",value:function(e,t,n,r,i){return(0,N.getHttpUriForMxc)(this.baseUrl,e,t,n,r,i)}},{key:"_unstable_setStatusMessage",value:function(e){var t=this,n="im.vector.user_status";return Promise.all(this.getRooms().map(function(){var r=s(a.mark((function r(i){var o,s;return a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o="join"===i.getMyMembership(),s=2===i.getInvitedAndJoinedMemberCount(),o&&s){r.next=4;break}return r.abrupt("return");case 4:if(i.currentState.mayClientSendStateEvent(n,t)){r.next=7;break}return r.abrupt("return");case 7:return r.next=9,t.sendStateEvent(i.roomId,n,{status:e},t.getUserId());case 9:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())).then()}},{key:"setPresence",value:function(e,t){var n=w.encodeUri("/presence/$userId/status",{$userId:this.credentials.userId});"string"===typeof e&&(e={presence:e});if(-1===["offline","online","unavailable"].indexOf(e.presence))throw new Error("Bad presence value: "+e.presence);return this.http.authedRequest(t,"PUT",n,void 0,e)}},{key:"getPresence",value:function(e,t){var n=w.encodeUri("/presence/$userId/status",{$userId:e});return this.http.authedRequest(t,"GET",n,void 0,void 0)}},{key:"scrollback",value:function(e,t,n){var r=this;w.isFunction(t)&&(n=t,t=void 0),t=t||30;var i=0,o=this.ongoingScrollbacks[e.roomId]||{};if(o.promise)return o.promise;if(o.errorTs){var a=Date.now()-o.errorTs;i=Math.max(3e3-a,0)}if(null===e.oldState.paginationToken)return Promise.resolve(e);var s=this.store.scrollback(e,t).length;if(s===t)return Promise.resolve(e);t-=s;var u=new Promise((function(o,a){(0,w.sleep)(i).then((function(){return r.createMessagesRequest(e.roomId,e.oldState.paginationToken,t,E.Direction.Backward)})).then((function(t){var i,a=t.chunk.map(r.getEventMapper());if(t.state){var s=t.state.map(r.getEventMapper());e.currentState.setUnknownStateEvents(s)}e.addEventsToTimeline(a,!0,e.getLiveTimeline()),e.oldState.paginationToken=t.end,0===t.chunk.length&&(e.oldState.paginationToken=null),r.store.storeEvents(e,a,t.end,!0),r.ongoingScrollbacks[e.roomId]=null,null===(i=n)||void 0===i||i(null,e),o(e)})).catch((function(t){var i;r.ongoingScrollbacks[e.roomId]={errorTs:Date.now()},null===(i=n)||void 0===i||i(t),a(t)}))}));return o={promise:u,errorTs:null},this.ongoingScrollbacks[e.roomId]=o,u}},{key:"getEventMapper",value:function(e){return(0,W.eventMapperFor)(this,e||{})}},{key:"getEventTimeline",value:function(e,t){var n=this;if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(e.getTimelineForEvent(t))return Promise.resolve(e.getTimelineForEvent(t));var r=w.encodeUri("/rooms/$roomId/context/$eventId",{$roomId:e.room.roomId,$eventId:t}),i=void 0;return this.clientOpts.lazyLoadMembers&&(i={filter:JSON.stringify(b.Filter.LAZY_LOADING_MESSAGES_FILTER)}),this.http.authedRequest(void 0,"GET",r,i).then((function(r){if(!r.event)throw new Error("'event' not in '/context' result - homeserver too old?");if(e.getTimelineForEvent(t))return e.getTimelineForEvent(t);r.events_after.reverse();var i=r.events_after.concat([r.event]).concat(r.events_before).map(n.getEventMapper()),o=e.getTimelineForEvent(i[0].getId());if(o){var a=r.state.map(n.getEventMapper());o.getState(E.EventTimeline.BACKWARDS).setUnknownStateEvents(a)}else(o=e.addTimeline()).initialiseState(r.state.map(n.getEventMapper())),o.getState(E.EventTimeline.FORWARDS).paginationToken=r.end;return e.addEventsToTimeline(i,!0,o,r.start),e.getTimelineForEvent(t)||o}))}},{key:"createMessagesRequest",value:function(e,t,n,r,i){var o=w.encodeUri("/rooms/$roomId/messages",{$roomId:e});void 0===n&&(n=30);var a,s={from:t,limit:n,dir:r},u=null;(this.clientOpts.lazyLoadMembers&&(u=Object.assign({},b.Filter.LAZY_LOADING_MESSAGES_FILTER)),i)&&(u=u||{},Object.assign(u,null===(a=i.getRoomTimelineFilterComponent())||void 0===a?void 0:a.toJSON()));return u&&(s.filter=JSON.stringify(u)),this.http.authedRequest(void 0,"GET",o,s)}},{key:"paginateEventTimeline",value:function(e,t){var n=this,r=e.getTimelineSet()===this.notifTimelineSet,i=(t=t||{}).backwards||!1;if(r&&!i)throw new Error("paginateNotifTimeline can only paginate backwards");var o=i?E.EventTimeline.BACKWARDS:E.EventTimeline.FORWARDS,a=e.getPaginationToken(o);if(!a)return Promise.resolve(!1);var s,u,c=e.paginationRequests[o];if(c)return c;if(r)"/notifications",s={limit:"limit"in t?t.limit:30,only:"highlight"},a&&"end"!==a&&(s.from=a),u=this.http.authedRequest(void 0,"GET","/notifications",s,void 0).then((function(t){for(var r=t.next_token,a=[],s=0;s<t.notifications.length;s++){var u=t.notifications[s],c=n.getEventMapper()(u.event);c.setPushActions(_.PushProcessor.actionListToActionsObject(u.actions)),c.event.room_id=u.room_id,a[s]=c}return e.getTimelineSet().addEventsToTimeline(a,i,e,r),i&&!t.next_token&&e.setPaginationToken(null,o),!!t.next_token})).finally((function(){e.paginationRequests[o]=null})),e.paginationRequests[o]=u;else{if(!this.getRoom(e.getRoomId()))throw new Error("Unknown room "+e.getRoomId());(u=this.createMessagesRequest(e.getRoomId(),a,t.limit,o,e.getFilter())).then((function(t){if(t.state){var r=e.getState(o),a=t.state.map(n.getEventMapper());r.setUnknownStateEvents(a)}var s=t.end,u=t.chunk.map(n.getEventMapper());return e.getTimelineSet().addEventsToTimeline(u,i,e,s),i&&t.end==t.start&&e.setPaginationToken(null,o),t.end!=t.start})).finally((function(){e.paginationRequests[o]=null})),e.paginationRequests[o]=u}return u}},{key:"resetNotifTimelineSet",value:function(){this.notifTimelineSet&&this.notifTimelineSet.resetLiveTimeline("end",null)}},{key:"peekInRoom",value:function(e){return this.peekSync&&this.peekSync.stopPeeking(),this.peekSync=new g.SyncApi(this,this.clientOpts),this.peekSync.peek(e)}},{key:"stopPeeking",value:function(){this.peekSync&&(this.peekSync.stopPeeking(),this.peekSync=null)}},{key:"setGuestAccess",value:function(e,t){var n=this.sendStateEvent(e,V.EventType.RoomGuestAccess,{guest_access:t.allowJoin?"can_join":"forbidden"},""),r=Promise.resolve(void 0);return t.allowRead&&(r=this.sendStateEvent(e,V.EventType.RoomHistoryVisibility,{history_visibility:"world_readable"},"")),Promise.all([r,n]).then()}},{key:"requestRegisterEmailToken",value:function(e,t,n,r){return this.requestTokenFromEndpoint("/register/email/requestToken",{email:e,client_secret:t,send_attempt:n,next_link:r})}},{key:"requestRegisterMsisdnToken",value:function(e,t,n,r,i){return this.requestTokenFromEndpoint("/register/msisdn/requestToken",{country:e,phone_number:t,client_secret:n,send_attempt:r,next_link:i})}},{key:"requestAdd3pidEmailToken",value:function(e,t,n,r){return this.requestTokenFromEndpoint("/account/3pid/email/requestToken",{email:e,client_secret:t,send_attempt:n,next_link:r})}},{key:"requestAdd3pidMsisdnToken",value:function(e,t,n,r,i){return this.requestTokenFromEndpoint("/account/3pid/msisdn/requestToken",{country:e,phone_number:t,client_secret:n,send_attempt:r,next_link:i})}},{key:"requestPasswordEmailToken",value:function(e,t,n,r){return this.requestTokenFromEndpoint("/account/password/email/requestToken",{email:e,client_secret:t,send_attempt:n,next_link:r})}},{key:"requestPasswordMsisdnToken",value:function(e,t,n,r,i){return this.requestTokenFromEndpoint("/account/password/msisdn/requestToken",{country:e,phone_number:t,client_secret:n,send_attempt:r,next_link:i})}},{key:"requestTokenFromEndpoint",value:function(){var e=s(a.mark((function e(t,n){var r,i,o;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object.assign({},n),e.next=3,this.doesServerSupportSeparateAddAndBind();case 3:if(e.t0=!e.sent,!e.t0){e.next=6;break}e.t0=this.idBaseUrl;case 6:if(!e.t0){e.next=19;break}if(i=new URL(this.idBaseUrl),r.id_server=i.host,e.t1=this.identityServer&&this.identityServer.getAccessToken,!e.t1){e.next=14;break}return e.next=13,this.doesServerAcceptIdentityAccessToken();case 13:e.t1=e.sent;case 14:if(!e.t1){e.next=19;break}return e.next=17,this.identityServer.getAccessToken();case 17:(o=e.sent)&&(r.id_access_token=o);case 19:return e.abrupt("return",this.http.request(void 0,"POST",t,void 0,r));case 20:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getRoomPushRule",value:function(e,t){if(!this.pushRules)throw new Error("SyncApi.sync() must be done before accessing to push rules.");for(var n=0;n<this.pushRules[e].room.length;n++){var r=this.pushRules[e].room[n];if(r.rule_id===t)return r}}},{key:"setRoomMutePushRule",value:function(e,t,n){var r,i,o=this,a=this.getRoomPushRule(e,t);if(a&&0<=a.actions.indexOf("dont_notify")&&(i=!0),n?a?i||(r=w.defer(),this.deletePushRule(e,Q.PushRuleKind.RoomSpecific,a.rule_id).then((function(){o.addPushRule(e,Q.PushRuleKind.RoomSpecific,t,{actions:["dont_notify"]}).then((function(){r.resolve()})).catch((function(e){r.reject(e)}))})).catch((function(e){r.reject(e)})),r=r.promise):r=this.addPushRule(e,Q.PushRuleKind.RoomSpecific,t,{actions:["dont_notify"]}):i&&(r=this.deletePushRule(e,Q.PushRuleKind.RoomSpecific,a.rule_id)),r)return new Promise((function(e,t){r.then((function(){o.getPushRules().then((function(t){o.pushRules=t,e()})).catch((function(e){t(e)}))})).catch((function(e){o.getPushRules().then((function(n){o.pushRules=n,t(e)})).catch((function(n){t(e)}))}))}))}},{key:"searchMessageText",value:function(e,t){var n={search_term:e.query};return"keys"in e&&(n.keys=e.keys),this.search({body:{search_categories:{room_events:n}}},t)}},{key:"searchRoomEvents",value:function(e){var t=this,n={search_categories:{room_events:{search_term:e.term,filter:e.filter,order_by:Y.SearchOrderBy.Recent,event_context:{before_limit:1,after_limit:1,include_profile:!0}}}},r={_query:n,results:[],highlights:[]};return this.search({body:n}).then((function(e){return t.processRoomEventsSearch(r,e)}))}},{key:"backPaginateRoomEventsSearch",value:function(e){var t=this;if(!e.next_batch)return Promise.reject(new Error("Cannot backpaginate event search any further"));if(e.pendingRequest)return e.pendingRequest;var n={body:e._query,next_batch:e.next_batch},r=this.search(n).then((function(n){return t.processRoomEventsSearch(e,n)})).finally((function(){e.pendingRequest=null}));return e.pendingRequest=r,r}},{key:"processRoomEventsSearch",value:function(e,t){var n=t.search_categories.room_events;e.count=n.count,e.next_batch=n.next_batch;var r={};n.highlights.forEach((function(e){r[e]=1})),e.highlights.forEach((function(e){r[e]=1})),e.highlights=Object.keys(r);for(var i=n.results?n.results.length:0,o=0;o<i;o++){var a=L.SearchResult.fromJson(n.results[o],this.getEventMapper());e.results.push(a)}return e}},{key:"syncLeftRooms",value:function(){var e=this;if(this.syncedLeftRooms)return Promise.resolve([]);if(this.syncLeftRoomsPromise)return this.syncLeftRoomsPromise;var t=new g.SyncApi(this,this.clientOpts);return this.syncLeftRoomsPromise=t.syncLeftRooms(),this.syncLeftRoomsPromise.then((function(t){O.logger.log("Marking success of sync left room request"),e.syncedLeftRooms=!0})).finally((function(){e.syncLeftRoomsPromise=null})),this.syncLeftRoomsPromise}},{key:"createFilter",value:function(e){var t=this,n=w.encodeUri("/user/$userId/filter",{$userId:this.credentials.userId});return this.http.authedRequest(void 0,"POST",n,void 0,e).then((function(n){var r=b.Filter.fromJson(t.credentials.userId,n.filter_id,e);return t.store.storeFilter(r),r}))}},{key:"getFilter",value:function(e,t,n){var r=this;if(n){var i=this.store.getFilter(e,t);if(i)return Promise.resolve(i)}var o=w.encodeUri("/user/$userId/filter/$filterId",{$userId:e,$filterId:t});return this.http.authedRequest(void 0,"GET",o,void 0,void 0).then((function(n){var i=b.Filter.fromJson(e,t,n);return r.store.storeFilter(i),i}))}},{key:"getOrCreateFilter",value:function(){var e=s(a.mark((function e(t,n){var r,i,o,s,u,c;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.store.getFilterIdByName(t),i=void 0,!r){e.next=15;break}return e.prev=3,e.next=6,this.getFilter(this.credentials.userId,r,!0);case 6:(o=e.sent)&&(s=o.getDefinition(),u=n.getDefinition(),w.deepCompare(s,u)&&(i=r)),e.next=14;break;case 10:if(e.prev=10,e.t0=e.catch(3),"M_UNKNOWN"===e.t0.errcode||"M_NOT_FOUND"===e.t0.errcode){e.next=14;break}throw e.t0;case 14:i||this.store.setFilterIdByName(t,void 0);case 15:if(!i){e.next=17;break}return e.abrupt("return",i);case 17:return e.next=19,this.createFilter(n.getDefinition());case 19:return c=e.sent,this.store.setFilterIdByName(t,c.filterId),e.abrupt("return",c.filterId);case 22:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getOpenIdToken",value:function(){var e=w.encodeUri("/user/$userId/openid/request_token",{$userId:this.credentials.userId});return this.http.authedRequest(void 0,"POST",e,void 0,{})}},{key:"turnServer",value:function(e){return this.http.authedRequest(e,"GET","/voip/turnServer")}},{key:"getTurnServers",value:function(){return this.turnServers||[]}},{key:"getTurnServersExpiry",value:function(){return this.turnServersExpiry}},{key:"checkTurnServers",value:function(){var t=s(a.mark((function t(){var n,r,i,o;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.canSupportVoip){t.next=2;break}return t.abrupt("return");case 2:if(n=!1,!((r=this.turnServersExpiry-Date.now())>se)){t.next=9;break}O.logger.debug("TURN creds are valid for another "+r+" ms: not fetching new ones."),n=!0,t.next=21;break;case 9:return O.logger.debug("Fetching new TURN credentials"),t.prev=10,t.next=13,this.turnServer();case 13:(i=t.sent).uris&&(O.logger.log("Got TURN URIs: "+i.uris+" refresh in "+i.ttl+" secs"),o={urls:i.uris,username:i.username,credential:i.password},this.turnServers=[o],this.turnServersExpiry=Date.now()+1e3*i.ttl,n=!0),t.next=21;break;case 17:t.prev=17,t.t0=t.catch(10),O.logger.error("Failed to get TURN URIs",t.t0),403===t.t0.httpStatus&&(O.logger.info("TURN access unavailable for this account: stopping credentials checks"),null!==this.checkTurnServersIntervalID&&e.clearInterval(this.checkTurnServersIntervalID),this.checkTurnServersIntervalID=null);case 21:return t.abrupt("return",n);case 22:case"end":return t.stop()}}),t,this,[[10,17]])})));return function(){return t.apply(this,arguments)}}()},{key:"setFallbackICEServerAllowed",value:function(e){this.fallbackICEServerAllowed=e}},{key:"isFallbackICEServerAllowed",value:function(){return this.fallbackICEServerAllowed}},{key:"isSynapseAdministrator",value:function(){var e=w.encodeUri("/_synapse/admin/v1/users/$userId/admin",{$userId:this.getUserId()});return this.http.authedRequest(void 0,"GET",e,void 0,void 0,{prefix:""}).then((function(e){return e.admin}))}},{key:"whoisSynapseUser",value:function(e){var t=w.encodeUri("/_synapse/admin/v1/whois/$userId",{$userId:e});return this.http.authedRequest(void 0,"GET",t,void 0,void 0,{prefix:""})}},{key:"deactivateSynapseUser",value:function(e){var t=w.encodeUri("/_synapse/admin/v1/deactivate/$userId",{$userId:e});return this.http.authedRequest(void 0,"POST",t,void 0,void 0,{prefix:""})}},{key:"fetchClientWellKnown",value:function(){var e=s(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.clientWellKnownPromise=x.AutoDiscovery.getRawClientConfig(this.getDomain()),e.next=3,this.clientWellKnownPromise;case 3:this.clientWellKnown=e.sent,this.emit("WellKnown.client",this.clientWellKnown);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getClientWellKnown",value:function(){return this.clientWellKnown}},{key:"waitForClientWellKnown",value:function(){return this.clientWellKnownPromise}},{key:"storeClientOptions",value:function(){var e=["boolean","string","number"],t=Object.entries(this.clientOpts).filter((function(t){var n=o(t,2),r=(n[0],n[1]);return e.includes(typeof r)})).reduce((function(e,t){var n=o(t,2),r=n[0],i=n[1];return e[r]=i,e}),{});return this.store.storeClientOptions(t)}},{key:"_unstable_getSharedRooms",value:function(){var e=s(a.mark((function e(t){var n,r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.doesServerSupportUnstableFeature("uk.half-shot.msc2666");case 2:if(e.sent){e.next=4;break}throw Error("Server does not support shared_rooms API");case 4:return n=w.encodeUri("/uk.half-shot.msc2666/user/shared_rooms/$userId",{$userId:t}),e.next=7,this.http.authedRequest(void 0,"GET",n,void 0,void 0,{prefix:P.PREFIX_UNSTABLE});case 7:return r=e.sent,e.abrupt("return",r.joined);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getVersions",value:function(){var e=this;return this.serverVersionsPromise||(this.serverVersionsPromise=this.http.request(void 0,"GET","/_matrix/client/versions",void 0,void 0,{prefix:""}).catch((function(t){throw e.serverVersionsPromise=null,t}))),this.serverVersionsPromise}},{key:"isVersionSupported",value:function(){var e=s(a.mark((function e(t){var n,r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getVersions();case 2:return n=e.sent,r=n.versions,e.abrupt("return",r&&r.includes(t));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"doesServerSupportLazyLoading",value:function(){var e=s(a.mark((function e(){var t,n,r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getVersions();case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",!1);case 5:return n=t.versions,r=t.unstable_features,e.abrupt("return",n&&n.includes("r0.5.0")||r&&r["m.lazy_load_members"]);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"doesServerRequireIdServerParam",value:function(){var e=s(a.mark((function e(){var t,n,r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getVersions();case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",!0);case 5:if(!(n=t.versions)||!n.includes("r0.6.0")){e.next=8;break}return e.abrupt("return",!1);case 8:if(r=t.unstable_features){e.next=11;break}return e.abrupt("return",!0);case 11:if(void 0!==r["m.require_identity_server"]){e.next=15;break}return e.abrupt("return",!0);case 15:return e.abrupt("return",r["m.require_identity_server"]);case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"doesServerAcceptIdentityAccessToken",value:function(){var e=s(a.mark((function e(){var t,n,r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getVersions();case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",!1);case 5:return n=t.versions,r=t.unstable_features,e.abrupt("return",n&&n.includes("r0.6.0")||r&&r["m.id_access_token"]);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"doesServerSupportSeparateAddAndBind",value:function(){var e=s(a.mark((function e(){var t,n,r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getVersions();case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",!1);case 5:return n=t.versions,r=t.unstable_features,e.abrupt("return",n&&n.includes("r0.6.0")||r&&r["m.separate_add_and_bind"]);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"doesServerSupportUnstableFeature",value:function(){var e=s(a.mark((function e(t){var n,r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getVersions();case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return",!1);case 5:return r=n.unstable_features,e.abrupt("return",r&&!!r[t]);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"doesServerForceEncryptionForPreset",value:function(){var e=s(a.mark((function e(t){var n,r,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getVersions();case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return",!1);case 5:return r=n.unstable_features,i=t.includes("_chat")?t.substring(0,t.indexOf("_chat")):t,e.abrupt("return",r&&!!r["io.element.e2ee_forced.".concat(i)]);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hasLazyLoadMembersEnabled",value:function(){return!!this.clientOpts.lazyLoadMembers}},{key:"setCanResetTimelineCallback",value:function(e){this.canResetTimelineCallback=e}},{key:"getCanResetTimelineCallback",value:function(){return this.canResetTimelineCallback}},{key:"relations",value:function(){var e=s(a.mark((function e(t,n,r,i,o){var s,u,c,l,d,f;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=this.getEncryptedIfNeededEventType(t,i),e.next=3,this.fetchRelations(t,n,r,s,o);case 3:if(u=e.sent,c=this.getEventMapper(),u.original_event&&(l=c(u.original_event)),d=u.chunk.map(c),s!==V.EventType.RoomMessageEncrypted){e.next=12;break}return f=l?d.concat(l):d,e.next=11,Promise.all(f.map((function(e){return new Promise((function(t){return e.once("Event.decrypted",t)}))})));case 11:d=d.filter((function(e){return e.getType()===i}));case 12:return l&&r===V.RelationType.Replace&&(d=d.filter((function(e){return e.getSender()===l.getSender()}))),e.abrupt("return",{originalEvent:l,events:d,nextBatch:u.next_batch});case 14:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}()},{key:"getCrossSigningCacheCallbacks",value:function(){var e;return null===(e=this.crypto)||void 0===e?void 0:e.crossSigningInfo.getCacheCallbacks()}},{key:"generateClientSecret",value:function(){return(0,H.randomString)(32)}},{key:"decryptEventIfNeeded",value:function(e,t){return e.shouldAttemptDecryption()&&e.attemptDecryption(this.crypto,t),e.isBeingDecrypted()?e.getDecryptionPromise():Promise.resolve()}},{key:"termsUrlForService",value:function(e,t){switch(e){case C.SERVICE_TYPES.IS:return t+P.PREFIX_IDENTITY_V2+"/terms";case C.SERVICE_TYPES.IM:return t+"/_matrix/integrations/v1/terms";default:throw new Error("Unsupported service type")}}},{key:"getHomeserverUrl",value:function(){return this.baseUrl}},{key:"getIdentityServerUrl",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e&&(this.idBaseUrl.startsWith("http://")||this.idBaseUrl.startsWith("https://"))?this.idBaseUrl.split("://")[1]:this.idBaseUrl}},{key:"setIdentityServerUrl",value:function(e){this.idBaseUrl=w.ensureNoTrailingSlash(e),this.http.setIdBaseUrl(this.idBaseUrl)}},{key:"getAccessToken",value:function(){return this.http.opts.accessToken||null}},{key:"isLoggedIn",value:function(){return void 0!==this.http.opts.accessToken}},{key:"makeTxnId",value:function(){return"m"+(new Date).getTime()+"."+this.txnCtr++}},{key:"isUsernameAvailable",value:function(e){return this.http.authedRequest(void 0,"GET","/register/available",{username:e}).then((function(e){return e.available}))}},{key:"register",value:function(e,t,n,r,i,o,a,s){!0===i?i={email:!0}:null!==i&&void 0!==i&&!1!==i||(i={}),"function"===typeof a&&(s=a,a=void 0),n&&(r.session=n);var u={auth:r};return void 0!==e&&null!==e&&(u.username=e),void 0!==t&&null!==t&&(u.password=t),i.email&&(u.bind_email=!0),i.msisdn&&(u.bind_msisdn=!0),void 0!==o&&null!==o&&(u.guest_access_token=o),void 0!==a&&null!==a&&(u.inhibit_login=a),void 0!==t&&null!==t&&(u.x_show_msisdn=!0),this.registerRequest(u,void 0,s)}},{key:"registerGuest",value:function(e,t){return(e=e||{}).body=e.body||{},this.registerRequest(e.body,"guest",t)}},{key:"registerRequest",value:function(e,t,n){var r={};return t&&(r.kind=t),this.http.request(n,"POST","/register",r,e)}},{key:"loginFlows",value:function(e){return this.http.request(e,"GET","/login")}},{key:"login",value:function(e,t,n){var r=this,i={type:e};return w.extend(i,t),this.http.authedRequest((function(e,t){t&&t.access_token&&t.user_id&&(r.http.opts.accessToken=t.access_token,r.credentials={userId:t.user_id}),n&&n(e,t)}),"POST","/login",void 0,i)}},{key:"loginWithPassword",value:function(e,t,n){return this.login("m.login.password",{user:e,password:t},n)}},{key:"loginWithSAML2",value:function(e,t){return this.login("m.login.saml2",{relay_state:e},t)}},{key:"getCasLoginUrl",value:function(e){return this.getSsoLoginUrl(e,"cas")}},{key:"getSsoLoginUrl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sso",n=arguments.length>2?arguments[2]:void 0,r="/login/"+t+"/redirect";return n&&(r+="/"+n),this.http.getUrl(r,{redirectUrl:e},P.PREFIX_R0)}},{key:"loginWithToken",value:function(e,t){return this.login("m.login.token",{token:e},t)}},{key:"logout",value:function(e){return this.http.authedRequest(e,"POST","/logout")}},{key:"deactivateAccount",value:function(e,t){if("function"===typeof t)throw new Error("deactivateAccount no longer accepts a callback parameter");var n={};return e&&(n.auth=e),void 0!==t&&(n.erase=t),this.http.authedRequest(void 0,"POST","/account/deactivate",void 0,n)}},{key:"getFallbackAuthUrl",value:function(e,t){var n=w.encodeUri("/auth/$loginType/fallback/web",{$loginType:e});return this.http.getUrl(n,{session:t},P.PREFIX_R0)}},{key:"createRoom",value:function(){var e=s(a.mark((function e(t,n){var r,o,s,u;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(t.invite_3pid||[]).filter((function(e){return!e.id_access_token})),e.t0=r.length>0&&this.identityServer&&this.identityServer.getAccessToken,!e.t0){e.next=6;break}return e.next=5,this.doesServerAcceptIdentityAccessToken();case 5:e.t0=e.sent;case 6:if(!e.t0){e.next=11;break}return e.next=9,this.identityServer.getAccessToken();case 9:if(o=e.sent){s=i(r);try{for(s.s();!(u=s.n()).done;)u.value.id_access_token=o}catch(a){s.e(a)}finally{s.f()}}case 11:return e.abrupt("return",this.http.authedRequest(n,"POST","/createRoom",void 0,t));case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fetchRelations",value:function(){var e=s(a.mark((function e(t,n,r,i,o){var s,u,c;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={},o.from&&(s.from=o.from),u=w.encodeParams(s),c=w.encodeUri("/rooms/$roomId/relations/$eventId/$relationType/$eventType?"+u,{$roomId:t,$eventId:n,$relationType:r,$eventType:i}),e.next=6,this.http.authedRequest(void 0,"GET",c,null,null,{prefix:P.PREFIX_UNSTABLE});case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}()},{key:"roomState",value:function(e,t){var n=w.encodeUri("/rooms/$roomId/state",{$roomId:e});return this.http.authedRequest(t,"GET",n)}},{key:"fetchRoomEvent",value:function(e,t,n){var r=w.encodeUri("/rooms/$roomId/event/$eventId",{$roomId:e,$eventId:t});return this.http.authedRequest(n,"GET",r)}},{key:"members",value:function(e,t,n,r,i){var o={};t&&(o.membership=t),n&&(o.not_membership=n),r&&(o.at=r);var a=w.encodeParams(o),s=w.encodeUri("/rooms/$roomId/members?"+a,{$roomId:e});return this.http.authedRequest(i,"GET",s)}},{key:"upgradeRoom",value:function(e,t){var n=w.encodeUri("/rooms/$roomId/upgrade",{$roomId:e});return this.http.authedRequest(void 0,"POST",n,void 0,{new_version:t})}},{key:"getStateEvent",value:function(e,t,n,r){var i={$roomId:e,$eventType:t,$stateKey:n},o=w.encodeUri("/rooms/$roomId/state/$eventType",i);return void 0!==n&&(o=w.encodeUri(o+"/$stateKey",i)),this.http.authedRequest(r,"GET",o)}},{key:"sendStateEvent",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4?arguments[4]:void 0,o={$roomId:e,$eventType:t,$stateKey:r},a=w.encodeUri("/rooms/$roomId/state/$eventType",o);return void 0!==r&&(a=w.encodeUri(a+"/$stateKey",o)),this.http.authedRequest(i,"PUT",a,void 0,n)}},{key:"roomInitialSync",value:function(e,t,n){w.isFunction(t)&&(n=t,t=void 0);var r=w.encodeUri("/rooms/$roomId/initialSync",{$roomId:e});return t||(t=30),this.http.authedRequest(n,"GET",r,{limit:t})}},{key:"setRoomReadMarkersHttpRequest",value:function(e,t,n,r){var i=w.encodeUri("/rooms/$roomId/read_markers",{$roomId:e}),o={"m.fully_read":t,"m.read":n,"org.matrix.msc2285.hidden":Boolean(!!r&&r.hidden)};return this.http.authedRequest(void 0,"POST",i,void 0,o)}},{key:"getJoinedRooms",value:function(){var e=w.encodeUri("/joined_rooms",{});return this.http.authedRequest(void 0,"GET",e)}},{key:"getJoinedRoomMembers",value:function(e){var t=w.encodeUri("/rooms/$roomId/joined_members",{$roomId:e});return this.http.authedRequest(void 0,"GET",t)}},{key:"publicRooms",value:function(e,t){"function"==typeof e&&(t=e,e={}),void 0===e&&(e={});var n={};return e.server&&(n.server=e.server,delete e.server),0===Object.keys(e).length&&0===Object.keys(n).length?this.http.authedRequest(t,"GET","/publicRooms"):this.http.authedRequest(t,"POST","/publicRooms",n,e)}},{key:"createAlias",value:function(e,t,n){var r=w.encodeUri("/directory/room/$alias",{$alias:e}),i={room_id:t};return this.http.authedRequest(n,"PUT",r,void 0,i)}},{key:"deleteAlias",value:function(e,t){var n=w.encodeUri("/directory/room/$alias",{$alias:e});return this.http.authedRequest(t,"DELETE",n,void 0,void 0)}},{key:"unstableGetLocalAliases",value:function(e,t){var n=w.encodeUri("/rooms/$roomId/aliases",{$roomId:e}),r=P.PREFIX_UNSTABLE+"/org.matrix.msc2432";return this.http.authedRequest(t,"GET",n,null,null,{prefix:r})}},{key:"getRoomIdForAlias",value:function(e,t){var n=w.encodeUri("/directory/room/$alias",{$alias:e});return this.http.authedRequest(t,"GET",n)}},{key:"resolveRoomAlias",value:function(e,t){var n=w.encodeUri("/directory/room/$alias",{$alias:e});return this.http.request(t,"GET",n)}},{key:"getRoomDirectoryVisibility",value:function(e,t){var n=w.encodeUri("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(t,"GET",n)}},{key:"setRoomDirectoryVisibility",value:function(e,t,n){var r=w.encodeUri("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(n,"PUT",r,void 0,{visibility:t})}},{key:"setRoomDirectoryVisibilityAppService",value:function(e,t,n,r){var i=w.encodeUri("/directory/list/appservice/$networkId/$roomId",{$networkId:e,$roomId:t});return this.http.authedRequest(r,"PUT",i,void 0,{visibility:n})}},{key:"searchUserDirectory",value:function(e){var t={search_term:e.term};return void 0!==e.limit&&(t.limit=e.limit),this.http.authedRequest(void 0,"POST","/user_directory/search",void 0,t)}},{key:"uploadContent",value:function(e,t){return this.http.uploadContent(e,t)}},{key:"cancelUpload",value:function(e){return this.http.cancelUpload(e)}},{key:"getCurrentUploads",value:function(){return this.http.getCurrentUploads()}},{key:"getProfileInfo",value:function(e,t,n){w.isFunction(t)&&(n=t,t=void 0);var r=t?w.encodeUri("/profile/$userId/$info",{$userId:e,$info:t}):w.encodeUri("/profile/$userId",{$userId:e});return this.http.authedRequest(n,"GET",r)}},{key:"getThreePids",value:function(e){return this.http.authedRequest(e,"GET","/account/3pid",void 0,void 0)}},{key:"addThreePid",value:function(e,t,n){var r={threePidCreds:e,bind:t};return this.http.authedRequest(n,"POST","/account/3pid",null,r)}},{key:"addThreePidOnly",value:function(){var e=s(a.mark((function e(t){var n,r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="/account/3pid/add",e.next=3,this.isVersionSupported("r0.6.0");case 3:if(!e.sent){e.next=7;break}e.t0=P.PREFIX_R0,e.next=8;break;case 7:e.t0=P.PREFIX_UNSTABLE;case 8:return r=e.t0,e.abrupt("return",this.http.authedRequest(void 0,"POST",n,null,t,{prefix:r}));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"bindThreePid",value:function(){var e=s(a.mark((function e(t){var n,r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="/account/3pid/bind",e.next=3,this.isVersionSupported("r0.6.0");case 3:if(!e.sent){e.next=7;break}e.t0=P.PREFIX_R0,e.next=8;break;case 7:e.t0=P.PREFIX_UNSTABLE;case 8:return r=e.t0,e.abrupt("return",this.http.authedRequest(void 0,"POST",n,null,t,{prefix:r}));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"unbindThreePid",value:function(){var e=s(a.mark((function e(t,n){var r,i,o;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="/account/3pid/unbind",i={medium:t,address:n,id_server:this.getIdentityServerUrl(!0)},e.next=4,this.isVersionSupported("r0.6.0");case 4:if(!e.sent){e.next=8;break}e.t0=P.PREFIX_R0,e.next=9;break;case 8:e.t0=P.PREFIX_UNSTABLE;case 9:return o=e.t0,e.abrupt("return",this.http.authedRequest(void 0,"POST",r,null,i,{prefix:o}));case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteThreePid",value:function(e,t){return this.http.authedRequest(void 0,"POST","/account/3pid/delete",null,{medium:e,address:t})}},{key:"setPassword",value:function(e,t,n){var r={auth:e,new_password:t};return this.http.authedRequest(n,"POST","/account/password",null,r)}},{key:"getDevices",value:function(){return this.http.authedRequest(void 0,"GET","/devices",void 0,void 0)}},{key:"getDevice",value:function(e){var t=w.encodeUri("/devices/$device_id",{$device_id:e});return this.http.authedRequest(void 0,"GET",t,void 0,void 0)}},{key:"setDeviceDetails",value:function(e,t){var n=w.encodeUri("/devices/$device_id",{$device_id:e});return this.http.authedRequest(void 0,"PUT",n,void 0,t)}},{key:"deleteDevice",value:function(e,t){var n=w.encodeUri("/devices/$device_id",{$device_id:e}),r={};return t&&(r.auth=t),this.http.authedRequest(void 0,"DELETE",n,void 0,r)}},{key:"deleteMultipleDevices",value:function(e,t){var n={devices:e};t&&(n.auth=t);return this.http.authedRequest(void 0,"POST","/delete_devices",void 0,n)}},{key:"getPushers",value:function(e){return this.http.authedRequest(e,"GET","/pushers",void 0,void 0)}},{key:"setPusher",value:function(e,t){return this.http.authedRequest(t,"POST","/pushers/set",null,e)}},{key:"getPushRules",value:function(e){return this.http.authedRequest(e,"GET","/pushrules/").then((function(e){return _.PushProcessor.rewriteDefaultRules(e)}))}},{key:"addPushRule",value:function(e,t,n,r,i){var o=w.encodeUri("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:n});return this.http.authedRequest(i,"PUT",o,void 0,r)}},{key:"deletePushRule",value:function(e,t,n,r){var i=w.encodeUri("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:n});return this.http.authedRequest(r,"DELETE",i)}},{key:"setPushRuleEnabled",value:function(e,t,n,r,i){var o=w.encodeUri("/pushrules/"+e+"/$kind/$ruleId/enabled",{$kind:t,$ruleId:n});return this.http.authedRequest(i,"PUT",o,void 0,{enabled:r})}},{key:"setPushRuleActions",value:function(e,t,n,r,i){var o=w.encodeUri("/pushrules/"+e+"/$kind/$ruleId/actions",{$kind:t,$ruleId:n});return this.http.authedRequest(i,"PUT",o,void 0,{actions:r})}},{key:"search",value:function(e,t){var n={};return e.next_batch&&(n.next_batch=e.next_batch),this.http.authedRequest(t,"POST","/search",n,e.body)}},{key:"uploadKeysRequest",value:function(e,t,n){return this.http.authedRequest(n,"POST","/keys/upload",void 0,e)}},{key:"uploadKeySignatures",value:function(e){return this.http.authedRequest(void 0,"POST","/keys/signatures/upload",void 0,e,{prefix:P.PREFIX_UNSTABLE})}},{key:"downloadKeysForUsers",value:function(e,t){if(w.isFunction(t))throw new Error("downloadKeysForUsers no longer accepts a callback parameter");var n={device_keys:{}};return"token"in(t=t||{})&&(n.token=t.token),e.forEach((function(e){n.device_keys[e]=[]})),this.http.authedRequest(void 0,"POST","/keys/query",void 0,n)}},{key:"claimOneTimeKeys",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"signed_curve25519",n=arguments.length>2?arguments[2]:void 0,r={};void 0===t&&(t="signed_curve25519");for(var i=0;i<e.length;++i){var o=e[i][0],a=e[i][1],s=r[o]||{};r[o]=s,s[a]=t}var u={one_time_keys:r};n&&(u.timeout=n);var c="/keys/claim";return this.http.authedRequest(void 0,"POST",c,void 0,u)}},{key:"getKeyChanges",value:function(e,t){var n={from:e,to:t};return this.http.authedRequest(void 0,"GET","/keys/changes",n,void 0)}},{key:"uploadDeviceSigningKeys",value:function(e,t){var n=Object.assign({},t);return e&&Object.assign(n,{auth:e}),this.http.authedRequest(void 0,"POST","/keys/device_signing/upload",void 0,n,{prefix:P.PREFIX_UNSTABLE})}},{key:"registerWithIdentityServer",value:function(e){if(!this.idBaseUrl)throw new Error("No identity server base URL set");var t=this.idBaseUrl+P.PREFIX_IDENTITY_V2+"/account/register";return this.http.requestOtherUrl(void 0,"POST",t,null,e)}},{key:"requestEmailToken",value:function(){var e=s(a.mark((function e(t,n,r,i,o,s){var u;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u={client_secret:n,email:t,send_attempt:r,next_link:i},e.next=3,this.http.idServerRequest(o,"POST","/validate/email/requestToken",u,P.PREFIX_IDENTITY_V2,s);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o,a){return e.apply(this,arguments)}}()},{key:"requestMsisdnToken",value:function(){var e=s(a.mark((function e(t,n,r,i,o,s,u){var c;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c={client_secret:r,country:t,phone_number:n,send_attempt:i,next_link:o},e.next=3,this.http.idServerRequest(s,"POST","/validate/msisdn/requestToken",c,P.PREFIX_IDENTITY_V2,u);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o,a,s){return e.apply(this,arguments)}}()},{key:"submitMsisdnToken",value:function(){var e=s(a.mark((function e(t,n,r,i){var o;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={sid:t,client_secret:n,token:r},e.next=3,this.http.idServerRequest(void 0,"POST","/validate/msisdn/submitToken",o,P.PREFIX_IDENTITY_V2,i);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"submitMsisdnTokenOtherUrl",value:function(e,t,n,r){var i={sid:t,client_secret:n,token:r};return this.http.requestOtherUrl(void 0,"POST",e,void 0,i)}},{key:"getIdentityHashDetails",value:function(e){return this.http.idServerRequest(void 0,"GET","/hash_details",null,P.PREFIX_IDENTITY_V2,e)}},{key:"identityHashedLookup",value:function(){var t=s(a.mark((function t(n,r){var i,o,s,u,c,l,d,f,h,p,v;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i={},t.next=3,this.getIdentityHashDetails(r);case 3:if((o=t.sent)&&o.lookup_pepper&&o.algorithms){t.next=6;break}throw new Error("Unsupported identity server: bad response");case 6:if(i.pepper=o.lookup_pepper,s={},!o.algorithms.includes("sha256")){t.next=14;break}u=new e.Olm.Utility,i.addresses=n.map((function(e){var t=e[0].toLowerCase(),n=e[1].toLowerCase(),r=u.sha256("".concat(t," ").concat(n," ").concat(i.pepper)).replace(/\+/g,"-").replace(/\//g,"_");return s[r]=e[0],r})),i.algorithm="sha256",t.next=20;break;case 14:if(!o.algorithms.includes("none")){t.next=19;break}i.addresses=n.map((function(e){var t=e[0].toLowerCase(),n=e[1].toLowerCase(),r="".concat(t," ").concat(n);return s[r]=e[0],r})),i.algorithm="none",t.next=20;break;case 19:throw new Error("Unsupported identity server: unknown hash algorithm");case 20:return t.next=22,this.http.idServerRequest(void 0,"POST","/lookup",i,P.PREFIX_IDENTITY_V2,r);case 22:if((c=t.sent)&&c.mappings){t.next=25;break}return t.abrupt("return",[]);case 25:l=[],d=0,f=Object.keys(c.mappings);case 27:if(!(d<f.length)){t.next=37;break}if(h=f[d],p=c.mappings[h],v=s[h]){t.next=33;break}throw new Error("Identity server returned more results than expected");case 33:l.push({address:v,mxid:p});case 34:d++,t.next=27;break;case 37:return t.abrupt("return",l);case 38:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"lookupThreePid",value:function(){var e=s(a.mark((function e(t,n,r,i){var o,s,u;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.identityHashedLookup([[n,t]],i);case 2:if(o=e.sent,s=o.find((function(e){return e.address===n}))){e.next=7;break}return r&&r(null,{}),e.abrupt("return",{});case 7:return u={address:n,medium:t,mxid:s.mxid},r&&r(null,u),e.abrupt("return",u);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"bulkLookupThreePids",value:function(){var e=s(a.mark((function e(t,n){var r,o,s,u,c;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.identityHashedLookup(t.map((function(e){return[e[1],e[0]]})),n);case 2:r=e.sent,o=[],s=i(r);try{for(c=function(){var e=u.value,n=t.find((function(t){return t[1]===e.address}));if(!n)throw new Error("Identity sever returned unexpected results");o.push([n[0],e.address,e.mxid])},s.s();!(u=s.n()).done;)c()}catch(a){s.e(a)}finally{s.f()}return e.abrupt("return",{threepids:o});case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getIdentityAccount",value:function(e){return this.http.idServerRequest(void 0,"GET","/account",void 0,P.PREFIX_IDENTITY_V2,e)}},{key:"sendToDevice",value:function(e,t,n){var r=w.encodeUri("/sendToDevice/$eventType/$txnId",{$eventType:e,$txnId:n||this.makeTxnId()}),i={messages:t},o=Object.keys(t).reduce((function(e,n){return e[n]=Object.keys(t[n]),e}),{});return O.logger.log("PUT ".concat(r),o),this.http.authedRequest(void 0,"PUT",r,void 0,i)}},{key:"getThirdpartyProtocols",value:function(){return this.http.authedRequest(void 0,"GET","/thirdparty/protocols",void 0,void 0).then((function(e){if(!e||"object"!==typeof e)throw new Error("/thirdparty/protocols did not return an object: ".concat(e));return e}))}},{key:"getThirdpartyLocation",value:function(e,t){var n=w.encodeUri("/thirdparty/location/$protocol",{$protocol:e});return this.http.authedRequest(void 0,"GET",n,t,void 0)}},{key:"getThirdpartyUser",value:function(e,t){var n=w.encodeUri("/thirdparty/user/$protocol",{$protocol:e});return this.http.authedRequest(void 0,"GET",n,t,void 0)}},{key:"getTerms",value:function(e,t){var n=this.termsUrlForService(e,t);return this.http.requestOtherUrl(void 0,"GET",n)}},{key:"agreeToTerms",value:function(e,t,n,r){var i=this.termsUrlForService(e,t),o={Authorization:"Bearer "+n};return this.http.requestOtherUrl(void 0,"POST",i,null,{user_accepts:r},{headers:o})}},{key:"reportEvent",value:function(e,t,n,r){var i=w.encodeUri("/rooms/$roomId/report/$eventId",{$roomId:e,$eventId:t});return this.http.authedRequest(void 0,"POST",i,null,{score:n,reason:r})}},{key:"getSpaceSummary",value:function(e,t,n,r,i,o){var a=w.encodeUri("/rooms/$roomId/spaces",{$roomId:e});return this.http.authedRequest(void 0,"POST",a,null,{max_rooms_per_space:t,suggested_only:n,auto_join_only:r,limit:i,batch:o},{prefix:"/_matrix/client/unstable/org.matrix.msc2946"})}},{key:"getRoomHierarchy",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4?arguments[4]:void 0,a=w.encodeUri("/rooms/$roomId/hierarchy",{$roomId:e});return this.http.authedRequest(void 0,"GET",a,{suggested_only:i,max_depth:n,from:o,limit:t},void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc2946"}).catch((function(n){if("M_UNRECOGNIZED"===n.errcode)return r.getSpaceSummary(e,void 0,i,void 0,t).then((function(e){var t=e.rooms,n=e.events,r=new Map(t.map((function(e){return[e.room_id,te(te({},e),{},{children_state:[]})]})));return n.forEach((function(e){var t;null===(t=r.get(e.room_id))||void 0===t||t.children_state.push(e)})),{rooms:Array.from(r.values())}}));throw n}))}},{key:"unstableCreateFileTree",value:function(){var e=s(a.mark((function e(t){var n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.createRoom({name:t,preset:G.Preset.PrivateChat,power_level_content_override:te(te({},z.DEFAULT_TREE_POWER_LEVELS_TEMPLATE),{},{users:r({},this.getUserId(),100)}),creation_content:r({},V.RoomCreateTypeField,V.RoomType.Space),initial_state:[{type:V.UNSTABLE_MSC3088_PURPOSE.name,state_key:V.UNSTABLE_MSC3089_TREE_SUBTYPE.name,content:r({},V.UNSTABLE_MSC3088_ENABLED.name,!0)},{type:V.EventType.RoomEncryption,state_key:"",content:{algorithm:I.MEGOLM_ALGORITHM}}]});case 2:return n=e.sent,i=n.room_id,e.abrupt("return",new z.MSC3089TreeSpace(this,i));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"unstableGetFileTreeSpace",value:function(e){var t,n,r=this.getRoom(e);if("join"!==(null===r||void 0===r?void 0:r.getMyMembership()))return null;var i=r.currentState.getStateEvents(V.EventType.RoomCreate,""),o=r.currentState.getStateEvents(V.UNSTABLE_MSC3088_PURPOSE.name,V.UNSTABLE_MSC3089_TREE_SUBTYPE.name);if(!i)throw new Error("Expected single room create event");return null!==o&&void 0!==o&&null!==(t=o.getContent())&&void 0!==t&&t[V.UNSTABLE_MSC3088_ENABLED.name]?(null===(n=i.getContent())||void 0===n?void 0:n[V.RoomCreateTypeField])!==V.RoomType.Space?null:new z.MSC3089TreeSpace(this,e):null}},{key:"getGroupSummary",value:function(e){var t=w.encodeUri("/groups/$groupId/summary",{$groupId:e});return this.http.authedRequest(void 0,"GET",t)}},{key:"getGroupProfile",value:function(e){var t=w.encodeUri("/groups/$groupId/profile",{$groupId:e});return this.http.authedRequest(void 0,"GET",t)}},{key:"setGroupProfile",value:function(e,t){var n=w.encodeUri("/groups/$groupId/profile",{$groupId:e});return this.http.authedRequest(void 0,"POST",n,void 0,t)}},{key:"setGroupJoinPolicy",value:function(e,t){var n=w.encodeUri("/groups/$groupId/settings/m.join_policy",{$groupId:e});return this.http.authedRequest(void 0,"PUT",n,void 0,{"m.join_policy":t})}},{key:"getGroupUsers",value:function(e){var t=w.encodeUri("/groups/$groupId/users",{$groupId:e});return this.http.authedRequest(void 0,"GET",t)}},{key:"getGroupInvitedUsers",value:function(e){var t=w.encodeUri("/groups/$groupId/invited_users",{$groupId:e});return this.http.authedRequest(void 0,"GET",t)}},{key:"getGroupRooms",value:function(e){var t=w.encodeUri("/groups/$groupId/rooms",{$groupId:e});return this.http.authedRequest(void 0,"GET",t)}},{key:"inviteUserToGroup",value:function(e,t){var n=w.encodeUri("/groups/$groupId/admin/users/invite/$userId",{$groupId:e,$userId:t});return this.http.authedRequest(void 0,"PUT",n,void 0,{})}},{key:"removeUserFromGroup",value:function(e,t){var n=w.encodeUri("/groups/$groupId/admin/users/remove/$userId",{$groupId:e,$userId:t});return this.http.authedRequest(void 0,"PUT",n,void 0,{})}},{key:"addUserToGroupSummary",value:function(e,t,n){var r=w.encodeUri(n?"/groups/$groupId/summary/$roleId/users/$userId":"/groups/$groupId/summary/users/$userId",{$groupId:e,$roleId:n,$userId:t});return this.http.authedRequest(void 0,"PUT",r,void 0,{})}},{key:"removeUserFromGroupSummary",value:function(e,t){var n=w.encodeUri("/groups/$groupId/summary/users/$userId",{$groupId:e,$userId:t});return this.http.authedRequest(void 0,"DELETE",n,void 0,{})}},{key:"addRoomToGroupSummary",value:function(e,t,n){var r=w.encodeUri(n?"/groups/$groupId/summary/$categoryId/rooms/$roomId":"/groups/$groupId/summary/rooms/$roomId",{$groupId:e,$categoryId:n,$roomId:t});return this.http.authedRequest(void 0,"PUT",r,void 0,{})}},{key:"removeRoomFromGroupSummary",value:function(e,t){var n=w.encodeUri("/groups/$groupId/summary/rooms/$roomId",{$groupId:e,$roomId:t});return this.http.authedRequest(void 0,"DELETE",n,void 0,{})}},{key:"addRoomToGroup",value:function(e,t,n){void 0===n&&(n=!0);var r=w.encodeUri("/groups/$groupId/admin/rooms/$roomId",{$groupId:e,$roomId:t});return this.http.authedRequest(void 0,"PUT",r,void 0,{"m.visibility":{type:n?"public":"private"}})}},{key:"updateGroupRoomVisibility",value:function(e,t,n){var r=w.encodeUri("/groups/$groupId/admin/rooms/$roomId/config/m.visibility",{$groupId:e,$roomId:t});return this.http.authedRequest(void 0,"PUT",r,void 0,{type:n?"public":"private"})}},{key:"removeRoomFromGroup",value:function(e,t){var n=w.encodeUri("/groups/$groupId/admin/rooms/$roomId",{$groupId:e,$roomId:t});return this.http.authedRequest(void 0,"DELETE",n,void 0,{})}},{key:"acceptGroupInvite",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=w.encodeUri("/groups/$groupId/self/accept_invite",{$groupId:e});return this.http.authedRequest(void 0,"PUT",n,void 0,t||{})}},{key:"joinGroup",value:function(e){var t=w.encodeUri("/groups/$groupId/self/join",{$groupId:e});return this.http.authedRequest(void 0,"PUT",t,void 0,{})}},{key:"leaveGroup",value:function(e){var t=w.encodeUri("/groups/$groupId/self/leave",{$groupId:e});return this.http.authedRequest(void 0,"PUT",t,void 0,{})}},{key:"getJoinedGroups",value:function(){var e=w.encodeUri("/joined_groups",{});return this.http.authedRequest(void 0,"GET",e)}},{key:"createGroup",value:function(e){var t=w.encodeUri("/create_group",{});return this.http.authedRequest(void 0,"POST",t,void 0,e)}},{key:"getPublicisedGroups",value:function(e){var t=w.encodeUri("/publicised_groups",{});return this.http.authedRequest(void 0,"POST",t,void 0,{user_ids:e})}},{key:"setGroupPublicity",value:function(e,t){var n=w.encodeUri("/groups/$groupId/self/update_publicity",{$groupId:e});return this.http.authedRequest(void 0,"PUT",n,void 0,{publicise:t})}},{key:"supportsExperimentalThreads",value:function(){var e;return(null===(e=this.clientOpts)||void 0===e?void 0:e.experimentalThreadSupport)||!1}}]),h}(v.EventEmitter);t.MatrixClient=ue,(0,p.default)(ue,"RESTORE_BACKUP_ERROR_BAD_KEY","RESTORE_BACKUP_ERROR_BAD_KEY")}).call(this,n(14))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getHttpUriForMxc=function(e,t,n,i,o){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if("string"!==typeof t||!t)return"";if(0!==t.indexOf("mxc://"))return a?t:"";var s=t.slice(6),u="/_matrix/media/r0/download/",c={};n&&(c.width=Math.round(n));i&&(c.height=Math.round(i));o&&(c.method=o);Object.keys(c).length>0&&(u="/_matrix/media/r0/thumbnail/");var l=s.indexOf("#"),d="";l>=0&&(d=s.substr(l),s=s.substr(0,l));var f=0===Object.keys(c).length?"":"?"+r.encodeParams(c);return e+u+s+f+d};var r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=i(t);if(n&&n.has(e))return n.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(12));function i(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(i=function(e){return e?n:t})(e)}},function(e,t,n){"use strict";var r=n(8),i=n(0),o=n(2),a=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.ReEmitter=void 0;var s=a(n(3)),u=function(){function e(t){i(this,e),(0,s.default)(this,"target",void 0),this.target=t}return o(e,[{key:"reEmit",value:function(e,t){var n,i=this,o=r(t);try{var a=function(){var t=n.value;e.on(t,(function(){var n;if("error"!==t||0!==i.target.listenerCount("error")){for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];(n=i.target).emit.apply(n,[t].concat(o,[e]))}}))};for(o.s();!(n=o.n()).done;)a()}catch(s){o.e(s)}finally{o.f()}}}]),e}();t.ReEmitter=u},function(e,t,n){"use strict";var r=n(0),i=n(9),o=n(10),a=n(25);function s(e,t){var n="Store is invalid because ".concat(e,", ")+"please stop the client, delete all data and start the client again",r=Reflect.construct(Error,[n]);return Reflect.setPrototypeOf(r,Reflect.getPrototypeOf(this)),r.reason=e,r.value=t,r}function u(e){var t="Crypto store is invalid because ".concat(e,", ")+"please stop the client, delete all data and start the client again",n=Reflect.construct(Error,[t]);return Reflect.setPrototypeOf(n,Reflect.getPrototypeOf(this)),n.reason=e,n.name="InvalidCryptoStoreError",n}Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidStoreError=s,t.InvalidCryptoStoreError=u,t.KeySignatureUploadError=void 0,s.TOGGLED_LAZY_LOADING="TOGGLED_LAZY_LOADING",s.prototype=Object.create(Error.prototype,{constructor:{value:Error,enumerable:!1,writable:!0,configurable:!0}}),Reflect.setPrototypeOf(s,Error),u.TOO_NEW="TOO_NEW",u.prototype=Object.create(Error.prototype,{constructor:{value:Error,enumerable:!1,writable:!0,configurable:!0}}),Reflect.setPrototypeOf(u,Error);var c=function(e){i(n,e);var t=o(n);function n(e,i){var o;return r(this,n),(o=t.call(this,e)).value=i,o}return n}(a(Error));t.KeySignatureUploadError=c},function(e,t,n){"use strict";for(var r=/[\\\"\x00-\x1F]/g,i={},o=0;o<32;++o)i[String.fromCharCode(o)]="\\U"+("0000"+o.toString(16)).slice(-4).toUpperCase();function a(e){return r.lastIndex=0,e.replace(r,(function(e){return i[e]}))}function s(e){switch(typeof e){case"string":return'"'+a(e)+'"';case"number":return isFinite(e)?e:"null";case"boolean":return e;case"object":return null===e?"null":Array.isArray(e)?function(e){for(var t="[",n="",r=0;r<e.length;++r)n+=t,t=",",n+=s(e[r]);return","!=t?"[]":n+"]"}(e):function(e){var t="{",n="",r=Object.keys(e);r.sort();for(var i=0;i<r.length;++i){var o=r[i];n+=t+'"'+a(o)+'":',t=",",n+=s(e[o])}return","!=t?"{}":n+"}"}(e);default:throw new Error("Cannot stringify: "+typeof e)}}i["\b"]="\\b",i["\t"]="\\t",i["\n"]="\\n",i["\f"]="\\f",i["\r"]="\\r",i['"']='\\"',i["\\"]="\\\\",e.exports={stringify:s}},function(e,t,n){"use strict";var r=n(0),i=n(2),o=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.DeviceInfo=void 0;var a,s=o(n(3));!function(e){e[e.Blocked=-1]="Blocked",e[e.Unverified=0]="Unverified",e[e.Verified=1]="Verified"}(a||(a={}));var u=function(){function e(t){r(this,e),this.deviceId=t,(0,s.default)(this,"algorithms",void 0),(0,s.default)(this,"keys",{}),(0,s.default)(this,"verified",a.Unverified),(0,s.default)(this,"known",!1),(0,s.default)(this,"unsigned",{}),(0,s.default)(this,"signatures",{})}return i(e,[{key:"toStorage",value:function(){return{algorithms:this.algorithms,keys:this.keys,verified:this.verified,known:this.known,unsigned:this.unsigned,signatures:this.signatures}}},{key:"getFingerprint",value:function(){return this.keys["ed25519:"+this.deviceId]}},{key:"getIdentityKey",value:function(){return this.keys["curve25519:"+this.deviceId]}},{key:"getDisplayName",value:function(){return this.unsigned.device_display_name||null}},{key:"isBlocked",value:function(){return this.verified==a.Blocked}},{key:"isVerified",value:function(){return this.verified==a.Verified}},{key:"isUnverified",value:function(){return this.verified==a.Unverified}},{key:"isKnown",value:function(){return!0===this.known}}],[{key:"fromStorage",value:function(t,n){var r=new e(n);for(var i in t)t.hasOwnProperty(i)&&(r[i]=t[i]);return r}}]),e}();t.DeviceInfo=u,(0,s.default)(u,"DeviceVerification",{VERIFIED:a.Verified,UNVERIFIED:a.Unverified,BLOCKED:a.Blocked})},function(e,t,n){"use strict";(function(e,r){var i=n(8),o=n(13),a=n(16),s=n(6),u=n(7),c=n(0),l=n(2),d=n(11),f=n(9),h=n(10),p=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.createCryptoStoreCacheCallbacks=function(e,t){return{getCrossSigningKeyCache:function(){var n=u(s.mark((function n(i,o){var a,u,c;return s.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,new Promise((function(t){return e.doTxn("readonly",[k.IndexedDBCryptoStore.STORE_ACCOUNT],(function(n){e.getSecretStorePrivateKey(n,t,i)}))}));case 2:if(!(a=n.sent)||!a.ciphertext){n.next=11;break}return u=r.from(t.pickleKey),n.next=7,(0,b.decryptAES)(a,u,i);case 7:return c=n.sent,n.abrupt("return",(0,y.decodeBase64)(c));case 11:return n.abrupt("return",a);case 12:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}(),storeCrossSigningKeyCache:function(){var n=u(s.mark((function n(i,o){var a,u;return s.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o instanceof Uint8Array){n.next=2;break}throw new Error("storeCrossSigningKeyCache expects Uint8Array, got ".concat(o));case 2:return a=r.from(t.pickleKey),n.next=5,(0,b.encryptAES)((0,y.encodeBase64)(o),a,i);case 5:return u=n.sent,n.abrupt("return",e.doTxn("readwrite",[k.IndexedDBCryptoStore.STORE_ACCOUNT],(function(t){e.storeSecretStorePrivateKey(t,i,u)})));case 7:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()}},t.requestKeysDuringVerification=function(e,t,n){if(e.getUserId()!==t)return;return m.logger.log("Cross-signing: Self-verification done; requesting keys"),new Promise((function(t,r){var i=e,o=i.crypto.crossSigningInfo,a=new E(o.userId,{getCrossSigningKey:function(){var e=u(s.mark((function e(t){var r,o,a,u;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.logger.debug("Cross-signing: requesting secret",t,n),r=i.requestSecret("m.cross_signing.".concat(t),[n]),o=r.promise,e.next=4,o;case 4:return a=e.sent,u=(0,y.decodeBase64)(a),e.abrupt("return",Uint8Array.from(u));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},o.getCacheCallbacks());a.keys=o.keys;var c=new Promise((function(e){setTimeout(e,6e4,new Error("Timeout"))})),l=u(s.mark((function e(){var t,r,o,a;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.crypto.getSessionBackupPrivateKey();case 2:if(e.sent){e.next=19;break}return m.logger.info("No cached backup key found. Requesting..."),t=i.requestSecret("m.megolm_backup.v1",[n]),e.next=8,t.promise;case 8:return r=e.sent,m.logger.info("Got key backup key, decoding..."),o=(0,y.decodeBase64)(r),m.logger.info("Decoded backup key, storing..."),e.next=14,i.crypto.storeSessionBackupPrivateKey(Uint8Array.from(o));case 14:return m.logger.info("Backup key stored. Starting backup restore..."),e.next=17,i.getKeyBackupVersion();case 17:a=e.sent,i.restoreKeyBackupWithCache(void 0,void 0,a).then((function(){m.logger.info("Backup restored.")}));case 19:case"end":return e.stop()}}),e)})))();return Promise.race([Promise.all([a.getCrossSigningKey("master"),a.getCrossSigningKey("self_signing"),a.getCrossSigningKey("user_signing"),l]),c]).then(t,r)})).catch((function(e){m.logger.warn("Cross-signing: failure while requesting keys:",e)}))},t.DeviceTrustLevel=t.UserTrustLevel=t.CrossSigningLevel=t.CrossSigningInfo=void 0;var v=p(n(3)),g=n(15),y=n(19),m=n(5),k=n(22),b=n(33);function S(e){return Object.values(e.keys)[0]}var w,E=function(t){f(r,t);var n=h(r);function r(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return c(this,r),(t=n.call(this)).userId=e,t.callbacks=i,t.cacheCallbacks=o,(0,v.default)(d(t),"keys",{}),(0,v.default)(d(t),"firstUse",!0),(0,v.default)(d(t),"crossSigningVerifiedBefore",!1),t}return l(r,[{key:"toStorage",value:function(){return{keys:this.keys,firstUse:this.firstUse,crossSigningVerifiedBefore:this.crossSigningVerifiedBefore}}},{key:"getCrossSigningKey",value:function(){var t=u(s.mark((function t(n,r){var i,o,a,u,c;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=function(t){if(t){var n=new e.Olm.PkSigning,i=n.init_with_seed(t);if(i===r)return[i,n];n.free()}},i=["master","self_signing","user_signing"].indexOf(n)>=0,this.callbacks.getCrossSigningKey){t.next=4;break}throw new Error("No getCrossSigningKey callback supplied");case 4:if(void 0===r&&(r=this.getId(n)),!this.cacheCallbacks.getCrossSigningKeyCache||!i){t.next=9;break}return t.next=8,this.cacheCallbacks.getCrossSigningKeyCache(n,r);case 8:a=t.sent;case 9:if(!(u=o(a))){t.next=12;break}return t.abrupt("return",u);case 12:return t.next=14,this.callbacks.getCrossSigningKey(n,r);case 14:if(a=t.sent,!(c=o(a))){t.next=21;break}if(!this.cacheCallbacks.storeCrossSigningKeyCache||!i){t.next=20;break}return t.next=20,this.cacheCallbacks.storeCrossSigningKeyCache(n,a);case 20:return t.abrupt("return",c);case 21:if(a){t.next=23;break}throw new Error("getCrossSigningKey callback for "+n+" returned falsey");case 23:throw new Error("Key type "+n+" from getCrossSigningKey callback did not match");case 24:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"isStoredInSecretStorage",value:function(){var e=u(s.mark((function e(t){var n,r,i,o,a;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(e){for(var t=0,r=Object.keys(n);t<r.length;t++){var i=r[t];e[i]||delete n[i]}},e.next=3,t.isStored("m.cross_signing.master",!1);case 3:if(e.t0=e.sent,e.t0){e.next=6;break}e.t0={};case 6:n=e.t0,i=0,o=["self_signing","user_signing"];case 8:if(!(i<o.length)){e.next=21;break}return a=o[i],e.t1=r,e.next=13,t.isStored("m.cross_signing.".concat(a),!1);case 13:if(e.t2=e.sent,e.t2){e.next=16;break}e.t2={};case 16:e.t3=e.t2,(0,e.t1)(e.t3);case 18:i++,e.next=8;break;case 21:return e.abrupt("return",Object.keys(n).length?n:null);case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"isStoredInKeyCache",value:function(){var e=u(s.mark((function e(t){var n,r,i,o;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.cacheCallbacks){e.next=3;break}return e.abrupt("return",!1);case 3:r=0,i=t?[t]:["master","self_signing","user_signing"];case 5:if(!(r<i.length)){e.next=14;break}return o=i[r],e.next=9,n.getCrossSigningKeyCache(o);case 9:if(e.sent){e.next=11;break}return e.abrupt("return",!1);case 11:r++,e.next=5;break;case 14:return e.abrupt("return",!0);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getCrossSigningKeysFromCache",value:function(){var e=u(s.mark((function e(){var t,n,r,i,o,a;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=new Map,n=this.cacheCallbacks){e.next=4;break}return e.abrupt("return",t);case 4:r=0,i=["master","self_signing","user_signing"];case 5:if(!(r<i.length)){e.next=16;break}return o=i[r],e.next=9,n.getCrossSigningKeyCache(o);case 9:if(a=e.sent){e.next=12;break}return e.abrupt("continue",13);case 12:t.set(o,a);case 13:r++,e.next=5;break;case 16:return e.abrupt("return",t);case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getId",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"master";if(!this.keys[e])return null;var t=this.keys[e];return S(t)}},{key:"resetKeys",value:function(){var t=u(s.mark((function t(n){var r,i,u,c,l,d,f,h,p,v;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.callbacks.saveCrossSigningKeys){t.next=2;break}throw new Error("No saveCrossSigningKeys callback supplied");case 2:if(!(void 0===n||n&w.MASTER)&&this.keys.master){t.next=6;break}n=w.MASTER|w.USER_SIGNING|w.SELF_SIGNING,t.next=8;break;case 6:if(0!==n){t.next=8;break}return t.abrupt("return");case 8:if(r={},i={},t.prev=10,!(n&w.MASTER)){t.next=18;break}u=new e.Olm.PkSigning,r.master=u.generate_seed(),c=u.init_with_seed(r.master),i.master={user_id:this.userId,usage:["master"],keys:a({},"ed25519:"+c,c)},t.next=24;break;case 18:return t.next=20,this.getCrossSigningKey("master");case 20:l=t.sent,d=o(l,2),c=d[0],u=d[1];case 24:if(n&w.SELF_SIGNING){f=new e.Olm.PkSigning;try{r.self_signing=f.generate_seed(),h=f.init_with_seed(r.self_signing),i.self_signing={user_id:this.userId,usage:["self_signing"],keys:a({},"ed25519:"+h,h)},(0,y.pkSign)(i.self_signing,u,this.userId,c)}finally{f.free()}}if(n&w.USER_SIGNING){p=new e.Olm.PkSigning;try{r.user_signing=p.generate_seed(),v=p.init_with_seed(r.user_signing),i.user_signing={user_id:this.userId,usage:["user_signing"],keys:a({},"ed25519:"+v,v)},(0,y.pkSign)(i.user_signing,u,this.userId,c)}finally{p.free()}}Object.assign(this.keys,i),this.callbacks.saveCrossSigningKeys(r);case 28:return t.prev=28,u&&u.free(),t.finish(28);case 31:case"end":return t.stop()}}),t,this,[[10,,28,31]])})));return function(e){return t.apply(this,arguments)}}()},{key:"clearKeys",value:function(){this.keys={}}},{key:"setKeys",value:function(e){var t={};if(e.master){if(e.master.user_id!==this.userId){var n="Mismatched user ID "+e.master.user_id+" in master key from "+this.userId;throw m.logger.error(n),new Error(n)}this.keys.master?S(e.master)!==this.getId()&&(this.firstUse=!1):this.firstUse=!0,t.master=e.master}else{if(!this.keys.master)throw new Error("Tried to set cross-signing keys without a master key");t.master=this.keys.master}var r=S(t.master);if(e.user_signing){if(e.user_signing.user_id!==this.userId){var i="Mismatched user ID "+e.master.user_id+" in user_signing key from "+this.userId;throw m.logger.error(i),new Error(i)}try{(0,y.pkVerify)(e.user_signing,r,this.userId)}catch(a){throw m.logger.error("invalid signature on user-signing key"),a}}if(e.self_signing){if(e.self_signing.user_id!==this.userId){var o="Mismatched user ID "+e.master.user_id+" in self_signing key from "+this.userId;throw m.logger.error(o),new Error(o)}try{(0,y.pkVerify)(e.self_signing,r,this.userId)}catch(a){throw m.logger.error("invalid signature on self-signing key"),a}}e.master&&(this.keys.master=e.master,this.keys.self_signing=null,this.keys.user_signing=null),e.self_signing&&(this.keys.self_signing=e.self_signing),e.user_signing&&(this.keys.user_signing=e.user_signing)}},{key:"updateCrossSigningVerifiedBefore",value:function(e){!this.crossSigningVerifiedBefore&&e&&(this.crossSigningVerifiedBefore=!0)}},{key:"signObject",value:function(){var e=u(s.mark((function e(t,n){var r,i,a,u;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.keys[n]){e.next=2;break}throw new Error("Attempted to sign with "+n+" key but no such key present");case 2:return e.next=4,this.getCrossSigningKey(n);case 4:return r=e.sent,i=o(r,2),a=i[0],u=i[1],e.prev=8,(0,y.pkSign)(t,u,this.userId,a),e.abrupt("return",t);case 11:return e.prev=11,u.free(),e.finish(11);case 14:case"end":return e.stop()}}),e,this,[[8,,11,14]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"signUser",value:function(){var e=u(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.keys.user_signing){e.next=3;break}return m.logger.info("No user signing key: not signing user"),e.abrupt("return");case 3:return e.abrupt("return",this.signObject(t.keys.master,"user_signing"));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"signDevice",value:function(){var e=u(s.mark((function e(t,n){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t===this.userId){e.next=2;break}throw new Error("Trying to sign ".concat(t,"'s device; can only sign our own device"));case 2:if(this.keys.self_signing){e.next=5;break}return m.logger.info("No self signing key: not signing device"),e.abrupt("return");case 5:return e.abrupt("return",this.signObject({algorithms:n.algorithms,keys:n.keys,device_id:n.deviceId,user_id:t},"self_signing"));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"checkUserTrust",value:function(e){if(this.userId===e.userId&&this.getId()&&this.getId()===e.getId()&&this.getId("self_signing")&&this.getId("self_signing")===e.getId("self_signing"))return new _(!0,!0,this.firstUse);if(!this.keys.user_signing)return new _(!1,!1,e.firstUse);var t,n=e.keys.master,r=this.getId("user_signing");try{(0,y.pkVerify)(n,r,this.userId),t=!0}catch(i){t=!1}return new _(t,e.crossSigningVerifiedBefore,e.firstUse)}},{key:"checkDeviceTrust",value:function(e,t,n,r){var i=this.checkUserTrust(e),o=e.keys.self_signing;if(!o)return new x(!1,!1,n,r);var a=function(e,t){return{algorithms:e.algorithms,keys:e.keys,device_id:e.deviceId,user_id:t,signatures:e.signatures}}(t,e.userId);try{return(0,y.pkVerify)(o,e.getId(),e.userId),(0,y.pkVerify)(a,S(o),e.userId),x.fromUserTrustLevel(i,n,r)}catch(s){return new x(!1,!1,n,r)}}},{key:"getCacheCallbacks",value:function(){return this.cacheCallbacks}}],[{key:"fromStorage",value:function(e,t){var n=new r(t);for(var i in e)e.hasOwnProperty(i)&&(n[i]=e[i]);return n}},{key:"storeInSecretStorage",value:function(){var e=u(s.mark((function e(t,n){var r,a,u,c,l,d;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=i(t),e.prev=1,r.s();case 3:if((a=r.n()).done){e.next=10;break}return u=o(a.value,2),c=u[0],l=u[1],d=(0,y.encodeBase64)(l),e.next=8,n.store("m.cross_signing.".concat(c),d);case 8:e.next=3;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[1,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getFromSecretStorage",value:function(){var e=u(s.mark((function e(t,n){var r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.get("m.cross_signing.".concat(t));case 2:if(r=e.sent){e.next=5;break}return e.abrupt("return",null);case 5:return e.abrupt("return",(0,y.decodeBase64)(r));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),r}(g.EventEmitter);t.CrossSigningInfo=E,t.CrossSigningLevel=w,function(e){e[e.MASTER=4]="MASTER",e[e.USER_SIGNING=2]="USER_SIGNING",e[e.SELF_SIGNING=1]="SELF_SIGNING"}(w||(t.CrossSigningLevel=w={}));var _=function(){function e(t,n,r){c(this,e),this.crossSigningVerified=t,this.crossSigningVerifiedBefore=n,this.tofu=r}return l(e,[{key:"isVerified",value:function(){return this.isCrossSigningVerified()}},{key:"isCrossSigningVerified",value:function(){return this.crossSigningVerified}},{key:"wasCrossSigningVerified",value:function(){return this.crossSigningVerifiedBefore}},{key:"isTofu",value:function(){return this.tofu}}]),e}();t.UserTrustLevel=_;var x=function(){function e(t,n,r,i){c(this,e),this.crossSigningVerified=t,this.tofu=n,this.localVerified=r,this.trustCrossSignedDevices=i}return l(e,[{key:"isVerified",value:function(){return Boolean(this.isLocallyVerified()||this.trustCrossSignedDevices&&this.isCrossSigningVerified())}},{key:"isCrossSigningVerified",value:function(){return this.crossSigningVerified}},{key:"isLocallyVerified",value:function(){return this.localVerified}},{key:"isTofu",value:function(){return this.tofu}}],[{key:"fromUserTrustLevel",value:function(t,n,r){return new e(t.isCrossSigningVerified(),t.isTofu(),n,r)}}]),e}();t.DeviceTrustLevel=x}).call(this,n(14),n(24).Buffer)},function(e,t,n){"use strict";var r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;function a(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(i){return!1}}()?Object.assign:function(e,t){for(var n,s,u=a(e),c=1;c<arguments.length;c++){for(var l in n=Object(arguments[c]))i.call(n,l)&&(u[l]=n[l]);if(r){s=r(n);for(var d=0;d<s.length;d++)o.call(n,s[d])&&(u[s[d]]=n[s[d]])}}return u}},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var r={request:!0,getRequest:!0,wrapRequest:!0,setCryptoStoreFactory:!0,createClient:!0,ContentHelpers:!0,createNewMatrixCall:!0};t.request=function(e){O=e},t.getRequest=function(){return O},t.wrapRequest=function(e){var t=O;O=function(n,r){return e(t,n,r)}},t.setCryptoStoreFactory=function(e){D=e},t.createClient=function(t){"string"===typeof t&&(t={baseUrl:t});return t.request=t.request||O,t.store=t.store||new o.MemoryStore({localStorage:e.localStorage}),t.scheduler=t.scheduler||new a.MatrixScheduler,t.cryptoStore=t.cryptoStore||D(),new s.MatrixClient(t)},Object.defineProperty(t,"createNewMatrixCall",{enumerable:!0,get:function(){return C.createNewMatrixCall}}),t.ContentHelpers=void 0;var i=n(45);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}));var o=n(67);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===o[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}}))}));var a=n(113);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}));var s=n(36);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===s[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}}))}));var u=n(53);Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===u[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}}))}));var c=n(78);Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===c[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}}))}));var l=n(51);Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===l[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}}))}));var d=n(39);Object.keys(d).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===d[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}}))}));var f=n(18);Object.keys(f).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===f[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}}))}));var h=n(69);Object.keys(h).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===h[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return h[e]}}))}));var p=n(74);Object.keys(p).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===p[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return p[e]}}))}));var v=n(23);Object.keys(v).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===v[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return v[e]}}))}));var g=n(48);Object.keys(g).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===g[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return g[e]}}))}));var y=n(49);Object.keys(y).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===y[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return y[e]}}))}));var m=n(70);Object.keys(m).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===m[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return m[e]}}))}));var k=n(31);Object.keys(k).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===k[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return k[e]}}))}));var b=n(50);Object.keys(b).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===b[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return b[e]}}))}));var S=n(159);Object.keys(S).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===S[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return S[e]}}))}));var w=n(160);Object.keys(w).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===w[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return w[e]}}))}));var E=n(80);Object.keys(E).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===E[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return E[e]}}))}));var _=n(161);Object.keys(_).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===_[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return _[e]}}))}));var x=n(164);Object.keys(x).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===x[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return x[e]}}))}));var I=n(22);Object.keys(I).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===I[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return I[e]}}))}));var T=n(37);Object.keys(T).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===T[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return T[e]}}))}));var R=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=P(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}r.default=e,n&&n.set(e,r);return r}(n(87));t.ContentHelpers=R;var O,C=n(52);function P(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(P=function(e){return e?n:t})(e)}var D=function(){return new i.MemoryCryptoStore}}).call(this,n(14))},function(e,t,n){"use strict";var r=n(16),i=n(13),o=n(8),a=n(6),s=n(7),u=n(0),c=n(2),l=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.MemoryCryptoStore=void 0;var d=l(n(3)),f=n(5),h=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=p(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}r.default=e,n&&n.set(e,r);return r}(n(12));function p(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(p=function(e){return e?n:t})(e)}function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){(0,d.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var y=function(){function e(){u(this,e),(0,d.default)(this,"outgoingRoomKeyRequests",[]),(0,d.default)(this,"account",null),(0,d.default)(this,"crossSigningKeys",null),(0,d.default)(this,"privateKeys",{}),(0,d.default)(this,"sessions",{}),(0,d.default)(this,"sessionProblems",{}),(0,d.default)(this,"notifiedErrorDevices",{}),(0,d.default)(this,"inboundGroupSessions",{}),(0,d.default)(this,"inboundGroupSessionsWithheld",{}),(0,d.default)(this,"deviceData",null),(0,d.default)(this,"rooms",{}),(0,d.default)(this,"sessionsNeedingBackup",{}),(0,d.default)(this,"sharedHistoryInboundGroupSessions",{})}return c(e,[{key:"startup",value:function(){var e=s(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"deleteAllData",value:function(){return Promise.resolve()}},{key:"getOrAddOutgoingRoomKeyRequest",value:function(e){var t=this,n=e.requestBody;return h.promiseTry((function(){var r=t._getOutgoingRoomKeyRequest(n);return r?(f.logger.log("already have key request outstanding for "+"".concat(n.room_id," / ").concat(n.session_id,": ")+"not sending another"),r):(f.logger.log("enqueueing key request for ".concat(n.room_id," / ")+n.session_id),t.outgoingRoomKeyRequests.push(e),e)}))}},{key:"getOutgoingRoomKeyRequest",value:function(e){return Promise.resolve(this._getOutgoingRoomKeyRequest(e))}},{key:"_getOutgoingRoomKeyRequest",value:function(e){var t,n=o(this.outgoingRoomKeyRequests);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(h.deepCompare(r.requestBody,e))return r}}catch(i){n.e(i)}finally{n.f()}return null}},{key:"getOutgoingRoomKeyRequestByState",value:function(e){var t,n=o(this.outgoingRoomKeyRequests);try{for(n.s();!(t=n.n()).done;){var r,i=t.value,a=o(e);try{for(a.s();!(r=a.n()).done;){var s=r.value;if(i.state===s)return Promise.resolve(i)}}catch(u){a.e(u)}finally{a.f()}}}catch(u){n.e(u)}finally{n.f()}return Promise.resolve(null)}},{key:"getAllOutgoingRoomKeyRequestsByState",value:function(e){return Promise.resolve(this.outgoingRoomKeyRequests.filter((function(t){return t.state==e})))}},{key:"getOutgoingRoomKeyRequestsByTarget",value:function(e,t,n){var r,i=[],a=o(this.outgoingRoomKeyRequests);try{for(a.s();!(r=a.n()).done;){var s,u=r.value,c=o(n);try{for(c.s();!(s=c.n()).done;){var l=s.value;u.state===l&&u.recipients.includes({userId:e,deviceId:t})&&i.push(u)}}catch(d){c.e(d)}finally{c.f()}}}catch(d){a.e(d)}finally{a.f()}return Promise.resolve(i)}},{key:"updateOutgoingRoomKeyRequest",value:function(e,t,n){var r,i=o(this.outgoingRoomKeyRequests);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a.requestId===e)return a.state!==t?(f.logger.warn("Cannot update room key request from ".concat(t," ")+"as it was already updated to ".concat(a.state)),Promise.resolve(null)):(Object.assign(a,n),Promise.resolve(a))}}catch(s){i.e(s)}finally{i.f()}return Promise.resolve(null)}},{key:"deleteOutgoingRoomKeyRequest",value:function(e,t){for(var n=0;n<this.outgoingRoomKeyRequests.length;n++){var r=this.outgoingRoomKeyRequests[n];if(r.requestId===e)return r.state!=t?(f.logger.warn("Cannot delete room key request in state ".concat(r.state," ")+"(expected ".concat(t,")")),Promise.resolve(null)):(this.outgoingRoomKeyRequests.splice(n,1),Promise.resolve(r))}return Promise.resolve(null)}},{key:"getAccount",value:function(e,t){t(this.account)}},{key:"storeAccount",value:function(e,t){this.account=t}},{key:"getCrossSigningKeys",value:function(e,t){t(this.crossSigningKeys)}},{key:"getSecretStorePrivateKey",value:function(e,t,n){t(this.privateKeys[n]||null)}},{key:"storeCrossSigningKeys",value:function(e,t){this.crossSigningKeys=t}},{key:"storeSecretStorePrivateKey",value:function(e,t,n){this.privateKeys[t]=n}},{key:"countEndToEndSessions",value:function(e,t){t(Object.keys(this.sessions).length)}},{key:"getEndToEndSession",value:function(e,t,n,r){r((this.sessions[e]||{})[t]||null)}},{key:"getEndToEndSessions",value:function(e,t,n){n(this.sessions[e]||{})}},{key:"getAllEndToEndSessions",value:function(e,t){Object.entries(this.sessions).forEach((function(e){var n=i(e,2),r=n[0],o=n[1];Object.entries(o).forEach((function(e){var n=i(e,2),o=n[0],a=n[1];t(g(g({},a),{},{deviceKey:r,sessionId:o}))}))}))}},{key:"storeEndToEndSession",value:function(e,t,n,r){var i=this.sessions[e];void 0===i&&(i={},this.sessions[e]=i),i[t]=n}},{key:"storeEndToEndSessionProblem",value:function(){var e=s(a.mark((function e(t,n,r){var i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(i=this.sessionProblems[t]=this.sessionProblems[t]||[]).push({type:n,fixed:r,time:Date.now()}),i.sort((function(e,t){return e.time-t.time}));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getEndToEndSessionProblem",value:function(){var e=s(a.mark((function e(t,n){var r,i,s,u,c;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=this.sessionProblems[t]||[]).length){e.next=3;break}return e.abrupt("return",null);case 3:i=r[r.length-1],s=o(r),e.prev=5,s.s();case 7:if((u=s.n()).done){e.next=13;break}if(!((c=u.value).time>n)){e.next=11;break}return e.abrupt("return",Object.assign({},c,{fixed:i.fixed}));case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),s.e(e.t0);case 18:return e.prev=18,s.f(),e.finish(18);case 21:if(!i.fixed){e.next=25;break}return e.abrupt("return",null);case 25:return e.abrupt("return",i);case 26:case"end":return e.stop()}}),e,this,[[5,15,18,21]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"filterOutNotifiedErrorDevices",value:function(){var e=s(a.mark((function e(t){var n,i,s,u,c,l,d;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.notifiedErrorDevices,i=[],s=o(t);try{for(s.s();!(u=s.n()).done;)c=u.value,l=c.userId,d=c.deviceInfo,l in n?d.deviceId in n[l]||(i.push(c),n[l][d.deviceId]=!0):(i.push(c),n[l]=r({},d.deviceId,!0))}catch(a){s.e(a)}finally{s.f()}return e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getEndToEndInboundGroupSession",value:function(e,t,n,r){var i=e+"/"+t;r(this.inboundGroupSessions[i]||null,this.inboundGroupSessionsWithheld[i]||null)}},{key:"getAllEndToEndInboundGroupSessions",value:function(e,t){for(var n=0,r=Object.keys(this.inboundGroupSessions);n<r.length;n++){var i=r[n];t({senderKey:i.substr(0,43),sessionId:i.substr(44),sessionData:this.inboundGroupSessions[i]})}t(null)}},{key:"addEndToEndInboundGroupSession",value:function(e,t,n,r){var i=e+"/"+t;void 0===this.inboundGroupSessions[i]&&(this.inboundGroupSessions[i]=n)}},{key:"storeEndToEndInboundGroupSession",value:function(e,t,n,r){this.inboundGroupSessions[e+"/"+t]=n}},{key:"storeEndToEndInboundGroupSessionWithheld",value:function(e,t,n,r){var i=e+"/"+t;this.inboundGroupSessionsWithheld[i]=n}},{key:"getEndToEndDeviceData",value:function(e,t){t(this.deviceData)}},{key:"storeEndToEndDeviceData",value:function(e,t){this.deviceData=e}},{key:"storeEndToEndRoom",value:function(e,t,n){this.rooms[e]=t}},{key:"getEndToEndRooms",value:function(e,t){t(this.rooms)}},{key:"getSessionsNeedingBackup",value:function(e){var t=[];for(var n in this.sessionsNeedingBackup)if(this.inboundGroupSessions[n]&&(t.push({senderKey:n.substr(0,43),sessionId:n.substr(44),sessionData:this.inboundGroupSessions[n]}),e&&n.length>=e))break;return Promise.resolve(t)}},{key:"countSessionsNeedingBackup",value:function(){return Promise.resolve(Object.keys(this.sessionsNeedingBackup).length)}},{key:"unmarkSessionsNeedingBackup",value:function(e){var t,n=o(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.senderKey+"/"+r.sessionId;delete this.sessionsNeedingBackup[i]}}catch(a){n.e(a)}finally{n.f()}return Promise.resolve()}},{key:"markSessionsNeedingBackup",value:function(e){var t,n=o(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.senderKey+"/"+r.sessionId;this.sessionsNeedingBackup[i]=!0}}catch(a){n.e(a)}finally{n.f()}return Promise.resolve()}},{key:"addSharedHistoryInboundGroupSession",value:function(e,t,n){var r=this.sharedHistoryInboundGroupSessions[e]||[];r.push([t,n]),this.sharedHistoryInboundGroupSessions[e]=r}},{key:"getSharedHistoryInboundGroupSessions",value:function(e){return Promise.resolve(this.sharedHistoryInboundGroupSessions[e]||[])}},{key:"doTxn",value:function(e,t,n){return Promise.resolve(n(null))}}]),e}();t.MemoryCryptoStore=y},function(e,t,n){var r=n(63);e.exports=function(e,t){if(e){if("string"===typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}},function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,r)}e.exports=n},function(e,t,n){"use strict";var r=n(0),i=n(2),o=n(11),a=n(9),s=n(10),u=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.EventTimelineSet=t.DuplicateStrategy=void 0;var c,l,d=u(n(3)),f=n(15),h=n(23),p=n(18),v=n(5),g=n(116);c=v.logger.log.bind(v.logger),t.DuplicateStrategy=l,function(e){e.Ignore="ignore",e.Replace="replace"}(l||(t.DuplicateStrategy=l={}));var y=function(e){a(n,e);var t=s(n);function n(e,i){var a;return r(this,n),(a=t.call(this)).room=e,(0,d.default)(o(a),"timelineSupport",void 0),(0,d.default)(o(a),"unstableClientRelationAggregation",void 0),(0,d.default)(o(a),"liveTimeline",void 0),(0,d.default)(o(a),"timelines",void 0),(0,d.default)(o(a),"_eventIdToTimeline",void 0),(0,d.default)(o(a),"filter",void 0),(0,d.default)(o(a),"relations",void 0),a.timelineSupport=Boolean(i.timelineSupport),a.liveTimeline=new h.EventTimeline(o(a)),a.unstableClientRelationAggregation=!!i.unstableClientRelationAggregation,a.timelines=[a.liveTimeline],a._eventIdToTimeline={},a.filter=i.filter,a.unstableClientRelationAggregation&&(a.relations={}),a}return i(n,[{key:"getTimelines",value:function(){return this.timelines}},{key:"getFilter",value:function(){return this.filter}},{key:"setFilter",value:function(e){this.filter=e}},{key:"getPendingEvents",value:function(){return this.room?this.filter?this.filter.filterRoomTimeline(this.room.getPendingEvents()):this.room.getPendingEvents():[]}},{key:"getLiveTimeline",value:function(){return this.liveTimeline}},{key:"eventIdToTimeline",value:function(e){return this._eventIdToTimeline[e]}},{key:"replaceEventId",value:function(e,t){var n=this._eventIdToTimeline[e];n&&(delete this._eventIdToTimeline[e],this._eventIdToTimeline[t]=n)}},{key:"resetLiveTimeline",value:function(e,t){var n=!this.timelineSupport||!t,r=this.liveTimeline,i=n?r.forkLive(h.EventTimeline.FORWARDS):r.fork(h.EventTimeline.FORWARDS);n?(this.timelines=[i],this._eventIdToTimeline={}):this.timelines.push(i),t&&r.setPaginationToken(t,h.EventTimeline.FORWARDS),i.setPaginationToken(e,h.EventTimeline.BACKWARDS),this.liveTimeline=i,this.emit("Room.timelineReset",this.room,this,n)}},{key:"getTimelineForEvent",value:function(e){var t=this._eventIdToTimeline[e];return void 0===t?null:t}},{key:"findEventById",value:function(e){var t=this.getTimelineForEvent(e);if(t)return t.getEvents().find((function(t){return t.getId()==e}))}},{key:"addTimeline",value:function(){if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");var e=new h.EventTimeline(this);return this.timelines.push(e),e}},{key:"addEventsToTimeline",value:function(e,t,n,r){if(!n)throw new Error("'timeline' not specified for EventTimelineSet.addEventsToTimeline");if(!t&&n==this.liveTimeline)throw new Error("EventTimelineSet.addEventsToTimeline cannot be used for adding events to the live timeline - use Room.addLiveEvents instead");if(!this.filter||(e=this.filter.filterRoomTimeline(e)).length){for(var i=t?h.EventTimeline.BACKWARDS:h.EventTimeline.FORWARDS,o=t?h.EventTimeline.FORWARDS:h.EventTimeline.BACKWARDS,a=!1,s=!1,u=0;u<e.length;u++){var l=e[u],d=l.getId(),f=this._eventIdToTimeline[d];if(f)if(s=!1,f!=n){var p=n.getNeighbouringTimeline(i);if(p)c(f==p?"Event "+d+" in neighbouring timeline - switching to "+f:"Event "+d+" already in a different timeline "+f),n=f;else{v.logger.info("Already have timeline for "+d+" - joining timeline "+n+" to "+f);var g=f===this.liveTimeline,y=n===this.liveTimeline,m=i===h.EventTimeline.BACKWARDS&&g,k=i===h.EventTimeline.FORWARDS&&y;m||k?(m&&v.logger.warn("Refusing to set a preceding existingTimeLine on our timeline as the existingTimeLine is live ("+f+")"),k&&v.logger.warn("Refusing to set our preceding timeline on a existingTimeLine as our timeline is live ("+n+")")):(n.setNeighbouringTimeline(f,i),f.setNeighbouringTimeline(n,o),n=f,a=!0)}}else c("Event "+d+" already in timeline "+n);else this.addEventToTimeline(l,n,t),s=!0,a=!0}if(s||!a){if(i===h.EventTimeline.FORWARDS&&n===this.liveTimeline)return v.logger.warn({lastEventWasNew:s,didUpdate:a}),void v.logger.warn("Refusing to set forwards pagination token of live timeline "+"".concat(n," to ").concat(r));n.setPaginationToken(r,i)}}}},{key:"addLiveEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l.Ignore,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;if(this.filter){var i=this.filter.filterRoomTimeline([e]);if(!i.length)return}var o=this._eventIdToTimeline[e.getId()];if(o)if(t===l.Replace){c("EventTimelineSet.addLiveEvent: replacing duplicate event "+e.getId());for(var a=o.getEvents(),s=0;s<a.length;s++)if(a[s].getId()===e.getId()){r||(r=o.getState(h.EventTimeline.FORWARDS)),h.EventTimeline.setEventMetadata(e,r,!1),a[s]=e;break}}else c("EventTimelineSet.addLiveEvent: ignoring duplicate event "+e.getId());else this.addEventToTimeline(e,this.liveTimeline,!1,n,r)}},{key:"addEventToTimeline",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0,o=e.getId();t.addEvent(e,n,i),this._eventIdToTimeline[o]=t,this.setRelationsTarget(e),this.aggregateRelations(e);var a={timeline:t,liveEvent:!n&&t==this.liveTimeline&&!r};this.emit("Room.timeline",e,this.room,Boolean(n),!1,a)}},{key:"handleRemoteEcho",value:function(e,t,n){var r=this._eventIdToTimeline[t];r?(delete this._eventIdToTimeline[t],this._eventIdToTimeline[n]=r):this.filter?this.filter.filterRoomTimeline([e]).length&&this.addEventToTimeline(e,this.liveTimeline,!1):this.addEventToTimeline(e,this.liveTimeline,!1)}},{key:"removeEvent",value:function(e){var t=this._eventIdToTimeline[e];if(!t)return null;var n=t.removeEvent(e);if(n){delete this._eventIdToTimeline[e];var r={timeline:t};this.emit("Room.timeline",n,this.room,void 0,!0,r)}return n}},{key:"compareEventOrdering",value:function(e,t){if(e==t)return 0;var n=this._eventIdToTimeline[e],r=this._eventIdToTimeline[t];if(void 0===n)return null;if(void 0===r)return null;if(n===r){for(var i,o,a=n.getEvents(),s=0;s<a.length&&(void 0===i||void 0===o);s++){var u=a[s].getId();u==e&&(i=s),u==t&&(o=s)}return i-o}for(var c=n;c;){if(c===r)return-1;c=c.getNeighbouringTimeline(h.EventTimeline.FORWARDS)}for(c=n;c;){if(c===r)return 1;c=c.getNeighbouringTimeline(h.EventTimeline.BACKWARDS)}return null}},{key:"getRelationsForEvent",value:function(e,t,n){if(!this.unstableClientRelationAggregation)throw new Error("Client-side relation aggregation is disabled");if(!e||!t||!n)throw new Error("Invalid arguments for `getRelationsForEvent`");return((this.relations[e]||{})[t]||{})[n]}},{key:"setRelationsTarget",value:function(e){if(this.unstableClientRelationAggregation){var t=this.relations[e.getId()];if(t)for(var n=0,r=Object.values(t);n<r.length;n++)for(var i=r[n],o=0,a=Object.values(i);o<a.length;o++){a[o].setTargetEvent(e)}}}},{key:"aggregateRelations",value:function(e){var t=this;if(this.unstableClientRelationAggregation&&!e.isRedacted()&&e.status!==p.EventStatus.CANCELLED)if(e.isBeingDecrypted()||e.shouldAttemptDecryption())e.once("Event.decrypted",(function(){t.aggregateRelations(e)}));else{var n=e.getRelation();if(n){var r=n.event_id,i=n.rel_type,o=e.getType(),a=this.relations[r];a||(a=this.relations[r]={});var s=a[i];s||(s=a[i]={});var u,c=s[o];c||(c=s[o]=new g.Relations(i,o,this.room),(u=this.findEventById(r)||this.room.getPendingEvent(r))&&c.setTargetEvent(u)),c.addEvent(e)}}}}]),n}(f.EventEmitter);t.EventTimelineSet=y},function(e,t,n){"use strict";var r=n(0),i=n(2),o=n(11),a=n(9),s=n(10),u=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.RoomMember=void 0;var c=u(n(3)),l=n(15),d=n(37),f=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=h(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}r.default=e,n&&n.set(e,r);return r}(n(12));function h(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(h=function(e){return e?n:t})(e)}var p=function(e){a(n,e);var t=s(n);function n(e,i){var a;return r(this,n),(a=t.call(this)).roomId=e,a.userId=i,(0,c.default)(o(a),"_isOutOfBand",!1),(0,c.default)(o(a),"_modified",void 0),(0,c.default)(o(a),"_requestedProfileInfo",void 0),(0,c.default)(o(a),"typing",!1),(0,c.default)(o(a),"name",void 0),(0,c.default)(o(a),"rawDisplayName",void 0),(0,c.default)(o(a),"powerLevel",0),(0,c.default)(o(a),"powerLevelNorm",0),(0,c.default)(o(a),"user",null),(0,c.default)(o(a),"membership",null),(0,c.default)(o(a),"disambiguate",!1),(0,c.default)(o(a),"events",{member:null}),a.name=i,a.rawDisplayName=i,a.updateModifiedTime(),a}return i(n,[{key:"markOutOfBand",value:function(){this._isOutOfBand=!0}},{key:"isOutOfBand",value:function(){return this._isOutOfBand}},{key:"setMembershipEvent",value:function(e,t){var n=e.getDirectionalContent().displayname;if("m.room.member"===e.getType()){this._isOutOfBand=!1,this.events.member=e;var r=this.membership;this.membership=e.getDirectionalContent().membership,this.disambiguate=function(e,t,n){return!(!t||t===e)&&(!!f.removeHiddenChars(t)&&(!!n&&(!!v.test(t)||(!!g.test(t)||!!n.getUserIdsWithDisplayName(t).some((function(t){return t!==e}))))))}(this.userId,n,t);var i=this.name;this.name=function(e,t,n,r){return r?t+" ("+e+")":t&&t!==e&&f.removeHiddenChars(t)?t:e}(this.userId,n,0,this.disambiguate),this.rawDisplayName=e.getDirectionalContent().displayname,this.rawDisplayName&&f.removeHiddenChars(this.rawDisplayName)||(this.rawDisplayName=this.userId),r!==this.membership&&(this.updateModifiedTime(),this.emit("RoomMember.membership",e,this,r)),i!==this.name&&(this.updateModifiedTime(),this.emit("RoomMember.name",e,this,i))}}},{key:"setPowerLevelEvent",value:function(e){if("m.room.power_levels"===e.getType()){var t=e.getDirectionalContent(),n=t.users_default||0,r=t.users||{};Object.values(r).forEach((function(e){n=Math.max(n,e)}));var i=this.powerLevel,o=this.powerLevelNorm;void 0!==r[this.userId]&&Number.isInteger(r[this.userId])?this.powerLevel=r[this.userId]:void 0!==t.users_default?this.powerLevel=t.users_default:this.powerLevel=0,this.powerLevelNorm=0,n>0&&(this.powerLevelNorm=100*this.powerLevel/n),i===this.powerLevel&&o===this.powerLevelNorm||(this.updateModifiedTime(),this.emit("RoomMember.powerLevel",e,this))}}},{key:"setTypingEvent",value:function(e){if("m.typing"===e.getType()){var t=this.typing;this.typing=!1;var n=e.getContent().user_ids;Array.isArray(n)&&(-1!==n.indexOf(this.userId)&&(this.typing=!0),t!==this.typing&&(this.updateModifiedTime(),this.emit("RoomMember.typing",e,this)))}}},{key:"updateModifiedTime",value:function(){this._modified=Date.now()}},{key:"getLastModifiedTime",value:function(){return this._modified}},{key:"isKicked",value:function(){return"leave"===this.membership&&this.events.member.getSender()!==this.events.member.getStateKey()}},{key:"getDMInviter",value:function(){if(this.events.member){var e=this.events.member,t=e.getContent(),n=e.getSender();if("join"===t.membership&&(t=e.getPrevContent(),n=e.getUnsigned().prev_sender),"invite"===t.membership&&t.is_direct)return n}}},{key:"getAvatarUrl",value:function(e,t,n,r){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=arguments.length>5?arguments[5]:void 0,a=this.getMxcAvatarUrl();if(!a&&!i)return null;var s=(0,d.getHttpUriForMxc)(e,a,t,n,r,o);return s||null}},{key:"getMxcAvatarUrl",value:function(){return this.events.member?this.events.member.getDirectionalContent().avatar_url:this.user?this.user.avatarUrl:null}}]),n}(l.EventEmitter);t.RoomMember=p;var v=/@.+:.+/,g=/[\u200E\u200F\u202A-\u202F]/},function(e,t,n){"use strict";var r=n(0),i=n(2),o=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.Filter=void 0;var a=o(n(3)),s=n(118);function u(e,t,n){for(var r=t.split("."),i=e,o=0;o<r.length-1;o++)i[r[o]]||(i[r[o]]={}),i=i[r[o]];i[r[r.length-1]]=n}var c=function(){function e(t,n){r(this,e),this.userId=t,this.filterId=n,(0,a.default)(this,"definition",{}),(0,a.default)(this,"roomFilter",void 0),(0,a.default)(this,"roomTimelineFilter",void 0)}return i(e,[{key:"getFilterId",value:function(){return this.filterId}},{key:"getDefinition",value:function(){return this.definition}},{key:"setDefinition",value:function(e){this.definition=e;var t=e.room,n={};t&&(t.rooms&&(n.rooms=t.rooms),t.rooms&&(n.not_rooms=t.not_rooms)),this.roomFilter=new s.FilterComponent(n),this.roomTimelineFilter=new s.FilterComponent((null===t||void 0===t?void 0:t.timeline)||{})}},{key:"getRoomTimelineFilterComponent",value:function(){return this.roomTimelineFilter}},{key:"filterRoomTimeline",value:function(e){return this.roomTimelineFilter.filter(this.roomFilter.filter(e))}},{key:"setTimelineLimit",value:function(e){u(this.definition,"room.timeline.limit",e)}},{key:"setLazyLoadMembers",value:function(e){u(this.definition,"room.state.lazy_load_members",!!e)}},{key:"setIncludeLeaveRooms",value:function(e){u(this.definition,"room.include_leave",e)}}],[{key:"fromJson",value:function(t,n,r){var i=new e(t,n);return i.setDefinition(r),i}}]),e}();t.Filter=c,(0,a.default)(c,"LAZY_LOADING_MESSAGES_FILTER",{lazy_load_members:!0})},function(e,t,n){"use strict";var r=n(0),i=n(2),o=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.SyncAccumulator=t.Category=void 0;var a,s=o(n(3)),u=n(5),c=n(12);t.Category=a,function(e){e.Invite="invite",e.Leave="leave",e.Join="join"}(a||(t.Category=a={}));var l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e),this.opts=t,(0,s.default)(this,"accountData",{}),(0,s.default)(this,"inviteRooms",{}),(0,s.default)(this,"joinRooms",{}),(0,s.default)(this,"nextBatch",null),(0,s.default)(this,"groups",{invite:{},join:{},leave:{}}),this.opts.maxTimelineEntries=this.opts.maxTimelineEntries||50}return i(e,[{key:"accumulate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.accumulateRooms(e,t),this.accumulateGroups(e),this.accumulateAccountData(e),this.nextBatch=e.next_batch}},{key:"accumulateAccountData",value:function(e){var t=this;e.account_data&&e.account_data.events&&e.account_data.events.forEach((function(e){t.accountData[e.type]=e}))}},{key:"accumulateRooms",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.rooms&&(e.rooms.invite&&Object.keys(e.rooms.invite).forEach((function(r){t.accumulateRoom(r,a.Invite,e.rooms.invite[r],n)})),e.rooms.join&&Object.keys(e.rooms.join).forEach((function(r){t.accumulateRoom(r,a.Join,e.rooms.join[r],n)})),e.rooms.leave&&Object.keys(e.rooms.leave).forEach((function(r){t.accumulateRoom(r,a.Leave,e.rooms.leave[r],n)})))}},{key:"accumulateRoom",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];switch(t){case a.Invite:this.accumulateInviteState(e,n);break;case a.Join:this.inviteRooms[e]&&delete this.inviteRooms[e],this.accumulateJoinState(e,n,r);break;case a.Leave:this.inviteRooms[e]?delete this.inviteRooms[e]:delete this.joinRooms[e];break;default:u.logger.error("Unknown cateogory: ",t)}}},{key:"accumulateInviteState",value:function(e,t){if(t.invite_state&&t.invite_state.events)if(this.inviteRooms[e]){var n=this.inviteRooms[e];t.invite_state.events.forEach((function(e){for(var t=!1,r=0;r<n.invite_state.events.length;r++){var i=n.invite_state.events[r];i.type===e.type&&i.state_key==e.state_key&&(n.invite_state.events[r]=e,t=!0)}t||n.invite_state.events.push(e)}))}else this.inviteRooms[e]={invite_state:t.invite_state}}},{key:"accumulateJoinState",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.joinRooms[e]||(this.joinRooms[e]={_currentState:Object.create(null),_timeline:[],_accountData:Object.create(null),_unreadNotifications:{},_summary:{},_readReceipts:{}});var r=this.joinRooms[e];if(t.account_data&&t.account_data.events&&t.account_data.events.forEach((function(e){r._accountData[e.type]=e})),t.unread_notifications&&(r._unreadNotifications=t.unread_notifications),t.summary){var i="m.heroes",o="m.invited_member_count",a="m.joined_member_count",s=r._summary,u=t.summary;s[i]=u[i]||s[i],s[a]=u[a]||s[a],s[o]=u[o]||s[o]}if(t.ephemeral&&t.ephemeral.events&&t.ephemeral.events.forEach((function(e){"m.receipt"===e.type&&e.content&&Object.keys(e.content).forEach((function(t){e.content[t]["m.read"]&&Object.keys(e.content[t]["m.read"]).forEach((function(n){r._readReceipts[n]={data:e.content[t]["m.read"][n],eventId:t}}))}))})),t.timeline&&t.timeline.limited&&(r._timeline=[]),t.state&&t.state.events&&t.state.events.forEach((function(e){d(r._currentState,e)})),t.timeline&&t.timeline.events&&t.timeline.events.forEach((function(e,i){var o;if(d(r._currentState,e),n)o=e;else{void 0!==(o=Object.assign({},e)).unsigned&&(o.unsigned=Object.assign({},o.unsigned));var a=e.unsigned?e.unsigned.age:e.age;void 0!==a&&(o._localTs=Date.now()-a)}r._timeline.push({event:o,token:0===i?t.timeline.prev_batch:null})})),r._timeline.length>this.opts.maxTimelineEntries)for(var c=r._timeline.length-this.opts.maxTimelineEntries,l=c;l<r._timeline.length;l++)if(r._timeline[l].token){r._timeline=r._timeline.slice(l,r._timeline.length);break}}},{key:"accumulateGroups",value:function(e){var t=this;e.groups&&(e.groups.invite&&Object.keys(e.groups.invite).forEach((function(n){t.accumulateGroup(n,a.Invite,e.groups.invite[n])})),e.groups.join&&Object.keys(e.groups.join).forEach((function(n){t.accumulateGroup(n,a.Join,e.groups.join[n])})),e.groups.leave&&Object.keys(e.groups.leave).forEach((function(n){t.accumulateGroup(n,a.Leave,e.groups.leave[n])})))}},{key:"accumulateGroup",value:function(e,t,n){for(var r=0,i=[a.Invite,a.Leave,a.Join];r<i.length;r++){var o=i[r];delete this.groups[o][e]}this.groups[t][e]=n}},{key:"getJSON",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n={join:{},invite:{},leave:{}};Object.keys(this.inviteRooms).forEach((function(t){n.invite[t]=e.inviteRooms[t]})),Object.keys(this.joinRooms).forEach((function(r){var i=e.joinRooms[r],o={ephemeral:{events:[]},account_data:{events:[]},state:{events:[]},timeline:{events:[],prev_batch:null},unread_notifications:i._unreadNotifications,summary:i._summary};Object.keys(i._accountData).forEach((function(e){o.account_data.events.push(i._accountData[e])}));var a={type:"m.receipt",room_id:r,content:{}};Object.keys(i._readReceipts).forEach((function(e){var t=i._readReceipts[e];a.content[t.eventId]||(a.content[t.eventId]={"m.read":{}}),a.content[t.eventId]["m.read"][e]=t.data})),Object.keys(a.content).length>0&&o.ephemeral.events.push(a),i._timeline.forEach((function(e){if(!o.timeline.prev_batch){if(!e.token)return;o.timeline.prev_batch=e.token}var n;!t&&e.event._localTs?(void 0!==(n=Object.assign({},e.event)).unsigned&&(n.unsigned=Object.assign({},n.unsigned)),delete n._localTs,n.unsigned=n.unsigned||{},n.unsigned.age=Date.now()-e.event._localTs):n=e.event,o.timeline.events.push(n)}));for(var s=Object.create(null),u=o.timeline.events.length-1;u>=0;u--){var l=o.timeline.events[u];if(null!==l.state_key&&void 0!==l.state_key){var f=(0,c.deepCopy)(l);f.unsigned&&(f.unsigned.prev_content&&(f.content=f.unsigned.prev_content),f.unsigned.prev_sender&&(f.sender=f.unsigned.prev_sender)),d(s,f)}}Object.keys(i._currentState).forEach((function(e){Object.keys(i._currentState[e]).forEach((function(t){var n=i._currentState[e][t];s[e]&&s[e][t]&&(n=s[e][t]),o.state.events.push(n)}))})),n.join[r]=o}));var r=[];return Object.keys(this.accountData).forEach((function(t){r.push(e.accountData[t])})),{nextBatch:this.nextBatch,roomsData:n,groupsData:this.groups,accountData:r}}},{key:"getNextBatchToken",value:function(){return this.nextBatch}}]),e}();function d(e,t){null!==t.state_key&&void 0!==t.state_key&&t.type&&(e[t.type]||(e[t.type]=Object.create(null)),e[t.type][t.state_key]=t)}t.SyncAccumulator=l},function(e,t,n){"use strict";var r=n(21),i=n(16),o=n(8),a=n(6),s=n(7),u=n(2),c=n(0),l=n(11),d=n(9),f=n(10),h=n(25),p=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.createNewMatrixCall=function(e,t,n){if("undefined"===typeof window||"undefined"===typeof document)return null;try{if(!Boolean(window.RTCPeerConnection||window.RTCSessionDescription||window.RTCIceCandidate||navigator.mediaDevices))return w.logger.error("WebRTC is not supported in this browser / environment"),null}catch(a){return w.logger.error("Exception thrown when trying to access WebRTC",a),null}var r=!!n&&n.forceTURN,i={client:e,roomId:t,turnServers:e.getTurnServers(),forceTURN:e.forceTURN||r},o=new D(i);return e.reEmitter.reEmit(o,Object.values(k)),o},t.MatrixCall=t.CallError=t.CallErrorCode=t.CallEvent=t.CallParty=t.CallDirection=t.CallType=t.CallState=void 0;var v,g,y,m,k,b,S=p(n(3)),w=n(5),E=n(15),_=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=O(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}r.default=e,n&&n.set(e,r);return r}(n(12)),x=n(17),I=n(32),T=n(120),R=n(121);function O(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(O=function(e){return e?n:t})(e)}t.CallState=v,function(e){e.Fledgling="fledgling",e.InviteSent="invite_sent",e.WaitLocalMedia="wait_local_media",e.CreateOffer="create_offer",e.CreateAnswer="create_answer",e.Connecting="connecting",e.Connected="connected",e.Ringing="ringing",e.Ended="ended"}(v||(t.CallState=v={})),t.CallType=g,function(e){e.Voice="voice",e.Video="video"}(g||(t.CallType=g={})),t.CallDirection=y,function(e){e.Inbound="inbound",e.Outbound="outbound"}(y||(t.CallDirection=y={})),t.CallParty=m,function(e){e.Local="local",e.Remote="remote"}(m||(t.CallParty=m={})),t.CallEvent=k,function(e){e.Hangup="hangup",e.State="state",e.Error="error",e.Replaced="replaced",e.LocalHoldUnhold="local_hold_unhold",e.RemoteHoldUnhold="remote_hold_unhold",e.HoldUnhold="hold_unhold",e.FeedsChanged="feeds_changed",e.AssertedIdentityChanged="asserted_identity_changed",e.LengthChanged="length_changed",e.DataChannel="datachannel"}(k||(t.CallEvent=k={})),t.CallErrorCode=b,function(e){e.UserHangup="user_hangup",e.LocalOfferFailed="local_offer_failed",e.NoUserMedia="no_user_media",e.UnknownDevices="unknown_devices",e.SendInvite="send_invite",e.CreateAnswer="create_answer",e.SendAnswer="send_answer",e.SetRemoteDescription="set_remote_description",e.SetLocalDescription="set_local_description",e.AnsweredElsewhere="answered_elsewhere",e.IceFailed="ice_failed",e.InviteTimeout="invite_timeout",e.Replaced="replaced",e.SignallingFailed="signalling_timeout",e.UserBusy="user_busy",e.Transfered="transferred"}(b||(t.CallErrorCode=b={}));var C=function(e){d(n,e);var t=f(n);function n(e,r,i){var o;return c(this,n),o=t.call(this,r+": "+i),(0,S.default)(l(o),"code",void 0),o.code=e,o}return n}(h(Error));function P(){return Date.now().toString()+(0,I.randomString)(16)}t.CallError=C;var D=function(e){d(n,e);var t=f(n);function n(e){var r;c(this,n),r=t.call(this),(0,S.default)(l(r),"roomId",void 0),(0,S.default)(l(r),"callId",void 0),(0,S.default)(l(r),"state",v.Fledgling),(0,S.default)(l(r),"hangupParty",void 0),(0,S.default)(l(r),"hangupReason",void 0),(0,S.default)(l(r),"direction",void 0),(0,S.default)(l(r),"ourPartyId",void 0),(0,S.default)(l(r),"client",void 0),(0,S.default)(l(r),"forceTURN",void 0),(0,S.default)(l(r),"turnServers",void 0),(0,S.default)(l(r),"candidateSendQueue",[]),(0,S.default)(l(r),"candidateSendTries",0),(0,S.default)(l(r),"sentEndOfCandidates",!1),(0,S.default)(l(r),"peerConn",void 0),(0,S.default)(l(r),"feeds",[]),(0,S.default)(l(r),"usermediaSenders",[]),(0,S.default)(l(r),"screensharingSenders",[]),(0,S.default)(l(r),"inviteOrAnswerSent",!1),(0,S.default)(l(r),"waitForLocalAVStream",void 0),(0,S.default)(l(r),"successor",void 0),(0,S.default)(l(r),"opponentMember",void 0),(0,S.default)(l(r),"opponentVersion",void 0),(0,S.default)(l(r),"opponentPartyId",void 0),(0,S.default)(l(r),"opponentCaps",void 0),(0,S.default)(l(r),"inviteTimeout",void 0),(0,S.default)(l(r),"remoteOnHold",!1),(0,S.default)(l(r),"callStatsAtEnd",void 0),(0,S.default)(l(r),"makingOffer",!1),(0,S.default)(l(r),"ignoreOffer",void 0),(0,S.default)(l(r),"remoteCandidateBuffer",new Map),(0,S.default)(l(r),"remoteAssertedIdentity",void 0),(0,S.default)(l(r),"remoteSDPStreamMetadata",void 0),(0,S.default)(l(r),"callLengthInterval",void 0),(0,S.default)(l(r),"callLength",0),(0,S.default)(l(r),"gotUserMediaForInvite",function(){var e=s(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.successor){e.next=3;break}return r.successor.gotUserMediaForAnswer(t),e.abrupt("return");case 3:if(!r.callHasEnded()){e.next=6;break}return r.stopAllMedia(),e.abrupt("return");case 6:r.pushLocalFeed(t,T.SDPStreamMetadataPurpose.Usermedia),r.setState(v.CreateOffer),w.logger.debug("gotUserMediaForInvite");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,S.default)(l(r),"gotUserMediaForAnswer",function(){var e=s(a.mark((function e(t){var n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.callHasEnded()){e.next=2;break}return e.abrupt("return");case 2:return r.pushLocalFeed(t,T.SDPStreamMetadataPurpose.Usermedia),r.setState(v.CreateAnswer),e.prev=4,r.getRidOfRTXCodecs(),e.next=8,r.peerConn.createAnswer();case 8:n=e.sent,e.next=16;break;case 11:return e.prev=11,e.t0=e.catch(4),w.logger.debug("Failed to create answer: ",e.t0),r.terminate(m.Local,b.CreateAnswer,!0),e.abrupt("return");case 16:return e.prev=16,e.next=19,r.peerConn.setLocalDescription(n);case 19:return r.setState(v.Connecting),e.next=22,new Promise((function(e){setTimeout(e,200)}));case 22:r.sendAnswer(),e.next=30;break;case 25:return e.prev=25,e.t1=e.catch(16),w.logger.debug("Error setting local description!",e.t1),r.terminate(m.Local,b.SetLocalDescription,!0),e.abrupt("return");case 30:case"end":return e.stop()}}),e,null,[[4,11],[16,25]])})));return function(t){return e.apply(this,arguments)}}()),(0,S.default)(l(r),"gotLocalIceCandidate",(function(e){if(e.candidate){if(w.logger.debug("Call "+r.callId+" got local ICE "+e.candidate.sdpMid+" candidate: "+e.candidate.candidate),r.callHasEnded())return;""===e.candidate.candidate&&r.sentEndOfCandidates||(r.queueCandidate(e.candidate),""===e.candidate.candidate&&(r.sentEndOfCandidates=!0))}})),(0,S.default)(l(r),"onIceGatheringStateChange",(function(e){if(w.logger.debug("ice gathering state changed to "+r.peerConn.iceGatheringState),"complete"===r.peerConn.iceGatheringState&&!r.sentEndOfCandidates){r.queueCandidate({candidate:""}),r.sentEndOfCandidates=!0}})),(0,S.default)(l(r),"gotLocalOffer",function(){var e=s(a.mark((function e(t){var n,i,o,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w.logger.debug("Created offer: ",t),!r.callHasEnded()){e.next=4;break}return w.logger.debug("Ignoring newly created offer on call ID "+r.callId+" because the call has ended"),e.abrupt("return");case 4:return e.prev=4,e.next=7,r.peerConn.setLocalDescription(t);case 7:e.next=14;break;case 9:return e.prev=9,e.t0=e.catch(4),w.logger.debug("Error setting local description!",e.t0),r.terminate(m.Local,b.SetLocalDescription,!0),e.abrupt("return");case 14:if("gathering"!==r.peerConn.iceGatheringState){e.next=17;break}return e.next=17,new Promise((function(e){setTimeout(e,200)}));case 17:if(!r.callHasEnded()){e.next=19;break}return e.abrupt("return");case 19:return n=r.state===v.CreateOffer?x.EventType.CallInvite:x.EventType.CallNegotiate,i={lifetime:6e4},r.state===v.CreateOffer?i.offer=r.peerConn.localDescription:i.description=r.peerConn.localDescription,i.capabilities={"m.call.transferee":r.client.supportsCallTransfer,"m.call.dtmf":!1},i[T.SDPStreamMetadataKey]=r.getLocalSDPStreamMetadata(),w.logger.info("Discarding ".concat(r.candidateSendQueue.length," candidates that will be sent in offer")),r.candidateSendQueue=[],e.prev=26,e.next=29,r.sendVoipEvent(n,i);case 29:e.next=42;break;case 31:return e.prev=31,e.t1=e.catch(26),w.logger.error("Failed to send invite",e.t1),e.t1.event&&r.client.cancelPendingEvent(e.t1.event),o=b.SignallingFailed,s="Signalling failed",r.state===v.CreateOffer&&(o=b.SendInvite,s="Failed to send invite"),"UnknownDeviceError"==e.t1.name&&(o=b.UnknownDevices,s="Unknown devices present in the room"),r.emit(k.Error,new C(o,s,e.t1)),r.terminate(m.Local,o,!1),e.abrupt("return");case 42:r.sendCandidateQueue(),r.state===v.CreateOffer&&(r.inviteOrAnswerSent=!0,r.setState(v.InviteSent),r.inviteTimeout=setTimeout((function(){r.inviteTimeout=null,r.state===v.InviteSent&&r.hangup(b.InviteTimeout,!1)}),6e4));case 44:case"end":return e.stop()}}),e,null,[[4,9],[26,31]])})));return function(t){return e.apply(this,arguments)}}()),(0,S.default)(l(r),"getLocalOfferFailed",(function(e){w.logger.error("Failed to get local offer",e),r.emit(k.Error,new C(b.LocalOfferFailed,"Failed to get local offer!",e)),r.terminate(m.Local,b.LocalOfferFailed,!1)})),(0,S.default)(l(r),"getUserMediaFailed",(function(e){r.successor?r.successor.getUserMediaFailed(e):(w.logger.warn("Failed to get user media - ending call",e),r.emit(k.Error,new C(b.NoUserMedia,"Couldn't start capturing media! Is your microphone set up and does this app have permission?",e)),r.terminate(m.Local,b.NoUserMedia,!1))})),(0,S.default)(l(r),"onIceConnectionStateChanged",(function(){r.callHasEnded()||(w.logger.debug("Call ID "+r.callId+": ICE connection state changed to: "+r.peerConn.iceConnectionState),"connected"==r.peerConn.iceConnectionState?(r.setState(v.Connected),r.callLengthInterval||(r.callLengthInterval=setInterval((function(){r.callLength++,r.emit(k.LengthChanged,r.callLength)}),1e3))):"failed"==r.peerConn.iceConnectionState&&r.hangup(b.IceFailed,!1))})),(0,S.default)(l(r),"onSignallingStateChanged",(function(){w.logger.debug("call "+r.callId+": Signalling state changed to: "+r.peerConn.signalingState)})),(0,S.default)(l(r),"onTrack",(function(e){if(0!==e.streams.length){var t=e.streams[0];r.pushRemoteFeed(t),t.addEventListener("removetrack",(function(){return r.deleteFeedByStream(t)}))}else w.logger.warn("Streamless ".concat(e.track.kind," found: ignoring."))})),(0,S.default)(l(r),"onDataChannel",(function(e){r.emit(k.DataChannel,e.channel)})),(0,S.default)(l(r),"onNegotiationNeeded",s(a.mark((function e(){var t;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w.logger.info("Negotiation is needed!"),r.state===v.CreateOffer||0!==r.opponentVersion){e.next=4;break}return w.logger.info("Opponent does not support renegotiation: ignoring negotiationneeded event"),e.abrupt("return");case 4:return r.makingOffer=!0,e.prev=5,r.getRidOfRTXCodecs(),e.next=9,r.peerConn.createOffer();case 9:return t=e.sent,e.next=12,r.gotLocalOffer(t);case 12:e.next=18;break;case 14:return e.prev=14,e.t0=e.catch(5),r.getLocalOfferFailed(e.t0),e.abrupt("return");case 18:return e.prev=18,r.makingOffer=!1,e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[5,14,18,21]])})))),(0,S.default)(l(r),"onHangupReceived",(function(e){w.logger.debug("Hangup received for call ID "+r.callId),r.partyIdMatches(e)||r.state===v.Ringing?r.terminate(m.Remote,e.reason||b.UserHangup,!0):w.logger.info("Ignoring message from party ID ".concat(e.party_id,": our partner is ").concat(r.opponentPartyId))})),(0,S.default)(l(r),"onRejectReceived",(function(e){w.logger.debug("Reject received for call ID "+r.callId),[v.InviteSent,v.Ringing].includes(r.state)||r.state===v.Fledgling&&r.direction===y.Inbound?r.terminate(m.Remote,e.reason||b.UserHangup,!0):w.logger.debug("Call is in state: ".concat(r.state,": ignoring reject"))})),(0,S.default)(l(r),"onAnsweredElsewhere",(function(e){w.logger.debug("Call ID "+r.callId+" answered elsewhere"),r.terminate(m.Remote,b.AnsweredElsewhere,!0)})),r.roomId=e.roomId,r.client=e.client,r.forceTURN=e.forceTURN,r.ourPartyId=r.client.deviceId,r.turnServers=e.turnServers||[],0===r.turnServers.length&&r.client.isFallbackICEServerAllowed()&&r.turnServers.push({urls:["stun:turn.matrix.org"]});var i,u=o(r.turnServers);try{for(u.s();!(i=u.n()).done;){var d=i.value;_.checkObjectHasKeys(d,["urls"])}}catch(f){u.e(f)}finally{u.f()}return r.callId=P(),r}return u(n,[{key:"placeVoiceCall",value:function(){var e=s(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.placeCall(!0,!1);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"placeVideoCall",value:function(){var e=s(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.placeCall(!0,!0);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createDataChannel",value:function(e,t){var n=this.peerConn.createDataChannel(e,t);return this.emit(k.DataChannel,n),w.logger.debug("created data channel"),n}},{key:"getOpponentMember",value:function(){return this.opponentMember}},{key:"opponentCanBeTransferred",value:function(){return Boolean(this.opponentCaps&&this.opponentCaps["m.call.transferee"])}},{key:"opponentSupportsDTMF",value:function(){return Boolean(this.opponentCaps&&this.opponentCaps["m.call.dtmf"])}},{key:"getRemoteAssertedIdentity",value:function(){return this.remoteAssertedIdentity}},{key:"type",get:function(){return this.hasLocalUserMediaVideoTrack||this.hasRemoteUserMediaVideoTrack?g.Video:g.Voice}},{key:"hasLocalUserMediaVideoTrack",get:function(){var e;return(null===(e=this.localUsermediaStream)||void 0===e?void 0:e.getVideoTracks().length)>0}},{key:"hasRemoteUserMediaVideoTrack",get:function(){return this.getRemoteFeeds().some((function(e){return e.purpose===T.SDPStreamMetadataPurpose.Usermedia&&e.stream.getVideoTracks().length>0}))}},{key:"hasLocalUserMediaAudioTrack",get:function(){var e;return(null===(e=this.localUsermediaStream)||void 0===e?void 0:e.getAudioTracks().length)>0}},{key:"hasRemoteUserMediaAudioTrack",get:function(){return this.getRemoteFeeds().some((function(e){return e.purpose===T.SDPStreamMetadataPurpose.Usermedia&&e.stream.getAudioTracks().length>0}))}},{key:"localUsermediaFeed",get:function(){return this.getLocalFeeds().find((function(e){return e.purpose===T.SDPStreamMetadataPurpose.Usermedia}))}},{key:"localScreensharingFeed",get:function(){return this.getLocalFeeds().find((function(e){return e.purpose===T.SDPStreamMetadataPurpose.Screenshare}))}},{key:"localUsermediaStream",get:function(){var e;return null===(e=this.localUsermediaFeed)||void 0===e?void 0:e.stream}},{key:"localScreensharingStream",get:function(){var e;return null===(e=this.localScreensharingFeed)||void 0===e?void 0:e.stream}},{key:"getFeedByStreamId",value:function(e){return this.getFeeds().find((function(t){return t.stream.id===e}))}},{key:"getFeeds",value:function(){return this.feeds}},{key:"getLocalFeeds",value:function(){return this.feeds.filter((function(e){return e.isLocal()}))}},{key:"getRemoteFeeds",value:function(){return this.feeds.filter((function(e){return!e.isLocal()}))}},{key:"getLocalSDPStreamMetadata",value:function(){var e,t={},n=o(this.getLocalFeeds());try{for(n.s();!(e=n.n()).done;){var r=e.value;t[r.stream.id]={purpose:r.purpose,audio_muted:r.isAudioMuted(),video_muted:r.isVideoMuted()}}}catch(i){n.e(i)}finally{n.f()}return w.logger.debug("Got local SDPStreamMetadata",t),t}},{key:"noIncomingFeeds",value:function(){return!this.feeds.some((function(e){return!e.isLocal()}))}},{key:"pushRemoteFeed",value:function(e){if(this.opponentSupportsSDPStreamMetadata()){var t=this.getOpponentMember().userId,n=this.remoteSDPStreamMetadata[e.id].purpose,r=this.remoteSDPStreamMetadata[e.id].audio_muted,i=this.remoteSDPStreamMetadata[e.id].video_muted;if(n){var o=this.getRemoteFeeds().find((function(e){return e.purpose===n}));o?o.setNewStream(e):(this.feeds.push(new R.CallFeed({client:this.client,roomId:this.roomId,userId:t,stream:e,purpose:n,audioMuted:r,videoMuted:i})),this.emit(k.FeedsChanged,this.feeds)),w.logger.info('Pushed remote stream (id="'.concat(e.id,'", active="').concat(e.active,'", purpose=').concat(n,")"))}else w.logger.warn("Ignoring stream with id ".concat(e.id," because we didn't get any metadata about it"))}else this.pushRemoteFeedWithoutMetadata(e)}},{key:"pushRemoteFeedWithoutMetadata",value:function(e){var t,n=this.getOpponentMember().userId,r=T.SDPStreamMetadataPurpose.Usermedia,i=null===(t=this.feeds.find((function(e){return!e.isLocal()})))||void 0===t?void 0:t.stream;if(i&&e.id!==i.id)w.logger.warn("Ignoring new stream ID ".concat(e.id,": we already have stream ID ").concat(i.id));else{var o=this.getFeedByStreamId(e.id);o?o.setNewStream(e):(this.feeds.push(new R.CallFeed({client:this.client,roomId:this.roomId,audioMuted:!1,videoMuted:!1,userId:n,stream:e,purpose:r})),this.emit(k.FeedsChanged,this.feeds)),w.logger.info('Pushed remote stream (id="'.concat(e.id,'", active="').concat(e.active,'")'))}}},{key:"pushLocalFeed",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.client.getUserId(),i=this.getLocalFeeds().find((function(e){return e.purpose===t}));if(i?i.setNewStream(e):(this.feeds.push(new R.CallFeed({client:this.client,roomId:this.roomId,audioMuted:0===e.getAudioTracks().length,videoMuted:0===e.getVideoTracks().length,userId:r,stream:e,purpose:t})),this.emit(k.FeedsChanged,this.feeds)),A(e.getAudioTracks(),!0),n){var a=t===T.SDPStreamMetadataPurpose.Usermedia?this.usermediaSenders:this.screensharingSenders;a.splice(0,a.length),this.emit(k.FeedsChanged,this.feeds);var s,u=o(e.getTracks());try{for(u.s();!(s=u.n()).done;){var c=s.value;w.logger.info("Adding track ("+'id="'.concat(c.id,'", ')+'kind="'.concat(c.kind,'", ')+'streamId="'.concat(e.id,'", ')+'streamPurpose="'.concat(t,'"')+") to peer connection"),a.push(this.peerConn.addTrack(c,e))}}catch(l){u.e(l)}finally{u.f()}}w.logger.info('Pushed local stream (id="'.concat(e.id,'", active="').concat(e.active,'", purpose="').concat(t,'")'))}},{key:"deleteAllFeeds",value:function(){var e,t=o(this.feeds);try{for(t.s();!(e=t.n()).done;){e.value.dispose()}}catch(n){t.e(n)}finally{t.f()}this.feeds=[],this.emit(k.FeedsChanged,this.feeds)}},{key:"deleteFeedByStream",value:function(e){w.logger.debug("Removing feed with stream id ".concat(e.id));var t=this.getFeedByStreamId(e.id);t?(t.dispose(),this.feeds.splice(this.feeds.indexOf(t),1),this.emit(k.FeedsChanged,this.feeds)):w.logger.warn("Didn't find the feed with stream id ".concat(e.id," to delete"))}},{key:"getCurrentCallStats",value:function(){var e=s(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.callHasEnded()){e.next=2;break}return e.abrupt("return",this.callStatsAtEnd);case 2:return e.abrupt("return",this.collectCallStats());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"collectCallStats",value:function(){var e=s(a.mark((function e(){var t,n,r,i,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.peerConn){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.peerConn.getStats();case 4:t=e.sent,n=[],r=o(t);try{for(r.s();!(i=r.n()).done;)s=i.value,n.push(s[1])}catch(a){r.e(a)}finally{r.f()}return e.abrupt("return",n);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initWithInvite",value:function(){var e=s(a.mark((function e(t){var n,r,i,o,s=this;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.getContent(),this.direction=y.Inbound,e.next=4,this.client.checkTurnServers();case 4:return e.sent||w.logger.warn("Failed to get TURN credentials! Proceeding with call anyway..."),(i=r[T.SDPStreamMetadataKey])?this.updateRemoteSDPStreamMetadata(i):w.logger.debug("Did not get any SDPStreamMetadata! Can not send/receive multiple streams"),this.peerConn=this.createPeerConnection(),this.chooseOpponent(t),e.prev=10,e.next=13,this.peerConn.setRemoteDescription(r.offer);case 13:return e.next=15,this.addBufferedIceCandidates();case 15:e.next=22;break;case 17:return e.prev=17,e.t0=e.catch(10),w.logger.debug("Failed to set remote description",e.t0),this.terminate(m.Local,b.SetRemoteDescription,!1),e.abrupt("return");case 22:if((o=null===(n=this.feeds.find((function(e){return!e.isLocal()})))||void 0===n?void 0:n.stream)&&0!==o.getTracks().length){e.next=27;break}return w.logger.error("No remote stream or no tracks after setting remote description!"),this.terminate(m.Local,b.SetRemoteDescription,!1),e.abrupt("return");case 27:this.setState(v.Ringing),t.getLocalAge()&&setTimeout((function(){s.state==v.Ringing&&(w.logger.debug("Call invite has expired. Hanging up."),s.hangupParty=m.Remote,s.setState(v.Ended),s.stopAllMedia(),"closed"!=s.peerConn.signalingState&&s.peerConn.close(),s.emit(k.Hangup))}),r.lifetime-t.getLocalAge());case 29:case"end":return e.stop()}}),e,this,[[10,17]])})));return function(t){return e.apply(this,arguments)}}()},{key:"initWithHangup",value:function(e){this.setState(v.Ended)}},{key:"shouldAnswerWithMediaType",value:function(e,t,n){return e&&!t?(w.logger.warn("Unable to answer with ".concat(n," because the other side isn't sending it either.")),!1):_.isNullOrUndefined(e)||e===t||this.opponentSupportsSDPStreamMetadata()?null!==e&&void 0!==e?e:t:(w.logger.warn("Unable to answer with ".concat(n,"=").concat(e," because the other side doesn't support it. ")+"Answering with ".concat(n,"=").concat(t,".")),t)}},{key:"answer",value:function(){var e=s(a.mark((function e(t,n){var r,i,o,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.inviteOrAnswerSent){e.next=2;break}return e.abrupt("return");case 2:if(!1!==t||!1!==n){e.next=4;break}throw new Error("You CANNOT answer a call without media");case 4:if(w.logger.debug("Answering call ".concat(this.callId)),this.localUsermediaStream||this.waitForLocalAVStream){e.next=33;break}return r=this.state,i=this.shouldAnswerWithMediaType(t,this.hasRemoteUserMediaAudioTrack,"audio"),o=this.shouldAnswerWithMediaType(n,this.hasRemoteUserMediaVideoTrack,"video"),this.setState(v.WaitLocalMedia),this.waitForLocalAVStream=!0,e.prev=11,e.next=14,this.client.getMediaHandler().getUserMediaStream(i,o);case 14:s=e.sent,this.waitForLocalAVStream=!1,this.gotUserMediaForAnswer(s),e.next=31;break;case 19:if(e.prev=19,e.t0=e.catch(11),!o){e.next=29;break}return w.logger.warn("Failed to getUserMedia(), trying to getUserMedia() without video"),this.setState(r),this.waitForLocalAVStream=!1,e.next=27,this.answer(i,!1);case 27:e.next=31;break;case 29:return this.getUserMediaFailed(e.t0),e.abrupt("return");case 31:e.next=34;break;case 33:this.waitForLocalAVStream&&this.setState(v.WaitLocalMedia);case 34:case"end":return e.stop()}}),e,this,[[11,19]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"replacedBy",value:function(e){this.state===v.WaitLocalMedia?(w.logger.debug("Telling new call to wait for local media"),e.waitForLocalAVStream=!0):[v.CreateOffer,v.InviteSent].includes(this.state)&&(w.logger.debug("Handing local stream to new call"),e.gotUserMediaForAnswer(this.localUsermediaStream)),this.successor=e,this.emit(k.Replaced,e),this.hangup(b.Replaced,!0)}},{key:"hangup",value:function(e,t){if(!this.callHasEnded()&&(w.logger.debug("Ending call "+this.callId),this.terminate(m.Local,e,!t),this.state!==v.WaitLocalMedia)){var n={};(this.opponentVersion&&this.opponentVersion>=1||e!==b.UserHangup)&&(n.reason=e),this.sendVoipEvent(x.EventType.CallHangup,n)}}},{key:"reject",value:function(){if(this.state!==v.Ringing)throw Error("Call must be in 'ringing' state to reject!");if(this.opponentVersion<1)return w.logger.info("Opponent version is less than 1 (".concat(this.opponentVersion,"): sending hangup instead of reject")),void this.hangup(b.UserHangup,!0);w.logger.debug("Rejecting call: "+this.callId),this.terminate(m.Local,b.UserHangup,!0),this.sendVoipEvent(x.EventType.CallReject,{})}},{key:"upgradeCall",value:function(){var e=s(a.mark((function e(t,n){var r,i,o,s,u;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t||n){e.next=2;break}return e.abrupt("return");case 2:if(this.opponentSupportsSDPStreamMetadata()){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,r=t&&!this.hasLocalUserMediaAudioTrack,i=n&&!this.hasLocalUserMediaVideoTrack,w.logger.debug("Upgrading call: audio?=".concat(r," video?=").concat(i)),e.next=10,this.client.getMediaHandler().getUserMediaStream(r,i);case 10:if(o=e.sent,!r||!i){e.next=19;break}if(!this.hasLocalUserMediaAudioTrack){e.next=14;break}return e.abrupt("return");case 14:if(!this.hasLocalUserMediaVideoTrack){e.next=16;break}return e.abrupt("return");case 16:this.pushLocalFeed(o,T.SDPStreamMetadataPurpose.Usermedia),e.next=33;break;case 19:if(!r){e.next=27;break}if(!this.hasLocalUserMediaAudioTrack){e.next=22;break}return e.abrupt("return");case 22:s=o.getAudioTracks()[0],this.localUsermediaStream.addTrack(s),this.peerConn.addTrack(s,this.localUsermediaStream),e.next=33;break;case 27:if(!i){e.next=33;break}if(!this.hasLocalUserMediaVideoTrack){e.next=30;break}return e.abrupt("return");case 30:u=o.getVideoTracks()[0],this.localUsermediaStream.addTrack(u),this.peerConn.addTrack(u,this.localUsermediaStream);case 33:e.next=39;break;case 35:e.prev=35,e.t0=e.catch(4),w.logger.error("Failed to upgrade the call",e.t0),this.emit(k.Error,new C(b.NoUserMedia,"Failed to get camera access: ",e.t0));case 39:case"end":return e.stop()}}),e,this,[[4,35]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"opponentSupportsSDPStreamMetadata",value:function(){return Boolean(this.remoteSDPStreamMetadata)}},{key:"isScreensharing",value:function(){return Boolean(this.localScreensharingStream)}},{key:"setScreensharingEnabled",value:function(){var e=s(a.mark((function e(t,n){var r,i,s,u;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||!this.isScreensharing()){e.next=5;break}return w.logger.warn("There is already a screensharing stream - there is nothing to do!"),e.abrupt("return",!0);case 5:if(t||this.isScreensharing()){e.next=8;break}return w.logger.warn("There already isn't a screensharing stream - there is nothing to do!"),e.abrupt("return",!1);case 8:if(this.opponentSupportsSDPStreamMetadata()){e.next=12;break}return e.next=11,this.setScreensharingEnabledWithoutMetadataSupport(t,n);case 11:return e.abrupt("return",e.sent);case 12:if(w.logger.debug("Set screensharing enabled? ".concat(t)),!t){e.next=30;break}return e.prev=14,e.next=17,this.client.getMediaHandler().getScreensharingStream(n);case 17:if(r=e.sent){e.next=20;break}return e.abrupt("return",!1);case 20:return this.pushLocalFeed(r,T.SDPStreamMetadataPurpose.Screenshare),e.abrupt("return",!0);case 24:return e.prev=24,e.t0=e.catch(14),this.emit(k.Error,new C(b.NoUserMedia,"Failed to get screen-sharing stream: ",e.t0)),e.abrupt("return",!1);case 28:e.next=35;break;case 30:i=o(this.screensharingSenders);try{for(i.s();!(s=i.n()).done;)u=s.value,this.peerConn.removeTrack(u)}catch(a){i.e(a)}finally{i.f()}return this.client.getMediaHandler().stopScreensharingStream(this.localScreensharingStream),this.deleteFeedByStream(this.localScreensharingStream),e.abrupt("return",!1);case 35:case"end":return e.stop()}}),e,this,[[14,24]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setScreensharingEnabledWithoutMetadataSupport",value:function(){var e=s(a.mark((function e(t,n){var r,i,o;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w.logger.debug("Set screensharing enabled? ".concat(t," using replaceTrack()")),!t){e.next=21;break}return e.prev=2,e.next=5,this.client.getMediaHandler().getScreensharingStream(n);case 5:if(r=e.sent){e.next=8;break}return e.abrupt("return",!1);case 8:return i=r.getTracks().find((function(e){return"video"===e.kind})),this.usermediaSenders.find((function(e){var t;return"video"===(null===(t=e.track)||void 0===t?void 0:t.kind)})).replaceTrack(i),this.pushLocalFeed(r,T.SDPStreamMetadataPurpose.Screenshare,!1),e.abrupt("return",!0);case 15:return e.prev=15,e.t0=e.catch(2),this.emit(k.Error,new C(b.NoUserMedia,"Failed to get screen-sharing stream: ",e.t0)),e.abrupt("return",!1);case 19:e.next=27;break;case 21:return o=this.localUsermediaStream.getTracks().find((function(e){return"video"===e.kind})),this.usermediaSenders.find((function(e){var t;return"video"===(null===(t=e.track)||void 0===t?void 0:t.kind)})).replaceTrack(o),this.client.getMediaHandler().stopScreensharingStream(this.localScreensharingStream),this.deleteFeedByStream(this.localScreensharingStream),e.abrupt("return",!1);case 27:case"end":return e.stop()}}),e,this,[[2,15]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setLocalVideoMuted",value:function(){var e=s(a.mark((function e(t){var n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.getMediaHandler().hasVideoDevice();case 2:if(e.sent){e.next=4;break}return e.abrupt("return",this.isLocalVideoMuted());case 4:if(this.hasLocalUserMediaVideoTrack||t){e.next=8;break}return e.next=7,this.upgradeCall(!1,!0);case 7:return e.abrupt("return",this.isLocalVideoMuted());case 8:return null===(n=this.localUsermediaFeed)||void 0===n||n.setVideoMuted(t),this.updateMuteStatus(),e.abrupt("return",this.isLocalVideoMuted());case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isLocalVideoMuted",value:function(){var e;return null===(e=this.localUsermediaFeed)||void 0===e?void 0:e.isVideoMuted()}},{key:"setMicrophoneMuted",value:function(){var e=s(a.mark((function e(t){var n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.getMediaHandler().hasAudioDevice();case 2:if(e.sent){e.next=4;break}return e.abrupt("return",this.isMicrophoneMuted());case 4:if(this.hasLocalUserMediaAudioTrack||t){e.next=8;break}return e.next=7,this.upgradeCall(!0,!1);case 7:return e.abrupt("return",this.isMicrophoneMuted());case 8:return null===(n=this.localUsermediaFeed)||void 0===n||n.setAudioMuted(t),this.updateMuteStatus(),e.abrupt("return",this.isMicrophoneMuted());case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isMicrophoneMuted",value:function(){var e;return null===(e=this.localUsermediaFeed)||void 0===e?void 0:e.isAudioMuted()}},{key:"isRemoteOnHold",value:function(){return this.remoteOnHold}},{key:"setRemoteOnHold",value:function(e){if(this.isRemoteOnHold()!==e){this.remoteOnHold=e;var t,n=o(this.peerConn.getTransceivers());try{for(n.s();!(t=n.n()).done;){t.value.direction=e?"sendonly":"sendrecv"}}catch(r){n.e(r)}finally{n.f()}this.updateMuteStatus(),this.emit(k.RemoteHoldUnhold,this.remoteOnHold)}}},{key:"isLocalOnHold",value:function(){if(this.state!==v.Connected)return!1;var e,t=!0,n=o(this.peerConn.getTransceivers());try{for(n.s();!(e=n.n()).done;){var r=e.value;["inactive","recvonly"].includes(r.currentDirection)||(t=!1)}}catch(i){n.e(i)}finally{n.f()}return t}},{key:"sendDtmfDigit",value:function(e){var t,n=o(this.peerConn.getSenders());try{for(n.s();!(t=n.n()).done;){var r=t.value;if("audio"===r.track.kind&&r.dtmf)return void r.dtmf.insertDTMF(e)}}catch(i){n.e(i)}finally{n.f()}throw new Error("Unable to find a track to send DTMF on")}},{key:"updateMuteStatus",value:function(){var e,t;this.sendVoipEvent(x.EventType.CallSDPStreamMetadataChangedPrefix,i({},T.SDPStreamMetadataKey,this.getLocalSDPStreamMetadata()));var n=(null===(e=this.localUsermediaFeed)||void 0===e?void 0:e.isAudioMuted())||this.remoteOnHold,r=(null===(t=this.localUsermediaFeed)||void 0===t?void 0:t.isVideoMuted())||this.remoteOnHold;A(this.localUsermediaStream.getAudioTracks(),!n),A(this.localUsermediaStream.getVideoTracks(),!r)}},{key:"sendAnswer",value:function(){var e=s(a.mark((function e(){var t,n,r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=i({answer:{sdp:this.peerConn.localDescription.sdp,type:this.peerConn.localDescription.type}},T.SDPStreamMetadataKey,this.getLocalSDPStreamMetadata())).capabilities={"m.call.transferee":this.client.supportsCallTransfer,"m.call.dtmf":!1},w.logger.info("Discarding ".concat(this.candidateSendQueue.length," candidates that will be sent in answer")),this.candidateSendQueue=[],e.prev=4,e.next=7,this.sendVoipEvent(x.EventType.CallAnswer,t);case 7:this.inviteOrAnswerSent=!0,e.next=19;break;case 10:throw e.prev=10,e.t0=e.catch(4),this.setState(v.Ringing),this.client.cancelPendingEvent(e.t0.event),n=b.SendAnswer,r="Failed to send answer","UnknownDeviceError"==e.t0.name&&(n=b.UnknownDevices,r="Unknown devices present in the room"),this.emit(k.Error,new C(n,r,e.t0)),e.t0;case 19:this.sendCandidateQueue();case 20:case"end":return e.stop()}}),e,this,[[4,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"onRemoteIceCandidatesReceived",value:function(){var e=s(a.mark((function e(t){var n,i,o,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.callHasEnded()){e.next=2;break}return e.abrupt("return");case 2:if(n=t.getContent(),i=n.candidates){e.next=7;break}return w.logger.info("Ignoring candidates event with no candidates!"),e.abrupt("return");case 7:if(o=0===n.version?null:n.party_id||null,void 0!==this.opponentPartyId){e.next=14;break}return w.logger.info("Buffering ".concat(i.length," candidates until we pick an opponent")),(s=this.remoteCandidateBuffer.get(o)||[]).push.apply(s,r(i)),this.remoteCandidateBuffer.set(o,s),e.abrupt("return");case 14:if(this.partyIdMatches(n)){e.next=17;break}return w.logger.info("Ignoring candidates from party ID ".concat(n.party_id,": ")+"we have chosen party ID ".concat(this.opponentPartyId)),e.abrupt("return");case 17:return e.next=19,this.addIceCandidates(i);case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onAnswerReceived",value:function(){var e=s(a.mark((function e(t){var n,r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.getContent(),w.logger.debug("Got answer for call ID ".concat(this.callId," from party ID ").concat(n.party_id)),!this.callHasEnded()){e.next=5;break}return w.logger.debug("Ignoring answer because call ID ".concat(this.callId," has ended")),e.abrupt("return");case 5:if(void 0===this.opponentPartyId){e.next=8;break}return w.logger.info("Ignoring answer from party ID ".concat(n.party_id,": ")+"we already have an answer/reject from ".concat(this.opponentPartyId)),e.abrupt("return");case 8:return this.chooseOpponent(t),e.next=11,this.addBufferedIceCandidates();case 11:return this.setState(v.Connecting),(r=n[T.SDPStreamMetadataKey])?this.updateRemoteSDPStreamMetadata(r):w.logger.warn("Did not get any SDPStreamMetadata! Can not send/receive multiple streams"),e.prev=14,e.next=17,this.peerConn.setRemoteDescription(n.answer);case 17:e.next=24;break;case 19:return e.prev=19,e.t0=e.catch(14),w.logger.debug("Failed to set remote description",e.t0),this.terminate(m.Local,b.SetRemoteDescription,!1),e.abrupt("return");case 24:if(null===this.opponentPartyId){e.next=33;break}return e.prev=25,e.next=28,this.sendVoipEvent(x.EventType.CallSelectAnswer,{selected_party_id:this.opponentPartyId});case 28:e.next=33;break;case 30:e.prev=30,e.t1=e.catch(25),w.logger.warn("Failed to send select_answer event",e.t1);case 33:case"end":return e.stop()}}),e,this,[[14,19],[25,30]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onSelectAnswerReceived",value:function(){var e=s(a.mark((function e(t){var n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.direction===y.Inbound){e.next=3;break}return w.logger.warn("Got select_answer for an outbound call: ignoring"),e.abrupt("return");case 3:if(void 0!==(n=t.getContent().selected_party_id)&&null!==n){e.next=7;break}return w.logger.warn("Got nonsensical select_answer with null/undefined selected_party_id: ignoring"),e.abrupt("return");case 7:n!==this.ourPartyId&&(w.logger.info("Got select_answer for party ID ".concat(n,": we are party ID ").concat(this.ourPartyId,".")),this.terminate(m.Remote,b.AnsweredElsewhere,!0));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onNegotiateReceived",value:function(){var e=s(a.mark((function e(t){var n,r,o,s,u,c,l,d;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.getContent(),(r=n.description)&&r.sdp&&r.type){e.next=5;break}return w.logger.info("Ignoring invalid m.call.negotiate event"),e.abrupt("return");case 5:if(o=this.direction===y.Inbound,s="offer"===r.type&&(this.makingOffer||"stable"!==this.peerConn.signalingState),this.ignoreOffer=!o&&s,!this.ignoreOffer){e.next=11;break}return w.logger.info("Ignoring colliding negotiate event because we're impolite"),e.abrupt("return");case 11:return u=this.isLocalOnHold(),(c=n[T.SDPStreamMetadataKey])?this.updateRemoteSDPStreamMetadata(c):w.logger.warn("Received negotiation event without SDPStreamMetadata!"),e.prev=14,e.next=17,this.peerConn.setRemoteDescription(r);case 17:if("offer"!==r.type){e.next=25;break}return this.getRidOfRTXCodecs(),e.next=21,this.peerConn.createAnswer();case 21:return l=e.sent,e.next=24,this.peerConn.setLocalDescription(l);case 24:this.sendVoipEvent(x.EventType.CallNegotiate,i({description:this.peerConn.localDescription},T.SDPStreamMetadataKey,this.getLocalSDPStreamMetadata()));case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(14),w.logger.warn("Failed to complete negotiation",e.t0);case 30:d=this.isLocalOnHold(),u!==d&&(this.emit(k.LocalHoldUnhold,d),this.emit(k.HoldUnhold,d));case 32:case"end":return e.stop()}}),e,this,[[14,27]])})));return function(t){return e.apply(this,arguments)}}()},{key:"updateRemoteSDPStreamMetadata",value:function(e){this.remoteSDPStreamMetadata=_.recursivelyAssign(this.remoteSDPStreamMetadata||{},e,!0);var t,n=o(this.getRemoteFeeds());try{for(n.s();!(t=n.n()).done;){var r,i,a,s=t.value,u=s.stream.id;s.setAudioMuted(null===(r=this.remoteSDPStreamMetadata[u])||void 0===r?void 0:r.audio_muted),s.setVideoMuted(null===(i=this.remoteSDPStreamMetadata[u])||void 0===i?void 0:i.video_muted),s.purpose=null===(a=this.remoteSDPStreamMetadata[u])||void 0===a?void 0:a.purpose}}catch(c){n.e(c)}finally{n.f()}}},{key:"onSDPStreamMetadataChangedReceived",value:function(e){var t=e.getContent()[T.SDPStreamMetadataKey];this.updateRemoteSDPStreamMetadata(t)}},{key:"onAssertedIdentityReceived",value:function(){var e=s(a.mark((function e(t){var n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=t.getContent()).asserted_identity){e.next=3;break}return e.abrupt("return");case 3:this.remoteAssertedIdentity={id:n.asserted_identity.id,displayName:n.asserted_identity.display_name},this.emit(k.AssertedIdentityChanged);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"callHasEnded",value:function(){return this.state===v.Ended}},{key:"getRidOfRTXCodecs",value:function(){if(RTCRtpReceiver.getCapabilities&&RTCRtpSender.getCapabilities){var e,t=RTCRtpReceiver.getCapabilities("video").codecs,n=RTCRtpSender.getCapabilities("video").codecs,i=[].concat(r(n),r(t)),a=o(i);try{for(a.s();!(e=a.n()).done;){var s=e.value;if("video/rtx"===s.mimeType){var u=i.indexOf(s);i.splice(u,1)}}}catch(p){a.e(p)}finally{a.f()}var c,l=o(this.peerConn.getTransceivers());try{for(l.s();!(c=l.n()).done;){var d,f,h=c.value;!this.screensharingSenders.includes(h.sender)||"video"!==(null===(d=h.sender.track)||void 0===d?void 0:d.kind)&&"video"!==(null===(f=h.receiver.track)||void 0===f?void 0:f.kind)||h.setCodecPreferences(i)}}catch(p){l.e(p)}finally{l.f()}}}},{key:"setState",value:function(e){var t=this.state;this.state=e,this.emit(k.State,e,t)}},{key:"sendVoipEvent",value:function(e,t){return this.client.sendEvent(this.roomId,e,Object.assign({},t,{version:1,call_id:this.callId,party_id:this.ourPartyId}))}},{key:"queueCandidate",value:function(e){var t=this;if(this.candidateSendQueue.push(e),this.state!==v.Ringing&&this.inviteOrAnswerSent){var n=this.direction===y.Inbound?500:2e3;0===this.candidateSendTries&&setTimeout((function(){t.sendCandidateQueue()}),n)}}},{key:"transfer",value:function(){var e=s(a.mark((function e(t){var n,r,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.getProfileInfo(t);case 2:return n=e.sent,r=P(),i={replacement_id:P(),target_user:{id:t,display_name:n.displayname,avatar_url:n.avatar_url},create_call:r},e.next=7,this.sendVoipEvent(x.EventType.CallReplaces,i);case 7:return e.next=9,this.terminate(m.Local,b.Transfered,!0);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"transferToCall",value:function(){var e=s(a.mark((function e(t){var n,r,i,o,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.getProfileInfo(t.getOpponentMember().userId);case 2:return n=e.sent,e.next=5,this.client.getProfileInfo(this.getOpponentMember().userId);case 5:return r=e.sent,i=P(),o={replacement_id:P(),target_user:{id:this.getOpponentMember().userId,display_name:r.displayname,avatar_url:r.avatar_url},await_call:i},e.next=10,t.sendVoipEvent(x.EventType.CallReplaces,o);case 10:return s={replacement_id:P(),target_user:{id:t.getOpponentMember().userId,display_name:n.displayname,avatar_url:n.avatar_url},create_call:i},e.next=13,this.sendVoipEvent(x.EventType.CallReplaces,s);case 13:return e.next=15,this.terminate(m.Local,b.Replaced,!0);case 15:return e.next=17,t.terminate(m.Local,b.Transfered,!0);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"terminate",value:function(){var e=s(a.mark((function e(t,n,r){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.callHasEnded()){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.collectCallStats();case 4:this.callStatsAtEnd=e.sent,this.inviteTimeout&&(clearTimeout(this.inviteTimeout),this.inviteTimeout=null),this.callLengthInterval&&(clearInterval(this.callLengthInterval),this.callLengthInterval=null),n!==b.Replaced&&this.stopAllMedia(),this.deleteAllFeeds(),this.hangupParty=t,this.hangupReason=n,this.setState(v.Ended),this.peerConn&&"closed"!==this.peerConn.signalingState&&this.peerConn.close(),r&&this.emit(k.Hangup,this);case 14:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"stopAllMedia",value:function(){w.logger.debug("stopAllMedia (stream=".concat(this.localUsermediaStream,")"));var e,t=o(this.feeds);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(n.isLocal()&&n.purpose===T.SDPStreamMetadataPurpose.Usermedia)this.client.getMediaHandler().stopUserMediaStream(n.stream);else if(n.isLocal()&&n.purpose===T.SDPStreamMetadataPurpose.Screenshare)this.client.getMediaHandler().stopScreensharingStream(n.stream);else{var r,i=o(n.stream.getTracks());try{for(i.s();!(r=i.n()).done;){r.value.stop()}}catch(a){i.e(a)}finally{i.f()}}}}catch(a){t.e(a)}finally{t.f()}}},{key:"checkForErrorListener",value:function(){if(0===this.listeners("error").length)throw new Error("You MUST attach an error listener using call.on('error', function() {})")}},{key:"sendCandidateQueue",value:function(){var e=s(a.mark((function e(){var t,n,i,o,s,u=this;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.candidateSendQueue.length){e.next=2;break}return e.abrupt("return");case 2:return t=this.candidateSendQueue,this.candidateSendQueue=[],++this.candidateSendTries,n={candidates:t},w.logger.debug("Attempting to send "+t.length+" candidates"),e.prev=7,e.next=10,this.sendVoipEvent(x.EventType.CallCandidates,n);case 10:this.candidateSendTries=0,e.next=28;break;case 13:if(e.prev=13,e.t0=e.catch(7),e.t0.event&&this.client.cancelPendingEvent(e.t0.event),(i=this.candidateSendQueue).push.apply(i,r(t)),!(this.candidateSendTries>5)){e.next=24;break}return w.logger.debug("Failed to send candidates on attempt "+this.candidateSendTries+". Giving up on this call.",e.t0),o=b.SignallingFailed,"Signalling failed",this.emit(k.Error,new C(o,"Signalling failed",e.t0)),this.hangup(o,!1),e.abrupt("return");case 24:s=500*Math.pow(2,this.candidateSendTries),++this.candidateSendTries,w.logger.debug("Failed to send candidates. Retrying in "+s+"ms",e.t0),setTimeout((function(){u.sendCandidateQueue()}),s);case 28:case"end":return e.stop()}}),e,this,[[7,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"placeCall",value:function(){var e=s(a.mark((function e(t,n){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w.logger.debug("placeCall audio=".concat(t," video=").concat(n)),t){e.next=3;break}throw new Error("You CANNOT start a call without audio");case 3:return this.checkForErrorListener(),this.client.callEventHandler.calls.set(this.callId,this),this.setState(v.WaitLocalMedia),this.direction=y.Outbound,e.next=9,this.client.checkTurnServers();case 9:return e.sent||w.logger.warn("Failed to get TURN credentials! Proceeding with call anyway..."),this.peerConn=this.createPeerConnection(),e.prev=12,e.next=15,this.client.getMediaHandler().getUserMediaStream(t,n);case 15:r=e.sent,this.gotUserMediaForInvite(r),e.next=23;break;case 19:return e.prev=19,e.t0=e.catch(12),this.getUserMediaFailed(e.t0),e.abrupt("return");case 23:case"end":return e.stop()}}),e,this,[[12,19]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createPeerConnection",value:function(){var e=new window.RTCPeerConnection({iceTransportPolicy:this.forceTURN?"relay":void 0,iceServers:this.turnServers,iceCandidatePoolSize:this.client.iceCandidatePoolSize});return e.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChanged),e.addEventListener("signalingstatechange",this.onSignallingStateChanged),e.addEventListener("icecandidate",this.gotLocalIceCandidate),e.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),e.addEventListener("track",this.onTrack),e.addEventListener("negotiationneeded",this.onNegotiationNeeded),e.addEventListener("datachannel",this.onDataChannel),e}},{key:"partyIdMatches",value:function(e){return(0===e.version?null:e.party_id||null)===this.opponentPartyId}},{key:"chooseOpponent",value:function(e){var t=e.getContent();w.logger.debug("Choosing party ID ".concat(t.party_id," for call ID ").concat(this.callId)),this.opponentVersion=t.version,0===this.opponentVersion?this.opponentPartyId=null:this.opponentPartyId=t.party_id||null,this.opponentCaps=t.capabilities||{},this.opponentMember=e.sender}},{key:"addBufferedIceCandidates",value:function(){var e=s(a.mark((function e(){var t;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.remoteCandidateBuffer.get(this.opponentPartyId))){e.next=5;break}return w.logger.info("Adding ".concat(t.length," buffered candidates for opponent ").concat(this.opponentPartyId)),e.next=5,this.addIceCandidates(t);case 5:this.remoteCandidateBuffer=null;case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"addIceCandidates",value:function(){var e=s(a.mark((function e(t){var n,r,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=o(t),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=19;break}if(null!==(i=r.value).sdpMid&&void 0!==i.sdpMid||null!==i.sdpMLineIndex&&void 0!==i.sdpMLineIndex){e.next=8;break}return w.logger.debug("Ignoring remote ICE candidate with no sdpMid or sdpMLineIndex"),e.abrupt("continue",17);case 8:return w.logger.debug("Call "+this.callId+" got remote ICE "+i.sdpMid+" candidate: "+i.candidate),e.prev=9,e.next=12,this.peerConn.addIceCandidate(i);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(9),this.ignoreOffer||w.logger.info("Failed to add remote ICE candidate",e.t0);case 17:e.next=3;break;case 19:e.next=24;break;case 21:e.prev=21,e.t1=e.catch(1),n.e(e.t1);case 24:return e.prev=24,n.f(),e.finish(24);case 27:case"end":return e.stop()}}),e,this,[[1,21,24,27],[9,14]])})));return function(t){return e.apply(this,arguments)}}()},{key:"hasPeerConnection",get:function(){return Boolean(this.peerConn)}}]),n}(E.EventEmitter);function A(e,t){for(var n=0;n<e.length;n++)e[n].enabled=t}t.MatrixCall=D},function(e,t,n){"use strict";(function(e){var r=n(6),i=n(7),o=n(2),a=n(0),s=n(9),u=n(10),c=n(25),l=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixHttpApi=b,t.retryNetworkOperation=function(e,t){return x.apply(this,arguments)},t.AbortError=t.ConnectionError=t.MatrixError=t.PREFIX_MEDIA_R0=t.PREFIX_IDENTITY_V2=t.PREFIX_IDENTITY_V1=t.PREFIX_UNSTABLE=t.PREFIX_R0=void 0;var d=l(n(3)),f=n(136),h=y(n(12)),p=n(5),v=y(n(137));function g(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(g=function(e){return e?n:t})(e)}function y(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=g(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){(0,d.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.PREFIX_R0="/_matrix/client/r0";t.PREFIX_UNSTABLE="/_matrix/client/unstable";t.PREFIX_IDENTITY_V1="/_matrix/identity/api/v1";t.PREFIX_IDENTITY_V2="/_matrix/identity/v2";function b(e,t){h.checkObjectHasKeys(t,["baseUrl","request","prefix"]),t.onlyData=t.onlyData||!1,this.event_emitter=e,this.opts=t,this.useAuthorizationHeader=Boolean(t.useAuthorizationHeader),this.uploads=[]}t.PREFIX_MEDIA_R0="/_matrix/media/r0",b.prototype={setIdBaseUrl:function(e){this.opts.idBaseUrl=e},getContentUri:function(){var e={access_token:this.opts.accessToken};return{base:this.opts.baseUrl,path:"/_matrix/media/r0/upload",params:e}},uploadContent:function(t,n){h.isFunction(n)?n={callback:n}:void 0===n&&(n={});var r=!1!==n.includeFilename,i=n.type||t.type||"application/octet-stream",o=n.name||t.name,a=t;a.stream&&"function"!==typeof a.stream&&(p.logger.warn("Using `file.stream` as the content to upload. Future versions of the js-sdk will change this to expect `file` to be the content directly."),a=a.stream);var s=n.rawResponse;void 0===s&&(e.XMLHttpRequest?s=!1:(p.logger.warn("Returning the raw JSON from uploadContent(). Future versions of the js-sdk will change this default, to return the parsed object. Set opts.rawResponse=false to change this behaviour now."),s=!0));var u=n.onlyContentUri;s||void 0!==u||(e.XMLHttpRequest?(p.logger.warn("Returning only the content-uri from uploadContent(). Future versions of the js-sdk will change this default, to return the whole response object. Set opts.onlyContentUri=false to change this behaviour now."),u=!0):u=!1);var c,l={loaded:0,total:0},d=null;if(s||(d=function(e){var t=JSON.parse(e);if(u&&void 0===(t=t.content_uri))throw Error("Bad response");return t}),e.XMLHttpRequest){var f=h.defer(),g=new e.XMLHttpRequest;l.xhr=g;var y=S(f,n.callback,this.opts.onlyData),m=function(){g.abort(),y(new Error("Timeout"))};g.timeout_timer=v.setTimeout(m,3e4),g.onreadystatechange=function(){var t;switch(g.readyState){case e.XMLHttpRequest.DONE:v.clearTimeout(g.timeout_timer);try{if(0===g.status)throw new _;if(!g.responseText)throw new Error("No response body.");t=g.responseText,d&&(t=d(t))}catch(n){return n.http_status=g.status,void y(n)}y(void 0,g,t)}},g.upload.addEventListener("progress",(function(e){v.clearTimeout(g.timeout_timer),l.loaded=e.loaded,l.total=e.total,g.timeout_timer=v.setTimeout(m,3e4),n.progressHandler&&n.progressHandler({loaded:e.loaded,total:e.total})}));var k=this.opts.baseUrl+"/_matrix/media/r0/upload",b=[];r&&o&&b.push("filename="+encodeURIComponent(o)),this.useAuthorizationHeader||b.push("access_token="+encodeURIComponent(this.opts.accessToken)),b.length>0&&(k+="?"+b.join("&")),g.open("POST",k),this.useAuthorizationHeader&&g.setRequestHeader("Authorization","Bearer "+this.opts.accessToken),g.setRequestHeader("Content-Type",i),g.send(a),(c=f.promise).abort=g.abort.bind(g)}else{var w={};r&&o&&(w.filename=o),c=this.authedRequest(n.callback,"POST","/upload",w,a,{prefix:"/_matrix/media/r0",headers:{"Content-Type":i},json:!1,bodyParser:d})}var E=this,x=c.finally((function(){for(var e=0;e<E.uploads.length;++e)if(E.uploads[e]===l)return void E.uploads.splice(e,1)}));return x.abort=c.abort,l.promise=x,this.uploads.push(l),x},cancelUpload:function(e){return!!e.abort&&(e.abort(),!0)},getCurrentUploads:function(){return this.uploads},idServerRequest:function(e,t,n,r,i,o){if(!this.opts.idBaseUrl)throw new Error("No identity server base URL set");var a=this.opts.idBaseUrl+i+n;if(void 0!==e&&!h.isFunction(e))throw Error("Expected callback to be a function but got "+typeof e);var s={uri:a,method:t,withCredentials:!1,json:!0,_matrix_opts:this.opts,headers:{}};"GET"===t?s.qs=r:"object"===typeof r&&(s.json=r),o&&(s.headers.Authorization="Bearer ".concat(o));var u=h.defer();return this.opts.request(s,S(u,e,this.opts.onlyData)),u.promise},authedRequest:function(e,t,n,r,i,o){r||(r={}),this.useAuthorizationHeader?(isFinite(o)&&(o={localTimeoutMs:o}),o||(o={}),o.headers||(o.headers={}),o.headers.Authorization||(o.headers.Authorization="Bearer "+this.opts.accessToken),r.access_token&&delete r.access_token):r.access_token||(r.access_token=this.opts.accessToken);var a=this.request(e,t,n,r,i,o),s=this;return a.catch((function(e){"M_UNKNOWN_TOKEN"==e.errcode?s.event_emitter.emit("Session.logged_out",e):"M_CONSENT_NOT_GIVEN"==e.errcode&&s.event_emitter.emit("no_consent",e.message,e.data.consent_uri)})),a},request:function(e,t,n,r,i,o){var a=void 0!==(o=o||{}).prefix?o.prefix:this.opts.prefix,s=this.opts.baseUrl+a+n;return this.requestOtherUrl(e,t,s,r,i,o)},requestOtherUrl:function(e,t,n,r,i,o){return void 0===o||null===o?o={}:isFinite(o)&&(o={localTimeoutMs:o}),this._request(e,t,n,r,i,o)},getUrl:function(e,t,n){var r="";return t&&(r="?"+h.encodeParams(t)),this.opts.baseUrl+n+e+r},_request:function(e,t,n,r,i,o){if(void 0!==e&&!h.isFunction(e))throw Error("Expected callback to be a function but got "+typeof e);o=o||{};var a=this;this.opts.extraParams&&(r=k(k({},r),this.opts.extraParams));var s=h.extend({},o.headers||{}),u=void 0===o.json||o.json,c=o.bodyParser;u&&(i&&(i=JSON.stringify(i),s["content-type"]="application/json"),s.accept||(s.accept="application/json"),void 0===c&&(c=function(e){return JSON.parse(e)}));var l,d,f=h.defer(),p=!1,g=o.localTimeoutMs||this.opts.localTimeoutMs,y=function(){g&&(l&&v.clearTimeout(l),l=v.setTimeout((function(){p=!0,d&&d.abort&&d.abort(),f.reject(new w({error:"Locally timed out waiting for a response",errcode:"ORG.MATRIX.JSSDK_TIMEOUT",timeout:g}))}),g))};y();var m=f.promise;try{(d=this.opts.request({uri:n,method:t,withCredentials:!1,qs:r,qsStringifyOptions:o.qsStringifyOptions,useQuerystring:!0,body:i,json:!1,timeout:g,headers:s||{},_matrix_opts:this.opts},(function(t,n,r){g&&(v.clearTimeout(l),p)||S(f,e,a.opts.onlyData,c)(t,n,r)})))&&("onprogress"in d&&(d.onprogress=function(e){y()}),d.abort&&(m.abort=d.abort.bind(d)))}catch(b){f.reject(b),e&&e(b)}return m}};var S=function(e,t,n,r){return t=t||function(){},function(i,o,a){i&&("AbortError"===i.name||"aborted"===i||i instanceof w||(i=new E("request failed",i)));if(!i)try{(o.status||o.statusCode)>=400?i=function(e,t){var n,r=e.status||e.statusCode,i=function(e){var t;e.getResponseHeader?t=e.getResponseHeader("Content-Type"):e.headers&&(t=e.headers["content-type"]||null);if(!t)return null;try{return(0,f.parse)(t)}catch(n){throw new Error("Error parsing Content-Type '".concat(t,"': ").concat(n))}}(e);if(i)if("application/json"===i.type){var o="object"===typeof t?t:JSON.parse(t);n=new w(o)}else"text/plain"===i.type&&(n=new Error("Server returned ".concat(r," error: ").concat(t)));n||(n=new Error("Server returned ".concat(r," error")));return n.httpStatus=r,n}(o,a):r&&(a=r(a))}catch(u){i=new Error("Error parsing server response: ".concat(u))}if(i)e.reject(i),t(i);else{var s={code:o.status||o.statusCode,headers:o.headers,data:a};e.resolve(n?a:s),t(null,n?a:s)}}};var w=function(e){s(n,e);var t=u(n);function n(e){var r;return a(this,n),e=e||{},(r=t.call(this,"MatrixError: ".concat(e.errcode))).errcode=e.errcode,r.name=e.errcode||"Unknown error code",r.message=e.error||"Unknown message",r.data=e,r}return n}(c(Error));t.MatrixError=w;var E=function(e){s(n,e);var t=u(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return a(this,n),(r=t.call(this,e+(i?": ".concat(i.message):"")))._cause=i,r}return o(n,[{key:"name",get:function(){return"ConnectionError"}},{key:"cause",get:function(){return this._cause}}]),n}(c(Error));t.ConnectionError=E;var _=function(e){s(n,e);var t=u(n);function n(){return a(this,n),t.call(this,"Operation aborted")}return o(n,[{key:"name",get:function(){return"AbortError"}}]),n}(c(Error));function x(){return(x=i(r.mark((function e(t,n){var i,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=0,o=null;case 2:if(!(i<t)){e.next=21;break}if(e.prev=3,!(i>0)){e.next=6;break}return e.delegateYield(r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=1e3*Math.pow(2,i),p.logger.log("network operation failed ".concat(i," times,")+" retrying in ".concat(t,"ms...")),e.next=4,new Promise((function(e){return setTimeout(e,t)}));case 4:case"end":return e.stop()}}),e)}))(),"t0",6);case 6:return e.next=8,n();case 8:return e.abrupt("return",e.sent);case 11:if(e.prev=11,e.t1=e.catch(3),!(e.t1 instanceof E)){e.next=18;break}i+=1,o=e.t1,e.next=19;break;case 18:throw e.t1;case 19:e.next=2;break;case 21:throw o;case 22:case"end":return e.stop()}}),e,null,[[3,11]])})))).apply(this,arguments)}t.AbortError=_}).call(this,n(14))},function(e,t,n){"use strict";var r=n(11),i=n(9),o=n(10),a=n(25),s=n(6),u=n(7),c=n(0),l=n(2),d=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.registerAlgorithm=function(e,t,n){h[e]=t,p[e]=n},t.UnknownDeviceError=t.DecryptionError=t.DecryptionAlgorithm=t.EncryptionAlgorithm=t.DECRYPTION_CLASSES=t.ENCRYPTION_CLASSES=void 0;var f=d(n(3)),h={};t.ENCRYPTION_CLASSES=h;var p={};t.DECRYPTION_CLASSES=p;var v=function(){function e(t){c(this,e),(0,f.default)(this,"userId",void 0),(0,f.default)(this,"deviceId",void 0),(0,f.default)(this,"crypto",void 0),(0,f.default)(this,"olmDevice",void 0),(0,f.default)(this,"baseApis",void 0),(0,f.default)(this,"roomId",void 0),this.userId=t.userId,this.deviceId=t.deviceId,this.crypto=t.crypto,this.olmDevice=t.olmDevice,this.baseApis=t.baseApis,this.roomId=t.roomId}return l(e,[{key:"prepareToEncrypt",value:function(e){}},{key:"onRoomMembership",value:function(e,t,n){}}]),e}();t.EncryptionAlgorithm=v;var g=function(){function e(t){c(this,e),(0,f.default)(this,"userId",void 0),(0,f.default)(this,"crypto",void 0),(0,f.default)(this,"olmDevice",void 0),(0,f.default)(this,"baseApis",void 0),(0,f.default)(this,"roomId",void 0),this.userId=t.userId,this.crypto=t.crypto,this.olmDevice=t.olmDevice,this.baseApis=t.baseApis,this.roomId=t.roomId}return l(e,[{key:"onRoomKeyEvent",value:function(e){}},{key:"importRoomKey",value:function(){var e=u(s.mark((function e(t,n){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"hasKeysForKeyRequest",value:function(e){return Promise.resolve(!1)}},{key:"shareKeysWithDevice",value:function(e){throw new Error("shareKeysWithDevice not supported for this DecryptionAlgorithm")}},{key:"retryDecryptionFromSender",value:function(){var e=u(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}();t.DecryptionAlgorithm=g;var y=function(e){i(n,e);var t=o(n);function n(e,i,o){var a;return c(this,n),(a=t.call(this,i)).code=e,(0,f.default)(r(a),"detailedString",void 0),a.code=e,a.name="DecryptionError",a.detailedString=function(e,t){var n=e.name+"[msg: "+e.message;t&&(n+=", "+Object.keys(t).map((function(e){return e+": "+t[e]})).join(", "));return n+="]"}(r(a),o),a}return n}(a(Error));t.DecryptionError=y;var m=function(e){i(n,e);var t=o(n);function n(e,r){var i;return c(this,n),(i=t.call(this,e)).devices=r,i.name="UnknownDeviceError",i.devices=r,i}return n}(a(Error));t.UnknownDeviceError=m},function(e,t,n){"use strict";var r=n(6),i=n(16),o=n(13),a=n(7),s=n(2),u=n(11),c=n(0),l=n(9),d=n(10),f=n(25),h=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.VerificationBase=t.SwitchStartEventError=void 0;var p=h(n(3)),v=n(18),g=n(15),y=n(5),m=n(41),k=n(34),b=n(42),S=new Error("Verification timed out"),w=function(e){l(n,e);var t=d(n);function n(e){var r;return c(this,n),(r=t.call(this)).startEvent=e,r}return n}(f(Error));t.SwitchStartEventError=w;var E=function(e){l(n,e);var t=d(n);function n(e,r,i,o,a,s){var l;return c(this,n),(l=t.call(this)).channel=e,l.baseApis=r,l.userId=i,l.deviceId=o,l.startEvent=a,l.request=s,(0,p.default)(u(l),"cancelled",!1),(0,p.default)(u(l),"_done",!1),(0,p.default)(u(l),"promise",null),(0,p.default)(u(l),"transactionTimeoutTimer",null),(0,p.default)(u(l),"expectedEvent",void 0),(0,p.default)(u(l),"resolve",void 0),(0,p.default)(u(l),"reject",void 0),(0,p.default)(u(l),"resolveEvent",void 0),(0,p.default)(u(l),"rejectEvent",void 0),(0,p.default)(u(l),"started",void 0),(0,p.default)(u(l),"doVerification",void 0),l}return s(n,[{key:"initiatedByMe",get:function(){if(!this.startEvent)return!0;var e=this.startEvent.getSender(),t=this.startEvent.getContent();return e===this.baseApis.getUserId()&&t.from_device===this.baseApis.getDeviceId()}},{key:"hasBeenCancelled",get:function(){return this.cancelled}},{key:"resetTimer",value:function(){var e=this;y.logger.info("Refreshing/starting the verification transaction timeout timer"),null!==this.transactionTimeoutTimer&&clearTimeout(this.transactionTimeoutTimer),this.transactionTimeoutTimer=setTimeout((function(){e._done||e.cancelled||(y.logger.info("Triggering verification timeout"),e.cancel(S))}),6e5)}},{key:"endTimer",value:function(){null!==this.transactionTimeoutTimer&&(clearTimeout(this.transactionTimeoutTimer),this.transactionTimeoutTimer=null)}},{key:"send",value:function(e,t){return this.channel.send(e,t)}},{key:"waitForEvent",value:function(e){var t=this;if(this._done)return Promise.reject(new Error("Verification is already done"));var n=this.request.getEventFromOtherParty(e);return n?Promise.resolve(n):(this.expectedEvent=e,new Promise((function(e,n){t.resolveEvent=e,t.rejectEvent=n})))}},{key:"canSwitchStartEvent",value:function(e){return!1}},{key:"switchStartEvent",value:function(e){if(this.canSwitchStartEvent(e))if(y.logger.log("Verification Base: switching verification start event",{restartingFlow:!!this.rejectEvent}),this.rejectEvent){var t=this.rejectEvent;this.rejectEvent=void 0,t(new w(e))}else this.startEvent=e}},{key:"handleEvent",value:function(e){if(!this._done)if(e.getType()===this.expectedEvent)"m.key.verification.done"!==this.expectedEvent&&(this.expectedEvent=void 0,this.rejectEvent=void 0,this.resetTimer(),this.resolveEvent(e));else if("m.key.verification.cancel"===e.getType()){var t=this.reject;if(this.reject=void 0,t){var n=e.getContent(),r=n.reason,i=n.code;t(new Error("Other side cancelled verification "+"because ".concat(r," (").concat(i,")")))}}else if(this.expectedEvent){var o=new Error("Unexpected message: expecting "+this.expectedEvent+" but got "+e.getType());if(this.expectedEvent=void 0,this.rejectEvent){var a=this.rejectEvent;this.rejectEvent=void 0,a(o)}this.cancel(o)}}},{key:"done",value:function(){if(this.endTimer(),!this._done)return this.request.onVerifierFinished(),this.resolve(),(0,b.requestKeysDuringVerification)(this.baseApis,this.userId,this.deviceId)}},{key:"cancel",value:function(e){if(this.endTimer(),!this._done){if(this.cancelled=!0,this.request.onVerifierCancelled(),this.userId&&this.deviceId)if(e===S){var t=(0,k.newTimeoutError)();this.send(t.getType(),t.getContent())}else if(e instanceof v.MatrixEvent){if(e.getSender()!==this.userId){var n=e.getContent();"m.key.verification.cancel"===e.getType()?(n.code=n.code||"m.unknown",n.reason=n.reason||n.body||"Unknown reason",this.send("m.key.verification.cancel",n)):this.send("m.key.verification.cancel",{code:"m.unknown",reason:n.body||"Unknown reason"})}}else this.send("m.key.verification.cancel",{code:"m.unknown",reason:e.toString()});null!==this.promise?this.reject&&this.reject(e):this.promise=Promise.reject(e),this.emit("cancel",e)}}},{key:"verify",value:function(){var e=this;return this.promise||(this.promise=new Promise((function(t,n){e.resolve=function(){e._done=!0,e.endTimer(),t.apply(void 0,arguments)},e.reject=function(t){e._done=!0,e.endTimer(),n(t)}})),this.doVerification&&!this.started&&(this.started=!0,this.resetTimer(),Promise.resolve(this.doVerification()).then(this.done.bind(this),this.cancel.bind(this)))),this.promise}},{key:"verifyKeys",value:function(){var e=a(r.mark((function e(t,n,a){var s,u,c,l,d,f,h,p,v,g,k,b;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(s=[],u=0,c=Object.entries(n);u<c.length;u++)l=o(c[u],2),d=l[0],f=l[1],h=d.split(":",2)[1],(p=this.baseApis.getStoredDevice(t,h))?(a(d,p,f),s.push(h)):(v=this.baseApis.crypto.deviceList.getStoredCrossSigningForUser(t))&&v.getId()===h?(a(d,m.DeviceInfo.fromStorage({keys:i({},d,h)},h),f),s.push(h)):y.logger.warn("verification: Could not find device ".concat(h," to verify"));if(s.length){e.next=4;break}throw new Error("No devices could be verified");case 4:y.logger.info("Verification completed! Marking devices verified: ",s),g=0,k=s;case 6:if(!(g<k.length)){e.next=13;break}return b=k[g],e.next=10,this.baseApis.setDeviceVerified(t,b);case 10:g++,e.next=6;break;case 13:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"events",get:function(){}}]),n}(g.EventEmitter);t.VerificationBase=E},function(e,t,n){"use strict";(function(e){var r=n(6),i=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.keyFromAuthData=function(e,t){return u.apply(this,arguments)},t.keyFromPassphrase=function(e){return c.apply(this,arguments)},t.deriveKey=l;var o=n(32),a=5e5,s=256;function u(){return(u=i(r.mark((function t(n,i){return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.Olm){t.next=2;break}throw new Error("Olm is not available");case 2:if(n.private_key_salt&&n.private_key_iterations){t.next=4;break}throw new Error("Salt and/or iterations not found: this backup cannot be restored with a passphrase");case 4:return t.next=6,l(i,n.private_key_salt,n.private_key_iterations,n.private_key_bits||s);case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function c(){return(c=i(r.mark((function t(n){var i,u;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.Olm){t.next=2;break}throw new Error("Olm is not available");case 2:return i=(0,o.randomString)(32),t.next=5,l(n,i,a,s);case 5:return u=t.sent,t.abrupt("return",{key:u,salt:i,iterations:a});case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function l(e,t,n){return d.apply(this,arguments)}function d(){return(d=i(r.mark((function t(n,i,o){var a,u,c,l,d,f=arguments;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=f.length>3&&void 0!==f[3]?f[3]:s,u=e.crypto.subtle,c=e.TextEncoder,u&&c){t.next=5;break}throw new Error("Password-based backup is not avaiable on this platform");case 5:return t.next=7,u.importKey("raw",(new c).encode(n),{name:"PBKDF2"},!1,["deriveBits"]);case 7:return l=t.sent,t.next=10,u.deriveBits({name:"PBKDF2",salt:(new c).encode(i),iterations:o,hash:"SHA-512"},l,a);case 10:return d=t.sent,t.abrupt("return",new Uint8Array(d));case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}}).call(this,n(14))},function(e,t,n){"use strict";(function(e,r){var i=n(8),o=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.encodeRecoveryKey=function(t){var n=new e(s.length+t.length+1);n.set(s,0),n.set(t,s.length);for(var r=0,i=0;i<n.length-1;++i)r^=n[i];return n[n.length-1]=r,a.default.encode(n).match(/.{1,4}/g).join(" ")},t.decodeRecoveryKey=function(e){var t,n=a.default.decode(e.replace(/ /g,"")),o=0,u=i(n);try{for(u.s();!(t=u.n()).done;){var c=t.value;o^=c}}catch(d){u.e(d)}finally{u.f()}if(0!==o)throw new Error("Incorrect parity");for(var l=0;l<s.length;++l)if(n[l]!==s[l])throw new Error("Incorrect prefix");if(n.length!==s.length+r.Olm.PRIVATE_KEY_LENGTH+1)throw new Error("Incorrect length");return Uint8Array.from(n.slice(s.length,s.length+r.Olm.PRIVATE_KEY_LENGTH))};var a=o(n(145)),s=[139,1]}).call(this,n(24).Buffer,n(14))},function(e,t,n){"use strict";var r=n(13),i=n(8),o=n(6),a=n(21),s=n(7),u=n(0),c=n(2),l=n(11),d=n(9),f=n(10),h=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.VerificationRequest=t.PHASE_DONE=t.PHASE_CANCELLED=t.PHASE_STARTED=t.PHASE_READY=t.PHASE_REQUESTED=t.PHASE_UNSENT=t.Phase=t.READY_TYPE=t.DONE_TYPE=t.CANCEL_TYPE=t.START_TYPE=t.REQUEST_TYPE=t.EVENT_PREFIX=void 0;var p=h(n(3)),v=n(5),g=n(15),y=n(34),m=n(84),k="m.key.verification.";t.EVENT_PREFIX=k;var b=k+"request";t.REQUEST_TYPE=b;var S=k+"start";t.START_TYPE=S;var w=k+"cancel";t.CANCEL_TYPE=w;var E=k+"done";t.DONE_TYPE=E;var _,x=k+"ready";t.READY_TYPE=x,t.Phase=_,function(e){e[e.Unsent=1]="Unsent",e[e.Requested=2]="Requested",e[e.Ready=3]="Ready",e[e.Started=4]="Started",e[e.Cancelled=5]="Cancelled",e[e.Done=6]="Done"}(_||(t.Phase=_={}));var I=_.Unsent;t.PHASE_UNSENT=I;var T=_.Requested;t.PHASE_REQUESTED=T;var R=_.Ready;t.PHASE_READY=R;var O=_.Started;t.PHASE_STARTED=O;var C=_.Cancelled;t.PHASE_CANCELLED=C;var P=_.Done;t.PHASE_DONE=P;var D=function(e){d(n,e);var t=f(n);function n(e,r,i){var o;return u(this,n),(o=t.call(this)).channel=e,o.verificationMethods=r,o.client=i,(0,p.default)(l(o),"eventsByUs",new Map),(0,p.default)(l(o),"eventsByThem",new Map),(0,p.default)(l(o),"_observeOnly",!1),(0,p.default)(l(o),"timeoutTimer",null),(0,p.default)(l(o),"_accepting",!1),(0,p.default)(l(o),"_declining",!1),(0,p.default)(l(o),"verifierHasFinished",!1),(0,p.default)(l(o),"_cancelled",!1),(0,p.default)(l(o),"_chosenMethod",null),(0,p.default)(l(o),"_qrCodeData",null),(0,p.default)(l(o),"requestReceivedAt",null),(0,p.default)(l(o),"commonMethods",[]),(0,p.default)(l(o),"_phase",void 0),(0,p.default)(l(o),"_cancellingUserId",void 0),(0,p.default)(l(o),"_verifier",void 0),(0,p.default)(l(o),"cancelOnTimeout",(function(){try{o.initiatedByMe?o.cancel({reason:"Other party didn't accept in time",code:"m.timeout"}):o.cancel({reason:"User didn't accept in time",code:"m.timeout"})}catch(e){v.logger.error("Error while cancelling verification request",e)}})),o.channel.request=l(o),o.setPhase(I,!1),o}return c(n,[{key:"invalid",get:function(){return this.phase===I}},{key:"requested",get:function(){return this.phase===T}},{key:"cancelled",get:function(){return this.phase===C}},{key:"ready",get:function(){return this.phase===R}},{key:"started",get:function(){return this.phase===O}},{key:"done",get:function(){return this.phase===P}},{key:"methods",get:function(){return this.commonMethods}},{key:"chosenMethod",get:function(){return this._chosenMethod}},{key:"calculateEventTimeout",value:function(e){var t=this.channel.getTimestamp(e)+6e5;if(this.requestReceivedAt&&!this.initiatedByMe&&this.phase<=T){var n=this.requestReceivedAt+12e4;t=Math.min(t,n)}return Math.max(0,t-Date.now())}},{key:"timeout",get:function(){var e=this.getEventByEither(b);return e?this.calculateEventTimeout(e):0}},{key:"requestEvent",get:function(){return this.getEventByEither(b)}},{key:"phase",get:function(){return this._phase}},{key:"verifier",get:function(){return this._verifier}},{key:"canAccept",get:function(){return this.phase<R&&!this._accepting&&!this._declining}},{key:"accepting",get:function(){return this._accepting}},{key:"declining",get:function(){return this._declining}},{key:"pending",get:function(){return!this.observeOnly&&this._phase!==P&&this._phase!==C}},{key:"qrCodeData",get:function(){return this._qrCodeData}},{key:"otherPartySupportsMethod",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t&&!this.ready&&!this.started)return!1;var n=this.eventsByThem.get(b)||this.eventsByThem.get(x);if(!n){if(this.started&&this.initiatedByMe){var r=this.eventsByUs.get(S),i=r&&r.getContent(),o=i&&i.method;return e==o}return!1}var a=n.getContent();if(!a)return!1;var s=a.methods;return!!Array.isArray(s)&&s.includes(e)}},{key:"initiatedByMe",get:function(){var e=this.eventsByUs.size+this.eventsByThem.size===0;if(this._phase===I&&e)return!0;var t=this.eventsByUs.has(b),n=this.eventsByThem.has(b);if(t&&!n)return!0;if(!t&&n)return!1;var r=this.eventsByUs.has(S),i=this.eventsByThem.has(S);return!(!r||i)}},{key:"requestingUserId",get:function(){return this.initiatedByMe?this.client.getUserId():this.otherUserId}},{key:"receivingUserId",get:function(){return this.initiatedByMe?this.otherUserId:this.client.getUserId()}},{key:"otherUserId",get:function(){return this.channel.userId}},{key:"isSelfVerification",get:function(){return this.client.getUserId()===this.otherUserId}},{key:"cancellingUserId",get:function(){var e=this.eventsByUs.get(w),t=this.eventsByThem.get(w);return e&&(!t||e.getId()<t.getId())?e.getSender():t?t.getSender():void 0}},{key:"cancellationCode",get:function(){var e=this.getEventByEither(w);return e?e.getContent().code:null}},{key:"observeOnly",get:function(){return this._observeOnly}},{key:"targetDevice",get:function(){var e=(this.eventsByThem.get(b)||this.eventsByThem.get(x)||this.eventsByThem.get(S)).getContent().from_device;return{userId:this.otherUserId,deviceId:e}}},{key:"beginKeyVerification",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!this.observeOnly&&!this._verifier){var n=this.phase===T||this.phase===R||this.phase===I&&this.channel.canCreateRequest(S);if(n){if(this.commonMethods.length&&!this.commonMethods.includes(e))throw(0,y.newUnknownMethodError)();if(this._verifier=this.createVerifier(e,null,t),!this._verifier)throw(0,y.newUnknownMethodError)();this._chosenMethod=e}}return this._verifier}},{key:"sendRequest",value:function(){var e=s(o.mark((function e(){var t;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.observeOnly||this._phase!==I){e.next=4;break}return t=a(this.verificationMethods.keys()),e.next=4,this.channel.send(b,{methods:t});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"cancel",value:function(){var e=s(o.mark((function e(){var t,n,r,i,a,s=arguments;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:{},n=t.reason,r=void 0===n?"User declined":n,i=t.code,a=void 0===i?"m.user":i,this.observeOnly||this._phase===C){e.next=11;break}if(this._declining=!0,this.emit("change"),!this._verifier){e.next=8;break}return e.abrupt("return",this._verifier.cancel((0,y.errorFactory)(a,r)()));case 8:return this._cancellingUserId=this.client.getUserId(),e.next=11,this.channel.send(w,{code:a,reason:r});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"accept",value:function(){var e=s(o.mark((function e(){var t;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.observeOnly||this.phase!==T||this.initiatedByMe){e.next=6;break}return t=a(this.verificationMethods.keys()),this._accepting=!0,this.emit("change"),e.next=6,this.channel.send(x,{methods:t});case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"waitFor",value:function(e){var t=this;return new Promise((function(n,r){var i=function i(){var o=!1;return e(t)?(n(t),o=!0):t.cancelled&&(r(new Error("cancelled")),o=!0),o&&t.off("change",i),o};i()||t.on("change",i)}))}},{key:"setPhase",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._phase=e,t&&this.emit("change")}},{key:"getEventByEither",value:function(e){return this.eventsByThem.get(e)||this.eventsByUs.get(e)}},{key:"getEventBy",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?this.eventsByThem.get(e):this.eventsByUs.get(e)}},{key:"calculatePhaseTransitions",value:function(){var e=[{phase:I}],t=function(){return e[e.length-1].phase},n=this.eventsByThem.has(b),r=this.getEventBy(b,n);r&&e.push({phase:T,event:r});var i,o=r&&this.getEventBy(x,!n);if(o&&t()===T&&e.push({phase:R,event:o}),o||!r){var a=this.eventsByThem.get(S),s=this.eventsByUs.get(S);i=a&&s?a.getSender()<s.getSender()?a:s:a||s}else i=this.getEventBy(S,!n);if(i){var u=t()===T&&r.getSender()!==i.getSender(),c=t()===I&&this.channel.canCreateRequest(S);(u||t()===R||c)&&e.push({phase:O,event:i})}var l=this.eventsByUs.get(E);(this.verifierHasFinished||l&&t()===O)&&e.push({phase:P});var d=this.getEventByEither(w);return(this._cancelled||d)&&t()!==P?(e.push({phase:C,event:d}),e):e}},{key:"transitionToPhase",value:function(e){var t=this,n=e.phase,r=e.event;if((n===T||n===R)&&!this.wasSentByOwnDevice(r)){var i=r.getContent();this.commonMethods=i.methods.filter((function(e){return t.verificationMethods.has(e)}))}if(this.observeOnly||n!==T&&n!==O&&n!==R||this.channel.receiveStartFromOtherDevices&&this.wasSentByOwnUser(r)&&!this.wasSentByOwnDevice(r)&&(this._observeOnly=!0),n===O){var o=r.getContent().method;this._verifier||this.observeOnly||(this._verifier=this.createVerifier(o,r),this._verifier?this._chosenMethod=o:this.cancel({code:"m.unknown_method",reason:"Unknown method: ".concat(o)}))}}},{key:"applyPhaseTransitions",value:function(){var e,t=this,n=this.calculatePhaseTransitions(),r=n.findIndex((function(e){return e.phase===t.phase})),o=n.slice(r+1),a=i(o);try{for(a.s();!(e=a.n()).done;){var s=e.value;this.transitionToPhase(s)}}catch(u){a.e(u)}finally{a.f()}return o}},{key:"isWinningStartRace",value:function(e){if(e.getType()!==S)return!1;var t,n,r=this._verifier.startEvent;if(this.isSelfVerification)if(r){var i=r.getContent();t=i&&i.from_device}else t=this.client.getDeviceId();else t=r?r.getSender():this.client.getUserId();if(this.isSelfVerification){var o=e.getContent();n=o&&o.from_device}else n=e.getSender();return n<t}},{key:"hasEventId",value:function(e){var t,n=i(this.eventsByUs.values());try{for(n.s();!(t=n.n()).done;){if(t.value.getId()===e)return!0}}catch(a){n.e(a)}finally{n.f()}var r,o=i(this.eventsByThem.values());try{for(o.s();!(r=o.n()).done;){if(r.value.getId()===e)return!0}}catch(a){o.e(a)}finally{o.f()}return!1}},{key:"handleEvent",value:function(){var e=s(o.mark((function e(t,n,r,i,a){var s,u,c,l,d,f,h;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.done&&!this.cancelled){e.next=2;break}return e.abrupt("return");case 2:if(s=this._observeOnly,this.adjustObserveOnly(n,r),this.observeOnly||i){e.next=9;break}return e.next=7,this.cancelOnError(t,n);case 7:if(!e.sent){e.next=9;break}return e.abrupt("return");case 9:if(!(a?this.eventsByUs.has(t):this.eventsByThem.has(t))){e.next=12;break}return e.abrupt("return");case 12:if(u=this.phase,this.addEvent(t,n,a),c=this.applyPhaseTransitions(),e.prev=15,this._verifier&&!this.observeOnly&&(l=this.isWinningStartRace(n),this._verifier.canSwitchStartEvent(n)&&l?this._verifier.switchStartEvent(n):i||(t===w||null!==(d=this._verifier.events)&&void 0!==d&&d.includes(t))&&this._verifier.handleEvent(n)),!c.length){e.next=30;break}if(!r||!c.some((function(e){return e.phase===R}))){e.next=24;break}if(!this.otherPartySupportsMethod(m.SCAN_QR_CODE_METHOD,!0)){e.next=24;break}return e.next=23,m.QRCodeData.create(this,this.client);case 23:this._qrCodeData=e.sent;case 24:f=c[c.length-1],h=f.phase,this.setupTimeout(h),this.setPhase(h),e.next=31;break;case 30:this._observeOnly!==s&&this.emit("change");case 31:return e.prev=31,v.logger.log("Verification request ".concat(this.channel.transactionId,": ")+"".concat(t," event with id:").concat(n.getId(),", ")+"content:".concat(JSON.stringify(n.getContent())," ")+"deviceId:".concat(this.channel.deviceId,", ")+"sender:".concat(n.getSender(),", isSentByUs:").concat(a,", ")+"isLiveEvent:".concat(r,", isRemoteEcho:").concat(i,", ")+"phase:".concat(u,"=>").concat(this.phase,", ")+"observeOnly:".concat(s,"=>").concat(this._observeOnly)),e.finish(31);case 34:case"end":return e.stop()}}),e,this,[[15,,31,34]])})));return function(t,n,r,i,o){return e.apply(this,arguments)}}()},{key:"setupTimeout",value:function(e){(!this.timeoutTimer&&!this.observeOnly&&e===T&&(this.timeoutTimer=setTimeout(this.cancelOnTimeout,this.timeout)),this.timeoutTimer)&&((e===O||e===R||e===P||e===C)&&(clearTimeout(this.timeoutTimer),this.timeoutTimer=null))}},{key:"cancelOnError",value:function(){var e=s(o.mark((function e(t,n){var r,i,a,s;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==S){e.next=6;break}if(r=n.getContent().method,this.verificationMethods.has(r)){e.next=6;break}return e.next=5,this.cancel((0,y.errorFromEvent)((0,y.newUnknownMethodError)()));case 5:return e.abrupt("return",!0);case 6:if(i=t===b&&this.phase!==I,a=t===x&&this.phase!==T,this.phase===I||!i&&!a){e.next=14;break}return v.logger.warn("Cancelling, unexpected ".concat(t," verification ")+"event from ".concat(n.getSender())),s="Unexpected ".concat(t," event in phase ").concat(this.phase),e.next=13,this.cancel((0,y.errorFromEvent)((0,y.newUnexpectedMessageError)({reason:s})));case 13:return e.abrupt("return",!0);case 14:return e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"adjustObserveOnly",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t||(this._observeOnly=!0),this.calculateEventTimeout(e)<3e3&&(this._observeOnly=!0)}},{key:"addEvent",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n?this.eventsByUs.set(e,t):this.eventsByThem.set(e,t),e===b){var o,a=i(this.eventsByThem.entries());try{for(a.s();!(o=a.n()).done;){var s=r(o.value,2),u=s[0],c=s[1];c.getSender()!==this.otherUserId&&this.eventsByThem.delete(u)}}catch(l){a.e(l)}finally{a.f()}this.requestReceivedAt=Date.now()}}},{key:"createVerifier",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;n||(n=this.targetDevice);var r=n,i=r.userId,o=r.deviceId,a=this.verificationMethods.get(e);if(a)return new a(this.channel,this.client,i,o,t,this);v.logger.warn("could not find verifier constructor for method",e)}},{key:"wasSentByOwnUser",value:function(e){return e.getSender()===this.client.getUserId()}},{key:"wasSentByOwnDevice",value:function(e){if(!this.wasSentByOwnUser(e))return!1;var t=e.getContent();return!(!t||t.from_device!==this.client.getDeviceId())}},{key:"onVerifierCancelled",value:function(){this._cancelled=!0;var e=this.applyPhaseTransitions();e.length&&this.setPhase(e[e.length-1].phase)}},{key:"onVerifierFinished",value:function(){this.channel.send("m.key.verification.done",{}),this.verifierHasFinished=!0;var e=this.applyPhaseTransitions();e.length&&this.setPhase(e[e.length-1].phase)}},{key:"getEventFromOtherParty",value:function(e){return this.eventsByThem.get(e)}}],[{key:"validateEvent",value:function(e,t,n){var r=t.getContent();return!(!e||!e.startsWith(k))&&(r?e!==b&&e!==x||Array.isArray(r.methods)?e!==b&&e!==x&&e!==S||"string"===typeof r.from_device&&0!==r.from_device.length||(v.logger.log("VerificationRequest: validateEvent: fail because from_device"),!1):(v.logger.log("VerificationRequest: validateEvent: fail because methods"),!1):(v.logger.log("VerificationRequest: validateEvent: no content"),!1))}}]),n}(g.EventEmitter);t.VerificationRequest=D},function(e,t,n){"use strict";var r,i=SyntaxError,o=Function,a=TypeError,s=function(e){try{return o('"use strict"; return ('+e+").constructor;")()}catch(t){}},u=Object.getOwnPropertyDescriptor;if(u)try{u({},"")}catch(R){u=null}var c=function(){throw new a},l=u?function(){try{return c}catch(e){try{return u(arguments,"callee").get}catch(t){return c}}}():c,d=n(169)(),f=Object.getPrototypeOf||function(e){return e.__proto__},h={},p="undefined"===typeof Uint8Array?r:f(Uint8Array),v={"%AggregateError%":"undefined"===typeof AggregateError?r:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"===typeof ArrayBuffer?r:ArrayBuffer,"%ArrayIteratorPrototype%":d?f([][Symbol.iterator]()):r,"%AsyncFromSyncIteratorPrototype%":r,"%AsyncFunction%":h,"%AsyncGenerator%":h,"%AsyncGeneratorFunction%":h,"%AsyncIteratorPrototype%":h,"%Atomics%":"undefined"===typeof Atomics?r:Atomics,"%BigInt%":"undefined"===typeof BigInt?r:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"===typeof DataView?r:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"===typeof Float32Array?r:Float32Array,"%Float64Array%":"undefined"===typeof Float64Array?r:Float64Array,"%FinalizationRegistry%":"undefined"===typeof FinalizationRegistry?r:FinalizationRegistry,"%Function%":o,"%GeneratorFunction%":h,"%Int8Array%":"undefined"===typeof Int8Array?r:Int8Array,"%Int16Array%":"undefined"===typeof Int16Array?r:Int16Array,"%Int32Array%":"undefined"===typeof Int32Array?r:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":d?f(f([][Symbol.iterator]())):r,"%JSON%":"object"===typeof JSON?JSON:r,"%Map%":"undefined"===typeof Map?r:Map,"%MapIteratorPrototype%":"undefined"!==typeof Map&&d?f((new Map)[Symbol.iterator]()):r,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"===typeof Promise?r:Promise,"%Proxy%":"undefined"===typeof Proxy?r:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"===typeof Reflect?r:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"===typeof Set?r:Set,"%SetIteratorPrototype%":"undefined"!==typeof Set&&d?f((new Set)[Symbol.iterator]()):r,"%SharedArrayBuffer%":"undefined"===typeof SharedArrayBuffer?r:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":d?f(""[Symbol.iterator]()):r,"%Symbol%":d?Symbol:r,"%SyntaxError%":i,"%ThrowTypeError%":l,"%TypedArray%":p,"%TypeError%":a,"%Uint8Array%":"undefined"===typeof Uint8Array?r:Uint8Array,"%Uint8ClampedArray%":"undefined"===typeof Uint8ClampedArray?r:Uint8ClampedArray,"%Uint16Array%":"undefined"===typeof Uint16Array?r:Uint16Array,"%Uint32Array%":"undefined"===typeof Uint32Array?r:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"===typeof WeakMap?r:WeakMap,"%WeakRef%":"undefined"===typeof WeakRef?r:WeakRef,"%WeakSet%":"undefined"===typeof WeakSet?r:WeakSet},g=function e(t){var n;if("%AsyncFunction%"===t)n=s("async function () {}");else if("%GeneratorFunction%"===t)n=s("function* () {}");else if("%AsyncGeneratorFunction%"===t)n=s("async function* () {}");else if("%AsyncGenerator%"===t){var r=e("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if("%AsyncIteratorPrototype%"===t){var i=e("%AsyncGenerator%");i&&(n=f(i.prototype))}return v[t]=n,n},y={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},m=n(60),k=n(172),b=m.call(Function.call,Array.prototype.concat),S=m.call(Function.apply,Array.prototype.splice),w=m.call(Function.call,String.prototype.replace),E=m.call(Function.call,String.prototype.slice),_=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,x=/\\(\\)?/g,I=function(e){var t=E(e,0,1),n=E(e,-1);if("%"===t&&"%"!==n)throw new i("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==t)throw new i("invalid intrinsic syntax, expected opening `%`");var r=[];return w(e,_,(function(e,t,n,i){r[r.length]=n?w(i,x,"$1"):t||e})),r},T=function(e,t){var n,r=e;if(k(y,r)&&(r="%"+(n=y[r])[0]+"%"),k(v,r)){var o=v[r];if(o===h&&(o=g(r)),"undefined"===typeof o&&!t)throw new a("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:o}}throw new i("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!==typeof e||0===e.length)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!==typeof t)throw new a('"allowMissing" argument must be a boolean');var n=I(e),r=n.length>0?n[0]:"",o=T("%"+r+"%",t),s=o.name,c=o.value,l=!1,d=o.alias;d&&(r=d[0],S(n,b([0,1],d)));for(var f=1,h=!0;f<n.length;f+=1){var p=n[f],g=E(p,0,1),y=E(p,-1);if(('"'===g||"'"===g||"`"===g||'"'===y||"'"===y||"`"===y)&&g!==y)throw new i("property names with quotes must have matching quotes");if("constructor"!==p&&h||(l=!0),k(v,s="%"+(r+="."+p)+"%"))c=v[s];else if(null!=c){if(!(p in c)){if(!t)throw new a("base intrinsic for "+e+" exists, but the property is not available.");return}if(u&&f+1>=n.length){var m=u(c,p);c=(h=!!m)&&"get"in m&&!("originalValue"in m.get)?m.get:c[p]}else h=k(c,p),c=c[p];h&&!l&&(v[s]=c)}}return c}},function(e,t,n){"use strict";var r=n(171);e.exports=Function.prototype.bind||r},function(e,t,n){"use strict";var r=String.prototype.replace,i=/%20/g,o="RFC1738",a="RFC3986";e.exports={default:a,formatters:{RFC1738:function(e){return r.call(e,i,"+")},RFC3986:function(e){return String(e)}},RFC1738:o,RFC3986:a}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(35);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}},function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}},function(e,t,n){var r=n(47),i=n(65);function o(t,n,a){return i()?e.exports=o=Reflect.construct:e.exports=o=function(e,t,n){var i=[null];i.push.apply(i,t);var o=new(Function.bind.apply(e,i));return n&&r(o,n.prototype),o},o.apply(null,arguments)}e.exports=o},function(e,t){e.exports=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}},function(e,t,n){"use strict";var r=n(6),i=n(7),o=n(106),a=n(0),s=n(9),u=n(10),c=n(25),l=n(110),d=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"],f=function(e){s(n,e);var t=u(n);function n(e){var r;(a(this,n),r=t.call(this),e instanceof Error)?(r.originalError=e,e=e.message):(r.originalError=new Error(e),r.originalError.stack=r.stack);return r.name="AbortError",r.message=e,r}return n}(c(Error)),h=function(e,t,n){var r=n.retries-(t-1);return e.attemptNumber=t,e.retriesLeft=r,e},p=function(e,t){return new Promise((function(n,a){t=o({onFailedAttempt:function(){},retries:10},t);var s=l.operation(t);s.attempt(function(){var o=i(r.mark((function i(o){return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.t0=n,r.next=4,e(o);case 4:r.t1=r.sent,(0,r.t0)(r.t1),r.next=34;break;case 8:if(r.prev=8,r.t2=r.catch(0),r.t2 instanceof Error){r.next=13;break}return a(new TypeError('Non-error was thrown: "'.concat(r.t2,'". You should only throw errors.'))),r.abrupt("return");case 13:if(!(r.t2 instanceof f)){r.next=18;break}s.stop(),a(r.t2.originalError),r.next=34;break;case 18:if(!(r.t2 instanceof TypeError)||(i=r.t2.message,d.includes(i))){r.next=23;break}s.stop(),a(r.t2),r.next=34;break;case 23:return h(r.t2,o,t),r.prev=24,r.next=27,t.onFailedAttempt(r.t2);case 27:r.next=33;break;case 29:return r.prev=29,r.t3=r.catch(24),a(r.t3),r.abrupt("return");case 33:s.retry(r.t2)||a(s.mainError());case 34:case"end":return r.stop()}var i}),i,null,[[0,8],[24,29]])})));return function(e){return o.apply(this,arguments)}}())}))};e.exports=p,e.exports.default=p,e.exports.AbortError=f},function(e,t,n){"use strict";var r=n(0),i=n(2),o=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.MemoryStore=void 0;var a=o(n(3)),s=n(31);function u(e){return"string"===typeof e&&!!e&&"undefined"!==e&&"null"!==e||"number"===typeof e}var c=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e),(0,a.default)(this,"rooms",{}),(0,a.default)(this,"groups",{}),(0,a.default)(this,"users",{}),(0,a.default)(this,"syncToken",null),(0,a.default)(this,"filters",{}),(0,a.default)(this,"accountData",{}),(0,a.default)(this,"localStorage",void 0),(0,a.default)(this,"oobMembers",{}),(0,a.default)(this,"clientOptions",{}),(0,a.default)(this,"onRoomMember",(function(e,n,r){if("invite"!==r.membership){var i=t.users[r.userId]||new s.User(r.userId);r.name&&(i.setDisplayName(r.name),r.events.member&&i.setRawDisplayName(r.events.member.getDirectionalContent().displayname)),r.events.member&&r.events.member.getContent().avatar_url&&i.setAvatarUrl(r.events.member.getContent().avatar_url),t.users[i.userId]=i}})),this.localStorage=n.localStorage}return i(e,[{key:"getSyncToken",value:function(){return this.syncToken}},{key:"isNewlyCreated",value:function(){return Promise.resolve(!0)}},{key:"setSyncToken",value:function(e){this.syncToken=e}},{key:"storeGroup",value:function(e){this.groups[e.groupId]=e}},{key:"getGroup",value:function(e){return this.groups[e]||null}},{key:"getGroups",value:function(){return Object.values(this.groups)}},{key:"storeRoom",value:function(e){var t=this;this.rooms[e.roomId]=e,e.currentState.on("RoomState.members",this.onRoomMember),e.currentState.getMembers().forEach((function(n){t.onRoomMember(null,e.currentState,n)}))}},{key:"getRoom",value:function(e){return this.rooms[e]||null}},{key:"getRooms",value:function(){return Object.values(this.rooms)}},{key:"removeRoom",value:function(e){this.rooms[e]&&this.rooms[e].removeListener("RoomState.members",this.onRoomMember),delete this.rooms[e]}},{key:"getRoomSummaries",value:function(){return Object.values(this.rooms).map((function(e){return e.summary}))}},{key:"storeUser",value:function(e){this.users[e.userId]=e}},{key:"getUser",value:function(e){return this.users[e]||null}},{key:"getUsers",value:function(){return Object.values(this.users)}},{key:"scrollback",value:function(e,t){return[]}},{key:"storeEvents",value:function(e,t,n,r){}},{key:"storeFilter",value:function(e){e&&(this.filters[e.userId]||(this.filters[e.userId]={}),this.filters[e.userId][e.filterId]=e)}},{key:"getFilter",value:function(e,t){return this.filters[e]&&this.filters[e][t]?this.filters[e][t]:null}},{key:"getFilterIdByName",value:function(e){if(!this.localStorage)return null;var t="mxjssdk_memory_filter_"+e;try{var n=this.localStorage.getItem(t);if(u(n))return n}catch(r){}return null}},{key:"setFilterIdByName",value:function(e,t){if(this.localStorage){var n="mxjssdk_memory_filter_"+e;try{u(t)?this.localStorage.setItem(n,t):this.localStorage.removeItem(n)}catch(r){}}}},{key:"storeAccountDataEvents",value:function(e){var t=this;e.forEach((function(e){t.accountData[e.getType()]=e}))}},{key:"getAccountData",value:function(e){return this.accountData[e]}},{key:"setSyncData",value:function(e){return Promise.resolve()}},{key:"wantsSave",value:function(){return!1}},{key:"save",value:function(e){}},{key:"startup",value:function(){return Promise.resolve()}},{key:"getSavedSync",value:function(){return Promise.resolve(null)}},{key:"getSavedSyncToken",value:function(){return Promise.resolve(null)}},{key:"deleteAllData",value:function(){return this.rooms={},this.users={},this.syncToken=null,this.filters={},this.accountData={},Promise.resolve()}},{key:"getOutOfBandMembers",value:function(e){return Promise.resolve(this.oobMembers[e]||null)}},{key:"setOutOfBandMembers",value:function(e,t){return this.oobMembers[e]=t,Promise.resolve()}},{key:"clearOutOfBandMembers",value:function(e){return this.oobMembers={},Promise.resolve()}},{key:"getClientOptions",value:function(){return Promise.resolve(this.clientOptions)}},{key:"storeClientOptions",value:function(e){return this.clientOptions=Object.assign({},e),Promise.resolve()}}]),e}();t.MemoryStore=c},function(e,t,n){"use strict";var r=n(9),i=n(10),o=n(0),a=n(2);Object.defineProperty(t,"__esModule",{value:!0}),t.UnstableValue=t.NamespacedValue=void 0;var s=function(){function e(t,n){if(o(this,e),this.stable=t,this.unstable=n,!this.unstable&&!this.stable)throw new Error("One of stable or unstable values must be supplied")}return a(e,[{key:"name",get:function(){return this.stable?this.stable:this.unstable}},{key:"altName",get:function(){return this.stable?this.unstable:null}},{key:"matches",value:function(e){return this.name===e||this.altName===e}},{key:"findIn",value:function(e){var t;return this.name&&(t=null===e||void 0===e?void 0:e[this.name]),!t&&this.altName&&(t=null===e||void 0===e?void 0:e[this.altName]),t}},{key:"includedIn",value:function(e){var t=!1;return this.name&&(t=e.includes(this.name)),!t&&this.altName&&(t=e.includes(this.altName)),t}}]),e}();t.NamespacedValue=s;var u=function(e){r(n,e);var t=i(n);function n(e,r){var i;if(o(this,n),!(i=t.call(this,e,r)).unstable)throw new Error("Unstable value must be supplied");return i}return a(n,[{key:"name",get:function(){return this.unstable}},{key:"altName",get:function(){return this.stable}}]),n}(s);t.UnstableValue=u},function(e,t,n){"use strict";var r=n(13),i=n(8),o=n(6),a=n(7),s=n(0),u=n(2),c=n(11),l=n(9),d=n(10),f=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.Room=t.NotificationCountType=void 0;var h=f(n(3)),p=n(15),v=n(48),g=n(23),y=n(37),m=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=T(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}r.default=e,n&&n.set(e,r);return r}(n(12)),k=n(18),b=n(49),S=n(117),w=n(5),E=n(38),_=n(17),x=n(36),I=n(72);function T(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(T=function(e){return e?n:t})(e)}function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach((function(t){(0,h.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var C,P=["1","2","3","4","5","6"];function D(e,t,n){var r={content:{},type:"m.receipt",room_id:t.getRoomId()};return r.content[t.getId()]={},r.content[t.getId()][n]={},r.content[t.getId()][n][e]={ts:t.getTs()},new k.MatrixEvent(r)}t.NotificationCountType=C,function(e){e.Highlight="highlight",e.Total="total"}(C||(t.NotificationCountType=C={}));var A=function(e){l(n,e);var t=d(n);function n(e,r,i){var u,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(s(this,n),(u=t.call(this)).roomId=e,u.client=r,u.myUserId=i,u.opts=l,(0,h.default)(c(u),"reEmitter",void 0),(0,h.default)(c(u),"txnToEvent",{}),(0,h.default)(c(u),"receipts",{}),(0,h.default)(c(u),"receiptCacheByEventId",{}),(0,h.default)(c(u),"realReceipts",{}),(0,h.default)(c(u),"notificationCounts",{}),(0,h.default)(c(u),"timelineSets",void 0),(0,h.default)(c(u),"filteredTimelineSets",{}),(0,h.default)(c(u),"pendingEventList",void 0),(0,h.default)(c(u),"blacklistUnverifiedDevices",null),(0,h.default)(c(u),"selfMembership",null),(0,h.default)(c(u),"summaryHeroes",null),(0,h.default)(c(u),"getTypeWarning",!1),(0,h.default)(c(u),"getVersionWarning",!1),(0,h.default)(c(u),"membersPromise",void 0),(0,h.default)(c(u),"name",void 0),(0,h.default)(c(u),"normalizedName",void 0),(0,h.default)(c(u),"tags",{}),(0,h.default)(c(u),"accountData",{}),(0,h.default)(c(u),"summary",null),(0,h.default)(c(u),"storageToken",void 0),(0,h.default)(c(u),"timeline",void 0),(0,h.default)(c(u),"oldState",void 0),(0,h.default)(c(u),"currentState",void 0),(0,h.default)(c(u),"threads",new Map),u.setMaxListeners(100),u.reEmitter=new E.ReEmitter(c(u)),l.pendingEventOrdering=l.pendingEventOrdering||x.PendingEventOrdering.Chronological,-1===["chronological","detached"].indexOf(l.pendingEventOrdering))throw new Error("opts.pendingEventOrdering MUST be either 'chronological' or 'detached'. Got: '"+l.pendingEventOrdering+"'");if(u.name=e,u.timelineSets=[new v.EventTimelineSet(c(u),l)],u.reEmitter.reEmit(u.getUnfilteredTimelineSet(),["Room.timeline","Room.timelineReset"]),u.fixUpLegacyTimelineFields(),"detached"==u.opts.pendingEventOrdering){u.pendingEventList=[];var d=r.sessionStore.store.getItem(M(u.roomId));d&&JSON.parse(d).forEach(function(){var e=a(o.mark((function e(t){var n;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=new k.MatrixEvent(t)).getType()!==_.EventType.RoomMessageEncrypted){e.next=4;break}return e.next=4,n.attemptDecryption(u.client.crypto);case 4:n.setStatus(k.EventStatus.NOT_SENT),u.addPendingEvent(n,n.getTxnId());case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}return u.opts.lazyLoadMembers?u.membersPromise=null:u.membersPromise=Promise.resolve(!1),u}return u(n,[{key:"decryptCriticalEvents",value:function(){var e=this,t=this.getEventReadUpTo(this.client.getUserId(),!0),n=this.getLiveTimeline().getEvents(),r=n.findIndex((function(e){return e.event.event_id===t})),i=n.slice(r).filter((function(e){return e.shouldAttemptDecryption()})).reverse().map((function(t){return t.attemptDecryption(e.client.crypto,{isRetry:!0})}));return Promise.allSettled(i)}},{key:"decryptAllEvents",value:function(){var e=this,t=this.getUnfilteredTimelineSet().getLiveTimeline().getEvents().filter((function(e){return e.shouldAttemptDecryption()})).reverse().map((function(t){return t.attemptDecryption(e.client.crypto,{isRetry:!0})}));return Promise.allSettled(t)}},{key:"getVersion",value:function(){var e=this.currentState.getStateEvents(_.EventType.RoomCreate,"");if(!e)return this.getVersionWarning||(w.logger.warn("[getVersion] Room "+this.roomId+" does not have an m.room.create event"),this.getVersionWarning=!0),"1";var t=e.getContent().room_version;return void 0===t?"1":t}},{key:"shouldUpgradeToVersion",value:function(){return P.includes(this.getVersion())?null:"6"}},{key:"getRecommendedVersion",value:function(){var e=a(o.mark((function e(){var t,n,r,a,s,u,c;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.getCapabilities();case 2:if(t=e.sent,!(n=t["m.room_versions"])){n={default:"6",available:{}},r=i(P);try{for(r.s();!(a=r.n()).done;)s=a.value,n.available[s]=x.RoomVersionStability.Stable}catch(o){r.e(o)}finally{r.f()}}if(!(u=this.checkVersionAgainstCapability(n)).urgent||!u.needsUpgrade){e.next=18;break}return w.logger.warn("Refreshing room version capability because the server looks to be supporting a newer room version we don't know about."),e.next=10,this.client.getCapabilities(!0);case 10:if(c=e.sent,n=c["m.room_versions"]){e.next=17;break}return w.logger.warn("No room version capability - assuming upgrade required."),e.abrupt("return",u);case 17:u=this.checkVersionAgainstCapability(n);case 18:return e.abrupt("return",u);case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"checkVersionAgainstCapability",value:function(e){var t=this.getVersion();w.logger.log("[".concat(this.roomId,"] Current version: ").concat(t)),w.logger.log("[".concat(this.roomId,"] Version capability: "),e);var n={version:t,needsUpgrade:!1,urgent:!1};return t===e.default||Object.keys(e.available).filter((function(t){return"stable"===e.available[t]})).includes(t)||(n.version=e.default,n.needsUpgrade=!0,n.urgent=!!this.getVersion().match(/^[0-9]+[0-9.]*$/g),n.urgent?w.logger.warn("URGENT upgrade required on ".concat(this.roomId)):w.logger.warn("Non-urgent upgrade required on ".concat(this.roomId))),n}},{key:"userMayUpgradeRoom",value:function(e){return this.currentState.maySendStateEvent(_.EventType.RoomTombstone,e)}},{key:"getPendingEvents",value:function(){if("detached"!==this.opts.pendingEventOrdering)throw new Error("Cannot call getPendingEvents with pendingEventOrdering == "+this.opts.pendingEventOrdering);return this.pendingEventList}},{key:"removePendingEvent",value:function(e){if("detached"!==this.opts.pendingEventOrdering)throw new Error("Cannot call removePendingEvent with pendingEventOrdering == "+this.opts.pendingEventOrdering);var t=m.removeElement(this.pendingEventList,(function(t){return t.getId()==e}),!1);return this.savePendingEvents(),t}},{key:"hasPendingEvent",value:function(e){return"detached"===this.opts.pendingEventOrdering&&this.pendingEventList.some((function(t){return t.getId()===e}))}},{key:"getPendingEvent",value:function(e){return"detached"!==this.opts.pendingEventOrdering?null:this.pendingEventList.find((function(t){return t.getId()===e}))}},{key:"getLiveTimeline",value:function(){return this.getUnfilteredTimelineSet().getLiveTimeline()}},{key:"getLastActiveTimestamp",value:function(){var e=this.getLiveTimeline().getEvents();return e.length?e[e.length-1].getTs():Number.MIN_SAFE_INTEGER}},{key:"getMyMembership",value:function(){return this.selfMembership}},{key:"getDMInviter",value:function(){if(this.myUserId){var e=this.getMember(this.myUserId);if(e)return e.getDMInviter()}if("invite"===this.selfMembership&&(2==this.getInvitedAndJoinedMemberCount()&&this.summaryHeroes.length))return this.summaryHeroes[0]}},{key:"guessDMUserId",value:function(){var e=this,t=this.getMember(this.myUserId);if(t){var n=t.getDMInviter();if(n)return n}if(Array.isArray(this.summaryHeroes)&&this.summaryHeroes.length)return this.summaryHeroes[0];var r=this.currentState.getMembers().find((function(t){return t.userId!==e.myUserId}));return r?r.userId:this.myUserId}},{key:"getAvatarFallbackMember",value:function(){var e=this;if(!(this.getInvitedAndJoinedMemberCount()>2)){var t=Array.isArray(this.summaryHeroes)&&this.summaryHeroes.length;if(t){var n=this.summaryHeroes.map((function(t){return e.getMember(t)})).find((function(e){return!!e}));if(n)return n}var r=this.currentState.getMembers();if(r.length<=2){var i=r.find((function(t){return t.userId!==e.myUserId}));if(i)return i}if(t){var o=this.summaryHeroes.map((function(t){return e.client.getUser(t)})).find((function(e){return!!e}));if(o){var a=new b.RoomMember(this.roomId,o.userId);return a.user=o,a}}}}},{key:"updateMyMembership",value:function(e){var t=this.selfMembership;this.selfMembership=e,t!==e&&("leave"===e&&this.cleanupAfterLeaving(),this.emit("Room.myMembership",this,e,t))}},{key:"loadMembersFromServer",value:function(){var e=a(o.mark((function e(){var t,n,r,i,a;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.client.store.getSyncToken(),n=m.encodeParams({not_membership:"leave",at:t}),r=m.encodeUri("/rooms/$roomId/members?"+n,{$roomId:this.roomId}),i=this.client.http,e.next=6,i.authedRequest(void 0,"GET",r);case 6:return a=e.sent,e.abrupt("return",a.chunk);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadMembers",value:function(){var e=a(o.mark((function e(){var t,n,r;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!1,e.next=3,this.client.store.getOutOfBandMembers(this.roomId);case 3:if(null!==(n=e.sent)){e.next=10;break}return t=!0,e.next=8,this.loadMembersFromServer();case 8:n=e.sent,w.logger.log("LL: got ".concat(n.length," ")+"members from server for room ".concat(this.roomId));case 10:return r=n.map(this.client.getEventMapper()),e.abrupt("return",{memberEvents:r,fromServer:t});case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadMembersIfNeeded",value:function(){var e=this;if(this.membersPromise)return this.membersPromise;this.currentState.markOutOfBandMembersStarted();var t=this.loadMembers().then((function(t){return e.currentState.setOutOfBandMembers(t.memberEvents),e.client.isCryptoEnabled()&&e.client.isRoomEncrypted(e.roomId)&&e.client.crypto.trackRoomDevices(e.roomId),t.fromServer})).catch((function(t){throw e.membersPromise=null,e.currentState.markOutOfBandMembersFailed(),t}));return t.then((function(t){if(t){var n=e.currentState.getMembers().filter((function(e){return e.isOutOfBand()})).map((function(e){return e.events.member.event}));return w.logger.log("LL: telling store to write ".concat(n.length)+" members for room ".concat(e.roomId)),e.client.store.setOutOfBandMembers(e.roomId,n).catch((function(e){w.logger.log("LL: storing OOB room members failed, oh well",e)}))}})).catch((function(e){w.logger.error(e)})),this.membersPromise=t,this.membersPromise}},{key:"clearLoadedMembersIfNeeded",value:function(){var e=a(o.mark((function e(){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.opts.lazyLoadMembers||!this.membersPromise){e.next=7;break}return e.next=3,this.loadMembersIfNeeded();case 3:return e.next=5,this.client.store.clearOutOfBandMembers(this.roomId);case 5:this.currentState.clearOutOfBandMembers(),this.membersPromise=null;case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"cleanupAfterLeaving",value:function(){var e=this;this.clearLoadedMembersIfNeeded().catch((function(t){w.logger.error("error after clearing loaded members from "+"room ".concat(e.roomId," after leaving")),w.logger.log(t)}))}},{key:"resetLiveTimeline",value:function(e,t){for(var n=0;n<this.timelineSets.length;n++)this.timelineSets[n].resetLiveTimeline(e,t);this.fixUpLegacyTimelineFields()}},{key:"fixUpLegacyTimelineFields",value:function(){this.timeline=this.getLiveTimeline().getEvents(),this.oldState=this.getLiveTimeline().getState(g.EventTimeline.BACKWARDS),this.currentState=this.getLiveTimeline().getState(g.EventTimeline.FORWARDS)}},{key:"hasUnverifiedDevices",value:function(){var e=a(o.mark((function e(){var t,n,r,a;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.client.isRoomEncrypted(this.roomId)){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,this.getEncryptionTargetMembers();case 4:t=e.sent,n=i(t),e.prev=6,n.s();case 8:if((r=n.n()).done){e.next=15;break}if(a=r.value,!this.client.getStoredDevicesForUser(a.userId).some((function(e){return e.isUnverified()}))){e.next=13;break}return e.abrupt("return",!0);case 13:e.next=8;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(6),n.e(e.t0);case 20:return e.prev=20,n.f(),e.finish(20);case 23:return e.abrupt("return",!1);case 24:case"end":return e.stop()}}),e,this,[[6,17,20,23]])})));return function(){return e.apply(this,arguments)}}()},{key:"getTimelineSets",value:function(){return this.timelineSets}},{key:"getUnfilteredTimelineSet",value:function(){return this.timelineSets[0]}},{key:"getTimelineForEvent",value:function(e){return this.getUnfilteredTimelineSet().getTimelineForEvent(e)}},{key:"addTimeline",value:function(){return this.getUnfilteredTimelineSet().addTimeline()}},{key:"findEventById",value:function(e){var t=this.getUnfilteredTimelineSet().findEventById(e);if(t)return t;for(var n=this.getThreads(),r=0;r<n.length;r++){if(t=n[r].findEventById(e))return t}}},{key:"getUnreadNotificationCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C.Total;return this.notificationCounts[e]}},{key:"setUnreadNotificationCount",value:function(e,t){this.notificationCounts[e]=t}},{key:"setSummary",value:function(e){var t=this,n=e["m.heroes"],r=e["m.joined_member_count"],i=e["m.invited_member_count"];Number.isInteger(r)&&this.currentState.setJoinedMemberCount(r),Number.isInteger(i)&&this.currentState.setInvitedMemberCount(i),Array.isArray(n)&&(this.summaryHeroes=n.filter((function(e){return e!==t.myUserId})))}},{key:"setBlacklistUnverifiedDevices",value:function(e){this.blacklistUnverifiedDevices=e}},{key:"getBlacklistUnverifiedDevices",value:function(){return this.blacklistUnverifiedDevices}},{key:"getAvatarUrl",value:function(e,t,n,r){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=this.currentState.getStateEvents(_.EventType.RoomAvatar,"");if(!o&&!i)return null;var a=o?o.getContent().url:null;return a?(0,y.getHttpUriForMxc)(e,a,t,n,r):null}},{key:"getMxcAvatarUrl",value:function(){var e,t;return(null===(e=this.currentState.getStateEvents(_.EventType.RoomAvatar,""))||void 0===e||null===(t=e.getContent())||void 0===t?void 0:t.url)||null}},{key:"getAliases",value:function(){var e=[],t=this.currentState.getStateEvents(_.EventType.RoomAliases);if(t)for(var n=function(n){var r=t[n];if(Array.isArray(r.getContent().aliases)){var i=r.getContent().aliases.filter((function(e){return"string"===typeof e&&("#"===e[0]&&!!e.endsWith(":".concat(r.getStateKey())))}));Array.prototype.push.apply(e,i)}},r=0;r<t.length;++r)n(r);return e}},{key:"getCanonicalAlias",value:function(){var e=this.currentState.getStateEvents(_.EventType.RoomCanonicalAlias,"");return e&&e.getContent().alias||null}},{key:"getAltAliases",value:function(){var e=this.currentState.getStateEvents(_.EventType.RoomCanonicalAlias,"");return e&&e.getContent().alt_aliases||[]}},{key:"addEventsToTimeline",value:function(e,t,n,r){n.getTimelineSet().addEventsToTimeline(e,t,n,r)}},{key:"getThread",value:function(e){return this.getThreads().find((function(t){return t.id===e}))}},{key:"getThreads",value:function(){return Array.from(this.threads.values())}},{key:"getMember",value:function(e){return this.currentState.getMember(e)}},{key:"getMembers",value:function(){return this.currentState.getMembers()}},{key:"getJoinedMembers",value:function(){return this.getMembersWithMembership("join")}},{key:"getJoinedMemberCount",value:function(){return this.currentState.getJoinedMemberCount()}},{key:"getInvitedMemberCount",value:function(){return this.currentState.getInvitedMemberCount()}},{key:"getInvitedAndJoinedMemberCount",value:function(){return this.getInvitedMemberCount()+this.getJoinedMemberCount()}},{key:"getMembersWithMembership",value:function(e){return this.currentState.getMembers().filter((function(t){return t.membership===e}))}},{key:"getEncryptionTargetMembers",value:function(){var e=a(o.mark((function e(){var t;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadMembersIfNeeded();case 2:return t=this.getMembersWithMembership("join"),this.shouldEncryptForInvitedMembers()&&(t=t.concat(this.getMembersWithMembership("invite"))),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"shouldEncryptForInvitedMembers",value:function(){var e,t=this.currentState.getStateEvents(_.EventType.RoomHistoryVisibility,"");return"joined"!==(null===t||void 0===t||null===(e=t.getContent())||void 0===e?void 0:e.history_visibility)}},{key:"getDefaultRoomName",value:function(e){return this.calculateRoomName(e,!0)}},{key:"hasMembershipState",value:function(e,t){var n=this.getMember(e);return!!n&&n.membership===t}},{key:"getOrCreateFilteredTimelineSet",value:function(e){if(this.filteredTimelineSets[e.filterId])return this.filteredTimelineSets[e.filterId];var t=Object.assign({filter:e},this.opts),n=new v.EventTimelineSet(this,t);this.reEmitter.reEmit(n,["Room.timeline","Room.timelineReset"]),this.filteredTimelineSets[e.filterId]=n,this.timelineSets.push(n);var r=this.getLiveTimeline();r.getEvents().forEach((function(e){n.addLiveEvent(e)}));for(var i=r;i.getNeighbouringTimeline(g.EventTimeline.BACKWARDS);)i=i.getNeighbouringTimeline(g.EventTimeline.BACKWARDS);return n.getLiveTimeline().setPaginationToken(i.getPaginationToken(g.EventTimeline.BACKWARDS),g.EventTimeline.BACKWARDS),n}},{key:"removeFilteredTimelineSet",value:function(e){var t=this.filteredTimelineSets[e.filterId];delete this.filteredTimelineSets[e.filterId];var n=this.timelineSets.indexOf(t);n>-1&&this.timelineSets.splice(n,1)}},{key:"findThreadForEvent",value:function(e){if(!e)return null;if(e.isThreadRelation)return this.threads.get(e.threadRootId);var t=this.findEventById(e.parentEventId);return this.findThreadForEvent(t)}},{key:"addThreadedEvent",value:function(e){var t=this.findThreadForEvent(e);if(t)t.addEvent(e);else{var n=[e],r=this.findEventById(e.threadRootId);r&&n.unshift(r),t=new I.Thread(n,this,this.client),this.reEmitter.reEmit(t,[I.ThreadEvent.Update,I.ThreadEvent.Ready]),this.threads.set(t.id,t),this.emit(I.ThreadEvent.New,t)}this.emit(I.ThreadEvent.Update,t)}},{key:"addLiveEvent",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.isRedaction()){var r=e.event.redacts,i=this.findEventById(r);if(i){if(i.makeRedacted(e),i.getStateKey()){var o=this.currentState.getStateEvents(i.getType(),i.getStateKey());o.getId()===i.getId()&&this.currentState.setStateEvents([i])}this.emit("Room.redaction",e,this)}}if(e.getUnsigned().transaction_id){var a=this.txnToEvent[e.getUnsigned().transaction_id];if(a)return void this.handleRemoteEcho(e,a)}for(var s=0;s<this.timelineSets.length;s++)this.timelineSets[s].addLiveEvent(e,t,n);e.sender&&e.getType()!==_.EventType.RoomRedaction&&this.addReceipt(D(e.sender.userId,e,"m.read"),!0)}},{key:"addPendingEvent",value:function(e,t){var n;if(null===(n=this.client)||void 0===n||!n.supportsExperimentalThreads()||!e.threadRootId){if(e.status!==k.EventStatus.SENDING&&e.status!==k.EventStatus.NOT_SENT)throw new Error("addPendingEvent called on an event with status "+e.status);if(this.txnToEvent[t])throw new Error("addPendingEvent called on an event with known txnId "+t);if(g.EventTimeline.setEventMetadata(e,this.getLiveTimeline().getState(g.EventTimeline.FORWARDS),!1),this.txnToEvent[t]=e,"detached"==this.opts.pendingEventOrdering){if(this.pendingEventList.some((function(e){return e.status===k.EventStatus.NOT_SENT}))&&(w.logger.warn("Setting event as NOT_SENT due to messages in the same state"),e.setStatus(k.EventStatus.NOT_SENT)),this.pendingEventList.push(e),this.savePendingEvents(),e.isRelation()&&this.aggregateNonLiveRelation(e),e.isRedaction()){var r=e.event.redacts,i=this.pendingEventList&&this.pendingEventList.find((function(e){return e.getId()===r}));i||(i=this.getUnfilteredTimelineSet().findEventById(r)),i&&(i.markLocallyRedacted(e),this.emit("Room.redaction",e,this))}}else for(var o=0;o<this.timelineSets.length;o++){var a=this.timelineSets[o];a.getFilter()?a.getFilter().filterRoomTimeline([e]).length&&a.addEventToTimeline(e,a.getLiveTimeline(),!1):a.addEventToTimeline(e,a.getLiveTimeline(),!1)}this.emit("Room.localEchoUpdated",e,this,null,null)}}},{key:"savePendingEvents",value:function(){var e=this;if(this.pendingEventList){var t=this.pendingEventList.map((function(e){return O(O({},e.event),{},{txn_id:e.getTxnId()})})).filter((function(t){var n=t.type===_.EventType.RoomMessageEncrypted,r=e.client.isRoomEncrypted(e.roomId);return n||!r})),n=this.client.sessionStore.store;this.pendingEventList.length>0?n.setItem(M(this.roomId),JSON.stringify(t)):n.removeItem(M(this.roomId))}}},{key:"aggregateNonLiveRelation",value:function(e){for(var t=0;t<this.timelineSets.length;t++){var n=this.timelineSets[t];n.getFilter()?n.getFilter().filterRoomTimeline([e]).length&&n.aggregateRelations(e):n.aggregateRelations(e)}}},{key:"handleRemoteEcho",value:function(e,t){var n=t.getId(),r=e.getId(),i=t.status;w.logger.debug("Got remote echo for event ".concat(n," -> ").concat(r," ")+"old status ".concat(i)),delete this.txnToEvent[e.getUnsigned().transaction_id],this.pendingEventList&&this.removePendingEvent(n),t.handleRemoteEcho(e.event);for(var o=0;o<this.timelineSets.length;o++){this.timelineSets[o].handleRemoteEcho(t,n,r)}this.emit("Room.localEchoUpdated",t,this,n,i)}},{key:"updatePendingEvent",value:function(e,t,n){if(w.logger.log("setting pendingEvent status to ".concat(t," in ").concat(e.getRoomId()," ")+"event ID ".concat(e.getId()," -> ").concat(n)),t==k.EventStatus.SENT&&!n)throw new Error("updatePendingEvent called with status=SENT, but no new event id");if(t==k.EventStatus.SENT&&this.getUnfilteredTimelineSet().eventIdToTimeline(n))return;var i=e.status,o=e.getId();if(!i)throw new Error("updatePendingEventStatus called on an event which is not a local echo.");var a=U[i];if(!a||a.indexOf(t)<0)throw new Error("Invalid EventStatus transition "+i+"->"+t);if(e.setStatus(t),t==k.EventStatus.SENT){e.replaceLocalEventId(n);for(var s=0;s<this.timelineSets.length;s++)this.timelineSets[s].replaceEventId(o,n)}else if(t==k.EventStatus.CANCELLED){if(this.pendingEventList){var u=this.pendingEventList.findIndex((function(e){return e.getId()===o}));if(-1!==u){var c=this.pendingEventList.splice(u,1),l=r(c,1)[0];l.isRedaction()&&this.revertRedactionLocalEcho(l)}}this.removeEvent(o)}this.savePendingEvents(),this.emit("Room.localEchoUpdated",e,this,o,i)}},{key:"revertRedactionLocalEcho",value:function(e){var t=e.event.redacts;if(t){var n=this.getUnfilteredTimelineSet().findEventById(t);n&&(n.unmarkLocallyRedacted(),this.emit("Room.redactionCancelled",e,this),n.isRelation()&&this.aggregateNonLiveRelation(n))}}},{key:"addLiveEvents",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t&&-1===["replace","ignore"].indexOf(t))throw new Error("duplicateStrategy MUST be either 'replace' or 'ignore'");for(n=0;n<this.timelineSets.length;n++){var i=this.timelineSets[n].getLiveTimeline();if(i.getPaginationToken(g.EventTimeline.FORWARDS))throw new Error("live timeline "+n+" is no longer live - it has a pagination token ("+i.getPaginationToken(g.EventTimeline.FORWARDS)+")");if(i.getNeighbouringTimeline(g.EventTimeline.FORWARDS))throw new Error("live timeline "+n+" is no longer live - it has a neighbouring timeline")}for(n=0;n<e.length;n++){this.addLiveEvent(e[n],t,r);var o=this.threads.get(e[n].getId());o&&!o.ready&&o.addEvent(e[n],!0)}}},{key:"addEphemeralEvents",value:function(e){var t,n=i(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;"m.typing"===r.getType()?this.currentState.setTypingEvent(r):"m.receipt"===r.getType()&&this.addReceipt(r)}}catch(o){n.e(o)}finally{n.f()}}},{key:"removeEvents",value:function(e){for(var t=0;t<e.length;++t)this.removeEvent(e[t])}},{key:"removeEvent",value:function(e){for(var t=!1,n=0;n<this.timelineSets.length;n++){var r=this.timelineSets[n].removeEvent(e);r&&(r.isRedaction()&&this.revertRedactionLocalEcho(r),t=!0)}return t}},{key:"recalculate",value:function(){var e=this,t=this.currentState.getStateEvents(_.EventType.RoomMember,this.myUserId);t&&"invite"===t.getContent().membership&&(t.getUnsigned().invite_room_state||[]).forEach((function(t){e.currentState.getStateEvents(t.type,t.state_key)||e.currentState.setStateEvents([new k.MatrixEvent({type:t.type,state_key:t.state_key,content:t.content,event_id:"$fake"+Date.now(),room_id:e.roomId,user_id:e.myUserId})])}));var n=this.name;this.name=this.calculateRoomName(this.myUserId),this.normalizedName=(0,m.normalize)(this.name),this.summary=new S.RoomSummary(this.roomId,{title:this.name}),n!==this.name&&this.emit("Room.name",this)}},{key:"getUsersReadUpTo",value:function(e){return this.getReceiptsForEvent(e).filter((function(e){return"m.read"===e.type})).map((function(e){return e.userId}))}},{key:"getEventReadUpTo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.receipts;return t&&(n=this.realReceipts),void 0===n["m.read"]||void 0===n["m.read"][e]?null:n["m.read"][e].eventId}},{key:"hasUserReadEvent",value:function(e,t){var n=this.getEventReadUpTo(e,!1);if(n===t)return!0;if(this.timeline.length&&this.timeline[this.timeline.length-1].getSender()&&this.timeline[this.timeline.length-1].getSender()===e)return!0;for(var r=this.timeline.length-1;r>=0;--r){var i=this.timeline[r];if(i.getId()===t)return!1;if(i.getId()===n)return!0}return!1}},{key:"getReceiptsForEvent",value:function(e){return this.receiptCacheByEventId[e.getId()]||[]}},{key:"addReceipt",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t||this.addReceiptsToStructure(e,this.realReceipts),this.addReceiptsToStructure(e,this.receipts),this.receiptCacheByEventId=this.buildReceiptCache(this.receipts),this.emit("Room.receipt",e,this)}},{key:"addReceiptsToStructure",value:function(e,t){var n=this,r=e.getContent();Object.keys(r).forEach((function(e){Object.keys(r[e]).forEach((function(i){Object.keys(r[e][i]).forEach((function(o){var a=r[e][i][o];t[i]||(t[i]={});var s=t[i][o];if(s){var u=n.getUnfilteredTimelineSet().compareEventOrdering(s.eventId,e);if(null!==u&&u>=0)return}else t[i][o]={};t[i][o]={eventId:e,data:a}}))}))}))}},{key:"buildReceiptCache",value:function(e){var t={};return Object.keys(e).forEach((function(n){Object.keys(e[n]).forEach((function(r){var i=e[n][r];t[i.eventId]||(t[i.eventId]=[]),t[i.eventId].push({userId:r,type:n,data:i.data})}))})),t}},{key:"addLocalEchoReceipt",value:function(e,t,n){this.addReceipt(D(e,t,n),!0)}},{key:"addTags",value:function(e){this.tags=e.getContent().tags||{},this.emit("Room.tags",e,this)}},{key:"addAccountData",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];"m.tag"===n.getType()&&this.addTags(n);var r=this.accountData[n.getType()];this.accountData[n.getType()]=n,this.emit("Room.accountData",n,this,r)}}},{key:"getAccountData",value:function(e){return this.accountData[e]}},{key:"maySendMessage",value:function(){return"join"===this.getMyMembership()&&this.currentState.maySendEvent(_.EventType.RoomMessage,this.myUserId)}},{key:"canInvite",value:function(e){var t="join"===this.getMyMembership(),n=this.currentState.getStateEvents(_.EventType.RoomPowerLevels,""),r=n&&n.getContent(),i=this.getMember(e);return r&&i&&r.invite>i.powerLevel&&(t=!1),t}},{key:"getJoinRule",value:function(){return this.currentState.getJoinRule()}},{key:"getHistoryVisibility",value:function(){return this.currentState.getHistoryVisibility()}},{key:"getGuestAccess",value:function(){return this.currentState.getGuestAccess()}},{key:"getType",value:function(){var e=this.currentState.getStateEvents(_.EventType.RoomCreate,"");if(e)return e.getContent()[_.RoomCreateTypeField];this.getTypeWarning||(w.logger.warn("[getType] Room "+this.roomId+" does not have an m.room.create event"),this.getTypeWarning=!0)}},{key:"isSpaceRoom",value:function(){return this.getType()===_.RoomType.Space}},{key:"calculateRoomName",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!n){var r=this.currentState.getStateEvents(_.EventType.RoomName,"");if(r&&r.getContent()&&r.getContent().name)return r.getContent().name}var i=this.getCanonicalAlias();if(!i){var o=this.getAltAliases();o.length&&(i=o[0])}if(i)return i;var a=this.currentState.getJoinedMemberCount(),s=this.currentState.getInvitedMemberCount(),u=a+s-1,c=[],l=this.currentState.getStateEvents(_.UNSTABLE_ELEMENT_FUNCTIONAL_USERS.name,"");Array.isArray(null===l||void 0===l?void 0:l.getContent().service_members)&&(c=l.getContent().service_members);var d=null;if(this.summaryHeroes)d=[],this.summaryHeroes.forEach((function(e){if(c.includes(e))u--;else{var n=t.getMember(e);d.push(n?n.name:e)}}));else{var f=this.currentState.getMembers().filter((function(t){return t.userId!==e&&("invite"===t.membership||"join"===t.membership)}));(f=f.filter((function(e){var t=e.userId;return!c.includes(t)||(u--,!1)}))).sort((function(e,t){return m.compare(e.userId,t.userId)})),f=f.slice(0,5),d=f.map((function(e){return e.name}))}if(u)return N(d,u);var h=this.getMyMembership();if("join"==h){var p=this.currentState.getStateEvents(_.EventType.RoomThirdPartyInvite);if(p&&p.length){var v=p.map((function(e){return e.getContent().display_name}));return"Inviting ".concat(N(v))}}var g=d;return g.length||(g=this.currentState.getMembers().filter((function(t){return t.userId!==e&&"invite"!==t.membership&&"join"!==t.membership})).map((function(e){return e.name}))),g.length?"Empty room (was ".concat(N(g),")"):"Empty room"}}]),n}(p.EventEmitter);function M(e){return"mx_pending_events_".concat(e)}t.Room=A;var U={};function N(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length+1,n=t-1;if(e.length){if(1===e.length&&n<=1)return e[0];if(2===e.length&&n<=2)return"".concat(e[0]," and ").concat(e[1]);var r=n>1;return r?"".concat(e[0]," and ").concat(n," others"):"".concat(e[0]," and 1 other")}return"Empty room"}U[k.EventStatus.ENCRYPTING]=[k.EventStatus.SENDING,k.EventStatus.NOT_SENT],U[k.EventStatus.SENDING]=[k.EventStatus.ENCRYPTING,k.EventStatus.QUEUED,k.EventStatus.NOT_SENT,k.EventStatus.SENT],U[k.EventStatus.QUEUED]=[k.EventStatus.SENDING,k.EventStatus.CANCELLED],U[k.EventStatus.SENT]=[],U[k.EventStatus.NOT_SENT]=[k.EventStatus.SENDING,k.EventStatus.QUEUED,k.EventStatus.CANCELLED],U[k.EventStatus.CANCELLED]=[]},function(e,t,n){"use strict";var r=n(0),i=n(2),o=n(11),a=n(9),s=n(10),u=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.RoomState=void 0;var c,l=u(n(3)),d=n(15),f=n(49),h=n(5),p=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=y(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}r.default=e,n&&n.set(e,r);return r}(n(12)),v=n(17),g=n(71);function y(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(y=function(e){return e?n:t})(e)}!function(e){e[e.NotStarted=0]="NotStarted",e[e.InProgress=1]="InProgress",e[e.Finished=2]="Finished"}(c||(c={}));var m=function(e){a(n,e);var t=s(n);function n(e){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{status:c.NotStarted};return r(this,n),(i=t.call(this)).roomId=e,i.oobMemberFlags=a,(0,l.default)(o(i),"sentinels",{}),(0,l.default)(o(i),"displayNameToUserIds",{}),(0,l.default)(o(i),"userIdsToDisplayNames",{}),(0,l.default)(o(i),"tokenToInvite",{}),(0,l.default)(o(i),"joinedMemberCount",null),(0,l.default)(o(i),"summaryJoinedMemberCount",null),(0,l.default)(o(i),"invitedMemberCount",null),(0,l.default)(o(i),"summaryInvitedMemberCount",null),(0,l.default)(o(i),"modified",void 0),(0,l.default)(o(i),"members",{}),(0,l.default)(o(i),"events",new Map),(0,l.default)(o(i),"paginationToken",null),i.updateModifiedTime(),i}return i(n,[{key:"getJoinedMemberCount",value:function(){return null!==this.summaryJoinedMemberCount?this.summaryJoinedMemberCount:(null===this.joinedMemberCount&&(this.joinedMemberCount=this.getMembers().reduce((function(e,t){return"join"===t.membership?e+1:e}),0)),this.joinedMemberCount)}},{key:"setJoinedMemberCount",value:function(e){this.summaryJoinedMemberCount=e}},{key:"getInvitedMemberCount",value:function(){return null!==this.summaryInvitedMemberCount?this.summaryInvitedMemberCount:(null===this.invitedMemberCount&&(this.invitedMemberCount=this.getMembers().reduce((function(e,t){return"invite"===t.membership?e+1:e}),0)),this.invitedMemberCount)}},{key:"setInvitedMemberCount",value:function(e){this.summaryInvitedMemberCount=e}},{key:"getMembers",value:function(){return Object.values(this.members)}},{key:"getMembersExcept",value:function(e){return this.getMembers().filter((function(t){return!e.includes(t.userId)}))}},{key:"getMember",value:function(e){return this.members[e]||null}},{key:"getSentinelMember",value:function(e){if(!e)return null;var t=this.sentinels[e];if(void 0===t){t=new f.RoomMember(this.roomId,e);var n=this.members[e];n&&t.setMembershipEvent(n.events.member,this),this.sentinels[e]=t}return t}},{key:"getStateEvents",value:function(e,t){if(!this.events.has(e))return void 0===t?[]:null;if(void 0===t)return Array.from(this.events.get(e).values());var n=this.events.get(e).get(t);return n||null}},{key:"clone",value:function(){var e=new n(this.roomId,this.oobMemberFlags),t=this.oobMemberFlags.status;return this.oobMemberFlags.status=c.NotStarted,Array.from(this.events.values()).forEach((function(t){e.setStateEvents(Array.from(t.values()))})),this.oobMemberFlags.status=t,null!==this.summaryInvitedMemberCount&&e.setInvitedMemberCount(this.getInvitedMemberCount()),null!==this.summaryJoinedMemberCount&&e.setJoinedMemberCount(this.getJoinedMemberCount()),this.oobMemberFlags.status==c.Finished&&this.getMembers().forEach((function(t){t.isOutOfBand()&&e.getMember(t.userId).markOutOfBand()})),e}},{key:"setUnknownStateEvents",value:function(e){var t=this,n=e.filter((function(e){return!t.events.has(e.getType())||!t.events.get(e.getType()).has(e.getStateKey())}));this.setStateEvents(n)}},{key:"setStateEvents",value:function(e){var t=this;this.updateModifiedTime(),e.forEach((function(e){if(e.getRoomId()===t.roomId&&e.isState()){var n=t.getStateEventMatching(e);t.setStateEvent(e),e.getType()===v.EventType.RoomMember&&(t.updateDisplayNameCache(e.getStateKey(),e.getContent().displayname),t.updateThirdPartyTokenCache(e)),t.emit("RoomState.events",e,t,n)}})),e.forEach((function(e){if(e.getRoomId()===t.roomId&&e.isState())if(e.getType()===v.EventType.RoomMember){var n=e.getStateKey();"leave"!==e.getContent().membership&&"ban"!==e.getContent().membership||(e.getContent().avatar_url=e.getContent().avatar_url||e.getPrevContent().avatar_url,e.getContent().displayname=e.getContent().displayname||e.getPrevContent().displayname);var r=t.getOrCreateMember(n,e);r.setMembershipEvent(e,t),t.updateMember(r),t.emit("RoomState.members",e,t,r)}else if(e.getType()===v.EventType.RoomPowerLevels){if(""!==e.getStateKey())return;Object.values(t.members).forEach((function(n){var r=n.getLastModifiedTime();n.setPowerLevelEvent(e),r!==n.getLastModifiedTime()&&t.emit("RoomState.members",e,t,n)})),t.sentinels={}}}))}},{key:"getOrCreateMember",value:function(e,t){var n=this.members[e];return n||(n=new f.RoomMember(this.roomId,e),this.members[e]=n,this.emit("RoomState.newMember",t,this,n)),n}},{key:"setStateEvent",value:function(e){this.events.has(e.getType())||this.events.set(e.getType(),new Map),this.events.get(e.getType()).set(e.getStateKey(),e)}},{key:"getStateEventMatching",value:function(e){return this.events.has(e.getType())?this.events.get(e.getType()).get(e.getStateKey()):null}},{key:"updateMember",value:function(e){var t=this.getStateEvents(v.EventType.RoomPowerLevels,"");t&&e.setPowerLevelEvent(t),delete this.sentinels[e.userId],this.members[e.userId]=e,this.joinedMemberCount=null,this.invitedMemberCount=null}},{key:"needsOutOfBandMembers",value:function(){return this.oobMemberFlags.status===c.NotStarted}},{key:"markOutOfBandMembersStarted",value:function(){this.oobMemberFlags.status===c.NotStarted&&(this.oobMemberFlags.status=c.InProgress)}},{key:"markOutOfBandMembersFailed",value:function(){this.oobMemberFlags.status===c.InProgress&&(this.oobMemberFlags.status=c.NotStarted)}},{key:"clearOutOfBandMembers",value:function(){var e=this,t=0;Object.keys(this.members).forEach((function(n){e.members[n].isOutOfBand()&&(++t,delete e.members[n])})),h.logger.log("LL: RoomState removed ".concat(t," members...")),this.oobMemberFlags.status=c.NotStarted}},{key:"setOutOfBandMembers",value:function(e){var t=this;h.logger.log("LL: RoomState about to set ".concat(e.length," OOB members ...")),this.oobMemberFlags.status===c.InProgress&&(h.logger.log("LL: RoomState put in finished state ..."),this.oobMemberFlags.status=c.Finished,e.forEach((function(e){return t.setOutOfBandMember(e)})))}},{key:"setOutOfBandMember",value:function(e){if(e.getType()===v.EventType.RoomMember){var t=e.getStateKey(),n=this.getMember(t);if(!n||n.isOutOfBand()){var r=this.getOrCreateMember(t,e);r.setMembershipEvent(e,this),r.markOutOfBand(),this.updateDisplayNameCache(r.userId,r.name),this.setStateEvent(e),this.updateMember(r),this.emit("RoomState.members",e,this,r)}}}},{key:"setTypingEvent",value:function(e){Object.values(this.members).forEach((function(t){t.setTypingEvent(e)}))}},{key:"getInviteForThreePidToken",value:function(e){return this.tokenToInvite[e]||null}},{key:"updateModifiedTime",value:function(){this.modified=Date.now()}},{key:"getLastModifiedTime",value:function(){return this.modified}},{key:"getUserIdsWithDisplayName",value:function(e){return this.displayNameToUserIds[p.removeHiddenChars(e)]||[]}},{key:"maySendRedactionForEvent",value:function(e,t){var n=this.getMember(t);if(!n||"leave"===n.membership)return!1;if(e.status||e.isRedacted())return!1;var r=this.maySendEvent(v.EventType.RoomRedaction,t);return e.getSender()===t?r:this.hasSufficientPowerLevelFor("redact",n.powerLevel)}},{key:"hasSufficientPowerLevelFor",value:function(e,t){var n=this.getStateEvents(v.EventType.RoomPowerLevels,""),r={};n&&(r=n.getContent());var i=50;return p.isNumber(r[e])&&(i=r[e]),t>=i}},{key:"maySendMessage",value:function(e){return this.maySendEventOfType(v.EventType.RoomMessage,e,!1)}},{key:"maySendEvent",value:function(e,t){return this.maySendEventOfType(e,t,!1)}},{key:"mayClientSendStateEvent",value:function(e,t){return!t.isGuest()&&this.maySendStateEvent(e,t.credentials.userId)}},{key:"maySendStateEvent",value:function(e,t){return this.maySendEventOfType(e,t,!0)}},{key:"maySendEventOfType",value:function(e,t,n){var r,i=this.getStateEvents(v.EventType.RoomPowerLevels,""),o={},a=0,s=0,u=0;if(i){o=(r=i.getContent()).events||{},a=Number.isSafeInteger(r.state_default)?r.state_default:50;var c=r.users&&r.users[t];Number.isSafeInteger(c)?u=c:Number.isSafeInteger(r.users_default)&&(u=r.users_default),Number.isSafeInteger(r.events_default)&&(s=r.events_default)}var l=n?a:s;return Number.isSafeInteger(o[e])&&(l=o[e]),u>=l}},{key:"mayTriggerNotifOfType",value:function(e,t){var n=this.getMember(t);if(!n)return!1;var r=this.getStateEvents(v.EventType.RoomPowerLevels,""),i=50;return r&&r.getContent()&&r.getContent().notifications&&p.isNumber(r.getContent().notifications[e])&&(i=r.getContent().notifications[e]),n.powerLevel>=i}},{key:"getJoinRule",value:function(){var e,t=this.getStateEvents(v.EventType.RoomJoinRules,"");return(null!==(e=null===t||void 0===t?void 0:t.getContent())&&void 0!==e?e:{}).join_rule||g.JoinRule.Invite}},{key:"getHistoryVisibility",value:function(){var e,t=this.getStateEvents(v.EventType.RoomHistoryVisibility,"");return(null!==(e=null===t||void 0===t?void 0:t.getContent())&&void 0!==e?e:{}).history_visibility||g.HistoryVisibility.Shared}},{key:"getGuestAccess",value:function(){var e,t=this.getStateEvents(v.EventType.RoomGuestAccess,"");return(null!==(e=null===t||void 0===t?void 0:t.getContent())&&void 0!==e?e:{}).guest_access||g.GuestAccess.Forbidden}},{key:"updateThirdPartyTokenCache",value:function(e){if(e.getContent().third_party_invite){var t=(e.getContent().third_party_invite.signed||{}).token;if(t)this.getStateEvents(v.EventType.RoomThirdPartyInvite,t)&&(this.tokenToInvite[t]=e)}}},{key:"updateDisplayNameCache",value:function(e,t){var n=this.userIdsToDisplayNames[e];if(delete this.userIdsToDisplayNames[e],n){var r=p.removeHiddenChars(n),i=this.displayNameToUserIds[r];if(i){var o=i.filter((function(t){return t!==e}));this.displayNameToUserIds[r]=o}}this.userIdsToDisplayNames[e]=t;var a=t&&p.removeHiddenChars(t);a&&(this.displayNameToUserIds[a]||(this.displayNameToUserIds[a]=[]),this.displayNameToUserIds[a].push(e))}}]),n}(d.EventEmitter);t.RoomState=m},function(e,t,n){"use strict";var r,i,o,a,s,u;Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryVisibility=t.GuestAccess=t.RestrictedAllowType=t.JoinRule=t.Preset=t.Visibility=void 0,t.Visibility=r,function(e){e.Public="public",e.Private="private"}(r||(t.Visibility=r={})),t.Preset=i,function(e){e.PrivateChat="private_chat",e.TrustedPrivateChat="trusted_private_chat",e.PublicChat="public_chat"}(i||(t.Preset=i={})),t.JoinRule=o,function(e){e.Public="public",e.Invite="invite",e.Private="private",e.Knock="knock",e.Restricted="restricted"}(o||(t.JoinRule=o={})),t.RestrictedAllowType=a,function(e){e.RoomMembership="m.room_membership"}(a||(t.RestrictedAllowType=a={})),t.GuestAccess=s,function(e){e.CanJoin="can_join",e.Forbidden="forbidden"}(s||(t.GuestAccess=s={})),t.HistoryVisibility=u,function(e){e.Invited="invited",e.Joined="joined",e.Shared="shared",e.WorldReadable="world_readable"}(u||(t.HistoryVisibility=u={}))},function(e,t,n){"use strict";var r=n(6),i=n(7),o=n(0),a=n(2),s=n(11),u=n(73),c=n(30),l=n(9),d=n(10),f=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.Thread=t.ThreadEvent=void 0;var h,p=f(n(3)),v=n(15),g=n(18),y=n(23),m=n(48);t.ThreadEvent=h,function(e){e.New="Thread.new",e.Ready="Thread.ready",e.Update="Thread.update"}(h||(t.ThreadEvent=h={}));var k=function(e){l(n,e);var t=d(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;return o(this,n),(e=t.call(this)).room=i,e.client=a,(0,p.default)(s(e),"root",void 0),(0,p.default)(s(e),"timelineSet",void 0),e.timelineSet=new m.EventTimelineSet(i,{unstableClientRelationAggregation:!0,timelineSupport:!0}),r.forEach((function(t){return e.addEvent(t)})),e}return a(n,[{key:"addEvent",value:function(){var e=i(r.mark((function e(t){var n,i,o=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>1&&void 0!==o[1]&&o[1],!this.timelineSet.findEventById(t.getId())&&null===t.status){e.next=3;break}return e.abrupt("return");case 3:this.root||(t.isThreadRelation?this.root=t.threadRootId:this.root=t.getId()),i=this.room.getLiveTimeline().getState(y.EventTimeline.FORWARDS),t.setThread(this),this.timelineSet.addEventToTimeline(t,this.timelineSet.getLiveTimeline(),n,!1,i),this.ready&&this.client.decryptEventIfNeeded(t,{}),this.emit(h.Update,this);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"decryptEvents",value:function(){var e=i(r.mark((function e(){var t=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.allSettled(Array.from(this.timelineSet.getLiveTimeline().getEvents()).map((function(e){return t.client.decryptEventIfNeeded(e,{})})));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"findEventById",value:function(e){return this.timelineSet.findEventById(e)}},{key:"ready",get:function(){return void 0!==this.rootEvent}},{key:"id",get:function(){return this.root}},{key:"rootEvent",get:function(){return this.findEventById(this.root)}},{key:"roomId",get:function(){return this.rootEvent.getRoomId()}},{key:"length",get:function(){return this.events.length}},{key:"participants",get:function(){var e=new Set;return this.events.forEach((function(t){e.add(t.getSender())})),e}},{key:"replyToEvent",get:function(){var e=this.events;return e[e.length-1]}},{key:"events",get:function(){return this.timelineSet.getLiveTimeline().getEvents()}},{key:"merge",value:function(e){var t=this;e.events.forEach((function(e){t.addEvent(e)})),this.events.forEach((function(e){return e.setThread(t)}))}},{key:"has",value:function(e){return this.timelineSet.findEventById(e)instanceof g.MatrixEvent}},{key:"on",value:function(e,t){return u(c(n.prototype),"on",this).call(this,e,t),this}},{key:"once",value:function(e,t){return u(c(n.prototype),"once",this).call(this,e,t),this}},{key:"off",value:function(e,t){return u(c(n.prototype),"off",this).call(this,e,t),this}},{key:"addListener",value:function(e,t){return u(c(n.prototype),"addListener",this).call(this,e,t),this}},{key:"removeListener",value:function(e,t){return u(c(n.prototype),"removeListener",this).call(this,e,t),this}}]),n}(v.EventEmitter);t.Thread=k},function(e,t,n){var r=n(115);function i(t,n,o){return"undefined"!==typeof Reflect&&Reflect.get?e.exports=i=Reflect.get:e.exports=i=function(e,t,n){var i=r(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}},i(t,n,o||t)}e.exports=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Group=a;var r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=o(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(12)),i=n(15);function o(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(o=function(e){return e?n:t})(e)}function a(e){this.groupId=e,this.name=null,this.avatarUrl=null,this.myMembership=null,this.inviter=null}r.inherits(a,i.EventEmitter),a.prototype.setProfile=function(e,t){this.name===e&&this.avatarUrl===t||(this.name=e||this.groupId,this.avatarUrl=t,this.emit("Group.profile",this))},a.prototype.setMyMembership=function(e){this.myMembership!==e&&(this.myMembership=e,this.emit("Group.myMembership",this))},a.prototype.setInviter=function(e){this.inviter=e}},function(e,t,n){"use strict";var r=n(8),i=n(0),o=n(2),a=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.PushProcessor=void 0;var s=a(n(3)),u=n(12),c=n(5),l=n(76);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){(0,s.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var h=[l.PushRuleKind.Override,l.PushRuleKind.ContentSpecific,l.PushRuleKind.RoomSpecific,l.PushRuleKind.SenderSpecific,l.PushRuleKind.Underride],p=[{rule_id:".m.rule.tombstone",default:!0,enabled:!0,conditions:[{kind:l.ConditionKind.EventMatch,key:"type",pattern:"m.room.tombstone"},{kind:l.ConditionKind.EventMatch,key:"state_key",pattern:""}],actions:[l.PushRuleActionName.Notify,{set_tweak:l.TweakName.Highlight,value:!0}]},{rule_id:".m.rule.reaction",default:!0,enabled:!0,conditions:[{kind:l.ConditionKind.EventMatch,key:"type",pattern:"m.reaction"}],actions:[l.PushRuleActionName.DontNotify]}],v=function(){function e(t){i(this,e),this.client=t}return o(e,[{key:"matchingRuleFromKindSet",value:function(e,t){for(var n=0;n<h.length;++n){var r=h[n],i=t[r];if(i)for(var o=0;o<i.length;++o){var a=i[o];if(a.enabled){var s=this.templateRuleToRaw(r,a);if(s&&this.ruleMatchesEvent(s,e))return f(f({},a),{},{kind:r})}}}return null}},{key:"templateRuleToRaw",value:function(e,t){var n={rule_id:t.rule_id,actions:t.actions,conditions:[]};switch(e){case l.PushRuleKind.Underride:case l.PushRuleKind.Override:n.conditions=t.conditions;break;case l.PushRuleKind.RoomSpecific:if(!t.rule_id)return null;n.conditions.push({kind:l.ConditionKind.EventMatch,key:"room_id",value:t.rule_id});break;case l.PushRuleKind.SenderSpecific:if(!t.rule_id)return null;n.conditions.push({kind:l.ConditionKind.EventMatch,key:"user_id",value:t.rule_id});break;case l.PushRuleKind.ContentSpecific:if(!t.pattern)return null;n.conditions.push({kind:l.ConditionKind.EventMatch,key:"content.body",pattern:t.pattern})}return n}},{key:"eventFulfillsCondition",value:function(e,t){switch(e.kind){case l.ConditionKind.EventMatch:return this.eventFulfillsEventMatchCondition(e,t);case l.ConditionKind.ContainsDisplayName:return this.eventFulfillsDisplayNameCondition(e,t);case l.ConditionKind.RoomMemberCount:return this.eventFulfillsRoomMemberCountCondition(e,t);case l.ConditionKind.SenderNotificationPermission:return this.eventFulfillsSenderNotifPermCondition(e,t)}return!1}},{key:"eventFulfillsSenderNotifPermCondition",value:function(e,t){var n=e.key;if(!n)return!1;var r=this.client.getRoom(t.getRoomId());return!(null===r||void 0===r||!r.currentState)&&r.currentState.mayTriggerNotifOfType(n,t.getSender())}},{key:"eventFulfillsRoomMemberCountCondition",value:function(e,t){if(!e.is)return!1;var n=this.client.getRoom(t.getRoomId());if(!n||!n.currentState||!n.currentState.members)return!1;var r=n.currentState.getJoinedMemberCount(),i=e.is.match(/^([=<>]*)([0-9]*)$/);if(!i)return!1;var o=i[1],a=parseInt(i[2]);if(isNaN(a))return!1;switch(o){case"":case"==":return r==a;case"<":return r<a;case">":return r>a;case"<=":return r<=a;case">=":return r>=a;default:return!1}}},{key:"eventFulfillsDisplayNameCondition",value:function(e,t){var n=t.getContent();if(t.isEncrypted()&&t.getClearContent()&&(n=t.getClearContent()),!n||!n.body||"string"!=typeof n.body)return!1;var r=this.client.getRoom(t.getRoomId());if(!r||!r.currentState||!r.currentState.members||!r.currentState.getMember(this.client.credentials.userId))return!1;var i=r.currentState.getMember(this.client.credentials.userId).name,o=new RegExp("(^|\\W)"+(0,u.escapeRegExp)(i)+"(\\W|$)","i");return n.body.search(o)>-1}},{key:"eventFulfillsEventMatchCondition",value:function(e,t){if(!e.key)return!1;var n,r=this.valueForDottedKey(e.key,t);return"string"===typeof r&&(e.value?e.value===r:"string"===typeof e.pattern&&(n="content.body"==e.key?this.createCachedRegex("(^|\\W)",e.pattern,"(\\W|$)"):this.createCachedRegex("^",e.pattern,"$"),!!r.match(n)))}},{key:"createCachedRegex",value:function(t,n,r){return e.cachedGlobToRegex[n]||(e.cachedGlobToRegex[n]=new RegExp(t+(0,u.globToRegexp)(n)+r,"i")),e.cachedGlobToRegex[n]}},{key:"valueForDottedKey",value:function(e,t){var n,r=e.split("."),i=r[0];for("content"===i?(n=t.getContent(),r.shift()):"type"===i?(n=t.getType(),r.shift()):n=t.event;r.length>0;){var o=r.shift();if((0,u.isNullOrUndefined)(n[o]))return null;n=n[o]}return n}},{key:"matchingRuleForEventWithRulesets",value:function(e,t){return t?e.getSender()===this.client.credentials.userId?null:this.matchingRuleFromKindSet(e,t.global):null}},{key:"pushActionsForEventAndRulesets",value:function(t,n){var r=this.matchingRuleForEventWithRulesets(t,n);if(!r)return{};var i=e.actionListToActionsObject(r.actions);return void 0===i.tweaks.highlight&&(i.tweaks.highlight=r.kind==l.PushRuleKind.ContentSpecific),i}},{key:"ruleMatchesEvent",value:function(e,t){for(var n=!0,r=0;r<e.conditions.length;++r){var i=e.conditions[r];n&=this.eventFulfillsCondition(i,t)}return n}},{key:"actionsForEvent",value:function(e){return this.pushActionsForEventAndRulesets(e,this.client.pushRules)}},{key:"getPushRuleById",value:function(e){for(var t=0,n=["global"];t<n.length;t++){var i=n[t];if(void 0!==this.client.pushRules[i]){var o,a=r(h);try{for(a.s();!(o=a.n()).done;){var s=o.value;if(void 0!==this.client.pushRules[i][s]){var u,c=r(this.client.pushRules[i][s]);try{for(c.s();!(u=c.n()).done;){var l=u.value;if(l.rule_id===e)return l}}catch(d){c.e(d)}finally{c.f()}}}}catch(d){a.e(d)}finally{a.f()}}}return null}}],[{key:"actionListToActionsObject",value:function(e){for(var t={notify:!1,tweaks:{}},n=0;n<e.length;++n){var r=e[n];r===l.PushRuleActionName.Notify?t.notify=!0:"object"===typeof r&&(void 0===r.value&&(r.value=!0),t.tweaks[r.set_tweak]=r.value)}return t}},{key:"rewriteDefaultRules",value:function(e){var t=JSON.parse(JSON.stringify(e));t||(t={}),t.global||(t.global={}),t.global.override||(t.global.override=[]);var n,i=t.global.override,o=r(p);try{var a=function(){var e=n.value,t=i.find((function(t){return t.rule_id===e.rule_id}));if(t)t.default=e.default,t.conditions=e.conditions,t.actions=e.actions;else{var r=e.rule_id;c.logger.warn("Adding default global override for ".concat(r)),i.push(e)}};for(o.s();!(n=o.n()).done;)a()}catch(s){o.e(s)}finally{o.f()}return t}}]),e}();t.PushProcessor=v,(0,s.default)(v,"cachedGlobToRegex",{})},function(e,t,n){"use strict";var r,i,o;Object.defineProperty(t,"__esModule",{value:!0}),t.isDmMemberCountCondition=function(e){return"==2"===e||"2"===e},t.RuleId=t.PushRuleKind=t.ConditionKind=t.DMMemberCountCondition=t.ConditionOperator=t.TweakName=t.PushRuleActionName=void 0,t.PushRuleActionName=r,function(e){e.DontNotify="dont_notify",e.Notify="notify",e.Coalesce="coalesce"}(r||(t.PushRuleActionName=r={})),t.TweakName=i,function(e){e.Highlight="highlight",e.Sound="sound"}(i||(t.TweakName=i={})),t.ConditionOperator=o,function(e){e.ExactEquals="==",e.LessThan="<",e.GreaterThan=">",e.GreaterThanOrEqual=">=",e.LessThanOrEqual="<="}(o||(t.ConditionOperator=o={}));var a,s,u;t.DMMemberCountCondition="2",t.ConditionKind=a,function(e){e.EventMatch="event_match",e.ContainsDisplayName="contains_display_name",e.RoomMemberCount="room_member_count",e.SenderNotificationPermission="sender_notification_permission"}(a||(t.ConditionKind=a={})),t.PushRuleKind=s,function(e){e.Override="override",e.ContentSpecific="content",e.RoomSpecific="room",e.SenderSpecific="sender",e.Underride="underride"}(s||(t.PushRuleKind=s={})),t.RuleId=u,function(e){e.Master=".m.rule.master",e.ContainsDisplayName=".m.rule.contains_display_name",e.ContainsUserName=".m.rule.contains_user_name",e.AtRoomNotification=".m.rule.roomnotif",e.DM=".m.rule.room_one_to_one",e.EncryptedDM=".m.rule.encrypted_room_one_to_one",e.Message=".m.rule.message",e.EncryptedMessage=".m.rule.encrypted",e.InviteToSelf=".m.rule.invite_for_me",e.MemberEvent=".m.rule.member_event",e.IncomingCall=".m.rule.call",e.SuppressNotices=".m.rule.suppress_notices",e.Tombstone=".m.rule.tombstone"}(u||(t.RuleId=u={}))},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.SyncState=void 0,t.SyncState=r,function(e){e.Error="ERROR",e.Prepared="PREPARED",e.Stopped="STOPPED",e.Syncing="SYNCING",e.Catchup="CATCHUP",e.Reconnecting="RECONNECTING"}(r||(t.SyncState=r={}))},function(e,t,n){"use strict";var r=n(6),i=n(7),o=n(0),a=n(2),s=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.AutoDiscovery=t.AutoDiscoveryAction=void 0;var u,c=s(n(3)),l=n(5),d=n(123);t.AutoDiscoveryAction=u,function(e){e.SUCCESS="SUCCESS",e.IGNORE="IGNORE",e.PROMPT="PROMPT",e.FAIL_PROMPT="FAIL_PROMPT",e.FAIL_ERROR="FAIL_ERROR"}(u||(t.AutoDiscoveryAction=u={}));var f=function(){function e(){o(this,e)}return a(e,null,[{key:"fromDiscoveryConfig",value:function(){var t=i(r.mark((function t(n){var i,o,a,s,c,d;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i={"m.homeserver":{state:e.FAIL_ERROR,error:e.ERROR_INVALID,base_url:null},"m.identity_server":{state:e.PROMPT,error:null,base_url:null}},n&&n["m.homeserver"]){t.next=6;break}return l.logger.error("No m.homeserver key in config"),i["m.homeserver"].state=e.FAIL_PROMPT,i["m.homeserver"].error=e.ERROR_INVALID,t.abrupt("return",Promise.resolve(i));case 6:if(n["m.homeserver"].base_url){t.next=11;break}return l.logger.error("No m.homeserver base_url in config"),i["m.homeserver"].state=e.FAIL_PROMPT,i["m.homeserver"].error=e.ERROR_INVALID_HS_BASE_URL,t.abrupt("return",Promise.resolve(i));case 11:if(o=this.sanitizeWellKnownUrl(n["m.homeserver"].base_url)){t.next=16;break}return l.logger.error("Invalid base_url for m.homeserver"),i["m.homeserver"].error=e.ERROR_INVALID_HS_BASE_URL,t.abrupt("return",Promise.resolve(i));case 16:return t.next=18,this.fetchWellKnownObject("".concat(o,"/_matrix/client/versions"));case 18:if((a=t.sent)&&a.raw.versions){t.next=24;break}return l.logger.error("Invalid /versions response"),i["m.homeserver"].error=e.ERROR_INVALID_HOMESERVER,i["m.homeserver"].base_url=o,t.abrupt("return",Promise.resolve(i));case 24:if(i["m.homeserver"]={state:e.SUCCESS,error:null,base_url:o},s="",!n["m.identity_server"]){t.next=41;break}if(c={"m.homeserver":i["m.homeserver"],"m.identity_server":{state:e.FAIL_PROMPT,error:e.ERROR_INVALID_IS,base_url:null}},s=this.sanitizeWellKnownUrl(n["m.identity_server"].base_url)){t.next=33;break}return l.logger.error("Invalid base_url for m.identity_server"),c["m.identity_server"].error=e.ERROR_INVALID_IS_BASE_URL,t.abrupt("return",Promise.resolve(c));case 33:return t.next=35,this.fetchWellKnownObject("".concat(s,"/_matrix/identity/api/v1"));case 35:if((d=t.sent)&&d.raw&&d.action===u.SUCCESS){t.next=41;break}return l.logger.error("Invalid /api/v1 response"),c["m.identity_server"].error=e.ERROR_INVALID_IDENTITY_SERVER,c["m.identity_server"].base_url=s,t.abrupt("return",Promise.resolve(c));case 41:return s&&s.toString().length>0&&(i["m.identity_server"]={state:e.SUCCESS,error:null,base_url:s}),Object.keys(n).map((function(e){if("m.homeserver"===e||"m.identity_server"===e)for(var t=["error","state","base_url"],r=0,o=Object.keys(n[e]);r<o.length;r++){var a=o[r];t.includes(a)||(i[e][a]=n[e][a])}else i[e]=n[e]})),t.abrupt("return",Promise.resolve(i));case 44:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"findClientConfig",value:function(){var t=i(r.mark((function t(n){var i,o;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n&&"string"===typeof n&&0!==n.length){t.next=2;break}throw new Error("'domain' must be a string of non-zero length");case 2:return i={"m.homeserver":{state:e.FAIL_ERROR,error:e.ERROR_INVALID,base_url:null},"m.identity_server":{state:e.PROMPT,error:null,base_url:null}},t.next=5,this.fetchWellKnownObject("https://".concat(n,"/.well-known/matrix/client"));case 5:if((o=t.sent)&&o.action===u.SUCCESS){t.next=11;break}return l.logger.error("No response or error when parsing .well-known"),o.reason&&l.logger.error(o.reason),o.action===u.IGNORE?i["m.homeserver"]={state:e.PROMPT,error:null,base_url:null}:(i["m.homeserver"].state=e.FAIL_PROMPT,i["m.homeserver"].error=e.ERROR_INVALID),t.abrupt("return",Promise.resolve(i));case 11:return t.abrupt("return",e.fromDiscoveryConfig(o.raw));case 12:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getRawClientConfig",value:function(){var e=i(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&"string"===typeof t&&0!==t.length){e.next=2;break}throw new Error("'domain' must be a string of non-zero length");case 2:return e.next=4,this.fetchWellKnownObject("https://".concat(t,"/.well-known/matrix/client"));case 4:if(n=e.sent){e.next=7;break}return e.abrupt("return",{});case 7:return e.abrupt("return",n.raw||{});case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sanitizeWellKnownUrl",value:function(e){if(!e)return!1;try{var t=null;try{t=d.URL?new d.URL(e):new URL(e)}catch(o){t=new URL(e)}if(!t||!t.hostname)return!1;if("http:"!==t.protocol&&"https:"!==t.protocol)return!1;var n=t.port?":".concat(t.port):"",r=t.pathname?t.pathname:"",i="".concat(t.protocol,"//").concat(t.hostname).concat(n).concat(r);return i.endsWith("/")&&(i=i.substring(0,i.length-1)),i}catch(o){return l.logger.error(o),!1}}},{key:"fetchWellKnownObject",value:function(){var t=i(r.mark((function t(i){return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,r){var o=n(44).getRequest();if(!o)throw new Error("No request library available");o({method:"GET",uri:i,timeout:5e3},(function(n,r,i){if(n||r&&(r.statusCode<200||r.statusCode>=300)){var o=u.FAIL_PROMPT,a=(n?n.message:null)||"General failure";return r&&404===r.statusCode&&(o=u.IGNORE,a=e.ERROR_MISSING_WELLKNOWN),void t({raw:{},action:o,reason:a,error:n})}try{t({raw:JSON.parse(i),action:u.SUCCESS})}catch(c){var s=e.ERROR_INVALID;"SyntaxError"===c.name&&(s=e.ERROR_INVALID_JSON),t({raw:{},action:u.FAIL_PROMPT,reason:s,error:c})}}))})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),e}();t.AutoDiscovery=f,(0,c.default)(f,"ERROR_INVALID","Invalid homeserver discovery response"),(0,c.default)(f,"ERROR_GENERIC_FAILURE","Failed to get autodiscovery configuration from server"),(0,c.default)(f,"ERROR_INVALID_HS_BASE_URL","Invalid base_url for m.homeserver"),(0,c.default)(f,"ERROR_INVALID_HOMESERVER","Homeserver URL does not appear to be a valid Matrix homeserver"),(0,c.default)(f,"ERROR_INVALID_IS_BASE_URL","Invalid base_url for m.identity_server"),(0,c.default)(f,"ERROR_INVALID_IDENTITY_SERVER","Identity server URL does not appear to be a valid identity server"),(0,c.default)(f,"ERROR_INVALID_IS","Invalid identity server discovery response"),(0,c.default)(f,"ERROR_MISSING_WELLKNOWN","No .well-known JSON file found"),(0,c.default)(f,"ERROR_INVALID_JSON","Invalid JSON"),(0,c.default)(f,"ALL_ERRORS",[f.ERROR_INVALID,f.ERROR_GENERIC_FAILURE,f.ERROR_INVALID_HS_BASE_URL,f.ERROR_INVALID_HOMESERVER,f.ERROR_INVALID_IS_BASE_URL,f.ERROR_INVALID_IDENTITY_SERVER,f.ERROR_INVALID_IS,f.ERROR_MISSING_WELLKNOWN,f.ERROR_INVALID_JSON]),(0,c.default)(f,"FAIL_ERROR",u.FAIL_ERROR),(0,c.default)(f,"FAIL_PROMPT",u.FAIL_PROMPT),(0,c.default)(f,"PROMPT",u.PROMPT),(0,c.default)(f,"SUCCESS",u.SUCCESS)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.exists=function(e,t){return new Promise((function(n,r){var i=!0,o=e.open(t);o.onupgradeneeded=function(){i=!1},o.onblocked=function(){return r(o.error)},o.onsuccess=function(){o.result.close(),i||e.deleteDatabase(t),n(i)},o.onerror=function(e){return r(o.error)}}))}},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.SERVICE_TYPES=void 0,t.SERVICE_TYPES=r,function(e){e.IS="SERVICE_TYPE_IS",e.IM="SERVICE_TYPE_IM"}(r||(t.SERVICE_TYPES=r={}))},function(e,t,n){"use strict";(function(e){var r=n(8),i=n(6),o=n(7),a=n(0),s=n(2),u=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.WITHHELD_MESSAGES=t.OlmDevice=void 0;var c=u(n(3)),l=n(5),d=n(22),f=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=h(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}r.default=e,n&&n.set(e,r);return r}(n(82));function h(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(h=function(e){return e?n:t})(e)}function p(e){if(void 0===e)throw new Error("payloadString undefined");if(e.length>49152){var t=new Error("Message too long ("+e.length+" bytes). The maximum for an encrypted message is 49152 bytes.");throw t.data={errcode:"M_TOO_LARGE",error:"Payload too large for encrypted message"},t}}var v=function(){function t(e){a(this,t),this.cryptoStore=e,(0,c.default)(this,"pickleKey","DEFAULT_KEY"),(0,c.default)(this,"deviceCurve25519Key",null),(0,c.default)(this,"deviceEd25519Key",null),(0,c.default)(this,"maxOneTimeKeys",null),(0,c.default)(this,"outboundGroupSessionStore",{}),(0,c.default)(this,"inboundGroupSessionMessageIndexes",{}),(0,c.default)(this,"sessionsInProgress",{}),(0,c.default)(this,"olmPrekeyPromise",Promise.resolve())}return s(t,[{key:"init",value:function(){var t=o(i.mark((function t(){var n,r,o,a,s,u=arguments;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=u.length>0&&void 0!==u[0]?u[0]:{},r=n.pickleKey,o=n.fromExportedDevice,s=new e.Olm.Account,t.prev=2,!o){t.next=10;break}return r&&l.logger.warn("ignoring opts.pickleKey because opts.fromExportedDevice is present."),this.pickleKey=o.pickleKey,t.next=8,this.initialiseFromExportedDevice(o,s);case 8:t.next=13;break;case 10:return r&&(this.pickleKey=r),t.next=13,this.initialiseAccount(s);case 13:a=JSON.parse(s.identity_keys()),this.maxOneTimeKeys=s.max_number_of_one_time_keys();case 15:return t.prev=15,s.free(),t.finish(15);case 18:this.deviceCurve25519Key=a.curve25519,this.deviceEd25519Key=a.ed25519;case 20:case"end":return t.stop()}}),t,this,[[2,,15,18]])})));return function(){return t.apply(this,arguments)}}()},{key:"initialiseFromExportedDevice",value:function(){var e=o(i.mark((function e(t,n){var r=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cryptoStore.doTxn("readwrite",[d.IndexedDBCryptoStore.STORE_ACCOUNT,d.IndexedDBCryptoStore.STORE_SESSIONS],(function(e){r.cryptoStore.storeAccount(e,t.pickledAccount),t.sessions.forEach((function(t){var n=t.deviceKey,i=t.sessionId,o={session:t.session,lastReceivedMessageTs:t.lastReceivedMessageTs};r.cryptoStore.storeEndToEndSession(n,i,o,e)}))}));case 2:n.unpickle(this.pickleKey,t.pickledAccount);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"initialiseAccount",value:function(){var e=o(i.mark((function e(t){var n=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cryptoStore.doTxn("readwrite",[d.IndexedDBCryptoStore.STORE_ACCOUNT],(function(e){n.cryptoStore.getAccount(e,(function(r){null!==r?t.unpickle(n.pickleKey,r):(t.create(),r=t.pickle(n.pickleKey),n.cryptoStore.storeAccount(e,r))}))}));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAccount",value:function(t,n){var r=this;this.cryptoStore.getAccount(t,(function(t){var i=new e.Olm.Account;try{i.unpickle(r.pickleKey,t),n(i)}finally{i.free()}}))}},{key:"storeAccount",value:function(e,t){this.cryptoStore.storeAccount(e,t.pickle(this.pickleKey))}},{key:"export",value:function(){var e=o(i.mark((function e(){var t,n=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={pickleKey:this.pickleKey},e.next=3,this.cryptoStore.doTxn("readonly",[d.IndexedDBCryptoStore.STORE_ACCOUNT,d.IndexedDBCryptoStore.STORE_SESSIONS],(function(e){n.cryptoStore.getAccount(e,(function(e){t.pickledAccount=e})),t.sessions=[],n.cryptoStore.getAllEndToEndSessions(e,(function(e){t.sessions.push(e)}))}));case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getSession",value:function(e,t,n,r){var i=this;this.cryptoStore.getEndToEndSession(e,t,n,(function(e){i.unpickleSession(e,r)}))}},{key:"unpickleSession",value:function(t,n){var r=new e.Olm.Session;try{r.unpickle(this.pickleKey,t.session),n(Object.assign({},t,{session:r}))}finally{r.free()}}},{key:"saveSession",value:function(e,t,n){var r=t.session.session_id(),i=Object.assign(t,{session:t.session.pickle(this.pickleKey)});this.cryptoStore.storeEndToEndSession(e,r,i,n)}},{key:"getUtility",value:function(t){var n=new e.Olm.Utility;try{return t(n)}finally{n.free()}}},{key:"sign",value:function(){var e=o(i.mark((function e(t){var n,r=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cryptoStore.doTxn("readonly",[d.IndexedDBCryptoStore.STORE_ACCOUNT],(function(e){r.getAccount(e,(function(e){n=e.sign(t)}))}));case 2:return e.abrupt("return",n);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getOneTimeKeys",value:function(){var e=o(i.mark((function e(){var t,n=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cryptoStore.doTxn("readonly",[d.IndexedDBCryptoStore.STORE_ACCOUNT],(function(e){n.getAccount(e,(function(e){t=JSON.parse(e.one_time_keys())}))}));case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"maxNumberOfOneTimeKeys",value:function(){return this.maxOneTimeKeys}},{key:"markKeysAsPublished",value:function(){var e=o(i.mark((function e(){var t=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cryptoStore.doTxn("readwrite",[d.IndexedDBCryptoStore.STORE_ACCOUNT],(function(e){t.getAccount(e,(function(n){n.mark_keys_as_published(),t.storeAccount(e,n)}))}));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"generateOneTimeKeys",value:function(e){var t=this;return this.cryptoStore.doTxn("readwrite",[d.IndexedDBCryptoStore.STORE_ACCOUNT],(function(n){t.getAccount(n,(function(r){r.generate_one_time_keys(e),t.storeAccount(n,r)}))}))}},{key:"generateFallbackKey",value:function(){var e=o(i.mark((function e(){var t=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cryptoStore.doTxn("readwrite",[d.IndexedDBCryptoStore.STORE_ACCOUNT],(function(e){t.getAccount(e,(function(n){n.generate_fallback_key(),t.storeAccount(e,n)}))}));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFallbackKey",value:function(){var e=o(i.mark((function e(){var t,n=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cryptoStore.doTxn("readonly",[d.IndexedDBCryptoStore.STORE_ACCOUNT],(function(e){n.getAccount(e,(function(e){t=JSON.parse(e.fallback_key())}))}));case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createOutboundSession",value:function(){var t=o(i.mark((function t(n,r){var o,a=this;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.cryptoStore.doTxn("readwrite",[d.IndexedDBCryptoStore.STORE_ACCOUNT,d.IndexedDBCryptoStore.STORE_SESSIONS],(function(t){a.getAccount(t,(function(i){var s=new e.Olm.Session;try{s.create_outbound(i,n,r),o=s.session_id(),a.storeAccount(t,i);var u={session:s,lastReceivedMessageTs:Date.now()};a.saveSession(n,u,t)}finally{s.free()}}))}),l.logger.withPrefix("[createOutboundSession]"));case 2:return t.abrupt("return",o);case 3:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"createInboundSession",value:function(){var t=o(i.mark((function t(n,r,o){var a,s=this;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0===r){t.next=2;break}throw new Error("Need messageType == 0 to create inbound session");case 2:return t.next=4,this.cryptoStore.doTxn("readwrite",[d.IndexedDBCryptoStore.STORE_ACCOUNT,d.IndexedDBCryptoStore.STORE_SESSIONS],(function(t){s.getAccount(t,(function(i){var u=new e.Olm.Session;try{u.create_inbound_from(i,n,o),i.remove_one_time_keys(u),s.storeAccount(t,i);var c=u.decrypt(r,o),l={session:u,lastReceivedMessageTs:Date.now()};s.saveSession(n,l,t),a={payload:c,session_id:u.session_id()}}finally{u.free()}}))}),l.logger.withPrefix("[createInboundSession]"));case 4:return t.abrupt("return",a);case 5:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"getSessionIdsForDevice",value:function(){var e=o(i.mark((function e(t){var n,r,o=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l.logger.withPrefix("[getSessionIdsForDevice]"),!this.sessionsInProgress[t]){e.next=10;break}return n.debug("Waiting for Olm session for ".concat(t," to be created")),e.prev=3,e.next=6,this.sessionsInProgress[t];case 6:e.next=10;break;case 8:e.prev=8,e.t0=e.catch(3);case 10:return e.next=12,this.cryptoStore.doTxn("readonly",[d.IndexedDBCryptoStore.STORE_SESSIONS],(function(e){o.cryptoStore.getEndToEndSessions(t,e,(function(e){r=Object.keys(e)}))}),n);case 12:return e.abrupt("return",r);case 13:case"end":return e.stop()}}),e,this,[[3,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getSessionIdForDevice",value:function(){var e=o(i.mark((function e(t){var n,r,o,a,s,u,c,l,d,f=arguments;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=f.length>1&&void 0!==f[1]&&f[1],r=f.length>2?f[2]:void 0,e.next=4,this.getSessionInfoForDevice(t,n,r);case 4:if(0!==(o=e.sent).length){e.next=7;break}return e.abrupt("return",null);case 7:for(a=0,s=1;s<o.length;s++)u=o[s],c=void 0===u.lastReceivedMessageTs?0:u.lastReceivedMessageTs,l=o[a],d=void 0===l.lastReceivedMessageTs?0:l.lastReceivedMessageTs,(c>d||c===d&&u.sessionId<l.sessionId)&&(a=s);return e.abrupt("return",o[a].sessionId);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getSessionInfoForDevice",value:function(){var e=o(i.mark((function e(t){var n,o,a,s=this,u=arguments;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=u.length>1&&void 0!==u[1]&&u[1],o=(o=u.length>2&&void 0!==u[2]?u[2]:l.logger).withPrefix("[getSessionInfoForDevice]"),!this.sessionsInProgress[t]||n){e.next=12;break}return o.debug("Waiting for Olm session for ".concat(t," to be created")),e.prev=5,e.next=8,this.sessionsInProgress[t];case 8:e.next=12;break;case 10:e.prev=10,e.t0=e.catch(5);case 12:return a=[],e.next=15,this.cryptoStore.doTxn("readonly",[d.IndexedDBCryptoStore.STORE_SESSIONS],(function(e){s.cryptoStore.getEndToEndSessions(t,e,(function(e){var t,n=Object.keys(e).sort(),i=r(n);try{var o=function(){var n=t.value;s.unpickleSession(e[n],(function(e){a.push({lastReceivedMessageTs:e.lastReceivedMessageTs,hasReceivedMessage:e.session.has_received_message(),sessionId:n})}))};for(i.s();!(t=i.n()).done;)o()}catch(u){i.e(u)}finally{i.f()}}))}),o);case 15:return e.abrupt("return",a);case 16:case"end":return e.stop()}}),e,this,[[5,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"encryptMessage",value:function(){var e=o(i.mark((function e(t,n,r){var o,a=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p(r),e.next=3,this.cryptoStore.doTxn("readwrite",[d.IndexedDBCryptoStore.STORE_SESSIONS],(function(e){a.getSession(t,n,e,(function(i){var s=i.session.describe();l.logger.log("encryptMessage: Olm Session ID "+n+" to "+t+": "+s),o=i.session.encrypt(r),a.saveSession(t,i,e)}))}),l.logger.withPrefix("[encryptMessage]"));case 3:return e.abrupt("return",o);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"decryptMessage",value:function(){var e=o(i.mark((function e(t,n,r,o){var a,s=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cryptoStore.doTxn("readwrite",[d.IndexedDBCryptoStore.STORE_SESSIONS],(function(e){s.getSession(t,n,e,(function(i){var u=i.session.describe();l.logger.log("decryptMessage: Olm Session ID "+n+" from "+t+": "+u),a=i.session.decrypt(r,o),i.lastReceivedMessageTs=Date.now(),s.saveSession(t,i,e)}))}),l.logger.withPrefix("[decryptMessage]"));case 2:return e.abrupt("return",a);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"matchesSession",value:function(){var e=o(i.mark((function e(t,n,r,o){var a,s=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0===r){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,this.cryptoStore.doTxn("readonly",[d.IndexedDBCryptoStore.STORE_SESSIONS],(function(e){s.getSession(t,n,e,(function(e){a=e.session.matches_inbound(o)}))}),l.logger.withPrefix("[matchesSession]"));case 4:return e.abrupt("return",a);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"recordSessionProblem",value:function(){var e=o(i.mark((function e(t,n,r){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cryptoStore.storeEndToEndSessionProblem(t,n,r);case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"sessionMayHaveProblems",value:function(){var e=o(i.mark((function e(t,n){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cryptoStore.getEndToEndSessionProblem(t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"filterOutNotifiedErrorDevices",value:function(){var e=o(i.mark((function e(t){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cryptoStore.filterOutNotifiedErrorDevices(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"saveOutboundGroupSession",value:function(e){this.outboundGroupSessionStore[e.session_id()]=e.pickle(this.pickleKey)}},{key:"getOutboundGroupSession",value:function(t,n){var r=this.outboundGroupSessionStore[t];if(void 0===r)throw new Error("Unknown outbound group session "+t);var i=new e.Olm.OutboundGroupSession;try{return i.unpickle(this.pickleKey,r),n(i)}finally{i.free()}}},{key:"createOutboundGroupSession",value:function(){var t=new e.Olm.OutboundGroupSession;try{return t.create(),this.saveOutboundGroupSession(t),t.session_id()}finally{t.free()}}},{key:"encryptGroupMessage",value:function(e,t){var n=this;return l.logger.log("encrypting msg with megolm session ".concat(e)),p(t),this.getOutboundGroupSession(e,(function(e){var r=e.encrypt(t);return n.saveOutboundGroupSession(e),r}))}},{key:"getOutboundGroupSessionKey",value:function(e){return this.getOutboundGroupSession(e,(function(e){return{chain_index:e.message_index(),key:e.session_key()}}))}},{key:"unpickleInboundGroupSession",value:function(t,n){var r=new e.Olm.InboundGroupSession;try{return r.unpickle(this.pickleKey,t.session),n(r)}finally{r.free()}}},{key:"getInboundGroupSession",value:function(e,t,n,r,i){var o=this;this.cryptoStore.getEndToEndInboundGroupSession(t,n,r,(function(t,n){if(null!==t){if(null!==e&&e!==t.room_id)throw new Error("Mismatched room_id for inbound group session (expected "+t.room_id+", was "+e+")");o.unpickleInboundGroupSession(t,(function(e){i(e,t,n)}))}else i(null,null,n)}))}},{key:"addInboundGroupSession",value:function(){var t=o(i.mark((function t(n,r,o,a,s,u,c){var f,h=this,p=arguments;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return f=p.length>7&&void 0!==p[7]?p[7]:{},t.next=3,this.cryptoStore.doTxn("readwrite",[d.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,d.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD,d.IndexedDBCryptoStore.STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS],(function(t){h.getInboundGroupSession(n,r,a,t,(function(i,d){var p=new e.Olm.InboundGroupSession;try{if(c?p.import_session(s):p.create(s),a!=p.session_id())throw new Error("Mismatched group session ID from senderKey: "+r);if(i&&(l.logger.log("Update for megolm session "+r+"/"+a),i.first_known_index()<=p.first_known_index()&&(i.first_known_index()!=p.first_known_index()||f.untrusted||!d.untrusted)))return void l.logger.log("Keeping existing megolm session ".concat(a));l.logger.info("Storing megolm session "+r+"/"+a+" with first index "+p.first_known_index());var v=Object.assign({},f,{room_id:n,session:p.pickle(h.pickleKey),keysClaimed:u,forwardingCurve25519KeyChain:o});h.cryptoStore.storeEndToEndInboundGroupSession(r,a,v,t),!i&&f.sharedHistory&&h.cryptoStore.addSharedHistoryInboundGroupSession(n,r,a,t)}finally{p.free()}}))}),l.logger.withPrefix("[addInboundGroupSession]"));case 3:case"end":return t.stop()}}),t,this)})));return function(e,n,r,i,o,a,s){return t.apply(this,arguments)}}()},{key:"addInboundGroupSessionWithheld",value:function(){var e=o(i.mark((function e(t,n,r,o,a){var s=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cryptoStore.doTxn("readwrite",[d.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(function(e){s.cryptoStore.storeEndToEndInboundGroupSessionWithheld(n,r,{room_id:t,code:o,reason:a},e)}));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}()},{key:"decryptGroupMessage",value:function(){var e=o(i.mark((function e(t,n,r,o,a,s){var u,c,h=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cryptoStore.doTxn("readwrite",[d.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,d.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(function(e){h.getInboundGroupSession(t,n,r,e,(function(t,i,l){if(null===t)return l&&(c=new f.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",y(l),{session:n+"|"+r})),void(u=null);var d;try{d=t.decrypt(o)}catch(m){return void(c=m&&"OLM.UNKNOWN_MESSAGE_INDEX"===m.message&&l?new f.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",y(l),{session:n+"|"+r}):m)}var p=d.plaintext;if(void 0===p)p=d;else{var v=n+"|"+r+"|"+d.message_index;if(v in h.inboundGroupSessionMessageIndexes){var g=h.inboundGroupSessionMessageIndexes[v];if(g.id!==a||g.timestamp!==s)return void(c=new Error("Duplicate message index, possible replay attack: "+v))}h.inboundGroupSessionMessageIndexes[v]={id:a,timestamp:s}}i.session=t.pickle(h.pickleKey),h.cryptoStore.storeEndToEndInboundGroupSession(n,r,i,e),u={result:p,keysClaimed:i.keysClaimed||{},senderKey:n,forwardingCurve25519KeyChain:i.forwardingCurve25519KeyChain||[],untrusted:i.untrusted}}))}),l.logger.withPrefix("[decryptGroupMessage]"));case 2:if(!c){e.next=4;break}throw c;case 4:return e.abrupt("return",u);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o,a){return e.apply(this,arguments)}}()},{key:"hasInboundSessionKeys",value:function(){var e=o(i.mark((function e(t,n,r){var o,a=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cryptoStore.doTxn("readonly",[d.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,d.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(function(e){a.cryptoStore.getEndToEndInboundGroupSession(n,r,e,(function(e){null!==e?t!==e.room_id?(l.logger.warn("requested keys for inbound group session ".concat(n,"|")+"".concat(r,", with incorrect room_id ")+"(expected ".concat(e.room_id,", ")+"was ".concat(t,")")),o=!1):o=!0:o=!1}))}),l.logger.withPrefix("[hasInboundSessionKeys]"));case 2:return e.abrupt("return",o);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getInboundGroupSessionKey",value:function(){var e=o(i.mark((function e(t,n,r,o){var a,s=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cryptoStore.doTxn("readonly",[d.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,d.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(function(e){s.getInboundGroupSession(t,n,r,e,(function(e,t){if(null!==e){void 0===o&&(o=e.first_known_index());var n=e.export_session(o),r=(t.keysClaimed||{}).ed25519||null;a={chain_index:o,key:n,forwarding_curve25519_key_chain:t.forwardingCurve25519KeyChain||[],sender_claimed_ed25519_key:r,shared_history:t.sharedHistory||!1}}else a=null}))}),l.logger.withPrefix("[getInboundGroupSessionKey]"));case 2:return e.abrupt("return",a);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"exportInboundGroupSession",value:function(e,t,n){return this.unpickleInboundGroupSession(n,(function(r){var i=r.first_known_index();return{sender_key:e,sender_claimed_keys:n.keysClaimed,room_id:n.room_id,session_id:t,session_key:r.export_session(i),forwarding_curve25519_key_chain:n.forwardingCurve25519KeyChain||[],first_known_index:r.first_known_index(),"org.matrix.msc3061.shared_history":n.sharedHistory||!1}}))}},{key:"getSharedHistoryInboundGroupSessions",value:function(){var e=o(i.mark((function e(t){var n,r=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cryptoStore.doTxn("readonly",[d.IndexedDBCryptoStore.STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS],(function(e){n=r.cryptoStore.getSharedHistoryInboundGroupSessions(t,e)}),l.logger.withPrefix("[getSharedHistoryInboundGroupSessionsForRoom]"));case 2:return e.abrupt("return",n);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"verifySignature",value:function(e,t,n){this.getUtility((function(r){r.ed25519_verify(e,t,n)}))}}],[{key:"getOlmVersion",value:function(){return e.Olm.get_library_version()}}]),t}();t.OlmDevice=v;var g={"m.unverified":"The sender has disabled encrypting to unverified devices.","m.blacklisted":"The sender has blocked you.","m.unauthorised":"You are not authorised to read the message.","m.no_olm":"Unable to establish a secure channel."};function y(e){return e.code&&e.code in g?g[e.code]:e.reason?e.reason:"decryption key withheld"}t.WITHHELD_MESSAGES=g}).call(this,n(14))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(139),n(83);var r=n(54);Object.keys(r).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===r[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}}))}))},function(e,t,n){"use strict";var r=n(21),i=n(16),o=n(8),a=n(6),s=n(13),u=n(7),c=n(11),l=n(9),d=n(10),f=n(0),h=n(2),p=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.isRoomSharedHistory=S;var v=p(n(3)),g=n(5),y=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=b(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}r.default=e,n&&n.set(e,r);return r}(n(19)),m=n(54),k=n(81);function b(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(b=function(e){return e?n:t})(e)}function S(e){var t,n,r=null===e||void 0===e||null===(t=e.currentState)||void 0===t?void 0:t.getStateEvents("m.room.history_visibility",""),i=null===r||void 0===r||null===(n=r.getContent())||void 0===n?void 0:n.history_visibility;return["world_readable","shared"].includes(i)}var w=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];f(this,e),this.sessionId=t,this.sharedHistory=n,(0,v.default)(this,"useCount",0),(0,v.default)(this,"creationTime",void 0),(0,v.default)(this,"sharedWithDevices",{}),(0,v.default)(this,"blockedDevicesNotified",{}),this.creationTime=(new Date).getTime()}return h(e,[{key:"needsRotation",value:function(e,t){var n=(new Date).getTime()-this.creationTime;return(this.useCount>=e||n>=t)&&(g.logger.log("Rotating megolm session after "+this.useCount+" messages, "+n+"ms"),!0)}},{key:"markSharedWithDevice",value:function(e,t,n,r){this.sharedWithDevices[e]||(this.sharedWithDevices[e]={}),this.sharedWithDevices[e][t]={deviceKey:n,messageIndex:r}}},{key:"markNotifiedBlockedDevice",value:function(e,t){this.blockedDevicesNotified[e]||(this.blockedDevicesNotified[e]={}),this.blockedDevicesNotified[e][t]=!0}},{key:"sharedWithTooManyDevices",value:function(e){for(var t in this.sharedWithDevices)if(this.sharedWithDevices.hasOwnProperty(t)){if(!e.hasOwnProperty(t))return g.logger.log("Starting new megolm session because we shared with "+t),!0;for(var n in this.sharedWithDevices[t])if(this.sharedWithDevices[t].hasOwnProperty(n)&&!e[t].hasOwnProperty(n))return g.logger.log("Starting new megolm session because we shared with "+t+":"+n),!0}}}]),e}(),E=function(e){l(n,e);var t=d(n);function n(e){var r,i,o,a,s;return f(this,n),r=t.call(this,e),(0,v.default)(c(r),"setupPromise",Promise.resolve(void 0)),(0,v.default)(c(r),"outboundSessions",{}),(0,v.default)(c(r),"sessionRotationPeriodMsgs",void 0),(0,v.default)(c(r),"sessionRotationPeriodMs",void 0),(0,v.default)(c(r),"encryptionPreparation",void 0),(0,v.default)(c(r),"encryptionPreparationMetadata",void 0),r.sessionRotationPeriodMsgs=null!==(i=null===(o=e.config)||void 0===o?void 0:o.rotation_period_msgs)&&void 0!==i?i:100,r.sessionRotationPeriodMs=null!==(a=null===(s=e.config)||void 0===s?void 0:s.rotation_period_ms)&&void 0!==a?a:6048e5,r}return h(n,[{key:"ensureOutboundSession",value:function(){var e=u(a.mark((function e(t,n,r){var i,c,l,d,f,h=this,p=arguments;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=function(){return c},i=p.length>3&&void 0!==p[3]&&p[3],l=function(){var e=u(a.mark((function e(l){var d,f,p,v,m,k,b,w,E,_,x,I,T,R,O,C,P,D;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=l,d=S(t),c&&d!==c.sharedHistory&&(c=null),c&&c.needsRotation(h.sessionRotationPeriodMsgs,h.sessionRotationPeriodMs)&&(g.logger.log("Starting new megolm session because we need to rotate."),c=null),c&&c.sharedWithTooManyDevices(n)&&(c=null),c){e.next=12;break}return g.logger.log("Starting new megolm session for room ".concat(h.roomId)),e.next=9,h.prepareNewSession(d);case 9:c=e.sent,g.logger.log("Started new megolm session ".concat(c.sessionId," ")+"for room ".concat(h.roomId)),h.outboundSessions[c.sessionId]=c;case 12:f={},p=0,v=Object.entries(n);case 14:if(!(p<v.length)){e.next=29;break}m=s(v[p],2),k=m[0],b=m[1],w=0,E=Object.entries(b);case 17:if(!(w<E.length)){e.next=26;break}if(_=s(E[w],2),x=_[0],I=_[1],I.getIdentityKey()!=h.olmDevice.deviceCurve25519Key){e.next=22;break}return e.abrupt("continue",23);case 22:c.sharedWithDevices[k]&&void 0!==c.sharedWithDevices[k][x]||(f[k]=f[k]||[],f[k].push(I));case 23:w++,e.next=17;break;case 26:p++,e.next=14;break;case 29:return T=h.olmDevice.getOutboundGroupSessionKey(c.sessionId),R={type:"m.room_key",content:{algorithm:y.MEGOLM_ALGORITHM,room_id:h.roomId,session_id:c.sessionId,session_key:T.key,chain_index:T.chain_index,"org.matrix.msc3061.shared_history":d}},e.next=33,y.getExistingOlmSessions(h.olmDevice,h.baseApis,f);case 33:return O=e.sent,C=s(O,2),P=C[0],D=C[1],e.next=39,Promise.all([u(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g.logger.debug("Sharing keys with existing Olm sessions in ".concat(h.roomId),D),e.next=3,h.shareKeyWithOlmSessions(c,T,R,D);case 3:g.logger.debug("Shared keys with existing Olm sessions in ".concat(h.roomId));case 4:case"end":return e.stop()}}),e)})))(),u(a.mark((function e(){var t,n,r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g.logger.debug("Sharing keys (start phase 1) with new Olm sessions in ".concat(h.roomId),P),t=[],n=Date.now(),r=[],e.next=6,h.shareKeyWithDevices(c,T,R,P,t,i?1e4:2e3,r);case 6:if(g.logger.debug("Shared keys (end phase 1) with new Olm sessions in ".concat(h.roomId)),i||!(Date.now()-n<1e4)){e.next=11;break}u(a.mark((function e(){var n,i,s,u,l,d,f,p,v,y,m,k;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n={},i=new Set,s=o(r);try{for(s.s();!(u=s.n()).done;)l=u.value,i.add(l)}catch(a){s.e(a)}finally{s.f()}d=[],f=o(t);try{for(f.s();!(p=f.n()).done;)v=p.value,y=v.userId,m=v.deviceInfo,k=y.slice(y.indexOf(":")+1),i.has(k)?(n[y]=n[y]||[],n[y].push(m)):d.push({userId:y,deviceInfo:m})}catch(a){f.e(a)}finally{f.f()}return g.logger.debug("Sharing keys (start phase 2) with new Olm sessions in ".concat(h.roomId)),e.next=10,h.shareKeyWithDevices(c,T,R,n,d,3e4);case 10:return g.logger.debug("Shared keys (end phase 2) with new Olm sessions in ".concat(h.roomId)),e.next=13,h.notifyFailedOlmDevices(c,T,d);case 13:case"end":return e.stop()}}),e)})))(),e.next=13;break;case 11:return e.next=13,h.notifyFailedOlmDevices(c,T,t);case 13:g.logger.debug("Shared keys (all phases done) with new Olm sessions in ".concat(h.roomId));case 14:case"end":return e.stop()}}),e)})))(),u(a.mark((function e(){var t,n,i,o,u,l,d,f,p,v,y,m;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(g.logger.debug("There are ".concat(Object.entries(r).length," blocked devices in ").concat(h.roomId),Object.entries(r)),g.logger.debug("Notifying newly blocked devices in ".concat(h.roomId)),t={},n=0,i=0,o=Object.entries(r);i<o.length;i++)for(u=s(o[i],2),l=u[0],d=u[1],f=0,p=Object.entries(d);f<p.length;f++)v=s(p[f],2),y=v[0],m=v[1],c.blockedDevicesNotified[l]&&void 0!==c.blockedDevicesNotified[l][y]||(t[l]=t[l]||{},t[l][y]={device:m},n++);return e.next=7,h.notifyBlockedDevices(c,t);case 7:g.logger.debug("Notified ".concat(n," newly blocked devices in ").concat(h.roomId),t);case 8:case"end":return e.stop()}}),e)})))()]);case 39:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(f=this.setupPromise.then(l)).catch((function(e){g.logger.error("Failed to ensure outbound session in ".concat(h.roomId),e)})),this.setupPromise=f.then(d,d),e.abrupt("return",f.then(d));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"prepareNewSession",value:function(){var e=u(a.mark((function e(t){var n,r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.olmDevice.createOutboundGroupSession(),r=this.olmDevice.getOutboundGroupSessionKey(n),e.next=4,this.olmDevice.addInboundGroupSession(this.roomId,this.olmDevice.deviceCurve25519Key,[],n,r.key,{ed25519:this.olmDevice.deviceEd25519Key},!1,{sharedHistory:t});case 4:return this.crypto.backupManager.backupGroupSession(this.olmDevice.deviceCurve25519Key,n),e.abrupt("return",new w(n,t));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDevicesWithoutSessions",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=0,i=Object.entries(t);r<i.length;r++){var a,u=s(i[r],2),c=u[0],l=u[1],d=e[c],f=o(l);try{for(f.s();!(a=f.n()).done;){var h=a.value,p=h.deviceId,v=d[p];v.sessionId||(n.push({userId:c,deviceInfo:h}),delete d[p])}}catch(g){f.e(g)}finally{f.f()}}return n}},{key:"splitDevices",value:function(e){for(var t=[],n=[t],r=0,i=Object.entries(e);r<i.length;r++){for(var o=s(i[r],2),a=o[0],u=o[1],c=0,l=Object.values(u);c<l.length;c++){var d=l[c];t.push({userId:a,deviceInfo:d.device})}t.length>20&&(t=[],n.push(t))}return 0===t.length&&n.pop(),n}},{key:"encryptAndSendKeysToDevices",value:function(e,t,n,r){for(var i=this,o={},a=new Map,s=[],u=0;u<n.length;u++){var c={algorithm:y.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}},l=n[u],d=l.userId,f=l.deviceInfo,h=f.deviceId;a.set(h,f),o[d]||(o[d]={}),o[d][h]=c,s.push(y.encryptMessageForDevice(c.ciphertext,this.userId,this.deviceId,this.olmDevice,d,f,r))}return Promise.all(s).then((function(){for(var n=0,r=Object.keys(o);n<r.length;n++){for(var s=r[n],u=0,c=Object.keys(o[s]);u<c.length;u++){var l=c[u];0===Object.keys(o[s][l].ciphertext).length&&(g.logger.log("No ciphertext for device "+s+":"+l+": pruning"),delete o[s][l])}0===Object.keys(o[s]).length&&(g.logger.log("Pruned all devices for user "+s),delete o[s])}if(0!==Object.keys(o).length)return i.baseApis.sendToDevice("m.room.encrypted",o).then((function(){for(var n=0,r=Object.keys(o);n<r.length;n++)for(var i=r[n],s=0,u=Object.keys(o[i]);s<u.length;s++){var c=u[s];e.markSharedWithDevice(i,c,a.get(c).getIdentityKey(),t)}}));g.logger.log("No users left to send to: aborting")}))}},{key:"sendBlockedNotificationsToDevices",value:function(){var e=u(a.mark((function e(t,n,r){var i,s,u,c,l,d,f,h,p,v,g,y,m,k,b;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i={},s=o(n);try{for(s.s();!(u=s.n()).done;)c=u.value,l=c.userId,d=c.deviceInfo,f=d.deviceInfo,h=f.deviceId,(p=Object.assign({},r)).code=d.code,p.reason=d.reason,"m.no_olm"===p.code&&(delete p.room_id,delete p.session_id),i[l]||(i[l]={}),i[l][h]=p}catch(a){s.e(a)}finally{s.f()}return e.next=5,this.baseApis.sendToDevice("org.matrix.room_key.withheld",i);case 5:for(v=0,g=Object.keys(i);v<g.length;v++)for(y=g[v],m=0,k=Object.keys(i[y]);m<k.length;m++)b=k[m],t.markNotifiedBlockedDevice(y,b);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"reshareKeyWithDevice",value:function(){var e=u(a.mark((function e(t,n,r,o){var s,u,c,l,d;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=this.outboundSessions[n]){e.next=4;break}return g.logger.debug("megolm session ".concat(n," not found: not re-sharing keys")),e.abrupt("return");case 4:if(void 0!==s.sharedWithDevices[r]){e.next=7;break}return g.logger.debug("megolm session ".concat(n," never shared with user ").concat(r)),e.abrupt("return");case 7:if(void 0!==(u=s.sharedWithDevices[r][o.deviceId])){e.next=11;break}return g.logger.debug("megolm session ID "+n+" never shared with device "+r+":"+o.deviceId),e.abrupt("return");case 11:if(u.deviceKey===o.getIdentityKey()){e.next=14;break}return g.logger.warn("Session has been shared with device ".concat(o.deviceId," but with identity ")+"key ".concat(u.deviceKey,". Key is now ").concat(o.getIdentityKey(),"!")),e.abrupt("return");case 14:return e.next=16,this.olmDevice.getInboundGroupSessionKey(this.roomId,t,n,u.messageIndex);case 16:if(c=e.sent){e.next=20;break}return g.logger.warn("No inbound session key found for megolm ".concat(n,": not re-sharing keys")),e.abrupt("return");case 20:return e.next=22,y.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,i({},r,[o]));case 22:return l={type:"m.forwarded_room_key",content:{algorithm:y.MEGOLM_ALGORITHM,room_id:this.roomId,session_id:n,session_key:c.key,chain_index:c.chain_index,sender_key:t,sender_claimed_ed25519_key:c.sender_claimed_ed25519_key,forwarding_curve25519_key_chain:c.forwarding_curve25519_key_chain,"org.matrix.msc3061.shared_history":c.shared_history||!1}},d={algorithm:y.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}},e.next=26,y.encryptMessageForDevice(d.ciphertext,this.userId,this.deviceId,this.olmDevice,r,o,l);case 26:return e.next=28,this.baseApis.sendToDevice("m.room.encrypted",i({},r,i({},o.deviceId,d)));case 28:g.logger.debug("Re-shared key for megolm session ".concat(n," with ").concat(r,":").concat(o.deviceId));case 29:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"shareKeyWithDevices",value:function(){var e=u(a.mark((function e(t,n,r,i,o,s,u){var c;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g.logger.debug("Ensuring Olm sessions for devices in ".concat(this.roomId)),e.next=3,y.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,i,!1,s,u,g.logger.withPrefix("[".concat(this.roomId,"]")));case 3:return c=e.sent,g.logger.debug("Ensured Olm sessions for devices in ".concat(this.roomId)),this.getDevicesWithoutSessions(c,i,o),g.logger.debug("Sharing keys with newly created Olm sessions in ".concat(this.roomId)),e.next=9,this.shareKeyWithOlmSessions(t,n,r,c);case 9:g.logger.debug("Shared keys with newly created Olm sessions in ".concat(this.roomId));case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o,a,s){return e.apply(this,arguments)}}()},{key:"shareKeyWithOlmSessions",value:function(){var e=u(a.mark((function e(t,n,r,i){var o,s,u;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=this.splitDevices(i),s=0;case 2:if(!(s<o.length)){e.next=18;break}return u="megolm keys for ".concat(t.sessionId," ")+"in ".concat(this.roomId," (slice ").concat(s+1,"/").concat(o.length,")"),e.prev=4,g.logger.debug("Sharing ".concat(u),o[s].map((function(e){return"".concat(e.userId,"/").concat(e.deviceInfo.deviceId)}))),e.next=8,this.encryptAndSendKeysToDevices(t,n.chain_index,o[s],r);case 8:g.logger.debug("Shared ".concat(u)),e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(4),g.logger.error("Failed to share ".concat(u)),e.t0;case 15:s++,e.next=2;break;case 18:case"end":return e.stop()}}),e,this,[[4,11]])})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"notifyFailedOlmDevices",value:function(){var e=u(a.mark((function e(t,n,r){var i,s,u,c,l,d,f,h,p,v,y,m,b;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:g.logger.debug("Notifying ".concat(r.length," devices we failed to ")+"create Olm sessions in ".concat(this.roomId)),i=o(r);try{for(i.s();!(s=i.n()).done;)u=s.value,c=u.userId,l=u.deviceInfo,d=l.deviceId,t.markSharedWithDevice(c,d,l.getIdentityKey(),n.chain_index)}catch(a){i.e(a)}finally{i.f()}return e.next=5,this.olmDevice.filterOutNotifiedErrorDevices(r);case 5:f=e.sent,g.logger.debug("Need to notify ".concat(f.length," failed devices ")+"which haven't been notified before in ".concat(this.roomId)),h={},p=o(f);try{for(p.s();!(v=p.n()).done;)y=v.value,m=y.userId,b=y.deviceInfo,h[m]=h[m]||{},h[m][b.deviceId]={device:{code:"m.no_olm",reason:k.WITHHELD_MESSAGES["m.no_olm"],deviceInfo:b}}}catch(a){p.e(a)}finally{p.f()}return e.next=12,this.notifyBlockedDevices(t,h);case 12:g.logger.debug("Notified ".concat(f.length," devices we failed to ")+"create Olm sessions in ".concat(this.roomId));case 13:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"notifyBlockedDevices",value:function(){var e=u(a.mark((function e(t,n){var r,i,o;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={room_id:this.roomId,session_id:t.sessionId,algorithm:y.MEGOLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key},i=this.splitDevices(n),o=0;case 3:if(!(o<i.length)){e.next=17;break}return e.prev=4,e.next=7,this.sendBlockedNotificationsToDevices(t,i[o],r);case 7:g.logger.log("Completed blacklist notification for ".concat(t.sessionId," ")+"in ".concat(this.roomId," (slice ").concat(o+1,"/").concat(i.length,")")),e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(4),g.logger.log("blacklist notification for ".concat(t.sessionId," in ")+"".concat(this.roomId," (slice ").concat(o+1,"/").concat(i.length,") failed")),e.t0;case 14:o++,e.next=3;break;case 17:case"end":return e.stop()}}),e,this,[[4,10]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"prepareToEncrypt",value:function(e){var t=this;if(this.encryptionPreparation){var n=Date.now()-this.encryptionPreparationMetadata.startTime;g.logger.debug("Already started preparing to encrypt for ".concat(this.roomId," ")+"".concat(n," ms ago, skipping"))}else g.logger.debug("Preparing to encrypt events for ".concat(this.roomId)),this.encryptionPreparationMetadata={startTime:Date.now()},this.encryptionPreparation=u(a.mark((function n(){var r,i,o,u;return a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,g.logger.debug("Getting devices in ".concat(t.roomId)),n.next=4,t.getDevicesInRoom(e);case 4:return r=n.sent,i=s(r,2),o=i[0],u=i[1],t.crypto.getGlobalErrorOnUnknownDevices()&&t.removeUnknownDevices(o),g.logger.debug("Ensuring outbound session in ".concat(t.roomId)),n.next=12,t.ensureOutboundSession(e,o,u,!0);case 12:g.logger.debug("Ready to encrypt events for ".concat(t.roomId)),n.next=18;break;case 15:n.prev=15,n.t0=n.catch(0),g.logger.error("Failed to prepare to encrypt events for ".concat(t.roomId),n.t0);case 18:return n.prev=18,delete t.encryptionPreparationMetadata,delete t.encryptionPreparation,n.finish(18);case 22:case"end":return n.stop()}}),n,null,[[0,15,18,22]])})))()}},{key:"encryptMessage",value:function(){var e=u(a.mark((function e(t,n,r){var i,o,u,c,l,d,f,h;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(g.logger.log("Starting to encrypt event for ".concat(this.roomId)),!this.encryptionPreparation){e.next=9;break}return e.prev=2,e.next=5,this.encryptionPreparation;case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:return e.next=11,this.getDevicesInRoom(t);case 11:return i=e.sent,o=s(i,2),u=o[0],c=o[1],this.crypto.getGlobalErrorOnUnknownDevices()&&this.checkForUnknownDevices(u),e.next=18,this.ensureOutboundSession(t,u,c);case 18:return l=e.sent,d={room_id:this.roomId,type:n,content:r},f=this.olmDevice.encryptGroupMessage(l.sessionId,JSON.stringify(d)),h={algorithm:y.MEGOLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:f,session_id:l.sessionId,device_id:this.deviceId},l.useCount++,e.abrupt("return",h);case 24:case"end":return e.stop()}}),e,this,[[2,7]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"forceDiscardSession",value:function(){this.setupPromise=this.setupPromise.then((function(){return null}))}},{key:"checkForUnknownDevices",value:function(e){var t={};if(Object.keys(e).forEach((function(n){Object.keys(e[n]).forEach((function(r){var i=e[n][r];i.isUnverified()&&!i.isKnown()&&(t[n]||(t[n]={}),t[n][r]=i)}))})),Object.keys(t).length)throw new m.UnknownDeviceError("This room contains unknown devices which have not been verified. We strongly recommend you verify them before continuing.",t)}},{key:"removeUnknownDevices",value:function(e){for(var t=0,n=Object.entries(e);t<n.length;t++){for(var r=s(n[t],2),i=r[0],o=r[1],a=0,u=Object.entries(o);a<u.length;a++){var c=s(u[a],2),l=c[0],d=c[1];d.isUnverified()&&!d.isKnown()&&delete o[l]}0===Object.keys(o).length&&delete e[i]}}},{key:"getDevicesInRoom",value:function(){var e=u(a.mark((function e(t){var n,r,i,o,s,u,c,l,d,f;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getEncryptionTargetMembers();case 2:return n=e.sent,r=n.map((function(e){return e.userId})),i=this.crypto.getGlobalBlacklistUnverifiedDevices(),"boolean"===typeof t.getBlacklistUnverifiedDevices()&&(i=t.getBlacklistUnverifiedDevices()),e.next=8,this.crypto.downloadKeys(r,!1);case 8:o=e.sent,s={},e.t0=a.keys(o);case 11:if((e.t1=e.t0()).done){e.next=27;break}if(u=e.t1.value,o.hasOwnProperty(u)){e.next=15;break}return e.abrupt("continue",11);case 15:c=o[u],e.t2=a.keys(c);case 17:if((e.t3=e.t2()).done){e.next=25;break}if(l=e.t3.value,c.hasOwnProperty(l)){e.next=21;break}return e.abrupt("continue",17);case 21:d=this.crypto.checkDeviceTrust(u,l),(c[l].isBlocked()||!d.isVerified()&&i)&&(s[u]||(s[u]={}),f=c[l].isBlocked(),s[u][l]={code:f?"m.blacklisted":"m.unverified",reason:k.WITHHELD_MESSAGES[f?"m.blacklisted":"m.unverified"],deviceInfo:c[l]},delete c[l]),e.next=17;break;case 25:e.next=11;break;case 27:return e.abrupt("return",[o,s]);case 28:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(m.EncryptionAlgorithm),_=function(e){l(n,e);var t=d(n);function n(){var e;f(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),(0,v.default)(c(e),"pendingEvents",{}),(0,v.default)(c(e),"olmlib",y),e}return h(n,[{key:"decryptEvent",value:function(){var e=u(a.mark((function e(t){var n,r,i,o,s,u;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=t.getWireContent()).sender_key&&n.session_id&&n.ciphertext){e.next=3;break}throw new m.DecryptionError("MEGOLM_MISSING_FIELDS","Missing fields in input");case 3:return this.addEventToPendingList(t),e.prev=4,e.next=7,this.olmDevice.decryptGroupMessage(t.getRoomId(),n.sender_key,n.session_id,n.ciphertext,t.getId(),t.getTs());case 7:r=e.sent,e.next=17;break;case 10:if(e.prev=10,e.t0=e.catch(4),"DecryptionError"!==e.t0.name){e.next=14;break}throw e.t0;case 14:throw i="OLM_DECRYPT_GROUP_MESSAGE_ERROR",e.t0&&"OLM.UNKNOWN_MESSAGE_INDEX"===e.t0.message&&(this.requestKeysForEvent(t),i="OLM_UNKNOWN_MESSAGE_INDEX"),new m.DecryptionError(i,e.t0?e.t0.toString():"Unknown Error: Error is undefined",{session:n.sender_key+"|"+n.session_id});case 17:if(null!==r){e.next=27;break}return this.requestKeysForEvent(t),e.next=21,this.olmDevice.sessionMayHaveProblems(n.sender_key,t.getTs()-12e4);case 21:if(!(o=e.sent)){e.next=26;break}throw s=x[o.type]||x.unknown,o.fixed&&(s+=" Trying to create a new secure channel and re-requesting the keys."),new m.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",s,{session:n.sender_key+"|"+n.session_id});case 26:throw new m.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID","The sender's device has not sent us the keys for this message.",{session:n.sender_key+"|"+n.session_id});case 27:if(this.removeEventFromPendingList(t),(u=JSON.parse(r.result)).room_id===t.getRoomId()){e.next=31;break}throw new m.DecryptionError("MEGOLM_BAD_ROOM","Message intended for room "+u.room_id);case 31:return e.abrupt("return",{clearEvent:u,senderCurve25519Key:r.senderKey,claimedEd25519Key:r.keysClaimed.ed25519,forwardingCurve25519KeyChain:r.forwardingCurve25519KeyChain,untrusted:r.untrusted});case 32:case"end":return e.stop()}}),e,this,[[4,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"requestKeysForEvent",value:function(e){var t=e.getWireContent(),n=e.getKeyRequestRecipients(this.userId);this.crypto.requestRoomKey({room_id:e.getRoomId(),algorithm:t.algorithm,sender_key:t.sender_key,session_id:t.session_id},n)}},{key:"addEventToPendingList",value:function(e){var t=e.getWireContent(),n=t.sender_key,r=t.session_id;this.pendingEvents[n]||(this.pendingEvents[n]=new Map);var i=this.pendingEvents[n];i.has(r)||i.set(r,new Set),i.get(r).add(e)}},{key:"removeEventFromPendingList",value:function(e){var t=e.getWireContent(),n=t.sender_key,r=t.session_id,i=this.pendingEvents[n],o=i&&i.get(r);o&&(o.delete(e),0===o.size&&i.delete(n),0===i.size&&delete this.pendingEvents[n])}},{key:"onRoomKeyEvent",value:function(e){var t,n=this,r=e.getContent(),i=r.session_id,o=e.getSenderKey(),a=[],s=!1;if(r.room_id&&i&&r.session_key){if(o){if("m.forwarded_room_key"==e.getType()){if(s=!0,a=r.forwarding_curve25519_key_chain,Array.isArray(a)||(a=[]),(a=a.slice()).push(o),!(o=r.sender_key))return void g.logger.error("forwarded_room_key event is missing sender_key field");var u=r.sender_claimed_ed25519_key;if(!u)return void g.logger.error("forwarded_room_key_event is missing sender_claimed_ed25519_key field");t={ed25519:u}}else t=e.getKeysClaimed();var c={};return r["org.matrix.msc3061.shared_history"]&&(c.sharedHistory=!0),this.olmDevice.addInboundGroupSession(r.room_id,o,a,i,r.session_key,t,s,c).then((function(){n.retryDecryption(o,i).then((function(e){e&&n.crypto.cancelRoomKeyRequest({algorithm:r.algorithm,room_id:r.room_id,session_id:r.session_id,sender_key:o})}))})).then((function(){n.crypto.backupManager.backupGroupSession(o,r.session_id)})).catch((function(e){g.logger.error("Error handling m.room_key_event: ".concat(e))}))}g.logger.error("key event has no sender key (not encrypted?)")}else g.logger.error("key event is missing fields")}},{key:"onRoomKeyWithheldEvent",value:function(){var e=u(a.mark((function e(t){var n,r,o,s,u;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.getContent(),r=n.sender_key,"m.no_olm"!==n.code){e.next=36;break}return o=t.getSender(),g.logger.warn("".concat(o,":").concat(r," was unable to establish an olm session with us")),e.next=7,this.olmDevice.getSessionIdForDevice(r);case 7:if(!e.sent){e.next=13;break}return g.logger.debug("New session already created.  Not creating a new one."),e.next=11,this.olmDevice.recordSessionProblem(r,"no_olm",!0);case 11:return this.retryDecryptionFromSender(r),e.abrupt("return");case 13:if(s=this.crypto.deviceList.getDeviceByIdentityKey(n.algorithm,r)){e.next=24;break}return e.next=17,this.crypto.downloadKeys([o],!1);case 17:if(s=this.crypto.deviceList.getDeviceByIdentityKey(n.algorithm,r)){e.next=24;break}return g.logger.info("Couldn't find device for identity key "+r+": not establishing session"),e.next=22,this.olmDevice.recordSessionProblem(r,"no_olm",!1);case 22:return this.retryDecryptionFromSender(r),e.abrupt("return");case 24:return e.next=26,y.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,i({},o,[s]),!1);case 26:return u={algorithm:y.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}},e.next=29,y.encryptMessageForDevice(u.ciphertext,this.userId,void 0,this.olmDevice,o,s,{type:"m.dummy"});case 29:return e.next=31,this.olmDevice.recordSessionProblem(r,"no_olm",!0);case 31:return this.retryDecryptionFromSender(r),e.next=34,this.baseApis.sendToDevice("m.room.encrypted",i({},o,i({},s.deviceId,u)));case 34:e.next=38;break;case 36:return e.next=38,this.olmDevice.addInboundGroupSessionWithheld(n.room_id,r,n.session_id,n.code,n.reason);case 38:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hasKeysForKeyRequest",value:function(e){var t=e.requestBody;return this.olmDevice.hasInboundSessionKeys(t.room_id,t.sender_key,t.session_id)}},{key:"shareKeysWithDevice",value:function(e){var t=this,n=e.userId,r=e.deviceId,o=this.crypto.getStoredDevice(n,r),a=e.requestBody;this.olmlib.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,i({},n,[o])).then((function(e){return e[n][r].sessionId?(g.logger.log("sharing keys for session "+a.sender_key+"|"+a.session_id+" with device "+n+":"+r),t.buildKeyForwardingMessage(a.room_id,a.sender_key,a.session_id)):null})).then((function(e){var a={algorithm:y.OLM_ALGORITHM,sender_key:t.olmDevice.deviceCurve25519Key,ciphertext:{}};return t.olmlib.encryptMessageForDevice(a.ciphertext,t.userId,void 0,t.olmDevice,n,o,e).then((function(){var e=i({},n,i({},r,a));return t.baseApis.sendToDevice("m.room.encrypted",e)}))}))}},{key:"buildKeyForwardingMessage",value:function(){var e=u(a.mark((function e(t,n,r){var i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.olmDevice.getInboundGroupSessionKey(t,n,r);case 2:return i=e.sent,e.abrupt("return",{type:"m.forwarded_room_key",content:{algorithm:y.MEGOLM_ALGORITHM,room_id:t,sender_key:n,sender_claimed_ed25519_key:i.sender_claimed_ed25519_key,session_id:r,session_key:i.key,chain_index:i.chain_index,forwarding_curve25519_key_chain:i.forwarding_curve25519_key_chain,"org.matrix.msc3061.shared_history":i.shared_history||!1}});case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"importRoomKey",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={};return(n.untrusted||e.untrusted)&&(r.untrusted=!0),e["org.matrix.msc3061.shared_history"]&&(r.sharedHistory=!0),this.olmDevice.addInboundGroupSession(e.room_id,e.sender_key,e.forwarding_curve25519_key_chain,e.session_id,e.session_key,e.sender_claimed_keys,!0,r).then((function(){"backup"!==n.source&&t.crypto.backupManager.backupGroupSession(e.sender_key,e.session_id).catch((function(e){g.logger.log("Failed to back up megolm session",e)})),t.retryDecryption(e.sender_key,e.session_id)}))}},{key:"retryDecryption",value:function(){var e=u(a.mark((function e(t,n){var i,o,s=this;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.pendingEvents[t]){e.next=3;break}return e.abrupt("return",!0);case 3:if(o=i.get(n)){e.next=6;break}return e.abrupt("return",!0);case 6:return g.logger.debug("Retrying decryption on events",r(o)),e.next=9,Promise.all(r(o).map(function(){var e=u(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.attemptDecryption(s.crypto,{isRetry:!0});case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()));case 9:return e.abrupt("return",!(this.pendingEvents[t]||{})[n]);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"retryDecryptionFromSender",value:function(){var e=u(a.mark((function e(t){var n,i=this;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.pendingEvents[t]){e.next=3;break}return e.abrupt("return",!0);case 3:return delete this.pendingEvents[t],e.next=6,Promise.all(r(n).map(function(){var e=u(a.mark((function e(t){var n,o;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s(t,2),n[0],o=n[1],e.next=3,Promise.all(r(o).map(function(){var e=u(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.attemptDecryption(i.crypto);case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:return e.abrupt("return",!this.pendingEvents[t]);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendSharedHistoryInboundSessions",value:function(){var e=u(a.mark((function e(t){var n,r,i,u,c,l,d,f,h,p,v,m,k,b,S,w,E,_,x,I,T,R,O,C;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,t);case 2:return g.logger.log("sendSharedHistoryInboundSessions to users",Object.keys(t)),e.next=5,this.olmDevice.getSharedHistoryInboundGroupSessions(this.roomId);case 5:n=e.sent,g.logger.log("shared-history sessions",n),r=o(n),e.prev=8,r.s();case 10:if((i=r.n()).done){e.next=28;break}return u=s(i.value,2),c=u[0],l=u[1],e.next=14,this.buildKeyForwardingMessage(this.roomId,c,l);case 14:for(d=e.sent,f=[],h={},p=0,v=Object.entries(t);p<v.length;p++){m=s(v[p],2),k=m[0],b=m[1],h[k]={},S=o(b);try{for(S.s();!(w=S.n()).done;)E=w.value,_={algorithm:y.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}},h[k][E.deviceId]=_,f.push(y.encryptMessageForDevice(_.ciphertext,this.userId,void 0,this.olmDevice,k,E,d))}catch(a){S.e(a)}finally{S.f()}}return e.next=20,Promise.all(f);case 20:for(x=0,I=Object.keys(h);x<I.length;x++){for(T=I[x],R=0,O=Object.keys(h[T]);R<O.length;R++)C=O[R],0===Object.keys(h[T][C].ciphertext).length&&(g.logger.log("No ciphertext for device "+T+":"+C+": pruning"),delete h[T][C]);0===Object.keys(h[T]).length&&(g.logger.log("Pruned all devices for user "+T),delete h[T])}if(0!==Object.keys(h).length){e.next=24;break}return g.logger.log("No users left to send to: aborting"),e.abrupt("return");case 24:return e.next=26,this.baseApis.sendToDevice("m.room.encrypted",h);case 26:e.next=10;break;case 28:e.next=33;break;case 30:e.prev=30,e.t0=e.catch(8),r.e(e.t0);case 33:return e.prev=33,r.f(),e.finish(33);case 36:case"end":return e.stop()}}),e,this,[[8,30,33,36]])})));return function(t){return e.apply(this,arguments)}}()}]),n}(m.DecryptionAlgorithm),x={no_olm:"The sender was unable to establish a secure channel.",unknown:"The secure channel with the sender was corrupted."};(0,m.registerAlgorithm)(y.MEGOLM_ALGORITHM,E,_)},function(e,t,n){"use strict";(function(e,r){var i=n(6),o=n(7),a=n(0),s=n(2),u=n(11),c=n(9),l=n(10),d=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.QRCodeData=t.ReciprocateQRCode=t.SCAN_QR_CODE_METHOD=t.SHOW_QR_CODE_METHOD=void 0;var f=d(n(3)),h=n(55),p=n(34),v=n(19),g=n(5);t.SHOW_QR_CODE_METHOD="m.qr_code.show.v1";t.SCAN_QR_CODE_METHOD="m.qr_code.scan.v1";var y=function(e){c(n,e);var t=l(n);function n(){var e;a(this,n);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return e=t.call.apply(t,[this].concat(s)),(0,f.default)(u(e),"reciprocateQREvent",void 0),(0,f.default)(u(e),"doVerification",o(i.mark((function t(){var n,r,o,a,s;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.startEvent){t.next=2;break}throw new Error("It is not currently possible to start verificationwith this method yet.");case 2:if(n=e.request.qrCodeData,e.startEvent.getContent().secret===n.encodedSharedSecret){t.next=5;break}throw(0,p.newKeyMismatchError)();case 5:return t.next=7,new Promise((function(t,n){e.reciprocateQREvent={confirm:t,cancel:function(){return n((0,p.newUserCancelledError)())}},e.emit("show_reciprocate_qr",e.reciprocateQREvent)}));case 7:r={},t.t0=n.mode,t.next=t.t0===m.VerifyOtherUser?11:t.t0===m.VerifySelfTrusted?14:t.t0===m.VerifySelfUntrusted?17:20;break;case 11:return o=n.otherUserMasterKey,r["ed25519:".concat(o)]=o,t.abrupt("break",20);case 14:return a=e.request.targetDevice.deviceId,r["ed25519:".concat(a)]=n.otherDeviceKey,t.abrupt("break",20);case 17:return s=n.myMasterKey,r["ed25519:".concat(s)]=s,t.abrupt("break",20);case 20:return t.next=22,e.verifyKeys(e.userId,r,(function(e,t,n){var i=r[e];if(!i)throw(0,p.newKeyMismatchError)();if(n!==i)throw g.logger.error("key ID from key info does not match"),(0,p.newKeyMismatchError)();for(var o in t.keys)if(o.startsWith("ed25519")){var a=r[o];if(!a)throw(0,p.newKeyMismatchError)();if(t.keys[o]!==a)throw g.logger.error("master key does not match"),(0,p.newKeyMismatchError)()}}));case 22:case"end":return t.stop()}}),t)})))),e}return s(n,null,[{key:"factory",value:function(e,t,r,i,o,a){return new n(e,t,r,i,o,a)}},{key:"NAME",get:function(){return"m.reciprocate.v1"}}]),n}(h.VerificationBase);t.ReciprocateQRCode=y;var m;!function(e){e[e.VerifyOtherUser=0]="VerifyOtherUser",e[e.VerifySelfTrusted=1]="VerifySelfTrusted",e[e.VerifySelfUntrusted=2]="VerifySelfUntrusted"}(m||(m={}));var k=function(){function t(e,n,r,i,o,s){a(this,t),this.mode=e,this.sharedSecret=n,this.otherUserMasterKey=r,this.otherDeviceKey=i,this.myMasterKey=o,this.buffer=s}return s(t,[{key:"encodedSharedSecret",get:function(){return this.sharedSecret}},{key:"getBuffer",value:function(){return this.buffer}}],[{key:"create",value:function(){var e=o(i.mark((function e(n,r){var o,a,s,u,c,l,d,f,h,p;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.generateSharedSecret(),a=t.determineMode(n,r),s=null,u=null,c=null,a!==m.VerifyOtherUser){e.next=10;break}l=r.getStoredCrossSigningForUser(n.otherUserId),s=l.getId("master"),e.next=17;break;case 10:if(a!==m.VerifySelfTrusted){e.next=16;break}return e.next=13,t.getOtherDeviceKey(n,r);case 13:u=e.sent,e.next=17;break;case 16:a===m.VerifySelfUntrusted&&(d=r.getUserId(),f=r.getStoredCrossSigningForUser(d),c=f.getId("master"));case 17:return h=t.generateQrData(n,r,a,o,s,u,c),p=t.generateBuffer(h),e.abrupt("return",new t(a,o,s,u,c,p));case 20:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"generateSharedSecret",value:function(){var t=new Uint8Array(11);return e.crypto.getRandomValues(t),(0,v.encodeUnpaddedBase64)(t)}},{key:"getOtherDeviceKey",value:function(){var e=o(i.mark((function e(t,n){var r,o,a,s;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.getUserId(),o=t.targetDevice,a=o?o.deviceId:null,s=n.getStoredDevice(r,a)){e.next=6;break}throw new Error("could not find device "+a);case 6:return e.abrupt("return",s.getFingerprint());case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"determineMode",value:function(e,t){var n=t.getUserId(),r=e.otherUserId,i=m.VerifyOtherUser;n===r&&(i=t.checkUserTrust(n).isCrossSigningVerified()?m.VerifySelfTrusted:m.VerifySelfUntrusted);return i}},{key:"generateQrData",value:function(e,t,n,r,i,o,a){var s=t.getUserId(),u={prefix:"MATRIX",version:2,mode:n,transactionId:e.channel.transactionId,firstKeyB64:"",secondKeyB64:"",secretB64:r},c=t.getStoredCrossSigningForUser(s);return n===m.VerifyOtherUser?(u.firstKeyB64=c.getId("master"),u.secondKeyB64=i):n===m.VerifySelfTrusted?(u.firstKeyB64=c.getId("master"),u.secondKeyB64=o):n===m.VerifySelfUntrusted&&(u.firstKeyB64=t.getDeviceEd25519Key(),u.secondKeyB64=a),u}},{key:"generateBuffer",value:function(e){var t=r.alloc(0),n=function(e){var n=r.from([e]);t=r.concat([t,n])},i=function(e){var n=r.alloc(2);n.writeInt16BE(e,0),t=r.concat([t,n])},o=function(e,n){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=r.from(e,n);o&&i(a.byteLength),t=r.concat([t,a])},a=function(e){var n=(0,v.decodeBase64)(e),i=r.from(n);t=r.concat([t,i])};return o(e.prefix,"ascii",!1),n(e.version),n(e.mode),o(e.transactionId,"utf-8"),a(e.firstKeyB64),a(e.secondKeyB64),a(e.secretB64),t}}]),t}();t.QRCodeData=k}).call(this,n(14),n(24).Buffer)},function(e,t,n){"use strict";(function(e,r){var i=n(13),o=n(16),a=n(6),s=n(7),u=n(0),c=n(2),l=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.DehydrationManager=t.DEHYDRATION_ALGORITHM=void 0;var d=l(n(3)),f=n(19),h=n(22),p=n(33),v=l(n(40)),g=n(5),y="org.matrix.msc2697.v1.olm.libolm_pickle";t.DEHYDRATION_ALGORITHM=y;var m=6048e5,k=function(){function t(e){u(this,t),this.crypto=e,(0,d.default)(this,"inProgress",!1),(0,d.default)(this,"timeoutId",void 0),(0,d.default)(this,"key",void 0),(0,d.default)(this,"keyInfo",void 0),(0,d.default)(this,"deviceDisplayName",void 0),this.getDehydrationKeyFromCache()}return c(t,[{key:"getDehydrationKeyFromCache",value:function(){var t=s(a.mark((function t(){var n=this;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.crypto.cryptoStore.doTxn("readonly",[h.IndexedDBCryptoStore.STORE_ACCOUNT],(function(t){n.crypto.cryptoStore.getSecretStorePrivateKey(t,function(){var t=s(a.mark((function t(i){var o,s,u,c,l,d,h,v;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!i){t.next=12;break}return o=i.key,s=i.keyInfo,u=i.deviceDisplayName,c=i.time,l=e.from(n.crypto.olmDevice.pickleKey),t.next=5,(0,p.decryptAES)(o,l,y);case 5:d=t.sent,n.key=(0,f.decodeBase64)(d),n.keyInfo=s,n.deviceDisplayName=u,h=Date.now(),v=Math.max(1,c+m-h),n.timeoutId=r.setTimeout(n.dehydrateDevice.bind(n),v);case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),"dehydration")}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"setKeyAndQueueDehydration",value:function(){var e=s(a.mark((function e(t){var n,r,i=arguments;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:{},r=i.length>2&&void 0!==i[2]?i[2]:void 0,e.next=4,this.setKey(t,n,r);case 4:e.sent||this.dehydrateDevice();case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setKey",value:function(){var e=s(a.mark((function e(t){var n,i,o,s,u=this,c=arguments;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=c.length>1&&void 0!==c[1]?c[1]:{},i=c.length>2&&void 0!==c[2]?c[2]:void 0,t){e.next=9;break}return this.timeoutId&&(r.clearTimeout(this.timeoutId),this.timeoutId=void 0),e.next=6,this.crypto.cryptoStore.doTxn("readwrite",[h.IndexedDBCryptoStore.STORE_ACCOUNT],(function(e){u.crypto.cryptoStore.storeSecretStorePrivateKey(e,"dehydration",null)}));case 6:return this.key=void 0,this.keyInfo=void 0,e.abrupt("return");case 9:for(o=this.key&&t.length==this.key.length,s=0;o&&s<t.length;s++)t[s]!=this.key[s]&&(o=!1);return o||(this.key=t,this.keyInfo=n,this.deviceDisplayName=i),e.abrupt("return",o);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"dehydrateDevice",value:function(){var t=s(a.mark((function t(){var n,s,u,c,l,d,k,b,S,w,E,_,x,I,T,R,O,C,P,D,A,M,U,N,L,j,B,K,F,q,V=this;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.inProgress){t.next=3;break}return g.logger.log("Dehydration already in progress -- not starting new dehydration"),t.abrupt("return");case 3:return this.inProgress=!0,this.timeoutId&&(r.clearTimeout(this.timeoutId),this.timeoutId=void 0),t.prev=5,s=e.from(this.crypto.olmDevice.pickleKey),t.next=9,(0,p.encryptAES)((0,f.encodeBase64)(this.key),s,y);case 9:return u=t.sent,t.next=12,this.crypto.cryptoStore.doTxn("readwrite",[h.IndexedDBCryptoStore.STORE_ACCOUNT],(function(e){V.crypto.cryptoStore.storeSecretStorePrivateKey(e,"dehydration",{keyInfo:V.keyInfo,key:u,deviceDisplayName:V.deviceDisplayName,time:Date.now()})}));case 12:return g.logger.log("Attempting to dehydrate device"),g.logger.log("Creating account"),(c=new r.Olm.Account).create(),l=JSON.parse(c.identity_keys()),d=c.max_number_of_one_time_keys(),c.generate_one_time_keys(d/2),c.generate_fallback_key(),k=JSON.parse(c.one_time_keys()),b=JSON.parse(c.fallback_key()),c.mark_keys_as_published(),S=c.pickle(new Uint8Array(this.key)),w={algorithm:y,account:S},this.keyInfo.passphrase&&(w.passphrase=this.keyInfo.passphrase),g.logger.log("Uploading account to server"),t.next=29,this.crypto.baseApis.http.authedRequest(void 0,"PUT","/dehydrated_device",void 0,{device_data:w,initial_device_display_name:this.deviceDisplayName},{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"});case 29:if(E=t.sent,_=E.device_id,g.logger.log("Preparing device keys",_),x={algorithms:this.crypto.supportedAlgorithms,device_id:_,user_id:this.crypto.userId,keys:(n={},o(n,"ed25519:".concat(_),l.ed25519),o(n,"curve25519:".concat(_),l.curve25519),n)},I=c.sign(v.default.stringify(x)),x.signatures=o({},this.crypto.userId,o({},"ed25519:".concat(_),I)),!this.crypto.crossSigningInfo.getId("self_signing")){t.next=38;break}return t.next=38,this.crypto.crossSigningInfo.signObject(x,"self_signing");case 38:for(g.logger.log("Preparing one-time keys"),T={},R=0,O=Object.entries(k.curve25519);R<O.length;R++)C=i(O[R],2),P=C[0],D=C[1],A={key:D},M=c.sign(v.default.stringify(A)),A.signatures=o({},this.crypto.userId,o({},"ed25519:".concat(_),M)),T["signed_curve25519:".concat(P)]=A;for(g.logger.log("Preparing fallback keys"),U={},N=0,L=Object.entries(b.curve25519);N<L.length;N++)j=i(L[N],2),B=j[0],K=j[1],F={key:K,fallback:!0},q=c.sign(v.default.stringify(F)),F.signatures=o({},this.crypto.userId,o({},"ed25519:".concat(_),q)),U["signed_curve25519:".concat(B)]=F;return g.logger.log("Uploading keys to server"),t.next=47,this.crypto.baseApis.http.authedRequest(void 0,"POST","/keys/upload/"+encodeURI(_),void 0,{device_keys:x,one_time_keys:T,"org.matrix.msc2732.fallback_keys":U});case 47:return g.logger.log("Done dehydrating"),this.timeoutId=r.setTimeout(this.dehydrateDevice.bind(this),m),t.abrupt("return",_);case 50:return t.prev=50,this.inProgress=!1,t.finish(50);case 53:case"end":return t.stop()}}),t,this,[[5,,50,53]])})));return function(){return t.apply(this,arguments)}}()},{key:"stop",value:function(){this.timeoutId&&(r.clearTimeout(this.timeoutId),this.timeoutId=void 0)}}]),t}();t.DehydrationManager=k}).call(this,n(24).Buffer,n(14))},function(e,t,n){"use strict";(function(e){var r,i=n(16),o=n(8),a=n(13),s=n(6),u=n(7),c=n(0),l=n(2),d=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultAlgorithm=t.algorithmsByName=t.Aes256=t.Curve25519=t.BackupManager=void 0;var f=d(n(3)),h=n(36),p=n(5),v=n(19),g=n(56),y=n(12),m=n(22),k=n(57),b=n(33),S=n(68),w=function(){function e(t,n){c(this,e),this.baseApis=t,this.getKey=n,(0,f.default)(this,"algorithm",void 0),(0,f.default)(this,"backupInfo",void 0),(0,f.default)(this,"checkedForBackup",void 0),(0,f.default)(this,"sendingBackups",void 0),this.checkedForBackup=!1,this.sendingBackups=!1}return l(e,[{key:"version",get:function(){return this.backupInfo&&this.backupInfo.version}},{key:"enableKeyBackup",value:function(){var t=u(s.mark((function t(n){return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.backupInfo=n,this.algorithm&&this.algorithm.free(),t.next=4,e.makeAlgorithm(n,this.getKey);case 4:this.algorithm=t.sent,this.baseApis.emit("crypto.keyBackupStatus",!0),this.scheduleKeyBackupSend();case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"disableKeyBackup",value:function(){this.algorithm&&this.algorithm.free(),this.algorithm=void 0,this.backupInfo=void 0,this.baseApis.emit("crypto.keyBackupStatus",!1)}},{key:"getKeyBackupEnabled",value:function(){return this.checkedForBackup?Boolean(this.algorithm):null}},{key:"prepareKeyBackupVersion",value:function(){var e=u(s.mark((function e(t,n){var r,i,o,u,c,l;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n?T[n]:R){e.next=3;break}throw new Error("Unknown backup algorithm");case 3:return e.next=5,r.prepare(t);case 5:return i=e.sent,o=a(i,2),u=o[0],c=o[1],l=(0,k.encodeRecoveryKey)(u),e.abrupt("return",{algorithm:r.algorithmName,auth_data:c,recovery_key:l,privateKey:u});case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createKeyBackupVersion",value:function(){var t=u(s.mark((function t(n){return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.makeAlgorithm(n,this.getKey);case 2:this.algorithm=t.sent;case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"checkAndStart",value:function(){var e=u(s.mark((function e(){var t,n;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p.logger.log("Checking key backup status..."),!this.baseApis.isGuest()){e.next=5;break}return p.logger.log("Skipping key backup check since user is guest"),this.checkedForBackup=!0,e.abrupt("return",null);case 5:return e.prev=5,e.next=8,this.baseApis.getKeyBackupVersion();case 8:t=e.sent,e.next=16;break;case 11:return e.prev=11,e.t0=e.catch(5),p.logger.log("Error checking for active key backup",e.t0),404===e.t0.httpStatus&&(this.checkedForBackup=!0),e.abrupt("return",null);case 16:return this.checkedForBackup=!0,e.next=19,this.isKeyBackupTrusted(t);case 19:if(!(n=e.sent).usable||this.backupInfo){e.next=26;break}return p.logger.log("Found usable key backup v"+t.version+": enabling key backups"),e.next=24,this.enableKeyBackup(t);case 24:e.next=46;break;case 26:if(n.usable||!this.backupInfo){e.next=31;break}p.logger.log("No usable key backup: disabling key backup"),this.disableKeyBackup(),e.next=46;break;case 31:if(n.usable||this.backupInfo){e.next=35;break}p.logger.log("No usable key backup: not enabling key backup"),e.next=46;break;case 35:if(!n.usable||!this.backupInfo){e.next=46;break}if(t.version===this.backupInfo.version){e.next=45;break}return p.logger.log("On backup version "+this.backupInfo.version+" but found version "+t.version+": switching."),this.disableKeyBackup(),e.next=41,this.enableKeyBackup(t);case 41:return e.next=43,this.scheduleAllGroupSessionsForBackup();case 43:e.next=46;break;case 45:p.logger.log("Backup version "+t.version+" still current");case 46:return e.abrupt("return",{backupInfo:t,trustInfo:n});case 47:case"end":return e.stop()}}),e,this,[[5,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"checkKeyBackup",value:function(){var e=u(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkedForBackup=!1,e.abrupt("return",this.checkAndStart());case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isKeyBackupTrusted",value:function(){var e=u(s.mark((function e(t){var n,r,i,o,a,u,c,l,d,f;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={usable:!1,trusted_locally:!1,sigs:[]},t&&t.algorithm&&t.auth_data&&t.auth_data.signatures){e.next=4;break}return p.logger.info("Key backup is absent or missing required data"),e.abrupt("return",n);case 4:r=this.baseApis.crypto.sessionStore.getLocalTrustedBackupPubKey(),"public_key"in t.auth_data&&t.auth_data.public_key===r&&(p.logger.info("Backup public key "+r+" is trusted locally"),n.trusted_locally=!0),i=t.auth_data.signatures[this.baseApis.getUserId()]||[],o=0,a=Object.keys(i);case 8:if(!(o<a.length)){e.next=54;break}if(u=a[o],"ed25519"===(c=u.split(":"))[0]){e.next=14;break}return p.logger.log("Ignoring unknown signature type: "+c[0]),e.abrupt("continue",51);case 14:if(l={deviceId:c[1]},(d=this.baseApis.crypto.crossSigningInfo.getId())!==l.deviceId){e.next=30;break}return l.crossSigningId=!0,e.prev=18,e.next=21,(0,v.verifySignature)(this.baseApis.crypto.olmDevice,t.auth_data,this.baseApis.getUserId(),l.deviceId,d);case 21:l.valid=!0,e.next=28;break;case 24:e.prev=24,e.t0=e.catch(18),p.logger.warn("Bad signature from cross signing key "+d,e.t0),l.valid=!1;case 28:return n.sigs.push(l),e.abrupt("continue",51);case 30:if(!(f=this.baseApis.crypto.deviceList.getStoredDevice(this.baseApis.getUserId(),l.deviceId))){e.next=48;break}return l.device=f,e.next=35,this.baseApis.checkDeviceTrust(this.baseApis.getUserId(),l.deviceId);case 35:return l.deviceTrust=e.sent,e.prev=36,e.next=39,(0,v.verifySignature)(this.baseApis.crypto.olmDevice,t.auth_data,this.baseApis.getUserId(),f.deviceId,f.getFingerprint());case 39:l.valid=!0,e.next=46;break;case 42:e.prev=42,e.t1=e.catch(36),p.logger.info("Bad signature from key ID "+u+" userID "+this.baseApis.getUserId()+" device ID "+f.deviceId+" fingerprint: "+f.getFingerprint(),t.auth_data,e.t1),l.valid=!1;case 46:e.next=50;break;case 48:l.valid=null,p.logger.info("Ignoring signature from unknown key "+u);case 50:n.sigs.push(l);case 51:o++,e.next=8;break;case 54:return n.usable=n.sigs.some((function(e){return e.valid&&(e.device&&e.deviceTrust.isVerified()||e.crossSigningId)})),n.usable=n.usable||n.trusted_locally,e.abrupt("return",n);case 57:case"end":return e.stop()}}),e,this,[[18,24],[36,42]])})));return function(t){return e.apply(this,arguments)}}()},{key:"scheduleKeyBackupSend",value:function(){var e=u(s.mark((function e(){var t,n,r,i=arguments;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:1e4,!this.sendingBackups){e.next=3;break}return e.abrupt("return");case 3:return this.sendingBackups=!0,e.prev=4,n=Math.random()*t,e.next=8,(0,y.sleep)(n,void 0);case 8:r=0;case 9:if(this.algorithm){e.next=11;break}return e.abrupt("return");case 11:return e.prev=11,e.next=14,this.backupPendingKeys(200);case 14:if(0!==e.sent){e.next=17;break}return e.abrupt("return");case 17:r=0,e.next=30;break;case 20:if(e.prev=20,e.t0=e.catch(11),r++,p.logger.log("Key backup request failed",e.t0),!e.t0.data){e.next=30;break}if("M_NOT_FOUND"!=e.t0.data.errcode&&"M_WRONG_ROOM_KEYS_VERSION"!=e.t0.data.errcode){e.next=30;break}return e.next=28,this.checkKeyBackup();case 28:throw this.baseApis.crypto.emit("crypto.keyBackupFailed",e.t0.data.errcode),e.t0;case 30:if(!r){e.next=33;break}return e.next=33,(0,y.sleep)(1e3*Math.pow(2,Math.min(r-1,4)),void 0);case 33:e.next=9;break;case 35:return e.prev=35,this.sendingBackups=!1,e.finish(35);case 38:case"end":return e.stop()}}),e,this,[[4,,35,38],[11,20]])})));return function(){return e.apply(this,arguments)}}()},{key:"backupPendingKeys",value:function(){var e=u(s.mark((function e(t){var n,r,i,a,u,c,l,d,f,h,p,g;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.baseApis.crypto.cryptoStore.getSessionsNeedingBackup(t);case 2:if((n=e.sent).length){e.next=5;break}return e.abrupt("return",0);case 5:return e.next=7,this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup();case 7:r=e.sent,this.baseApis.crypto.emit("crypto.keyBackupSessionsRemaining",r),i={},a=o(n),e.prev=11,a.s();case 13:if((u=a.n()).done){e.next=34;break}return c=u.value,l=c.sessionData.room_id,void 0===i[l]&&(i[l]={sessions:{}}),e.next=19,this.baseApis.crypto.olmDevice.exportInboundGroupSession(c.senderKey,c.sessionId,c.sessionData);case 19:return(d=e.sent).algorithm=v.MEGOLM_ALGORITHM,f=(d.forwarding_curve25519_key_chain||[]).length,h=this.baseApis.crypto.deviceList.getUserByIdentityKey(v.MEGOLM_ALGORITHM,c.senderKey),p=this.baseApis.crypto.deviceList.getDeviceByIdentityKey(v.MEGOLM_ALGORITHM,c.senderKey),g=this.baseApis.crypto.checkDeviceInfoTrust(h,p).isVerified(),e.t0=d.first_known_index,e.t1=f,e.t2=g,e.next=30,this.algorithm.encryptSession(d);case 30:e.t3=e.sent,i[l].sessions[c.sessionId]={first_message_index:e.t0,forwarded_count:e.t1,is_verified:e.t2,session_data:e.t3};case 32:e.next=13;break;case 34:e.next=39;break;case 36:e.prev=36,e.t4=e.catch(11),a.e(e.t4);case 39:return e.prev=39,a.f(),e.finish(39);case 42:return e.next=44,this.baseApis.sendKeyBackup(void 0,void 0,this.backupInfo.version,{rooms:i});case 44:return e.next=46,this.baseApis.crypto.cryptoStore.unmarkSessionsNeedingBackup(n);case 46:return e.next=48,this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup();case 48:return r=e.sent,this.baseApis.crypto.emit("crypto.keyBackupSessionsRemaining",r),e.abrupt("return",n.length);case 51:case"end":return e.stop()}}),e,this,[[11,36,39,42]])})));return function(t){return e.apply(this,arguments)}}()},{key:"backupGroupSession",value:function(){var e=u(s.mark((function e(t,n){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.baseApis.crypto.cryptoStore.markSessionsNeedingBackup([{senderKey:t,sessionId:n}]);case 2:this.backupInfo&&this.scheduleKeyBackupSend();case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"scheduleAllGroupSessionsForBackup",value:function(){var e=u(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.flagAllGroupSessionsForBackup();case 2:this.scheduleKeyBackupSend(0);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"flagAllGroupSessionsForBackup",value:function(){var e=u(s.mark((function e(){var t,n=this;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.baseApis.crypto.cryptoStore.doTxn("readwrite",[m.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,m.IndexedDBCryptoStore.STORE_BACKUP],(function(e){n.baseApis.crypto.cryptoStore.getAllEndToEndInboundGroupSessions(e,(function(t){null!==t&&n.baseApis.crypto.cryptoStore.markSessionsNeedingBackup([t],e)}))}));case 2:return e.next=4,this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup();case 4:return t=e.sent,this.baseApis.emit("crypto.keyBackupSessionsRemaining",t),e.abrupt("return",t);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"countSessionsNeedingBackup",value:function(){return this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup()}}],[{key:"checkBackupVersion",value:function(e){var t=T[e.algorithm];if(!t)throw new Error("Unknown backup algorithm: "+e.algorithm);if("object"!==typeof e.auth_data)throw new Error("Invalid backup data returned");return t.checkBackupVersion(e)}},{key:"makeAlgorithm",value:function(){var e=u(s.mark((function e(t,n){var r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=T[t.algorithm]){e.next=3;break}throw new Error("Unknown backup algorithm");case 3:return e.next=5,r.init(t.auth_data,n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}();t.BackupManager=w;var E=function(){function t(e,n,r){c(this,t),this.authData=e,this.publicKey=n,this.getKey=r}return l(t,[{key:"untrusted",get:function(){return!0}},{key:"encryptSession",value:function(){var e=u(s.mark((function e(t){var n;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return delete(n=Object.assign({},t)).session_id,delete n.room_id,delete n.first_known_index,e.abrupt("return",this.publicKey.encrypt(JSON.stringify(n)));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"decryptSessions",value:function(){var t=u(s.mark((function t(n){var r,i,o,u,c,l,d,f,v;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getKey();case 2:if(r=t.sent,i=new e.Olm.PkDecryption,t.prev=4,i.init_with_private_key(r)===this.authData.public_key){t.next=8;break}throw{errcode:h.MatrixClient.RESTORE_BACKUP_ERROR_BAD_KEY};case 8:for(o=[],u=0,c=Object.entries(n);u<c.length;u++){l=a(c[u],2),d=l[0],f=l[1];try{(v=JSON.parse(i.decrypt(f.session_data.ephemeral,f.session_data.mac,f.session_data.ciphertext))).session_id=d,o.push(v)}catch(s){p.logger.log("Failed to decrypt megolm session from backup",s,f)}}return t.abrupt("return",o);case 11:return t.prev=11,i.free(),t.finish(11);case 14:case"end":return t.stop()}}),t,this,[[4,,11,14]])})));return function(e){return t.apply(this,arguments)}}()},{key:"keyMatches",value:function(){var t=u(s.mark((function t(n){var r,i;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=new e.Olm.PkDecryption;try{i=r.init_with_private_key(n)}finally{r.free()}return t.abrupt("return",i===this.authData.public_key);case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"free",value:function(){this.publicKey.free()}}],[{key:"init",value:function(){var n=u(s.mark((function n(r,i){var o;return s.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r&&"public_key"in r){n.next=2;break}throw new Error("auth_data missing required information");case 2:return(o=new e.Olm.PkEncryption).set_recipient_key(r.public_key),n.abrupt("return",new t(r,o,i));case 5:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()},{key:"prepare",value:function(){var t=u(s.mark((function t(n){var r,i,o;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=new e.Olm.PkDecryption,t.prev=1,i={},n){t.next=7;break}i.public_key=r.generate_key(),t.next=17;break;case 7:if(!(n instanceof Uint8Array)){t.next=11;break}i.public_key=r.init_with_private_key(n),t.next=17;break;case 11:return t.next=13,(0,g.keyFromPassphrase)(n);case 13:o=t.sent,i.private_key_salt=o.salt,i.private_key_iterations=o.iterations,i.public_key=r.init_with_private_key(o.key);case 17:return(new e.Olm.PkEncryption).set_recipient_key(i.public_key),t.abrupt("return",[r.get_private_key(),i]);case 20:return t.prev=20,r.free(),t.finish(20);case 23:case"end":return t.stop()}}),t,null,[[1,,20,23]])})));return function(e){return t.apply(this,arguments)}}()},{key:"checkBackupVersion",value:function(e){if(!("public_key"in e.auth_data))throw new Error("Invalid backup data returned")}}]),t}();function _(e){var t,n=(0,y.getCrypto)();if(n)return n.randomBytes(e);if(null!==(t=window)&&void 0!==t&&t.crypto){var r=new Uint8Array(e);return window.crypto.getRandomValues(r),r}throw new Error("No usable crypto implementation")}t.Curve25519=E,(0,f.default)(E,"algorithmName","m.megolm_backup.v1.curve25519-aes-sha2");var x=new S.UnstableValue(null,"org.matrix.msc3270.v1.aes-hmac-sha2"),I=function(){function e(t,n){c(this,e),this.authData=t,this.key=n}return l(e,[{key:"untrusted",get:function(){return!1}},{key:"encryptSession",value:function(){var e=u(s.mark((function e(t){var n;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return delete(n=Object.assign({},t)).session_id,delete n.room_id,delete n.first_known_index,e.next=6,(0,b.encryptAES)(JSON.stringify(n),this.key,t.session_id);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"decryptSessions",value:function(){var e=u(s.mark((function e(t){var n,r,i,o,u,c,l;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=0,i=Object.entries(t);case 2:if(!(r<i.length)){e.next=20;break}return o=a(i[r],2),u=o[0],c=o[1],e.prev=4,e.t0=JSON,e.next=8,(0,b.decryptAES)(c.session_data,this.key,u);case 8:e.t1=e.sent,(l=e.t0.parse.call(e.t0,e.t1)).session_id=u,n.push(l),e.next=17;break;case 14:e.prev=14,e.t2=e.catch(4),p.logger.log("Failed to decrypt megolm session from backup",e.t2,c);case 17:r++,e.next=2;break;case 20:return e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,this,[[4,14]])})));return function(t){return e.apply(this,arguments)}}()},{key:"keyMatches",value:function(){var e=u(s.mark((function e(t){var n,r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.authData.mac){e.next=8;break}return e.next=3,(0,b.calculateKeyCheck)(t,this.authData.iv);case 3:return n=e.sent,r=n.mac,e.abrupt("return",this.authData.mac.replace(/=+$/g,"")===r.replace(/=+/g,""));case 8:return e.abrupt("return",!0);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"free",value:function(){this.key.fill(0)}}],[{key:"init",value:function(){var t=u(s.mark((function t(n,r){var i,o,a;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}throw new Error("auth_data missing");case 2:return t.next=4,r();case 4:if(i=t.sent,!n.mac){t.next=12;break}return t.next=8,(0,b.calculateKeyCheck)(i,n.iv);case 8:if(o=t.sent,a=o.mac,n.mac.replace(/=+$/g,"")===a.replace(/=+/g,"")){t.next=12;break}throw new Error("Key does not match");case 12:return t.abrupt("return",new e(n,i));case 13:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"prepare",value:function(){var e=u(s.mark((function e(t){var n,r,i,o,a,u;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={},t){e.next=5;break}n=_(32),e.next=15;break;case 5:if(!(t instanceof Uint8Array)){e.next=9;break}n=new Uint8Array(t),e.next=15;break;case 9:return e.next=11,(0,g.keyFromPassphrase)(t);case 11:i=e.sent,r.private_key_salt=i.salt,r.private_key_iterations=i.iterations,n=i.key;case 15:return e.next=17,(0,b.calculateKeyCheck)(n);case 17:return o=e.sent,a=o.iv,u=o.mac,r.iv=a,r.mac=u,e.abrupt("return",[n,r]);case 23:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkBackupVersion",value:function(e){if(!("iv"in e.auth_data)||!("mac"in e.auth_data))throw new Error("Invalid backup data returned")}}]),e}();t.Aes256=I,(0,f.default)(I,"algorithmName",x.name);var T=(i(r={},E.algorithmName,E),i(r,I.algorithmName,I),r);t.algorithmsByName=T;var R=E;t.DefaultAlgorithm=R}).call(this,n(14))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeHtmlMessage=function(e,t){return{msgtype:r.MsgType.Text,format:"org.matrix.custom.html",body:e,formatted_body:t}},t.makeHtmlNotice=function(e,t){return{msgtype:r.MsgType.Notice,format:"org.matrix.custom.html",body:e,formatted_body:t}},t.makeHtmlEmote=function(e,t){return{msgtype:r.MsgType.Emote,format:"org.matrix.custom.html",body:e,formatted_body:t}},t.makeTextMessage=function(e){return{msgtype:r.MsgType.Text,body:e}},t.makeNotice=function(e){return{msgtype:r.MsgType.Notice,body:e}},t.makeEmoteMessage=function(e){return{msgtype:r.MsgType.Emote,body:e}};var r=n(17)},function(e,t,n){"use strict";var r=n(61),i=Object.prototype.hasOwnProperty,o=Array.isArray,a=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),s=function(e,t){for(var n=t&&t.plainObjects?Object.create(null):{},r=0;r<e.length;++r)"undefined"!==typeof e[r]&&(n[r]=e[r]);return n};e.exports={arrayToObject:s,assign:function(e,t){return Object.keys(t).reduce((function(e,n){return e[n]=t[n],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],n=[],r=0;r<t.length;++r)for(var i=t[r],a=i.obj[i.prop],s=Object.keys(a),u=0;u<s.length;++u){var c=s[u],l=a[c];"object"===typeof l&&null!==l&&-1===n.indexOf(l)&&(t.push({obj:a,prop:c}),n.push(l))}return function(e){for(;e.length>1;){var t=e.pop(),n=t.obj[t.prop];if(o(n)){for(var r=[],i=0;i<n.length;++i)"undefined"!==typeof n[i]&&r.push(n[i]);t.obj[t.prop]=r}}}(t),e},decode:function(e,t,n){var r=e.replace(/\+/g," ");if("iso-8859-1"===n)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(i){return r}},encode:function(e,t,n,i,o){if(0===e.length)return e;var s=e;if("symbol"===typeof e?s=Symbol.prototype.toString.call(e):"string"!==typeof e&&(s=String(e)),"iso-8859-1"===n)return escape(s).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var u="",c=0;c<s.length;++c){var l=s.charCodeAt(c);45===l||46===l||95===l||126===l||l>=48&&l<=57||l>=65&&l<=90||l>=97&&l<=122||o===r.RFC1738&&(40===l||41===l)?u+=s.charAt(c):l<128?u+=a[l]:l<2048?u+=a[192|l>>6]+a[128|63&l]:l<55296||l>=57344?u+=a[224|l>>12]+a[128|l>>6&63]+a[128|63&l]:(c+=1,l=65536+((1023&l)<<10|1023&s.charCodeAt(c)),u+=a[240|l>>18]+a[128|l>>12&63]+a[128|l>>6&63]+a[128|63&l])}return u},isBuffer:function(e){return!(!e||"object"!==typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(o(e)){for(var n=[],r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)},merge:function e(t,n,r){if(!n)return t;if("object"!==typeof n){if(o(t))t.push(n);else{if(!t||"object"!==typeof t)return[t,n];(r&&(r.plainObjects||r.allowPrototypes)||!i.call(Object.prototype,n))&&(t[n]=!0)}return t}if(!t||"object"!==typeof t)return[t].concat(n);var a=t;return o(t)&&!o(n)&&(a=s(t,r)),o(t)&&o(n)?(n.forEach((function(n,o){if(i.call(t,o)){var a=t[o];a&&"object"===typeof a&&n&&"object"===typeof n?t[o]=e(a,n,r):t.push(n)}else t[o]=n})),t):Object.keys(n).reduce((function(t,o){var a=n[o];return i.call(t,o)?t[o]=e(t[o],a,r):t[o]=a,t}),a)}}},function(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(92)},function(e,t,n){"use strict";(function(e){var r=n(1);Object.defineProperty(t,"__esModule",{value:!0});var i={};t.default=void 0;var o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}r.default=e,n&&n.set(e,r);return r}(n(44));Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===o[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}}))}));var a,s=r(n(165)),u=r(n(166));function c(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}o.request((function(e,t){return e.qs=u.default.stringify(e.qs||{},e.qsStringifyOptions),(0,s.default)(e,t)}));try{a=e.indexedDB}catch(d){}a&&o.setCryptoStoreFactory((function(){return new o.IndexedDBCryptoStore(a,"matrix-js-sdk:crypto")}));var l=o;t.default=l,e.matrixcs=o}).call(this,n(14))},function(e,t,n){"use strict";var r=n(43),i=60103,o=60106;t.Fragment=60107,t.StrictMode=60108,t.Profiler=60114;var a=60109,s=60110,u=60112;t.Suspense=60113;var c=60115,l=60116;if("function"===typeof Symbol&&Symbol.for){var d=Symbol.for;i=d("react.element"),o=d("react.portal"),t.Fragment=d("react.fragment"),t.StrictMode=d("react.strict_mode"),t.Profiler=d("react.profiler"),a=d("react.provider"),s=d("react.context"),u=d("react.forward_ref"),t.Suspense=d("react.suspense"),c=d("react.memo"),l=d("react.lazy")}var f="function"===typeof Symbol&&Symbol.iterator;function h(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v={};function g(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||p}function y(){}function m(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||p}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error(h(85));this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=g.prototype;var k=m.prototype=new y;k.constructor=m,r(k,g.prototype),k.isPureReactComponent=!0;var b={current:null},S=Object.prototype.hasOwnProperty,w={key:!0,ref:!0,__self:!0,__source:!0};function E(e,t,n){var r,o={},a=null,s=null;if(null!=t)for(r in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(a=""+t.key),t)S.call(t,r)&&!w.hasOwnProperty(r)&&(o[r]=t[r]);var u=arguments.length-2;if(1===u)o.children=n;else if(1<u){for(var c=Array(u),l=0;l<u;l++)c[l]=arguments[l+2];o.children=c}if(e&&e.defaultProps)for(r in u=e.defaultProps)void 0===o[r]&&(o[r]=u[r]);return{$$typeof:i,type:e,key:a,ref:s,props:o,_owner:b.current}}function _(e){return"object"===typeof e&&null!==e&&e.$$typeof===i}var x=/\/+/g;function I(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function T(e,t,n,r,a){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var u=!1;if(null===e)u=!0;else switch(s){case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case i:case o:u=!0}}if(u)return a=a(u=e),e=""===r?"."+I(u,0):r,Array.isArray(a)?(n="",null!=e&&(n=e.replace(x,"$&/")+"/"),T(a,t,n,"",(function(e){return e}))):null!=a&&(_(a)&&(a=function(e,t){return{$$typeof:i,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,n+(!a.key||u&&u.key===a.key?"":(""+a.key).replace(x,"$&/")+"/")+e)),t.push(a)),1;if(u=0,r=""===r?".":r+":",Array.isArray(e))for(var c=0;c<e.length;c++){var l=r+I(s=e[c],c);u+=T(s,t,n,l,a)}else if("function"===typeof(l=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e)))for(e=l.call(e),c=0;!(s=e.next()).done;)u+=T(s=s.value,t,n,l=r+I(s,c++),a);else if("object"===s)throw t=""+e,Error(h(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t));return u}function R(e,t,n){if(null==e)return e;var r=[],i=0;return T(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function O(e){if(-1===e._status){var t=e._result;t=t(),e._status=0,e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}if(1===e._status)return e._result;throw e._result}var C={current:null};function P(){var e=C.current;if(null===e)throw Error(h(321));return e}var D={ReactCurrentDispatcher:C,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:b,IsSomeRendererActing:{current:!1},assign:r};t.Children={map:R,forEach:function(e,t,n){R(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return R(e,(function(){t++})),t},toArray:function(e){return R(e,(function(e){return e}))||[]},only:function(e){if(!_(e))throw Error(h(143));return e}},t.Component=g,t.PureComponent=m,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D,t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error(h(267,e));var o=r({},e.props),a=e.key,s=e.ref,u=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,u=b.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(l in t)S.call(t,l)&&!w.hasOwnProperty(l)&&(o[l]=void 0===t[l]&&void 0!==c?c[l]:t[l])}var l=arguments.length-2;if(1===l)o.children=n;else if(1<l){c=Array(l);for(var d=0;d<l;d++)c[d]=arguments[d+2];o.children=c}return{$$typeof:i,type:e.type,key:a,ref:s,props:o,_owner:u}},t.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:s,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=E,t.createFactory=function(e){var t=E.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:u,render:e}},t.isValidElement=_,t.lazy=function(e){return{$$typeof:l,_payload:{_status:-1,_result:e},_init:O}},t.memo=function(e,t){return{$$typeof:c,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return P().useCallback(e,t)},t.useContext=function(e,t){return P().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return P().useEffect(e,t)},t.useImperativeHandle=function(e,t,n){return P().useImperativeHandle(e,t,n)},t.useLayoutEffect=function(e,t){return P().useLayoutEffect(e,t)},t.useMemo=function(e,t){return P().useMemo(e,t)},t.useReducer=function(e,t,n){return P().useReducer(e,t,n)},t.useRef=function(e){return P().useRef(e)},t.useState=function(e){return P().useState(e)},t.version="17.0.2"},function(e,t,n){"use strict";var r=n(20),i=n(43),o=n(93);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!r)throw Error(a(227));var s=new Set,u={};function c(e,t){l(e,t),l(e+"Capture",t)}function l(e,t){for(u[e]=t,e=0;e<t.length;e++)s.add(t[e])}var d=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,h=Object.prototype.hasOwnProperty,p={},v={};function g(e,t,n,r,i,o,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=a}var y={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){y[e]=new g(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];y[t]=new g(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){y[e]=new g(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){y[e]=new g(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){y[e]=new g(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){y[e]=new g(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){y[e]=new g(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){y[e]=new g(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){y[e]=new g(e,5,!1,e.toLowerCase(),null,!1,!1)}));var m=/[\-:]([a-z])/g;function k(e){return e[1].toUpperCase()}function b(e,t,n,r){var i=y.hasOwnProperty(t)?y[t]:null;(null!==i?0===i.type:!r&&(2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1])))||(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!h.call(v,e)||!h.call(p,e)&&(f.test(e)?v[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(m,k);y[t]=new g(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(m,k);y[t]=new g(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(m,k);y[t]=new g(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){y[e]=new g(e,1,!1,e.toLowerCase(),null,!1,!1)})),y.xlinkHref=new g("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){y[e]=new g(e,1,!1,e.toLowerCase(),null,!0,!0)}));var S=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=60103,E=60106,_=60107,x=60108,I=60114,T=60109,R=60110,O=60112,C=60113,P=60120,D=60115,A=60116,M=60121,U=60128,N=60129,L=60130,j=60131;if("function"===typeof Symbol&&Symbol.for){var B=Symbol.for;w=B("react.element"),E=B("react.portal"),_=B("react.fragment"),x=B("react.strict_mode"),I=B("react.profiler"),T=B("react.provider"),R=B("react.context"),O=B("react.forward_ref"),C=B("react.suspense"),P=B("react.suspense_list"),D=B("react.memo"),A=B("react.lazy"),M=B("react.block"),B("react.scope"),U=B("react.opaque.id"),N=B("react.debug_trace_mode"),L=B("react.offscreen"),j=B("react.legacy_hidden")}var K,F="function"===typeof Symbol&&Symbol.iterator;function q(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=F&&e[F]||e["@@iterator"])?e:null}function V(e){if(void 0===K)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);K=t&&t[1]||""}return"\n"+K+e}var G=!1;function W(e,t){if(!e||G)return"";G=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var r=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){r=u}e.call(t.prototype)}else{try{throw Error()}catch(u){r=u}e()}}catch(u){if(u&&r&&"string"===typeof u.stack){for(var i=u.stack.split("\n"),o=r.stack.split("\n"),a=i.length-1,s=o.length-1;1<=a&&0<=s&&i[a]!==o[s];)s--;for(;1<=a&&0<=s;a--,s--)if(i[a]!==o[s]){if(1!==a||1!==s)do{if(a--,0>--s||i[a]!==o[s])return"\n"+i[a].replace(" at new "," at ")}while(1<=a&&0<=s);break}}}finally{G=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?V(e):""}function H(e){switch(e.tag){case 5:return V(e.type);case 16:return V("Lazy");case 13:return V("Suspense");case 19:return V("SuspenseList");case 0:case 2:case 15:return e=W(e.type,!1);case 11:return e=W(e.type.render,!1);case 22:return e=W(e.type._render,!1);case 1:return e=W(e.type,!0);default:return""}}function $(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case _:return"Fragment";case E:return"Portal";case I:return"Profiler";case x:return"StrictMode";case C:return"Suspense";case P:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case R:return(e.displayName||"Context")+".Consumer";case T:return(e._context.displayName||"Context")+".Provider";case O:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case D:return $(e.type);case M:return $(e._render);case A:t=e._payload,e=e._init;try{return $(e(t))}catch(n){}}return null}function z(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function Y(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function Q(e){e._valueTracker||(e._valueTracker=function(e){var t=Y(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function J(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=Y(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function X(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Z(e,t){var n=t.checked;return i({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function ee(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=z(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function te(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function ne(e,t){te(e,t);var n=z(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ie(e,t.type,n):t.hasOwnProperty("defaultValue")&&ie(e,t.type,z(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function re(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ie(e,t,n){"number"===t&&X(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}function oe(e,t){return e=i({children:void 0},t),(t=function(e){var t="";return r.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(t.children))&&(e.children=t),e}function ae(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+z(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function se(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return i({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ue(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(a(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(a(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:z(n)}}function ce(e,t){var n=z(t.value),r=z(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function le(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}var de="http://www.w3.org/1999/xhtml",fe="http://www.w3.org/2000/svg";function he(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function pe(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?he(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ve,ge,ye=(ge=function(e,t){if(e.namespaceURI!==fe||"innerHTML"in e)e.innerHTML=t;else{for((ve=ve||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ve.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return ge(e,t)}))}:ge);function me(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var ke={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},be=["Webkit","ms","Moz","O"];function Se(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||ke.hasOwnProperty(e)&&ke[e]?(""+t).trim():t+"px"}function we(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=Se(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(ke).forEach((function(e){be.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),ke[t]=ke[e]}))}));var Ee=i({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function _e(e,t){if(t){if(Ee[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(a(62))}}function xe(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function Ie(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Te=null,Re=null,Oe=null;function Ce(e){if(e=ei(e)){if("function"!==typeof Te)throw Error(a(280));var t=e.stateNode;t&&(t=ni(t),Te(e.stateNode,e.type,t))}}function Pe(e){Re?Oe?Oe.push(e):Oe=[e]:Re=e}function De(){if(Re){var e=Re,t=Oe;if(Oe=Re=null,Ce(e),t)for(e=0;e<t.length;e++)Ce(t[e])}}function Ae(e,t){return e(t)}function Me(e,t,n,r,i){return e(t,n,r,i)}function Ue(){}var Ne=Ae,Le=!1,je=!1;function Be(){null===Re&&null===Oe||(Ue(),De())}function Ke(e,t){var n=e.stateNode;if(null===n)return null;var r=ni(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(a(231,t,typeof n));return n}var Fe=!1;if(d)try{var qe={};Object.defineProperty(qe,"passive",{get:function(){Fe=!0}}),window.addEventListener("test",qe,qe),window.removeEventListener("test",qe,qe)}catch(ge){Fe=!1}function Ve(e,t,n,r,i,o,a,s,u){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(l){this.onError(l)}}var Ge=!1,We=null,He=!1,$e=null,ze={onError:function(e){Ge=!0,We=e}};function Ye(e,t,n,r,i,o,a,s,u){Ge=!1,We=null,Ve.apply(ze,arguments)}function Qe(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(1026&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Je(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Xe(e){if(Qe(e)!==e)throw Error(a(188))}function Ze(e){if(!(e=function(e){var t=e.alternate;if(!t){if(null===(t=Qe(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(r=i.return)){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return Xe(i),e;if(o===r)return Xe(i),t;o=o.sibling}throw Error(a(188))}if(n.return!==r.return)n=i,r=o;else{for(var s=!1,u=i.child;u;){if(u===n){s=!0,n=i,r=o;break}if(u===r){s=!0,r=i,n=o;break}u=u.sibling}if(!s){for(u=o.child;u;){if(u===n){s=!0,n=o,r=i;break}if(u===r){s=!0,r=o,n=i;break}u=u.sibling}if(!s)throw Error(a(189))}}if(n.alternate!==r)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function et(e,t){for(var n=e.alternate;null!==t;){if(t===e||t===n)return!0;t=t.return}return!1}var tt,nt,rt,it,ot=!1,at=[],st=null,ut=null,ct=null,lt=new Map,dt=new Map,ft=[],ht="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function pt(e,t,n,r,i){return{blockedOn:e,domEventName:t,eventSystemFlags:16|n,nativeEvent:i,targetContainers:[r]}}function vt(e,t){switch(e){case"focusin":case"focusout":st=null;break;case"dragenter":case"dragleave":ut=null;break;case"mouseover":case"mouseout":ct=null;break;case"pointerover":case"pointerout":lt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":dt.delete(t.pointerId)}}function gt(e,t,n,r,i,o){return null===e||e.nativeEvent!==o?(e=pt(t,n,r,i,o),null!==t&&(null!==(t=ei(t))&&nt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function yt(e){var t=Zr(e.target);if(null!==t){var n=Qe(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Je(n)))return e.blockedOn=t,void it(e.lanePriority,(function(){o.unstable_runWithPriority(e.priority,(function(){rt(n)}))}))}else if(3===t&&n.stateNode.hydrate)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function mt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Zt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=ei(n))&&nt(t),e.blockedOn=n,!1;t.shift()}return!0}function kt(e,t,n){mt(e)&&n.delete(t)}function bt(){for(ot=!1;0<at.length;){var e=at[0];if(null!==e.blockedOn){null!==(e=ei(e.blockedOn))&&tt(e);break}for(var t=e.targetContainers;0<t.length;){var n=Zt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n){e.blockedOn=n;break}t.shift()}null===e.blockedOn&&at.shift()}null!==st&&mt(st)&&(st=null),null!==ut&&mt(ut)&&(ut=null),null!==ct&&mt(ct)&&(ct=null),lt.forEach(kt),dt.forEach(kt)}function St(e,t){e.blockedOn===t&&(e.blockedOn=null,ot||(ot=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,bt)))}function wt(e){function t(t){return St(t,e)}if(0<at.length){St(at[0],e);for(var n=1;n<at.length;n++){var r=at[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==st&&St(st,e),null!==ut&&St(ut,e),null!==ct&&St(ct,e),lt.forEach(t),dt.forEach(t),n=0;n<ft.length;n++)(r=ft[n]).blockedOn===e&&(r.blockedOn=null);for(;0<ft.length&&null===(n=ft[0]).blockedOn;)yt(n),null===n.blockedOn&&ft.shift()}function Et(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var _t={animationend:Et("Animation","AnimationEnd"),animationiteration:Et("Animation","AnimationIteration"),animationstart:Et("Animation","AnimationStart"),transitionend:Et("Transition","TransitionEnd")},xt={},It={};function Tt(e){if(xt[e])return xt[e];if(!_t[e])return e;var t,n=_t[e];for(t in n)if(n.hasOwnProperty(t)&&t in It)return xt[e]=n[t];return e}d&&(It=document.createElement("div").style,"AnimationEvent"in window||(delete _t.animationend.animation,delete _t.animationiteration.animation,delete _t.animationstart.animation),"TransitionEvent"in window||delete _t.transitionend.transition);var Rt=Tt("animationend"),Ot=Tt("animationiteration"),Ct=Tt("animationstart"),Pt=Tt("transitionend"),Dt=new Map,At=new Map,Mt=["abort","abort",Rt,"animationEnd",Ot,"animationIteration",Ct,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Pt,"transitionEnd","waiting","waiting"];function Ut(e,t){for(var n=0;n<e.length;n+=2){var r=e[n],i=e[n+1];i="on"+(i[0].toUpperCase()+i.slice(1)),At.set(r,t),Dt.set(r,i),c(i,[r])}}(0,o.unstable_now)();var Nt=8;function Lt(e){if(0!==(1&e))return Nt=15,1;if(0!==(2&e))return Nt=14,2;if(0!==(4&e))return Nt=13,4;var t=24&e;return 0!==t?(Nt=12,t):0!==(32&e)?(Nt=11,32):0!==(t=192&e)?(Nt=10,t):0!==(256&e)?(Nt=9,256):0!==(t=3584&e)?(Nt=8,t):0!==(4096&e)?(Nt=7,4096):0!==(t=4186112&e)?(Nt=6,t):0!==(t=62914560&e)?(Nt=5,t):67108864&e?(Nt=4,67108864):0!==(134217728&e)?(Nt=3,134217728):0!==(t=805306368&e)?(Nt=2,t):0!==(1073741824&e)?(Nt=1,1073741824):(Nt=8,e)}function jt(e,t){var n=e.pendingLanes;if(0===n)return Nt=0;var r=0,i=0,o=e.expiredLanes,a=e.suspendedLanes,s=e.pingedLanes;if(0!==o)r=o,i=Nt=15;else if(0!==(o=134217727&n)){var u=o&~a;0!==u?(r=Lt(u),i=Nt):0!==(s&=o)&&(r=Lt(s),i=Nt)}else 0!==(o=n&~a)?(r=Lt(o),i=Nt):0!==s&&(r=Lt(s),i=Nt);if(0===r)return 0;if(r=n&((0>(r=31-Gt(r))?0:1<<r)<<1)-1,0!==t&&t!==r&&0===(t&a)){if(Lt(t),i<=Nt)return t;Nt=i}if(0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-Gt(t)),r|=e[n],t&=~i;return r}function Bt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function Kt(e,t){switch(e){case 15:return 1;case 14:return 2;case 12:return 0===(e=Ft(24&~t))?Kt(10,t):e;case 10:return 0===(e=Ft(192&~t))?Kt(8,t):e;case 8:return 0===(e=Ft(3584&~t))&&(0===(e=Ft(4186112&~t))&&(e=512)),e;case 2:return 0===(t=Ft(805306368&~t))&&(t=268435456),t}throw Error(a(358,e))}function Ft(e){return e&-e}function qt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Vt(e,t,n){e.pendingLanes|=t;var r=t-1;e.suspendedLanes&=r,e.pingedLanes&=r,(e=e.eventTimes)[t=31-Gt(t)]=n}var Gt=Math.clz32?Math.clz32:function(e){return 0===e?32:31-(Wt(e)/Ht|0)|0},Wt=Math.log,Ht=Math.LN2;var $t=o.unstable_UserBlockingPriority,zt=o.unstable_runWithPriority,Yt=!0;function Qt(e,t,n,r){Le||Ue();var i=Xt,o=Le;Le=!0;try{Me(i,e,t,n,r)}finally{(Le=o)||Be()}}function Jt(e,t,n,r){zt($t,Xt.bind(null,e,t,n,r))}function Xt(e,t,n,r){var i;if(Yt)if((i=0===(4&t))&&0<at.length&&-1<ht.indexOf(e))e=pt(null,e,t,n,r),at.push(e);else{var o=Zt(e,t,n,r);if(null===o)i&&vt(e,r);else{if(i){if(-1<ht.indexOf(e))return e=pt(o,e,t,n,r),void at.push(e);if(function(e,t,n,r,i){switch(t){case"focusin":return st=gt(st,e,t,n,r,i),!0;case"dragenter":return ut=gt(ut,e,t,n,r,i),!0;case"mouseover":return ct=gt(ct,e,t,n,r,i),!0;case"pointerover":var o=i.pointerId;return lt.set(o,gt(lt.get(o)||null,e,t,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,dt.set(o,gt(dt.get(o)||null,e,t,n,r,i)),!0}return!1}(o,e,t,n,r))return;vt(e,r)}Dr(e,t,r,null,n)}}}function Zt(e,t,n,r){var i=Ie(r);if(null!==(i=Zr(i))){var o=Qe(i);if(null===o)i=null;else{var a=o.tag;if(13===a){if(null!==(i=Je(o)))return i;i=null}else if(3===a){if(o.stateNode.hydrate)return 3===o.tag?o.stateNode.containerInfo:null;i=null}else o!==i&&(i=null)}}return Dr(e,t,r,i,n),null}var en=null,tn=null,nn=null;function rn(){if(nn)return nn;var e,t,n=tn,r=n.length,i="value"in en?en.value:en.textContent,o=i.length;for(e=0;e<r&&n[e]===i[e];e++);var a=r-e;for(t=1;t<=a&&n[r-t]===i[o-t];t++);return nn=i.slice(e,1<t?1-t:void 0)}function on(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function an(){return!0}function sn(){return!1}function un(e){function t(t,n,r,i,o){for(var a in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?an:sn,this.isPropagationStopped=sn,this}return i(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=an)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=an)},persist:function(){},isPersistent:an}),t}var cn,ln,dn,fn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},hn=un(fn),pn=i({},fn,{view:0,detail:0}),vn=un(pn),gn=i({},pn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==dn&&(dn&&"mousemove"===e.type?(cn=e.screenX-dn.screenX,ln=e.screenY-dn.screenY):ln=cn=0,dn=e),cn)},movementY:function(e){return"movementY"in e?e.movementY:ln}}),yn=un(gn),mn=un(i({},gn,{dataTransfer:0})),kn=un(i({},pn,{relatedTarget:0})),bn=un(i({},fn,{animationName:0,elapsedTime:0,pseudoElement:0})),Sn=un(i({},fn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),wn=un(i({},fn,{data:0})),En={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},_n={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},xn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function In(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=xn[e])&&!!t[e]}function Tn(){return In}var Rn=un(i({},pn,{key:function(e){if(e.key){var t=En[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=on(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?_n[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tn,charCode:function(e){return"keypress"===e.type?on(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?on(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),On=un(i({},gn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Cn=un(i({},pn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tn})),Pn=un(i({},fn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Dn=un(i({},gn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),An=[9,13,27,32],Mn=d&&"CompositionEvent"in window,Un=null;d&&"documentMode"in document&&(Un=document.documentMode);var Nn=d&&"TextEvent"in window&&!Un,Ln=d&&(!Mn||Un&&8<Un&&11>=Un),jn=String.fromCharCode(32),Bn=!1;function Kn(e,t){switch(e){case"keyup":return-1!==An.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Fn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var qn=!1;var Vn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Vn[e.type]:"textarea"===t}function Wn(e,t,n,r){Pe(r),0<(t=Mr(t,"onChange")).length&&(n=new hn("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Hn=null,$n=null;function zn(e){Ir(e,0)}function Yn(e){if(J(ti(e)))return e}function Qn(e,t){if("change"===e)return t}var Jn=!1;if(d){var Xn;if(d){var Zn="oninput"in document;if(!Zn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Zn="function"===typeof er.oninput}Xn=Zn}else Xn=!1;Jn=Xn&&(!document.documentMode||9<document.documentMode)}function tr(){Hn&&(Hn.detachEvent("onpropertychange",nr),$n=Hn=null)}function nr(e){if("value"===e.propertyName&&Yn($n)){var t=[];if(Wn(t,$n,e,Ie(e)),e=zn,Le)e(t);else{Le=!0;try{Ae(e,t)}finally{Le=!1,Be()}}}}function rr(e,t,n){"focusin"===e?(tr(),$n=n,(Hn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yn($n)}function or(e,t){if("click"===e)return Yn(t)}function ar(e,t){if("input"===e||"change"===e)return Yn(t)}var sr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},ur=Object.prototype.hasOwnProperty;function cr(e,t){if(sr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!ur.call(t,n[r])||!sr(e[n[r]],t[n[r]]))return!1;return!0}function lr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function dr(e,t){var n,r=lr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=lr(r)}}function fr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?fr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hr(){for(var e=window,t=X();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=X((e=t.contentWindow).document)}return t}function pr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var vr=d&&"documentMode"in document&&11>=document.documentMode,gr=null,yr=null,mr=null,kr=!1;function br(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;kr||null==gr||gr!==X(r)||("selectionStart"in(r=gr)&&pr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},mr&&cr(mr,r)||(mr=r,0<(r=Mr(yr,"onSelect")).length&&(t=new hn("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=gr)))}Ut("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),Ut("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),Ut(Mt,2);for(var Sr="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),wr=0;wr<Sr.length;wr++)At.set(Sr[wr],0);l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Er="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),_r=new Set("cancel close invalid load scroll toggle".split(" ").concat(Er));function xr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,o,s,u,c){if(Ye.apply(this,arguments),Ge){if(!Ge)throw Error(a(198));var l=We;Ge=!1,We=null,He||(He=!0,$e=l)}}(r,t,void 0,e),e.currentTarget=null}function Ir(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var o=void 0;if(t)for(var a=r.length-1;0<=a;a--){var s=r[a],u=s.instance,c=s.currentTarget;if(s=s.listener,u!==o&&i.isPropagationStopped())break e;xr(i,s,c),o=u}else for(a=0;a<r.length;a++){if(u=(s=r[a]).instance,c=s.currentTarget,s=s.listener,u!==o&&i.isPropagationStopped())break e;xr(i,s,c),o=u}}}if(He)throw e=$e,He=!1,$e=null,e}function Tr(e,t){var n=ri(t),r=e+"__bubble";n.has(r)||(Pr(t,e,2,!1),n.add(r))}var Rr="_reactListening"+Math.random().toString(36).slice(2);function Or(e){e[Rr]||(e[Rr]=!0,s.forEach((function(t){_r.has(t)||Cr(t,!1,e,null),Cr(t,!0,e,null)})))}function Cr(e,t,n,r){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,o=n;if("selectionchange"===e&&9!==n.nodeType&&(o=n.ownerDocument),null!==r&&!t&&_r.has(e)){if("scroll"!==e)return;i|=2,o=r}var a=ri(o),s=e+"__"+(t?"capture":"bubble");a.has(s)||(t&&(i|=4),Pr(o,e,i,t),a.add(s))}function Pr(e,t,n,r){var i=At.get(t);switch(void 0===i?2:i){case 0:i=Qt;break;case 1:i=Jt;break;default:i=Xt}n=i.bind(null,t,n,e),i=void 0,!Fe||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Dr(e,t,n,r,i){var o=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var a=r.tag;if(3===a||4===a){var s=r.stateNode.containerInfo;if(s===i||8===s.nodeType&&s.parentNode===i)break;if(4===a)for(a=r.return;null!==a;){var u=a.tag;if((3===u||4===u)&&((u=a.stateNode.containerInfo)===i||8===u.nodeType&&u.parentNode===i))return;a=a.return}for(;null!==s;){if(null===(a=Zr(s)))return;if(5===(u=a.tag)||6===u){r=o=a;continue e}s=s.parentNode}}r=r.return}!function(e,t,n){if(je)return e(t,n);je=!0;try{Ne(e,t,n)}finally{je=!1,Be()}}((function(){var r=o,i=Ie(n),a=[];e:{var s=Dt.get(e);if(void 0!==s){var u=hn,c=e;switch(e){case"keypress":if(0===on(n))break e;case"keydown":case"keyup":u=Rn;break;case"focusin":c="focus",u=kn;break;case"focusout":c="blur",u=kn;break;case"beforeblur":case"afterblur":u=kn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":u=yn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":u=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":u=Cn;break;case Rt:case Ot:case Ct:u=bn;break;case Pt:u=Pn;break;case"scroll":u=vn;break;case"wheel":u=Dn;break;case"copy":case"cut":case"paste":u=Sn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":u=On}var l=0!==(4&t),d=!l&&"scroll"===e,f=l?null!==s?s+"Capture":null:s;l=[];for(var h,p=r;null!==p;){var v=(h=p).stateNode;if(5===h.tag&&null!==v&&(h=v,null!==f&&(null!=(v=Ke(p,f))&&l.push(Ar(p,v,h)))),d)break;p=p.return}0<l.length&&(s=new u(s,c,null,n,i),a.push({event:s,listeners:l}))}}if(0===(7&t)){if(u="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||0!==(16&t)||!(c=n.relatedTarget||n.fromElement)||!Zr(c)&&!c[Jr])&&(u||s)&&(s=i.window===i?i:(s=i.ownerDocument)?s.defaultView||s.parentWindow:window,u?(u=r,null!==(c=(c=n.relatedTarget||n.toElement)?Zr(c):null)&&(c!==(d=Qe(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(u=null,c=r),u!==c)){if(l=yn,v="onMouseLeave",f="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(l=On,v="onPointerLeave",f="onPointerEnter",p="pointer"),d=null==u?s:ti(u),h=null==c?s:ti(c),(s=new l(v,p+"leave",u,n,i)).target=d,s.relatedTarget=h,v=null,Zr(i)===r&&((l=new l(f,p+"enter",c,n,i)).target=h,l.relatedTarget=d,v=l),d=v,u&&c)e:{for(f=c,p=0,h=l=u;h;h=Ur(h))p++;for(h=0,v=f;v;v=Ur(v))h++;for(;0<p-h;)l=Ur(l),p--;for(;0<h-p;)f=Ur(f),h--;for(;p--;){if(l===f||null!==f&&l===f.alternate)break e;l=Ur(l),f=Ur(f)}l=null}else l=null;null!==u&&Nr(a,s,u,l,!1),null!==c&&null!==d&&Nr(a,d,c,l,!0)}if("select"===(u=(s=r?ti(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===u&&"file"===s.type)var g=Qn;else if(Gn(s))if(Jn)g=ar;else{g=ir;var y=rr}else(u=s.nodeName)&&"input"===u.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(g=or);switch(g&&(g=g(e,r))?Wn(a,g,n,i):(y&&y(e,s,r),"focusout"===e&&(y=s._wrapperState)&&y.controlled&&"number"===s.type&&ie(s,"number",s.value)),y=r?ti(r):window,e){case"focusin":(Gn(y)||"true"===y.contentEditable)&&(gr=y,yr=r,mr=null);break;case"focusout":mr=yr=gr=null;break;case"mousedown":kr=!0;break;case"contextmenu":case"mouseup":case"dragend":kr=!1,br(a,n,i);break;case"selectionchange":if(vr)break;case"keydown":case"keyup":br(a,n,i)}var m;if(Mn)e:{switch(e){case"compositionstart":var k="onCompositionStart";break e;case"compositionend":k="onCompositionEnd";break e;case"compositionupdate":k="onCompositionUpdate";break e}k=void 0}else qn?Kn(e,n)&&(k="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(k="onCompositionStart");k&&(Ln&&"ko"!==n.locale&&(qn||"onCompositionStart"!==k?"onCompositionEnd"===k&&qn&&(m=rn()):(tn="value"in(en=i)?en.value:en.textContent,qn=!0)),0<(y=Mr(r,k)).length&&(k=new wn(k,e,null,n,i),a.push({event:k,listeners:y}),m?k.data=m:null!==(m=Fn(n))&&(k.data=m))),(m=Nn?function(e,t){switch(e){case"compositionend":return Fn(t);case"keypress":return 32!==t.which?null:(Bn=!0,jn);case"textInput":return(e=t.data)===jn&&Bn?null:e;default:return null}}(e,n):function(e,t){if(qn)return"compositionend"===e||!Mn&&Kn(e,t)?(e=rn(),nn=tn=en=null,qn=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Ln&&"ko"!==t.locale?null:t.data;default:return null}}(e,n))&&(0<(r=Mr(r,"onBeforeInput")).length&&(i=new wn("onBeforeInput","beforeinput",null,n,i),a.push({event:i,listeners:r}),i.data=m))}Ir(a,t)}))}function Ar(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Mr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,o=i.stateNode;5===i.tag&&null!==o&&(i=o,null!=(o=Ke(e,n))&&r.unshift(Ar(e,o,i)),null!=(o=Ke(e,t))&&r.push(Ar(e,o,i))),e=e.return}return r}function Ur(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Nr(e,t,n,r,i){for(var o=t._reactName,a=[];null!==n&&n!==r;){var s=n,u=s.alternate,c=s.stateNode;if(null!==u&&u===r)break;5===s.tag&&null!==c&&(s=c,i?null!=(u=Ke(n,o))&&a.unshift(Ar(n,u,s)):i||null!=(u=Ke(n,o))&&a.push(Ar(n,u,s))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}function Lr(){}var jr=null,Br=null;function Kr(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function Fr(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var qr="function"===typeof setTimeout?setTimeout:void 0,Vr="function"===typeof clearTimeout?clearTimeout:void 0;function Gr(e){1===e.nodeType?e.textContent="":9===e.nodeType&&(null!=(e=e.body)&&(e.textContent=""))}function Wr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function Hr(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var $r=0;var zr=Math.random().toString(36).slice(2),Yr="__reactFiber$"+zr,Qr="__reactProps$"+zr,Jr="__reactContainer$"+zr,Xr="__reactEvents$"+zr;function Zr(e){var t=e[Yr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Jr]||n[Yr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=Hr(e);null!==e;){if(n=e[Yr])return n;e=Hr(e)}return t}n=(e=n).parentNode}return null}function ei(e){return!(e=e[Yr]||e[Jr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function ti(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function ni(e){return e[Qr]||null}function ri(e){var t=e[Xr];return void 0===t&&(t=e[Xr]=new Set),t}var ii=[],oi=-1;function ai(e){return{current:e}}function si(e){0>oi||(e.current=ii[oi],ii[oi]=null,oi--)}function ui(e,t){oi++,ii[oi]=e.current,e.current=t}var ci={},li=ai(ci),di=ai(!1),fi=ci;function hi(e,t){var n=e.type.contextTypes;if(!n)return ci;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,o={};for(i in n)o[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function pi(e){return null!==(e=e.childContextTypes)&&void 0!==e}function vi(){si(di),si(li)}function gi(e,t,n){if(li.current!==ci)throw Error(a(168));ui(li,t),ui(di,n)}function yi(e,t,n){var r=e.stateNode;if(e=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var o in r=r.getChildContext())if(!(o in e))throw Error(a(108,$(t)||"Unknown",o));return i({},n,r)}function mi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ci,fi=li.current,ui(li,e),ui(di,di.current),!0}function ki(e,t,n){var r=e.stateNode;if(!r)throw Error(a(169));n?(e=yi(e,t,fi),r.__reactInternalMemoizedMergedChildContext=e,si(di),si(li),ui(li,e)):si(di),ui(di,n)}var bi=null,Si=null,wi=o.unstable_runWithPriority,Ei=o.unstable_scheduleCallback,_i=o.unstable_cancelCallback,xi=o.unstable_shouldYield,Ii=o.unstable_requestPaint,Ti=o.unstable_now,Ri=o.unstable_getCurrentPriorityLevel,Oi=o.unstable_ImmediatePriority,Ci=o.unstable_UserBlockingPriority,Pi=o.unstable_NormalPriority,Di=o.unstable_LowPriority,Ai=o.unstable_IdlePriority,Mi={},Ui=void 0!==Ii?Ii:function(){},Ni=null,Li=null,ji=!1,Bi=Ti(),Ki=1e4>Bi?Ti:function(){return Ti()-Bi};function Fi(){switch(Ri()){case Oi:return 99;case Ci:return 98;case Pi:return 97;case Di:return 96;case Ai:return 95;default:throw Error(a(332))}}function qi(e){switch(e){case 99:return Oi;case 98:return Ci;case 97:return Pi;case 96:return Di;case 95:return Ai;default:throw Error(a(332))}}function Vi(e,t){return e=qi(e),wi(e,t)}function Gi(e,t,n){return e=qi(e),Ei(e,t,n)}function Wi(){if(null!==Li){var e=Li;Li=null,_i(e)}Hi()}function Hi(){if(!ji&&null!==Ni){ji=!0;var e=0;try{var t=Ni;Vi(99,(function(){for(;e<t.length;e++){var n=t[e];do{n=n(!0)}while(null!==n)}})),Ni=null}catch(n){throw null!==Ni&&(Ni=Ni.slice(e+1)),Ei(Oi,Wi),n}finally{ji=!1}}}var $i=S.ReactCurrentBatchConfig;function zi(e,t){if(e&&e.defaultProps){for(var n in t=i({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var Yi=ai(null),Qi=null,Ji=null,Xi=null;function Zi(){Xi=Ji=Qi=null}function eo(e){var t=Yi.current;si(Yi),e.type._context._currentValue=t}function to(e,t){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)===t){if(null===n||(n.childLanes&t)===t)break;n.childLanes|=t}else e.childLanes|=t,null!==n&&(n.childLanes|=t);e=e.return}}function no(e,t){Qi=e,Xi=Ji=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Ma=!0),e.firstContext=null)}function ro(e,t){if(Xi!==e&&!1!==t&&0!==t)if("number"===typeof t&&1073741823!==t||(Xi=e,t=1073741823),t={context:e,observedBits:t,next:null},null===Ji){if(null===Qi)throw Error(a(308));Ji=t,Qi.dependencies={lanes:0,firstContext:t,responders:null}}else Ji=Ji.next=t;return e._currentValue}var io=!1;function oo(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function ao(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function so(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function uo(e,t){if(null!==(e=e.updateQueue)){var n=(e=e.shared).pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}}function co(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?i=o=a:o=o.next=a,n=n.next}while(null!==n);null===o?i=o=t:o=o.next=t}else i=o=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function lo(e,t,n,r){var o=e.updateQueue;io=!1;var a=o.firstBaseUpdate,s=o.lastBaseUpdate,u=o.shared.pending;if(null!==u){o.shared.pending=null;var c=u,l=c.next;c.next=null,null===s?a=l:s.next=l,s=c;var d=e.alternate;if(null!==d){var f=(d=d.updateQueue).lastBaseUpdate;f!==s&&(null===f?d.firstBaseUpdate=l:f.next=l,d.lastBaseUpdate=c)}}if(null!==a){for(f=o.baseState,s=0,d=l=c=null;;){u=a.lane;var h=a.eventTime;if((r&u)===u){null!==d&&(d=d.next={eventTime:h,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=e,v=a;switch(u=t,h=n,v.tag){case 1:if("function"===typeof(p=v.payload)){f=p.call(h,f,u);break e}f=p;break e;case 3:p.flags=-4097&p.flags|64;case 0:if(null===(u="function"===typeof(p=v.payload)?p.call(h,f,u):p)||void 0===u)break e;f=i({},f,u);break e;case 2:io=!0}}null!==a.callback&&(e.flags|=32,null===(u=o.effects)?o.effects=[a]:u.push(a))}else h={eventTime:h,lane:u,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===d?(l=d=h,c=f):d=d.next=h,s|=u;if(null===(a=a.next)){if(null===(u=o.shared.pending))break;a=u.next,u.next=null,o.lastBaseUpdate=u,o.shared.pending=null}}null===d&&(c=f),o.baseState=c,o.firstBaseUpdate=l,o.lastBaseUpdate=d,js|=s,e.lanes=s,e.memoizedState=f}}function fo(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(a(191,i));i.call(r)}}}var ho=(new r.Component).refs;function po(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:i({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var vo={isMounted:function(e){return!!(e=e._reactInternals)&&Qe(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=cu(),i=lu(e),o=so(r,i);o.payload=t,void 0!==n&&null!==n&&(o.callback=n),uo(e,o),du(e,i,r)},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=cu(),i=lu(e),o=so(r,i);o.tag=1,o.payload=t,void 0!==n&&null!==n&&(o.callback=n),uo(e,o),du(e,i,r)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=cu(),r=lu(e),i=so(n,r);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),uo(e,i),du(e,r,n)}};function go(e,t,n,r,i,o,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,o,a):!t.prototype||!t.prototype.isPureReactComponent||(!cr(n,r)||!cr(i,o))}function yo(e,t,n){var r=!1,i=ci,o=t.contextType;return"object"===typeof o&&null!==o?o=ro(o):(i=pi(t)?fi:li.current,o=(r=null!==(r=t.contextTypes)&&void 0!==r)?hi(e,i):ci),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=vo,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),t}function mo(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&vo.enqueueReplaceState(t,t.state,null)}function ko(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=ho,oo(e);var o=t.contextType;"object"===typeof o&&null!==o?i.context=ro(o):(o=pi(t)?fi:li.current,i.context=hi(e,o)),lo(e,n,i,r),i.state=e.memoizedState,"function"===typeof(o=t.getDerivedStateFromProps)&&(po(e,t,o,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&vo.enqueueReplaceState(i,i.state,null),lo(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4)}var bo=Array.isArray;function So(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var r=n.stateNode}if(!r)throw Error(a(147,e));var i=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===i?t.ref:((t=function(e){var t=r.refs;t===ho&&(t=r.refs={}),null===e?delete t[i]:t[i]=e})._stringRef=i,t)}if("string"!==typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function wo(e,t){if("textarea"!==e.type)throw Error(a(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t))}function Eo(e){function t(t,n){if(e){var r=t.lastEffect;null!==r?(r.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.flags=8}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Vu(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags=2,n):r:(t.flags=2,n):n}function s(t){return e&&null===t.alternate&&(t.flags=2),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=$u(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,r){return null!==t&&t.elementType===n.type?((r=i(t,n.props)).ref=So(e,t,n),r.return=e,r):((r=Gu(n.type,n.key,n.props,null,e.mode,r)).ref=So(e,t,n),r.return=e,r)}function l(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=zu(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function d(e,t,n,r,o){return null===t||7!==t.tag?((t=Wu(n,e.mode,r,o)).return=e,t):((t=i(t,n)).return=e,t)}function f(e,t,n){if("string"===typeof t||"number"===typeof t)return(t=$u(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case w:return(n=Gu(t.type,t.key,t.props,null,e.mode,n)).ref=So(e,null,t),n.return=e,n;case E:return(t=zu(t,e.mode,n)).return=e,t}if(bo(t)||q(t))return(t=Wu(t,e.mode,n,null)).return=e,t;wo(e,t)}return null}function h(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n||"number"===typeof n)return null!==i?null:u(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===i?n.type===_?d(e,t,n.props.children,r,i):c(e,t,n,r):null;case E:return n.key===i?l(e,t,n,r):null}if(bo(n)||q(n))return null!==i?null:d(e,t,n,r,null);wo(e,n)}return null}function p(e,t,n,r,i){if("string"===typeof r||"number"===typeof r)return u(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case w:return e=e.get(null===r.key?n:r.key)||null,r.type===_?d(t,e,r.props.children,i,r.key):c(t,e,r,i);case E:return l(t,e=e.get(null===r.key?n:r.key)||null,r,i)}if(bo(r)||q(r))return d(t,e=e.get(n)||null,r,i,null);wo(t,r)}return null}function v(i,a,s,u){for(var c=null,l=null,d=a,v=a=0,g=null;null!==d&&v<s.length;v++){d.index>v?(g=d,d=null):g=d.sibling;var y=h(i,d,s[v],u);if(null===y){null===d&&(d=g);break}e&&d&&null===y.alternate&&t(i,d),a=o(y,a,v),null===l?c=y:l.sibling=y,l=y,d=g}if(v===s.length)return n(i,d),c;if(null===d){for(;v<s.length;v++)null!==(d=f(i,s[v],u))&&(a=o(d,a,v),null===l?c=d:l.sibling=d,l=d);return c}for(d=r(i,d);v<s.length;v++)null!==(g=p(d,i,v,s[v],u))&&(e&&null!==g.alternate&&d.delete(null===g.key?v:g.key),a=o(g,a,v),null===l?c=g:l.sibling=g,l=g);return e&&d.forEach((function(e){return t(i,e)})),c}function g(i,s,u,c){var l=q(u);if("function"!==typeof l)throw Error(a(150));if(null==(u=l.call(u)))throw Error(a(151));for(var d=l=null,v=s,g=s=0,y=null,m=u.next();null!==v&&!m.done;g++,m=u.next()){v.index>g?(y=v,v=null):y=v.sibling;var k=h(i,v,m.value,c);if(null===k){null===v&&(v=y);break}e&&v&&null===k.alternate&&t(i,v),s=o(k,s,g),null===d?l=k:d.sibling=k,d=k,v=y}if(m.done)return n(i,v),l;if(null===v){for(;!m.done;g++,m=u.next())null!==(m=f(i,m.value,c))&&(s=o(m,s,g),null===d?l=m:d.sibling=m,d=m);return l}for(v=r(i,v);!m.done;g++,m=u.next())null!==(m=p(v,i,g,m.value,c))&&(e&&null!==m.alternate&&v.delete(null===m.key?g:m.key),s=o(m,s,g),null===d?l=m:d.sibling=m,d=m);return e&&v.forEach((function(e){return t(i,e)})),l}return function(e,r,o,u){var c="object"===typeof o&&null!==o&&o.type===_&&null===o.key;c&&(o=o.props.children);var l="object"===typeof o&&null!==o;if(l)switch(o.$$typeof){case w:e:{for(l=o.key,c=r;null!==c;){if(c.key===l){switch(c.tag){case 7:if(o.type===_){n(e,c.sibling),(r=i(c,o.props.children)).return=e,e=r;break e}break;default:if(c.elementType===o.type){n(e,c.sibling),(r=i(c,o.props)).ref=So(e,c,o),r.return=e,e=r;break e}}n(e,c);break}t(e,c),c=c.sibling}o.type===_?((r=Wu(o.props.children,e.mode,u,o.key)).return=e,e=r):((u=Gu(o.type,o.key,o.props,null,e.mode,u)).ref=So(e,r,o),u.return=e,e=u)}return s(e);case E:e:{for(c=o.key;null!==r;){if(r.key===c){if(4===r.tag&&r.stateNode.containerInfo===o.containerInfo&&r.stateNode.implementation===o.implementation){n(e,r.sibling),(r=i(r,o.children||[])).return=e,e=r;break e}n(e,r);break}t(e,r),r=r.sibling}(r=zu(o,e.mode,u)).return=e,e=r}return s(e)}if("string"===typeof o||"number"===typeof o)return o=""+o,null!==r&&6===r.tag?(n(e,r.sibling),(r=i(r,o)).return=e,e=r):(n(e,r),(r=$u(o,e.mode,u)).return=e,e=r),s(e);if(bo(o))return v(e,r,o,u);if(q(o))return g(e,r,o,u);if(l&&wo(e,o),"undefined"===typeof o&&!c)switch(e.tag){case 1:case 22:case 0:case 11:case 15:throw Error(a(152,$(e.type)||"Component"))}return n(e,r)}}var _o=Eo(!0),xo=Eo(!1),Io={},To=ai(Io),Ro=ai(Io),Oo=ai(Io);function Co(e){if(e===Io)throw Error(a(174));return e}function Po(e,t){switch(ui(Oo,t),ui(Ro,e),ui(To,Io),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:pe(null,"");break;default:t=pe(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}si(To),ui(To,t)}function Do(){si(To),si(Ro),si(Oo)}function Ao(e){Co(Oo.current);var t=Co(To.current),n=pe(t,e.type);t!==n&&(ui(Ro,e),ui(To,n))}function Mo(e){Ro.current===e&&(si(To),si(Ro))}var Uo=ai(0);function No(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(64&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Lo=null,jo=null,Bo=!1;function Ko(e,t){var n=Fu(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.flags=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function Fo(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);case 13:default:return!1}}function qo(e){if(Bo){var t=jo;if(t){var n=t;if(!Fo(e,t)){if(!(t=Wr(n.nextSibling))||!Fo(e,t))return e.flags=-1025&e.flags|2,Bo=!1,void(Lo=e);Ko(Lo,n)}Lo=e,jo=Wr(t.firstChild)}else e.flags=-1025&e.flags|2,Bo=!1,Lo=e}}function Vo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Lo=e}function Go(e){if(e!==Lo)return!1;if(!Bo)return Vo(e),Bo=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!Fr(t,e.memoizedProps))for(t=jo;t;)Ko(e,t),t=Wr(t.nextSibling);if(Vo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){jo=Wr(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}jo=null}}else jo=Lo?Wr(e.stateNode.nextSibling):null;return!0}function Wo(){jo=Lo=null,Bo=!1}var Ho=[];function $o(){for(var e=0;e<Ho.length;e++)Ho[e]._workInProgressVersionPrimary=null;Ho.length=0}var zo=S.ReactCurrentDispatcher,Yo=S.ReactCurrentBatchConfig,Qo=0,Jo=null,Xo=null,Zo=null,ea=!1,ta=!1;function na(){throw Error(a(321))}function ra(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sr(e[n],t[n]))return!1;return!0}function ia(e,t,n,r,i,o){if(Qo=o,Jo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,zo.current=null===e||null===e.memoizedState?Ca:Pa,e=n(r,i),ta){o=0;do{if(ta=!1,!(25>o))throw Error(a(301));o+=1,Zo=Xo=null,t.updateQueue=null,zo.current=Da,e=n(r,i)}while(ta)}if(zo.current=Oa,t=null!==Xo&&null!==Xo.next,Qo=0,Zo=Xo=Jo=null,ea=!1,t)throw Error(a(300));return e}function oa(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Zo?Jo.memoizedState=Zo=e:Zo=Zo.next=e,Zo}function aa(){if(null===Xo){var e=Jo.alternate;e=null!==e?e.memoizedState:null}else e=Xo.next;var t=null===Zo?Jo.memoizedState:Zo.next;if(null!==t)Zo=t,Xo=e;else{if(null===e)throw Error(a(310));e={memoizedState:(Xo=e).memoizedState,baseState:Xo.baseState,baseQueue:Xo.baseQueue,queue:Xo.queue,next:null},null===Zo?Jo.memoizedState=Zo=e:Zo=Zo.next=e}return Zo}function sa(e,t){return"function"===typeof t?t(e):t}function ua(e){var t=aa(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=Xo,i=r.baseQueue,o=n.pending;if(null!==o){if(null!==i){var s=i.next;i.next=o.next,o.next=s}r.baseQueue=i=o,n.pending=null}if(null!==i){i=i.next,r=r.baseState;var u=s=o=null,c=i;do{var l=c.lane;if((Qo&l)===l)null!==u&&(u=u.next={lane:0,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null}),r=c.eagerReducer===e?c.eagerState:e(r,c.action);else{var d={lane:l,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null};null===u?(s=u=d,o=r):u=u.next=d,Jo.lanes|=l,js|=l}c=c.next}while(null!==c&&c!==i);null===u?o=r:u.next=s,sr(r,t.memoizedState)||(Ma=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=u,n.lastRenderedState=r}return[t.memoizedState,n.dispatch]}function ca(e){var t=aa(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,o=t.memoizedState;if(null!==i){n.pending=null;var s=i=i.next;do{o=e(o,s.action),s=s.next}while(s!==i);sr(o,t.memoizedState)||(Ma=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function la(e,t,n){var r=t._getVersion;r=r(t._source);var i=t._workInProgressVersionPrimary;if(null!==i?e=i===r:(e=e.mutableReadLanes,(e=(Qo&e)===e)&&(t._workInProgressVersionPrimary=r,Ho.push(t))),e)return n(t._source);throw Ho.push(t),Error(a(350))}function da(e,t,n,r){var i=Cs;if(null===i)throw Error(a(349));var o=t._getVersion,s=o(t._source),u=zo.current,c=u.useState((function(){return la(i,t,n)})),l=c[1],d=c[0];c=Zo;var f=e.memoizedState,h=f.refs,p=h.getSnapshot,v=f.source;f=f.subscribe;var g=Jo;return e.memoizedState={refs:h,source:t,subscribe:r},u.useEffect((function(){h.getSnapshot=n,h.setSnapshot=l;var e=o(t._source);if(!sr(s,e)){e=n(t._source),sr(d,e)||(l(e),e=lu(g),i.mutableReadLanes|=e&i.pendingLanes),e=i.mutableReadLanes,i.entangledLanes|=e;for(var r=i.entanglements,a=e;0<a;){var u=31-Gt(a),c=1<<u;r[u]|=e,a&=~c}}}),[n,t,r]),u.useEffect((function(){return r(t._source,(function(){var e=h.getSnapshot,n=h.setSnapshot;try{n(e(t._source));var r=lu(g);i.mutableReadLanes|=r&i.pendingLanes}catch(o){n((function(){throw o}))}}))}),[t,r]),sr(p,n)&&sr(v,t)&&sr(f,r)||((e={pending:null,dispatch:null,lastRenderedReducer:sa,lastRenderedState:d}).dispatch=l=Ra.bind(null,Jo,e),c.queue=e,c.baseQueue=null,d=la(i,t,n),c.memoizedState=c.baseState=d),d}function fa(e,t,n){return da(aa(),e,t,n)}function ha(e){var t=oa();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:sa,lastRenderedState:e}).dispatch=Ra.bind(null,Jo,e),[t.memoizedState,e]}function pa(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=Jo.updateQueue)?(t={lastEffect:null},Jo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function va(e){return e={current:e},oa().memoizedState=e}function ga(){return aa().memoizedState}function ya(e,t,n,r){var i=oa();Jo.flags|=e,i.memoizedState=pa(1|t,n,void 0,void 0===r?null:r)}function ma(e,t,n,r){var i=aa();r=void 0===r?null:r;var o=void 0;if(null!==Xo){var a=Xo.memoizedState;if(o=a.destroy,null!==r&&ra(r,a.deps))return void pa(t,n,o,r)}Jo.flags|=e,i.memoizedState=pa(1|t,n,o,r)}function ka(e,t){return ya(516,4,e,t)}function ba(e,t){return ma(516,4,e,t)}function Sa(e,t){return ma(4,2,e,t)}function wa(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ea(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,ma(4,2,wa.bind(null,t,e),n)}function _a(){}function xa(e,t){var n=aa();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ra(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Ia(e,t){var n=aa();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ra(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Ta(e,t){var n=Fi();Vi(98>n?98:n,(function(){e(!0)})),Vi(97<n?97:n,(function(){var n=Yo.transition;Yo.transition=1;try{e(!1),t()}finally{Yo.transition=n}}))}function Ra(e,t,n){var r=cu(),i=lu(e),o={lane:i,action:n,eagerReducer:null,eagerState:null,next:null},a=t.pending;if(null===a?o.next=o:(o.next=a.next,a.next=o),t.pending=o,a=e.alternate,e===Jo||null!==a&&a===Jo)ta=ea=!0;else{if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var s=t.lastRenderedState,u=a(s,n);if(o.eagerReducer=a,o.eagerState=u,sr(u,s))return}catch(c){}du(e,i,r)}}var Oa={readContext:ro,useCallback:na,useContext:na,useEffect:na,useImperativeHandle:na,useLayoutEffect:na,useMemo:na,useReducer:na,useRef:na,useState:na,useDebugValue:na,useDeferredValue:na,useTransition:na,useMutableSource:na,useOpaqueIdentifier:na,unstable_isNewReconciler:!1},Ca={readContext:ro,useCallback:function(e,t){return oa().memoizedState=[e,void 0===t?null:t],e},useContext:ro,useEffect:ka,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,ya(4,2,wa.bind(null,t,e),n)},useLayoutEffect:function(e,t){return ya(4,2,e,t)},useMemo:function(e,t){var n=oa();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=oa();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e=(e=r.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=Ra.bind(null,Jo,e),[r.memoizedState,e]},useRef:va,useState:ha,useDebugValue:_a,useDeferredValue:function(e){var t=ha(e),n=t[0],r=t[1];return ka((function(){var t=Yo.transition;Yo.transition=1;try{r(e)}finally{Yo.transition=t}}),[e]),n},useTransition:function(){var e=ha(!1),t=e[0];return va(e=Ta.bind(null,e[1])),[e,t]},useMutableSource:function(e,t,n){var r=oa();return r.memoizedState={refs:{getSnapshot:t,setSnapshot:null},source:e,subscribe:n},da(r,e,t,n)},useOpaqueIdentifier:function(){if(Bo){var e=!1,t=function(e){return{$$typeof:U,toString:e,valueOf:e}}((function(){throw e||(e=!0,n("r:"+($r++).toString(36))),Error(a(355))})),n=ha(t)[1];return 0===(2&Jo.mode)&&(Jo.flags|=516,pa(5,(function(){n("r:"+($r++).toString(36))}),void 0,null)),t}return ha(t="r:"+($r++).toString(36)),t},unstable_isNewReconciler:!1},Pa={readContext:ro,useCallback:xa,useContext:ro,useEffect:ba,useImperativeHandle:Ea,useLayoutEffect:Sa,useMemo:Ia,useReducer:ua,useRef:ga,useState:function(){return ua(sa)},useDebugValue:_a,useDeferredValue:function(e){var t=ua(sa),n=t[0],r=t[1];return ba((function(){var t=Yo.transition;Yo.transition=1;try{r(e)}finally{Yo.transition=t}}),[e]),n},useTransition:function(){var e=ua(sa)[0];return[ga().current,e]},useMutableSource:fa,useOpaqueIdentifier:function(){return ua(sa)[0]},unstable_isNewReconciler:!1},Da={readContext:ro,useCallback:xa,useContext:ro,useEffect:ba,useImperativeHandle:Ea,useLayoutEffect:Sa,useMemo:Ia,useReducer:ca,useRef:ga,useState:function(){return ca(sa)},useDebugValue:_a,useDeferredValue:function(e){var t=ca(sa),n=t[0],r=t[1];return ba((function(){var t=Yo.transition;Yo.transition=1;try{r(e)}finally{Yo.transition=t}}),[e]),n},useTransition:function(){var e=ca(sa)[0];return[ga().current,e]},useMutableSource:fa,useOpaqueIdentifier:function(){return ca(sa)[0]},unstable_isNewReconciler:!1},Aa=S.ReactCurrentOwner,Ma=!1;function Ua(e,t,n,r){t.child=null===e?xo(t,null,n,r):_o(t,e.child,n,r)}function Na(e,t,n,r,i){n=n.render;var o=t.ref;return no(t,i),r=ia(e,t,n,r,o,i),null===e||Ma?(t.flags|=1,Ua(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~i,ns(e,t,i))}function La(e,t,n,r,i,o){if(null===e){var a=n.type;return"function"!==typeof a||qu(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Gu(n.type,null,r,t,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,ja(e,t,a,r,i,o))}return a=e.child,0===(i&o)&&(i=a.memoizedProps,(n=null!==(n=n.compare)?n:cr)(i,r)&&e.ref===t.ref)?ns(e,t,o):(t.flags|=1,(e=Vu(a,r)).ref=t.ref,e.return=t,t.child=e)}function ja(e,t,n,r,i,o){if(null!==e&&cr(e.memoizedProps,r)&&e.ref===t.ref){if(Ma=!1,0===(o&i))return t.lanes=e.lanes,ns(e,t,o);0!==(16384&e.flags)&&(Ma=!0)}return Fa(e,t,n,r,o)}function Ba(e,t,n){var r=t.pendingProps,i=r.children,o=null!==e?e.memoizedState:null;if("hidden"===r.mode||"unstable-defer-without-hiding"===r.mode)if(0===(4&t.mode))t.memoizedState={baseLanes:0},ku(t,n);else{if(0===(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e},ku(t,e),null;t.memoizedState={baseLanes:0},ku(t,null!==o?o.baseLanes:n)}else null!==o?(r=o.baseLanes|n,t.memoizedState=null):r=n,ku(t,r);return Ua(e,t,i,n),t.child}function Ka(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=128)}function Fa(e,t,n,r,i){var o=pi(n)?fi:li.current;return o=hi(t,o),no(t,i),n=ia(e,t,n,r,o,i),null===e||Ma?(t.flags|=1,Ua(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~i,ns(e,t,i))}function qa(e,t,n,r,i){if(pi(n)){var o=!0;mi(t)}else o=!1;if(no(t,i),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),yo(t,n,r),ko(t,n,r,i),r=!0;else if(null===e){var a=t.stateNode,s=t.memoizedProps;a.props=s;var u=a.context,c=n.contextType;"object"===typeof c&&null!==c?c=ro(c):c=hi(t,c=pi(n)?fi:li.current);var l=n.getDerivedStateFromProps,d="function"===typeof l||"function"===typeof a.getSnapshotBeforeUpdate;d||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==r||u!==c)&&mo(t,a,r,c),io=!1;var f=t.memoizedState;a.state=f,lo(t,r,a,i),u=t.memoizedState,s!==r||f!==u||di.current||io?("function"===typeof l&&(po(t,n,l,r),u=t.memoizedState),(s=io||go(t,n,s,r,f,u,c))?(d||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4)):("function"===typeof a.componentDidMount&&(t.flags|=4),t.memoizedProps=r,t.memoizedState=u),a.props=r,a.state=u,a.context=c,r=s):("function"===typeof a.componentDidMount&&(t.flags|=4),r=!1)}else{a=t.stateNode,ao(e,t),s=t.memoizedProps,c=t.type===t.elementType?s:zi(t.type,s),a.props=c,d=t.pendingProps,f=a.context,"object"===typeof(u=n.contextType)&&null!==u?u=ro(u):u=hi(t,u=pi(n)?fi:li.current);var h=n.getDerivedStateFromProps;(l="function"===typeof h||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==d||f!==u)&&mo(t,a,r,u),io=!1,f=t.memoizedState,a.state=f,lo(t,r,a,i);var p=t.memoizedState;s!==d||f!==p||di.current||io?("function"===typeof h&&(po(t,n,h,r),p=t.memoizedState),(c=io||go(t,n,c,r,f,p,u))?(l||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(r,p,u),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,p,u)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=256)):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=256),t.memoizedProps=r,t.memoizedState=p),a.props=r,a.state=p,a.context=u,r=c):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=256),r=!1)}return Va(e,t,n,r,o,i)}function Va(e,t,n,r,i,o){Ka(e,t);var a=0!==(64&t.flags);if(!r&&!a)return i&&ki(t,n,!1),ns(e,t,o);r=t.stateNode,Aa.current=t;var s=a&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&a?(t.child=_o(t,e.child,null,o),t.child=_o(t,null,s,o)):Ua(e,t,s,o),t.memoizedState=r.state,i&&ki(t,n,!0),t.child}function Ga(e){var t=e.stateNode;t.pendingContext?gi(0,t.pendingContext,t.pendingContext!==t.context):t.context&&gi(0,t.context,!1),Po(e,t.containerInfo)}var Wa,Ha,$a,za={dehydrated:null,retryLane:0};function Ya(e,t,n){var r,i=t.pendingProps,o=Uo.current,a=!1;return(r=0!==(64&t.flags))||(r=(null===e||null!==e.memoizedState)&&0!==(2&o)),r?(a=!0,t.flags&=-65):null!==e&&null===e.memoizedState||void 0===i.fallback||!0===i.unstable_avoidThisFallback||(o|=1),ui(Uo,1&o),null===e?(void 0!==i.fallback&&qo(t),e=i.children,o=i.fallback,a?(e=Qa(t,e,o,n),t.child.memoizedState={baseLanes:n},t.memoizedState=za,e):"number"===typeof i.unstable_expectedLoadTime?(e=Qa(t,e,o,n),t.child.memoizedState={baseLanes:n},t.memoizedState=za,t.lanes=33554432,e):((n=Hu({mode:"visible",children:e},t.mode,n,null)).return=t,t.child=n)):(e.memoizedState,a?(i=Xa(e,t,i.children,i.fallback,n),a=t.child,o=e.child.memoizedState,a.memoizedState=null===o?{baseLanes:n}:{baseLanes:o.baseLanes|n},a.childLanes=e.childLanes&~n,t.memoizedState=za,i):(n=Ja(e,t,i.children,n),t.memoizedState=null,n))}function Qa(e,t,n,r){var i=e.mode,o=e.child;return t={mode:"hidden",children:t},0===(2&i)&&null!==o?(o.childLanes=0,o.pendingProps=t):o=Hu(t,i,0,null),n=Wu(n,i,r,null),o.return=e,n.return=e,o.sibling=n,e.child=o,n}function Ja(e,t,n,r){var i=e.child;return e=i.sibling,n=Vu(i,{mode:"visible",children:n}),0===(2&t.mode)&&(n.lanes=r),n.return=t,n.sibling=null,null!==e&&(e.nextEffect=null,e.flags=8,t.firstEffect=t.lastEffect=e),t.child=n}function Xa(e,t,n,r,i){var o=t.mode,a=e.child;e=a.sibling;var s={mode:"hidden",children:n};return 0===(2&o)&&t.child!==a?((n=t.child).childLanes=0,n.pendingProps=s,null!==(a=n.lastEffect)?(t.firstEffect=n.firstEffect,t.lastEffect=a,a.nextEffect=null):t.firstEffect=t.lastEffect=null):n=Vu(a,s),null!==e?r=Vu(e,r):(r=Wu(r,o,i,null)).flags|=2,r.return=t,n.return=t,n.sibling=r,t.child=n,r}function Za(e,t){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),to(e.return,t)}function es(e,t,n,r,i,o){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i,lastEffect:o}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i,a.lastEffect=o)}function ts(e,t,n){var r=t.pendingProps,i=r.revealOrder,o=r.tail;if(Ua(e,t,r.children,n),0!==(2&(r=Uo.current)))r=1&r|2,t.flags|=64;else{if(null!==e&&0!==(64&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Za(e,n);else if(19===e.tag)Za(e,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(ui(Uo,r),0===(2&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===No(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),es(t,!1,i,n,o,t.lastEffect);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===No(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}es(t,!0,n,null,o,t.lastEffect);break;case"together":es(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function ns(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),js|=t.lanes,0!==(n&t.childLanes)){if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Vu(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Vu(e,e.pendingProps)).return=t;n.sibling=null}return t.child}return null}function rs(e,t){if(!Bo)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function is(e,t,n){var r=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return pi(t.type)&&vi(),null;case 3:return Do(),si(di),si(li),$o(),(r=t.stateNode).pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(Go(t)?t.flags|=4:r.hydrate||(t.flags|=256)),null;case 5:Mo(t);var o=Co(Oo.current);if(n=t.type,null!==e&&null!=t.stateNode)Ha(e,t,n,r),e.ref!==t.ref&&(t.flags|=128);else{if(!r){if(null===t.stateNode)throw Error(a(166));return null}if(e=Co(To.current),Go(t)){r=t.stateNode,n=t.type;var s=t.memoizedProps;switch(r[Yr]=t,r[Qr]=s,n){case"dialog":Tr("cancel",r),Tr("close",r);break;case"iframe":case"object":case"embed":Tr("load",r);break;case"video":case"audio":for(e=0;e<Er.length;e++)Tr(Er[e],r);break;case"source":Tr("error",r);break;case"img":case"image":case"link":Tr("error",r),Tr("load",r);break;case"details":Tr("toggle",r);break;case"input":ee(r,s),Tr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Tr("invalid",r);break;case"textarea":ue(r,s),Tr("invalid",r)}for(var c in _e(n,s),e=null,s)s.hasOwnProperty(c)&&(o=s[c],"children"===c?"string"===typeof o?r.textContent!==o&&(e=["children",o]):"number"===typeof o&&r.textContent!==""+o&&(e=["children",""+o]):u.hasOwnProperty(c)&&null!=o&&"onScroll"===c&&Tr("scroll",r));switch(n){case"input":Q(r),re(r,s,!0);break;case"textarea":Q(r),le(r);break;case"select":case"option":break;default:"function"===typeof s.onClick&&(r.onclick=Lr)}r=e,t.updateQueue=r,null!==r&&(t.flags|=4)}else{switch(c=9===o.nodeType?o:o.ownerDocument,e===de&&(e=he(n)),e===de?"script"===n?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=c.createElement(n,{is:r.is}):(e=c.createElement(n),"select"===n&&(c=e,r.multiple?c.multiple=!0:r.size&&(c.size=r.size))):e=c.createElementNS(e,n),e[Yr]=t,e[Qr]=r,Wa(e,t),t.stateNode=e,c=xe(n,r),n){case"dialog":Tr("cancel",e),Tr("close",e),o=r;break;case"iframe":case"object":case"embed":Tr("load",e),o=r;break;case"video":case"audio":for(o=0;o<Er.length;o++)Tr(Er[o],e);o=r;break;case"source":Tr("error",e),o=r;break;case"img":case"image":case"link":Tr("error",e),Tr("load",e),o=r;break;case"details":Tr("toggle",e),o=r;break;case"input":ee(e,r),o=Z(e,r),Tr("invalid",e);break;case"option":o=oe(e,r);break;case"select":e._wrapperState={wasMultiple:!!r.multiple},o=i({},r,{value:void 0}),Tr("invalid",e);break;case"textarea":ue(e,r),o=se(e,r),Tr("invalid",e);break;default:o=r}_e(n,o);var l=o;for(s in l)if(l.hasOwnProperty(s)){var d=l[s];"style"===s?we(e,d):"dangerouslySetInnerHTML"===s?null!=(d=d?d.__html:void 0)&&ye(e,d):"children"===s?"string"===typeof d?("textarea"!==n||""!==d)&&me(e,d):"number"===typeof d&&me(e,""+d):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(u.hasOwnProperty(s)?null!=d&&"onScroll"===s&&Tr("scroll",e):null!=d&&b(e,s,d,c))}switch(n){case"input":Q(e),re(e,r,!1);break;case"textarea":Q(e),le(e);break;case"option":null!=r.value&&e.setAttribute("value",""+z(r.value));break;case"select":e.multiple=!!r.multiple,null!=(s=r.value)?ae(e,!!r.multiple,s,!1):null!=r.defaultValue&&ae(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof o.onClick&&(e.onclick=Lr)}Kr(n,r)&&(t.flags|=4)}null!==t.ref&&(t.flags|=128)}return null;case 6:if(e&&null!=t.stateNode)$a(0,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(a(166));n=Co(Oo.current),Co(To.current),Go(t)?(r=t.stateNode,n=t.memoizedProps,r[Yr]=t,r.nodeValue!==n&&(t.flags|=4)):((r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[Yr]=t,t.stateNode=r)}return null;case 13:return si(Uo),r=t.memoizedState,0!==(64&t.flags)?(t.lanes=n,t):(r=null!==r,n=!1,null===e?void 0!==t.memoizedProps.fallback&&Go(t):n=null!==e.memoizedState,r&&!n&&0!==(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!==(1&Uo.current)?0===Us&&(Us=3):(0!==Us&&3!==Us||(Us=4),null===Cs||0===(134217727&js)&&0===(134217727&Bs)||vu(Cs,Ds))),(r||n)&&(t.flags|=4),null);case 4:return Do(),null===e&&Or(t.stateNode.containerInfo),null;case 10:return eo(t),null;case 17:return pi(t.type)&&vi(),null;case 19:if(si(Uo),null===(r=t.memoizedState))return null;if(s=0!==(64&t.flags),null===(c=r.rendering))if(s)rs(r,!1);else{if(0!==Us||null!==e&&0!==(64&e.flags))for(e=t.child;null!==e;){if(null!==(c=No(e))){for(t.flags|=64,rs(r,!1),null!==(s=c.updateQueue)&&(t.updateQueue=s,t.flags|=4),null===r.lastEffect&&(t.firstEffect=null),t.lastEffect=r.lastEffect,r=n,n=t.child;null!==n;)e=r,(s=n).flags&=2,s.nextEffect=null,s.firstEffect=null,s.lastEffect=null,null===(c=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=c.childLanes,s.lanes=c.lanes,s.child=c.child,s.memoizedProps=c.memoizedProps,s.memoizedState=c.memoizedState,s.updateQueue=c.updateQueue,s.type=c.type,e=c.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return ui(Uo,1&Uo.current|2),t.child}e=e.sibling}null!==r.tail&&Ki()>Vs&&(t.flags|=64,s=!0,rs(r,!1),t.lanes=33554432)}else{if(!s)if(null!==(e=No(c))){if(t.flags|=64,s=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),rs(r,!0),null===r.tail&&"hidden"===r.tailMode&&!c.alternate&&!Bo)return null!==(t=t.lastEffect=r.lastEffect)&&(t.nextEffect=null),null}else 2*Ki()-r.renderingStartTime>Vs&&1073741824!==n&&(t.flags|=64,s=!0,rs(r,!1),t.lanes=33554432);r.isBackwards?(c.sibling=t.child,t.child=c):(null!==(n=r.last)?n.sibling=c:t.child=c,r.last=c)}return null!==r.tail?(n=r.tail,r.rendering=n,r.tail=n.sibling,r.lastEffect=t.lastEffect,r.renderingStartTime=Ki(),n.sibling=null,t=Uo.current,ui(Uo,s?1&t|2:1&t),n):null;case 23:case 24:return bu(),null!==e&&null!==e.memoizedState!==(null!==t.memoizedState)&&"unstable-defer-without-hiding"!==r.mode&&(t.flags|=4),null}throw Error(a(156,t.tag))}function os(e){switch(e.tag){case 1:pi(e.type)&&vi();var t=e.flags;return 4096&t?(e.flags=-4097&t|64,e):null;case 3:if(Do(),si(di),si(li),$o(),0!==(64&(t=e.flags)))throw Error(a(285));return e.flags=-4097&t|64,e;case 5:return Mo(e),null;case 13:return si(Uo),4096&(t=e.flags)?(e.flags=-4097&t|64,e):null;case 19:return si(Uo),null;case 4:return Do(),null;case 10:return eo(e),null;case 23:case 24:return bu(),null;default:return null}}function as(e,t){try{var n="",r=t;do{n+=H(r),r=r.return}while(r);var i=n}catch(o){i="\nError generating stack: "+o.message+"\n"+o.stack}return{value:e,source:t,stack:i}}function ss(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}Wa=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ha=function(e,t,n,r){var o=e.memoizedProps;if(o!==r){e=t.stateNode,Co(To.current);var a,s=null;switch(n){case"input":o=Z(e,o),r=Z(e,r),s=[];break;case"option":o=oe(e,o),r=oe(e,r),s=[];break;case"select":o=i({},o,{value:void 0}),r=i({},r,{value:void 0}),s=[];break;case"textarea":o=se(e,o),r=se(e,r),s=[];break;default:"function"!==typeof o.onClick&&"function"===typeof r.onClick&&(e.onclick=Lr)}for(d in _e(n,r),n=null,o)if(!r.hasOwnProperty(d)&&o.hasOwnProperty(d)&&null!=o[d])if("style"===d){var c=o[d];for(a in c)c.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==d&&"children"!==d&&"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&"autoFocus"!==d&&(u.hasOwnProperty(d)?s||(s=[]):(s=s||[]).push(d,null));for(d in r){var l=r[d];if(c=null!=o?o[d]:void 0,r.hasOwnProperty(d)&&l!==c&&(null!=l||null!=c))if("style"===d)if(c){for(a in c)!c.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in l)l.hasOwnProperty(a)&&c[a]!==l[a]&&(n||(n={}),n[a]=l[a])}else n||(s||(s=[]),s.push(d,n)),n=l;else"dangerouslySetInnerHTML"===d?(l=l?l.__html:void 0,c=c?c.__html:void 0,null!=l&&c!==l&&(s=s||[]).push(d,l)):"children"===d?"string"!==typeof l&&"number"!==typeof l||(s=s||[]).push(d,""+l):"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&(u.hasOwnProperty(d)?(null!=l&&"onScroll"===d&&Tr("scroll",e),s||c===l||(s=[])):"object"===typeof l&&null!==l&&l.$$typeof===U?l.toString():(s=s||[]).push(d,l))}n&&(s=s||[]).push("style",n);var d=s;(t.updateQueue=d)&&(t.flags|=4)}},$a=function(e,t,n,r){n!==r&&(t.flags|=4)};var us="function"===typeof WeakMap?WeakMap:Map;function cs(e,t,n){(n=so(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){$s||($s=!0,zs=r),ss(0,t)},n}function ls(e,t,n){(n=so(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return ss(0,t),r(i)}}var o=e.stateNode;return null!==o&&"function"===typeof o.componentDidCatch&&(n.callback=function(){"function"!==typeof r&&(null===Ys?Ys=new Set([this]):Ys.add(this),ss(0,t));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}var ds="function"===typeof WeakSet?WeakSet:Set;function fs(e){var t=e.ref;if(null!==t)if("function"===typeof t)try{t(null)}catch(n){Lu(e,n)}else t.current=null}function hs(e,t){switch(t.tag){case 0:case 11:case 15:case 22:return;case 1:if(256&t.flags&&null!==e){var n=e.memoizedProps,r=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:zi(t.type,n),r),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:return void(256&t.flags&&Gr(t.stateNode.containerInfo));case 5:case 6:case 4:case 17:return}throw Error(a(163))}function ps(e,t,n){switch(n.tag){case 0:case 11:case 15:case 22:if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{if(3===(3&e.tag)){var r=e.create;e.destroy=r()}e=e.next}while(e!==t)}if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{var i=e;r=i.next,0!==(4&(i=i.tag))&&0!==(1&i)&&(Mu(n,e),Au(n,e)),e=r}while(e!==t)}return;case 1:return e=n.stateNode,4&n.flags&&(null===t?e.componentDidMount():(r=n.elementType===n.type?t.memoizedProps:zi(n.type,t.memoizedProps),e.componentDidUpdate(r,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate))),void(null!==(t=n.updateQueue)&&fo(n,t,e));case 3:if(null!==(t=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 5:e=n.child.stateNode;break;case 1:e=n.child.stateNode}fo(n,t,e)}return;case 5:return e=n.stateNode,void(null===t&&4&n.flags&&Kr(n.type,n.memoizedProps)&&e.focus());case 6:case 4:case 12:return;case 13:return void(null===n.memoizedState&&(n=n.alternate,null!==n&&(n=n.memoizedState,null!==n&&(n=n.dehydrated,null!==n&&wt(n)))));case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(a(163))}function vs(e,t){for(var n=e;;){if(5===n.tag){var r=n.stateNode;if(t)"function"===typeof(r=r.style).setProperty?r.setProperty("display","none","important"):r.display="none";else{r=n.stateNode;var i=n.memoizedProps.style;i=void 0!==i&&null!==i&&i.hasOwnProperty("display")?i.display:null,r.style.display=Se("display",i)}}else if(6===n.tag)n.stateNode.nodeValue=t?"":n.memoizedProps;else if((23!==n.tag&&24!==n.tag||null===n.memoizedState||n===e)&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}}function gs(e,t){if(Si&&"function"===typeof Si.onCommitFiberUnmount)try{Si.onCommitFiberUnmount(bi,t)}catch(o){}switch(t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var n=e=e.next;do{var r=n,i=r.destroy;if(r=r.tag,void 0!==i)if(0!==(4&r))Mu(t,n);else{r=t;try{i()}catch(o){Lu(r,o)}}n=n.next}while(n!==e)}break;case 1:if(fs(t),"function"===typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(o){Lu(t,o)}break;case 5:fs(t);break;case 4:ws(e,t)}}function ys(e){e.alternate=null,e.child=null,e.dependencies=null,e.firstEffect=null,e.lastEffect=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.return=null,e.updateQueue=null}function ms(e){return 5===e.tag||3===e.tag||4===e.tag}function ks(e){e:{for(var t=e.return;null!==t;){if(ms(t))break e;t=t.return}throw Error(a(160))}var n=t;switch(t=n.stateNode,n.tag){case 5:var r=!1;break;case 3:case 4:t=t.containerInfo,r=!0;break;default:throw Error(a(161))}16&n.flags&&(me(t,""),n.flags&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||ms(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.flags)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.flags)){n=n.stateNode;break e}}r?bs(e,n,t):Ss(e,n,t)}function bs(e,t,n){var r=e.tag,i=5===r||6===r;if(i)e=i?e.stateNode:e.stateNode.instance,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Lr));else if(4!==r&&null!==(e=e.child))for(bs(e,t,n),e=e.sibling;null!==e;)bs(e,t,n),e=e.sibling}function Ss(e,t,n){var r=e.tag,i=5===r||6===r;if(i)e=i?e.stateNode:e.stateNode.instance,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(Ss(e,t,n),e=e.sibling;null!==e;)Ss(e,t,n),e=e.sibling}function ws(e,t){for(var n,r,i=t,o=!1;;){if(!o){o=i.return;e:for(;;){if(null===o)throw Error(a(160));switch(n=o.stateNode,o.tag){case 5:r=!1;break e;case 3:case 4:n=n.containerInfo,r=!0;break e}o=o.return}o=!0}if(5===i.tag||6===i.tag){e:for(var s=e,u=i,c=u;;)if(gs(s,c),null!==c.child&&4!==c.tag)c.child.return=c,c=c.child;else{if(c===u)break e;for(;null===c.sibling;){if(null===c.return||c.return===u)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}r?(s=n,u=i.stateNode,8===s.nodeType?s.parentNode.removeChild(u):s.removeChild(u)):n.removeChild(i.stateNode)}else if(4===i.tag){if(null!==i.child){n=i.stateNode.containerInfo,r=!0,i.child.return=i,i=i.child;continue}}else if(gs(e,i),null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;4===(i=i.return).tag&&(o=!1)}i.sibling.return=i.return,i=i.sibling}}function Es(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:var n=t.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var r=n=n.next;do{3===(3&r.tag)&&(e=r.destroy,r.destroy=void 0,void 0!==e&&e()),r=r.next}while(r!==n)}return;case 1:return;case 5:if(null!=(n=t.stateNode)){r=t.memoizedProps;var i=null!==e?e.memoizedProps:r;e=t.type;var o=t.updateQueue;if(t.updateQueue=null,null!==o){for(n[Qr]=r,"input"===e&&"radio"===r.type&&null!=r.name&&te(n,r),xe(e,i),t=xe(e,r),i=0;i<o.length;i+=2){var s=o[i],u=o[i+1];"style"===s?we(n,u):"dangerouslySetInnerHTML"===s?ye(n,u):"children"===s?me(n,u):b(n,s,u,t)}switch(e){case"input":ne(n,r);break;case"textarea":ce(n,r);break;case"select":e=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!r.multiple,null!=(o=r.value)?ae(n,!!r.multiple,o,!1):e!==!!r.multiple&&(null!=r.defaultValue?ae(n,!!r.multiple,r.defaultValue,!0):ae(n,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(a(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return void((n=t.stateNode).hydrate&&(n.hydrate=!1,wt(n.containerInfo)));case 12:return;case 13:return null!==t.memoizedState&&(qs=Ki(),vs(t.child,!0)),void _s(t);case 19:return void _s(t);case 17:return;case 23:case 24:return void vs(t,null!==t.memoizedState)}throw Error(a(163))}function _s(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new ds),t.forEach((function(t){var r=Bu.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function xs(e,t){return null!==e&&(null===(e=e.memoizedState)||null!==e.dehydrated)&&(null!==(t=t.memoizedState)&&null===t.dehydrated)}var Is=Math.ceil,Ts=S.ReactCurrentDispatcher,Rs=S.ReactCurrentOwner,Os=0,Cs=null,Ps=null,Ds=0,As=0,Ms=ai(0),Us=0,Ns=null,Ls=0,js=0,Bs=0,Ks=0,Fs=null,qs=0,Vs=1/0;function Gs(){Vs=Ki()+500}var Ws,Hs=null,$s=!1,zs=null,Ys=null,Qs=!1,Js=null,Xs=90,Zs=[],eu=[],tu=null,nu=0,ru=null,iu=-1,ou=0,au=0,su=null,uu=!1;function cu(){return 0!==(48&Os)?Ki():-1!==iu?iu:iu=Ki()}function lu(e){if(0===(2&(e=e.mode)))return 1;if(0===(4&e))return 99===Fi()?1:2;if(0===ou&&(ou=Ls),0!==$i.transition){0!==au&&(au=null!==Fs?Fs.pendingLanes:0),e=ou;var t=4186112&~au;return 0===(t&=-t)&&(0===(t=(e=4186112&~e)&-e)&&(t=8192)),t}return e=Fi(),0!==(4&Os)&&98===e?e=Kt(12,ou):e=Kt(e=function(e){switch(e){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}(e),ou),e}function du(e,t,n){if(50<nu)throw nu=0,ru=null,Error(a(185));if(null===(e=fu(e,t)))return null;Vt(e,t,n),e===Cs&&(Bs|=t,4===Us&&vu(e,Ds));var r=Fi();1===t?0!==(8&Os)&&0===(48&Os)?gu(e):(hu(e,n),0===Os&&(Gs(),Wi())):(0===(4&Os)||98!==r&&99!==r||(null===tu?tu=new Set([e]):tu.add(e)),hu(e,n)),Fs=e}function fu(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}function hu(e,t){for(var n=e.callbackNode,r=e.suspendedLanes,i=e.pingedLanes,o=e.expirationTimes,s=e.pendingLanes;0<s;){var u=31-Gt(s),c=1<<u,l=o[u];if(-1===l){if(0===(c&r)||0!==(c&i)){l=t,Lt(c);var d=Nt;o[u]=10<=d?l+250:6<=d?l+5e3:-1}}else l<=t&&(e.expiredLanes|=c);s&=~c}if(r=jt(e,e===Cs?Ds:0),t=Nt,0===r)null!==n&&(n!==Mi&&_i(n),e.callbackNode=null,e.callbackPriority=0);else{if(null!==n){if(e.callbackPriority===t)return;n!==Mi&&_i(n)}15===t?(n=gu.bind(null,e),null===Ni?(Ni=[n],Li=Ei(Oi,Hi)):Ni.push(n),n=Mi):14===t?n=Gi(99,gu.bind(null,e)):n=Gi(n=function(e){switch(e){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(a(358,e))}}(t),pu.bind(null,e)),e.callbackPriority=t,e.callbackNode=n}}function pu(e){if(iu=-1,au=ou=0,0!==(48&Os))throw Error(a(327));var t=e.callbackNode;if(Du()&&e.callbackNode!==t)return null;var n=jt(e,e===Cs?Ds:0);if(0===n)return null;var r=n,i=Os;Os|=16;var o=Eu();for(Cs===e&&Ds===r||(Gs(),Su(e,r));;)try{Iu();break}catch(u){wu(e,u)}if(Zi(),Ts.current=o,Os=i,null!==Ps?r=0:(Cs=null,Ds=0,r=Us),0!==(Ls&Bs))Su(e,0);else if(0!==r){if(2===r&&(Os|=64,e.hydrate&&(e.hydrate=!1,Gr(e.containerInfo)),0!==(n=Bt(e))&&(r=_u(e,n))),1===r)throw t=Ns,Su(e,0),vu(e,n),hu(e,Ki()),t;switch(e.finishedWork=e.current.alternate,e.finishedLanes=n,r){case 0:case 1:throw Error(a(345));case 2:Ou(e);break;case 3:if(vu(e,n),(62914560&n)===n&&10<(r=qs+500-Ki())){if(0!==jt(e,0))break;if(((i=e.suspendedLanes)&n)!==n){cu(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=qr(Ou.bind(null,e),r);break}Ou(e);break;case 4:if(vu(e,n),(4186112&n)===n)break;for(r=e.eventTimes,i=-1;0<n;){var s=31-Gt(n);o=1<<s,(s=r[s])>i&&(i=s),n&=~o}if(n=i,10<(n=(120>(n=Ki()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Is(n/1960))-n)){e.timeoutHandle=qr(Ou.bind(null,e),n);break}Ou(e);break;case 5:Ou(e);break;default:throw Error(a(329))}}return hu(e,Ki()),e.callbackNode===t?pu.bind(null,e):null}function vu(e,t){for(t&=~Ks,t&=~Bs,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Gt(t),r=1<<n;e[n]=-1,t&=~r}}function gu(e){if(0!==(48&Os))throw Error(a(327));if(Du(),e===Cs&&0!==(e.expiredLanes&Ds)){var t=Ds,n=_u(e,t);0!==(Ls&Bs)&&(n=_u(e,t=jt(e,t)))}else n=_u(e,t=jt(e,0));if(0!==e.tag&&2===n&&(Os|=64,e.hydrate&&(e.hydrate=!1,Gr(e.containerInfo)),0!==(t=Bt(e))&&(n=_u(e,t))),1===n)throw n=Ns,Su(e,0),vu(e,t),hu(e,Ki()),n;return e.finishedWork=e.current.alternate,e.finishedLanes=t,Ou(e),hu(e,Ki()),null}function yu(e,t){var n=Os;Os|=1;try{return e(t)}finally{0===(Os=n)&&(Gs(),Wi())}}function mu(e,t){var n=Os;Os&=-2,Os|=8;try{return e(t)}finally{0===(Os=n)&&(Gs(),Wi())}}function ku(e,t){ui(Ms,As),As|=t,Ls|=t}function bu(){As=Ms.current,si(Ms)}function Su(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,Vr(n)),null!==Ps)for(n=Ps.return;null!==n;){var r=n;switch(r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&vi();break;case 3:Do(),si(di),si(li),$o();break;case 5:Mo(r);break;case 4:Do();break;case 13:case 19:si(Uo);break;case 10:eo(r);break;case 23:case 24:bu()}n=n.return}Cs=e,Ps=Vu(e.current,null),Ds=As=Ls=t,Us=0,Ns=null,Ks=Bs=js=0}function wu(e,t){for(;;){var n=Ps;try{if(Zi(),zo.current=Oa,ea){for(var r=Jo.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}ea=!1}if(Qo=0,Zo=Xo=Jo=null,ta=!1,Rs.current=null,null===n||null===n.return){Us=1,Ns=t,Ps=null;break}e:{var o=e,a=n.return,s=n,u=t;if(t=Ds,s.flags|=2048,s.firstEffect=s.lastEffect=null,null!==u&&"object"===typeof u&&"function"===typeof u.then){var c=u;if(0===(2&s.mode)){var l=s.alternate;l?(s.updateQueue=l.updateQueue,s.memoizedState=l.memoizedState,s.lanes=l.lanes):(s.updateQueue=null,s.memoizedState=null)}var d=0!==(1&Uo.current),f=a;do{var h;if(h=13===f.tag){var p=f.memoizedState;if(null!==p)h=null!==p.dehydrated;else{var v=f.memoizedProps;h=void 0!==v.fallback&&(!0!==v.unstable_avoidThisFallback||!d)}}if(h){var g=f.updateQueue;if(null===g){var y=new Set;y.add(c),f.updateQueue=y}else g.add(c);if(0===(2&f.mode)){if(f.flags|=64,s.flags|=16384,s.flags&=-2981,1===s.tag)if(null===s.alternate)s.tag=17;else{var m=so(-1,1);m.tag=2,uo(s,m)}s.lanes|=1;break e}u=void 0,s=t;var k=o.pingCache;if(null===k?(k=o.pingCache=new us,u=new Set,k.set(c,u)):void 0===(u=k.get(c))&&(u=new Set,k.set(c,u)),!u.has(s)){u.add(s);var b=ju.bind(null,o,c,s);c.then(b,b)}f.flags|=4096,f.lanes=t;break e}f=f.return}while(null!==f);u=Error(($(s.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.")}5!==Us&&(Us=2),u=as(u,s),f=a;do{switch(f.tag){case 3:o=u,f.flags|=4096,t&=-t,f.lanes|=t,co(f,cs(0,o,t));break e;case 1:o=u;var S=f.type,w=f.stateNode;if(0===(64&f.flags)&&("function"===typeof S.getDerivedStateFromError||null!==w&&"function"===typeof w.componentDidCatch&&(null===Ys||!Ys.has(w)))){f.flags|=4096,t&=-t,f.lanes|=t,co(f,ls(f,o,t));break e}}f=f.return}while(null!==f)}Ru(n)}catch(E){t=E,Ps===n&&null!==n&&(Ps=n=n.return);continue}break}}function Eu(){var e=Ts.current;return Ts.current=Oa,null===e?Oa:e}function _u(e,t){var n=Os;Os|=16;var r=Eu();for(Cs===e&&Ds===t||Su(e,t);;)try{xu();break}catch(i){wu(e,i)}if(Zi(),Os=n,Ts.current=r,null!==Ps)throw Error(a(261));return Cs=null,Ds=0,Us}function xu(){for(;null!==Ps;)Tu(Ps)}function Iu(){for(;null!==Ps&&!xi();)Tu(Ps)}function Tu(e){var t=Ws(e.alternate,e,As);e.memoizedProps=e.pendingProps,null===t?Ru(e):Ps=t,Rs.current=null}function Ru(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(2048&t.flags)){if(null!==(n=is(n,t,As)))return void(Ps=n);if(24!==(n=t).tag&&23!==n.tag||null===n.memoizedState||0!==(1073741824&As)||0===(4&n.mode)){for(var r=0,i=n.child;null!==i;)r|=i.lanes|i.childLanes,i=i.sibling;n.childLanes=r}null!==e&&0===(2048&e.flags)&&(null===e.firstEffect&&(e.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=t.firstEffect),e.lastEffect=t.lastEffect),1<t.flags&&(null!==e.lastEffect?e.lastEffect.nextEffect=t:e.firstEffect=t,e.lastEffect=t))}else{if(null!==(n=os(t)))return n.flags&=2047,void(Ps=n);null!==e&&(e.firstEffect=e.lastEffect=null,e.flags|=2048)}if(null!==(t=t.sibling))return void(Ps=t);Ps=t=e}while(null!==t);0===Us&&(Us=5)}function Ou(e){var t=Fi();return Vi(99,Cu.bind(null,e,t)),null}function Cu(e,t){do{Du()}while(null!==Js);if(0!==(48&Os))throw Error(a(327));var n=e.finishedWork;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(a(177));e.callbackNode=null;var r=n.lanes|n.childLanes,i=r,o=e.pendingLanes&~i;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=i,e.mutableReadLanes&=i,e.entangledLanes&=i,i=e.entanglements;for(var s=e.eventTimes,u=e.expirationTimes;0<o;){var c=31-Gt(o),l=1<<c;i[c]=0,s[c]=-1,u[c]=-1,o&=~l}if(null!==tu&&0===(24&r)&&tu.has(e)&&tu.delete(e),e===Cs&&(Ps=Cs=null,Ds=0),1<n.flags?null!==n.lastEffect?(n.lastEffect.nextEffect=n,r=n.firstEffect):r=n:r=n.firstEffect,null!==r){if(i=Os,Os|=32,Rs.current=null,jr=Yt,pr(s=hr())){if("selectionStart"in s)u={start:s.selectionStart,end:s.selectionEnd};else e:if(u=(u=s.ownerDocument)&&u.defaultView||window,(l=u.getSelection&&u.getSelection())&&0!==l.rangeCount){u=l.anchorNode,o=l.anchorOffset,c=l.focusNode,l=l.focusOffset;try{u.nodeType,c.nodeType}catch(I){u=null;break e}var d=0,f=-1,h=-1,p=0,v=0,g=s,y=null;t:for(;;){for(var m;g!==u||0!==o&&3!==g.nodeType||(f=d+o),g!==c||0!==l&&3!==g.nodeType||(h=d+l),3===g.nodeType&&(d+=g.nodeValue.length),null!==(m=g.firstChild);)y=g,g=m;for(;;){if(g===s)break t;if(y===u&&++p===o&&(f=d),y===c&&++v===l&&(h=d),null!==(m=g.nextSibling))break;y=(g=y).parentNode}g=m}u=-1===f||-1===h?null:{start:f,end:h}}else u=null;u=u||{start:0,end:0}}else u=null;Br={focusedElem:s,selectionRange:u},Yt=!1,su=null,uu=!1,Hs=r;do{try{Pu()}catch(I){if(null===Hs)throw Error(a(330));Lu(Hs,I),Hs=Hs.nextEffect}}while(null!==Hs);su=null,Hs=r;do{try{for(s=e;null!==Hs;){var k=Hs.flags;if(16&k&&me(Hs.stateNode,""),128&k){var b=Hs.alternate;if(null!==b){var S=b.ref;null!==S&&("function"===typeof S?S(null):S.current=null)}}switch(1038&k){case 2:ks(Hs),Hs.flags&=-3;break;case 6:ks(Hs),Hs.flags&=-3,Es(Hs.alternate,Hs);break;case 1024:Hs.flags&=-1025;break;case 1028:Hs.flags&=-1025,Es(Hs.alternate,Hs);break;case 4:Es(Hs.alternate,Hs);break;case 8:ws(s,u=Hs);var w=u.alternate;ys(u),null!==w&&ys(w)}Hs=Hs.nextEffect}}catch(I){if(null===Hs)throw Error(a(330));Lu(Hs,I),Hs=Hs.nextEffect}}while(null!==Hs);if(S=Br,b=hr(),k=S.focusedElem,s=S.selectionRange,b!==k&&k&&k.ownerDocument&&fr(k.ownerDocument.documentElement,k)){null!==s&&pr(k)&&(b=s.start,void 0===(S=s.end)&&(S=b),"selectionStart"in k?(k.selectionStart=b,k.selectionEnd=Math.min(S,k.value.length)):(S=(b=k.ownerDocument||document)&&b.defaultView||window).getSelection&&(S=S.getSelection(),u=k.textContent.length,w=Math.min(s.start,u),s=void 0===s.end?w:Math.min(s.end,u),!S.extend&&w>s&&(u=s,s=w,w=u),u=dr(k,w),o=dr(k,s),u&&o&&(1!==S.rangeCount||S.anchorNode!==u.node||S.anchorOffset!==u.offset||S.focusNode!==o.node||S.focusOffset!==o.offset)&&((b=b.createRange()).setStart(u.node,u.offset),S.removeAllRanges(),w>s?(S.addRange(b),S.extend(o.node,o.offset)):(b.setEnd(o.node,o.offset),S.addRange(b))))),b=[];for(S=k;S=S.parentNode;)1===S.nodeType&&b.push({element:S,left:S.scrollLeft,top:S.scrollTop});for("function"===typeof k.focus&&k.focus(),k=0;k<b.length;k++)(S=b[k]).element.scrollLeft=S.left,S.element.scrollTop=S.top}Yt=!!jr,Br=jr=null,e.current=n,Hs=r;do{try{for(k=e;null!==Hs;){var E=Hs.flags;if(36&E&&ps(k,Hs.alternate,Hs),128&E){b=void 0;var _=Hs.ref;if(null!==_){var x=Hs.stateNode;switch(Hs.tag){case 5:b=x;break;default:b=x}"function"===typeof _?_(b):_.current=b}}Hs=Hs.nextEffect}}catch(I){if(null===Hs)throw Error(a(330));Lu(Hs,I),Hs=Hs.nextEffect}}while(null!==Hs);Hs=null,Ui(),Os=i}else e.current=n;if(Qs)Qs=!1,Js=e,Xs=t;else for(Hs=r;null!==Hs;)t=Hs.nextEffect,Hs.nextEffect=null,8&Hs.flags&&((E=Hs).sibling=null,E.stateNode=null),Hs=t;if(0===(r=e.pendingLanes)&&(Ys=null),1===r?e===ru?nu++:(nu=0,ru=e):nu=0,n=n.stateNode,Si&&"function"===typeof Si.onCommitFiberRoot)try{Si.onCommitFiberRoot(bi,n,void 0,64===(64&n.current.flags))}catch(I){}if(hu(e,Ki()),$s)throw $s=!1,e=zs,zs=null,e;return 0!==(8&Os)||Wi(),null}function Pu(){for(;null!==Hs;){var e=Hs.alternate;uu||null===su||(0!==(8&Hs.flags)?et(Hs,su)&&(uu=!0):13===Hs.tag&&xs(e,Hs)&&et(Hs,su)&&(uu=!0));var t=Hs.flags;0!==(256&t)&&hs(e,Hs),0===(512&t)||Qs||(Qs=!0,Gi(97,(function(){return Du(),null}))),Hs=Hs.nextEffect}}function Du(){if(90!==Xs){var e=97<Xs?97:Xs;return Xs=90,Vi(e,Uu)}return!1}function Au(e,t){Zs.push(t,e),Qs||(Qs=!0,Gi(97,(function(){return Du(),null})))}function Mu(e,t){eu.push(t,e),Qs||(Qs=!0,Gi(97,(function(){return Du(),null})))}function Uu(){if(null===Js)return!1;var e=Js;if(Js=null,0!==(48&Os))throw Error(a(331));var t=Os;Os|=32;var n=eu;eu=[];for(var r=0;r<n.length;r+=2){var i=n[r],o=n[r+1],s=i.destroy;if(i.destroy=void 0,"function"===typeof s)try{s()}catch(c){if(null===o)throw Error(a(330));Lu(o,c)}}for(n=Zs,Zs=[],r=0;r<n.length;r+=2){i=n[r],o=n[r+1];try{var u=i.create;i.destroy=u()}catch(c){if(null===o)throw Error(a(330));Lu(o,c)}}for(u=e.current.firstEffect;null!==u;)e=u.nextEffect,u.nextEffect=null,8&u.flags&&(u.sibling=null,u.stateNode=null),u=e;return Os=t,Wi(),!0}function Nu(e,t,n){uo(e,t=cs(0,t=as(n,t),1)),t=cu(),null!==(e=fu(e,1))&&(Vt(e,1,t),hu(e,t))}function Lu(e,t){if(3===e.tag)Nu(e,e,t);else for(var n=e.return;null!==n;){if(3===n.tag){Nu(n,e,t);break}if(1===n.tag){var r=n.stateNode;if("function"===typeof n.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Ys||!Ys.has(r))){var i=ls(n,e=as(t,e),1);if(uo(n,i),i=cu(),null!==(n=fu(n,1)))Vt(n,1,i),hu(n,i);else if("function"===typeof r.componentDidCatch&&(null===Ys||!Ys.has(r)))try{r.componentDidCatch(t,e)}catch(o){}break}}n=n.return}}function ju(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=cu(),e.pingedLanes|=e.suspendedLanes&n,Cs===e&&(Ds&n)===n&&(4===Us||3===Us&&(62914560&Ds)===Ds&&500>Ki()-qs?Su(e,0):Ks|=n),hu(e,t)}function Bu(e,t){var n=e.stateNode;null!==n&&n.delete(t),0===(t=0)&&(0===(2&(t=e.mode))?t=1:0===(4&t)?t=99===Fi()?1:2:(0===ou&&(ou=Ls),0===(t=Ft(62914560&~ou))&&(t=4194304))),n=cu(),null!==(e=fu(e,t))&&(Vt(e,t,n),hu(e,n))}function Ku(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function Fu(e,t,n,r){return new Ku(e,t,n,r)}function qu(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Vu(e,t){var n=e.alternate;return null===n?((n=Fu(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Gu(e,t,n,r,i,o){var s=2;if(r=e,"function"===typeof e)qu(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case _:return Wu(n.children,i,o,t);case N:s=8,i|=16;break;case x:s=8,i|=1;break;case I:return(e=Fu(12,n,t,8|i)).elementType=I,e.type=I,e.lanes=o,e;case C:return(e=Fu(13,n,t,i)).type=C,e.elementType=C,e.lanes=o,e;case P:return(e=Fu(19,n,t,i)).elementType=P,e.lanes=o,e;case L:return Hu(n,i,o,t);case j:return(e=Fu(24,n,t,i)).elementType=j,e.lanes=o,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case T:s=10;break e;case R:s=9;break e;case O:s=11;break e;case D:s=14;break e;case A:s=16,r=null;break e;case M:s=22;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Fu(s,n,t,i)).elementType=e,t.type=r,t.lanes=o,t}function Wu(e,t,n,r){return(e=Fu(7,e,r,t)).lanes=n,e}function Hu(e,t,n,r){return(e=Fu(23,e,r,t)).elementType=L,e.lanes=n,e}function $u(e,t,n){return(e=Fu(6,e,null,t)).lanes=n,e}function zu(e,t,n){return(t=Fu(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Yu(e,t,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=qt(0),this.expirationTimes=qt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=qt(0),this.mutableSourceEagerHydrationData=null}function Qu(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:E,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}function Ju(e,t,n,r){var i=t.current,o=cu(),s=lu(i);e:if(n){t:{if(Qe(n=n._reactInternals)!==n||1!==n.tag)throw Error(a(170));var u=n;do{switch(u.tag){case 3:u=u.stateNode.context;break t;case 1:if(pi(u.type)){u=u.stateNode.__reactInternalMemoizedMergedChildContext;break t}}u=u.return}while(null!==u);throw Error(a(171))}if(1===n.tag){var c=n.type;if(pi(c)){n=yi(n,c,u);break e}}n=u}else n=ci;return null===t.context?t.context=n:t.pendingContext=n,(t=so(o,s)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),uo(i,t),du(i,s,o),s}function Xu(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 5:default:return e.child.stateNode}}function Zu(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function ec(e,t){Zu(e,t),(e=e.alternate)&&Zu(e,t)}function tc(e,t,n){var r=null!=n&&null!=n.hydrationOptions&&n.hydrationOptions.mutableSources||null;if(n=new Yu(e,t,null!=n&&!0===n.hydrate),t=Fu(3,null,null,2===t?7:1===t?3:0),n.current=t,t.stateNode=n,oo(t),e[Jr]=n.current,Or(8===e.nodeType?e.parentNode:e),r)for(e=0;e<r.length;e++){var i=(t=r[e])._getVersion;i=i(t._source),null==n.mutableSourceEagerHydrationData?n.mutableSourceEagerHydrationData=[t,i]:n.mutableSourceEagerHydrationData.push(t,i)}this._internalRoot=n}function nc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function rc(e,t,n,r,i){var o=n._reactRootContainer;if(o){var a=o._internalRoot;if("function"===typeof i){var s=i;i=function(){var e=Xu(a);s.call(e)}}Ju(t,a,e,i)}else{if(o=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new tc(e,0,t?{hydrate:!0}:void 0)}(n,r),a=o._internalRoot,"function"===typeof i){var u=i;i=function(){var e=Xu(a);u.call(e)}}mu((function(){Ju(t,a,e,i)}))}return Xu(a)}function ic(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!nc(t))throw Error(a(200));return Qu(e,t,null,n)}Ws=function(e,t,n){var r=t.lanes;if(null!==e)if(e.memoizedProps!==t.pendingProps||di.current)Ma=!0;else{if(0===(n&r)){switch(Ma=!1,t.tag){case 3:Ga(t),Wo();break;case 5:Ao(t);break;case 1:pi(t.type)&&mi(t);break;case 4:Po(t,t.stateNode.containerInfo);break;case 10:r=t.memoizedProps.value;var i=t.type._context;ui(Yi,i._currentValue),i._currentValue=r;break;case 13:if(null!==t.memoizedState)return 0!==(n&t.child.childLanes)?Ya(e,t,n):(ui(Uo,1&Uo.current),null!==(t=ns(e,t,n))?t.sibling:null);ui(Uo,1&Uo.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(64&e.flags)){if(r)return ts(e,t,n);t.flags|=64}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),ui(Uo,Uo.current),r)break;return null;case 23:case 24:return t.lanes=0,Ba(e,t,n)}return ns(e,t,n)}Ma=0!==(16384&e.flags)}else Ma=!1;switch(t.lanes=0,t.tag){case 2:if(r=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,i=hi(t,li.current),no(t,n),i=ia(null,t,r,e,i,n),t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,pi(r)){var o=!0;mi(t)}else o=!1;t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,oo(t);var s=r.getDerivedStateFromProps;"function"===typeof s&&po(t,r,s,e),i.updater=vo,t.stateNode=i,i._reactInternals=t,ko(t,r,e,n),t=Va(null,t,r,!0,o,n)}else t.tag=0,Ua(null,t,i,n),t=t.child;return t;case 16:i=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,i=(o=i._init)(i._payload),t.type=i,o=t.tag=function(e){if("function"===typeof e)return qu(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===O)return 11;if(e===D)return 14}return 2}(i),e=zi(i,e),o){case 0:t=Fa(null,t,i,e,n);break e;case 1:t=qa(null,t,i,e,n);break e;case 11:t=Na(null,t,i,e,n);break e;case 14:t=La(null,t,i,zi(i.type,e),r,n);break e}throw Error(a(306,i,""))}return t;case 0:return r=t.type,i=t.pendingProps,Fa(e,t,r,i=t.elementType===r?i:zi(r,i),n);case 1:return r=t.type,i=t.pendingProps,qa(e,t,r,i=t.elementType===r?i:zi(r,i),n);case 3:if(Ga(t),r=t.updateQueue,null===e||null===r)throw Error(a(282));if(r=t.pendingProps,i=null!==(i=t.memoizedState)?i.element:null,ao(e,t),lo(t,r,null,n),(r=t.memoizedState.element)===i)Wo(),t=ns(e,t,n);else{if((o=(i=t.stateNode).hydrate)&&(jo=Wr(t.stateNode.containerInfo.firstChild),Lo=t,o=Bo=!0),o){if(null!=(e=i.mutableSourceEagerHydrationData))for(i=0;i<e.length;i+=2)(o=e[i])._workInProgressVersionPrimary=e[i+1],Ho.push(o);for(n=xo(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|1024,n=n.sibling}else Ua(e,t,r,n),Wo();t=t.child}return t;case 5:return Ao(t),null===e&&qo(t),r=t.type,i=t.pendingProps,o=null!==e?e.memoizedProps:null,s=i.children,Fr(r,i)?s=null:null!==o&&Fr(r,o)&&(t.flags|=16),Ka(e,t),Ua(e,t,s,n),t.child;case 6:return null===e&&qo(t),null;case 13:return Ya(e,t,n);case 4:return Po(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=_o(t,null,r,n):Ua(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,Na(e,t,r,i=t.elementType===r?i:zi(r,i),n);case 7:return Ua(e,t,t.pendingProps,n),t.child;case 8:case 12:return Ua(e,t,t.pendingProps.children,n),t.child;case 10:e:{r=t.type._context,i=t.pendingProps,s=t.memoizedProps,o=i.value;var u=t.type._context;if(ui(Yi,u._currentValue),u._currentValue=o,null!==s)if(u=s.value,0===(o=sr(u,o)?0:0|("function"===typeof r._calculateChangedBits?r._calculateChangedBits(u,o):1073741823))){if(s.children===i.children&&!di.current){t=ns(e,t,n);break e}}else for(null!==(u=t.child)&&(u.return=t);null!==u;){var c=u.dependencies;if(null!==c){s=u.child;for(var l=c.firstContext;null!==l;){if(l.context===r&&0!==(l.observedBits&o)){1===u.tag&&((l=so(-1,n&-n)).tag=2,uo(u,l)),u.lanes|=n,null!==(l=u.alternate)&&(l.lanes|=n),to(u.return,n),c.lanes|=n;break}l=l.next}}else s=10===u.tag&&u.type===t.type?null:u.child;if(null!==s)s.return=u;else for(s=u;null!==s;){if(s===t){s=null;break}if(null!==(u=s.sibling)){u.return=s.return,s=u;break}s=s.return}u=s}Ua(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=(o=t.pendingProps).children,no(t,n),r=r(i=ro(i,o.unstable_observedBits)),t.flags|=1,Ua(e,t,r,n),t.child;case 14:return o=zi(i=t.type,t.pendingProps),La(e,t,i,o=zi(i.type,o),r,n);case 15:return ja(e,t,t.type,t.pendingProps,r,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:zi(r,i),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,pi(r)?(e=!0,mi(t)):e=!1,no(t,n),yo(t,r,i),ko(t,r,i,n),Va(null,t,r,!0,e,n);case 19:return ts(e,t,n);case 23:case 24:return Ba(e,t,n)}throw Error(a(156,t.tag))},tc.prototype.render=function(e){Ju(e,this._internalRoot,null,null)},tc.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;Ju(null,e,null,(function(){t[Jr]=null}))},tt=function(e){13===e.tag&&(du(e,4,cu()),ec(e,4))},nt=function(e){13===e.tag&&(du(e,67108864,cu()),ec(e,67108864))},rt=function(e){if(13===e.tag){var t=cu(),n=lu(e);du(e,n,t),ec(e,n)}},it=function(e,t){return t()},Te=function(e,t,n){switch(t){case"input":if(ne(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=ni(r);if(!i)throw Error(a(90));J(r),ne(r,i)}}}break;case"textarea":ce(e,n);break;case"select":null!=(t=n.value)&&ae(e,!!n.multiple,t,!1)}},Ae=yu,Me=function(e,t,n,r,i){var o=Os;Os|=4;try{return Vi(98,e.bind(null,t,n,r,i))}finally{0===(Os=o)&&(Gs(),Wi())}},Ue=function(){0===(49&Os)&&(function(){if(null!==tu){var e=tu;tu=null,e.forEach((function(e){e.expiredLanes|=24&e.pendingLanes,hu(e,Ki())}))}Wi()}(),Du())},Ne=function(e,t){var n=Os;Os|=2;try{return e(t)}finally{0===(Os=n)&&(Gs(),Wi())}};var oc={Events:[ei,ti,ni,Pe,De,Du,{current:!1}]},ac={findFiberByHostInstance:Zr,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},sc={bundleType:ac.bundleType,version:ac.version,rendererPackageName:ac.rendererPackageName,rendererConfig:ac.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:S.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ze(e))?null:e.stateNode},findFiberByHostInstance:ac.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var uc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!uc.isDisabled&&uc.supportsFiber)try{bi=uc.inject(sc),Si=uc}catch(ge){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=oc,t.createPortal=ic,t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw Error(a(268,Object.keys(e)))}return e=null===(e=Ze(t))?null:e.stateNode},t.flushSync=function(e,t){var n=Os;if(0!==(48&n))return e(t);Os|=1;try{if(e)return Vi(99,e.bind(null,t))}finally{Os=n,Wi()}},t.hydrate=function(e,t,n){if(!nc(t))throw Error(a(200));return rc(null,e,t,!0,n)},t.render=function(e,t,n){if(!nc(t))throw Error(a(200));return rc(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!nc(e))throw Error(a(40));return!!e._reactRootContainer&&(mu((function(){rc(null,null,e,!1,(function(){e._reactRootContainer=null,e[Jr]=null}))})),!0)},t.unstable_batchedUpdates=yu,t.unstable_createPortal=function(e,t){return ic(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!nc(n))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return rc(e,t,n,!1,r)},t.version="17.0.2"},function(e,t,n){"use strict";e.exports=n(94)},function(e,t,n){"use strict";var r,i,o,a;if("object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var u=Date,c=u.now();t.unstable_now=function(){return u.now()-c}}if("undefined"===typeof window||"function"!==typeof MessageChannel){var l=null,d=null,f=function e(){if(null!==l)try{var n=t.unstable_now();l(!0,n),l=null}catch(r){throw setTimeout(e,0),r}};r=function(e){null!==l?setTimeout(r,0,e):(l=e,setTimeout(f,0))},i=function(e,t){d=setTimeout(e,t)},o=function(){clearTimeout(d)},t.unstable_shouldYield=function(){return!1},a=t.unstable_forceFrameRate=function(){}}else{var h=window.setTimeout,p=window.clearTimeout;if("undefined"!==typeof console){var v=window.cancelAnimationFrame;"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),"function"!==typeof v&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var g=!1,y=null,m=-1,k=5,b=0;t.unstable_shouldYield=function(){return t.unstable_now()>=b},a=function(){},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<e?Math.floor(1e3/e):5};var S=new MessageChannel,w=S.port2;S.port1.onmessage=function(){if(null!==y){var e=t.unstable_now();b=e+k;try{y(!0,e)?w.postMessage(null):(g=!1,y=null)}catch(n){throw w.postMessage(null),n}}else g=!1},r=function(e){y=e,g||(g=!0,w.postMessage(null))},i=function(e,n){m=h((function(){e(t.unstable_now())}),n)},o=function(){p(m),m=-1}}function E(e,t){var n=e.length;e.push(t);e:for(;;){var r=n-1>>>1,i=e[r];if(!(void 0!==i&&0<I(i,t)))break e;e[r]=t,e[n]=i,n=r}}function _(e){return void 0===(e=e[0])?null:e}function x(e){var t=e[0];if(void 0!==t){var n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length;r<i;){var o=2*(r+1)-1,a=e[o],s=o+1,u=e[s];if(void 0!==a&&0>I(a,n))void 0!==u&&0>I(u,a)?(e[r]=u,e[s]=n,r=s):(e[r]=a,e[o]=n,r=o);else{if(!(void 0!==u&&0>I(u,n)))break e;e[r]=u,e[s]=n,r=s}}}return t}return null}function I(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}var T=[],R=[],O=1,C=null,P=3,D=!1,A=!1,M=!1;function U(e){for(var t=_(R);null!==t;){if(null===t.callback)x(R);else{if(!(t.startTime<=e))break;x(R),t.sortIndex=t.expirationTime,E(T,t)}t=_(R)}}function N(e){if(M=!1,U(e),!A)if(null!==_(T))A=!0,r(L);else{var t=_(R);null!==t&&i(N,t.startTime-e)}}function L(e,n){A=!1,M&&(M=!1,o()),D=!0;var r=P;try{for(U(n),C=_(T);null!==C&&(!(C.expirationTime>n)||e&&!t.unstable_shouldYield());){var a=C.callback;if("function"===typeof a){C.callback=null,P=C.priorityLevel;var s=a(C.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?C.callback=s:C===_(T)&&x(T),U(n)}else x(T);C=_(T)}if(null!==C)var u=!0;else{var c=_(R);null!==c&&i(N,c.startTime-n),u=!1}return u}finally{C=null,P=r,D=!1}}var j=a;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){A||D||(A=!0,r(L))},t.unstable_getCurrentPriorityLevel=function(){return P},t.unstable_getFirstCallbackNode=function(){return _(T)},t.unstable_next=function(e){switch(P){case 1:case 2:case 3:var t=3;break;default:t=P}var n=P;P=t;try{return e()}finally{P=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=j,t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=P;P=e;try{return t()}finally{P=n}},t.unstable_scheduleCallback=function(e,n,a){var s=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?s+a:s:a=s,e){case 1:var u=-1;break;case 2:u=250;break;case 5:u=1073741823;break;case 4:u=1e4;break;default:u=5e3}return e={id:O++,callback:n,priorityLevel:e,startTime:a,expirationTime:u=a+u,sortIndex:-1},a>s?(e.sortIndex=a,E(R,e),null===_(T)&&e===_(R)&&(M?o():M=!0,i(N,a-s))):(e.sortIndex=u,E(T,e),A||D||(A=!0,r(L))),e},t.unstable_wrapCallback=function(e){var t=P;return function(){var n=P;P=t;try{return e.apply(this,arguments)}finally{P=n}}}},,function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(e,t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(u){i=!0,o=u}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(e,t,n){var r=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,i="function"===typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(P){u=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var i=t&&t.prototype instanceof g?t:g,o=Object.create(i.prototype),a=new R(r||[]);return o._invoke=function(e,t,n){var r=d;return function(i,o){if(r===h)throw new Error("Generator is already running");if(r===p){if("throw"===i)throw o;return C()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=x(a,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===d)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=h;var u=l(e,t,n);if("normal"===u.type){if(r=n.done?p:f,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=p,n.method="throw",n.arg=u.arg)}}}(e,n,a),o}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(P){return{type:"throw",arg:P}}}e.wrap=c;var d="suspendedStart",f="suspendedYield",h="executing",p="completed",v={};function g(){}function y(){}function m(){}var k={};k[o]=function(){return this};var b=Object.getPrototypeOf,S=b&&b(b(O([])));S&&S!==n&&r.call(S,o)&&(k=S);var w=m.prototype=g.prototype=Object.create(k);function E(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){function n(i,o,a,s){var u=l(e[i],e,o);if("throw"!==u.type){var c=u.arg,d=c.value;return d&&"object"===typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(d).then((function(e){c.value=e,a(c)}),(function(e){return n("throw",e,a,s)}))}s(u.arg)}var i;this._invoke=function(e,r){function o(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(o,o):o()}}function x(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,x(e,n),"throw"===n.method))return v;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var i=l(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,v;var o=i.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function O(e){if(e){var n=e[o];if(n)return n.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}return{next:C}}function C(){return{value:t,done:!0}}return y.prototype=w.constructor=m,m.constructor=y,y.displayName=u(m,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,u(e,s,"GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},E(_.prototype),_.prototype[a]=function(){return this},e.AsyncIterator=_,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new _(c(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(w),u(w,s,"Generator"),w[o]=function(){return this},w.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=O,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:O(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}(e.exports);try{regeneratorRuntime=r}catch(i){Function("r","regeneratorRuntime = r")(r)}},function(e,t,n){var r,i;!function(o,a){"use strict";void 0===(i="function"===typeof(r=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"];function i(e,t){var n=e[t];if("function"===typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(r){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function o(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function a(r){return"debug"===r&&(r="log"),typeof console!==t&&("trace"===r&&n?o:void 0!==console[r]?i(console,r):void 0!==console.log?i(console,"log"):e)}function s(t,n){for(var i=0;i<r.length;i++){var o=r[i];this[o]=i<t?e:this.methodFactory(o,t,n)}this.log=this.debug}function u(e,n,r){return function(){typeof console!==t&&(s.call(this,n,r),this[e].apply(this,arguments))}}function c(e,t,n){return a(e)||u.apply(this,arguments)}function l(e,n,i){var o,a=this,u="loglevel";function l(e){var n=(r[e]||"silent").toUpperCase();if(typeof window!==t&&u){try{return void(window.localStorage[u]=n)}catch(i){}try{window.document.cookie=encodeURIComponent(u)+"="+n+";"}catch(i){}}}function d(){var e;if(typeof window!==t&&u){try{e=window.localStorage[u]}catch(i){}if(typeof e===t)try{var n=window.document.cookie,r=n.indexOf(encodeURIComponent(u)+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r))[1])}catch(i){}return void 0===a.levels[e]&&(e=void 0),e}}"string"===typeof e?u+=":"+e:"symbol"===typeof e&&(u=void 0),a.name=e,a.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},a.methodFactory=i||c,a.getLevel=function(){return o},a.setLevel=function(n,r){if("string"===typeof n&&void 0!==a.levels[n.toUpperCase()]&&(n=a.levels[n.toUpperCase()]),!("number"===typeof n&&n>=0&&n<=a.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(o=n,!1!==r&&l(n),s.call(a,n,e),typeof console===t&&n<a.levels.SILENT)return"No console available for logging"},a.setDefaultLevel=function(e){d()||a.setLevel(e,!1)},a.enableAll=function(e){a.setLevel(a.levels.TRACE,e)},a.disableAll=function(e){a.setLevel(a.levels.SILENT,e)};var f=d();null==f&&(f=null==n?"WARN":n),a.setLevel(f,!1)}var d=new l,f={};d.getLogger=function(e){if("symbol"!==typeof e&&"string"!==typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=f[e];return t||(t=f[e]=new l(e,d.getLevel(),d.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return d.noConflict=function(){return typeof window!==t&&window.log===d&&(window.log=h),d},d.getLoggers=function(){return f},d.default=d,d})?r.call(t,n,t,e):r)||(e.exports=i)}()},function(e,t,n){var r=n(63);e.exports=function(e){if(Array.isArray(e))return r(e)}},function(e,t){e.exports=function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(e,t,n){"use strict";var r=n(105);var i=RegExp(Object.keys(r).map((function(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")})).join("|"),"g");function o(e){return r[e]}e.exports=function(e){return e.replace(i,o)}},function(e){e.exports=JSON.parse('{"0":"O","1":"l","\u05ad":"\u0596","\u05ae":"\u0598","\u05a8":"\u0599","\u05a4":"\u059a","\u1ab4":"\u06db","\u20db":"\u06db","\u0619":"\u0313","\u08f3":"\u0313","\u0343":"\u0313","\u0315":"\u0313","\u064f":"\u0313","\u065d":"\u0314","\u059c":"\u0301","\u059d":"\u0301","\u0618":"\u0301","\u0747":"\u0301","\u0341":"\u0301","\u0954":"\u0301","\u064e":"\u0301","\u0340":"\u0300","\u0953":"\u0300","\u030c":"\u0306","\ua67c":"\u0306","\u0658":"\u0306","\u065a":"\u0306","\u036e":"\u0306","\u06e8":"\u0306\u0307","\u0310":"\u0306\u0307","\u0901":"\u0306\u0307","\u0981":"\u0306\u0307","\u0a81":"\u0306\u0307","\u0b01":"\u0306\u0307","\u0c00":"\u0306\u0307","\u0c81":"\u0306\u0307","\u0d01":"\u0306\u0307","\ud805\udcbf":"\u0306\u0307","\u1cd0":"\u0302","\u0311":"\u0302","\u065b":"\u0302","\u07ee":"\u0302","\ua6f0":"\u0302","\u05af":"\u030a","\u06df":"\u030a","\u17d3":"\u030a","\u309a":"\u030a","\u0652":"\u030a","\u0b82":"\u030a","\u1036":"\u030a","\u17c6":"\u030a","\ud804\udf00":"\u030a","\u0e4d":"\u030a","\u0ecd":"\u030a","\u0366":"\u030a","\u2dea":"\u030a","\u08eb":"\u0308","\u07f3":"\u0308","\u064b":"\u030b","\u08f0":"\u030b","\u0342":"\u0303","\u0653":"\u0303","\u05c4":"\u0307","\u06ec":"\u0307","\u0740":"\u0307","\u08ea":"\u0307","\u0741":"\u0307","\u0358":"\u0307","\u05b9":"\u0307","\u05ba":"\u0307","\u05c2":"\u0307","\u05c1":"\u0307","\u07ed":"\u0307","\u0902":"\u0307","\u0a02":"\u0307","\u0a82":"\u0307","\u0bcd":"\u0307","\u0337":"\u0338","\u1ab7":"\u0328","\u0322":"\u0328","\u0345":"\u0328","\u1cd2":"\u0304","\u0305":"\u0304","\u0659":"\u0304","\u07eb":"\u0304","\ua6f1":"\u0304","\u1cda":"\u030e","\u0657":"\u0312","\u0357":"\u0350","\u08ff":"\u0350","\u08f8":"\u0350","\u0900":"\u0352","\u1ced":"\u0316","\u1cdc":"\u0329","\u0656":"\u0329","\u1cd5":"\u032b","\u0347":"\u0333","\u08f9":"\u0354","\u08fa":"\u0355","\u309b":"\uff9e","\u309c":"\uff9f","\u0336":"\u0335","\u302c":"\u0309","\u05c5":"\u0323","\u08ed":"\u0323","\u1cdd":"\u0323","\u05b4":"\u0323","\u065c":"\u0323","\u093c":"\u0323","\u09bc":"\u0323","\u0a3c":"\u0323","\u0abc":"\u0323","\u0b3c":"\u0323","\ud804\uddca":"\u0323","\ud805\udcc3":"\u0323","\ud802\ude3a":"\u0323","\u08ee":"\u0324","\u1cde":"\u0324","\u0f37":"\u0325","\u302d":"\u0325","\u0327":"\u0326","\u0321":"\u0326","\u0339":"\u0326","\u1cd9":"\u032d","\u1cd8":"\u032e","\u0952":"\u0331","\u0320":"\u0331","\u08f1":"\u064c","\u08e8":"\u064c","\u08e5":"\u064c","\ufc5e":"\ufe72\u0651","\u08f2":"\u064d","\ufc5f":"\ufe74\u0651","\ufcf2":"\ufe77\u0651","\ufc60":"\ufe76\u0651","\ufcf3":"\ufe79\u0651","\ufc61":"\ufe78\u0651","\u061a":"\u0650","\u0317":"\u0650","\ufcf4":"\ufe7b\u0651","\ufc62":"\ufe7a\u0651","\ufc63":"\ufe7c\u0670","\u065f":"\u0655","\u030d":"\u0670","\u0742":"\u073c","\u0a03":"\u0983","\u0c03":"\u0983","\u0c83":"\u0983","\u0d03":"\u0983","\u0d83":"\u0983","\u1038":"\u0983","\ud805\udcc1":"\u0983","\u17cb":"\u0e48","\u0ec8":"\u0e48","\u0ec9":"\u0e49","\u0eca":"\u0e4a","\u0ecb":"\u0e4b","\ua66f":"\u20e9","\\u2028":" ","\\u2029":" ","\u1680":" ","\u2000":" ","\u2001":" ","\u2002":" ","\u2003":" ","\u2004":" ","\u2005":" ","\u2006":" ","\u2008":" ","\u2009":" ","\u200a":" ","\u205f":" ","\xa0":" ","\u2007":" ","\u202f":" ","\u07fa":"_","\ufe4d":"_","\ufe4e":"_","\ufe4f":"_","\u2010":"-","\u2011":"-","\u2012":"-","\u2013":"-","\ufe58":"-","\u06d4":"-","\u2043":"-","\u02d7":"-","\u2212":"-","\u2796":"-","\u2cba":"-","\u2a29":"-\u0313","\u2e1a":"-\u0308","\ufb29":"-\u0307","\u2238":"-\u0307","\u2a2a":"-\u0323","\ua4fe":"-.","\uff5e":"\u301c","\u060d":",","\u066b":",","\u201a":",","\xb8":",","\ua4f9":",","\u2e32":"\u060c","\u066c":"\u060c","\u037e":";","\u2e35":"\u061b","\u0903":":","\u0a83":":","\uff1a":":","\u0589":":","\u0703":":","\u0704":":","\u16ec":":","\ufe30":":","\u1803":":","\u1809":":","\u205a":":","\u05c3":":","\u02f8":":","\ua789":":","\u2236":":","\u02d0":":","\ua4fd":":","\u2a74":"::=","\u29f4":":\u2192","\uff01":"!","\u01c3":"!","\u2d51":"!","\u203c":"!!","\u2049":"!?","\u0294":"?","\u0241":"?","\u097d":"?","\u13ae":"?","\ua6eb":"?","\u2048":"?!","\u2047":"??","\u2e2e":"\u061f","\ud834\udd6d":".","\u2024":".","\u0701":".","\u0702":".","\ua60e":".","\ud802\ude50":".","\u0660":".","\u06f0":".","\ua4f8":".","\ua4fb":".,","\u2025":"..","\ua4fa":"..","\u2026":"...","\ua6f4":"\ua6f3\ua6f3","\u30fb":"\xb7","\uff65":"\xb7","\u16eb":"\xb7","\u0387":"\xb7","\u2e31":"\xb7","\ud800\udd01":"\xb7","\u2022":"\xb7","\u2027":"\xb7","\u2219":"\xb7","\u22c5":"\xb7","\ua78f":"\xb7","\u1427":"\xb7","\u22ef":"\xb7\xb7\xb7","\u2d48":"\xb7\xb7\xb7","\u1444":"\xb7<","\u22d7":"\xb7>","\u1437":"\xb7>","\u1440":"\xb7>","\u152f":"\xb74","\u147e":"\xb7b","\u1480":"\xb7b\u0307","\u147a":"\xb7d","\u1498":"\xb7J","\u14b6":"\xb7L","\u1476":"\xb7P","\u1457":"\xb7U","\u143a":"\xb7V","\u143c":"\xb7\u0245","\u14ae":"\xb7\u0393","\u140e":"\xb7\u0394","\u1459":"\xb7\u0548","\u140c":"\xb7\u1401","\u1410":"\xb7\u1404","\u1412":"\xb7\u1405","\u1414":"\xb7\u1406","\u1417":"\xb7\u140a","\u1419":"\xb7\u140b","\u143e":"\xb7\u1432","\u1442":"\xb7\u1434","\u1446":"\xb7\u1439","\u145b":"\xb7\u144f","\u1454":"\xb7\u1450","\u145d":"\xb7\u1450","\u145f":"\xb7\u1451","\u1461":"\xb7\u1455","\u1463":"\xb7\u1456","\u1474":"\xb7\u146b","\u1478":"\xb7\u146e","\u147c":"\xb7\u1470","\u1492":"\xb7\u1489","\u1494":"\xb7\u148b","\u1496":"\xb7\u148c","\u149a":"\xb7\u148e","\u149c":"\xb7\u1490","\u149e":"\xb7\u1491","\u14ac":"\xb7\u14a3","\u14b0":"\xb7\u14a6","\u14b2":"\xb7\u14a7","\u14b4":"\xb7\u14a8","\u14b8":"\xb7\u14ab","\u14c9":"\xb7\u14c0","\u18c6":"\xb7\u14c2","\u18c8":"\xb7\u14c3","\u18ca":"\xb7\u14c4","\u18cc":"\xb7\u14c5","\u14cb":"\xb7\u14c7","\u14cd":"\xb7\u14c8","\u14dc":"\xb7\u14d3","\u14de":"\xb7\u14d5","\u14e0":"\xb7\u14d6","\u14e2":"\xb7\u14d7","\u14e4":"\xb7\u14d8","\u14e6":"\xb7\u14da","\u14e8":"\xb7\u14db","\u14f6":"\xb7\u14ed","\u14f8":"\xb7\u14ef","\u14fa":"\xb7\u14f0","\u14fc":"\xb7\u14f1","\u14fe":"\xb7\u14f2","\u1500":"\xb7\u14f4","\u1502":"\xb7\u14f5","\u1517":"\xb7\u1510","\u1519":"\xb7\u1511","\u151b":"\xb7\u1512","\u151d":"\xb7\u1513","\u151f":"\xb7\u1514","\u1521":"\xb7\u1515","\u1523":"\xb7\u1516","\u1531":"\xb7\u1528","\u1533":"\xb7\u1529","\u1535":"\xb7\u152a","\u1537":"\xb7\u152b","\u1539":"\xb7\u152d","\u153b":"\xb7\u152e","\u18ce":"\xb7\u1543","\u18cf":"\xb7\u1546","\u18d0":"\xb7\u1547","\u18d1":"\xb7\u1548","\u18d2":"\xb7\u1549","\u18d3":"\xb7\u154b","\u154e":"\xb7\u154c","\u155b":"\xb7\u155a","\u1568":"\xb7\u1567","\u18b3":"\xb7\u18b1","\u18b6":"\xb7\u18b4","\u18b9":"\xb7\u18b8","\u18c2":"\xb7\u18c0","\ua830":"\u0964","\u0965":"\u0964\u0964","\u1c3c":"\u1c3b\u1c3b","\u104b":"\u104a\u104a","\u1aa9":"\u1aa8\u1aa8","\u1aab":"\u1aaa\u1aa8","\u1b5f":"\u1b5e\u1b5e","\ud802\ude57":"\ud802\ude56\ud802\ude56","\ud805\udc4c":"\ud805\udc4b\ud805\udc4b","\ud805\ude42":"\ud805\ude41\ud805\ude41","\ud807\udc42":"\ud807\udc41\ud807\udc41","\u1c7f":"\u1c7e\u1c7e","\u055d":"\'","\uff07":"\'","\u2018":"\'","\u2019":"\'","\u201b":"\'","\u2032":"\'","\u2035":"\'","\u055a":"\'","\u05f3":"\'","`":"\'","\u1fef":"\'","\uff40":"\'","\xb4":"\'","\u0384":"\'","\u1ffd":"\'","\u1fbd":"\'","\u1fbf":"\'","\u1ffe":"\'","\u02b9":"\'","\u0374":"\'","\u02c8":"\'","\u02ca":"\'","\u02cb":"\'","\u02f4":"\'","\u02bb":"\'","\u02bd":"\'","\u02bc":"\'","\u02be":"\'","\ua78c":"\'","\u05d9":"\'","\u07f4":"\'","\u07f5":"\'","\u144a":"\'","\u16cc":"\'","\ud81b\udf51":"\'","\ud81b\udf52":"\'","\u1cd3":"\'\'","\\"":"\'\'","\uff02":"\'\'","\u201c":"\'\'","\u201d":"\'\'","\u201f":"\'\'","\u2033":"\'\'","\u2036":"\'\'","\u3003":"\'\'","\u05f4":"\'\'","\u02dd":"\'\'","\u02ba":"\'\'","\u02f6":"\'\'","\u02ee":"\'\'","\u05f2":"\'\'","\u2034":"\'\'\'","\u2037":"\'\'\'","\u2057":"\'\'\'\'","\u0181":"\'B","\u018a":"\'D","\u0149":"\'n","\u01a4":"\'P","\u01ac":"\'T","\u01b3":"\'Y","\uff3b":"(","\u2768":"(","\u2772":"(","\u3014":"(","\ufd3e":"(","\u2e28":"((","\u3220":"(\u30fc)","\u2475":"(2)","\u2487":"(2O)","\u2476":"(3)","\u2477":"(4)","\u2478":"(5)","\u2479":"(6)","\u247a":"(7)","\u247b":"(8)","\u247c":"(9)","\u249c":"(a)","\ud83c\udd10":"(A)","\u249d":"(b)","\ud83c\udd11":"(B)","\u249e":"(c)","\ud83c\udd12":"(C)","\u249f":"(d)","\ud83c\udd13":"(D)","\u24a0":"(e)","\ud83c\udd14":"(E)","\u24a1":"(f)","\ud83c\udd15":"(F)","\u24a2":"(g)","\ud83c\udd16":"(G)","\u24a3":"(h)","\ud83c\udd17":"(H)","\u24a4":"(i)","\u24a5":"(j)","\ud83c\udd19":"(J)","\u24a6":"(k)","\ud83c\udd1a":"(K)","\u2474":"(l)","\ud83c\udd18":"(l)","\u24a7":"(l)","\ud83c\udd1b":"(L)","\u247f":"(l2)","\u2480":"(l3)","\u2481":"(l4)","\u2482":"(l5)","\u2483":"(l6)","\u2484":"(l7)","\u2485":"(l8)","\u2486":"(l9)","\u247e":"(ll)","\u247d":"(lO)","\ud83c\udd1c":"(M)","\u24a9":"(n)","\ud83c\udd1d":"(N)","\u24aa":"(o)","\ud83c\udd1e":"(O)","\u24ab":"(p)","\ud83c\udd1f":"(P)","\u24ac":"(q)","\ud83c\udd20":"(Q)","\u24ad":"(r)","\ud83c\udd21":"(R)","\u24a8":"(rn)","\u24ae":"(s)","\ud83c\udd22":"(S)","\ud83c\udd2a":"(S)","\u24af":"(t)","\ud83c\udd23":"(T)","\u24b0":"(u)","\ud83c\udd24":"(U)","\u24b1":"(v)","\ud83c\udd25":"(V)","\u24b2":"(w)","\ud83c\udd26":"(W)","\u24b3":"(x)","\ud83c\udd27":"(X)","\u24b4":"(y)","\ud83c\udd28":"(Y)","\u24b5":"(z)","\ud83c\udd29":"(Z)","\u3200":"(\u1100)","\u320e":"(\uac00)","\u3201":"(\u1102)","\u320f":"(\ub098)","\u3202":"(\u1103)","\u3210":"(\ub2e4)","\u3203":"(\u1105)","\u3211":"(\ub77c)","\u3204":"(\u1106)","\u3212":"(\ub9c8)","\u3205":"(\u1107)","\u3213":"(\ubc14)","\u3206":"(\u1109)","\u3214":"(\uc0ac)","\u3207":"(\u110b)","\u3215":"(\uc544)","\u321d":"(\uc624\uc804)","\u321e":"(\uc624\ud6c4)","\u3208":"(\u110c)","\u3216":"(\uc790)","\u321c":"(\uc8fc)","\u3209":"(\u110e)","\u3217":"(\ucc28)","\u320a":"(\u110f)","\u3218":"(\uce74)","\u320b":"(\u1110)","\u3219":"(\ud0c0)","\u320c":"(\u1111)","\u321a":"(\ud30c)","\u320d":"(\u1112)","\u321b":"(\ud558)","\u3226":"(\u4e03)","\u3222":"(\u4e09)","\ud83c\ude41":"(\u4e09)","\u3228":"(\u4e5d)","\u3221":"(\u4e8c)","\ud83c\ude42":"(\u4e8c)","\u3224":"(\u4e94)","\u3239":"(\u4ee3)","\u323d":"(\u4f01)","\u3241":"(\u4f11)","\u3227":"(\u516b)","\u3225":"(\u516d)","\u3238":"(\u52b4)","\ud83c\ude47":"(\u52dd)","\u3229":"(\u5341)","\u323f":"(\u5354)","\u3234":"(\u540d)","\u323a":"(\u547c)","\u3223":"(\u56db)","\u322f":"(\u571f)","\u323b":"(\u5b66)","\ud83c\ude43":"(\u5b89)","\ud83c\ude45":"(\u6253)","\ud83c\ude48":"(\u6557)","\u3230":"(\u65e5)","\u322a":"(\u6708)","\u3232":"(\u6709)","\u322d":"(\u6728)","\ud83c\ude40":"(\u672c)","\u3231":"(\u682a)","\u322c":"(\u6c34)","\u322b":"(\u706b)","\ud83c\ude44":"(\u70b9)","\u3235":"(\u7279)","\ud83c\ude46":"(\u76d7)","\u323c":"(\u76e3)","\u3233":"(\u793e)","\u3237":"(\u795d)","\u3240":"(\u796d)","\u3242":"(\u81ea)","\u3243":"(\u81f3)","\u3236":"(\u8ca1)","\u323e":"(\u8cc7)","\u322e":"(\u91d1)","\uff3d":")","\u2769":")","\u2773":")","\u3015":")","\ufd3f":")","\u2e29":"))","\u2774":"{","\ud834\udd14":"{","\u2775":"}","\u301a":"\u27e6","\u301b":"\u27e7","\u27e8":"\u276c","\u2329":"\u276c","\u3008":"\u276c","\u31db":"\u276c","\u304f":"\u276c","\ud847\udfe8":"\u276c","\u27e9":"\u276d","\u232a":"\u276d","\u3009":"\u276d","\uff3e":"\ufe3f","\u2e3f":"\xb6","\u204e":"*","\u066d":"*","\u2217":"*","\ud800\udf1f":"*","\u1735":"/","\u2041":"/","\u2215":"/","\u2044":"/","\u2571":"/","\u27cb":"/","\u29f8":"/","\ud834\ude3a":"/","\u31d3":"/","\u3033":"/","\u2cc6":"/","\u30ce":"/","\u4e3f":"/","\u2f03":"/","\u29f6":"/\u0304","\u2afd":"//","\u2afb":"///","\uff3c":"\\\\","\ufe68":"\\\\","\u2216":"\\\\","\u27cd":"\\\\","\u29f5":"\\\\","\u29f9":"\\\\","\ud834\ude0f":"\\\\","\ud834\ude3b":"\\\\","\u31d4":"\\\\","\u4e36":"\\\\","\u2f02":"\\\\","\u2cf9":"\\\\\\\\","\u244a":"\\\\\\\\","\u27c8":"\\\\\u1455","\ua778":"&","\u0af0":"\u0970","\ud804\udcbb":"\u0970","\ud804\uddc7":"\u0970","\u26ac":"\u0970","\ud804\udddb":"\ua8fc","\u17d9":"\u0e4f","\u17d5":"\u0e5a","\u17da":"\u0e5b","\u0f0c":"\u0f0b","\u0f0e":"\u0f0d\u0f0d","\u02c4":"^","\u02c6":"^","\ua67e":"\u02c7","\u02d8":"\u02c7","\u203e":"\u02c9","\ufe49":"\u02c9","\ufe4a":"\u02c9","\ufe4b":"\u02c9","\ufe4c":"\u02c9","\xaf":"\u02c9","\uffe3":"\u02c9","\u2594":"\u02c9","\u044a":"\u02c9b","\ua651":"\u02c9bi","\u0375":"\u02cf","\u02fb":"\u02ea","\ua716":"\u02ea","\ua714":"\u02eb","\u3002":"\u02f3","\u2e30":"\xb0","\u02da":"\xb0","\u2218":"\xb0","\u25cb":"\xb0","\u25e6":"\xb0","\u235c":"\xb0\u0332","\u2364":"\xb0\u0308","\u2103":"\xb0C","\u2109":"\xb0F","\u0bf5":"\u0bf3","\u0f1b":"\u0f1a\u0f1a","\u0f1f":"\u0f1a\u0f1d","\u0fce":"\u0f1d\u0f1a","\u0f1e":"\u0f1d\u0f1d","\u24b8":"\xa9","\u24c7":"\xae","\u24c5":"\u2117","\ud834\ude1b":"\u2144","\u2bec":"\u219e","\u2bed":"\u219f","\u2bee":"\u21a0","\u2bef":"\u21a1","\u21b5":"\u21b2","\u2965":"\u21c3\u21c2","\u296f":"\u21c3\u16da","\ud835\udedb":"\u2202","\ud835\udf15":"\u2202","\ud835\udf4f":"\u2202","\ud835\udf89":"\u2202","\ud835\udfc3":"\u2202","\ud83a\udccc":"\u2202","\ud83a\udccd":"\u2202\u0335","\xf0":"\u2202\u0335","\u2300":"\u2205","\ud835\udec1":"\u2207","\ud835\udefb":"\u2207","\ud835\udf35":"\u2207","\ud835\udf6f":"\u2207","\ud835\udfa9":"\u2207","\ud806\udca8":"\u2207","\u2362":"\u2207\u0308","\u236b":"\u2207\u0334","\u2588":"\u220e","\u25a0":"\u220e","\u2a3f":"\u2210","\u16ed":"+","\u2795":"+","\ud800\ude9b":"+","\u2a23":"+\u0302","\u2a22":"+\u030a","\u2a24":"+\u0303","\u2214":"+\u0307","\u2a25":"+\u0323","\u2a26":"+\u0330","\u2a27":"+\u2082","\u2797":"\xf7","\u2039":"<","\u276e":"<","\u02c2":"<","\ud834\ude36":"<","\u1438":"<","\u16b2":"<","\u22d6":"<\xb7","\u2cb4":"<\xb7","\u1445":"<\xb7","\u226a":"<<","\u22d8":"<<<","\u1400":"=","\u2e40":"=","\u30a0":"=","\ua4ff":"=","\u225a":"=\u0306","\u2259":"=\u0302","\u2257":"=\u030a","\u2250":"=\u0307","\u2251":"=\u0307\u0323","\u2a6e":"=\u20f0","\u2a75":"==","\u2a76":"===","\u225e":"=\u036b","\u203a":">","\u276f":">","\u02c3":">","\ud834\ude37":">","\u1433":">","\ud81b\udf3f":">","\u1441":">\xb7","\u2aa5":"><","\u226b":">>","\u2a20":">>","\u22d9":">>>","\u2053":"~","\u02dc":"~","\u1fc0":"~","\u223c":"~","\u2368":"~\u0308","\u2e1e":"~\u0307","\u2a6a":"~\u0307","\u2e1f":"~\u0323","\ud83a\udcc8":"\u2220","\u22c0":"\u2227","\u222f":"\u222e\u222e","\u2230":"\u222e\u222e\u222e","\u2e2b":"\u2234","\u2e2a":"\u2235","\u2e2c":"\u2237","\ud804\uddde":"\u2248","\u264e":"\u224f","\ud83d\udf5e":"\u224f","\u2263":"\u2261","\u2a03":"\u228d","\u2a04":"\u228e","\ud834\ude38":"\u228f","\ud834\ude39":"\u2290","\u2a05":"\u2293","\u2a06":"\u2294","\u2a02":"\u2297","\u235f":"\u229b","\ud83d\udf71":"\u22a0","\ud83d\udf55":"\u22a1","\u25c1":"\u22b2","\u25b7":"\u22b3","\u2363":"\u22c6\u0308","\ufe34":"\u2307","\u25e0":"\u2312","\u2a3d":"\u2319","\u2325":"\u2324","\u29c7":"\u233b","\u25ce":"\u233e","\u29be":"\u233e","\u29c5":"\u2342","\u29b0":"\u2349","\u23c3":"\u234b","\u23c2":"\u234e","\u23c1":"\u2355","\u23c6":"\u236d","\u2638":"\u2388","\ufe35":"\u23dc","\ufe36":"\u23dd","\ufe37":"\u23de","\ufe38":"\u23df","\ufe39":"\u23e0","\ufe3a":"\u23e1","\u25b1":"\u23e5","\u23fc":"\u23fb","\ufe31":"\u2502","\uff5c":"\u2502","\u2503":"\u2502","\u250f":"\u250c","\u2523":"\u251c","\u2590":"\u258c","\u2597":"\u2596","\u259d":"\u2598","\u2610":"\u25a1","\uffed":"\u25aa","\u25b8":"\u25b6","\u25ba":"\u25b6","\u2ce9":"\u2627","\ud83d\udf0a":"\u2629","\ud83c\udf12":"\u263d","\ud83c\udf19":"\u263d","\u23fe":"\u263e","\ud83c\udf18":"\u263e","\u29d9":"\u299a","\ud83d\udf3a":"\u29df","\u2a3e":"\u2a1f","\ud800\udda0":"\u2ce8","\u2669":"\ud834\udd58\ud834\udd65","\u266a":"\ud834\udd58\ud834\udd65\ud834\udd6e","\u24ea":"\ud83c\udd0d","\u21ba":"\ud83c\udd0e","\u02d9":"\u0971","\u0d4e":"\u0971","\uff0d":"\u30fc","\u2014":"\u30fc","\u2015":"\u30fc","\u2500":"\u30fc","\u2501":"\u30fc","\u31d0":"\u30fc","\ua7f7":"\u30fc","\u1173":"\u30fc","\u3161":"\u30fc","\u4e00":"\u30fc","\u2f00":"\u30fc","\u1196":"\u30fc\u30fc","\ud7b9":"\u30fc\u1161","\ud7ba":"\u30fc\u1165","\ud7bb":"\u30fc\u1165\u4e28","\ud7bc":"\u30fc\u1169","\u1195":"\u30fc\u116e","\u1174":"\u30fc\u4e28","\u3162":"\u30fc\u4e28","\u1197":"\u30fc\u4e28\u116e","\ud83c\udd0f":"$\u20e0","\u20a4":"\xa3","\u3012":"\u20b8","\u3036":"\u20b8","\u1b5c":"\u1b50","\ua9c6":"\ua9d0","\ud805\udcd1":"\u09e7","\u0ce7":"\u0c67","\u1065":"\u1041","\u2460":"\u2780","\u2469":"\u2789","\u23e8":"\u2081\u2080","\ud835\udfd0":"2","\ud835\udfda":"2","\ud835\udfe4":"2","\ud835\udfee":"2","\ud835\udff8":"2","\ud83e\udff2":"2","\ua75a":"2","\u01a7":"2","\u03e8":"2","\ua644":"2","\u14bf":"2","\ua6ef":"2","\ua9cf":"\u0662","\u06f2":"\u0662","\u0ae8":"\u0968","\ud805\udcd2":"\u09e8","\u0ce8":"\u0c68","\u2461":"\u2781","\u01bb":"2\u0335","\ud83c\udd03":"2,","\u2489":"2.","\u33f5":"22\u65e5","\u336e":"22\u70b9","\u33f6":"23\u65e5","\u336f":"23\u70b9","\u33f7":"24\u65e5","\u3370":"24\u70b9","\u33f8":"25\u65e5","\u33f9":"26\u65e5","\u33fa":"27\u65e5","\u33fb":"28\u65e5","\u33fc":"29\u65e5","\u33f4":"2l\u65e5","\u336d":"2l\u70b9","\u249b":"2O.","\u33f3":"2O\u65e5","\u336c":"2O\u70b9","\u0de9":"\u0de8\u0dcf","\u0def":"\u0de8\u0dd3","\u33e1":"2\u65e5","\u32c1":"2\u6708","\u335a":"2\u70b9","\ud834\ude06":"3","\ud835\udfd1":"3","\ud835\udfdb":"3","\ud835\udfe5":"3","\ud835\udfef":"3","\ud835\udff9":"3","\ud83e\udff3":"3","\ua7ab":"3","\u021c":"3","\u01b7":"3","\ua76a":"3","\u2ccc":"3","\u0417":"3","\u04e0":"3","\ud81b\udf3b":"3","\ud806\udcca":"3","\u06f3":"\u0663","\ud83a\udcc9":"\u0663","\u0ae9":"\u0969","\u2462":"\u2782","\u0498":"3\u0326","\ud83c\udd04":"3,","\u248a":"3.","\u33fe":"3l\u65e5","\u33fd":"3O\u65e5","\u33e2":"3\u65e5","\u32c2":"3\u6708","\u335b":"3\u70b9","\ud835\udfd2":"4","\ud835\udfdc":"4","\ud835\udfe6":"4","\ud835\udff0":"4","\ud835\udffa":"4","\ud83e\udff4":"4","\u13ce":"4","\ud806\udcaf":"4","\u06f4":"\u0664","\u0aea":"\u096a","\u2463":"\u2783","\ud83c\udd05":"4,","\u248b":"4.","\u1530":"4\xb7","\u33e3":"4\u65e5","\u32c3":"4\u6708","\u335c":"4\u70b9","\ud835\udfd3":"5","\ud835\udfdd":"5","\ud835\udfe7":"5","\ud835\udff1":"5","\ud835\udffb":"5","\ud83e\udff5":"5","\u01bc":"5","\ud806\udcbb":"5","\u2464":"\u2784","\ud83c\udd06":"5,","\u248c":"5.","\u33e4":"5\u65e5","\u32c4":"5\u6708","\u335d":"5\u70b9","\ud835\udfd4":"6","\ud835\udfde":"6","\ud835\udfe8":"6","\ud835\udff2":"6","\ud835\udffc":"6","\ud83e\udff6":"6","\u2cd2":"6","\u0431":"6","\u13ee":"6","\ud806\udcd5":"6","\u06f6":"\u0666","\ud805\udcd6":"\u09ec","\u2465":"\u2785","\ud83c\udd07":"6,","\u248d":"6.","\u33e5":"6\u65e5","\u32c5":"6\u6708","\u335e":"6\u70b9","\ud834\ude12":"7","\ud835\udfd5":"7","\ud835\udfdf":"7","\ud835\udfe9":"7","\ud835\udff3":"7","\ud835\udffd":"7","\ud83e\udff7":"7","\ud801\udcd2":"7","\ud806\udcc6":"7","\u2466":"\u2786","\ud83c\udd08":"7,","\u248e":"7.","\u33e6":"7\u65e5","\u32c6":"7\u6708","\u335f":"7\u70b9","\u0b03":"8","\u09ea":"8","\u0a6a":"8","\ud83a\udccb":"8","\ud835\udfd6":"8","\ud835\udfe0":"8","\ud835\udfea":"8","\ud835\udff4":"8","\ud835\udffe":"8","\ud83e\udff8":"8","\u0223":"8","\u0222":"8","\ud800\udf1a":"8","\u0aee":"\u096e","\u2467":"\u2787","\ud83c\udd09":"8,","\u248f":"8.","\u33e7":"8\u65e5","\u32c7":"8\u6708","\u3360":"8\u70b9","\u0a67":"9","\u0b68":"9","\u09ed":"9","\u0d6d":"9","\ud835\udfd7":"9","\ud835\udfe1":"9","\ud835\udfeb":"9","\ud835\udff5":"9","\ud835\udfff":"9","\ud83e\udff9":"9","\ua76e":"9","\u2cca":"9","\ud806\udccc":"9","\ud806\udcac":"9","\ud806\udcd6":"9","\u0967":"\u0669","\ud806\udce4":"\u0669","\u06f9":"\u0669","\u0cef":"\u0c6f","\u2468":"\u2788","\ud83c\udd0a":"9,","\u2490":"9.","\u33e8":"9\u65e5","\u32c8":"9\u6708","\u3361":"9\u70b9","\u237a":"a","\uff41":"a","\ud835\udc1a":"a","\ud835\udc4e":"a","\ud835\udc82":"a","\ud835\udcb6":"a","\ud835\udcea":"a","\ud835\udd1e":"a","\ud835\udd52":"a","\ud835\udd86":"a","\ud835\uddba":"a","\ud835\uddee":"a","\ud835\ude22":"a","\ud835\ude56":"a","\ud835\ude8a":"a","\u0251":"a","\u03b1":"a","\ud835\udec2":"a","\ud835\udefc":"a","\ud835\udf36":"a","\ud835\udf70":"a","\ud835\udfaa":"a","\u0430":"a","\u2df6":"\u0363","\uff21":"A","\ud835\udc00":"A","\ud835\udc34":"A","\ud835\udc68":"A","\ud835\udc9c":"A","\ud835\udcd0":"A","\ud835\udd04":"A","\ud835\udd38":"A","\ud835\udd6c":"A","\ud835\udda0":"A","\ud835\uddd4":"A","\ud835\ude08":"A","\ud835\ude3c":"A","\ud835\ude70":"A","\u0391":"A","\ud835\udea8":"A","\ud835\udee2":"A","\ud835\udf1c":"A","\ud835\udf56":"A","\ud835\udf90":"A","\u0410":"A","\u13aa":"A","\u15c5":"A","\ua4ee":"A","\ud81b\udf40":"A","\ud800\udea0":"A","\u2376":"a\u0332","\u01ce":"\u0103","\u01cd":"\u0102","\u0227":"\xe5","\u0226":"\xc5","\u1e9a":"\u1ea3","\u2100":"a/c","\u2101":"a/s","\ua733":"aa","\ua732":"AA","\xe6":"ae","\u04d5":"ae","\xc6":"AE","\u04d4":"AE","\ua735":"ao","\ua734":"AO","\ud83d\udf07":"AR","\ua737":"au","\ua736":"AU","\ua739":"av","\ua73b":"av","\ua738":"AV","\ua73a":"AV","\ua73d":"ay","\ua73c":"AY","\uab7a":"\u1d00","\u2200":"\u2c6f","\ud834\ude17":"\u2c6f","\u15c4":"\u2c6f","\ua4ef":"\u2c6f","\ud801\udc1f":"\u2c70","\ud835\udc1b":"b","\ud835\udc4f":"b","\ud835\udc83":"b","\ud835\udcb7":"b","\ud835\udceb":"b","\ud835\udd1f":"b","\ud835\udd53":"b","\ud835\udd87":"b","\ud835\uddbb":"b","\ud835\uddef":"b","\ud835\ude23":"b","\ud835\ude57":"b","\ud835\ude8b":"b","\u0184":"b","\u042c":"b","\u13cf":"b","\u1472":"b","\u15af":"b","\uff22":"B","\u212c":"B","\ud835\udc01":"B","\ud835\udc35":"B","\ud835\udc69":"B","\ud835\udcd1":"B","\ud835\udd05":"B","\ud835\udd39":"B","\ud835\udd6d":"B","\ud835\udda1":"B","\ud835\uddd5":"B","\ud835\ude09":"B","\ud835\ude3d":"B","\ud835\ude71":"B","\ua7b4":"B","\u0392":"B","\ud835\udea9":"B","\ud835\udee3":"B","\ud835\udf1d":"B","\ud835\udf57":"B","\ud835\udf91":"B","\u0412":"B","\u13f4":"B","\u15f7":"B","\ua4d0":"B","\ud800\ude82":"B","\ud800\udea1":"B","\ud800\udf01":"B","\u0253":"b\u0314","\u1473":"b\u0307","\u0183":"b\u0304","\u0182":"b\u0304","\u0411":"b\u0304","\u0180":"b\u0335","\u048d":"b\u0335","\u048c":"b\u0335","\u0463":"b\u0335","\u0462":"b\u0335","\u147f":"b\xb7","\u1481":"b\u0307\xb7","\u1488":"b\'","\u042b":"bl","\u0432":"\u0299","\u13fc":"\u0299","\uff43":"c","\u217d":"c","\ud835\udc1c":"c","\ud835\udc50":"c","\ud835\udc84":"c","\ud835\udcb8":"c","\ud835\udcec":"c","\ud835\udd20":"c","\ud835\udd54":"c","\ud835\udd88":"c","\ud835\uddbc":"c","\ud835\uddf0":"c","\ud835\ude24":"c","\ud835\ude58":"c","\ud835\ude8c":"c","\u1d04":"c","\u03f2":"c","\u2ca5":"c","\u0441":"c","\uabaf":"c","\ud801\udc3d":"c","\u2ded":"\u0368","\ud83d\udf4c":"C","\ud806\udcf2":"C","\ud806\udce9":"C","\uff23":"C","\u216d":"C","\u2102":"C","\u212d":"C","\ud835\udc02":"C","\ud835\udc36":"C","\ud835\udc6a":"C","\ud835\udc9e":"C","\ud835\udcd2":"C","\ud835\udd6e":"C","\ud835\udda2":"C","\ud835\uddd6":"C","\ud835\ude0a":"C","\ud835\ude3e":"C","\ud835\ude72":"C","\u03f9":"C","\u2ca4":"C","\u0421":"C","\u13df":"C","\ua4da":"C","\ud800\udea2":"C","\ud800\udf02":"C","\ud801\udc15":"C","\ud801\udd1c":"C","\xa2":"c\u0338","\u023c":"c\u0338","\u20a1":"C\u20eb","\ud83c\udd6e":"C\u20e0","\xe7":"c\u0326","\u04ab":"c\u0326","\xc7":"C\u0326","\u04aa":"C\u0326","\u0187":"C\'","\u2105":"c/o","\u2106":"c/u","\ud83c\udd6d":"\u33c4\\t\u20dd","\u22f4":"\ua793","\u025b":"\ua793","\u03b5":"\ua793","\u03f5":"\ua793","\ud835\udec6":"\ua793","\ud835\udedc":"\ua793","\ud835\udf00":"\ua793","\ud835\udf16":"\ua793","\ud835\udf3a":"\ua793","\ud835\udf50":"\ua793","\ud835\udf74":"\ua793","\ud835\udf8a":"\ua793","\ud835\udfae":"\ua793","\ud835\udfc4":"\ua793","\u2c89":"\ua793","\u0454":"\ua793","\u0511":"\ua793","\uab9b":"\ua793","\ud806\udcce":"\ua793","\ud801\udc29":"\ua793","\u20ac":"\ua792","\u2c88":"\ua792","\u0404":"\ua792","\u2377":"\ua793\u0332","\u037d":"\ua73f","\u03ff":"\ua73e","\u217e":"d","\u2146":"d","\ud835\udc1d":"d","\ud835\udc51":"d","\ud835\udc85":"d","\ud835\udcb9":"d","\ud835\udced":"d","\ud835\udd21":"d","\ud835\udd55":"d","\ud835\udd89":"d","\ud835\uddbd":"d","\ud835\uddf1":"d","\ud835\ude25":"d","\ud835\ude59":"d","\ud835\ude8d":"d","\u0501":"d","\u13e7":"d","\u146f":"d","\ua4d2":"d","\u216e":"D","\u2145":"D","\ud835\udc03":"D","\ud835\udc37":"D","\ud835\udc6b":"D","\ud835\udc9f":"D","\ud835\udcd3":"D","\ud835\udd07":"D","\ud835\udd3b":"D","\ud835\udd6f":"D","\ud835\udda3":"D","\ud835\uddd7":"D","\ud835\ude0b":"D","\ud835\ude3f":"D","\ud835\ude73":"D","\u13a0":"D","\u15de":"D","\u15ea":"D","\ua4d3":"D","\u0257":"d\u0314","\u0256":"d\u0328","\u018c":"d\u0304","\u0111":"d\u0335","\u0110":"D\u0335","\xd0":"D\u0335","\u0189":"D\u0335","\u20ab":"d\u0335\u0331","\ua77a":"\ua779","\u147b":"d\xb7","\u1487":"d\'","\u02a4":"d\u021d","\u01f3":"dz","\u02a3":"dz","\u01f2":"Dz","\u01f1":"DZ","\u01c6":"d\u017e","\u01c5":"D\u017e","\u01c4":"D\u017d","\u02a5":"d\u0291","\uab70":"\u1d05","\u2e39":"\u1e9f","\u03b4":"\u1e9f","\ud835\udec5":"\u1e9f","\ud835\udeff":"\u1e9f","\ud835\udf39":"\u1e9f","\ud835\udf73":"\u1e9f","\ud835\udfad":"\u1e9f","\u056e":"\u1e9f","\u1577":"\u1e9f","\u212e":"e","\uff45":"e","\u212f":"e","\u2147":"e","\ud835\udc1e":"e","\ud835\udc52":"e","\ud835\udc86":"e","\ud835\udcee":"e","\ud835\udd22":"e","\ud835\udd56":"e","\ud835\udd8a":"e","\ud835\uddbe":"e","\ud835\uddf2":"e","\ud835\ude26":"e","\ud835\ude5a":"e","\ud835\ude8e":"e","\uab32":"e","\u0435":"e","\u04bd":"e","\u2df7":"\u0364","\u22ff":"E","\uff25":"E","\u2130":"E","\ud835\udc04":"E","\ud835\udc38":"E","\ud835\udc6c":"E","\ud835\udcd4":"E","\ud835\udd08":"E","\ud835\udd3c":"E","\ud835\udd70":"E","\ud835\udda4":"E","\ud835\uddd8":"E","\ud835\ude0c":"E","\ud835\ude40":"E","\ud835\ude74":"E","\u0395":"E","\ud835\udeac":"E","\ud835\udee6":"E","\ud835\udf20":"E","\ud835\udf5a":"E","\ud835\udf94":"E","\u0415":"E","\u2d39":"E","\u13ac":"E","\ua4f0":"E","\ud806\udca6":"E","\ud806\udcae":"E","\ud800\ude86":"E","\u011b":"\u0115","\u011a":"\u0114","\u0247":"e\u0338","\u0246":"E\u0338","\u04bf":"e\u0328","\uab7c":"\u1d07","\u0259":"\u01dd","\u04d9":"\u01dd","\u2203":"\u018e","\u2d3a":"\u018e","\ua4f1":"\u018e","\u025a":"\u01dd\u02de","\u1d14":"\u01ddo","\uab41":"\u01ddo\u0338","\uab42":"\u01ddo\u0335","\u04d8":"\u018f","\ud834\ude21":"\u0190","\u2107":"\u0190","\u0510":"\u0190","\u13cb":"\u0190","\ud81b\udf2d":"\u0190","\ud801\udc01":"\u0190","\u1d9f":"\u1d4b","\u1d08":"\u025c","\u0437":"\u025c","\u0499":"\u025c\u0326","\ud801\udc42":"\u025e","\ua79d":"\u029a","\ud801\udc2a":"\u029a","\ud835\udc1f":"f","\ud835\udc53":"f","\ud835\udc87":"f","\ud835\udcbb":"f","\ud835\udcef":"f","\ud835\udd23":"f","\ud835\udd57":"f","\ud835\udd8b":"f","\ud835\uddbf":"f","\ud835\uddf3":"f","\ud835\ude27":"f","\ud835\ude5b":"f","\ud835\ude8f":"f","\uab35":"f","\ua799":"f","\u017f":"f","\u1e9d":"f","\u0584":"f","\ud834\ude13":"F","\u2131":"F","\ud835\udc05":"F","\ud835\udc39":"F","\ud835\udc6d":"F","\ud835\udcd5":"F","\ud835\udd09":"F","\ud835\udd3d":"F","\ud835\udd71":"F","\ud835\udda5":"F","\ud835\uddd9":"F","\ud835\ude0d":"F","\ud835\ude41":"F","\ud835\ude75":"F","\ua798":"F","\u03dc":"F","\ud835\udfca":"F","\u15b4":"F","\ua4dd":"F","\ud806\udcc2":"F","\ud806\udca2":"F","\ud800\ude87":"F","\ud800\udea5":"F","\ud801\udd25":"F","\u0192":"f\u0326","\u0191":"F\u0326","\u1d6e":"f\u0334","\u213b":"FAX","\ufb00":"ff","\ufb03":"ffi","\ufb04":"ffl","\ufb01":"fi","\ufb02":"fl","\u02a9":"f\u014b","\u15b5":"\u2132","\ua4de":"\u2132","\ud834\ude30":"\ua7fb","\u15b7":"\ua7fb","\uff47":"g","\u210a":"g","\ud835\udc20":"g","\ud835\udc54":"g","\ud835\udc88":"g","\ud835\udcf0":"g","\ud835\udd24":"g","\ud835\udd58":"g","\ud835\udd8c":"g","\ud835\uddc0":"g","\ud835\uddf4":"g","\ud835\ude28":"g","\ud835\ude5c":"g","\ud835\ude90":"g","\u0261":"g","\u1d83":"g","\u018d":"g","\u0581":"g","\ud835\udc06":"G","\ud835\udc3a":"G","\ud835\udc6e":"G","\ud835\udca2":"G","\ud835\udcd6":"G","\ud835\udd0a":"G","\ud835\udd3e":"G","\ud835\udd72":"G","\ud835\udda6":"G","\ud835\uddda":"G","\ud835\ude0e":"G","\ud835\ude42":"G","\ud835\ude76":"G","\u050c":"G","\u13c0":"G","\u13f3":"G","\ua4d6":"G","\u1da2":"\u1d4d","\u0260":"g\u0314","\u01e7":"\u011f","\u01e6":"\u011e","\u01f5":"\u0123","\u01e5":"g\u0335","\u01e4":"G\u0335","\u0193":"G\'","\u050d":"\u0262","\uab90":"\u0262","\u13fb":"\u0262","\uff48":"h","\u210e":"h","\ud835\udc21":"h","\ud835\udc89":"h","\ud835\udcbd":"h","\ud835\udcf1":"h","\ud835\udd25":"h","\ud835\udd59":"h","\ud835\udd8d":"h","\ud835\uddc1":"h","\ud835\uddf5":"h","\ud835\ude29":"h","\ud835\ude5d":"h","\ud835\ude91":"h","\u04bb":"h","\u0570":"h","\u13c2":"h","\uff28":"H","\u210b":"H","\u210c":"H","\u210d":"H","\ud835\udc07":"H","\ud835\udc3b":"H","\ud835\udc6f":"H","\ud835\udcd7":"H","\ud835\udd73":"H","\ud835\udda7":"H","\ud835\udddb":"H","\ud835\ude0f":"H","\ud835\ude43":"H","\ud835\ude77":"H","\u0397":"H","\ud835\udeae":"H","\ud835\udee8":"H","\ud835\udf22":"H","\ud835\udf5c":"H","\ud835\udf96":"H","\u2c8e":"H","\u041d":"H","\u13bb":"H","\u157c":"H","\ua4e7":"H","\ud800\udecf":"H","\u1d78":"\u1d34","\u0266":"h\u0314","\ua695":"h\u0314","\u13f2":"h\u0314","\u2c67":"H\u0329","\u04a2":"H\u0329","\u0127":"h\u0335","\u210f":"h\u0335","\u045b":"h\u0335","\u0126":"H\u0335","\u04c9":"H\u0326","\u04c7":"H\u0326","\u043d":"\u029c","\uab8b":"\u029c","\u04a3":"\u029c\u0329","\u04ca":"\u029c\u0326","\u04c8":"\u029c\u0326","\u050a":"\u01f6","\uab80":"\u2c76","\u0370":"\u2c75","\u13a8":"\u2c75","\u13b0":"\u2c75","\ua6b1":"\u2c75","\ua795":"\ua727","\u02db":"i","\u2373":"i","\uff49":"i","\u2170":"i","\u2139":"i","\u2148":"i","\ud835\udc22":"i","\ud835\udc56":"i","\ud835\udc8a":"i","\ud835\udcbe":"i","\ud835\udcf2":"i","\ud835\udd26":"i","\ud835\udd5a":"i","\ud835\udd8e":"i","\ud835\uddc2":"i","\ud835\uddf6":"i","\ud835\ude2a":"i","\ud835\ude5e":"i","\ud835\ude92":"i","\u0131":"i","\ud835\udea4":"i","\u026a":"i","\u0269":"i","\u03b9":"i","\u1fbe":"i","\u037a":"i","\ud835\udeca":"i","\ud835\udf04":"i","\ud835\udf3e":"i","\ud835\udf78":"i","\ud835\udfb2":"i","\u0456":"i","\ua647":"i","\u04cf":"i","\uab75":"i","\u13a5":"i","\ud806\udcc3":"i","\u24db":"\u24be","\u2378":"i\u0332","\u01d0":"\u012d","\u01cf":"\u012c","\u0268":"i\u0335","\u1d7b":"i\u0335","\u1d7c":"i\u0335","\u2171":"ii","\u2172":"iii","\u0133":"ij","\u2173":"iv","\u2178":"ix","\uff4a":"j","\u2149":"j","\ud835\udc23":"j","\ud835\udc57":"j","\ud835\udc8b":"j","\ud835\udcbf":"j","\ud835\udcf3":"j","\ud835\udd27":"j","\ud835\udd5b":"j","\ud835\udd8f":"j","\ud835\uddc3":"j","\ud835\uddf7":"j","\ud835\ude2b":"j","\ud835\ude5f":"j","\ud835\ude93":"j","\u03f3":"j","\u0458":"j","\uff2a":"J","\ud835\udc09":"J","\ud835\udc3d":"J","\ud835\udc71":"J","\ud835\udca5":"J","\ud835\udcd9":"J","\ud835\udd0d":"J","\ud835\udd41":"J","\ud835\udd75":"J","\ud835\udda9":"J","\ud835\udddd":"J","\ud835\ude11":"J","\ud835\ude45":"J","\ud835\ude79":"J","\ua7b2":"J","\u037f":"J","\u0408":"J","\u13ab":"J","\u148d":"J","\ua4d9":"J","\u0249":"j\u0335","\u0248":"J\u0335","\u1499":"J\xb7","\ud835\udea5":"\u0237","\u0575":"\u0237","\uab7b":"\u1d0a","\ud835\udc24":"k","\ud835\udc58":"k","\ud835\udc8c":"k","\ud835\udcc0":"k","\ud835\udcf4":"k","\ud835\udd28":"k","\ud835\udd5c":"k","\ud835\udd90":"k","\ud835\uddc4":"k","\ud835\uddf8":"k","\ud835\ude2c":"k","\ud835\ude60":"k","\ud835\ude94":"k","\u212a":"K","\uff2b":"K","\ud835\udc0a":"K","\ud835\udc3e":"K","\ud835\udc72":"K","\ud835\udca6":"K","\ud835\udcda":"K","\ud835\udd0e":"K","\ud835\udd42":"K","\ud835\udd76":"K","\ud835\uddaa":"K","\ud835\uddde":"K","\ud835\ude12":"K","\ud835\ude46":"K","\ud835\ude7a":"K","\u039a":"K","\ud835\udeb1":"K","\ud835\udeeb":"K","\ud835\udf25":"K","\ud835\udf5f":"K","\ud835\udf99":"K","\u2c94":"K","\u041a":"K","\u13e6":"K","\u16d5":"K","\ua4d7":"K","\ud801\udd18":"K","\u0199":"k\u0314","\u2c69":"K\u0329","\u049a":"K\u0329","\u20ad":"K\u0335","\ua740":"K\u0335","\u049e":"K\u0335","\u0198":"K\'","\u05c0":"l","|":"l","\u2223":"l","\u23fd":"l","\uffe8":"l","\u0661":"l","\u06f1":"l","\ud800\udf20":"l","\ud83a\udcc7":"l","\ud835\udfcf":"l","\ud835\udfd9":"l","\ud835\udfe3":"l","\ud835\udfed":"l","\ud835\udff7":"l","\ud83e\udff1":"l","I":"l","\uff29":"l","\u2160":"l","\u2110":"l","\u2111":"l","\ud835\udc08":"l","\ud835\udc3c":"l","\ud835\udc70":"l","\ud835\udcd8":"l","\ud835\udd40":"l","\ud835\udd74":"l","\ud835\udda8":"l","\ud835\udddc":"l","\ud835\ude10":"l","\ud835\ude44":"l","\ud835\ude78":"l","\u0196":"l","\uff4c":"l","\u217c":"l","\u2113":"l","\ud835\udc25":"l","\ud835\udc59":"l","\ud835\udc8d":"l","\ud835\udcc1":"l","\ud835\udcf5":"l","\ud835\udd29":"l","\ud835\udd5d":"l","\ud835\udd91":"l","\ud835\uddc5":"l","\ud835\uddf9":"l","\ud835\ude2d":"l","\ud835\ude61":"l","\ud835\ude95":"l","\u01c0":"l","\u0399":"l","\ud835\udeb0":"l","\ud835\udeea":"l","\ud835\udf24":"l","\ud835\udf5e":"l","\ud835\udf98":"l","\u2c92":"l","\u0406":"l","\u04c0":"l","\u05d5":"l","\u05df":"l","\u0627":"l","\ud83b\ude00":"l","\ud83b\ude80":"l","\ufe8e":"l","\ufe8d":"l","\u07ca":"l","\u2d4f":"l","\u16c1":"l","\ua4f2":"l","\ud81b\udf28":"l","\ud800\ude8a":"l","\ud800\udf09":"l","\ud834\ude2a":"L","\u216c":"L","\u2112":"L","\ud835\udc0b":"L","\ud835\udc3f":"L","\ud835\udc73":"L","\ud835\udcdb":"L","\ud835\udd0f":"L","\ud835\udd43":"L","\ud835\udd77":"L","\ud835\uddab":"L","\ud835\udddf":"L","\ud835\ude13":"L","\ud835\ude47":"L","\ud835\ude7b":"L","\u2cd0":"L","\u13de":"L","\u14aa":"L","\ua4e1":"L","\ud81b\udf16":"L","\ud806\udca3":"L","\ud806\udcb2":"L","\ud801\udc1b":"L","\ud801\udd26":"L","\ufd3c":"l\u030b","\ufd3d":"l\u030b","\u0142":"l\u0338","\u0141":"L\u0338","\u026d":"l\u0328","\u0197":"l\u0335","\u019a":"l\u0335","\u026b":"l\u0334","\u0625":"l\u0655","\ufe88":"l\u0655","\ufe87":"l\u0655","\u0673":"l\u0655","\u0140":"l\xb7","\u013f":"l\xb7","\u14b7":"l\xb7","\ud83c\udd02":"l,","\u2488":"l.","\u05f1":"l\'","\u2493":"l2.","\u33eb":"l2\u65e5","\u32cb":"l2\u6708","\u3364":"l2\u70b9","\u2494":"l3.","\u33ec":"l3\u65e5","\u3365":"l3\u70b9","\u2495":"l4.","\u33ed":"l4\u65e5","\u3366":"l4\u70b9","\u2496":"l5.","\u33ee":"l5\u65e5","\u3367":"l5\u70b9","\u2497":"l6.","\u33ef":"l6\u65e5","\u3368":"l6\u70b9","\u2498":"l7.","\u33f0":"l7\u65e5","\u3369":"l7\u70b9","\u2499":"l8.","\u33f1":"l8\u65e5","\u336a":"l8\u70b9","\u249a":"l9.","\u33f2":"l9\u65e5","\u336b":"l9\u70b9","\u01c9":"lj","\u0132":"lJ","\u01c8":"Lj","\u01c7":"LJ","\u2016":"ll","\u2225":"ll","\u2161":"ll","\u01c1":"ll","\u05f0":"ll","\ud800\udd99":"l\u0335l\u0335","\u2492":"ll.","\u2162":"lll","\ud800\udd98":"l\u0335l\u0335S\u0335","\u33ea":"ll\u65e5","\u32ca":"ll\u6708","\u3363":"ll\u70b9","\u042e":"lO","\u2491":"lO.","\u33e9":"lO\u65e5","\u32c9":"lO\u6708","\u3362":"lO\u70b9","\u02aa":"ls","\u20b6":"lt","\u2163":"lV","\u2168":"lX","\u026e":"l\u021d","\u02ab":"lz","\u0623":"l\u0674","\ufe84":"l\u0674","\ufe83":"l\u0674","\u0672":"l\u0674","\u0675":"l\u0674","\ufdf3":"l\u0643\u0628\u0631","\ufdf2":"l\u0644\u0644\u0651\u0670o","\u33e0":"l\u65e5","\u32c0":"l\u6708","\u3359":"l\u70b9","\u2cd1":"\u029f","\uabae":"\u029f","\ud801\udc43":"\u029f","\uff2d":"M","\u216f":"M","\u2133":"M","\ud835\udc0c":"M","\ud835\udc40":"M","\ud835\udc74":"M","\ud835\udcdc":"M","\ud835\udd10":"M","\ud835\udd44":"M","\ud835\udd78":"M","\ud835\uddac":"M","\ud835\udde0":"M","\ud835\ude14":"M","\ud835\ude48":"M","\ud835\ude7c":"M","\u039c":"M","\ud835\udeb3":"M","\ud835\udeed":"M","\ud835\udf27":"M","\ud835\udf61":"M","\ud835\udf9b":"M","\u03fa":"M","\u2c98":"M","\u041c":"M","\u13b7":"M","\u15f0":"M","\u16d6":"M","\ua4df":"M","\ud800\udeb0":"M","\ud800\udf11":"M","\u04cd":"M\u0326","\ud83d\udf6b":"MB","\u2de8":"\u1ddf","\ud835\udc27":"n","\ud835\udc5b":"n","\ud835\udc8f":"n","\ud835\udcc3":"n","\ud835\udcf7":"n","\ud835\udd2b":"n","\ud835\udd5f":"n","\ud835\udd93":"n","\ud835\uddc7":"n","\ud835\uddfb":"n","\ud835\ude2f":"n","\ud835\ude63":"n","\ud835\ude97":"n","\u0578":"n","\u057c":"n","\uff2e":"N","\u2115":"N","\ud835\udc0d":"N","\ud835\udc41":"N","\ud835\udc75":"N","\ud835\udca9":"N","\ud835\udcdd":"N","\ud835\udd11":"N","\ud835\udd79":"N","\ud835\uddad":"N","\ud835\udde1":"N","\ud835\ude15":"N","\ud835\ude49":"N","\ud835\ude7d":"N","\u039d":"N","\ud835\udeb4":"N","\ud835\udeee":"N","\ud835\udf28":"N","\ud835\udf62":"N","\ud835\udf9c":"N","\u2c9a":"N","\ua4e0":"N","\ud801\udd13":"N","\ud800\udd8e":"N\u030a","\u0273":"n\u0328","\u019e":"n\u0329","\u03b7":"n\u0329","\ud835\udec8":"n\u0329","\ud835\udf02":"n\u0329","\ud835\udf3c":"n\u0329","\ud835\udf76":"n\u0329","\ud835\udfb0":"n\u0329","\u019d":"N\u0326","\u1d70":"n\u0334","\u01cc":"nj","\u01cb":"Nj","\u01ca":"NJ","\u2116":"No","\u0377":"\u1d0e","\u0438":"\u1d0e","\ud801\udc4d":"\u1d0e","\u0146":"\u0272","\u0c02":"o","\u0c82":"o","\u0d02":"o","\u0d82":"o","\u0966":"o","\u0a66":"o","\u0ae6":"o","\u0be6":"o","\u0c66":"o","\u0ce6":"o","\u0d66":"o","\u0e50":"o","\u0ed0":"o","\u1040":"o","\u0665":"o","\u06f5":"o","\uff4f":"o","\u2134":"o","\ud835\udc28":"o","\ud835\udc5c":"o","\ud835\udc90":"o","\ud835\udcf8":"o","\ud835\udd2c":"o","\ud835\udd60":"o","\ud835\udd94":"o","\ud835\uddc8":"o","\ud835\uddfc":"o","\ud835\ude30":"o","\ud835\ude64":"o","\ud835\ude98":"o","\u1d0f":"o","\u1d11":"o","\uab3d":"o","\u03bf":"o","\ud835\uded0":"o","\ud835\udf0a":"o","\ud835\udf44":"o","\ud835\udf7e":"o","\ud835\udfb8":"o","\u03c3":"o","\ud835\uded4":"o","\ud835\udf0e":"o","\ud835\udf48":"o","\ud835\udf82":"o","\ud835\udfbc":"o","\u2c9f":"o","\u043e":"o","\u10ff":"o","\u0585":"o","\u05e1":"o","\u0647":"o","\ud83b\ude24":"o","\ud83b\ude64":"o","\ud83b\ude84":"o","\ufeeb":"o","\ufeec":"o","\ufeea":"o","\ufee9":"o","\u06be":"o","\ufbac":"o","\ufbad":"o","\ufbab":"o","\ufbaa":"o","\u06c1":"o","\ufba8":"o","\ufba9":"o","\ufba7":"o","\ufba6":"o","\u06d5":"o","\u0d20":"o","\u101d":"o","\ud801\udcea":"o","\ud806\udcc8":"o","\ud806\udcd7":"o","\ud801\udc2c":"o","\u07c0":"O","\u09e6":"O","\u0b66":"O","\u3007":"O","\ud805\udcd0":"O","\ud806\udce0":"O","\ud835\udfce":"O","\ud835\udfd8":"O","\ud835\udfe2":"O","\ud835\udfec":"O","\ud835\udff6":"O","\ud83e\udff0":"O","\uff2f":"O","\ud835\udc0e":"O","\ud835\udc42":"O","\ud835\udc76":"O","\ud835\udcaa":"O","\ud835\udcde":"O","\ud835\udd12":"O","\ud835\udd46":"O","\ud835\udd7a":"O","\ud835\uddae":"O","\ud835\udde2":"O","\ud835\ude16":"O","\ud835\ude4a":"O","\ud835\ude7e":"O","\u039f":"O","\ud835\udeb6":"O","\ud835\udef0":"O","\ud835\udf2a":"O","\ud835\udf64":"O","\ud835\udf9e":"O","\u2c9e":"O","\u041e":"O","\u0555":"O","\u2d54":"O","\u12d0":"O","\u0b20":"O","\ud801\udcc2":"O","\ua4f3":"O","\ud806\udcb5":"O","\ud800\ude92":"O","\ud800\udeab":"O","\ud801\udc04":"O","\ud801\udd16":"O","\u2070":"\xba","\u1d52":"\xba","\u01d2":"\u014f","\u01d1":"\u014e","\u06ff":"o\u0302","\u0150":"\xd6","\xf8":"o\u0338","\uab3e":"o\u0338","\xd8":"O\u0338","\u2d41":"O\u0338","\u01fe":"O\u0338\u0301","\u0275":"o\u0335","\ua74b":"o\u0335","\u04e9":"o\u0335","\u0473":"o\u0335","\uab8e":"o\u0335","\uabbb":"o\u0335","\u2296":"O\u0335","\u229d":"O\u0335","\u236c":"O\u0335","\ud834\ude1a":"O\u0335","\ud83d\udf14":"O\u0335","\u019f":"O\u0335","\ua74a":"O\u0335","\u03b8":"O\u0335","\u03d1":"O\u0335","\ud835\udec9":"O\u0335","\ud835\udedd":"O\u0335","\ud835\udf03":"O\u0335","\ud835\udf17":"O\u0335","\ud835\udf3d":"O\u0335","\ud835\udf51":"O\u0335","\ud835\udf77":"O\u0335","\ud835\udf8b":"O\u0335","\ud835\udfb1":"O\u0335","\ud835\udfc5":"O\u0335","\u0398":"O\u0335","\u03f4":"O\u0335","\ud835\udeaf":"O\u0335","\ud835\udeb9":"O\u0335","\ud835\udee9":"O\u0335","\ud835\udef3":"O\u0335","\ud835\udf23":"O\u0335","\ud835\udf2d":"O\u0335","\ud835\udf5d":"O\u0335","\ud835\udf67":"O\u0335","\ud835\udf97":"O\u0335","\ud835\udfa1":"O\u0335","\u04e8":"O\u0335","\u0472":"O\u0335","\u2d31":"O\u0335","\u13be":"O\u0335","\u13eb":"O\u0335","\uab74":"o\u031b","\ufcd9":"o\u0670","\ud83c\udd01":"O,","\ud83c\udd00":"O.","\u01a1":"o\'","\u01a0":"O\'","\u13a4":"O\'","%":"\xba/\u2080","\u066a":"\xba/\u2080","\u2052":"\xba/\u2080","\u2030":"\xba/\u2080\u2080","\u0609":"\xba/\u2080\u2080","\u2031":"\xba/\u2080\u2080\u2080","\u060a":"\xba/\u2080\u2080\u2080","\u0153":"oe","\u0152":"OE","\u0276":"o\u1d07","\u221e":"oo","\ua74f":"oo","\ua699":"oo","\ua74e":"OO","\ua698":"OO","\ufcd7":"o\u062c","\ufc51":"o\u062c","\ufcd8":"o\u0645","\ufc52":"o\u0645","\ufd93":"o\u0645\u062c","\ufd94":"o\u0645\u0645","\ufc53":"o\u0649","\ufc54":"o\u0649","\u0d5f":"o\u0d30o","\u1010":"o\u102c","\u3358":"O\u70b9","\u2184":"\u0254","\u1d10":"\u0254","\u037b":"\u0254","\ud801\udc4b":"\u0254","\u2183":"\u0186","\u03fd":"\u0186","\ua4db":"\u0186","\ud801\udc23":"\u0186","\uab3f":"\u0254\u0338","\uab62":"\u0254e","\ud801\udc3f":"\u0277","\u2374":"p","\uff50":"p","\ud835\udc29":"p","\ud835\udc5d":"p","\ud835\udc91":"p","\ud835\udcc5":"p","\ud835\udcf9":"p","\ud835\udd2d":"p","\ud835\udd61":"p","\ud835\udd95":"p","\ud835\uddc9":"p","\ud835\uddfd":"p","\ud835\ude31":"p","\ud835\ude65":"p","\ud835\ude99":"p","\u03c1":"p","\u03f1":"p","\ud835\uded2":"p","\ud835\udee0":"p","\ud835\udf0c":"p","\ud835\udf1a":"p","\ud835\udf46":"p","\ud835\udf54":"p","\ud835\udf80":"p","\ud835\udf8e":"p","\ud835\udfba":"p","\ud835\udfc8":"p","\u2ca3":"p","\u0440":"p","\uff30":"P","\u2119":"P","\ud835\udc0f":"P","\ud835\udc43":"P","\ud835\udc77":"P","\ud835\udcab":"P","\ud835\udcdf":"P","\ud835\udd13":"P","\ud835\udd7b":"P","\ud835\uddaf":"P","\ud835\udde3":"P","\ud835\ude17":"P","\ud835\ude4b":"P","\ud835\ude7f":"P","\u03a1":"P","\ud835\udeb8":"P","\ud835\udef2":"P","\ud835\udf2c":"P","\ud835\udf66":"P","\ud835\udfa0":"P","\u2ca2":"P","\u0420":"P","\u13e2":"P","\u146d":"P","\ua4d1":"P","\ud800\ude95":"P","\u01a5":"p\u0314","\u1d7d":"p\u0335","\u1477":"p\xb7","\u1486":"P\'","\u1d29":"\u1d18","\uabb2":"\u1d18","\u03c6":"\u0278","\u03d5":"\u0278","\ud835\uded7":"\u0278","\ud835\udedf":"\u0278","\ud835\udf11":"\u0278","\ud835\udf19":"\u0278","\ud835\udf4b":"\u0278","\ud835\udf53":"\u0278","\ud835\udf85":"\u0278","\ud835\udf8d":"\u0278","\ud835\udfbf":"\u0278","\ud835\udfc7":"\u0278","\u2cab":"\u0278","\u0444":"\u0278","\ud835\udc2a":"q","\ud835\udc5e":"q","\ud835\udc92":"q","\ud835\udcc6":"q","\ud835\udcfa":"q","\ud835\udd2e":"q","\ud835\udd62":"q","\ud835\udd96":"q","\ud835\uddca":"q","\ud835\uddfe":"q","\ud835\ude32":"q","\ud835\ude66":"q","\ud835\ude9a":"q","\u051b":"q","\u0563":"q","\u0566":"q","\u211a":"Q","\ud835\udc10":"Q","\ud835\udc44":"Q","\ud835\udc78":"Q","\ud835\udcac":"Q","\ud835\udce0":"Q","\ud835\udd14":"Q","\ud835\udd7c":"Q","\ud835\uddb0":"Q","\ud835\udde4":"Q","\ud835\ude18":"Q","\ud835\ude4c":"Q","\ud835\ude80":"Q","\u2d55":"Q","\u02a0":"q\u0314","\ud83d\udf00":"QE","\u1d90":"\u024b","\u1d0b":"\u0138","\u03ba":"\u0138","\u03f0":"\u0138","\ud835\udecb":"\u0138","\ud835\udede":"\u0138","\ud835\udf05":"\u0138","\ud835\udf18":"\u0138","\ud835\udf3f":"\u0138","\ud835\udf52":"\u0138","\ud835\udf79":"\u0138","\ud835\udf8c":"\u0138","\ud835\udfb3":"\u0138","\ud835\udfc6":"\u0138","\u2c95":"\u0138","\u043a":"\u0138","\uabb6":"\u0138","\u049b":"\u0138\u0329","\u049f":"\u0138\u0335","\ud835\udc2b":"r","\ud835\udc5f":"r","\ud835\udc93":"r","\ud835\udcc7":"r","\ud835\udcfb":"r","\ud835\udd2f":"r","\ud835\udd63":"r","\ud835\udd97":"r","\ud835\uddcb":"r","\ud835\uddff":"r","\ud835\ude33":"r","\ud835\ude67":"r","\ud835\ude9b":"r","\uab47":"r","\uab48":"r","\u1d26":"r","\u2c85":"r","\u0433":"r","\uab81":"r","\ud834\ude16":"R","\u211b":"R","\u211c":"R","\u211d":"R","\ud835\udc11":"R","\ud835\udc45":"R","\ud835\udc79":"R","\ud835\udce1":"R","\ud835\udd7d":"R","\ud835\uddb1":"R","\ud835\udde5":"R","\ud835\ude19":"R","\ud835\ude4d":"R","\ud835\ude81":"R","\u01a6":"R","\u13a1":"R","\u13d2":"R","\ud801\udcb4":"R","\u1587":"R","\ua4e3":"R","\ud81b\udf35":"R","\u027d":"r\u0328","\u027c":"r\u0329","\u024d":"r\u0335","\u0493":"r\u0335","\u1d72":"r\u0334","\u0491":"r\'","\ud806\udce3":"rn","m":"rn","\u217f":"rn","\ud835\udc26":"rn","\ud835\udc5a":"rn","\ud835\udc8e":"rn","\ud835\udcc2":"rn","\ud835\udcf6":"rn","\ud835\udd2a":"rn","\ud835\udd5e":"rn","\ud835\udd92":"rn","\ud835\uddc6":"rn","\ud835\uddfa":"rn","\ud835\ude2e":"rn","\ud835\ude62":"rn","\ud835\ude96":"rn","\ud805\udf00":"rn","\u20a5":"rn\u0338","\u0271":"rn\u0326","\u1d6f":"rn\u0334","\u20a8":"Rs","\uab71":"\u0280","\uaba2":"\u0280","\u044f":"\u1d19","\u1d73":"\u027e\u0334","\u2129":"\u027f","\uff53":"s","\ud835\udc2c":"s","\ud835\udc60":"s","\ud835\udc94":"s","\ud835\udcc8":"s","\ud835\udcfc":"s","\ud835\udd30":"s","\ud835\udd64":"s","\ud835\udd98":"s","\ud835\uddcc":"s","\ud835\ude00":"s","\ud835\ude34":"s","\ud835\ude68":"s","\ud835\ude9c":"s","\ua731":"s","\u01bd":"s","\u0455":"s","\uabaa":"s","\ud806\udcc1":"s","\ud801\udc48":"s","\uff33":"S","\ud835\udc12":"S","\ud835\udc46":"S","\ud835\udc7a":"S","\ud835\udcae":"S","\ud835\udce2":"S","\ud835\udd16":"S","\ud835\udd4a":"S","\ud835\udd7e":"S","\ud835\uddb2":"S","\ud835\udde6":"S","\ud835\ude1a":"S","\ud835\ude4e":"S","\ud835\ude82":"S","\u0405":"S","\u054f":"S","\u13d5":"S","\u13da":"S","\ua4e2":"S","\ud81b\udf3a":"S","\ud800\ude96":"S","\ud801\udc20":"S","\u0282":"s\u0328","\u1d74":"s\u0334","\ua7b5":"\xdf","\u03b2":"\xdf","\u03d0":"\xdf","\ud835\udec3":"\xdf","\ud835\udefd":"\xdf","\ud835\udf37":"\xdf","\ud835\udf71":"\xdf","\ud835\udfab":"\xdf","\u13f0":"\xdf","\ud83d\udf5c":"sss","\ufb06":"st","\u222b":"\u0283","\uab4d":"\u0283","\u2211":"\u01a9","\u2140":"\u01a9","\u03a3":"\u01a9","\ud835\udeba":"\u01a9","\ud835\udef4":"\u01a9","\ud835\udf2e":"\u01a9","\ud835\udf68":"\u01a9","\ud835\udfa2":"\u01a9","\u2d49":"\u01a9","\u222c":"\u0283\u0283","\u222d":"\u0283\u0283\u0283","\u2a0c":"\u0283\u0283\u0283\u0283","\ud835\udc2d":"t","\ud835\udc61":"t","\ud835\udc95":"t","\ud835\udcc9":"t","\ud835\udcfd":"t","\ud835\udd31":"t","\ud835\udd65":"t","\ud835\udd99":"t","\ud835\uddcd":"t","\ud835\ude01":"t","\ud835\ude35":"t","\ud835\ude69":"t","\ud835\ude9d":"t","\u22a4":"T","\u27d9":"T","\ud83d\udf68":"T","\uff34":"T","\ud835\udc13":"T","\ud835\udc47":"T","\ud835\udc7b":"T","\ud835\udcaf":"T","\ud835\udce3":"T","\ud835\udd17":"T","\ud835\udd4b":"T","\ud835\udd7f":"T","\ud835\uddb3":"T","\ud835\udde7":"T","\ud835\ude1b":"T","\ud835\ude4f":"T","\ud835\ude83":"T","\u03a4":"T","\ud835\udebb":"T","\ud835\udef5":"T","\ud835\udf2f":"T","\ud835\udf69":"T","\ud835\udfa3":"T","\u2ca6":"T","\u0422":"T","\u13a2":"T","\ua4d4":"T","\ud81b\udf0a":"T","\ud806\udcbc":"T","\ud800\ude97":"T","\ud800\udeb1":"T","\ud800\udf15":"T","\u01ad":"t\u0314","\u2361":"T\u0308","\u023e":"T\u0338","\u021a":"\u0162","\u01ae":"T\u0328","\u04ac":"T\u0329","\u20ae":"T\u20eb","\u0167":"t\u0335","\u0166":"T\u0335","\u1d75":"t\u0334","\u10a0":"\ua786","\ua728":"T3","\u02a8":"t\u0255","\u2121":"TEL","\ua777":"tf","\u02a6":"ts","\u02a7":"t\u0283","\ua729":"t\u021d","\u03c4":"\u1d1b","\ud835\uded5":"\u1d1b","\ud835\udf0f":"\u1d1b","\ud835\udf49":"\u1d1b","\ud835\udf83":"\u1d1b","\ud835\udfbd":"\u1d1b","\u0442":"\u1d1b","\uab72":"\u1d1b","\u04ad":"\u1d1b\u0329","\u0163":"\u01ab","\u021b":"\u01ab","\u13bf":"\u01ab","\ud835\udc2e":"u","\ud835\udc62":"u","\ud835\udc96":"u","\ud835\udcca":"u","\ud835\udcfe":"u","\ud835\udd32":"u","\ud835\udd66":"u","\ud835\udd9a":"u","\ud835\uddce":"u","\ud835\ude02":"u","\ud835\ude36":"u","\ud835\ude6a":"u","\ud835\ude9e":"u","\ua79f":"u","\u1d1c":"u","\uab4e":"u","\uab52":"u","\u028b":"u","\u03c5":"u","\ud835\uded6":"u","\ud835\udf10":"u","\ud835\udf4a":"u","\ud835\udf84":"u","\ud835\udfbe":"u","\u057d":"u","\ud801\udcf6":"u","\ud806\udcd8":"u","\u222a":"U","\u22c3":"U","\ud835\udc14":"U","\ud835\udc48":"U","\ud835\udc7c":"U","\ud835\udcb0":"U","\ud835\udce4":"U","\ud835\udd18":"U","\ud835\udd4c":"U","\ud835\udd80":"U","\ud835\uddb4":"U","\ud835\udde8":"U","\ud835\ude1c":"U","\ud835\ude50":"U","\ud835\ude84":"U","\u054d":"U","\u1200":"U","\ud801\udcce":"U","\u144c":"U","\ua4f4":"U","\ud81b\udf42":"U","\ud806\udcb8":"U","\u01d4":"\u016d","\u01d3":"\u016c","\u1d7e":"u\u0335","\uab9c":"u\u0335","\u0244":"U\u0335","\u13cc":"U\u0335","\u1458":"U\xb7","\u1467":"U\'","\u1d6b":"ue","\uab63":"uo","\u1e43":"\uab51","\u057a":"\u0270","\u1223":"\u0270","\u2127":"\u01b1","\u162e":"\u01b1","\u1634":"\u01b1","\u1d7f":"\u028a\u0335","\u2228":"v","\u22c1":"v","\uff56":"v","\u2174":"v","\ud835\udc2f":"v","\ud835\udc63":"v","\ud835\udc97":"v","\ud835\udccb":"v","\ud835\udcff":"v","\ud835\udd33":"v","\ud835\udd67":"v","\ud835\udd9b":"v","\ud835\uddcf":"v","\ud835\ude03":"v","\ud835\ude37":"v","\ud835\ude6b":"v","\ud835\ude9f":"v","\u1d20":"v","\u03bd":"v","\ud835\udece":"v","\ud835\udf08":"v","\ud835\udf42":"v","\ud835\udf7c":"v","\ud835\udfb6":"v","\u0475":"v","\u05d8":"v","\ud805\udf06":"v","\uaba9":"v","\ud806\udcc0":"v","\ud834\ude0d":"V","\u0667":"V","\u06f7":"V","\u2164":"V","\ud835\udc15":"V","\ud835\udc49":"V","\ud835\udc7d":"V","\ud835\udcb1":"V","\ud835\udce5":"V","\ud835\udd19":"V","\ud835\udd4d":"V","\ud835\udd81":"V","\ud835\uddb5":"V","\ud835\udde9":"V","\ud835\ude1d":"V","\ud835\ude51":"V","\ud835\ude85":"V","\u0474":"V","\u2d38":"V","\u13d9":"V","\u142f":"V","\ua6df":"V","\ua4e6":"V","\ud81b\udf08":"V","\ud806\udca0":"V","\ud801\udd1d":"V","\ud800\udd97":"V\u0335","\u143b":"V\xb7","\ud83d\udf6c":"VB","\u2175":"vi","\u2176":"vii","\u2177":"viii","\u2165":"Vl","\u2166":"Vll","\u2167":"Vlll","\ud83d\udf08":"V\u1de4","\u1d27":"\u028c","\ud801\udcd8":"\u028c","\u0668":"\u0245","\u06f8":"\u0245","\u039b":"\u0245","\ud835\udeb2":"\u0245","\ud835\udeec":"\u0245","\ud835\udf26":"\u0245","\ud835\udf60":"\u0245","\ud835\udf9a":"\u0245","\u041b":"\u0245","\u2d37":"\u0245","\ud801\udcb0":"\u0245","\u1431":"\u0245","\ua6ce":"\u0245","\ua4e5":"\u0245","\ud81b\udf3d":"\u0245","\ud800\ude8d":"\u0245","\u04c5":"\u0245\u0326","\u143d":"\u0245\xb7","\u026f":"w","\ud835\udc30":"w","\ud835\udc64":"w","\ud835\udc98":"w","\ud835\udccc":"w","\ud835\udd00":"w","\ud835\udd34":"w","\ud835\udd68":"w","\ud835\udd9c":"w","\ud835\uddd0":"w","\ud835\ude04":"w","\ud835\ude38":"w","\ud835\ude6c":"w","\ud835\udea0":"w","\u1d21":"w","\u0461":"w","\u051d":"w","\u0561":"w","\ud805\udf0a":"w","\ud805\udf0e":"w","\ud805\udf0f":"w","\uab83":"w","\ud806\udcef":"W","\ud806\udce6":"W","\ud835\udc16":"W","\ud835\udc4a":"W","\ud835\udc7e":"W","\ud835\udcb2":"W","\ud835\udce6":"W","\ud835\udd1a":"W","\ud835\udd4e":"W","\ud835\udd82":"W","\ud835\uddb6":"W","\ud835\uddea":"W","\ud835\ude1e":"W","\ud835\ude52":"W","\ud835\ude86":"W","\u051c":"W","\u13b3":"W","\u13d4":"W","\ua4ea":"W","\u047d":"w\u0486\u0487","\ud805\udcc5":"w\u0307","\u20a9":"W\u0335","\ua761":"w\u0326","\u1d0d":"\u028d","\u043c":"\u028d","\uab87":"\u028d","\u04ce":"\u028d\u0326","\u166e":"x","\xd7":"x","\u292b":"x","\u292c":"x","\u2a2f":"x","\uff58":"x","\u2179":"x","\ud835\udc31":"x","\ud835\udc65":"x","\ud835\udc99":"x","\ud835\udccd":"x","\ud835\udd01":"x","\ud835\udd35":"x","\ud835\udd69":"x","\ud835\udd9d":"x","\ud835\uddd1":"x","\ud835\ude05":"x","\ud835\ude39":"x","\ud835\ude6d":"x","\ud835\udea1":"x","\u0445":"x","\u1541":"x","\u157d":"x","\u2def":"\u036f","\u166d":"X","\u2573":"X","\ud800\udf22":"X","\ud806\udcec":"X","\uff38":"X","\u2169":"X","\ud835\udc17":"X","\ud835\udc4b":"X","\ud835\udc7f":"X","\ud835\udcb3":"X","\ud835\udce7":"X","\ud835\udd1b":"X","\ud835\udd4f":"X","\ud835\udd83":"X","\ud835\uddb7":"X","\ud835\uddeb":"X","\ud835\ude1f":"X","\ud835\ude53":"X","\ud835\ude87":"X","\ua7b3":"X","\u03a7":"X","\ud835\udebe":"X","\ud835\udef8":"X","\ud835\udf32":"X","\ud835\udf6c":"X","\ud835\udfa6":"X","\u2cac":"X","\u0425":"X","\u2d5d":"X","\u16b7":"X","\ua4eb":"X","\ud800\ude90":"X","\ud800\udeb4":"X","\ud800\udf17":"X","\ud801\udd27":"X","\u2a30":"x\u0307","\u04b2":"X\u0329","\ud800\udd96":"X\u0335","\u217a":"xi","\u217b":"xii","\u216a":"Xl","\u216b":"Xll","\u0263":"y","\u1d8c":"y","\uff59":"y","\ud835\udc32":"y","\ud835\udc66":"y","\ud835\udc9a":"y","\ud835\udcce":"y","\ud835\udd02":"y","\ud835\udd36":"y","\ud835\udd6a":"y","\ud835\udd9e":"y","\ud835\uddd2":"y","\ud835\ude06":"y","\ud835\ude3a":"y","\ud835\ude6e":"y","\ud835\udea2":"y","\u028f":"y","\u1eff":"y","\uab5a":"y","\u03b3":"y","\u213d":"y","\ud835\udec4":"y","\ud835\udefe":"y","\ud835\udf38":"y","\ud835\udf72":"y","\ud835\udfac":"y","\u0443":"y","\u04af":"y","\u10e7":"y","\ud806\udcdc":"y","\uff39":"Y","\ud835\udc18":"Y","\ud835\udc4c":"Y","\ud835\udc80":"Y","\ud835\udcb4":"Y","\ud835\udce8":"Y","\ud835\udd1c":"Y","\ud835\udd50":"Y","\ud835\udd84":"Y","\ud835\uddb8":"Y","\ud835\uddec":"Y","\ud835\ude20":"Y","\ud835\ude54":"Y","\ud835\ude88":"Y","\u03a5":"Y","\u03d2":"Y","\ud835\udebc":"Y","\ud835\udef6":"Y","\ud835\udf30":"Y","\ud835\udf6a":"Y","\ud835\udfa4":"Y","\u2ca8":"Y","\u0423":"Y","\u04ae":"Y","\u13a9":"Y","\u13bd":"Y","\ua4ec":"Y","\ud81b\udf43":"Y","\ud806\udca4":"Y","\ud800\udeb2":"Y","\u01b4":"y\u0314","\u024f":"y\u0335","\u04b1":"y\u0335","\xa5":"Y\u0335","\u024e":"Y\u0335","\u04b0":"Y\u0335","\u0292":"\u021d","\ua76b":"\u021d","\u2ccd":"\u021d","\u04e1":"\u021d","\u10f3":"\u021d","\ud835\udc33":"z","\ud835\udc67":"z","\ud835\udc9b":"z","\ud835\udccf":"z","\ud835\udd03":"z","\ud835\udd37":"z","\ud835\udd6b":"z","\ud835\udd9f":"z","\ud835\uddd3":"z","\ud835\ude07":"z","\ud835\ude3b":"z","\ud835\ude6f":"z","\ud835\udea3":"z","\u1d22":"z","\uab93":"z","\ud806\udcc4":"z","\ud800\udef5":"Z","\ud806\udce5":"Z","\uff3a":"Z","\u2124":"Z","\u2128":"Z","\ud835\udc19":"Z","\ud835\udc4d":"Z","\ud835\udc81":"Z","\ud835\udcb5":"Z","\ud835\udce9":"Z","\ud835\udd85":"Z","\ud835\uddb9":"Z","\ud835\udded":"Z","\ud835\ude21":"Z","\ud835\ude55":"Z","\ud835\ude89":"Z","\u0396":"Z","\ud835\udead":"Z","\ud835\udee7":"Z","\ud835\udf21":"Z","\ud835\udf5b":"Z","\ud835\udf95":"Z","\u13c3":"Z","\ua4dc":"Z","\ud806\udca9":"Z","\u0290":"z\u0328","\u01b6":"z\u0335","\u01b5":"Z\u0335","\u0225":"z\u0326","\u0224":"Z\u0326","\u1d76":"z\u0334","\u01bf":"\xfe","\u03f8":"\xfe","\u03f7":"\xde","\ud801\udcc4":"\xde","\u2079":"\ua770","\u1d24":"\u01a8","\u03e9":"\u01a8","\ua645":"\u01a8","\u044c":"\u0185","\uab9f":"\u0185","\u044b":"\u0185i","\uab7e":"\u0242","\u02e4":"\u02c1","\ua6cd":"\u02a1","\u2299":"\u0298","\u2609":"\u0298","\u2a00":"\u0298","\ua668":"\u0298","\u2d59":"\u0298","\ud801\udcc3":"\u0298","\u213e":"\u0393","\ud835\udeaa":"\u0393","\ud835\udee4":"\u0393","\ud835\udf1e":"\u0393","\ud835\udf58":"\u0393","\ud835\udf92":"\u0393","\u2c84":"\u0393","\u0413":"\u0393","\u13b1":"\u0393","\u14a5":"\u0393","\ud81b\udf07":"\u0393","\u0492":"\u0393\u0335","\u14af":"\u0393\xb7","\u0490":"\u0393\'","\u2206":"\u0394","\u25b3":"\u0394","\ud83d\udf02":"\u0394","\ud835\udeab":"\u0394","\ud835\udee5":"\u0394","\ud835\udf1f":"\u0394","\ud835\udf59":"\u0394","\ud835\udf93":"\u0394","\u2c86":"\u0394","\u2d60":"\u0394","\u1403":"\u0394","\ud81b\udf1a":"\u0394","\ud800\ude85":"\u0394","\ud800\udea3":"\u0394","\u2359":"\u0394\u0332","\u140f":"\u0394\xb7","\u142c":"\u0394\u1420","\ud835\udfcb":"\u03dd","\ud835\udec7":"\u03b6","\ud835\udf01":"\u03b6","\ud835\udf3b":"\u03b6","\ud835\udf75":"\u03b6","\ud835\udfaf":"\u03b6","\u2ce4":"\u03d7","\ud835\udecc":"\u03bb","\ud835\udf06":"\u03bb","\ud835\udf40":"\u03bb","\ud835\udf7a":"\u03bb","\ud835\udfb4":"\u03bb","\u2c96":"\u03bb","\ud801\udcdb":"\u03bb","\xb5":"\u03bc","\ud835\udecd":"\u03bc","\ud835\udf07":"\u03bc","\ud835\udf41":"\u03bc","\ud835\udf7b":"\u03bc","\ud835\udfb5":"\u03bc","\ud835\udecf":"\u03be","\ud835\udf09":"\u03be","\ud835\udf43":"\u03be","\ud835\udf7d":"\u03be","\ud835\udfb7":"\u03be","\ud835\udeb5":"\u039e","\ud835\udeef":"\u039e","\ud835\udf29":"\u039e","\ud835\udf63":"\u039e","\ud835\udf9d":"\u039e","\u03d6":"\u03c0","\u213c":"\u03c0","\ud835\uded1":"\u03c0","\ud835\udee1":"\u03c0","\ud835\udf0b":"\u03c0","\ud835\udf1b":"\u03c0","\ud835\udf45":"\u03c0","\ud835\udf55":"\u03c0","\ud835\udf7f":"\u03c0","\ud835\udf8f":"\u03c0","\ud835\udfb9":"\u03c0","\ud835\udfc9":"\u03c0","\u1d28":"\u03c0","\u043f":"\u03c0","\u220f":"\u03a0","\u213f":"\u03a0","\ud835\udeb7":"\u03a0","\ud835\udef1":"\u03a0","\ud835\udf2b":"\u03a0","\ud835\udf65":"\u03a0","\ud835\udf9f":"\u03a0","\u2ca0":"\u03a0","\u041f":"\u03a0","\ua6db":"\u03a0","\ud800\udead":"\u03d8","\ud800\udf12":"\u03d8","\u03db":"\u03c2","\ud835\uded3":"\u03c2","\ud835\udf0d":"\u03c2","\ud835\udf47":"\u03c2","\ud835\udf81":"\u03c2","\ud835\udfbb":"\u03c2","\ud835\udebd":"\u03a6","\ud835\udef7":"\u03a6","\ud835\udf31":"\u03a6","\ud835\udf6b":"\u03a6","\ud835\udfa5":"\u03a6","\u2caa":"\u03a6","\u0424":"\u03a6","\u0553":"\u03a6","\u1240":"\u03a6","\u16f0":"\u03a6","\ud800\udeb3":"\u03a6","\uab53":"\u03c7","\uab55":"\u03c7","\ud835\uded8":"\u03c7","\ud835\udf12":"\u03c7","\ud835\udf4c":"\u03c7","\ud835\udf86":"\u03c7","\ud835\udfc0":"\u03c7","\u2cad":"\u03c7","\ud835\uded9":"\u03c8","\ud835\udf13":"\u03c8","\ud835\udf4d":"\u03c8","\ud835\udf87":"\u03c8","\ud835\udfc1":"\u03c8","\u0471":"\u03c8","\ud801\udcf9":"\u03c8","\ud835\udebf":"\u03a8","\ud835\udef9":"\u03a8","\ud835\udf33":"\u03a8","\ud835\udf6d":"\u03a8","\ud835\udfa7":"\u03a8","\u2cae":"\u03a8","\u0470":"\u03a8","\ud801\udcd1":"\u03a8","\u16d8":"\u03a8","\ud800\udeb5":"\u03a8","\u2375":"\u03c9","\ua7b7":"\u03c9","\ud835\udeda":"\u03c9","\ud835\udf14":"\u03c9","\ud835\udf4e":"\u03c9","\ud835\udf88":"\u03c9","\ud835\udfc2":"\u03c9","\u2cb1":"\u03c9","\ua64d":"\u03c9","\u2126":"\u03a9","\ud835\udec0":"\u03a9","\ud835\udefa":"\u03a9","\ud835\udf34":"\u03a9","\ud835\udf6e":"\u03a9","\ud835\udfa8":"\u03a9","\u162f":"\u03a9","\u1635":"\u03a9","\ud800\udeb6":"\u03a9","\u2379":"\u03c9\u0332","\u1f7d":"\u1ff4","\u2630":"\u2cb6","\u2cdc":"\u03ec","\u0497":"\u0436\u0329","\u0496":"\u0416\u0329","\ud834\ude0b":"\u0418","\u0376":"\u0418","\ua6a1":"\u0418","\ud801\udc25":"\u0418","\u0419":"\u040d","\u048a":"\u040d\u0326","\u045d":"\u0439","\u048b":"\u0439\u0326","\ud801\udcbc":"\u04c3","\u1d2b":"\u043b","\u04c6":"\u043b\u0326","\uab60":"\u0459","\ud801\udceb":"\ua669","\u1dee":"\u2dec","\ud801\udccd":"\u040b","\ud834\ude02":"\u04fe","\ud834\ude22":"\u0460","\u13c7":"\u0460","\u15ef":"\u0460","\u047c":"\u0460\u0486\u0487","\u18ed":"\u0460\xb7","\ua7b6":"\ua64c","\u04cc":"\u04b7","\u04cb":"\u04b6","\u04be":"\u04bc\u0328","\u2cbd":"\u0448","\u2cbc":"\u0428","\ua650":"\u042al","\u2108":"\u042d","\ud83d\udf01":"\ua658","\ud81b\udf1c":"\ua658","\ua992":"\u2c3f","\u0587":"\u0565\u0582","\u1294":"\u0571","\ufb14":"\u0574\u0565","\ufb15":"\u0574\u056b","\ufb17":"\u0574\u056d","\ufb13":"\u0574\u0576","\u2229":"\u0548","\u22c2":"\u0548","\ud834\ude45":"\u0548","\u1260":"\u0548","\u144e":"\u0548","\ua4f5":"\u0548","\u145a":"\u0548\xb7","\u1468":"\u0548\'","\ufb16":"\u057e\u0576","\u20bd":"\u0554","\u02d3":"\u0559","\u02bf":"\u0559","\u2135":"\u05d0","\ufb21":"\u05d0","\ufb2f":"\ufb2e","\ufb30":"\ufb2e","\ufb4f":"\u05d0\u05dc","\u2136":"\u05d1","\u2137":"\u05d2","\u2138":"\u05d3","\ufb22":"\u05d3","\ufb23":"\u05d4","\ufb39":"\ufb1d","\ufb24":"\u05db","\ufb25":"\u05dc","\ufb26":"\u05dd","\ufb20":"\u05e2","\ufb27":"\u05e8","\ufb2b":"\ufb2a","\ufb49":"\ufb2a","\ufb2d":"\ufb2c","\ufb28":"\u05ea","\ufe80":"\u0621","\u06fd":"\u0621\u0348","\ufe82":"\u0622","\ufe81":"\u0622","\ufb51":"\u0671","\ufb50":"\u0671","\ud83b\ude01":"\u0628","\ud83b\ude21":"\u0628","\ud83b\ude61":"\u0628","\ud83b\ude81":"\u0628","\ud83b\udea1":"\u0628","\ufe91":"\u0628","\ufe92":"\u0628","\ufe90":"\u0628","\ufe8f":"\u0628","\u0751":"\u0628\u06db","\u08b6":"\u0628\u06e2","\u08a1":"\u0628\u0654","\ufca0":"\u0628o","\ufce2":"\u0628o","\ufc9c":"\u0628\u062c","\ufc05":"\u0628\u062c","\ufc9d":"\u0628\u062d","\ufc06":"\u0628\u062d","\ufdc2":"\u0628\u062d\u0649","\ufc9e":"\u0628\u062e","\ufc07":"\u0628\u062e","\ufcd2":"\u0628\u062e","\ufc4b":"\u0628\u062e","\ufd9e":"\u0628\u062e\u0649","\ufc6a":"\u0628\u0631","\ufc6b":"\u0628\u0632","\ufc9f":"\u0628\u0645","\ufce1":"\u0628\u0645","\ufc6c":"\u0628\u0645","\ufc08":"\u0628\u0645","\ufc6d":"\u0628\u0646","\ufc6e":"\u0628\u0649","\ufc09":"\u0628\u0649","\ufc6f":"\u0628\u0649","\ufc0a":"\u0628\u0649","\ufb54":"\u067b","\ufb55":"\u067b","\ufb53":"\u067b","\ufb52":"\u067b","\u06d0":"\u067b","\ufbe6":"\u067b","\ufbe7":"\u067b","\ufbe5":"\u067b","\ufbe4":"\u067b","\ufb5c":"\u0680","\ufb5d":"\u0680","\ufb5b":"\u0680","\ufb5a":"\u0680","\u08a9":"\u0754","\u0767":"\u0754","\u2365":"\u0629","\xf6":"\u0629","\ufe94":"\u0629","\ufe93":"\u0629","\u06c3":"\u0629","\ud83b\ude15":"\u062a","\ud83b\ude35":"\u062a","\ud83b\ude75":"\u062a","\ud83b\ude95":"\u062a","\ud83b\udeb5":"\u062a","\ufe97":"\u062a","\ufe98":"\u062a","\ufe96":"\u062a","\ufe95":"\u062a","\ufca5":"\u062ao","\ufce4":"\u062ao","\ufca1":"\u062a\u062c","\ufc0b":"\u062a\u062c","\ufd50":"\u062a\u062c\u0645","\ufda0":"\u062a\u062c\u0649","\ufd9f":"\u062a\u062c\u0649","\ufca2":"\u062a\u062d","\ufc0c":"\u062a\u062d","\ufd52":"\u062a\u062d\u062c","\ufd51":"\u062a\u062d\u062c","\ufd53":"\u062a\u062d\u0645","\ufca3":"\u062a\u062e","\ufc0d":"\u062a\u062e","\ufd54":"\u062a\u062e\u0645","\ufda2":"\u062a\u062e\u0649","\ufda1":"\u062a\u062e\u0649","\ufc70":"\u062a\u0631","\ufc71":"\u062a\u0632","\ufca4":"\u062a\u0645","\ufce3":"\u062a\u0645","\ufc72":"\u062a\u0645","\ufc0e":"\u062a\u0645","\ufd55":"\u062a\u0645\u062c","\ufd56":"\u062a\u0645\u062d","\ufd57":"\u062a\u0645\u062e","\ufda4":"\u062a\u0645\u0649","\ufda3":"\u062a\u0645\u0649","\ufc73":"\u062a\u0646","\ufc74":"\u062a\u0649","\ufc0f":"\u062a\u0649","\ufc75":"\u062a\u0649","\ufc10":"\u062a\u0649","\ufb60":"\u067a","\ufb61":"\u067a","\ufb5f":"\u067a","\ufb5e":"\u067a","\ufb64":"\u067f","\ufb65":"\u067f","\ufb63":"\u067f","\ufb62":"\u067f","\ud83b\ude02":"\u062c","\ud83b\ude22":"\u062c","\ud83b\ude42":"\u062c","\ud83b\ude62":"\u062c","\ud83b\ude82":"\u062c","\ud83b\udea2":"\u062c","\ufe9f":"\u062c","\ufea0":"\u062c","\ufe9e":"\u062c","\ufe9d":"\u062c","\ufca7":"\u062c\u062d","\ufc15":"\u062c\u062d","\ufda6":"\u062c\u062d\u0649","\ufdbe":"\u062c\u062d\u0649","\ufdfb":"\u062c\u0644 \u062c\u0644l\u0644o","\ufca8":"\u062c\u0645","\ufc16":"\u062c\u0645","\ufd59":"\u062c\u0645\u062d","\ufd58":"\u062c\u0645\u062d","\ufda7":"\u062c\u0645\u0649","\ufda5":"\u062c\u0645\u0649","\ufd1d":"\u062c\u0649","\ufd01":"\u062c\u0649","\ufd1e":"\u062c\u0649","\ufd02":"\u062c\u0649","\ufb78":"\u0683","\ufb79":"\u0683","\ufb77":"\u0683","\ufb76":"\u0683","\ufb74":"\u0684","\ufb75":"\u0684","\ufb73":"\u0684","\ufb72":"\u0684","\ufb7c":"\u0686","\ufb7d":"\u0686","\ufb7b":"\u0686","\ufb7a":"\u0686","\ufb80":"\u0687","\ufb81":"\u0687","\ufb7f":"\u0687","\ufb7e":"\u0687","\ud83b\ude07":"\u062d","\ud83b\ude27":"\u062d","\ud83b\ude47":"\u062d","\ud83b\ude67":"\u062d","\ud83b\ude87":"\u062d","\ud83b\udea7":"\u062d","\ufea3":"\u062d","\ufea4":"\u062d","\ufea2":"\u062d","\ufea1":"\u062d","\u0685":"\u062d\u06db","\u0681":"\u062d\u0654","\u0772":"\u062d\u0654","\ufca9":"\u062d\u062c","\ufc17":"\u062d\u062c","\ufdbf":"\u062d\u062c\u0649","\ufcaa":"\u062d\u0645","\ufc18":"\u062d\u0645","\ufd5b":"\u062d\u0645\u0649","\ufd5a":"\u062d\u0645\u0649","\ufd1b":"\u062d\u0649","\ufcff":"\u062d\u0649","\ufd1c":"\u062d\u0649","\ufd00":"\u062d\u0649","\ud83b\ude17":"\u062e","\ud83b\ude37":"\u062e","\ud83b\ude57":"\u062e","\ud83b\ude77":"\u062e","\ud83b\ude97":"\u062e","\ud83b\udeb7":"\u062e","\ufea7":"\u062e","\ufea8":"\u062e","\ufea6":"\u062e","\ufea5":"\u062e","\ufcab":"\u062e\u062c","\ufc19":"\u062e\u062c","\ufc1a":"\u062e\u062d","\ufcac":"\u062e\u0645","\ufc1b":"\u062e\u0645","\ufd1f":"\u062e\u0649","\ufd03":"\u062e\u0649","\ufd20":"\u062e\u0649","\ufd04":"\u062e\u0649","\ud800\udee1":"\u062f","\ud83b\ude03":"\u062f","\ud83b\ude83":"\u062f","\ud83b\udea3":"\u062f","\ufeaa":"\u062f","\ufea9":"\u062f","\u0688":"\u062f\u0615","\ufb89":"\u062f\u0615","\ufb88":"\u062f\u0615","\u068e":"\u062f\u06db","\ufb87":"\u062f\u06db","\ufb86":"\u062f\u06db","\u06ee":"\u062f\u0302","\u08ae":"\u062f\u0324\u0323","\ud83b\ude18":"\u0630","\ud83b\ude98":"\u0630","\ud83b\udeb8":"\u0630","\ufeac":"\u0630","\ufeab":"\u0630","\ufc5b":"\u0630\u0670","\u068b":"\u068a\u0615","\ufb85":"\u068c","\ufb84":"\u068c","\ufb83":"\u068d","\ufb82":"\u068d","\ud83b\ude13":"\u0631","\ud83b\ude93":"\u0631","\ud83b\udeb3":"\u0631","\ufeae":"\u0631","\ufead":"\u0631","\u0691":"\u0631\u0615","\ufb8d":"\u0631\u0615","\ufb8c":"\u0631\u0615","\u0698":"\u0631\u06db","\ufb8b":"\u0631\u06db","\ufb8a":"\u0631\u06db","\u0692":"\u0631\u0306","\u08b9":"\u0631\u0306\u0307","\u06ef":"\u0631\u0302","\u076c":"\u0631\u0654","\ufc5c":"\u0631\u0670","\ufdf6":"\u0631\u0633\u0648\u0644","\ufdfc":"\u0631\u0649l\u0644","\ud83b\ude06":"\u0632","\ud83b\ude86":"\u0632","\ud83b\udea6":"\u0632","\ufeb0":"\u0632","\ufeaf":"\u0632","\u08b2":"\u0632\u0302","\u0771":"\u0697\u0615","\ud83b\ude0e":"\u0633","\ud83b\ude2e":"\u0633","\ud83b\ude4e":"\u0633","\ud83b\ude6e":"\u0633","\ud83b\ude8e":"\u0633","\ud83b\udeae":"\u0633","\ufeb3":"\u0633","\ufeb4":"\u0633","\ufeb2":"\u0633","\ufeb1":"\u0633","\u0634":"\u0633\u06db","\ud83b\ude14":"\u0633\u06db","\ud83b\ude34":"\u0633\u06db","\ud83b\ude54":"\u0633\u06db","\ud83b\ude74":"\u0633\u06db","\ud83b\ude94":"\u0633\u06db","\ud83b\udeb4":"\u0633\u06db","\ufeb7":"\u0633\u06db","\ufeb8":"\u0633\u06db","\ufeb6":"\u0633\u06db","\ufeb5":"\u0633\u06db","\u077e":"\u0633\u0302","\ufd31":"\u0633o","\ufce8":"\u0633o","\ufd32":"\u0633\u06dbo","\ufcea":"\u0633\u06dbo","\ufcad":"\u0633\u062c","\ufd34":"\u0633\u062c","\ufc1c":"\u0633\u062c","\ufd2d":"\u0633\u06db\u062c","\ufd37":"\u0633\u06db\u062c","\ufd25":"\u0633\u06db\u062c","\ufd09":"\u0633\u06db\u062c","\ufd5d":"\u0633\u062c\u062d","\ufd5e":"\u0633\u062c\u0649","\ufd69":"\u0633\u06db\u062c\u0649","\ufcae":"\u0633\u062d","\ufd35":"\u0633\u062d","\ufc1d":"\u0633\u062d","\ufd2e":"\u0633\u06db\u062d","\ufd38":"\u0633\u06db\u062d","\ufd26":"\u0633\u06db\u062d","\ufd0a":"\u0633\u06db\u062d","\ufd5c":"\u0633\u062d\u062c","\ufd68":"\u0633\u06db\u062d\u0645","\ufd67":"\u0633\u06db\u062d\u0645","\ufdaa":"\u0633\u06db\u062d\u0649","\ufcaf":"\u0633\u062e","\ufd36":"\u0633\u062e","\ufc1e":"\u0633\u062e","\ufd2f":"\u0633\u06db\u062e","\ufd39":"\u0633\u06db\u062e","\ufd27":"\u0633\u06db\u062e","\ufd0b":"\u0633\u06db\u062e","\ufda8":"\u0633\u062e\u0649","\ufdc6":"\u0633\u062e\u0649","\ufd2a":"\u0633\u0631","\ufd0e":"\u0633\u0631","\ufd29":"\u0633\u06db\u0631","\ufd0d":"\u0633\u06db\u0631","\ufcb0":"\u0633\u0645","\ufce7":"\u0633\u0645","\ufc1f":"\u0633\u0645","\ufd30":"\u0633\u06db\u0645","\ufce9":"\u0633\u06db\u0645","\ufd28":"\u0633\u06db\u0645","\ufd0c":"\u0633\u06db\u0645","\ufd61":"\u0633\u0645\u062c","\ufd60":"\u0633\u0645\u062d","\ufd5f":"\u0633\u0645\u062d","\ufd6b":"\u0633\u06db\u0645\u062e","\ufd6a":"\u0633\u06db\u0645\u062e","\ufd63":"\u0633\u0645\u0645","\ufd62":"\u0633\u0645\u0645","\ufd6d":"\u0633\u06db\u0645\u0645","\ufd6c":"\u0633\u06db\u0645\u0645","\ufd17":"\u0633\u0649","\ufcfb":"\u0633\u0649","\ufd18":"\u0633\u0649","\ufcfc":"\u0633\u0649","\ufd19":"\u0633\u06db\u0649","\ufcfd":"\u0633\u06db\u0649","\ufd1a":"\u0633\u06db\u0649","\ufcfe":"\u0633\u06db\u0649","\ud800\udef2":"\u0635","\ud83b\ude11":"\u0635","\ud83b\ude31":"\u0635","\ud83b\ude51":"\u0635","\ud83b\ude71":"\u0635","\ud83b\ude91":"\u0635","\ud83b\udeb1":"\u0635","\ufebb":"\u0635","\ufebc":"\u0635","\ufeba":"\u0635","\ufeb9":"\u0635","\u069e":"\u0635\u06db","\u08af":"\u0635\u0324\u0323","\ufcb1":"\u0635\u062d","\ufc20":"\u0635\u062d","\ufd65":"\u0635\u062d\u062d","\ufd64":"\u0635\u062d\u062d","\ufda9":"\u0635\u062d\u0649","\ufcb2":"\u0635\u062e","\ufd2b":"\u0635\u0631","\ufd0f":"\u0635\u0631","\ufdf5":"\u0635\u0644\u0639\u0645","\ufdf9":"\u0635\u0644\u0649","\ufdf0":"\u0635\u0644\u0649","\ufdfa":"\u0635\u0644\u0649 l\u0644\u0644o \u0639\u0644\u0649o \u0648\u0633\u0644\u0645","\ufcb3":"\u0635\u0645","\ufc21":"\u0635\u0645","\ufdc5":"\u0635\u0645\u0645","\ufd66":"\u0635\u0645\u0645","\ufd21":"\u0635\u0649","\ufd05":"\u0635\u0649","\ufd22":"\u0635\u0649","\ufd06":"\u0635\u0649","\ud83b\ude19":"\u0636","\ud83b\ude39":"\u0636","\ud83b\ude59":"\u0636","\ud83b\ude79":"\u0636","\ud83b\ude99":"\u0636","\ud83b\udeb9":"\u0636","\ufebf":"\u0636","\ufec0":"\u0636","\ufebe":"\u0636","\ufebd":"\u0636","\ufcb4":"\u0636\u062c","\ufc22":"\u0636\u062c","\ufcb5":"\u0636\u062d","\ufc23":"\u0636\u062d","\ufd6e":"\u0636\u062d\u0649","\ufdab":"\u0636\u062d\u0649","\ufcb6":"\u0636\u062e","\ufc24":"\u0636\u062e","\ufd70":"\u0636\u062e\u0645","\ufd6f":"\u0636\u062e\u0645","\ufd2c":"\u0636\u0631","\ufd10":"\u0636\u0631","\ufcb7":"\u0636\u0645","\ufc25":"\u0636\u0645","\ufd23":"\u0636\u0649","\ufd07":"\u0636\u0649","\ufd24":"\u0636\u0649","\ufd08":"\u0636\u0649","\ud800\udee8":"\u0637","\ud83b\ude08":"\u0637","\ud83b\ude68":"\u0637","\ud83b\ude88":"\u0637","\ud83b\udea8":"\u0637","\ufec3":"\u0637","\ufec4":"\u0637","\ufec2":"\u0637","\ufec1":"\u0637","\u069f":"\u0637\u06db","\ufcb8":"\u0637\u062d","\ufc26":"\u0637\u062d","\ufd33":"\u0637\u0645","\ufd3a":"\u0637\u0645","\ufc27":"\u0637\u0645","\ufd72":"\u0637\u0645\u062d","\ufd71":"\u0637\u0645\u062d","\ufd73":"\u0637\u0645\u0645","\ufd74":"\u0637\u0645\u0649","\ufd11":"\u0637\u0649","\ufcf5":"\u0637\u0649","\ufd12":"\u0637\u0649","\ufcf6":"\u0637\u0649","\ud83b\ude1a":"\u0638","\ud83b\ude7a":"\u0638","\ud83b\ude9a":"\u0638","\ud83b\udeba":"\u0638","\ufec7":"\u0638","\ufec8":"\u0638","\ufec6":"\u0638","\ufec5":"\u0638","\ufcb9":"\u0638\u0645","\ufd3b":"\u0638\u0645","\ufc28":"\u0638\u0645","\u060f":"\u0639","\ud83b\ude0f":"\u0639","\ud83b\ude2f":"\u0639","\ud83b\ude4f":"\u0639","\ud83b\ude6f":"\u0639","\ud83b\ude8f":"\u0639","\ud83b\udeaf":"\u0639","\ufecb":"\u0639","\ufecc":"\u0639","\ufeca":"\u0639","\ufec9":"\u0639","\ufcba":"\u0639\u062c","\ufc29":"\u0639\u062c","\ufdc4":"\u0639\u062c\u0645","\ufd75":"\u0639\u062c\u0645","\ufdf7":"\u0639\u0644\u0649o","\ufcbb":"\u0639\u0645","\ufc2a":"\u0639\u0645","\ufd77":"\u0639\u0645\u0645","\ufd76":"\u0639\u0645\u0645","\ufd78":"\u0639\u0645\u0649","\ufdb6":"\u0639\u0645\u0649","\ufd13":"\u0639\u0649","\ufcf7":"\u0639\u0649","\ufd14":"\u0639\u0649","\ufcf8":"\u0639\u0649","\ud83b\ude1b":"\u063a","\ud83b\ude3b":"\u063a","\ud83b\ude5b":"\u063a","\ud83b\ude7b":"\u063a","\ud83b\ude9b":"\u063a","\ud83b\udebb":"\u063a","\ufecf":"\u063a","\ufed0":"\u063a","\ufece":"\u063a","\ufecd":"\u063a","\ufcbc":"\u063a\u062c","\ufc2b":"\u063a\u062c","\ufcbd":"\u063a\u0645","\ufc2c":"\u063a\u0645","\ufd79":"\u063a\u0645\u0645","\ufd7b":"\u063a\u0645\u0649","\ufd7a":"\u063a\u0645\u0649","\ufd15":"\u063a\u0649","\ufcf9":"\u063a\u0649","\ufd16":"\u063a\u0649","\ufcfa":"\u063a\u0649","\ud83b\ude10":"\u0641","\ud83b\ude30":"\u0641","\ud83b\ude70":"\u0641","\ud83b\ude90":"\u0641","\ud83b\udeb0":"\u0641","\ufed3":"\u0641","\ufed4":"\u0641","\ufed2":"\u0641","\ufed1":"\u0641","\u06a7":"\u0641","\ufcbe":"\u0641\u062c","\ufc2d":"\u0641\u062c","\ufcbf":"\u0641\u062d","\ufc2e":"\u0641\u062d","\ufcc0":"\u0641\u062e","\ufc2f":"\u0641\u062e","\ufd7d":"\u0641\u062e\u0645","\ufd7c":"\u0641\u062e\u0645","\ufcc1":"\u0641\u0645","\ufc30":"\u0641\u0645","\ufdc1":"\u0641\u0645\u0649","\ufc7c":"\u0641\u0649","\ufc31":"\u0641\u0649","\ufc7d":"\u0641\u0649","\ufc32":"\u0641\u0649","\ud83b\ude1e":"\u06a1","\ud83b\ude7e":"\u06a1","\u08bb":"\u06a1","\u066f":"\u06a1","\ud83b\ude1f":"\u06a1","\ud83b\ude5f":"\u06a1","\u08bc":"\u06a1","\u06a4":"\u06a1\u06db","\ufb6c":"\u06a1\u06db","\ufb6d":"\u06a1\u06db","\ufb6b":"\u06a1\u06db","\ufb6a":"\u06a1\u06db","\u06a8":"\u06a1\u06db","\u08a4":"\u06a2\u06db","\ufb70":"\u06a6","\ufb71":"\u06a6","\ufb6f":"\u06a6","\ufb6e":"\u06a6","\ud83b\ude12":"\u0642","\ud83b\ude32":"\u0642","\ud83b\ude52":"\u0642","\ud83b\ude72":"\u0642","\ud83b\ude92":"\u0642","\ud83b\udeb2":"\u0642","\ufed7":"\u0642","\ufed8":"\u0642","\ufed6":"\u0642","\ufed5":"\u0642","\ufcc2":"\u0642\u062d","\ufc33":"\u0642\u062d","\ufdf1":"\u0642\u0644\u0649","\ufcc3":"\u0642\u0645","\ufc34":"\u0642\u0645","\ufdb4":"\u0642\u0645\u062d","\ufd7e":"\u0642\u0645\u062d","\ufd7f":"\u0642\u0645\u0645","\ufdb2":"\u0642\u0645\u0649","\ufc7e":"\u0642\u0649","\ufc35":"\u0642\u0649","\ufc7f":"\u0642\u0649","\ufc36":"\u0642\u0649","\ud83b\ude0a":"\u0643","\ud83b\ude2a":"\u0643","\ud83b\ude6a":"\u0643","\ufedb":"\u0643","\ufedc":"\u0643","\ufeda":"\u0643","\ufed9":"\u0643","\u06a9":"\u0643","\ufb90":"\u0643","\ufb91":"\u0643","\ufb8f":"\u0643","\ufb8e":"\u0643","\u06aa":"\u0643","\u06ad":"\u0643\u06db","\ufbd5":"\u0643\u06db","\ufbd6":"\u0643\u06db","\ufbd4":"\u0643\u06db","\ufbd3":"\u0643\u06db","\u0763":"\u0643\u06db","\ufc80":"\u0643l","\ufc37":"\u0643l","\ufcc4":"\u0643\u062c","\ufc38":"\u0643\u062c","\ufcc5":"\u0643\u062d","\ufc39":"\u0643\u062d","\ufcc6":"\u0643\u062e","\ufc3a":"\u0643\u062e","\ufcc7":"\u0643\u0644","\ufceb":"\u0643\u0644","\ufc81":"\u0643\u0644","\ufc3b":"\u0643\u0644","\ufcc8":"\u0643\u0645","\ufcec":"\u0643\u0645","\ufc82":"\u0643\u0645","\ufc3c":"\u0643\u0645","\ufdc3":"\u0643\u0645\u0645","\ufdbb":"\u0643\u0645\u0645","\ufdb7":"\u0643\u0645\u0649","\ufc83":"\u0643\u0649","\ufc3d":"\u0643\u0649","\ufc84":"\u0643\u0649","\ufc3e":"\u0643\u0649","\u0762":"\u06ac","\ufb94":"\u06af","\ufb95":"\u06af","\ufb93":"\u06af","\ufb92":"\u06af","\u08b0":"\u06af","\u06b4":"\u06af\u06db","\ufb9c":"\u06b1","\ufb9d":"\u06b1","\ufb9b":"\u06b1","\ufb9a":"\u06b1","\ufb98":"\u06b3","\ufb99":"\u06b3","\ufb97":"\u06b3","\ufb96":"\u06b3","\ud83b\ude0b":"\u0644","\ud83b\ude2b":"\u0644","\ud83b\ude4b":"\u0644","\ud83b\ude8b":"\u0644","\ud83b\udeab":"\u0644","\ufedf":"\u0644","\ufee0":"\u0644","\ufede":"\u0644","\ufedd":"\u0644","\u06b7":"\u0644\u06db","\u06b5":"\u0644\u0306","\ufefc":"\u0644l","\ufefb":"\u0644l","\ufefa":"\u0644l\u0655","\ufef9":"\u0644l\u0655","\ufef8":"\u0644l\u0674","\ufef7":"\u0644l\u0674","\ufccd":"\u0644o","\ufef6":"\u0644\u0622","\ufef5":"\u0644\u0622","\ufcc9":"\u0644\u062c","\ufc3f":"\u0644\u062c","\ufd83":"\u0644\u062c\u062c","\ufd84":"\u0644\u062c\u062c","\ufdba":"\u0644\u062c\u0645","\ufdbc":"\u0644\u062c\u0645","\ufdac":"\u0644\u062c\u0649","\ufcca":"\u0644\u062d","\ufc40":"\u0644\u062d","\ufdb5":"\u0644\u062d\u0645","\ufd80":"\u0644\u062d\u0645","\ufd82":"\u0644\u062d\u0649","\ufd81":"\u0644\u062d\u0649","\ufccb":"\u0644\u062e","\ufc41":"\u0644\u062e","\ufd86":"\u0644\u062e\u0645","\ufd85":"\u0644\u062e\u0645","\ufccc":"\u0644\u0645","\ufced":"\u0644\u0645","\ufc85":"\u0644\u0645","\ufc42":"\u0644\u0645","\ufd88":"\u0644\u0645\u062d","\ufd87":"\u0644\u0645\u062d","\ufdad":"\u0644\u0645\u0649","\ufc86":"\u0644\u0649","\ufc43":"\u0644\u0649","\ufc87":"\u0644\u0649","\ufc44":"\u0644\u0649","\ud83b\ude0c":"\u0645","\ud83b\ude2c":"\u0645","\ud83b\ude6c":"\u0645","\ud83b\ude8c":"\u0645","\ud83b\udeac":"\u0645","\ufee3":"\u0645","\ufee4":"\u0645","\ufee2":"\u0645","\ufee1":"\u0645","\u08a7":"\u0645\u06db","\u06fe":"\u0645\u0348","\ufc88":"\u0645l","\ufcce":"\u0645\u062c","\ufc45":"\u0645\u062c","\ufd8c":"\u0645\u062c\u062d","\ufd92":"\u0645\u062c\u062e","\ufd8d":"\u0645\u062c\u0645","\ufdc0":"\u0645\u062c\u0649","\ufccf":"\u0645\u062d","\ufc46":"\u0645\u062d","\ufd89":"\u0645\u062d\u062c","\ufd8a":"\u0645\u062d\u0645","\ufdf4":"\u0645\u062d\u0645\u062f","\ufd8b":"\u0645\u062d\u0649","\ufcd0":"\u0645\u062e","\ufc47":"\u0645\u062e","\ufd8e":"\u0645\u062e\u062c","\ufd8f":"\u0645\u062e\u0645","\ufdb9":"\u0645\u062e\u0649","\ufcd1":"\u0645\u0645","\ufc89":"\u0645\u0645","\ufc48":"\u0645\u0645","\ufdb1":"\u0645\u0645\u0649","\ufc49":"\u0645\u0649","\ufc4a":"\u0645\u0649","\ud83b\ude0d":"\u0646","\ud83b\ude2d":"\u0646","\ud83b\ude4d":"\u0646","\ud83b\ude6d":"\u0646","\ud83b\ude8d":"\u0646","\ud83b\udead":"\u0646","\ufee7":"\u0646","\ufee8":"\u0646","\ufee6":"\u0646","\ufee5":"\u0646","\u0768":"\u0646\u0615","\u0769":"\u0646\u0306","\ufcd6":"\u0646o","\ufcef":"\u0646o","\ufdb8":"\u0646\u062c\u062d","\ufdbd":"\u0646\u062c\u062d","\ufd98":"\u0646\u062c\u0645","\ufd97":"\u0646\u062c\u0645","\ufd99":"\u0646\u062c\u0649","\ufdc7":"\u0646\u062c\u0649","\ufcd3":"\u0646\u062d","\ufc4c":"\u0646\u062d","\ufd95":"\u0646\u062d\u0645","\ufd96":"\u0646\u062d\u0649","\ufdb3":"\u0646\u062d\u0649","\ufcd4":"\u0646\u062e","\ufc4d":"\u0646\u062e","\ufc8a":"\u0646\u0631","\ufc8b":"\u0646\u0632","\ufcd5":"\u0646\u0645","\ufcee":"\u0646\u0645","\ufc8c":"\u0646\u0645","\ufc4e":"\u0646\u0645","\ufd9b":"\u0646\u0645\u0649","\ufd9a":"\u0646\u0645\u0649","\ufc8d":"\u0646\u0646","\ufc8e":"\u0646\u0649","\ufc4f":"\u0646\u0649","\ufc8f":"\u0646\u0649","\ufc50":"\u0646\u0649","\u06c2":"\u06c0","\ufba5":"\u06c0","\ufba4":"\u06c0","\ud800\udee4":"\u0648","\ud83b\ude05":"\u0648","\ud83b\ude85":"\u0648","\ud83b\udea5":"\u0648","\ufeee":"\u0648","\ufeed":"\u0648","\u08b1":"\u0648","\u06cb":"\u0648\u06db","\ufbdf":"\u0648\u06db","\ufbde":"\u0648\u06db","\u06c7":"\u0648\u0313","\ufbd8":"\u0648\u0313","\ufbd7":"\u0648\u0313","\u06c6":"\u0648\u0306","\ufbda":"\u0648\u0306","\ufbd9":"\u0648\u0306","\u06c9":"\u0648\u0302","\ufbe3":"\u0648\u0302","\ufbe2":"\u0648\u0302","\u06c8":"\u0648\u0670","\ufbdc":"\u0648\u0670","\ufbdb":"\u0648\u0670","\u0624":"\u0648\u0674","\ufe86":"\u0648\u0674","\ufe85":"\u0648\u0674","\u0676":"\u0648\u0674","\u0677":"\u0648\u0313\u0674","\ufbdd":"\u0648\u0313\u0674","\ufdf8":"\u0648\u0633\u0644\u0645","\ufbe1":"\u06c5","\ufbe0":"\u06c5","\u066e":"\u0649","\ud83b\ude1c":"\u0649","\ud83b\ude7c":"\u0649","\u06ba":"\u0649","\ud83b\ude1d":"\u0649","\ud83b\ude5d":"\u0649","\ufb9f":"\u0649","\ufb9e":"\u0649","\u08bd":"\u0649","\ufbe8":"\u0649","\ufbe9":"\u0649","\ufef0":"\u0649","\ufeef":"\u0649","\u064a":"\u0649","\ud83b\ude09":"\u0649","\ud83b\ude29":"\u0649","\ud83b\ude49":"\u0649","\ud83b\ude69":"\u0649","\ud83b\ude89":"\u0649","\ud83b\udea9":"\u0649","\ufef3":"\u0649","\ufef4":"\u0649","\ufef2":"\u0649","\ufef1":"\u0649","\u06cc":"\u0649","\ufbfe":"\u0649","\ufbff":"\u0649","\ufbfd":"\u0649","\ufbfc":"\u0649","\u06d2":"\u0649","\ufbaf":"\u0649","\ufbae":"\u0649","\u0679":"\u0649\u0615","\ufb68":"\u0649\u0615","\ufb69":"\u0649\u0615","\ufb67":"\u0649\u0615","\ufb66":"\u0649\u0615","\u06bb":"\u0649\u0615","\ufba2":"\u0649\u0615","\ufba3":"\u0649\u0615","\ufba1":"\u0649\u0615","\ufba0":"\u0649\u0615","\u067e":"\u0649\u06db","\ufb58":"\u0649\u06db","\ufb59":"\u0649\u06db","\ufb57":"\u0649\u06db","\ufb56":"\u0649\u06db","\u062b":"\u0649\u06db","\ud83b\ude16":"\u0649\u06db","\ud83b\ude36":"\u0649\u06db","\ud83b\ude76":"\u0649\u06db","\ud83b\ude96":"\u0649\u06db","\ud83b\udeb6":"\u0649\u06db","\ufe9b":"\u0649\u06db","\ufe9c":"\u0649\u06db","\ufe9a":"\u0649\u06db","\ufe99":"\u0649\u06db","\u06bd":"\u0649\u06db","\u06d1":"\u0649\u06db","\u063f":"\u0649\u06db","\u08b7":"\u0649\u06db\u06e2","\u0756":"\u0649\u0306","\u06ce":"\u0649\u0306","\u08ba":"\u0649\u0306\u0307","\u063d":"\u0649\u0302","\u08a8":"\u0649\u0654","\ufc90":"\u0649\u0670","\ufc5d":"\u0649\u0670","\ufcde":"\u0649o","\ufcf1":"\u0649o","\ufce6":"\u0649\u06dbo","\u0626":"\u0649\u0674","\ufe8b":"\u0649\u0674","\ufe8c":"\u0649\u0674","\ufe8a":"\u0649\u0674","\ufe89":"\u0649\u0674","\u0678":"\u0649\u0674","\ufbeb":"\u0649\u0674l","\ufbea":"\u0649\u0674l","\ufc9b":"\u0649\u0674o","\ufce0":"\u0649\u0674o","\ufbed":"\u0649\u0674o","\ufbec":"\u0649\u0674o","\ufbf8":"\u0649\u0674\u067b","\ufbf7":"\u0649\u0674\u067b","\ufbf6":"\u0649\u0674\u067b","\ufc97":"\u0649\u0674\u062c","\ufc00":"\u0649\u0674\u062c","\ufc98":"\u0649\u0674\u062d","\ufc01":"\u0649\u0674\u062d","\ufc99":"\u0649\u0674\u062e","\ufc64":"\u0649\u0674\u0631","\ufc65":"\u0649\u0674\u0632","\ufc9a":"\u0649\u0674\u0645","\ufcdf":"\u0649\u0674\u0645","\ufc66":"\u0649\u0674\u0645","\ufc02":"\u0649\u0674\u0645","\ufc67":"\u0649\u0674\u0646","\ufbef":"\u0649\u0674\u0648","\ufbee":"\u0649\u0674\u0648","\ufbf1":"\u0649\u0674\u0648\u0313","\ufbf0":"\u0649\u0674\u0648\u0313","\ufbf3":"\u0649\u0674\u0648\u0306","\ufbf2":"\u0649\u0674\u0648\u0306","\ufbf5":"\u0649\u0674\u0648\u0670","\ufbf4":"\u0649\u0674\u0648\u0670","\ufbfb":"\u0649\u0674\u0649","\ufbfa":"\u0649\u0674\u0649","\ufc68":"\u0649\u0674\u0649","\ufbf9":"\u0649\u0674\u0649","\ufc03":"\u0649\u0674\u0649","\ufc69":"\u0649\u0674\u0649","\ufc04":"\u0649\u0674\u0649","\ufcda":"\u0649\u062c","\ufc55":"\u0649\u062c","\ufc11":"\u0649\u06db\u062c","\ufdaf":"\u0649\u062c\u0649","\ufcdb":"\u0649\u062d","\ufc56":"\u0649\u062d","\ufdae":"\u0649\u062d\u0649","\ufcdc":"\u0649\u062e","\ufc57":"\u0649\u062e","\ufc91":"\u0649\u0631","\ufc76":"\u0649\u06db\u0631","\ufc92":"\u0649\u0632","\ufc77":"\u0649\u06db\u0632","\ufcdd":"\u0649\u0645","\ufcf0":"\u0649\u0645","\ufc93":"\u0649\u0645","\ufc58":"\u0649\u0645","\ufca6":"\u0649\u06db\u0645","\ufce5":"\u0649\u06db\u0645","\ufc78":"\u0649\u06db\u0645","\ufc12":"\u0649\u06db\u0645","\ufd9d":"\u0649\u0645\u0645","\ufd9c":"\u0649\u0645\u0645","\ufdb0":"\u0649\u0645\u0649","\ufc94":"\u0649\u0646","\ufc79":"\u0649\u06db\u0646","\ufc95":"\u0649\u0649","\ufc59":"\u0649\u0649","\ufc96":"\u0649\u0649","\ufc5a":"\u0649\u0649","\ufc7a":"\u0649\u06db\u0649","\ufc13":"\u0649\u06db\u0649","\ufc7b":"\u0649\u06db\u0649","\ufc14":"\u0649\u06db\u0649","\ufbb1":"\u06d3","\ufbb0":"\u06d3","\ud800\udeb8":"\u2d40","\u205e":"\u2d42","\u2e3d":"\u2d42","\u2999":"\u2d42","\ufe19":"\u2d57","\u205d":"\u2d57","\u22ee":"\u2d57","\u0544":"\u1206","\u054c":"\u1261","\u053b":"\u12ae","\u054a":"\u1323","\u0906":"\u0905\u093e","\u0912":"\u0905\u093e\u0946","\u0913":"\u0905\u093e\u0947","\u0914":"\u0905\u093e\u0948","\u0904":"\u0905\u0946","\u0911":"\u0905\u0949","\u090d":"\u090f\u0945","\u090e":"\u090f\u0946","\u0910":"\u090f\u0947","\u0908":"\u0930\u094d\u0907","\u0abd":"\u093d","\ud804\udddc":"\ua8fb","\ud804\uddcb":"\u093a","\u0ac1":"\u0941","\u0ac2":"\u0942","\u0a4b":"\u0946","\u0a4d":"\u094d","\u0acd":"\u094d","\u0986":"\u0985\u09be","\u09e0":"\u098b\u09c3","\u09e1":"\u098b\u09c3","\ud805\udc92":"\u0998","\ud805\udc94":"\u099a","\ud805\udc96":"\u099c","\ud805\udc98":"\u099e","\ud805\udc99":"\u099f","\ud805\udc9b":"\u09a1","\ud805\udcaa":"\u09a3","\ud805\udc9e":"\u09a4","\ud805\udc9f":"\u09a5","\ud805\udca0":"\u09a6","\ud805\udca1":"\u09a7","\ud805\udca2":"\u09a8","\ud805\udca3":"\u09aa","\ud805\udca9":"\u09ac","\ud805\udca7":"\u09ae","\ud805\udca8":"\u09af","\ud805\udcab":"\u09b0","\ud805\udc9d":"\u09b2","\ud805\udcad":"\u09b7","\ud805\udcae":"\u09b8","\ud805\udcc4":"\u09bd","\ud805\udcb0":"\u09be","\ud805\udcb1":"\u09bf","\ud805\udcb9":"\u09c7","\ud805\udcbc":"\u09cb","\ud805\udcbe":"\u09cc","\ud805\udcc2":"\u09cd","\ud805\udcbd":"\u09d7","\u0a09":"\u0a73\u0a41","\u0a0a":"\u0a73\u0a42","\u0a06":"\u0a05\u0a3e","\u0a10":"\u0a05\u0a48","\u0a14":"\u0a05\u0a4c","\u0a07":"\u0a72\u0a3f","\u0a08":"\u0a72\u0a40","\u0a0f":"\u0a72\u0a47","\u0a86":"\u0a85\u0abe","\u0a91":"\u0a85\u0abe\u0ac5","\u0a93":"\u0a85\u0abe\u0ac7","\u0a94":"\u0a85\u0abe\u0ac8","\u0a8d":"\u0a85\u0ac5","\u0a8f":"\u0a85\u0ac7","\u0a90":"\u0a85\u0ac8","\u0b06":"\u0b05\u0b3e","\u0bee":"\u0b85","\u0bb0":"\u0b88","\u0bbe":"\u0b88","\u0beb":"\u0b88\u0bc1","\u0be8":"\u0b89","\u0d09":"\u0b89","\u0b8a":"\u0b89\u0bb3","\u0d0a":"\u0b89\u0d57","\u0bed":"\u0b8e","\u0bf7":"\u0b8e\u0bb5","\u0b9c":"\u0b90","\u0d1c":"\u0b90","\u0be7":"\u0b95","\u0bea":"\u0b9a","\u0bec":"\u0b9a\u0bc1","\u0bf2":"\u0b9a\u0bc2","\u0d3a":"\u0b9f\u0bbf","\u0d23":"\u0ba3","\u0bfa":"\u0ba8\u0bc0","\u0bf4":"\u0bae\u0bc0","\u0bf0":"\u0baf","\u0d34":"\u0bb4","\u0bd7":"\u0bb3","\u0bc8":"\u0ba9","\u0d36":"\u0bb6","\u0bf8":"\u0bb7","\u0d3f":"\u0bbf","\u0d40":"\u0bbf","\u0bca":"\u0bc6\u0b88","\u0bcc":"\u0bc6\u0bb3","\u0bcb":"\u0bc7\u0b88","\u0c85":"\u0c05","\u0c86":"\u0c06","\u0c87":"\u0c07","\u0c60":"\u0c0b\u0c3e","\u0c61":"\u0c0c\u0c3e","\u0c92":"\u0c12","\u0c14":"\u0c12\u0c4c","\u0c94":"\u0c12\u0c4c","\u0c13":"\u0c12\u0c55","\u0c93":"\u0c12\u0c55","\u0c9c":"\u0c1c","\u0c9e":"\u0c1e","\u0c22":"\u0c21\u0323","\u0ca3":"\u0c23","\u0c25":"\u0c27\u05bc","\u0c2d":"\u0c2c\u0323","\u0caf":"\u0c2f","\u0c20":"\u0c30\u05bc","\u0cb1":"\u0c31","\u0cb2":"\u0c32","\u0c37":"\u0c35\u0323","\u0c39":"\u0c35\u0c3e","\u0c2e":"\u0c35\u0c41","\u0c42":"\u0c41\u0c3e","\u0c44":"\u0c43\u0c3e","\u0ce1":"\u0c8c\u0cbe","\u0d08":"\u0d07\u0d57","\u0d10":"\u0d0e\u0d46","\u0d13":"\u0d12\u0d3e","\u0d14":"\u0d12\u0d57","\u0d61":"\u0d1e","\u0d6b":"\u0d26\u0d4d\u0d30","\u0d79":"\u0d28\u0d41","\u0d0c":"\u0d28\u0d41","\u0d19":"\u0d28\u0d41","\u0d6f":"\u0d28\u0d4d","\u0d7b":"\u0d28\u0d4d","\u0d6c":"\u0d28\u0d4d\u0d28","\u0d5a":"\u0d28\u0d4d\u0d2e","\u0d31":"\u0d30","\u0d6a":"\u0d30\u0d4d","\u0d7c":"\u0d30\u0d4d","\u0d6e":"\u0d35\u0d4d\u0d30","\u0d76":"\u0d39\u0d4d\u0d2e","\u0d42":"\u0d41","\u0d43":"\u0d41","\u0d48":"\u0d46\u0d46","\u0dea":"\u0da2","\u0deb":"\u0daf","\ud805\udc13":"\ud805\udc34\ud805\udc42\ud805\udc12","\ud805\udc19":"\ud805\udc34\ud805\udc42\ud805\udc18","\ud805\udc24":"\ud805\udc34\ud805\udc42\ud805\udc23","\ud805\udc2a":"\ud805\udc34\ud805\udc42\ud805\udc29","\ud805\udc2d":"\ud805\udc34\ud805\udc42\ud805\udc2c","\ud805\udc2f":"\ud805\udc34\ud805\udc42\ud805\udc2e","\ud805\uddd8":"\ud805\udd82","\ud805\uddd9":"\ud805\udd82","\ud805\uddda":"\ud805\udd83","\ud805\udddb":"\ud805\udd84","\ud805\udddc":"\ud805\uddb2","\ud805\udddd":"\ud805\uddb3","\u0e03":"\u0e02","\u0e14":"\u0e04","\u0e15":"\u0e04","\u0e21":"\u0e06","\u0e88":"\u0e08","\u0e0b":"\u0e0a","\u0e0f":"\u0e0e","\u0e17":"\u0e11","\u0e9a":"\u0e1a","\u0e9b":"\u0e1b","\u0e9d":"\u0e1d","\u0e9e":"\u0e1e","\u0e9f":"\u0e1f","\u0e26":"\u0e20","\u0e8d":"\u0e22","\u17d4":"\u0e2f","\u0e45":"\u0e32","\u0e33":"\u030a\u0e32","\u17b7":"\u0e34","\u17b8":"\u0e35","\u17b9":"\u0e36","\u17ba":"\u0e37","\u0eb8":"\u0e38","\u0eb9":"\u0e39","\u0e41":"\u0e40\u0e40","\u0edc":"\u0eab\u0e99","\u0edd":"\u0eab\u0ea1","\u0eb3":"\u030a\u0eb2","\u0f02":"\u0f60\u0f74\u0f82\u0f7f","\u0f03":"\u0f60\u0f74\u0f82\u0f14","\u0f6a":"\u0f62","\u0f00":"\u0f68\u0f7c\u0f7e","\u0f77":"\u0fb2\u0f71\u0f80","\u0f79":"\u0fb3\u0f71\u0f80","\ud807\udcb2":"\ud807\udcaa","\u1081":"\u1002\u103e","\u1000":"\u1002\u102c","\u1070":"\u1003\u103e","\u1066":"\u1015\u103e","\u101f":"\u1015\u102c","\u106f":"\u1015\u102c\u103e","\u107e":"\u107d\u103e","\u1029":"\u101e\u103c","\u102a":"\u101e\u103c\u1031\u102c\u103a","\u109e":"\u1083\u030a","\u17a3":"\u17a2","\u19d0":"\u199e","\u19d1":"\u19b1","\u1a80":"\u1a45","\u1a90":"\u1a45","\uaa53":"\uaa01","\uaa56":"\uaa23","\u1b52":"\u1b0d","\u1b53":"\u1b11","\u1b58":"\u1b28","\ua9a3":"\ua99d","\u1896":"\u185c","\u1855":"\u1835","\u1ff6":"\u13ef","\u140d":"\u1401\xb7","\u142b":"\u1401\u1420","\u1411":"\u1404\xb7","\u1413":"\u1405\xb7","\u142d":"\u1405\u1420","\u1415":"\u1406\xb7","\u1418":"\u140a\xb7","\u142e":"\u140a\u1420","\u141a":"\u140b\xb7","\u18dd":"\u141e\u18df","\u14d1":"\u1421","\u1540":"\u1429","\u143f":"\u1432\xb7","\u1443":"\u1434\xb7","\u2369":"\u1435","\u1447":"\u1439\xb7","\u145c":"\u144f\xb7","\u2e27":"\u1450","\u2283":"\u1450","\u145e":"\u1450\xb7","\u1469":"\u1450\'","\u27c9":"\u1450/","\u2ad7":"\u1450\u1455","\u1460":"\u1451\xb7","\u2e26":"\u1455","\u2282":"\u1455","\u1462":"\u1455\xb7","\u146a":"\u1455\'","\u1464":"\u1456\xb7","\u1475":"\u146b\xb7","\u1485":"\u146b\'","\u1479":"\u146e\xb7","\u147d":"\u1470\xb7","\u1603":"\u1489","\u1493":"\u1489\xb7","\u1495":"\u148b\xb7","\u1497":"\u148c\xb7","\u149b":"\u148e\xb7","\u1602":"\u1490","\u149d":"\u1490\xb7","\u149f":"\u1491\xb7","\u14ad":"\u14a3\xb7","\u14b1":"\u14a6\xb7","\u14b3":"\u14a7\xb7","\u14b5":"\u14a8\xb7","\u14b9":"\u14ab\xb7","\u14ca":"\u14c0\xb7","\u18c7":"\u14c2\xb7","\u18c9":"\u14c3\xb7","\u18cb":"\u14c4\xb7","\u18cd":"\u14c5\xb7","\u14cc":"\u14c7\xb7","\u14ce":"\u14c8\xb7","\u1604":"\u14d3","\u14dd":"\u14d3\xb7","\u14df":"\u14d5\xb7","\u14e1":"\u14d6\xb7","\u14e3":"\u14d7\xb7","\u14e5":"\u14d8\xb7","\u1607":"\u14da","\u14e7":"\u14da\xb7","\u14e9":"\u14db\xb7","\u14f7":"\u14ed\xb7","\u14f9":"\u14ef\xb7","\u14fb":"\u14f0\xb7","\u14fd":"\u14f1\xb7","\u14ff":"\u14f2\xb7","\u1501":"\u14f4\xb7","\u1503":"\u14f5\xb7","\u150c":"\u150b<","\u150e":"\u150bb","\u150d":"\u150b\u1455","\u150f":"\u150b\u1490","\u1518":"\u1510\xb7","\u151a":"\u1511\xb7","\u151c":"\u1512\xb7","\u151e":"\u1513\xb7","\u1520":"\u1514\xb7","\u1522":"\u1515\xb7","\u1524":"\u1516\xb7","\u1532":"\u1528\xb7","\u1534":"\u1529\xb7","\u1536":"\u152a\xb7","\u1538":"\u152b\xb7","\u153a":"\u152d\xb7","\u153c":"\u152e\xb7","\u1622":"\u1543","\u18e0":"\u1543\xb7","\u1623":"\u1546","\u1624":"\u154a","\u154f":"\u154c\xb7","\u1583":"\u1550b","\u1584":"\u1550b\u0307","\u1581":"\u1550d","\u157f":"\u1550P","\u166f":"\u1550\u146b","\u157e":"\u1550\u146c","\u1580":"\u1550\u146e","\u1582":"\u1550\u1470","\u1585":"\u1550\u1483","\u155c":"\u155a\xb7","\u18e3":"\u155e\xb7","\u18e4":"\u1566\xb7","\u1569":"\u1567\xb7","\u18e5":"\u156b\xb7","\u18e8":"\u1586\xb7","\u1591":"\u1595J","\u1670":"\u1595\u1489","\u158e":"\u1595\u148a","\u158f":"\u1595\u148b","\u1590":"\u1595\u148c","\u1592":"\u1595\u148e","\u1593":"\u1595\u1490","\u1594":"\u1595\u1491","\u1673":"\u1596J","\u1671":"\u1596\u148b","\u1672":"\u1596\u148c","\u1674":"\u1596\u148e","\u1675":"\u1596\u1490","\u1676":"\u1596\u1491","\u18ea":"\u1597\xb7","\u1677":"\u15a7\xb7","\u1678":"\u15a8\xb7","\u1679":"\u15a9\xb7","\u167a":"\u15aa\xb7","\u167b":"\u15ab\xb7","\u167c":"\u15ac\xb7","\u167d":"\u15ad\xb7","\u2aab":"\u15d2","\u2aaa":"\u15d5","\ua4f7":"\u15e1","\u18f0":"\u15f4\xb7","\u18f2":"\u161b\xb7","\u1dbb":"\u1646","\ua4ed":"\u1660","\u1dba":"\u18d4","\u1d3e":"\u18d6","\u18dc":"\u18df\u141e","\u02e1":"\u18f3","\u02b3":"\u18f4","\u02e2":"\u18f5","\u18db":"\u18f5","\ua6b0":"\u16b9","\u16e1":"\u16bc","\u237f":"\u16bd","\u16c2":"\u16bd","\ud834\ude3f":"\u16cb","\u2191":"\u16cf","\u21bf":"\u16d0","\u296e":"\u16d0\u21c2","\u2963":"\u16d0\u16da","\u2d63":"\u16ef","\u21be":"\u16da","\u2a21":"\u16da","\u22c4":"\u16dc","\u25c7":"\u16dc","\u25ca":"\u16dc","\u2662":"\u16dc","\ud83d\udf54":"\u16dc","\ud806\udcb7":"\u16dc","\ud800\ude94":"\u16dc","\u235a":"\u16dc\u0332","\u22c8":"\u16de","\u2a1d":"\u16de","\ud801\udcd0":"\u16e6","\u2195":"\u16e8","\ud803\udcfc":"\ud803\udc82","\ud803\udcfa":"\ud803\udca5","\u3131":"\u1100","\u11a8":"\u1100","\u1101":"\u1100\u1100","\u3132":"\u1100\u1100","\u11a9":"\u1100\u1100","\u11fa":"\u1100\u1102","\u115a":"\u1100\u1103","\u11c3":"\u1100\u1105","\u11fb":"\u1100\u1107","\u11aa":"\u1100\u1109","\u3133":"\u1100\u1109","\u11c4":"\u1100\u1109\u1100","\u11fc":"\u1100\u110e","\u11fd":"\u1100\u110f","\u11fe":"\u1100\u1112","\u3134":"\u1102","\u11ab":"\u1102","\u1113":"\u1102\u1100","\u11c5":"\u1102\u1100","\u1114":"\u1102\u1102","\u3165":"\u1102\u1102","\u11ff":"\u1102\u1102","\u1115":"\u1102\u1103","\u3166":"\u1102\u1103","\u11c6":"\u1102\u1103","\ud7cb":"\u1102\u1105","\u1116":"\u1102\u1107","\u115b":"\u1102\u1109","\u11c7":"\u1102\u1109","\u3167":"\u1102\u1109","\u115c":"\u1102\u110c","\u11ac":"\u1102\u110c","\u3135":"\u1102\u110c","\ud7cc":"\u1102\u110e","\u11c9":"\u1102\u1110","\u115d":"\u1102\u1112","\u11ad":"\u1102\u1112","\u3136":"\u1102\u1112","\u11c8":"\u1102\u1140","\u3168":"\u1102\u1140","\u3137":"\u1103","\u11ae":"\u1103","\u1117":"\u1103\u1100","\u11ca":"\u1103\u1100","\u1104":"\u1103\u1103","\u3138":"\u1103\u1103","\ud7cd":"\u1103\u1103","\ud7ce":"\u1103\u1103\u1107","\u115e":"\u1103\u1105","\u11cb":"\u1103\u1105","\ua960":"\u1103\u1106","\ua961":"\u1103\u1107","\ud7cf":"\u1103\u1107","\ua962":"\u1103\u1109","\ud7d0":"\u1103\u1109","\ud7d1":"\u1103\u1109\u1100","\ua963":"\u1103\u110c","\ud7d2":"\u1103\u110c","\ud7d3":"\u1103\u110e","\ud7d4":"\u1103\u1110","\u3139":"\u1105","\u11af":"\u1105","\ua964":"\u1105\u1100","\u11b0":"\u1105\u1100","\u313a":"\u1105\u1100","\ua965":"\u1105\u1100\u1100","\ud7d5":"\u1105\u1100\u1100","\u11cc":"\u1105\u1100\u1109","\u3169":"\u1105\u1100\u1109","\ud7d6":"\u1105\u1100\u1112","\u1118":"\u1105\u1102","\u11cd":"\u1105\u1102","\ua966":"\u1105\u1103","\u11ce":"\u1105\u1103","\u316a":"\u1105\u1103","\ua967":"\u1105\u1103\u1103","\u11cf":"\u1105\u1103\u1112","\u1119":"\u1105\u1105","\u11d0":"\u1105\u1105","\ud7d7":"\u1105\u1105\u110f","\ua968":"\u1105\u1106","\u11b1":"\u1105\u1106","\u313b":"\u1105\u1106","\u11d1":"\u1105\u1106\u1100","\u11d2":"\u1105\u1106\u1109","\ud7d8":"\u1105\u1106\u1112","\ua969":"\u1105\u1107","\u11b2":"\u1105\u1107","\u313c":"\u1105\u1107","\ud7d9":"\u1105\u1107\u1103","\ua96a":"\u1105\u1107\u1107","\u11d3":"\u1105\u1107\u1109","\u316b":"\u1105\u1107\u1109","\ua96b":"\u1105\u1107\u110b","\u11d5":"\u1105\u1107\u110b","\ud7da":"\u1105\u1107\u1111","\u11d4":"\u1105\u1107\u1112","\ua96c":"\u1105\u1109","\u11b3":"\u1105\u1109","\u313d":"\u1105\u1109","\u11d6":"\u1105\u1109\u1109","\u111b":"\u1105\u110b","\ud7dd":"\u1105\u110b","\ua96d":"\u1105\u110c","\ua96e":"\u1105\u110f","\u11d8":"\u1105\u110f","\u11b4":"\u1105\u1110","\u313e":"\u1105\u1110","\u11b5":"\u1105\u1111","\u313f":"\u1105\u1111","\u111a":"\u1105\u1112","\u3140":"\u1105\u1112","\u113b":"\u1105\u1112","\u11b6":"\u1105\u1112","\ud7f2":"\u1105\u1112","\u11d7":"\u1105\u1140","\u316c":"\u1105\u1140","\ud7db":"\u1105\u114c","\u11d9":"\u1105\u1159","\u316d":"\u1105\u1159","\ud7dc":"\u1105\u1159\u1112","\u3141":"\u1106","\u11b7":"\u1106","\ua96f":"\u1106\u1100","\u11da":"\u1106\u1100","\ud7de":"\u1106\u1102","\ud7df":"\u1106\u1102\u1102","\ua970":"\u1106\u1103","\u11db":"\u1106\u1105","\ud7e0":"\u1106\u1106","\u111c":"\u1106\u1107","\u316e":"\u1106\u1107","\u11dc":"\u1106\u1107","\ud7e1":"\u1106\u1107\u1109","\ua971":"\u1106\u1109","\u11dd":"\u1106\u1109","\u316f":"\u1106\u1109","\u11de":"\u1106\u1109\u1109","\u111d":"\u1106\u110b","\u3171":"\u1106\u110b","\u11e2":"\u1106\u110b","\ud7e2":"\u1106\u110c","\u11e0":"\u1106\u110e","\u11e1":"\u1106\u1112","\u11df":"\u1106\u1140","\u3170":"\u1106\u1140","\u3142":"\u1107","\u11b8":"\u1107","\u111e":"\u1107\u1100","\u3172":"\u1107\u1100","\u111f":"\u1107\u1102","\u1120":"\u1107\u1103","\u3173":"\u1107\u1103","\ud7e3":"\u1107\u1103","\u11e3":"\u1107\u1105","\ud7e4":"\u1107\u1105\u1111","\ud7e5":"\u1107\u1106","\u1108":"\u1107\u1107","\u3143":"\u1107\u1107","\ud7e6":"\u1107\u1107","\u112c":"\u1107\u1107\u110b","\u3179":"\u1107\u1107\u110b","\u1121":"\u1107\u1109","\u3144":"\u1107\u1109","\u11b9":"\u1107\u1109","\u1122":"\u1107\u1109\u1100","\u3174":"\u1107\u1109\u1100","\u1123":"\u1107\u1109\u1103","\u3175":"\u1107\u1109\u1103","\ud7e7":"\u1107\u1109\u1103","\u1124":"\u1107\u1109\u1107","\u1125":"\u1107\u1109\u1109","\u1126":"\u1107\u1109\u110c","\ua972":"\u1107\u1109\u1110","\u112b":"\u1107\u110b","\u3178":"\u1107\u110b","\u11e6":"\u1107\u110b","\u1127":"\u1107\u110c","\u3176":"\u1107\u110c","\ud7e8":"\u1107\u110c","\u1128":"\u1107\u110e","\ud7e9":"\u1107\u110e","\ua973":"\u1107\u110f","\u1129":"\u1107\u1110","\u3177":"\u1107\u1110","\u112a":"\u1107\u1111","\u11e4":"\u1107\u1111","\ua974":"\u1107\u1112","\u11e5":"\u1107\u1112","\u3145":"\u1109","\u11ba":"\u1109","\u112d":"\u1109\u1100","\u317a":"\u1109\u1100","\u11e7":"\u1109\u1100","\u112e":"\u1109\u1102","\u317b":"\u1109\u1102","\u112f":"\u1109\u1103","\u317c":"\u1109\u1103","\u11e8":"\u1109\u1103","\u1130":"\u1109\u1105","\u11e9":"\u1109\u1105","\u1131":"\u1109\u1106","\ud7ea":"\u1109\u1106","\u1132":"\u1109\u1107","\u317d":"\u1109\u1107","\u11ea":"\u1109\u1107","\u1133":"\u1109\u1107\u1100","\ud7eb":"\u1109\u1107\u110b","\u110a":"\u1109\u1109","\u3146":"\u1109\u1109","\u11bb":"\u1109\u1109","\ud7ec":"\u1109\u1109\u1100","\ud7ed":"\u1109\u1109\u1103","\ua975":"\u1109\u1109\u1107","\u1134":"\u1109\u1109\u1109","\u1135":"\u1109\u110b","\u1136":"\u1109\u110c","\u317e":"\u1109\u110c","\ud7ef":"\u1109\u110c","\u1137":"\u1109\u110e","\ud7f0":"\u1109\u110e","\u1138":"\u1109\u110f","\u1139":"\u1109\u1110","\ud7f1":"\u1109\u1110","\u113a":"\u1109\u1111","\ud7ee":"\u1109\u1140","\u3147":"\u110b","\u11bc":"\u110b","\u1141":"\u110b\u1100","\u11ec":"\u110b\u1100","\u11ed":"\u110b\u1100\u1100","\u1142":"\u110b\u1103","\ua976":"\u110b\u1105","\u1143":"\u110b\u1106","\u1144":"\u110b\u1107","\u1145":"\u110b\u1109","\u11f1":"\u110b\u1109","\u3182":"\u110b\u1109","\u1147":"\u110b\u110b","\u3180":"\u110b\u110b","\u11ee":"\u110b\u110b","\u1148":"\u110b\u110c","\u1149":"\u110b\u110e","\u11ef":"\u110b\u110f","\u114a":"\u110b\u1110","\u114b":"\u110b\u1111","\ua977":"\u110b\u1112","\u1146":"\u110b\u1140","\u11f2":"\u110b\u1140","\u3183":"\u110b\u1140","\u3148":"\u110c","\u11bd":"\u110c","\ud7f7":"\u110c\u1107","\ud7f8":"\u110c\u1107\u1107","\u114d":"\u110c\u110b","\u110d":"\u110c\u110c","\u3149":"\u110c\u110c","\ud7f9":"\u110c\u110c","\ua978":"\u110c\u110c\u1112","\u314a":"\u110e","\u11be":"\u110e","\u1152":"\u110e\u110f","\u1153":"\u110e\u1112","\u314b":"\u110f","\u11bf":"\u110f","\u314c":"\u1110","\u11c0":"\u1110","\ua979":"\u1110\u1110","\u314d":"\u1111","\u11c1":"\u1111","\u1156":"\u1111\u1107","\u11f3":"\u1111\u1107","\ud7fa":"\u1111\u1109","\u1157":"\u1111\u110b","\u3184":"\u1111\u110b","\u11f4":"\u1111\u110b","\ud7fb":"\u1111\u1110","\ua97a":"\u1111\u1112","\u314e":"\u1112","\u11c2":"\u1112","\u11f5":"\u1112\u1102","\u11f6":"\u1112\u1105","\u11f7":"\u1112\u1106","\u11f8":"\u1112\u1107","\ua97b":"\u1112\u1109","\u1158":"\u1112\u1112","\u3185":"\u1112\u1112","\u113d":"\u113c\u113c","\u113f":"\u113e\u113e","\u317f":"\u1140","\u11eb":"\u1140","\ud7f3":"\u1140\u1107","\ud7f4":"\u1140\u1107\u110b","\u3181":"\u114c","\u11f0":"\u114c","\ud7f5":"\u114c\u1106","\ud7f6":"\u114c\u1112","\u114f":"\u114e\u114e","\u1151":"\u1150\u1150","\u3186":"\u1159","\u11f9":"\u1159","\ua97c":"\u1159\u1159","\u3164":"\u1160","\u314f":"\u1161","\u11a3":"\u1161\u30fc","\u1176":"\u1161\u1169","\u1177":"\u1161\u116e","\u1162":"\u1161\u4e28","\u3150":"\u1161\u4e28","\u3151":"\u1163","\u1178":"\u1163\u1169","\u1179":"\u1163\u116d","\u11a4":"\u1163\u116e","\u1164":"\u1163\u4e28","\u3152":"\u1163\u4e28","\u3153":"\u1165","\u117c":"\u1165\u30fc","\u117a":"\u1165\u1169","\u117b":"\u1165\u116e","\u1166":"\u1165\u4e28","\u3154":"\u1165\u4e28","\u3155":"\u1167","\u11a5":"\u1167\u1163","\u117d":"\u1167\u1169","\u117e":"\u1167\u116e","\u1168":"\u1167\u4e28","\u3156":"\u1167\u4e28","\u3157":"\u1169","\u116a":"\u1169\u1161","\u3158":"\u1169\u1161","\u116b":"\u1169\u1161\u4e28","\u3159":"\u1169\u1161\u4e28","\u11a6":"\u1169\u1163","\u11a7":"\u1169\u1163\u4e28","\u117f":"\u1169\u1165","\u1180":"\u1169\u1165\u4e28","\ud7b0":"\u1169\u1167","\u1181":"\u1169\u1167\u4e28","\u1182":"\u1169\u1169","\ud7b1":"\u1169\u1169\u4e28","\u1183":"\u1169\u116e","\u116c":"\u1169\u4e28","\u315a":"\u1169\u4e28","\u315b":"\u116d","\ud7b2":"\u116d\u1161","\ud7b3":"\u116d\u1161\u4e28","\u1184":"\u116d\u1163","\u3187":"\u116d\u1163","\u1186":"\u116d\u1163","\u1185":"\u116d\u1163\u4e28","\u3188":"\u116d\u1163\u4e28","\ud7b4":"\u116d\u1165","\u1187":"\u116d\u1169","\u1188":"\u116d\u4e28","\u3189":"\u116d\u4e28","\u315c":"\u116e","\u1189":"\u116e\u1161","\u118a":"\u116e\u1161\u4e28","\u116f":"\u116e\u1165","\u315d":"\u116e\u1165","\u118b":"\u116e\u1165\u30fc","\u1170":"\u116e\u1165\u4e28","\u315e":"\u116e\u1165\u4e28","\ud7b5":"\u116e\u1167","\u118c":"\u116e\u1167\u4e28","\u118d":"\u116e\u116e","\u1171":"\u116e\u4e28","\u315f":"\u116e\u4e28","\ud7b6":"\u116e\u4e28\u4e28","\u3160":"\u1172","\u118e":"\u1172\u1161","\ud7b7":"\u1172\u1161\u4e28","\u118f":"\u1172\u1165","\u1190":"\u1172\u1165\u4e28","\u1191":"\u1172\u1167","\u318a":"\u1172\u1167","\u1192":"\u1172\u1167\u4e28","\u318b":"\u1172\u1167\u4e28","\ud7b8":"\u1172\u1169","\u1193":"\u1172\u116e","\u1194":"\u1172\u4e28","\u318c":"\u1172\u4e28","\u318d":"\u119e","\ud7c5":"\u119e\u1161","\u119f":"\u119e\u1165","\ud7c6":"\u119e\u1165\u4e28","\u11a0":"\u119e\u116e","\u11a2":"\u119e\u119e","\u11a1":"\u119e\u4e28","\u318e":"\u119e\u4e28","\u30d8":"\u3078","\u2341":"\u303c","\u29c4":"\u303c","\ua49e":"\ua04a","\ua4ac":"\ua050","\ua49c":"\ua0c0","\ua4a8":"\ua132","\ua4bf":"\ua259","\ua4be":"\ua2b1","\ua494":"\ua2cd","\ua4c0":"\ua3ab","\ua4c2":"\ua3b5","\ua4ba":"\ua3bf","\ua4b0":"\ua3c2","\ua4a7":"\ua458","\u22a5":"\ua4d5","\u27c2":"\ua4d5","\ud834\ude1c":"\ua4d5","\ua7b1":"\ua4d5","\ua79e":"\ua4e4","\u2141":"\ua4e8","\u2142":"\ua4f6","\ud834\ude15":"\ua4f6","\ud834\ude2b":"\ua4f6","\ud81b\udf26":"\ua4f6","\ud801\udc11":"\ua4f6","\u2143":"\ud81b\udf00","\ud806\udee6":"\ud806\udee5\ud806\udeef","\ud806\udee8":"\ud806\udee5\ud806\udee5","\ud806\udee9":"\ud806\udee5\ud806\udee5\ud806\udeef","\ud806\udeea":"\ud806\udee5\ud806\udee5\ud806\udef0","\ud806\udee7":"\ud806\udee5\ud806\udef0","\ud806\udef4":"\ud806\udef3\ud806\udeef","\ud806\udef6":"\ud806\udef3\ud806\udef3","\ud806\udef7":"\ud806\udef3\ud806\udef3\ud806\udeef","\ud806\udef8":"\ud806\udef3\ud806\udef3\ud806\udef0","\ud806\udef5":"\ud806\udef3\ud806\udef0","\ud806\udeec":"\ud806\udeeb\ud806\udeef","\ud806\udeed":"\ud806\udeeb\ud806\udeeb","\ud806\udeee":"\ud806\udeeb\ud806\udeeb\ud806\udeef","\u2295":"\ud800\udea8","\u2a01":"\ud800\udea8","\ud83d\udf28":"\ud800\udea8","\ua69a":"\ud800\udea8","\u25bd":"\ud800\udebc","\ud834\ude14":"\ud800\udebc","\ud83d\udf04":"\ud800\udebc","\u29d6":"\ud800\udec0","\ua79b":"\ud801\udc3a","\ua79a":"\ud801\udc12","\ud801\udca0":"\ud801\udc86","\ud800\udfd1":"\ud800\udf82","\ud800\udfd3":"\ud800\udf93","\ud808\udc38":"\ud800\udf9a","\u2625":"\ud802\udd9e","\ud80c\udef9":"\ud802\udd9e","\u3039":"\u5344","\uf967":"\u4e0d","\ud87e\udc00":"\u4e3d","\ufa70":"\u4e26","\u239c":"\u4e28","\u239f":"\u4e28","\u23a2":"\u4e28","\u23a5":"\u4e28","\u23aa":"\u4e28","\u23ae":"\u4e28","\u31d1":"\u4e28","\u1175":"\u4e28","\u3163":"\u4e28","\u2f01":"\u4e28","\u119c":"\u4e28\u30fc","\u1198":"\u4e28\u1161","\u1199":"\u4e28\u1163","\ud7bd":"\u4e28\u1163\u1169","\ud7be":"\u4e28\u1163\u4e28","\ud7bf":"\u4e28\u1167","\ud7c0":"\u4e28\u1167\u4e28","\u119a":"\u4e28\u1169","\ud7c1":"\u4e28\u1169\u4e28","\ud7c2":"\u4e28\u116d","\u119b":"\u4e28\u116e","\ud7c3":"\u4e28\u1172","\u119d":"\u4e28\u119e","\ud7c4":"\u4e28\u4e28","\uf905":"\u4e32","\ud87e\udc01":"\u4e38","\uf95e":"\u4e39","\ud87e\udc02":"\u4e41","\u31e0":"\u4e59","\u2f04":"\u4e59","\u31df":"\u4e5a","\u2e83":"\u4e5a","\u31d6":"\u4e5b","\u2e82":"\u4e5b","\u2ef2":"\u4e80","\uf91b":"\u4e82","\u31da":"\u4e85","\u2f05":"\u4e85","\uf9ba":"\u4e86","\u30cb":"\u4e8c","\u2f06":"\u4e8c","\ud87e\udc03":"\ud840\udd22","\u2f07":"\u4ea0","\uf977":"\u4eae","\u2f08":"\u4eba","\u30a4":"\u4ebb","\u2e85":"\u4ebb","\uf9fd":"\u4ec0","\ud87e\udc19":"\u4ecc","\uf9a8":"\u4ee4","\ud87e\udc04":"\u4f60","\u5002":"\u4f75","\ud87e\udc07":"\u4f75","\ufa73":"\u4f80","\uf92d":"\u4f86","\uf9b5":"\u4f8b","\ufa30":"\u4fae","\ud87e\udc05":"\u4fae","\ud87e\udc06":"\u4fbb","\uf965":"\u4fbf","\u503c":"\u5024","\uf9d4":"\u502b","\ud87e\udc08":"\u507a","\ud87e\udc09":"\u5099","\ud87e\udc0b":"\u50cf","\uf9bb":"\u50da","\ufa31":"\u50e7","\ud87e\udc0a":"\u50e7","\ud87e\udc0c":"\u349e","\u2f09":"\u513f","\ufa0c":"\u5140","\u2e8e":"\u5140","\ufa74":"\u5145","\ufa32":"\u514d","\ud87e\udc0e":"\u514d","\ud87e\udc0f":"\u5154","\ud87e\udc10":"\u5164","\u2f0a":"\u5165","\ud87e\udc14":"\u5167","\ufa72":"\u5168","\uf978":"\u5169","\u30cf":"\u516b","\u2f0b":"\u516b","\uf9d1":"\u516d","\ud87e\udc11":"\u5177","\ud87e\udc12":"\ud841\udd1c","\ud87e\udd1b":"\ud841\udd25","\ufa75":"\u5180","\ud87e\udc13":"\u34b9","\u2f0c":"\u5182","\ud87e\udc15":"\u518d","\ud87e\udc16":"\ud841\udd4b","\ud87e\udcd2":"\u5192","\ud87e\udcd3":"\u5195","\ud87e\uddca":"\u34bb","\ud87e\udcd4":"\u6700","\u2f0d":"\u5196","\ud87e\udc17":"\u5197","\ud87e\udc18":"\u51a4","\u2f0e":"\u51ab","\ud87e\udc1a":"\u51ac","\ufa71":"\u51b5","\ud87e\udc1b":"\u51b5","\uf92e":"\u51b7","\uf979":"\u51c9","\uf955":"\u51cc","\uf954":"\u51dc","\ufa15":"\u51de","\u2f0f":"\u51e0","\ud87e\udc0d":"\ud841\ude3a","\ud87e\udc1d":"\u51f5","\u2f10":"\u51f5","\u2f11":"\u5200","\u2e89":"\u5202","\ud87e\udc1e":"\u5203","\ufa00":"\u5207","\ud87e\udc50":"\u5207","\uf99c":"\u5217","\uf9dd":"\u5229","\ud87e\udc1f":"\u34df","\uf9ff":"\u523a","\ud87e\udc20":"\u523b","\ud87e\udc21":"\u5246","\ud87e\udc22":"\u5272","\ud87e\udc23":"\u5277","\uf9c7":"\u5289","\ud87e\uddd9":"\ud842\udc04","\u30ab":"\u529b","\uf98a":"\u529b","\u2f12":"\u529b","\uf99d":"\u52a3","\ud87e\udc24":"\u3515","\ud87e\udd92":"\u52b3","\ufa76":"\u52c7","\ud87e\udc25":"\u52c7","\ufa33":"\u52c9","\ud87e\udc26":"\u52c9","\uf952":"\u52d2","\uf92f":"\u52de","\ufa34":"\u52e4","\ud87e\udc27":"\u52e4","\uf97f":"\u52f5","\u2f13":"\u52f9","\ufa77":"\u52fa","\ud87e\udc28":"\u52fa","\ud87e\udc29":"\u5305","\ud87e\udc2a":"\u5306","\ud87e\udddd":"\ud842\udcde","\u2f14":"\u5315","\uf963":"\u5317","\ud87e\udc2b":"\u5317","\u2f15":"\u531a","\u2f16":"\u5338","\uf9eb":"\u533f","\u2f17":"\u5341","\u3038":"\u5341","\u303a":"\u5345","\ud87e\udc2c":"\u5349","\u0fd6":"\u534d","\u0fd5":"\u5350","\ufa35":"\u5351","\ud87e\udc2d":"\u5351","\ud87e\udc2e":"\u535a","\u30c8":"\u535c","\u2f18":"\u535c","\u2f19":"\u5369","\u2e8b":"\u353e","\ud87e\udc2f":"\u5373","\uf91c":"\u5375","\ud87e\udc30":"\u537d","\ud87e\udc31":"\u537f","\ud87e\udc32":"\u537f","\ud87e\udc33":"\u537f","\u2f1a":"\u5382","\ud87e\udc34":"\ud842\ude2c","\u2f1b":"\u53b6","\uf96b":"\u53c3","\u2f1c":"\u53c8","\ud87e\udc36":"\u53ca","\ud87e\udc37":"\u53df","\ud87e\udc38":"\ud842\udf63","\u30ed":"\u53e3","\u2f1d":"\u53e3","\u56d7":"\u53e3","\u2f1e":"\u53e3","\uf906":"\u53e5","\ud87e\udc39":"\u53eb","\ud87e\udc3a":"\u53f1","\ud87e\udc3b":"\u5406","\uf9de":"\u540f","\uf9ed":"\u541d","\ud87e\udc3d":"\u5438","\uf980":"\u5442","\ud87e\udc3e":"\u5448","\ud87e\udc3f":"\u5468","\ud87e\udc3c":"\u549e","\ud87e\udc40":"\u54a2","\uf99e":"\u54bd","\u439b":"\u3588","\ud87e\udc41":"\u54f6","\ud87e\udc42":"\u5510","\ud87e\udc43":"\u5553","\u555f":"\u5553","\ufa79":"\u5555","\ud87e\udc44":"\u5563","\ud87e\udc45":"\u5584","\ud87e\udc46":"\u5584","\uf90b":"\u5587","\ufa7a":"\u5599","\ud87e\udc47":"\u5599","\ufa36":"\u559d","\ufa78":"\u559d","\ud87e\udc48":"\u55ab","\ud87e\udc49":"\u55b3","\ufa0d":"\u55c0","\ud87e\udc4a":"\u55c2","\ufa7b":"\u55e2","\ufa37":"\u5606","\ud87e\udc4c":"\u5606","\ud87e\udc4e":"\u5651","\ud87e\udc4f":"\u5674","\ufa38":"\u5668","\uf9a9":"\u56f9","\ud87e\udc4b":"\u5716","\ud87e\udc4d":"\u5717","\u2f1f":"\u571f","\u58eb":"\u571f","\u2f20":"\u571f","\ud87e\udc55":"\u578b","\ud87e\udc52":"\u57ce","\u39b3":"\u363d","\ud87e\udc53":"\u57f4","\ud87e\udc54":"\u580d","\ud87e\udc57":"\u5831","\ud87e\udc56":"\u5832","\ufa39":"\u5840","\ufa10":"\u585a","\ufa7c":"\u585a","\uf96c":"\u585e","\u586b":"\u5861","\u58ff":"\u58ab","\ud87e\udc58":"\u58ac","\ufa7d":"\u58b3","\uf94a":"\u58d8","\uf942":"\u58df","\ud87e\udc59":"\ud845\udce4","\ud87e\udc51":"\u58ee","\ud87e\udc5a":"\u58f2","\ud87e\udc5b":"\u58f7","\u2f21":"\u5902","\ud87e\udc5c":"\u5906","\u2f22":"\u590a","\u30bf":"\u5915","\u2f23":"\u5915","\ud87e\udc5d":"\u591a","\ud87e\udc5e":"\u5922","\u2f24":"\u5927","\ufa7e":"\u5944","\uf90c":"\u5948","\uf909":"\u5951","\ufa7f":"\u5954","\ud87e\udc5f":"\u5962","\uf981":"\u5973","\u2f25":"\u5973","\ud87e\udc60":"\ud845\udea8","\ud87e\udc61":"\ud845\udeea","\ud87e\udc65":"\u59d8","\ud87e\udc62":"\u59ec","\ud87e\udc63":"\u5a1b","\ud87e\udc64":"\u5a27","\ufa80":"\u5a62","\ud87e\udc66":"\u5a66","\u5b00":"\u5aaf","\ud87e\udc67":"\u36ee","\ud87e\udc68":"\u36fc","\ud87e\udd86":"\u5ab5","\ud87e\udc69":"\u5b08","\ufa81":"\u5b28","\ud87e\udc6a":"\u5b3e","\ud87e\udc6b":"\u5b3e","\u2f26":"\u5b50","\u2f27":"\u5b80","\ufa04":"\u5b85","\ud87e\udc6c":"\ud846\uddc8","\ud87e\udc6d":"\u5bc3","\ud87e\udc6e":"\u5bd8","\uf95f":"\u5be7","\uf9aa":"\u5be7","\ud87e\udc6f":"\u5be7","\uf9bc":"\u5bee","\ud87e\udc70":"\u5bf3","\ud87e\udc71":"\ud846\udf18","\u2f28":"\u5bf8","\ud87e\udc72":"\u5bff","\ud87e\udc73":"\u5c06","\u2f29":"\u5c0f","\ud87e\udc75":"\u5c22","\u2e90":"\u5c22","\u2f2a":"\u5c22","\u2e8f":"\u5c23","\ud87e\udc76":"\u3781","\u2f2b":"\u5c38","\uf9bd":"\u5c3f","\ud87e\udc77":"\u5c60","\uf94b":"\u5c62","\ufa3b":"\u5c64","\uf9df":"\u5c65","\ufa3c":"\u5c6e","\ud87e\udc78":"\u5c6e","\u2f2c":"\u5c6e","\ud87e\udcf8":"\ud847\udd0b","\u2f2d":"\u5c71","\ud87e\udc79":"\u5cc0","\ud87e\udc7a":"\u5c8d","\ud87e\udc7b":"\ud847\udde4","\ud87e\udc7d":"\ud847\udde6","\uf9d5":"\u5d19","\ud87e\udc7c":"\u5d43","\uf921":"\u5d50","\ud87e\udc7f":"\u5d6b","\ud87e\udc7e":"\u5d6e","\ud87e\udc80":"\u5d7c","\ud87e\uddf4":"\u5db2","\uf9ab":"\u5dba","\u2f2e":"\u5ddb","\ud87e\udc82":"\u5de2","\u30a8":"\u5de5","\u2f2f":"\u5de5","\u2f30":"\u5df1","\u2e92":"\u5df3","\ud87e\udc83":"\u382f","\ud87e\udc84":"\u5dfd","\u2f31":"\u5dfe","\u5e32":"\u5e21","\ud87e\udc85":"\u5e28","\ud87e\udc86":"\u5e3d","\ud87e\udc87":"\u5e69","\ud87e\udc88":"\u3862","\ud87e\udc89":"\ud848\udd83","\u2f32":"\u5e72","\uf98e":"\u5e74","\ud87e\udd39":"\ud848\udd9f","\u2e93":"\u5e7a","\u2f33":"\u5e7a","\u2f34":"\u5e7f","\ufa01":"\u5ea6","\ud87e\udc8a":"\u387c","\ud87e\udc8b":"\u5eb0","\ud87e\udc8c":"\u5eb3","\ud87e\udc8d":"\u5eb6","\uf928":"\u5eca","\ud87e\udc8e":"\u5eca","\uf9a2":"\u5ec9","\ufa82":"\u5ed2","\ufa0b":"\u5ed3","\ufa83":"\u5ed9","\uf982":"\u5eec","\u2f35":"\u5ef4","\ud87e\udc90":"\u5efe","\u2f36":"\u5efe","\ud87e\udc91":"\ud848\udf31","\ud87e\udc92":"\ud848\udf31","\uf943":"\u5f04","\u2f37":"\u5f0b","\u2f38":"\u5f13","\ud87e\udc94":"\u5f22","\ud87e\udc95":"\u5f22","\u2f39":"\u5f50","\u2e94":"\u5f51","\ud87e\udc74":"\u5f53","\ud87e\udc96":"\u38c7","\u2f3a":"\u5f61","\ud87e\udc99":"\u5f62","\ufa84":"\u5f69","\ud87e\udc9a":"\u5f6b","\u2f3b":"\u5f73","\uf9d8":"\u5f8b","\ud87e\udc9b":"\u38e3","\ud87e\udc9c":"\u5f9a","\uf966":"\u5fa9","\ufa85":"\u5fad","\u2f3c":"\u5fc3","\u2e96":"\u5fc4","\u2e97":"\u38fa","\ud87e\udc9d":"\u5fcd","\ud87e\udc9e":"\u5fd7","\uf9a3":"\u5ff5","\ud87e\udc9f":"\u5ff9","\uf960":"\u6012","\uf9ac":"\u601c","\ufa6b":"\u6075","\ud87e\udca2":"\u391c","\ud87e\udca1":"\u393a","\ud87e\udca0":"\u6081","\ufa3d":"\u6094","\ud87e\udca3":"\u6094","\ud87e\udca5":"\u60c7","\ufa86":"\u60d8","\uf9b9":"\u60e1","\ud87e\udca4":"\ud849\uded4","\ufa88":"\u6108","\ufa3e":"\u6168","\uf9d9":"\u6144","\ud87e\udca6":"\u6148","\ud87e\udca7":"\u614c","\ud87e\udca9":"\u614c","\ufa87":"\u614e","\ud87e\udca8":"\u614e","\ufa8a":"\u6160","\ud87e\udcaa":"\u617a","\ufa3f":"\u618e","\ufa89":"\u618e","\ud87e\udcab":"\u618e","\uf98f":"\u6190","\ud87e\udcad":"\u61a4","\ud87e\udcae":"\u61af","\ud87e\udcac":"\u61b2","\ufad0":"\ud84a\udc44","\ufacf":"\ud84a\udc4a","\ud87e\udcaf":"\u61de","\ufa40":"\u61f2","\ufa8b":"\u61f2","\ud87e\udcb0":"\u61f2","\uf90d":"\u61f6","\ud87e\udcb1":"\u61f6","\uf990":"\u6200","\u2f3d":"\u6208","\ud87e\udcb2":"\u6210","\ud87e\udcb3":"\u621b","\uf9d2":"\u622e","\ufa8c":"\u6234","\u2f3e":"\u6236","\u6238":"\u6236","\u2f3f":"\u624b","\u2e98":"\u624c","\ud87e\udcb4":"\u625d","\ud87e\udcb5":"\u62b1","\uf925":"\u62c9","\uf95b":"\u62cf","\ufa02":"\u62d3","\ud87e\udcb6":"\u62d4","\ud87e\udcba":"\u62fc","\uf973":"\u62fe","\ud87e\udcb8":"\ud84a\udf0c","\ud87e\udcb9":"\u633d","\ud87e\udcb7":"\u6350","\ud87e\udcbb":"\u6368","\uf9a4":"\u637b","\ud87e\udcbc":"\u6383","\uf975":"\u63a0","\ud87e\udcc1":"\u63a9","\ufa8d":"\u63c4","\ud87e\udcbd":"\u63e4","\ufa8f":"\u6452","\ud87e\udcbe":"\ud84a\udff1","\ufa8e":"\u641c","\ud87e\udcbf":"\u6422","\ud87e\udcc0":"\u63c5","\ud87e\udcc3":"\u6469","\ud87e\udcc6":"\u6477","\ud87e\udcc4":"\u647e","\ud87e\udcc2":"\u3a2e","\u6409":"\u3a41","\uf991":"\u649a","\ud87e\udcc5":"\u649d","\uf930":"\u64c4","\ud87e\udcc7":"\u3a6c","\u2f40":"\u652f","\u2f41":"\u6534","\u2e99":"\u6535","\ufa41":"\u654f","\ud87e\udcc8":"\u654f","\ufa90":"\u6556","\ud87e\udcc9":"\u656c","\uf969":"\u6578","\ud87e\udcca":"\ud84c\udc0a","\u2f42":"\u6587","\u2eeb":"\u6589","\u2f43":"\u6597","\uf9be":"\u6599","\u2f44":"\u65a4","\u2f45":"\u65b9","\uf983":"\u65c5","\u2f46":"\u65e0","\u2e9b":"\u65e1","\ufa42":"\u65e2","\ud87e\udccb":"\u65e3","\u2f47":"\u65e5","\uf9e0":"\u6613","\u66f6":"\u3ada","\ud87e\udcd1":"\u3ae4","\ud87e\udccd":"\u6649","\u6669":"\u665a","\ufa12":"\u6674","\ufa91":"\u6674","\ufa43":"\u6691","\ud87e\udccf":"\u6691","\uf9c5":"\u6688","\ud87e\udcd0":"\u3b08","\ud87e\udcd5":"\u669c","\ufa06":"\u66b4","\uf98b":"\u66c6","\ud87e\udcce":"\u3b19","\ud87e\udc97":"\ud84c\udeb8","\u2f48":"\u66f0","\uf901":"\u66f4","\ud87e\udccc":"\u66f8","\u2f49":"\u6708","\ud87e\udd80":"\ud84c\udf5f","\u80a6":"\u670c","\u80d0":"\u670f","\u80ca":"\u6710","\u8101":"\u6713","\u80f6":"\u3b35","\uf929":"\u6717","\ufa92":"\u6717","\ud87e\udcd8":"\u6717","\u8127":"\u6718","\ufa93":"\u671b","\ud87e\udcd9":"\u671b","\u5e50":"\u3b3a","\u4420":"\u3b3b","\ud87e\udd89":"\ud84c\udf93","\u81a7":"\u6723","\ud87e\udd8a":"\ud84c\udf9c","\u2f4a":"\u6728","\uf9e1":"\u674e","\ud87e\udcdc":"\u6753","\ufa94":"\u6756","\ud87e\udcdb":"\u675e","\ud87e\udcdd":"\ud84c\udfc3","\u67ff":"\u676e","\uf9c8":"\u677b","\ud87e\udce0":"\u6785","\uf9f4":"\u6797","\ud87e\udcde":"\u3b49","\ufad1":"\ud84c\udfd5","\uf9c9":"\u67f3","\ud87e\udcdf":"\u67fa","\uf9da":"\u6817","\ud87e\udce5":"\u681f","\ud87e\udce1":"\u6852","\ud87e\udce3":"\ud84d\udc6d","\uf97a":"\u6881","\ufa44":"\u6885","\ud87e\udce2":"\u6885","\ud87e\udce4":"\u688e","\uf9e2":"\u68a8","\ud87e\udce6":"\u6914","\ud87e\udce8":"\u6942","\ufad2":"\u3b9d","\ud87e\udce7":"\u3b9d","\u69e9":"\u3ba3","\u6a27":"\u699d","\ud87e\udce9":"\u69a3","\ud87e\udcea":"\u69ea","\uf914":"\u6a02","\uf95c":"\u6a02","\uf9bf":"\u6a02","\uf94c":"\u6a13","\ud87e\udcec":"\ud84d\udea3","\ud87e\udceb":"\u6aa8","\uf931":"\u6ad3","\ud87e\udced":"\u6adb","\uf91d":"\u6b04","\ud87e\udcee":"\u3c18","\u2f4b":"\u6b20","\ud87e\udcef":"\u6b21","\ud87e\udcf0":"\ud84e\udca7","\ud87e\udcf1":"\u6b54","\ud87e\udcf2":"\u3c4e","\u2f4c":"\u6b62","\u2eed":"\u6b6f","\ud87e\udcf3":"\u6b72","\uf98c":"\u6b77","\ufa95":"\u6b79","\u2f4d":"\u6b79","\u2e9e":"\u6b7a","\ud87e\udcf4":"\u6b9f","\uf9a5":"\u6bae","\u2f4e":"\u6bb3","\uf970":"\u6bba","\ufa96":"\u6bba","\ud87e\udcf5":"\u6bba","\ud87e\udcf6":"\u6bbb","\ud87e\udcf7":"\ud84e\ude8d","\u2f4f":"\u6bcb","\u2e9f":"\u6bcd","\ud87e\udcf9":"\ud84e\udefa","\u2f50":"\u6bd4","\u2f51":"\u6bdb","\u2f52":"\u6c0f","\u2ea0":"\u6c11","\u2f53":"\u6c14","\u2f54":"\u6c34","\u2ea1":"\u6c35","\u2ea2":"\u6c3a","\ud87e\udcfa":"\u6c4e","\ud87e\udcfe":"\u6c67","\uf972":"\u6c88","\ud87e\udcfc":"\u6cbf","\uf968":"\u6ccc","\ud87e\udcfd":"\u6ccd","\uf9e3":"\u6ce5","\ud87e\udcfb":"\ud84f\udcbc","\uf915":"\u6d1b","\ufa05":"\u6d1e","\ud87e\udd07":"\u6d34","\ud87e\udd00":"\u6d3e","\uf9ca":"\u6d41","\ufa97":"\u6d41","\ud87e\udd02":"\u6d41","\ud87e\udcff":"\u6d16","\ud87e\udd03":"\u6d69","\uf92a":"\u6d6a","\ufa45":"\u6d77","\ud87e\udd01":"\u6d77","\ud87e\udd04":"\u6d78","\ud87e\udd05":"\u6d85","\ud87e\udd06":"\ud84f\udd1e","\uf9f5":"\u6dcb","\uf94d":"\u6dda","\uf9d6":"\u6dea","\ud87e\udd0e":"\u6df9","\ufa46":"\u6e1a","\ud87e\udd08":"\u6e2f","\ud87e\udd09":"\u6e6e","\u6f59":"\u6e88","\ufa99":"\u6ecb","\ud87e\udd0b":"\u6ecb","\uf9cb":"\u6e9c","\uf9ec":"\u6eba","\ud87e\udd0c":"\u6ec7","\uf904":"\u6ed1","\ufa98":"\u6edb","\ud87e\udd0a":"\u3d33","\uf94e":"\u6f0f","\ufa47":"\u6f22","\ufa9a":"\u6f22","\uf992":"\u6f23","\ud87e\udd0d":"\ud84f\uded1","\ud87e\udd0f":"\u6f6e","\ud87e\udd10":"\ud84f\udf5e","\ud87e\udd11":"\ud84f\udf8e","\ud87e\udd12":"\u6fc6","\uf922":"\u6feb","\uf984":"\u6ffe","\ud87e\udd15":"\u701b","\ufa9b":"\u701e","\ud87e\udd14":"\u701e","\ud87e\udd13":"\u7039","\ud87e\udd17":"\u704a","\ud87e\udd16":"\u3d96","\u2f55":"\u706b","\u2ea3":"\u706c","\ud87e\udc35":"\u7070","\ud87e\udd19":"\u7077","\ud87e\udd18":"\u707d","\uf9fb":"\u7099","\ud87e\udd1a":"\u70ad","\uf99f":"\u70c8","\uf916":"\u70d9","\ufa48":"\u716e","\ufa9c":"\u716e","\ud87e\udd1d":"\ud850\ude63","\ud87e\udd1c":"\u7145","\uf993":"\u7149","\ufa6c":"\ud850\udeee","\ud87e\udd1e":"\u719c","\uf9c0":"\u71ce","\uf9ee":"\u71d0","\ud87e\udd1f":"\ud850\udfab","\uf932":"\u7210","\uf91e":"\u721b","\ud87e\udd20":"\u7228","\u2f56":"\u722a","\ufa49":"\u722b","\u2ea4":"\u722b","\ufa9e":"\u7235","\ud87e\udd21":"\u7235","\u2f57":"\u7236","\u2f58":"\u723b","\u2ea6":"\u4e2c","\u2f59":"\u723f","\u2f5a":"\u7247","\ud87e\udd22":"\u7250","\u2f5b":"\u7259","\ud87e\udd23":"\ud851\ude08","\u2f5c":"\u725b","\uf946":"\u7262","\ud87e\udd24":"\u7280","\ud87e\udd25":"\u7295","\u2f5d":"\u72ac","\u2ea8":"\u72ad","\ufa9f":"\u72af","\uf9fa":"\u72c0","\ud87e\udd26":"\ud851\udf35","\uf92b":"\u72fc","\ufa16":"\u732a","\ufaa0":"\u732a","\ud87e\udd27":"\ud852\udc14","\uf9a7":"\u7375","\ud87e\udd28":"\u737a","\u2f5e":"\u7384","\uf961":"\u7387","\uf9db":"\u7387","\u2f5f":"\u7389","\ud87e\udd29":"\u738b","\ud87e\udd2a":"\u3eac","\ud87e\udd2b":"\u73a5","\uf9ad":"\u73b2","\ud87e\udd2c":"\u3eb8","\ud87e\udd2d":"\u3eb8","\uf917":"\u73de","\uf9cc":"\u7409","\uf9e4":"\u7406","\ufa4a":"\u7422","\ud87e\udd2e":"\u7447","\ud87e\udd2f":"\u745c","\uf9ae":"\u7469","\ufaa1":"\u7471","\ud87e\udd30":"\u7471","\ud87e\udd31":"\u7485","\uf994":"\u7489","\uf9ef":"\u7498","\ud87e\udd32":"\u74ca","\u2f60":"\u74dc","\u2f61":"\u74e6","\ud87e\udd33":"\u3f1b","\ufaa2":"\u7506","\u2f62":"\u7518","\u2f63":"\u751f","\ud87e\udd34":"\u7524","\u2f64":"\u7528","\u2f65":"\u7530","\ufaa3":"\u753b","\ud87e\udd36":"\u753e","\ud87e\udd35":"\ud853\udc36","\uf9cd":"\u7559","\uf976":"\u7565","\uf962":"\u7570","\ud87e\udd38":"\u7570","\ud87e\udd37":"\ud853\udc92","\u2f66":"\u758b","\u2f67":"\u7592","\uf9e5":"\u75e2","\ud87e\udd3a":"\u7610","\ufaa5":"\u761f","\ufaa4":"\u761d","\uf9c1":"\u7642","\uf90e":"\u7669","\u2f68":"\u7676","\u2f69":"\u767d","\ud87e\udd3b":"\ud853\udfa1","\ud87e\udd3c":"\ud853\udfb8","\u2f6a":"\u76ae","\u2f6b":"\u76bf","\ud87e\udd3d":"\ud854\udc44","\ud87e\udd3e":"\u3ffc","\ufa17":"\u76ca","\ufaa6":"\u76ca","\ufaa7":"\u76db","\uf933":"\u76e7","\ud87e\udd3f":"\u4008","\u2f6c":"\u76ee","\ufaa8":"\u76f4","\ud87e\udd40":"\u76f4","\ud87e\udd42":"\ud854\udcf2","\ud87e\udd41":"\ud854\udcf3","\uf96d":"\u7701","\ufad3":"\u4018","\ud87e\udd43":"\ud854\udd19","\ud87e\udd45":"\u771e","\ud87e\udd46":"\u771f","\ud87e\udd47":"\u771f","\ud87e\udd44":"\ud854\udd33","\ufaaa":"\u7740","\ufaa9":"\u774a","\ud87e\udd48":"\u774a","\u9fc3":"\u4039","\ufad4":"\u4039","\ud87e\udd49":"\u4039","\u6663":"\u403f","\ud87e\udd4b":"\u4046","\ud87e\udd4a":"\u778b","\ufad5":"\ud854\ude49","\ufa9d":"\u77a7","\u2f6d":"\u77db","\u2f6e":"\u77e2","\u2f6f":"\u77f3","\ud87e\udd4c":"\u4096","\ud87e\udd4d":"\ud855\udc1d","\u784f":"\u7814","\ud87e\udd4e":"\u784e","\uf9ce":"\u786b","\uf93b":"\u788c","\ud87e\udd4f":"\u788c","\ufa4b":"\u7891","\uf947":"\u78ca","\ufaab":"\u78cc","\ud87e\udd50":"\u78cc","\uf964":"\u78fb","\ud87e\udd51":"\u40e3","\uf985":"\u792a","\u2f70":"\u793a","\u2ead":"\u793b","\ufa18":"\u793c","\ufa4c":"\u793e","\ufa4e":"\u7948","\ufa4d":"\u7949","\ud87e\udd52":"\ud855\ude26","\ufa4f":"\u7950","\ufa50":"\u7956","\ud87e\udd53":"\u7956","\ufa51":"\u795d","\ufa19":"\u795e","\ufa1a":"\u7965","\ufa61":"\u8996","\ufab8":"\u8996","\uf93c":"\u797f","\ud87e\udd54":"\ud855\ude9a","\ufa52":"\u798d","\ufa53":"\u798e","\ufa1b":"\u798f","\ud87e\udd56":"\u798f","\ud87e\udd55":"\ud855\udec5","\uf9b6":"\u79ae","\u2f71":"\u79b8","\u2f72":"\u79be","\uf995":"\u79ca","\ud87e\udd58":"\u412f","\ud87e\udd57":"\u79eb","\uf956":"\u7a1c","\ud87e\udd5a":"\u7a4a","\ufa54":"\u7a40","\ud87e\udd59":"\u7a40","\ud87e\udd5b":"\u7a4f","\u2f73":"\u7a74","\ufa55":"\u7a81","\ud87e\udd5c":"\ud856\udd7c","\ufaac":"\u7ab1","\uf9f7":"\u7acb","\u2f74":"\u7acb","\u2eef":"\u7adc","\ud87e\udd5d":"\ud856\udea7","\ud87e\udd5e":"\ud856\udea7","\ud87e\udd5f":"\u7aee","\u2f75":"\u7af9","\uf9f8":"\u7b20","\ufa56":"\u7bc0","\ufaad":"\u7bc0","\ud87e\udd60":"\u4202","\ud87e\udd61":"\ud856\udfab","\ud87e\udd62":"\u7bc6","\ud87e\udd64":"\u4227","\ud87e\udd63":"\u7bc9","\ud87e\udd65":"\ud857\udc80","\ufad6":"\ud857\udcd0","\uf9a6":"\u7c3e","\uf944":"\u7c60","\u2f76":"\u7c73","\ufaae":"\u7c7b","\uf9f9":"\u7c92","\ufa1d":"\u7cbe","\ud87e\udd66":"\u7cd2","\ufa03":"\u7cd6","\ud87e\udd68":"\u7ce8","\ud87e\udd67":"\u42a0","\ud87e\udd69":"\u7ce3","\uf97b":"\u7ce7","\u2f77":"\u7cf8","\u2eaf":"\u7cf9","\ud87e\udd6b":"\ud857\udf86","\ud87e\udd6a":"\u7d00","\uf9cf":"\u7d10","\uf96a":"\u7d22","\uf94f":"\u7d2f","\u7d76":"\u7d55","\ud87e\udd6c":"\u7d63","\ufaaf":"\u7d5b","\uf93d":"\u7da0","\uf957":"\u7dbe","\ud87e\udd6e":"\u7dc7","\uf996":"\u7df4","\ufa57":"\u7df4","\ufab0":"\u7df4","\ud87e\udd6f":"\u7e02","\ud87e\udd6d":"\u4301","\ufa58":"\u7e09","\uf950":"\u7e37","\ufa59":"\u7e41","\ud87e\udd70":"\u7e45","\ud87e\udc98":"\ud858\uddda","\ud87e\udd71":"\u4334","\u2f78":"\u7f36","\ud87e\udd72":"\ud858\ude28","\ufab1":"\u7f3e","\ud87e\udd73":"\ud858\ude47","\u2f79":"\u7f51","\u2eab":"\u7f52","\u2eb2":"\u7f52","\u2eb1":"\u7f53","\ud87e\udd74":"\u4359","\ufa5a":"\u7f72","\ud87e\udd75":"\ud858\uded9","\uf9e6":"\u7f79","\ud87e\udd76":"\u7f7a","\uf90f":"\u7f85","\ud87e\udd77":"\ud858\udf3e","\u2f7a":"\u7f8a","\ud87e\udd78":"\u7f95","\uf9af":"\u7f9a","\ufa1e":"\u7fbd","\u2f7b":"\u7fbd","\ud87e\udd79":"\u7ffa","\uf934":"\u8001","\u2f7c":"\u8001","\u2eb9":"\u8002","\ufa5b":"\u8005","\ufab2":"\u8005","\ud87e\udd7a":"\u8005","\u2f7d":"\u800c","\ud87e\udd7b":"\ud859\udcda","\u2f7e":"\u8012","\ud87e\udd7c":"\ud859\udd23","\u2f7f":"\u8033","\uf9b0":"\u8046","\ud87e\udd7d":"\u8060","\ud87e\udd7e":"\ud859\udda8","\uf997":"\u806f","\ud87e\udd7f":"\u8070","\uf945":"\u807e","\u2f80":"\u807f","\u2eba":"\u8080","\u2f81":"\u8089","\uf953":"\u808b","\ud87e\udcd6":"\u80ad","\ud87e\udd82":"\u80b2","\ud87e\udd81":"\u43d5","\ud87e\udcd7":"\u43d9","\u8141":"\u80fc","\ud87e\udd83":"\u8103","\ud87e\udd85":"\u813e","\ud87e\udd84":"\u440b","\ud87e\udcda":"\u6721","\ud87e\udd87":"\ud859\udfa7","\ud87e\udd88":"\ud859\udfb5","\u6726":"\u4443","\uf926":"\u81d8","\u2f82":"\u81e3","\uf9f6":"\u81e8","\u2f83":"\u81ea","\ufa5c":"\u81ed","\u2f84":"\u81f3","\u2f85":"\u81fc","\ud87e\udc93":"\u8201","\ud87e\udd8b":"\u8201","\ud87e\udd8c":"\u8204","\u2f86":"\u820c","\ufa6d":"\u8218","\u2f87":"\u821b","\u2f88":"\u821f","\ud87e\udd8e":"\u446b","\u2f89":"\u826e","\uf97c":"\u826f","\u2f8a":"\u8272","\u2f8b":"\u8278","\ufa5d":"\u8279","\ufa5e":"\u8279","\u2ebe":"\u8279","\u2ebf":"\u8279","\u2ec0":"\u8279","\ud87e\udd90":"\u828b","\ud87e\udd8f":"\u8291","\ud87e\udd91":"\u829d","\ud87e\udd93":"\u82b1","\ud87e\udd94":"\u82b3","\ud87e\udd95":"\u82bd","\uf974":"\u82e5","\ud87e\udd98":"\u82e5","\ud87e\udd96":"\u82e6","\ud87e\udd97":"\ud85a\udf3c","\uf9fe":"\u8336","\ufab3":"\u8352","\ud87e\udd9a":"\u8363","\ud87e\udd99":"\u831d","\ud87e\udd9c":"\u8323","\ud87e\udd9d":"\u83bd","\ud87e\udda0":"\u8353","\uf93e":"\u83c9","\ud87e\udda1":"\u83ca","\ud87e\udda2":"\u83cc","\ud87e\udda3":"\u83dc","\ud87e\udd9e":"\u83e7","\ufab4":"\u83ef","\uf958":"\u83f1","\ufa5f":"\u8457","\ud87e\udd9f":"\u8457","\ud87e\udda4":"\ud85b\udc36","\ud87e\udd9b":"\u83ad","\uf918":"\u843d","\uf96e":"\u8449","\u853f":"\u848d","\ud87e\udda6":"\ud85b\udcd5","\ud87e\udda5":"\ud85b\udd6b","\uf999":"\u84ee","\ud87e\udda8":"\u84f1","\ud87e\udda9":"\u84f3","\uf9c2":"\u84fc","\ud87e\uddaa":"\u8516","\ud87e\udda7":"\u452b","\ud87e\uddac":"\u8564","\ud87e\uddad":"\ud85b\udf2c","\uf923":"\u85cd","\ud87e\uddae":"\u455d","\ud87e\uddb0":"\ud85b\udfb1","\ud87e\uddaf":"\u4561","\uf9f0":"\u85fa","\uf935":"\u8606","\ud87e\uddb2":"\u456b","\ufa20":"\u8612","\uf91f":"\u862d","\ud87e\uddb1":"\ud85c\udcd2","\u8641":"\u8637","\uf910":"\u863f","\u2f8c":"\u864d","\u2ec1":"\u864e","\ud87e\uddb3":"\u8650","\uf936":"\u865c","\ud87e\uddb4":"\u865c","\ud87e\uddb5":"\u8667","\ud87e\uddb6":"\u8669","\u2f8d":"\u866b","\ud87e\uddb7":"\u86a9","\ud87e\uddb8":"\u8688","\ud87e\uddba":"\u86e2","\ud87e\uddb9":"\u870e","\ud87e\uddbc":"\u8728","\ud87e\uddbd":"\u876b","\ud87e\uddc0":"\u87e1","\ufab5":"\u8779","\ud87e\uddbb":"\u8779","\ud87e\uddbe":"\u8786","\ud87e\uddbf":"\u45d7","\ud87e\uddab":"\ud85c\udfca","\uf911":"\u87ba","\ud87e\uddc1":"\u8801","\ud87e\uddc2":"\u45f9","\uf927":"\u881f","\u2f8e":"\u8840","\ufa08":"\u884c","\u2f8f":"\u884c","\ud87e\uddc3":"\u8860","\ud87e\uddc4":"\u8863","\u2f90":"\u8863","\u2ec2":"\u8864","\uf9a0":"\u88c2","\ud87e\uddc5":"\ud85d\ude67","\uf9e7":"\u88cf","\ud87e\uddc6":"\u88d7","\ud87e\uddc7":"\u88de","\uf9e8":"\u88e1","\uf912":"\u88f8","\ud87e\uddc9":"\u88fa","\ud87e\uddc8":"\u4635","\ufa60":"\u8910","\ufab6":"\u8941","\uf924":"\u8964","\u2f91":"\u897e","\u2ec4":"\u897f","\u2ec3":"\u8980","\ufab7":"\u8986","\ufa0a":"\u898b","\u2f92":"\u898b","\ud87e\uddcb":"\ud85e\udcae","\u2ec5":"\u89c1","\u2f93":"\u89d2","\u2f94":"\u8a00","\ud87e\uddcc":"\ud85e\udd66","\u8a7d":"\u8a2e","\u8a1e":"\u46b6","\ud87e\uddcd":"\u46be","\ud87e\uddce":"\u46c7","\ud87e\uddcf":"\u8aa0","\uf96f":"\u8aaa","\uf9a1":"\u8aaa","\ufab9":"\u8abf","\ufabb":"\u8acb","\uf97d":"\u8ad2","\uf941":"\u8ad6","\ufabe":"\u8aed","\ud87e\uddd0":"\u8aed","\ufa22":"\u8af8","\ufaba":"\u8af8","\uf95d":"\u8afe","\ufabd":"\u8afe","\ufa62":"\u8b01","\ufabc":"\u8b01","\ufa63":"\u8b39","\ufabf":"\u8b39","\uf9fc":"\u8b58","\uf95a":"\u8b80","\u8b8f":"\u8b86","\ufac0":"\u8b8a","\ud87e\uddd1":"\u8b8a","\u2ec8":"\u8ba0","\u2f95":"\u8c37","\u2f96":"\u8c46","\uf900":"\u8c48","\ud87e\uddd2":"\u8c55","\u2f97":"\u8c55","\u8c63":"\u8c5c","\u2f98":"\u8c78","\ud87e\uddd3":"\ud85f\udca8","\u2f99":"\u8c9d","\ud87e\uddd4":"\u8cab","\ud87e\uddd5":"\u8cc1","\uf948":"\u8cc2","\uf903":"\u8cc8","\ufa64":"\u8cd3","\ufa65":"\u8d08","\ufac1":"\u8d08","\ud87e\uddd6":"\u8d1b","\u2ec9":"\u8d1d","\u2f9a":"\u8d64","\u2f9b":"\u8d70","\ud87e\uddd7":"\u8d77","\u8d86":"\u8d7f","\ufad7":"\ud85f\uded3","\ud87e\uddd8":"\ud85f\udf2f","\u2f9c":"\u8db3","\ud87e\uddda":"\u8dcb","\ud87e\udddb":"\u8dbc","\u8dfa":"\u8de5","\uf937":"\u8def","\ud87e\udddc":"\u8df0","\u8e9b":"\u8e97","\u2f9d":"\u8eab","\uf902":"\u8eca","\u2f9e":"\u8eca","\ud87e\uddde":"\u8ed4","\u8f27":"\u8eff","\uf998":"\u8f26","\uf9d7":"\u8f2a","\ufac2":"\u8f38","\ud87e\udddf":"\u8f38","\ufa07":"\u8f3b","\uf98d":"\u8f62","\u2ecb":"\u8f66","\u2f9f":"\u8f9b","\ud87e\udd8d":"\u8f9e","\uf971":"\u8fb0","\u2fa0":"\u8fb0","\u2fa1":"\u8fb5","\ufa66":"\u8fb6","\u2ecc":"\u8fb6","\u2ecd":"\u8fb6","\ud87e\udc81":"\u5de1","\uf99a":"\u9023","\ufa25":"\u9038","\ufa67":"\u9038","\ufac3":"\u9072","\uf9c3":"\u907c","\ud87e\udde0":"\ud861\uddd2","\ud87e\udde1":"\ud861\udded","\uf913":"\u908f","\u2fa2":"\u9091","\ud87e\udde2":"\u9094","\uf92c":"\u90ce","\u90de":"\u90ce","\ufa2e":"\u90ce","\ud87e\udde3":"\u90f1","\ufa26":"\u90fd","\ud87e\udde5":"\ud861\udf2e","\ud87e\udde4":"\u9111","\ud87e\udde6":"\u911b","\u2fa3":"\u9149","\uf919":"\u916a","\ufac4":"\u9199","\uf9b7":"\u91b4","\u2fa4":"\u91c6","\uf9e9":"\u91cc","\u2fa5":"\u91cc","\uf97e":"\u91cf","\uf90a":"\u91d1","\u2fa6":"\u91d1","\uf9b1":"\u9234","\ud87e\udde7":"\u9238","\ufac5":"\u9276","\ud87e\udde8":"\u92d7","\ud87e\udde9":"\u92d8","\ud87e\uddea":"\u927c","\uf93f":"\u9304","\uf99b":"\u934a","\u93ae":"\u93ad","\ud87e\uddeb":"\u93f9","\ud87e\uddec":"\u9415","\ud87e\udded":"\ud862\udffa","\u2ed0":"\u9485","\u2ed1":"\u9577","\u2fa7":"\u9577","\u2ed2":"\u9578","\u2ed3":"\u957f","\u2fa8":"\u9580","\ud87e\uddee":"\u958b","\ud87e\uddef":"\u4995","\uf986":"\u95ad","\ud87e\uddf0":"\u95b7","\ud87e\uddf1":"\ud863\udd77","\u2ed4":"\u95e8","\u2fa9":"\u961c","\u2ecf":"\u961d","\u2ed6":"\u961d","\uf9c6":"\u962e","\uf951":"\u964b","\ufa09":"\u964d","\uf959":"\u9675","\uf9d3":"\u9678","\ufac6":"\u967c","\uf9dc":"\u9686","\uf9f1":"\u96a3","\ud87e\uddf2":"\u49e6","\u2faa":"\u96b6","\ufa2f":"\u96b7","\u96b8":"\u96b7","\uf9b8":"\u96b7","\u2fab":"\u96b9","\ud87e\uddf3":"\u96c3","\uf9ea":"\u96e2","\ufa68":"\u96e3","\ufac7":"\u96e3","\u2fac":"\u96e8","\uf9b2":"\u96f6","\uf949":"\u96f7","\ud87e\uddf5":"\u9723","\ud87e\uddf6":"\ud864\udd45","\uf938":"\u9732","\uf9b3":"\u9748","\u2fad":"\u9751","\u2ed8":"\u9752","\ufa1c":"\u9756","\ufac8":"\u9756","\ud87e\udc1c":"\ud864\udddf","\u2fae":"\u975e","\u2faf":"\u9762","\ud87e\uddf7":"\ud864\ude1a","\u2fb0":"\u9769","\ud87e\uddf8":"\u4a6e","\ud87e\uddf9":"\u4a76","\u2fb1":"\u97cb","\ufac9":"\u97db","\ud87e\uddfa":"\u97e0","\u2ed9":"\u97e6","\u2fb2":"\u97ed","\ud87e\uddfb":"\ud865\udc0a","\u2fb3":"\u97f3","\ufa69":"\u97ff","\ufaca":"\u97ff","\u2fb4":"\u9801","\ud87e\uddfc":"\u4ab2","\ufacb":"\u980b","\ud87e\uddfe":"\u980b","\ud87e\uddff":"\u980b","\uf9b4":"\u9818","\ud87e\ude00":"\u9829","\ud87e\uddfd":"\ud865\udc96","\ufa6a":"\u983b","\ufacc":"\u983b","\uf9d0":"\u985e","\u2eda":"\u9875","\u2fb5":"\u98a8","\ud87e\ude01":"\ud865\uddb6","\u2edb":"\u98ce","\u2fb6":"\u98db","\u2edc":"\u98de","\u2edd":"\u98df","\u2fb7":"\u98df","\u2edf":"\u98e0","\ud87e\ude02":"\u98e2","\ufa2a":"\u98ef","\ufa2b":"\u98fc","\ud87e\ude03":"\u4b33","\ufa2c":"\u9928","\ud87e\ude04":"\u9929","\u2ee0":"\u9963","\u2fb8":"\u9996","\u2fb9":"\u9999","\ud87e\ude05":"\u99a7","\u2fba":"\u99ac","\ud87e\ude06":"\u99c2","\uf91a":"\u99f1","\ud87e\ude07":"\u99fe","\uf987":"\u9a6a","\u2ee2":"\u9a6c","\u2fbb":"\u9aa8","\ud87e\ude08":"\u4bce","\u2fbc":"\u9ad8","\u2fbd":"\u9adf","\ud87e\ude09":"\ud866\udf30","\ufacd":"\u9b12","\ud87e\ude0a":"\u9b12","\u2fbe":"\u9b25","\u2fbf":"\u9b2f","\u2fc0":"\u9b32","\u2fc1":"\u9b3c","\u2ee4":"\u9b3c","\u2fc2":"\u9b5a","\uf939":"\u9b6f","\ud87e\ude0b":"\u9c40","\uf9f2":"\u9c57","\u2ee5":"\u9c7c","\u2fc3":"\u9ce5","\ud87e\ude0c":"\u9cfd","\ud87e\ude0d":"\u4cce","\ud87e\ude0f":"\u9d67","\ud87e\ude0e":"\u4ced","\ud87e\ude10":"\ud868\udcce","\ufa2d":"\u9db4","\ud87e\ude12":"\ud868\udd05","\ud87e\ude11":"\u4cf8","\uf93a":"\u9dfa","\ud87e\ude13":"\ud868\ude0e","\uf920":"\u9e1e","\u9e43":"\u9e42","\u2fc4":"\u9e75","\uf940":"\u9e7f","\u2fc5":"\u9e7f","\ud87e\ude14":"\ud868\ude91","\uf988":"\u9e97","\uf9f3":"\u9e9f","\u2fc6":"\u9ea5","\u2ee8":"\u9ea6","\ud87e\ude15":"\u9ebb","\u2fc7":"\u9ebb","\ud87e\udc8f":"\ud868\udf92","\u2fc8":"\u9ec3","\u2ee9":"\u9ec4","\u2fc9":"\u9ecd","\uf989":"\u9ece","\ud87e\ude16":"\u4d56","\u2fca":"\u9ed1","\u9ed2":"\u9ed1","\ufa3a":"\u58a8","\ud87e\ude17":"\u9ef9","\u2fcb":"\u9ef9","\u2fcc":"\u9efd","\ud87e\ude19":"\u9f05","\ud87e\ude18":"\u9efe","\u2fcd":"\u9f0e","\ud87e\ude1a":"\u9f0f","\u2fce":"\u9f13","\ud87e\ude1b":"\u9f16","\u2fcf":"\u9f20","\ud87e\ude1c":"\u9f3b","\u2fd0":"\u9f3b","\ufad8":"\u9f43","\u2fd1":"\u9f4a","\u2eec":"\u9f50","\u2fd2":"\u9f52","\ud87e\ude1d":"\ud869\ude00","\u2eee":"\u9f7f","\uf9c4":"\u9f8d","\u2fd3":"\u9f8d","\ufad9":"\u9f8e","\u2ef0":"\u9f99","\uf907":"\u9f9c","\uf908":"\u9f9c","\uface":"\u9f9c","\u2fd4":"\u9f9c","\u2ef3":"\u9f9f","\u2fd5":"\u9fa0"}')},function(e,t,n){var r=n(16);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}e.exports=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}},function(e,t,n){var r=n(108),i=n(11);e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!==typeof t?i(e):t}},function(e,t){function n(t){return"function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?e.exports=n=function(e){return typeof e}:e.exports=n=function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(t)}e.exports=n},function(e,t){e.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}},function(e,t,n){e.exports=n(111)},function(e,t,n){var r=n(112);t.operation=function(e){var n=t.timeouts(e);return new r(n,{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var n in e)t[n]=e[n];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var r=[],i=0;i<t.retries;i++)r.push(this.createTimeout(i,t));return e&&e.forever&&!r.length&&r.push(this.createTimeout(i,t)),r.sort((function(e,t){return e-t})),r},t.createTimeout=function(e,t){var n=t.randomize?Math.random()+1:1,r=Math.round(n*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return r=Math.min(r,t.maxTimeout)},t.wrap=function(e,n,r){if(n instanceof Array&&(r=n,n=null),!r)for(var i in r=[],e)"function"===typeof e[i]&&r.push(i);for(var o=0;o<r.length;o++){var a=r[o],s=e[a];e[a]=function(r){var i=t.operation(n),o=Array.prototype.slice.call(arguments,1),a=o.pop();o.push((function(e){i.retry(e)||(e&&(arguments[0]=i.mainError()),a.apply(this,arguments))})),i.attempt((function(){r.apply(e,o)}))}.bind(e,s),e[a].options=n}}},function(e,t){function n(e,t){"boolean"===typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=n,n.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},n.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},n.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var n=this._timeouts.shift();if(void 0===n){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1)}var r=this;return this._timer=setTimeout((function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout((function(){r._operationTimeoutCb(r._attempts)}),r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)}),n),this._options.unref&&this._timer.unref(),!0},n.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){n._operationTimeoutCb()}),n._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},n.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},n.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},n.prototype.start=n.prototype.try,n.prototype.errors=function(){return this._errors},n.prototype.attempts=function(){return this._attempts},n.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,n=0,r=0;r<this._errors.length;r++){var i=this._errors[r],o=i.message,a=(e[o]||0)+1;e[o]=a,a>=n&&(t=i,n=a)}return t}},function(e,t,n){"use strict";var r=n(0),i=n(2),o=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixScheduler=void 0;var a=o(n(3)),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}r.default=e,n&&n.set(e,r);return r}(n(12)),u=(n(5),n(17));function c(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}var l=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.RETRY_BACKOFF_RATELIMIT,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.QUEUE_MESSAGES;r(this,e),this.retryAlgorithm=n,this.queueAlgorithm=i,(0,a.default)(this,"queues",{}),(0,a.default)(this,"activeQueues",[]),(0,a.default)(this,"procFn",null),(0,a.default)(this,"processQueue",(function(e){var n=t.peekNextEvent(e);if(!n){var r=t.activeQueues.indexOf(e);return r>=0&&t.activeQueues.splice(r,1),void d("Stopping queue '%s' as it is now empty",e)}d("Queue '%s' has %s pending events",e,t.queues[e].length),Promise.resolve().then((function(){return t.procFn(n.event)})).then((function(r){t.removeNextEvent(e),d("Queue '%s' sent event %s",e,n.event.getId()),n.defer.resolve(r),t.processQueue(e)}),(function(r){n.attempts+=1;var i=t.retryAlgorithm(n.event,n.attempts,r);d("retry(%s) err=%s event_id=%s waitTime=%s",n.attempts,r,n.event.getId(),i),-1===i?(d("Queue '%s' giving up on event %s",e,n.event.getId()),t.removeNextEvent(e),n.defer.reject(r),t.processQueue(e)):setTimeout(t.processQueue,i,e)}))}))}return i(e,[{key:"getQueueForEvent",value:function(e){var t=this.queueAlgorithm(e);return t&&this.queues[t]?this.queues[t].map((function(e){return e.event})):null}},{key:"removeEventFromQueue",value:function(e){var t=this.queueAlgorithm(e);if(!t||!this.queues[t])return!1;var n=!1;return s.removeElement(this.queues[t],(function(t){if(t.event.getId()===e.getId())return n=!0,!0})),n}},{key:"setProcessFunction",value:function(e){this.procFn=e,this.startProcessingQueues()}},{key:"queueEvent",value:function(e){var t=this.queueAlgorithm(e);if(!t)return null;this.queues[t]||(this.queues[t]=[]);var n=s.defer();return this.queues[t].push({event:e,defer:n,attempts:0}),d("Queue algorithm dumped event %s into queue '%s'",e.getId(),t),this.startProcessingQueues(),n.promise}},{key:"startProcessingQueues",value:function(){var e=this;this.procFn&&Object.keys(this.queues).filter((function(t){return-1===e.activeQueues.indexOf(t)&&e.queues[t].length>0})).forEach((function(t){e.activeQueues.push(t),d("Spinning up queue: '%s'",t),e.processQueue(t)}))}},{key:"peekNextEvent",value:function(e){var t=this.queues[e];return Array.isArray(t)?t[0]:null}},{key:"removeNextEvent",value:function(e){var t=this.queues[e];return Array.isArray(t)?t.shift():null}}],[{key:"RETRY_BACKOFF_RATELIMIT",value:function(e,t,n){if(400===n.httpStatus||403===n.httpStatus||401===n.httpStatus)return-1;if("rejected"===n.cors)return-1;if("M_TOO_LARGE"===n.name)return-1;if("M_LIMIT_EXCEEDED"===n.name){var r=n.data.retry_after_ms;if(r>0)return r}return t>4?-1:1e3*Math.pow(2,t)}},{key:"QUEUE_MESSAGES",value:function(e){return e.getType()===u.EventType.RoomMessage||e.hasAssocation()?"message":null}}]),e}();function d(){}t.MatrixScheduler=l},function(e,t,n){"use strict";(function(e){var r=n(8),i=n(6),o=n(7),a=n(13),s=n(0),u=n(2),c=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.SyncApi=void 0;var l=c(n(3)),d=n(31),f=n(69),h=n(74),p=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=_(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}r.default=e,n&&n.set(e,r);return r}(n(12)),v=n(50),g=n(23),y=n(75),m=n(5),k=n(39),b=n(36),S=n(77),w=n(51),E=n(17);function _(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(_=function(e){return e?n:t})(e)}function x(e,t){return"FILTER_SYNC_"+e+(t?"_"+t:"")}function I(){var e;(e=m.logger).log.apply(e,arguments)}var T=function(){function t(e){var n,r=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s(this,t),this.client=e,this.opts=i,(0,l.default)(this,"_peekRoom",null),(0,l.default)(this,"currentSyncRequest",null),(0,l.default)(this,"syncState",null),(0,l.default)(this,"syncStateData",null),(0,l.default)(this,"catchingUp",!1),(0,l.default)(this,"running",!1),(0,l.default)(this,"keepAliveTimer",null),(0,l.default)(this,"connectionReturnedDefer",null),(0,l.default)(this,"notifEvents",[]),(0,l.default)(this,"failedSyncCount",0),(0,l.default)(this,"storeIsInvalid",!1),(0,l.default)(this,"onOnline",(function(){I("Browser thinks we are back online"),r.startKeepAlives(0)})),this.opts.initialSyncLimit=null!==(n=this.opts.initialSyncLimit)&&void 0!==n?n:8,this.opts.resolveInvitesToProfiles=this.opts.resolveInvitesToProfiles||!1,this.opts.pollTimeout=this.opts.pollTimeout||3e4,this.opts.pendingEventOrdering=this.opts.pendingEventOrdering||b.PendingEventOrdering.Chronological,this.opts.experimentalThreadSupport=!0===this.opts.experimentalThreadSupport,i.canResetEntireTimeline||(i.canResetEntireTimeline=function(e){return!1}),e.getNotifTimelineSet()&&e.reEmitter.reEmit(e.getNotifTimelineSet(),["Room.timeline","Room.timelineReset"])}return u(t,[{key:"createRoom",value:function(e){var t=this.client,n=t.timelineSupport,r=t.unstableClientRelationAggregation,i=new f.Room(e,t,t.getUserId(),{lazyLoadMembers:this.opts.lazyLoadMembers,pendingEventOrdering:this.opts.pendingEventOrdering,timelineSupport:n,unstableClientRelationAggregation:r});return t.reEmitter.reEmit(i,["Room.name","Room.timeline","Room.redaction","Room.redactionCancelled","Room.receipt","Room.tags","Room.timelineReset","Room.localEchoUpdated","Room.accountData","Room.myMembership","Room.replaceEvent"]),this.registerStateListeners(i),i}},{key:"createGroup",value:function(e){var t=this.client,n=new h.Group(e);return t.reEmitter.reEmit(n,["Group.profile","Group.myMembership"]),t.store.storeGroup(n),n}},{key:"registerStateListeners",value:function(e){var t=this.client;t.reEmitter.reEmit(e.currentState,["RoomState.events","RoomState.members","RoomState.newMember"]),e.currentState.on("RoomState.newMember",(function(e,n,r){r.user=t.getUser(r.userId),t.reEmitter.reEmit(r,["RoomMember.name","RoomMember.typing","RoomMember.powerLevel","RoomMember.membership"])}))}},{key:"deregisterStateListeners",value:function(e){e.currentState.removeAllListeners("RoomState.events"),e.currentState.removeAllListeners("RoomState.members"),e.currentState.removeAllListeners("RoomState.newMember")}},{key:"syncLeftRooms",value:function(){var e=this,t=this.client,n=new v.Filter(this.client.credentials.userId);n.setTimelineLimit(1),n.setIncludeLeaveRooms(!0);var r=this.opts.pollTimeout+8e4,i={timeout:0};return t.getOrCreateFilter(x(t.credentials.userId,"LEFT_ROOMS"),n).then((function(e){return i.filter=e,t.http.authedRequest(void 0,"GET","/sync",i,void 0,r)})).then((function(n){var r=[];n.rooms&&n.rooms.leave&&(r=e.mapSyncResponseToRoomArray(n.rooms.leave));var i=[];return r.forEach((function(n){var r=n.room;if(i.push(r),n.isBrandNewRoom){n.timeline=n.timeline||{};var o=e.mapSyncEventsFormat(n.timeline,r),s=e.partitionThreadedEvents(o),u=a(s,2),c=u[0],l=u[1],d=e.mapSyncEventsFormat(n.state,r);r.getLiveTimeline().setPaginationToken(n.timeline.prev_batch,g.EventTimeline.BACKWARDS),e.processRoomEvents(r,d,c),e.processThreadEvents(r,l),r.recalculate(),t.store.storeRoom(r),t.emit("Room",r),e.processEventsForNotifs(r,o)}})),i}))}},{key:"partitionThreadedEvents",value:function(e){var t=this;return this.opts.experimentalThreadSupport?e.reduce((function(n,r){var i=t.client.getRoom(r.getRoomId()),o=r.isThreadRelation;if(!o){var a=r.parentEventId,s=(null===i||void 0===i?void 0:i.findEventById(a))||e.find((function(e){return e.getId()===a}));o=null===s||void 0===s?void 0:s.isThreadRelation}return n[o?1:0].push(r),n}),[[],[]]):[e,[]]}},{key:"peek",value:function(e){var t=this;if(this._peekRoom&&this._peekRoom.roomId===e)return Promise.resolve(this._peekRoom);var n=this.client;return this._peekRoom=this.createRoom(e),this.client.roomInitialSync(e,20).then((function(e){e.messages=e.messages||{chunk:[]},e.messages.chunk=e.messages.chunk||[],e.state=e.state||[];var r=p.deepCopy(e.state).map(n.getEventMapper()),i=e.state.map(n.getEventMapper()),o=e.messages.chunk.map(n.getEventMapper());return e.presence&&Array.isArray(e.presence)&&e.presence.map(n.getEventMapper()).forEach((function(e){var t=n.store.getUser(e.getContent().user_id);t?t.setPresenceEvent(e):((t=R(n,e.getContent().user_id)).setPresenceEvent(e),n.store.storeUser(t)),n.emit("event",e)})),e.messages.start&&(t._peekRoom.oldState.paginationToken=e.messages.start),t._peekRoom.oldState.setStateEvents(r),t._peekRoom.currentState.setStateEvents(i),t.resolveInvites(t._peekRoom),t._peekRoom.recalculate(),t._peekRoom.addEventsToTimeline(o.reverse(),!0,t._peekRoom.getLiveTimeline(),e.messages.start),n.store.storeRoom(t._peekRoom),n.emit("Room",t._peekRoom),t.peekPoll(t._peekRoom),t._peekRoom}))}},{key:"stopPeeking",value:function(){this._peekRoom=null}},{key:"peekPoll",value:function(e,t){var n=this;this._peekRoom===e?this.client.http.authedRequest(void 0,"GET","/events",{room_id:e.roomId,timeout:3e4,from:t},void 0,5e4).then((function(t){if(n._peekRoom===e){t.chunk.filter((function(e){return"m.presence"===e.type})).map(n.client.getEventMapper()).forEach((function(e){var t=n.client.store.getUser(e.getContent().user_id);t?t.setPresenceEvent(e):((t=R(n.client,e.getContent().user_id)).setPresenceEvent(e),n.client.store.storeUser(t)),n.client.emit("event",e)}));var r=t.chunk.filter((function(t){return t.room_id===e.roomId&&t.event_id})).map(n.client.getEventMapper());e.addLiveEvents(r),n.peekPoll(e,t.end)}else I("Stopped peeking in room %s",e.roomId)}),(function(r){m.logger.error("[%s] Peek poll failed: %s",e.roomId,r),setTimeout((function(){n.peekPoll(e,t)}),3e4)})):I("Stopped peeking in room %s",e.roomId)}},{key:"getSyncState",value:function(){return this.syncState}},{key:"getSyncStateData",value:function(){return this.syncStateData}},{key:"recoverFromSyncStartupError",value:function(){var e=o(i.mark((function e(t,n){var r;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:return r=this.startKeepAlives(),this.updateSyncState(S.SyncState.Error,{error:n}),e.next=6,r;case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"wasLazyLoadingToggled",value:function(){var e=o(i.mark((function e(){var t,n,r,o=arguments;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]&&o[0],n=!1,e.next=4,this.client.store.isNewlyCreated();case 4:if(e.sent){e.next=11;break}return e.next=8,this.client.store.getClientOptions();case 8:return(r=e.sent)&&(n=!!r.lazyLoadMembers),e.abrupt("return",n!==t);case 11:return e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"shouldAbortSync",value:function(e){return"M_UNKNOWN_TOKEN"===e.errcode&&(m.logger.warn("Token no longer valid - assuming logout"),this.stop(),!0)}},{key:"sync",value:function(){var t=this,n=this.client;this.running=!0,e.window&&e.window.addEventListener&&e.window.addEventListener("online",this.onOnline,!1);var r=Promise.resolve(),a=null,s=function(){var e=o(i.mark((function e(){var o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,I("Getting push rules..."),e.next=4,n.getPushRules();case 4:o=e.sent,I("Got push rules"),n.pushRules=o,e.next=19;break;case 9:if(e.prev=9,e.t0=e.catch(0),m.logger.error("Getting push rules failed",e.t0),!t.shouldAbortSync(e.t0)){e.next=14;break}return e.abrupt("return");case 14:return I("Waiting for saved sync before retrying push rules..."),e.next=17,t.recoverFromSyncStartupError(r,e.t0);case 17:return s(),e.abrupt("return");case 19:c();case 20:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),u=function(){var e=new v.Filter(n.credentials.userId);return e.setTimelineLimit(t.opts.initialSyncLimit),e},c=function(){var e=o(i.mark((function e(){var r,o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(I("Checking lazy load status..."),t.opts.lazyLoadMembers&&n.isGuest()&&(t.opts.lazyLoadMembers=!1),!t.opts.lazyLoadMembers){e.next=8;break}return I("Checking server lazy load support..."),e.next=6,n.doesServerSupportLazyLoading();case 6:e.sent?(I("Enabling lazy load on sync filter..."),t.opts.filter||(t.opts.filter=u()),t.opts.filter.setLazyLoadMembers(!0)):(I("LL: lazy loading requested but not supported by server, so disabling"),t.opts.lazyLoadMembers=!1);case 8:return I("Checking whether lazy loading has changed in store..."),e.next=11,t.wasLazyLoadingToggled(t.opts.lazyLoadMembers);case 11:if(!e.sent){e.next=19;break}return t.storeIsInvalid=!0,r=k.InvalidStoreError.TOGGLED_LAZY_LOADING,o=new k.InvalidStoreError(r,!!t.opts.lazyLoadMembers),t.updateSyncState(S.SyncState.Error,{error:o}),m.logger.warn("InvalidStoreError: store is not usable: stopping sync."),e.abrupt("return");case 19:return t.opts.lazyLoadMembers&&t.opts.crypto&&t.opts.crypto.enableLazyLoading(),e.prev=20,I("Storing client options..."),e.next=24,t.client.storeClientOptions();case 24:I("Stored client options"),e.next=31;break;case 27:throw e.prev=27,e.t0=e.catch(20),m.logger.error("Storing client options failed",e.t0),e.t0;case 31:l();case 32:case"end":return e.stop()}}),e,null,[[20,27]])})));return function(){return e.apply(this,arguments)}}(),l=function(){var e=o(i.mark((function e(){var o,s;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return I("Getting filter..."),o=t.opts.filter?t.opts.filter:u(),e.prev=2,e.next=5,n.getOrCreateFilter(x(n.credentials.userId),o);case 5:s=e.sent,e.next=18;break;case 8:if(e.prev=8,e.t0=e.catch(2),m.logger.error("Getting filter failed",e.t0),!t.shouldAbortSync(e.t0)){e.next=13;break}return e.abrupt("return");case 13:return I("Waiting for saved sync before retrying filter..."),e.next=16,t.recoverFromSyncStartupError(r,e.t0);case 16:return l(),e.abrupt("return");case 18:return n.resetNotifTimelineSet(),null===t.currentSyncRequest&&(I("Sending first sync request..."),t.currentSyncRequest=t.doSyncRequest({filterId:s},a)),I("Waiting for saved sync before starting sync processing..."),e.next=23,r;case 23:t.doSync({filterId:s});case 24:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(){return e.apply(this,arguments)}}();n.isGuest()?this.doSync({}):(I("Getting saved sync token..."),r=n.store.getSavedSyncToken().then((function(e){return I("Got saved sync token"),a=e,I("Getting saved sync..."),n.store.getSavedSync()})).then((function(e){if(I("Got reply from saved sync, exists? ".concat(!!e)),e)return t.syncFromCache(e)})).catch((function(e){m.logger.error("Getting saved sync failed",e)})),s())}},{key:"stop",value:function(){I("SyncApi.stop"),e.window&&e.window.removeEventListener&&e.window.removeEventListener("online",this.onOnline,!1),this.running=!1,this.currentSyncRequest&&this.currentSyncRequest.abort(),this.keepAliveTimer&&(clearTimeout(this.keepAliveTimer),this.keepAliveTimer=null)}},{key:"retryImmediately",value:function(){return!!this.connectionReturnedDefer&&(this.startKeepAlives(0),!0)}},{key:"syncFromCache",value:function(){var e=o(i.mark((function e(t){var n,r,o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return I("sync(): not doing HTTP hit, instead returning stored /sync data"),n=t.nextBatch,this.client.store.setSyncToken(n),r={oldSyncToken:null,nextSyncToken:n,catchingUp:!1,fromCache:!0},o={next_batch:n,rooms:t.roomsData,groups:t.groupsData,account_data:{events:t.accountData}},e.prev=5,e.next=8,this.processSyncResponse(r,o);case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(5),m.logger.error("Error processing cached sync",e.t0.stack||e.t0);case 13:this.storeIsInvalid||this.updateSyncState(S.SyncState.Prepared,r);case 14:case"end":return e.stop()}}),e,this,[[5,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"doSync",value:function(){var e=o(i.mark((function e(t){var n,r,o,a;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.client,this.running){e.next=6;break}return I("Sync no longer running: exiting."),this.connectionReturnedDefer&&(this.connectionReturnedDefer.reject(),this.connectionReturnedDefer=null),this.updateSyncState(S.SyncState.Stopped),e.abrupt("return");case 6:return r=n.store.getSyncToken(),e.prev=7,null===this.currentSyncRequest&&(this.currentSyncRequest=this.doSyncRequest(t,r)),e.next=11,this.currentSyncRequest;case 11:o=e.sent,e.next=18;break;case 14:return e.prev=14,e.t0=e.catch(7),this.onSyncError(e.t0,t),e.abrupt("return");case 18:return e.prev=18,this.currentSyncRequest=null,e.finish(18);case 21:return n.store.setSyncToken(o.next_batch),this.failedSyncCount=0,e.next=25,n.store.setSyncData(o);case 25:if(a={oldSyncToken:r,nextSyncToken:o.next_batch,catchingUp:this.catchingUp},!this.opts.crypto){e.next=29;break}return e.next=29,this.opts.crypto.onSyncWillProcess(a);case 29:return e.prev=29,e.next=32,this.processSyncResponse(a,o);case 32:e.next=38;break;case 34:e.prev=34,e.t1=e.catch(29),m.logger.error("Caught /sync error",e.t1.stack||e.t1),this.client.emit("sync.unexpectedError",e.t1);case 38:if(a.catchingUp=this.catchingUp,t.hasSyncedBefore||(this.updateSyncState(S.SyncState.Prepared,a),t.hasSyncedBefore=!0),!this.opts.crypto){e.next=43;break}return e.next=43,this.opts.crypto.onSyncCompleted(a);case 43:if(this.updateSyncState(S.SyncState.Syncing,a),!n.store.wantsSave()){e.next=49;break}if(!this.opts.crypto){e.next=48;break}return e.next=48,this.opts.crypto.saveDeviceList(0);case 48:n.store.save();case 49:this.doSync(t);case 50:case"end":return e.stop()}}),e,this,[[7,14,18,21],[29,34]])})));return function(t){return e.apply(this,arguments)}}()},{key:"doSyncRequest",value:function(e,t){var n=this.getSyncParams(e,t);return this.client.http.authedRequest(void 0,"GET","/sync",n,void 0,n.timeout+8e4)}},{key:"getSyncParams",value:function(e,t){var n=this.opts.pollTimeout;("SYNCING"!==this.getSyncState()||this.catchingUp)&&(this.catchingUp=!0,n=0);var r=e.filterId;this.client.isGuest()&&!r&&(r=this.getGuestFilter());var i={filter:r,timeout:n};return this.opts.disablePresence&&(i.set_presence="offline"),t?i.since=t:i._cacheBuster=Date.now(),"ERROR"!=this.getSyncState()&&"RECONNECTING"!=this.getSyncState()||(i.timeout=0),i}},{key:"onSyncError",value:function(e,t){var n=this;if(!this.running)return I("Sync no longer running: exiting"),this.connectionReturnedDefer&&(this.connectionReturnedDefer.reject(),this.connectionReturnedDefer=null),void this.updateSyncState(S.SyncState.Stopped);m.logger.error("/sync error %s",e),m.logger.error(e),this.shouldAbortSync(e)||(this.failedSyncCount++,m.logger.log("Number of consecutive failed sync requests:",this.failedSyncCount),I("Starting keep-alive"),this.startKeepAlives().then((function(e){e&&n.getSyncState()===S.SyncState.Error&&n.updateSyncState(S.SyncState.Catchup,{oldSyncToken:null,nextSyncToken:null,catchingUp:!0}),n.doSync(t)})),this.currentSyncRequest=null,this.updateSyncState(this.failedSyncCount>=3?S.SyncState.Error:S.SyncState.Reconnecting,{error:e}))}},{key:"processSyncResponse",value:function(){var e=o(i.mark((function e(t,n){var r,s,u,c,l,d,h,v,k,b=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.client,n.presence&&Array.isArray(n.presence.events)&&n.presence.events.map(r.getEventMapper()).forEach((function(e){var t=r.store.getUser(e.getSender());t?t.setPresenceEvent(e):((t=R(r,e.getSender())).setPresenceEvent(e),r.store.storeUser(t)),r.emit("event",e)})),n.account_data&&Array.isArray(n.account_data.events)&&(s=n.account_data.events.map(r.getEventMapper()),u=s.reduce((function(e,t){return e[t.getId()]=r.store.getAccountData(t.getType()),e}),{}),r.store.storeAccountDataEvents(s),s.forEach((function(e){if(e.getType()===E.EventType.PushRules){var t=e.getContent();r.pushRules=y.PushProcessor.rewriteDefaultRules(t)}var n=u[e.getId()];return r.emit("accountData",e,n),e}))),n.to_device&&Array.isArray(n.to_device.events)&&n.to_device.events.length>0?(c=[],n.to_device.events.map(r.getEventMapper()).map((function(e){if("m.key.verification.cancel"===e.getType()){var t=e.getContent().transaction_id;t&&c.push(t)}return e})).forEach((function(e){var t=e.getContent();if("m.room.message"!=e.getType()||"m.bad.encrypted"!=t.msgtype){if("m.key.verification.start"===e.getType()||"m.key.verification.request"===e.getType()){var n=t.transaction_id;c.includes(n)&&e.flagCancelled()}r.emit("toDeviceEvent",e)}else m.logger.log("Ignoring undecryptable to-device event from "+e.getSender())}))):this.catchingUp=!1,n.groups&&(n.groups.invite&&this.processGroupSyncEntry(n.groups.invite,w.Category.Invite),n.groups.join&&this.processGroupSyncEntry(n.groups.join,w.Category.Join),n.groups.leave&&this.processGroupSyncEntry(n.groups.leave,w.Category.Leave)),l=[],d=[],h=[],n.rooms&&(n.rooms.invite&&(l=this.mapSyncResponseToRoomArray(n.rooms.invite)),n.rooms.join&&(d=this.mapSyncResponseToRoomArray(n.rooms.join)),n.rooms.leave&&(h=this.mapSyncResponseToRoomArray(n.rooms.leave))),this.notifEvents=[],l.forEach((function(e){var t=e.room,n=b.mapSyncEventsFormat(e.invite_state,t);b.processRoomEvents(t,n),e.isBrandNewRoom&&(t.recalculate(),r.store.storeRoom(t),r.emit("Room",t)),n.forEach((function(e){r.emit("event",e)})),t.updateMyMembership("invite")})),e.next=13,p.promiseMapSeries(d,function(){var e=o(i.mark((function e(n){var s,u,c,l,d,h,v,y,m,k,S,w,E,_;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=n.room,u=b.mapSyncEventsFormat(n.state,s),c=b.mapSyncEventsFormat(n.timeline,s,!1),l=b.mapSyncEventsFormat(n.ephemeral),d=b.mapSyncEventsFormat(n.account_data),h=r.isRoomEncrypted(s.roomId),n.unread_notifications&&(s.setUnreadNotificationCount(f.NotificationCountType.Total,n.unread_notifications.notification_count),(!h||h&&s.getUnreadNotificationCount(f.NotificationCountType.Highlight)<=0)&&s.setUnreadNotificationCount(f.NotificationCountType.Highlight,n.unread_notifications.highlight_count)),n.timeline=n.timeline||{},!n.isBrandNewRoom){e.next=12;break}s.getLiveTimeline().setPaginationToken(n.timeline.prev_batch,g.EventTimeline.BACKWARDS),e.next=26;break;case 12:if(!n.timeline.limited){e.next=26;break}v=!0,y=c.length-1;case 15:if(!(y>=0)){e.next=25;break}if(m=c[y].getId(),!s.getTimelineForEvent(m)){e.next=22;break}return I("Already have event "+m+" in limited sync - not resetting"),v=!1,c.splice(0,y),e.abrupt("break",25);case 22:y--,e.next=15;break;case 25:v&&(b.deregisterStateListeners(s),s.resetLiveTimeline(n.timeline.prev_batch,b.opts.canResetEntireTimeline(s.roomId)?null:t.oldSyncToken),r.resetNotifTimelineSet(),b.registerStateListeners(s));case 26:return k=b.partitionThreadedEvents(c),S=a(k,2),w=S[0],E=S[1],b.processRoomEvents(s,u,w,t.fromCache),b.processThreadEvents(s,E),n.summary&&s.setSummary(n.summary),s.addEphemeralEvents(l),s.addAccountData(d),s.recalculate(),n.isBrandNewRoom&&(r.store.storeRoom(s),r.emit("Room",s)),b.processEventsForNotifs(s,c),_=function(){var e=o(i.mark((function e(t){var n;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.emit("event",t),!t.isState()||"m.room.encryption"!=t.getType()||!b.opts.crypto){e.next=4;break}return e.next=4,b.opts.crypto.onCryptoEvent(t);case 4:t.isState()&&"im.vector.user_status"===t.getType()&&((n=r.store.getUser(t.getStateKey()))?n.unstable_updateStatusMessage(t):((n=R(r,t.getStateKey())).unstable_updateStatusMessage(t),r.store.storeUser(n)));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=38,p.promiseMapSeries(u,_);case 38:return e.next=40,p.promiseMapSeries(w,_);case 40:return e.next=42,p.promiseMapSeries(E,_);case 42:l.forEach((function(e){r.emit("event",e)})),d.forEach((function(e){r.emit("event",e)})),s.updateMyMembership("join"),s.decryptCriticalEvents();case 46:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 13:if(h.forEach((function(e){var t=e.room,n=b.mapSyncEventsFormat(e.state,t),i=b.mapSyncEventsFormat(e.timeline,t),o=b.mapSyncEventsFormat(e.account_data),s=b.partitionThreadedEvents(i),u=a(s,2),c=u[0],l=u[1];b.processRoomEvents(t,n,c),b.processThreadEvents(t,l),t.addAccountData(o),t.recalculate(),e.isBrandNewRoom&&(r.store.storeRoom(t),r.emit("Room",t)),b.processEventsForNotifs(t,i),n.forEach((function(e){r.emit("event",e)})),c.forEach((function(e){r.emit("event",e)})),l.forEach((function(e){r.emit("event",e)})),o.forEach((function(e){r.emit("event",e)})),t.updateMyMembership("leave")})),t.oldSyncToken&&this.notifEvents.length&&(this.notifEvents.sort((function(e,t){return e.getTs()-t.getTs()})),this.notifEvents.forEach((function(e){r.getNotifTimelineSet().addLiveEvent(e)}))),!n.device_lists){e.next=21;break}if(!this.opts.crypto){e.next=21;break}return e.next=19,this.opts.crypto.handleDeviceListChanges(t,n.device_lists);case 19:e.next=21;break;case 21:this.opts.crypto&&n.device_one_time_keys_count&&(v=n.device_one_time_keys_count.signed_curve25519||0,this.opts.crypto.updateOneTimeKeyCount(v)),this.opts.crypto&&n["org.matrix.msc2732.device_unused_fallback_key_types"]&&(k=n["org.matrix.msc2732.device_unused_fallback_key_types"],this.opts.crypto.setNeedsNewFallback(k instanceof Array&&!k.includes("signed_curve25519")));case 23:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"startKeepAlives",value:function(e){return void 0===e&&(e=2e3+Math.floor(5e3*Math.random())),null!==this.keepAliveTimer&&clearTimeout(this.keepAliveTimer),e>0?this.keepAliveTimer=setTimeout(this.pokeKeepAlive.bind(this),e):this.pokeKeepAlive(),this.connectionReturnedDefer||(this.connectionReturnedDefer=p.defer()),this.connectionReturnedDefer.promise}},{key:"pokeKeepAlive",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=function(){clearTimeout(e.keepAliveTimer),e.connectionReturnedDefer&&(e.connectionReturnedDefer.resolve(t),e.connectionReturnedDefer=null)};this.client.http.request(void 0,"GET","/_matrix/client/versions",void 0,void 0,{prefix:"",localTimeoutMs:15e3}).then((function(){n()}),(function(r){400==r.httpStatus||404==r.httpStatus?e.keepAliveTimer=setTimeout(n,2e3):(t=!0,e.keepAliveTimer=setTimeout(e.pokeKeepAlive.bind(e,t),5e3+Math.floor(5e3*Math.random())),e.updateSyncState(S.SyncState.Error,{error:r}))}))}},{key:"processGroupSyncEntry",value:function(e,t){for(var n=0,r=Object.keys(e);n<r.length;n++){var i=r[n],o=e[i],a=this.client.store.getGroup(i),s=null===a;null===a&&(a=this.createGroup(i)),o.profile&&a.setProfile(o.profile.name,o.profile.avatar_url),o.inviter&&a.setInviter({userId:o.inviter}),a.setMyMembership(t),s&&this.client.emit("Group",a)}}},{key:"mapSyncResponseToRoomArray",value:function(e){var t=this,n=this.client;return Object.keys(e).map((function(r){var i=e[r],o=n.store.getRoom(r),a=!1;return o||(o=t.createRoom(r),a=!0),i.room=o,i.isBrandNewRoom=a,i}))}},{key:"mapSyncEventsFormat",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!e||!Array.isArray(e.events))return[];var r=this.client.getEventMapper({decrypt:n});return e.events.map((function(e){return t&&(e.room_id=t.roomId),r(e)}))}},{key:"resolveInvites",value:function(e){if(e&&this.opts.resolveInvitesToProfiles){var t=this.client;e.getMembersWithMembership("invite").forEach((function(n){if(!n._requestedProfileInfo){n._requestedProfileInfo=!0;var r=t.getUser(n.userId);(r?Promise.resolve({avatar_url:r.avatarUrl,displayname:r.displayName}):t.getProfileInfo(n.userId)).then((function(t){var r=n.events.member;"invite"===r.getContent().membership&&(r.getContent().avatar_url=t.avatar_url,r.getContent().displayname=t.displayname,n.setMembershipEvent(r,e.currentState))}),(function(e){}))}}))}}},{key:"processRoomEvents",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=e.getLiveTimeline(),a=0==o.getEvents().length;if(a){var s,u=r(t);try{for(u.s();!(s=u.n()).done;){var c=s.value;this.client.getPushActionsForEvent(c)}}catch(l){u.e(l)}finally{u.f()}o.initialiseState(t)}this.resolveInvites(e),e.recalculate(),a||(e.oldState.setStateEvents(t||[]),e.currentState.setStateEvents(t||[])),e.addLiveEvents(n||[],null,i)}},{key:"processThreadEvents",value:function(e,t){t.sort((function(e,t){return e.getTs()-t.getTs()})).forEach((function(t){e.addThreadedEvent(t)}))}},{key:"processEventsForNotifs",value:function(e,t){if(this.client.getNotifTimelineSet())for(var n=0;n<t.length;n++){var r=this.client.getPushActionsForEvent(t[n]);r&&r.notify&&r.tweaks&&r.tweaks.highlight&&this.notifEvents.push(t[n])}}},{key:"getGuestFilter",value:function(){return"{}"}},{key:"updateSyncState",value:function(e,t){var n=this.syncState;this.syncState=e,this.syncStateData=t,this.client.emit("sync",this.syncState,n,t)}}]),t}();function R(e,t){var n=new d.User(t);return e.reEmitter.reEmit(n,["User.avatarUrl","User.displayName","User.presence","User.currentlyActive","User.lastPresenceTs"]),n}t.SyncApi=T}).call(this,n(14))},function(e,t,n){var r=n(30);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r(e)););return e}},function(e,t,n){"use strict";var r=n(21),i=n(6),o=n(7),a=n(0),s=n(2),u=n(11),c=n(9),l=n(10),d=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.Relations=void 0;var f=d(n(3)),h=n(15),p=n(18),v=n(5),g=n(17),y=function(e){c(n,e);var t=l(n);function n(e,r,s){var c;return a(this,n),(c=t.call(this)).relationType=e,c.eventType=r,c.room=s,(0,f.default)(u(c),"relationEventIds",new Set),(0,f.default)(u(c),"relations",new Set),(0,f.default)(u(c),"annotationsByKey",{}),(0,f.default)(u(c),"annotationsBySender",{}),(0,f.default)(u(c),"sortedAnnotationsByKey",[]),(0,f.default)(u(c),"targetEvent",null),(0,f.default)(u(c),"creationEmitted",!1),(0,f.default)(u(c),"onEventStatus",(function(e,t){e.isSending()?t===p.EventStatus.CANCELLED&&(e.removeListener("Event.status",c.onEventStatus),c.removeEvent(e)):e.removeListener("Event.status",c.onEventStatus)})),(0,f.default)(u(c),"onBeforeRedaction",function(){var e=o(i.mark((function e(t){var n;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.relations.has(t)){e.next=2;break}return e.abrupt("return");case 2:if(c.relations.delete(t),c.relationType!==g.RelationType.Annotation){e.next=7;break}c.removeAnnotationFromAggregation(t),e.next=12;break;case 7:if(c.relationType!==g.RelationType.Replace||!c.targetEvent){e.next=12;break}return e.next=10,c.getLastReplacement();case 10:n=e.sent,c.targetEvent.makeReplaced(n);case 12:t.removeListener("Event.beforeRedaction",c.onBeforeRedaction),c.emit("Relations.redaction",t);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),c}return s(n,[{key:"addEvent",value:function(){var e=o(i.mark((function e(t){var n,r,o,a;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.relationEventIds.has(t.getId())){e.next=2;break}return e.abrupt("return");case 2:if(n=t.getRelation()){e.next=6;break}return v.logger.error("Event must have relation info"),e.abrupt("return");case 6:if(r=n.rel_type,o=t.getType(),this.relationType===r&&this.eventType===o){e.next=11;break}return v.logger.error("Event relation info doesn't match this container"),e.abrupt("return");case 11:if(t.isSending()&&t.on("Event.status",this.onEventStatus),this.relations.add(t),this.relationEventIds.add(t.getId()),this.relationType!==g.RelationType.Annotation){e.next=18;break}this.addAnnotationToAggregation(t),e.next=23;break;case 18:if(this.relationType!==g.RelationType.Replace||!this.targetEvent){e.next=23;break}return e.next=21,this.getLastReplacement();case 21:a=e.sent,this.targetEvent.makeReplaced(a);case 23:t.on("Event.beforeRedaction",this.onBeforeRedaction),this.emit("Relations.add",t),this.maybeEmitCreated();case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"removeEvent",value:function(){var e=o(i.mark((function e(t){var n,r,o,a;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.relations.has(t)){e.next=2;break}return e.abrupt("return");case 2:if(n=t.getRelation()){e.next=6;break}return v.logger.error("Event must have relation info"),e.abrupt("return");case 6:if(r=n.rel_type,o=t.getType(),this.relationType===r&&this.eventType===o){e.next=11;break}return v.logger.error("Event relation info doesn't match this container"),e.abrupt("return");case 11:if(this.relations.delete(t),this.relationType!==g.RelationType.Annotation){e.next=16;break}this.removeAnnotationFromAggregation(t),e.next=21;break;case 16:if(this.relationType!==g.RelationType.Replace||!this.targetEvent){e.next=21;break}return e.next=19,this.getLastReplacement();case 19:a=e.sent,this.targetEvent.makeReplaced(a);case 21:this.emit("Relations.remove",t);case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRelations",value:function(){return r(this.relations)}},{key:"addAnnotationToAggregation",value:function(e){var t=e.getRelation().key;if(t){var n=this.annotationsByKey[t];n||(n=this.annotationsByKey[t]=new Set,this.sortedAnnotationsByKey.push([t,n])),n.add(e),this.sortedAnnotationsByKey.sort((function(e,t){var n=e[1];return t[1].size-n.size}));var r=e.getSender(),i=this.annotationsBySender[r];i||(i=this.annotationsBySender[r]=new Set),i.add(e)}}},{key:"removeAnnotationFromAggregation",value:function(e){var t=e.getRelation().key;if(t){var n=this.annotationsByKey[t];n&&(n.delete(e),this.sortedAnnotationsByKey.sort((function(e,t){var n=e[1];return t[1].size-n.size})));var r=e.getSender(),i=this.annotationsBySender[r];i&&i.delete(e)}}},{key:"getSortedAnnotationsByKey",value:function(){return this.relationType!==g.RelationType.Annotation?null:this.sortedAnnotationsByKey}},{key:"getAnnotationsBySender",value:function(){return this.relationType!==g.RelationType.Annotation?null:this.annotationsBySender}},{key:"getLastReplacement",value:function(){var e=o(i.mark((function e(){var t,n,r,o=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.relationType===g.RelationType.Replace){e.next=2;break}return e.abrupt("return",null);case 2:if(this.targetEvent){e.next=4;break}return e.abrupt("return",null);case 4:if(t=this.targetEvent.getServerAggregatedRelation(g.RelationType.Replace),n=t&&t.origin_server_ts,null===(r=this.getRelations().reduce((function(e,t){return t.getSender()!==o.targetEvent.getSender()||n&&n>t.getTs()||e&&e.getTs()>t.getTs()?e:t}),null))||void 0===r||!r.shouldAttemptDecryption()){e.next=12;break}return e.next=10,r.attemptDecryption(this.room.client.crypto);case 10:e.next=15;break;case 12:if(null===r||void 0===r||!r.isBeingDecrypted()){e.next=15;break}return e.next=15,r.getDecryptionPromise();case 15:return e.abrupt("return",r);case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setTargetEvent",value:function(){var e=o(i.mark((function e(t){var n;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.targetEvent){e.next=2;break}return e.abrupt("return");case 2:if(this.targetEvent=t,this.relationType!==g.RelationType.Replace){e.next=8;break}return e.next=6,this.getLastReplacement();case 6:(n=e.sent)&&this.targetEvent.makeReplaced(n);case 8:this.maybeEmitCreated();case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"maybeEmitCreated",value:function(){this.creationEmitted||this.targetEvent&&this.relations.size&&(this.creationEmitted=!0,this.targetEvent.emit("Event.relationsCreated",this.relationType,this.eventType))}}]),n}(h.EventEmitter);t.Relations=y},function(e,t,n){"use strict";var r=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.RoomSummary=void 0;t.RoomSummary=function e(t,n){r(this,e),this.roomId=t}},function(e,t,n){"use strict";var r=n(0),i=n(2);Object.defineProperty(t,"__esModule",{value:!0}),t.FilterComponent=void 0;var o=function(){function e(t){r(this,e),this.filterJson=t}return i(e,[{key:"check",value:function(e){return this.checkFields(e.getRoomId(),e.getSender(),e.getType(),!!e.getContent()&&void 0!==e.getContent().url)}},{key:"toJSON",value:function(){return{types:this.filterJson.types||null,not_types:this.filterJson.not_types||[],rooms:this.filterJson.rooms||null,not_rooms:this.filterJson.not_rooms||[],senders:this.filterJson.senders||null,not_senders:this.filterJson.not_senders||[],contains_url:this.filterJson.contains_url||null}}},{key:"checkFields",value:function(e,t,n,r){for(var i={rooms:function(t){return e===t},senders:function(e){return t===e},types:function(e){return function(e,t){if(t.endsWith("*")){var n=t.slice(0,-1);return e.substr(0,n.length)===n}return e===t}(n,e)}},o=0;o<Object.keys(i).length;o++){var a=Object.keys(i)[o],s=i[a],u="not_"+a,c=this.filterJson[u];if(null!==c&&void 0!==c&&c.some(s))return!1;var l=this.filterJson[a];if(l&&!l.some(s))return!1}var d=this.filterJson.contains_url;return void 0===d||d===r}},{key:"filter",value:function(e){return e.filter(this.check,this)}},{key:"limit",value:function(){return void 0!==this.filterJson.limit?this.filterJson.limit:10}}]),e}();t.FilterComponent=o},function(e,t,n){"use strict";var r=n(0),i=n(2),o=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.StubStore=void 0;var a=o(n(3)),s=function(){function e(){r(this,e),(0,a.default)(this,"accountData",{}),(0,a.default)(this,"fromToken",null)}return i(e,[{key:"isNewlyCreated",value:function(){return Promise.resolve(!0)}},{key:"getSyncToken",value:function(){return this.fromToken}},{key:"setSyncToken",value:function(e){this.fromToken=e}},{key:"storeGroup",value:function(e){}},{key:"getGroup",value:function(e){return null}},{key:"getGroups",value:function(){return[]}},{key:"storeRoom",value:function(e){}},{key:"getRoom",value:function(e){return null}},{key:"getRooms",value:function(){return[]}},{key:"removeRoom",value:function(e){}},{key:"getRoomSummaries",value:function(){return[]}},{key:"storeUser",value:function(e){}},{key:"getUser",value:function(e){return null}},{key:"getUsers",value:function(){return[]}},{key:"scrollback",value:function(e,t){return[]}},{key:"storeEvents",value:function(e,t,n,r){}},{key:"storeFilter",value:function(e){}},{key:"getFilter",value:function(e,t){return null}},{key:"getFilterIdByName",value:function(e){return null}},{key:"setFilterIdByName",value:function(e,t){}},{key:"storeAccountDataEvents",value:function(e){}},{key:"getAccountData",value:function(e){}},{key:"setSyncData",value:function(e){return Promise.resolve()}},{key:"wantsSave",value:function(){return!1}},{key:"save",value:function(){}},{key:"startup",value:function(){return Promise.resolve()}},{key:"getSavedSync",value:function(){return Promise.resolve(null)}},{key:"getSavedSyncToken",value:function(){return Promise.resolve(null)}},{key:"deleteAllData",value:function(){return Promise.resolve()}},{key:"getOutOfBandMembers",value:function(){return Promise.resolve(null)}},{key:"setOutOfBandMembers",value:function(e,t){return Promise.resolve()}},{key:"clearOutOfBandMembers",value:function(){return Promise.resolve()}},{key:"getClientOptions",value:function(){return Promise.resolve({})}},{key:"storeClientOptions",value:function(e){return Promise.resolve()}}]),e}();t.StubStore=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SDPStreamMetadataPurpose=t.SDPStreamMetadataKey=void 0;var r;t.SDPStreamMetadataKey="org.matrix.msc3077.sdp_stream_metadata",t.SDPStreamMetadataPurpose=r,function(e){e.Usermedia="m.usermedia",e.Screenshare="m.screenshare"}(r||(t.SDPStreamMetadataPurpose=r={}))},function(e,t,n){"use strict";var r=n(0),i=n(2),o=n(11),a=n(9),s=n(10),u=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.CallFeed=t.CallFeedEvent=void 0;var c,l=u(n(3)),d=u(n(15));t.CallFeedEvent=c,function(e){e.NewStream="new_stream",e.MuteStateChanged="mute_state_changed",e.VolumeChanged="volume_changed",e.Speaking="speaking"}(c||(t.CallFeedEvent=c={}));var f=function(e){a(n,e);var t=s(n);function n(e){var i;return r(this,n),i=t.call(this),(0,l.default)(o(i),"stream",void 0),(0,l.default)(o(i),"userId",void 0),(0,l.default)(o(i),"purpose",void 0),(0,l.default)(o(i),"client",void 0),(0,l.default)(o(i),"roomId",void 0),(0,l.default)(o(i),"audioMuted",void 0),(0,l.default)(o(i),"videoMuted",void 0),(0,l.default)(o(i),"measuringVolumeActivity",!1),(0,l.default)(o(i),"audioContext",void 0),(0,l.default)(o(i),"analyser",void 0),(0,l.default)(o(i),"frequencyBinCount",void 0),(0,l.default)(o(i),"speakingThreshold",-60),(0,l.default)(o(i),"speaking",!1),(0,l.default)(o(i),"volumeLooperTimeout",void 0),(0,l.default)(o(i),"onAddTrack",(function(){i.emit(c.NewStream,i.stream)})),i.client=e.client,i.roomId=e.roomId,i.userId=e.userId,i.purpose=e.purpose,i.audioMuted=e.audioMuted,i.videoMuted=e.videoMuted,i.updateStream(null,e.stream),i.hasAudioTrack&&i.initVolumeMeasuring(),i}return i(n,[{key:"hasAudioTrack",get:function(){return this.stream.getAudioTracks().length>0}},{key:"updateStream",value:function(e,t){e&&(e.removeEventListener("addtrack",this.onAddTrack),this.measureVolumeActivity(!1)),t&&(this.stream=t,t.addEventListener("addtrack",this.onAddTrack),this.hasAudioTrack?this.initVolumeMeasuring():this.measureVolumeActivity(!1)),this.emit(c.NewStream,this.stream)}},{key:"initVolumeMeasuring",value:function(){var e=window.AudioContext||window.webkitAudioContext;this.hasAudioTrack&&e&&(this.audioContext=new e,this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=512,this.analyser.smoothingTimeConstant=.1,this.audioContext.createMediaStreamSource(this.stream).connect(this.analyser),this.frequencyBinCount=new Float32Array(this.analyser.frequencyBinCount))}},{key:"getMember",value:function(){return this.client.getRoom(this.roomId).getMember(this.userId)}},{key:"isLocal",value:function(){return this.userId===this.client.getUserId()}},{key:"isAudioMuted",value:function(){return 0===this.stream.getAudioTracks().length||this.audioMuted}},{key:"isVideoMuted",value:function(){return 0===this.stream.getVideoTracks().length||this.videoMuted}},{key:"setNewStream",value:function(e){this.updateStream(this.stream,e)}},{key:"setAudioMuted",value:function(e){this.audioMuted=e,this.emit(c.MuteStateChanged,this.audioMuted,this.videoMuted)}},{key:"setVideoMuted",value:function(e){this.videoMuted=e,this.emit(c.MuteStateChanged,this.audioMuted,this.videoMuted)}},{key:"measureVolumeActivity",value:function(e){if(e){if(!this.audioContext||!this.analyser||!this.frequencyBinCount||!this.hasAudioTrack)return;this.measuringVolumeActivity=!0,this.volumeLooper()}else this.measuringVolumeActivity=!1,this.emit(c.VolumeChanged,-1/0)}},{key:"setSpeakingThreshold",value:function(e){this.speakingThreshold=e}},{key:"volumeLooper",value:function(){var e=this;this.analyser&&(this.volumeLooperTimeout=setTimeout((function(){if(e.measuringVolumeActivity){e.analyser.getFloatFrequencyData(e.frequencyBinCount);for(var t=-1/0,n=0;n<e.frequencyBinCount.length;n++)e.frequencyBinCount[n]>t&&(t=e.frequencyBinCount[n]);e.emit(c.VolumeChanged,t);var r=t>e.speakingThreshold;e.speaking!==r&&(e.speaking=r,e.emit(c.Speaking,e.speaking)),e.volumeLooper()}}),250))}},{key:"dispose",value:function(){clearTimeout(this.volumeLooperTimeout)}}]),n}(d.default);t.CallFeed=f},function(e,t,n){"use strict";var r=n(6),i=n(8),o=n(7),a=n(0),s=n(2),u=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.CallEventHandler=void 0;var c=u(n(3)),l=n(5),d=n(52),f=n(17),h=function(){function e(t){var n=this;a(this,e),(0,c.default)(this,"client",void 0),(0,c.default)(this,"calls",void 0),(0,c.default)(this,"callEventBuffer",void 0),(0,c.default)(this,"candidateEventsByCall",void 0),(0,c.default)(this,"evaluateEventBuffer",o(r.mark((function e(){var t,o,a,s,u,c,d;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("SYNCING"!==n.client.getSyncState()){e.next=32;break}return e.next=3,Promise.all(n.callEventBuffer.map((function(e){n.client.decryptEventIfNeeded(e)})));case 3:t=new Set,o=i(n.callEventBuffer);try{for(o.s();!(a=o.n()).done;)(s=a.value).getType()!==f.EventType.CallAnswer&&s.getType()!==f.EventType.CallHangup||t.add(s.getContent().call_id)}catch(r){o.e(r)}finally{o.f()}u=i(n.callEventBuffer),e.prev=7,u.s();case 9:if((c=u.n()).done){e.next=23;break}if((d=c.value).getType()!==f.EventType.CallInvite||!t.has(d.getContent().call_id)){e.next=13;break}return e.abrupt("continue",21);case 13:return e.prev=13,e.next=16,n.handleCallEvent(d);case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(13),l.logger.error("Caught exception handling call event",e.t0);case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),u.e(e.t1);case 28:return e.prev=28,u.f(),e.finish(28);case 31:n.callEventBuffer=[];case 32:case"end":return e.stop()}}),e,null,[[7,25,28,31],[13,18]])})))),(0,c.default)(this,"onRoomTimeline",(function(e){n.client.decryptEventIfNeeded(e),(n.eventIsACall(e)||e.isBeingDecrypted())&&n.callEventBuffer.push(e),(e.isBeingDecrypted()||e.isDecryptionFailure())&&e.once("Event.decrypted",o(r.mark((function t(){return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.eventIsACall(e)){t.next=2;break}return t.abrupt("return");case 2:if(!n.callEventBuffer.includes(e)){t.next=6;break}n.evaluateEventBuffer(),t.next=14;break;case 6:return t.prev=6,t.next=9,n.handleCallEvent(e);case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(6),l.logger.error("Caught exception handling call event",t.t0);case 14:case"end":return t.stop()}}),t,null,[[6,11]])}))))})),this.client=t,this.calls=new Map,this.callEventBuffer=[],this.candidateEventsByCall=new Map}return s(e,[{key:"start",value:function(){this.client.on("sync",this.evaluateEventBuffer),this.client.on("Room.timeline",this.onRoomTimeline)}},{key:"stop",value:function(){this.client.removeListener("sync",this.evaluateEventBuffer),this.client.removeListener("Room.timeline",this.onRoomTimeline)}},{key:"eventIsACall",value:function(e){var t=e.getType();return t.startsWith("m.call.")||t.startsWith("org.matrix.call.")}},{key:"handleCallEvent",value:function(){var e=o(r.mark((function e(t){var n,o,a,s,u,c,h,p,v,g,y,m,k;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.getContent(),o=t.getType(),a=t.getSender()===this.client.credentials.userId,s=n.call_id?this.calls.get(n.call_id):void 0,o!==f.EventType.CallInvite){e.next=46;break}if(!a){e.next=7;break}return e.abrupt("return");case 7:if(!(t.getLocalAge()>n.lifetime-3e3)){e.next=9;break}return e.abrupt("return");case 9:if(!s||s.state!==d.CallState.Ended){e.next=11;break}return e.abrupt("return");case 11:if(s&&l.logger.log("WARN: Already have a MatrixCall with id ".concat(n.call_id," but got an ")+"invite. Clobbering."),u=this.client.getTurnServersExpiry()-Date.now(),l.logger.info("Current turn creds expire in "+u+" ms"),s=(0,d.createNewMatrixCall)(this.client,t.getRoomId(),{forceTURN:this.client.forceTURN})){e.next=18;break}return l.logger.log("Incoming call ID "+n.call_id+" but this client doesn't support WebRTC"),e.abrupt("return");case 18:return s.callId=n.call_id,e.next=21,s.initWithInvite(t);case 21:if(this.calls.set(s.callId,s),this.candidateEventsByCall.get(s.callId)){c=i(this.candidateEventsByCall.get(s.callId));try{for(c.s();!(h=c.n()).done;)p=h.value,s.onRemoteIceCandidatesReceived(p)}catch(r){c.e(r)}finally{c.f()}}g=i(this.calls.values()),e.prev=24,g.s();case 26:if((y=g.n()).done){e.next=34;break}if(m=y.value,k=[d.CallState.WaitLocalMedia,d.CallState.CreateOffer,d.CallState.InviteSent].includes(m.state),s.roomId!==m.roomId||m.direction!==d.CallDirection.Outbound||!k){e.next=32;break}return v=m,e.abrupt("break",34);case 32:e.next=26;break;case 34:e.next=39;break;case 36:e.prev=36,e.t0=e.catch(24),g.e(e.t0);case 39:return e.prev=39,g.f(),e.finish(39);case 42:return v?v.state===d.CallState.WaitLocalMedia||v.state===d.CallState.CreateOffer||v.callId>s.callId?(l.logger.log("Glare detected: answering incoming call "+s.callId+" and canceling outgoing call "+v.callId),v.replacedBy(s),s.answer()):(l.logger.log("Glare detected: rejecting incoming call "+s.callId+" and keeping outgoing call "+v.callId),s.hangup(d.CallErrorCode.Replaced,!0)):this.client.emit("Call.incoming",s),e.abrupt("return");case 46:if(o!==f.EventType.CallCandidates){e.next=53;break}if(!a){e.next=49;break}return e.abrupt("return");case 49:return s?s.onRemoteIceCandidatesReceived(t):(this.candidateEventsByCall.has(n.call_id)||this.candidateEventsByCall.set(n.call_id,[]),this.candidateEventsByCall.get(n.call_id).push(t)),e.abrupt("return");case 53:if(![f.EventType.CallHangup,f.EventType.CallReject].includes(o)){e.next=56;break}return s?s.state!==d.CallState.Ended&&(o===f.EventType.CallHangup?s.onHangupReceived(n):s.onRejectReceived(n),this.calls.delete(n.call_id)):(s=(0,d.createNewMatrixCall)(this.client,t.getRoomId()))&&(s.callId=n.call_id,s.initWithHangup(t),this.calls.set(n.call_id,s)),e.abrupt("return");case 56:if(s&&s.hasPeerConnection){e.next=59;break}return l.logger.warn("Discarding an event, we don't have a call/peerConn",o),e.abrupt("return");case 59:if(t.getContent().party_id!==s.ourPartyId){e.next=61;break}return e.abrupt("return");case 61:e.t1=o,e.next=e.t1===f.EventType.CallAnswer?64:e.t1===f.EventType.CallSelectAnswer?66:e.t1===f.EventType.CallNegotiate?68:e.t1===f.EventType.CallAssertedIdentity||e.t1===f.EventType.CallAssertedIdentityPrefix?70:e.t1===f.EventType.CallSDPStreamMetadataChanged||e.t1===f.EventType.CallSDPStreamMetadataChangedPrefix?72:74;break;case 64:return a?s.state===d.CallState.Ringing&&s.onAnsweredElsewhere(n):s.onAnswerReceived(t),e.abrupt("break",74);case 66:return s.onSelectAnswerReceived(t),e.abrupt("break",74);case 68:return s.onNegotiateReceived(t),e.abrupt("break",74);case 70:return s.onAssertedIdentityReceived(t),e.abrupt("break",74);case 72:return s.onSDPStreamMetadataChangedReceived(t),e.abrupt("break",74);case 74:case"end":return e.stop()}}),e,this,[[24,36,39,42]])})));return function(t){return e.apply(this,arguments)}}()}]),e}();t.CallEventHandler=h},function(e,t,n){"use strict";var r=n(124),i=n(126);function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=k,t.resolve=function(e,t){return k(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?k(e,!1,!0).resolveObject(t):t},t.format=function(e){i.isString(e)&&(e=k(e));return e instanceof o?e.format():o.prototype.format.call(e)},t.Url=o;var a=/^([a-z0-9.+-]+:)/i,s=/:[0-9]*$/,u=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),l=["'"].concat(c),d=["%","/","?",";","#"].concat(l),f=["/","?","#"],h=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,v={javascript:!0,"javascript:":!0},g={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},m=n(127);function k(e,t,n){if(e&&i.isObject(e)&&e instanceof o)return e;var r=new o;return r.parse(e,t,n),r}o.prototype.parse=function(e,t,n){if(!i.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var o=e.indexOf("?"),s=-1!==o&&o<e.indexOf("#")?"?":"#",c=e.split(s);c[0]=c[0].replace(/\\/g,"/");var k=e=c.join(s);if(k=k.trim(),!n&&1===e.split("#").length){var b=u.exec(k);if(b)return this.path=k,this.href=k,this.pathname=b[1],b[2]?(this.search=b[2],this.query=t?m.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var S=a.exec(k);if(S){var w=(S=S[0]).toLowerCase();this.protocol=w,k=k.substr(S.length)}if(n||S||k.match(/^\/\/[^@\/]+@[^@\/]+/)){var E="//"===k.substr(0,2);!E||S&&g[S]||(k=k.substr(2),this.slashes=!0)}if(!g[S]&&(E||S&&!y[S])){for(var _,x,I=-1,T=0;T<f.length;T++){-1!==(R=k.indexOf(f[T]))&&(-1===I||R<I)&&(I=R)}-1!==(x=-1===I?k.lastIndexOf("@"):k.lastIndexOf("@",I))&&(_=k.slice(0,x),k=k.slice(x+1),this.auth=decodeURIComponent(_)),I=-1;for(T=0;T<d.length;T++){var R;-1!==(R=k.indexOf(d[T]))&&(-1===I||R<I)&&(I=R)}-1===I&&(I=k.length),this.host=k.slice(0,I),k=k.slice(I),this.parseHost(),this.hostname=this.hostname||"";var O="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!O)for(var C=this.hostname.split(/\./),P=(T=0,C.length);T<P;T++){var D=C[T];if(D&&!D.match(h)){for(var A="",M=0,U=D.length;M<U;M++)D.charCodeAt(M)>127?A+="x":A+=D[M];if(!A.match(h)){var N=C.slice(0,T),L=C.slice(T+1),j=D.match(p);j&&(N.push(j[1]),L.unshift(j[2])),L.length&&(k="/"+L.join(".")+k),this.hostname=N.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),O||(this.hostname=r.toASCII(this.hostname));var B=this.port?":"+this.port:"",K=this.hostname||"";this.host=K+B,this.href+=this.host,O&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==k[0]&&(k="/"+k))}if(!v[w])for(T=0,P=l.length;T<P;T++){var F=l[T];if(-1!==k.indexOf(F)){var q=encodeURIComponent(F);q===F&&(q=escape(F)),k=k.split(F).join(q)}}var V=k.indexOf("#");-1!==V&&(this.hash=k.substr(V),k=k.slice(0,V));var G=k.indexOf("?");if(-1!==G?(this.search=k.substr(G),this.query=k.substr(G+1),t&&(this.query=m.parse(this.query)),k=k.slice(0,G)):t&&(this.search="",this.query={}),k&&(this.pathname=k),y[w]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){B=this.pathname||"";var W=this.search||"";this.path=B+W}return this.href=this.format(),this},o.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",o=!1,a="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&i.isObject(this.query)&&Object.keys(this.query).length&&(a=m.stringify(this.query));var s=this.search||a&&"?"+a||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||y[t])&&!1!==o?(o="//"+(o||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):o||(o=""),r&&"#"!==r.charAt(0)&&(r="#"+r),s&&"?"!==s.charAt(0)&&(s="?"+s),t+o+(n=n.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(s=s.replace("#","%23"))+r},o.prototype.resolve=function(e){return this.resolveObject(k(e,!1,!0)).format()},o.prototype.resolveObject=function(e){if(i.isString(e)){var t=new o;t.parse(e,!1,!0),e=t}for(var n=new o,r=Object.keys(this),a=0;a<r.length;a++){var s=r[a];n[s]=this[s]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var u=Object.keys(e),c=0;c<u.length;c++){var l=u[c];"protocol"!==l&&(n[l]=e[l])}return y[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!y[e.protocol]){for(var d=Object.keys(e),f=0;f<d.length;f++){var h=d[f];n[h]=e[h]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||g[e.protocol])n.pathname=e.pathname;else{for(var p=(e.pathname||"").split("/");p.length&&!(e.host=p.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),n.pathname=p.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var v=n.pathname||"",m=n.search||"";n.path=v+m}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var k=n.pathname&&"/"===n.pathname.charAt(0),b=e.host||e.pathname&&"/"===e.pathname.charAt(0),S=b||k||n.host&&e.pathname,w=S,E=n.pathname&&n.pathname.split("/")||[],_=(p=e.pathname&&e.pathname.split("/")||[],n.protocol&&!y[n.protocol]);if(_&&(n.hostname="",n.port=null,n.host&&(""===E[0]?E[0]=n.host:E.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),S=S&&(""===p[0]||""===E[0])),b)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,E=p;else if(p.length)E||(E=[]),E.pop(),E=E.concat(p),n.search=e.search,n.query=e.query;else if(!i.isNullOrUndefined(e.search)){if(_)n.hostname=n.host=E.shift(),(O=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=O.shift(),n.host=n.hostname=O.shift());return n.search=e.search,n.query=e.query,i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!E.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var x=E.slice(-1)[0],I=(n.host||e.host||E.length>1)&&("."===x||".."===x)||""===x,T=0,R=E.length;R>=0;R--)"."===(x=E[R])?E.splice(R,1):".."===x?(E.splice(R,1),T++):T&&(E.splice(R,1),T--);if(!S&&!w)for(;T--;T)E.unshift("..");!S||""===E[0]||E[0]&&"/"===E[0].charAt(0)||E.unshift(""),I&&"/"!==E.join("/").substr(-1)&&E.push("");var O,C=""===E[0]||E[0]&&"/"===E[0].charAt(0);_&&(n.hostname=n.host=C?"":E.length?E.shift():"",(O=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=O.shift(),n.host=n.hostname=O.shift()));return(S=S||n.host&&E.length)&&!C&&E.unshift(""),E.length?n.pathname=E.join("/"):(n.pathname=null,n.path=null),i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},o.prototype.parseHost=function(){var e=this.host,t=s.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,t,n){(function(e,r){var i;!function(o){t&&t.nodeType,e&&e.nodeType;var a="object"==typeof r&&r;a.global!==a&&a.window!==a&&a.self;var s,u=2147483647,c=36,l=/^xn--/,d=/[^\x20-\x7E]/,f=/[\x2E\u3002\uFF0E\uFF61]/g,h={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},p=Math.floor,v=String.fromCharCode;function g(e){throw new RangeError(h[e])}function y(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function m(e,t){var n=e.split("@"),r="";return n.length>1&&(r=n[0]+"@",e=n[1]),r+y((e=e.replace(f,".")).split("."),t).join(".")}function k(e){for(var t,n,r=[],i=0,o=e.length;i<o;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<o?56320==(64512&(n=e.charCodeAt(i++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--):r.push(t);return r}function b(e){return y(e,(function(e){var t="";return e>65535&&(t+=v((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=v(e)})).join("")}function S(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function w(e,t,n){var r=0;for(e=n?p(e/700):e>>1,e+=p(e/t);e>455;r+=c)e=p(e/35);return p(r+36*e/(e+38))}function E(e){var t,n,r,i,o,a,s,l,d,f,h,v=[],y=e.length,m=0,k=128,S=72;for((n=e.lastIndexOf("-"))<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&g("not-basic"),v.push(e.charCodeAt(r));for(i=n>0?n+1:0;i<y;){for(o=m,a=1,s=c;i>=y&&g("invalid-input"),((l=(h=e.charCodeAt(i++))-48<10?h-22:h-65<26?h-65:h-97<26?h-97:c)>=c||l>p((u-m)/a))&&g("overflow"),m+=l*a,!(l<(d=s<=S?1:s>=S+26?26:s-S));s+=c)a>p(u/(f=c-d))&&g("overflow"),a*=f;S=w(m-o,t=v.length+1,0==o),p(m/t)>u-k&&g("overflow"),k+=p(m/t),m%=t,v.splice(m++,0,k)}return b(v)}function _(e){var t,n,r,i,o,a,s,l,d,f,h,y,m,b,E,_=[];for(y=(e=k(e)).length,t=128,n=0,o=72,a=0;a<y;++a)(h=e[a])<128&&_.push(v(h));for(r=i=_.length,i&&_.push("-");r<y;){for(s=u,a=0;a<y;++a)(h=e[a])>=t&&h<s&&(s=h);for(s-t>p((u-n)/(m=r+1))&&g("overflow"),n+=(s-t)*m,t=s,a=0;a<y;++a)if((h=e[a])<t&&++n>u&&g("overflow"),h==t){for(l=n,d=c;!(l<(f=d<=o?1:d>=o+26?26:d-o));d+=c)E=l-f,b=c-f,_.push(v(S(f+E%b,0))),l=p(E/b);_.push(v(S(l,0))),o=w(n,m,r==i),n=0,++r}++n,++t}return _.join("")}s={version:"1.4.1",ucs2:{decode:k,encode:b},decode:E,encode:_,toASCII:function(e){return m(e,(function(e){return d.test(e)?"xn--"+_(e):e}))},toUnicode:function(e){return m(e,(function(e){return l.test(e)?E(e.slice(4).toLowerCase()):e}))}},void 0===(i=function(){return s}.call(t,n,t,e))||(e.exports=i)}()}).call(this,n(125)(e),n(14))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";e.exports={isString:function(e){return"string"===typeof e},isObject:function(e){return"object"===typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t,n){"use strict";t.decode=t.parse=n(128),t.encode=t.stringify=n(129)},function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,n,o){t=t||"&",n=n||"=";var a={};if("string"!==typeof e||0===e.length)return a;var s=/\+/g;e=e.split(t);var u=1e3;o&&"number"===typeof o.maxKeys&&(u=o.maxKeys);var c=e.length;u>0&&c>u&&(c=u);for(var l=0;l<c;++l){var d,f,h,p,v=e[l].replace(s,"%20"),g=v.indexOf(n);g>=0?(d=v.substr(0,g),f=v.substr(g+1)):(d=v,f=""),h=decodeURIComponent(d),p=decodeURIComponent(f),r(a,h)?i(a[h])?a[h].push(p):a[h]=[a[h],p]:a[h]=p}return a};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,n){"use strict";var r=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,n,s){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"===typeof e?o(a(e),(function(a){var s=encodeURIComponent(r(a))+n;return i(e[a])?o(e[a],(function(e){return s+encodeURIComponent(r(e))})).join(t):s+encodeURIComponent(r(e[a]))})).join(t):s?encodeURIComponent(r(s))+n+encodeURIComponent(r(e)):""};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function o(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var a=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},function(e,t,n){"use strict";t.byteLength=function(e){var t=c(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=c(e),a=r[0],s=r[1],u=new o(function(e,t,n){return 3*(t+n)/4-n}(0,a,s)),l=0,d=s>0?a-4:a;for(n=0;n<d;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=255&t;2===s&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,u[l++]=255&t);1===s&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,u[l++]=t>>8&255,u[l++]=255&t);return u},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,o=[],a=16383,s=0,u=n-i;s<u;s+=a)o.push(l(e,s,s+a>u?u:s+a));1===i?(t=e[n-1],o.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],o.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return o.join("")};for(var r=[],i=[],o="undefined"!==typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=a.length;s<u;++s)r[s]=a[s],i[a.charCodeAt(s)]=s;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var i,o,a=[],s=t;s<n;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(r[(o=i)>>18&63]+r[o>>12&63]+r[o>>6&63]+r[63&o]);return a.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,c=u>>1,l=-7,d=n?i-1:0,f=n?-1:1,h=e[t+d];for(d+=f,o=h&(1<<-l)-1,h>>=-l,l+=s;l>0;o=256*o+e[t+d],d+=f,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=r;l>0;a=256*a+e[t+d],d+=f,l-=8);if(0===o)o=1-c;else{if(o===u)return a?NaN:1/0*(h?-1:1);a+=Math.pow(2,r),o-=c}return(h?-1:1)*a*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var a,s,u,c=8*o-i-1,l=(1<<c)-1,d=l>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:o-1,p=r?1:-1,v=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),(t+=a+d>=1?f/u:f*Math.pow(2,1-d))*u>=2&&(a++,u/=2),a+d>=l?(s=0,a=l):a+d>=1?(s=(t*u-1)*Math.pow(2,i),a+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,i),a=0));i>=8;e[n+h]=255&s,h+=p,s/=256,i-=8);for(a=a<<i|s,c+=i;c>0;e[n+h]=255&a,h+=p,a/=256,c-=8);e[n+h-p]|=128*v}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";var r=n(6),i=n(7),o=n(0),a=n(2),s=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.RoomList=void 0;var u=s(n(3)),c=n(22),l=function(){function e(t){o(this,e),this.cryptoStore=t,(0,u.default)(this,"roomEncryption",{})}return a(e,[{key:"init",value:function(){var e=i(r.mark((function e(){var t=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cryptoStore.doTxn("readwrite",[c.IndexedDBCryptoStore.STORE_ROOMS],(function(e){t.cryptoStore.getEndToEndRooms(e,(function(e){t.roomEncryption=e}))}));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getRoomEncryption",value:function(e){return this.roomEncryption[e]||null}},{key:"isRoomEncrypted",value:function(e){return Boolean(this.getRoomEncryption(e))}},{key:"setRoomEncryption",value:function(){var e=i(r.mark((function e(t,n){var i=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.roomEncryption[t]=n,e.next=3,this.cryptoStore.doTxn("readwrite",[c.IndexedDBCryptoStore.STORE_ROOMS],(function(e){i.cryptoStore.storeEndToEndRoom(t,n,e)}));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}();t.RoomList=l},function(e,t,n){"use strict";var r=n(16),i=n(8),o=n(6),a=n(7),s=n(13),u=n(0),c=n(2),l=n(9),d=n(10);Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStorageCryptoStore=void 0;var f=n(5),h=n(45),p="crypto.",v="crypto.account",g="crypto.cross_signing_keys",y="crypto.notified_error_devices",m="crypto.device_data",k="crypto.inboundgroupsessions/",b="crypto.sessionsneedingbackup";function S(e){return"crypto.sessions/"+e}function w(e){return"crypto.session.problems/"+e}function E(e,t){return k+e+"/"+t}function _(e,t){return"crypto.inboundgroupsessions.withheld/"+e+"/"+t}function x(e){return"crypto.rooms/"+e}var I=function(e){l(n,e);var t=d(n);function n(e){var r;return u(this,n),(r=t.call(this)).store=e,r}return c(n,[{key:"countEndToEndSessions",value:function(e,t){for(var n=0,r=0;r<this.store.length;++r)this.store.key(r).startsWith(S(""))&&++n;t(n)}},{key:"_getEndToEndSessions",value:function(e){for(var t=T(this.store,S(e)),n={},r=0,i=Object.entries(t||{});r<i.length;r++){var o=s(i[r],2),a=o[0],u=o[1];n[a]="string"===typeof u?{session:u}:u}return n}},{key:"getEndToEndSession",value:function(e,t,n,r){r(this._getEndToEndSessions(e)[t]||{})}},{key:"getEndToEndSessions",value:function(e,t,n){n(this._getEndToEndSessions(e)||{})}},{key:"getAllEndToEndSessions",value:function(e,t){for(var n=0;n<this.store.length;++n)if(this.store.key(n).startsWith(S("")))for(var r=this.store.key(n).split("/")[1],i=0,o=Object.values(this._getEndToEndSessions(r));i<o.length;i++){t(o[i])}}},{key:"storeEndToEndSession",value:function(e,t,n,r){var i=this._getEndToEndSessions(e)||{};i[t]=n,R(this.store,S(e),i)}},{key:"storeEndToEndSessionProblem",value:function(){var e=a(o.mark((function e(t,n,r){var i,a;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=w(t),(a=T(this.store,i)||[]).push({type:n,fixed:r,time:Date.now()}),a.sort((function(e,t){return e.time-t.time})),R(this.store,i,a);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getEndToEndSessionProblem",value:function(){var e=a(o.mark((function e(t,n){var r,a,s,u,c,l;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=w(t),(a=T(this.store,r)||[]).length){e.next=4;break}return e.abrupt("return",null);case 4:s=a[a.length-1],u=i(a),e.prev=6,u.s();case 8:if((c=u.n()).done){e.next=14;break}if(!((l=c.value).time>n)){e.next=12;break}return e.abrupt("return",Object.assign({},l,{fixed:s.fixed}));case 12:e.next=8;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(6),u.e(e.t0);case 19:return e.prev=19,u.f(),e.finish(19);case 22:if(!s.fixed){e.next=26;break}return e.abrupt("return",null);case 26:return e.abrupt("return",s);case 27:case"end":return e.stop()}}),e,this,[[6,16,19,22]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"filterOutNotifiedErrorDevices",value:function(){var e=a(o.mark((function e(t){var n,a,s,u,c,l,d;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=T(this.store,y)||{},a=[],s=i(t);try{for(s.s();!(u=s.n()).done;)c=u.value,l=c.userId,d=c.deviceInfo,l in n?d.deviceId in n[l]||(a.push(c),n[l][d.deviceId]=!0):(a.push(c),n[l]=r({},d.deviceId,!0))}catch(o){s.e(o)}finally{s.f()}return R(this.store,y,n),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getEndToEndInboundGroupSession",value:function(e,t,n,r){r(T(this.store,E(e,t)),T(this.store,_(e,t)))}},{key:"getAllEndToEndInboundGroupSessions",value:function(e,t){for(var n=0;n<this.store.length;++n){var r=this.store.key(n);r.startsWith(k)&&t({senderKey:r.substr(k.length,43),sessionId:r.substr(k.length+44),sessionData:T(this.store,r)})}t(null)}},{key:"addEndToEndInboundGroupSession",value:function(e,t,n,r){T(this.store,E(e,t))||this.storeEndToEndInboundGroupSession(e,t,n,r)}},{key:"storeEndToEndInboundGroupSession",value:function(e,t,n,r){R(this.store,E(e,t),n)}},{key:"storeEndToEndInboundGroupSessionWithheld",value:function(e,t,n,r){R(this.store,_(e,t),n)}},{key:"getEndToEndDeviceData",value:function(e,t){t(T(this.store,m))}},{key:"storeEndToEndDeviceData",value:function(e,t){R(this.store,m,e)}},{key:"storeEndToEndRoom",value:function(e,t,n){R(this.store,x(e),t)}},{key:"getEndToEndRooms",value:function(e,t){for(var n={},r=x(""),i=0;i<this.store.length;++i){var o=this.store.key(i);if(o.startsWith(r))n[o.substr(r.length)]=T(this.store,o)}t(n)}},{key:"getSessionsNeedingBackup",value:function(e){var t=this,n=T(this.store,b)||{},r=[];for(var i in n){if(Object.prototype.hasOwnProperty.call(n,i))if("break"===function(){var n=i.substr(0,43),o=i.substr(44);if(t.getEndToEndInboundGroupSession(n,o,null,(function(e){r.push({senderKey:n,sessionId:o,sessionData:e})})),e&&i.length>=e)return"break"}())break}return Promise.resolve(r)}},{key:"countSessionsNeedingBackup",value:function(){var e=T(this.store,b)||{};return Promise.resolve(Object.keys(e).length)}},{key:"unmarkSessionsNeedingBackup",value:function(e){var t,n=T(this.store,b)||{},r=i(e);try{for(r.s();!(t=r.n()).done;){var o=t.value;delete n[o.senderKey+"/"+o.sessionId]}}catch(a){r.e(a)}finally{r.f()}return R(this.store,b,n),Promise.resolve()}},{key:"markSessionsNeedingBackup",value:function(e){var t,n=T(this.store,b)||{},r=i(e);try{for(r.s();!(t=r.n()).done;){var o=t.value;n[o.senderKey+"/"+o.sessionId]=!0}}catch(a){r.e(a)}finally{r.f()}return R(this.store,b,n),Promise.resolve()}},{key:"deleteAllData",value:function(){return this.store.removeItem(v),Promise.resolve()}},{key:"getAccount",value:function(e,t){t(T(this.store,v))}},{key:"storeAccount",value:function(e,t){R(this.store,v,t)}},{key:"getCrossSigningKeys",value:function(e,t){t(T(this.store,g))}},{key:"getSecretStorePrivateKey",value:function(e,t,n){t(T(this.store,p+"ssss_cache.".concat(n)))}},{key:"storeCrossSigningKeys",value:function(e,t){R(this.store,g,t)}},{key:"storeSecretStorePrivateKey",value:function(e,t,n){R(this.store,p+"ssss_cache.".concat(t),n)}},{key:"doTxn",value:function(e,t,n){return Promise.resolve(n(null))}}],[{key:"exists",value:function(e){for(var t=e.length,n=0;n<t;n++)if(e.key(n).startsWith(p))return!0;return!1}}]),n}(h.MemoryCryptoStore);function T(e,t){try{return JSON.parse(e.getItem(t))}catch(n){f.logger.log("Error: Failed to get key %s: %s",t,n.stack||n),f.logger.log(n.stack)}return null}function R(e,t,n){e.setItem(t,JSON.stringify(n))}t.LocalStorageCryptoStore=I},function(e,t,n){"use strict";var r=n(8),i=n(6),o=n(7),a=n(0),s=n(2),u=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.upgradeDatabase=function(e,t){l.logger.log("Upgrading IndexedDBCryptoStore from version ".concat(t)+" to ".concat(10)),t<1&&function(e){var t=e.createObjectStore("outgoingRoomKeyRequests",{keyPath:"requestId"});t.createIndex("session",["requestBody.room_id","requestBody.session_id"]),t.createIndex("state","state")}(e);t<2&&e.createObjectStore("account");if(t<3){e.createObjectStore("sessions",{keyPath:["deviceKey","sessionId"]}).createIndex("deviceKey","deviceKey")}t<4&&e.createObjectStore("inbound_group_sessions",{keyPath:["senderCurve25519Key","sessionId"]});t<5&&e.createObjectStore("device_data");t<6&&e.createObjectStore("rooms");t<7&&e.createObjectStore("sessions_needing_backup",{keyPath:["senderCurve25519Key","sessionId"]});t<8&&e.createObjectStore("inbound_group_sessions_withheld",{keyPath:["senderCurve25519Key","sessionId"]});if(t<9){e.createObjectStore("session_problems",{keyPath:["deviceKey","time"]}).createIndex("deviceKey","deviceKey"),e.createObjectStore("notified_error_devices",{keyPath:["userId","deviceId"]})}t<10&&e.createObjectStore("shared_history_inbound_group_sessions",{keyPath:["roomId"]})},t.Backend=t.VERSION=void 0;var c=u(n(3)),l=n(5),d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=f(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}r.default=e,n&&n.set(e,r);return r}(n(12));function f(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(f=function(e){return e?n:t})(e)}t.VERSION=10;var h=function(){function e(t){var n=this;a(this,e),this.db=t,(0,c.default)(this,"nextTxnId",0),t.onversionchange=function(){l.logger.log("versionchange for indexeddb ".concat(n.db.name,": closing")),t.close()}}return s(e,[{key:"startup",value:function(){var e=o(i.mark((function e(){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"deleteAllData",value:function(){var e=o(i.mark((function e(){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("This is not implemented, call IDBFactory::deleteDatabase(dbName) instead.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getOrAddOutgoingRoomKeyRequest",value:function(e){var t=this,n=e.requestBody;return new Promise((function(r,i){var o=t.db.transaction("outgoingRoomKeyRequests","readwrite");o.onerror=i,t._getOutgoingRoomKeyRequest(o,n,(function(t){if(t)return l.logger.log("already have key request outstanding for "+"".concat(n.room_id," / ").concat(n.session_id,": ")+"not sending another"),void r(t);l.logger.log("enqueueing key request for ".concat(n.room_id," / ")+n.session_id),o.oncomplete=function(){r(e)},o.objectStore("outgoingRoomKeyRequests").add(e)}))}))}},{key:"getOutgoingRoomKeyRequest",value:function(e){var t=this;return new Promise((function(n,r){var i=t.db.transaction("outgoingRoomKeyRequests","readonly");i.onerror=r,t._getOutgoingRoomKeyRequest(i,e,(function(e){n(e)}))}))}},{key:"_getOutgoingRoomKeyRequest",value:function(e,t,n){var r=e.objectStore("outgoingRoomKeyRequests").index("session").openCursor([t.room_id,t.session_id]);r.onsuccess=function(){var e=r.result;if(e){var i=e.value;d.deepCompare(i.requestBody,t)?n(i):e.continue()}else n(null)}}},{key:"getOutgoingRoomKeyRequestByState",value:function(e){if(0===e.length)return Promise.resolve(null);var t,n=0;var r=this.db.transaction("outgoingRoomKeyRequests","readonly"),i=r.objectStore("outgoingRoomKeyRequests"),o=e[n];return i.index("state").openCursor(o).onsuccess=function r(i){var o=i.target.result;if(o)t=o.value;else if(!(++n>=e.length)){var a=e[n];i.target.source.openCursor(a).onsuccess=r}},v(r).then((function(){return t}))}},{key:"getAllOutgoingRoomKeyRequestsByState",value:function(e){var t=this;return new Promise((function(n,r){var i=t.db.transaction("outgoingRoomKeyRequests","readonly").objectStore("outgoingRoomKeyRequests").index("state").getAll(e);i.onsuccess=function(){return n(i.result)},i.onerror=function(){return r(i.error)}}))}},{key:"getOutgoingRoomKeyRequestsByTarget",value:function(e,t,n){var r=0,i=[];var o=this.db.transaction("outgoingRoomKeyRequests","readonly"),a=o.objectStore("outgoingRoomKeyRequests"),s=n[r];return a.index("state").openCursor(s).onsuccess=function o(a){var s=a.target.result;if(s){var u=s.value;u.recipients.includes({userId:e,deviceId:t})&&i.push(u),s.continue()}else{if(++r>=n.length)return;var c=n[r];a.target.source.openCursor(c).onsuccess=o}},v(o).then((function(){return i}))}},{key:"updateOutgoingRoomKeyRequest",value:function(e,t,n){var r=null;var i=this.db.transaction("outgoingRoomKeyRequests","readwrite");return i.objectStore("outgoingRoomKeyRequests").openCursor(e).onsuccess=function(e){var i=e.target.result;if(i){var o=i.value;o.state==t?(Object.assign(o,n),i.update(o),r=o):l.logger.warn("Cannot update room key request from ".concat(t," ")+"as it was already updated to ".concat(o.state))}},v(i).then((function(){return r}))}},{key:"deleteOutgoingRoomKeyRequest",value:function(e,t){var n=this.db.transaction("outgoingRoomKeyRequests","readwrite"),r=n.objectStore("outgoingRoomKeyRequests").openCursor(e);return r.onsuccess=function(){var e=r.result;if(e){var n=e.value;n.state==t?e.delete():l.logger.warn("Cannot delete room key request in state ".concat(n.state," ")+"(expected ".concat(t,")"))}},v(n)}},{key:"getAccount",value:function(e,t){var n=e.objectStore("account").get("-");n.onsuccess=function(){try{t(n.result||null)}catch(r){p(e,r)}}}},{key:"storeAccount",value:function(e,t){e.objectStore("account").put(t,"-")}},{key:"getCrossSigningKeys",value:function(e,t){var n=e.objectStore("account").get("crossSigningKeys");n.onsuccess=function(){try{t(n.result||null)}catch(r){p(e,r)}}}},{key:"getSecretStorePrivateKey",value:function(e,t,n){var r=e.objectStore("account").get("ssss_cache:".concat(n));r.onsuccess=function(){try{t(r.result||null)}catch(n){p(e,n)}}}},{key:"storeCrossSigningKeys",value:function(e,t){e.objectStore("account").put(t,"crossSigningKeys")}},{key:"storeSecretStorePrivateKey",value:function(e,t,n){e.objectStore("account").put(n,"ssss_cache:".concat(t))}},{key:"countEndToEndSessions",value:function(e,t){var n=e.objectStore("sessions").count();n.onsuccess=function(){try{t(n.result)}catch(r){p(e,r)}}}},{key:"getEndToEndSessions",value:function(e,t,n){var r=t.objectStore("sessions").index("deviceKey").openCursor(e),i={};r.onsuccess=function(){var e=r.result;if(e)i[e.value.sessionId]={session:e.value.session,lastReceivedMessageTs:e.value.lastReceivedMessageTs},e.continue();else try{n(i)}catch(o){p(t,o)}}}},{key:"getEndToEndSession",value:function(e,t,n,r){var i=n.objectStore("sessions").get([e,t]);i.onsuccess=function(){try{i.result?r({session:i.result.session,lastReceivedMessageTs:i.result.lastReceivedMessageTs}):r(null)}catch(e){p(n,e)}}}},{key:"getAllEndToEndSessions",value:function(e,t){var n=e.objectStore("sessions").openCursor();n.onsuccess=function(){try{var r=n.result;r?(t(r.value),r.continue()):t(null)}catch(i){p(e,i)}}}},{key:"storeEndToEndSession",value:function(e,t,n,r){r.objectStore("sessions").put({deviceKey:e,sessionId:t,session:n.session,lastReceivedMessageTs:n.lastReceivedMessageTs})}},{key:"storeEndToEndSessionProblem",value:function(){var e=o(i.mark((function e(t,n,r){var o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=this.db.transaction("session_problems","readwrite"),o.objectStore("session_problems").put({deviceKey:t,type:n,fixed:r,time:Date.now()}),e.abrupt("return",v(o));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getEndToEndSessionProblem",value:function(){var e=o(i.mark((function e(t,n){var o,a,s,u,c;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.db.transaction("session_problems","readwrite"),s=a.objectStore("session_problems"),u=s.index("deviceKey"),(c=u.getAll(t)).onsuccess=function(){var e=c.result;if(e.length){e.sort((function(e,t){return e.time-t.time}));var t,i=e[e.length-1],a=r(e);try{for(a.s();!(t=a.n()).done;){var s=t.value;if(s.time>n)return void(o=Object.assign({},s,{fixed:i.fixed}))}}catch(u){a.e(u)}finally{a.f()}o=i.fixed?null:i}else o=null},e.next=7,v(a);case 7:return e.abrupt("return",o);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"filterOutNotifiedErrorDevices",value:function(){var e=o(i.mark((function e(t){var n,r,o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.db.transaction("notified_error_devices","readwrite"),r=n.objectStore("notified_error_devices"),o=[],e.next=5,Promise.all(t.map((function(e){return new Promise((function(t){var n=e.userId,i=e.deviceInfo,a=r.get([n,i.deviceId]);a.onsuccess=function(){a.result||(r.put({userId:n,deviceId:i.deviceId}),o.push(e)),t()}}))})));case 5:return e.abrupt("return",o);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getEndToEndInboundGroupSession",value:function(e,t,n,r){var i=!1,o=!1,a=n.objectStore("inbound_group_sessions").get([e,t]);a.onsuccess=function(){try{i=a.result?a.result.session:null,!1!==o&&r(i,o)}catch(e){p(n,e)}};var s=n.objectStore("inbound_group_sessions_withheld").get([e,t]);s.onsuccess=function(){try{o=s.result?s.result.session:null,!1!==i&&r(i,o)}catch(e){p(n,e)}}}},{key:"getAllEndToEndInboundGroupSessions",value:function(e,t){var n=e.objectStore("inbound_group_sessions").openCursor();n.onsuccess=function(){var r=n.result;if(r){try{t({senderKey:r.value.senderCurve25519Key,sessionId:r.value.sessionId,sessionData:r.value.session})}catch(i){p(e,i)}r.continue()}else try{t(null)}catch(i){p(e,i)}}}},{key:"addEndToEndInboundGroupSession",value:function(e,t,n,r){var i=r.objectStore("inbound_group_sessions").add({senderCurve25519Key:e,sessionId:t,session:n});i.onerror=function(n){"ConstraintError"===i.error.name?(n.stopPropagation(),n.preventDefault(),l.logger.log("Ignoring duplicate inbound group session: "+e+" / "+t)):p(r,new Error("Failed to add inbound group session: "+i.error))}}},{key:"storeEndToEndInboundGroupSession",value:function(e,t,n,r){r.objectStore("inbound_group_sessions").put({senderCurve25519Key:e,sessionId:t,session:n})}},{key:"storeEndToEndInboundGroupSessionWithheld",value:function(e,t,n,r){r.objectStore("inbound_group_sessions_withheld").put({senderCurve25519Key:e,sessionId:t,session:n})}},{key:"getEndToEndDeviceData",value:function(e,t){var n=e.objectStore("device_data").get("-");n.onsuccess=function(){try{t(n.result||null)}catch(r){p(e,r)}}}},{key:"storeEndToEndDeviceData",value:function(e,t){t.objectStore("device_data").put(e,"-")}},{key:"storeEndToEndRoom",value:function(e,t,n){n.objectStore("rooms").put(t,e)}},{key:"getEndToEndRooms",value:function(e,t){var n={},r=e.objectStore("rooms").openCursor();r.onsuccess=function(){var i=r.result;if(i)n[i.key]=i.value,i.continue();else try{t(n)}catch(o){p(e,o)}}}},{key:"getSessionsNeedingBackup",value:function(e){var t=this;return new Promise((function(n,r){var i=[],o=t.db.transaction(["sessions_needing_backup","inbound_group_sessions"],"readonly");o.onerror=r,o.oncomplete=function(){n(i)};var a=o.objectStore("sessions_needing_backup"),s=o.objectStore("inbound_group_sessions"),u=a.openCursor();u.onsuccess=function(){var t=u.result;if(t){var n=s.get(t.key);n.onsuccess=function(){i.push({senderKey:n.result.senderCurve25519Key,sessionId:n.result.sessionId,sessionData:n.result.session})},(!e||i.length<e)&&t.continue()}}}))}},{key:"countSessionsNeedingBackup",value:function(e){e||(e=this.db.transaction("sessions_needing_backup","readonly"));var t=e.objectStore("sessions_needing_backup");return new Promise((function(e,n){var r=t.count();r.onerror=n,r.onsuccess=function(){return e(r.result)}}))}},{key:"unmarkSessionsNeedingBackup",value:function(){var e=o(i.mark((function e(t,n){var r;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n||(n=this.db.transaction("sessions_needing_backup","readwrite")),r=n.objectStore("sessions_needing_backup"),e.next=4,Promise.all(t.map((function(e){return new Promise((function(t,n){var i=r.delete([e.senderKey,e.sessionId]);i.onsuccess=t,i.onerror=n}))})));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"markSessionsNeedingBackup",value:function(){var e=o(i.mark((function e(t,n){var r;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n||(n=this.db.transaction("sessions_needing_backup","readwrite")),r=n.objectStore("sessions_needing_backup"),e.next=4,Promise.all(t.map((function(e){return new Promise((function(t,n){var i=r.put({senderCurve25519Key:e.senderKey,sessionId:e.sessionId});i.onsuccess=t,i.onerror=n}))})));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"addSharedHistoryInboundGroupSession",value:function(e,t,n,r){r||(r=this.db.transaction("shared_history_inbound_group_sessions","readwrite"));var i=r.objectStore("shared_history_inbound_group_sessions"),o=i.get([e]);o.onsuccess=function(){var r=(o.result||{sessions:[]}).sessions;r.push([t,n]),i.put({roomId:e,sessions:r})}}},{key:"getSharedHistoryInboundGroupSessions",value:function(e,t){t||(t=this.db.transaction("shared_history_inbound_group_sessions","readonly"));var n=t.objectStore("shared_history_inbound_group_sessions").get([e]);return new Promise((function(e,t){n.onsuccess=function(){var t=(n.result||{sessions:[]}).sessions;e(t)},n.onerror=t}))}},{key:"doTxn",value:function(e,t,n){arguments.length>3&&void 0!==arguments[3]||l.logger;var r=this.db.transaction(t,e),i=v(r),o=n(r);return i.then((function(){return o}))}}]),e}();function p(e,t){e._mx_abortexception=t;try{e.abort()}catch(t){}}function v(e){return new Promise((function(t,n){e.oncomplete=function(){void 0!==e._mx_abortexception&&n(e._mx_abortexception),t(null)},e.onerror=function(t){void 0!==e._mx_abortexception?n(e._mx_abortexception):(l.logger.log("Error performing indexeddb txn",t),n(e.error))},e.onabort=function(t){void 0!==e._mx_abortexception?n(e._mx_abortexception):(l.logger.log("Error performing indexeddb txn",t),n(e.error))}}))}t.Backend=h},function(e,t,n){"use strict";var r=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,i=/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/,o=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,a=/\\([\u000b\u0020-\u00ff])/g,s=/([\\"])/g,u=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;function c(e){var t=String(e);if(o.test(t))return t;if(t.length>0&&!i.test(t))throw new TypeError("invalid parameter value");return'"'+t.replace(s,"\\$1")+'"'}function l(e){this.parameters=Object.create(null),this.type=e}t.format=function(e){if(!e||"object"!==typeof e)throw new TypeError("argument obj is required");var t=e.parameters,n=e.type;if(!n||!u.test(n))throw new TypeError("invalid type");var r=n;if(t&&"object"===typeof t)for(var i,a=Object.keys(t).sort(),s=0;s<a.length;s++){if(i=a[s],!o.test(i))throw new TypeError("invalid parameter name");r+="; "+i+"="+c(t[i])}return r},t.parse=function(e){if(!e)throw new TypeError("argument string is required");var t="object"===typeof e?function(e){var t;"function"===typeof e.getHeader?t=e.getHeader("content-type"):"object"===typeof e.headers&&(t=e.headers&&e.headers["content-type"]);if("string"!==typeof t)throw new TypeError("content-type header is missing from object");return t}(e):e;if("string"!==typeof t)throw new TypeError("argument string is required to be a string");var n=t.indexOf(";"),i=-1!==n?t.substr(0,n).trim():t.trim();if(!u.test(i))throw new TypeError("invalid media type");var o=new l(i.toLowerCase());if(-1!==n){var s,c,d;for(r.lastIndex=n;c=r.exec(t);){if(c.index!==n)throw new TypeError("invalid parameter format");n+=c[0].length,s=c[1].toLowerCase(),'"'===(d=c[2])[0]&&(d=d.substr(1,d.length-2).replace(a,"$1")),o.parameters[s]=d}if(n!==t.length)throw new TypeError("invalid parameter format")}return o}},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.setNow=function(e){s=e||Date.now},t.setTimeout=function(e,t){(t=t||0)<0&&(t=0);var n=s()+t,r=o++;for(var i=arguments.length,c=new Array(i>2?i-2:0),d=2;d<i;d++)c[d-2]=arguments[d];var f={runAt:n,func:e,params:c,key:r},h=l(a,(function(e){return e.runAt-n}));return a.splice(h,0,f),u(),r},t.clearTimeout=function(e){if(0===a.length)return;var t;for(t=0;t<a.length;t++){if(a[t].key==e){a.splice(t,1);break}}0===t&&u()};var r,i=n(5),o=0,a=[];var s=Date.now;function u(){r&&e.clearTimeout(r);var t=a[0];if(t){var n=s(),i=Math.min(t.runAt-n,1e3);r=e.setTimeout(c,i)}}function c(){for(var t,n=s(),r=[];;){var o=a[0];if(!o||o.runAt>n)break;(t=a.shift()).key,r.push(t)}u();for(var c=0;c<r.length;c++){t=r[c];try{t.func.apply(e,t.params)}catch(l){i.logger.error("Uncaught exception in callback function",l.stack||l)}}}function l(e,t){for(var n=0,r=e.length;n<r;){var i=n+r>>1;t(e[i])>0?r=i:n=i+1}return n}}).call(this,n(14))},function(e,t,n){"use strict";(function(e,r){var i,o=n(13),a=n(8),s=n(6),u=n(7),c=n(0),l=n(2),d=n(11),f=n(9),h=n(10),p=n(16),v=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.isCryptoAvailable=function(){return Boolean(e.Olm)},t.fixBackupKey=Q,t.IncomingRoomKeyRequest=t.Crypto=t.verificationMethods=void 0;var g=v(n(3)),y=v(n(40)),m=n(15),k=n(38),b=n(5),S=n(81),w=W(n(19)),E=n(140),_=n(41),x=W(n(82)),I=n(42),T=n(141),R=n(142),O=n(143),C=n(22),P=n(84),D=n(144),A=n(56),M=n(57),U=n(58),N=n(148),L=n(149),j=n(150),B=n(39),K=n(33),F=n(85),q=n(86),V=n(18);function G(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(G=function(e){return e?n:t})(e)}function W(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=G(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}var H=_.DeviceInfo.DeviceVerification,$=(p(i={},P.ReciprocateQRCode.NAME,P.ReciprocateQRCode),p(i,D.SAS.NAME,D.SAS),p(i,P.SHOW_QR_CODE_METHOD,j.IllegalMethod),p(i,P.SCAN_QR_CODE_METHOD,j.IllegalMethod),i),z={RECIPROCATE_QR_CODE:P.ReciprocateQRCode.NAME,SAS:D.SAS.NAME};t.verificationMethods=z;var Y=function(t){f(i,t);var n=h(i);function i(e,t,r,l,f,h,p,v){var y;if(c(this,i),(y=n.call(this)).baseApis=e,y.sessionStore=t,y.userId=r,y.deviceId=l,y.clientStore=f,y.cryptoStore=h,y.roomList=p,(0,g.default)(d(y),"backupManager",void 0),(0,g.default)(d(y),"crossSigningInfo",void 0),(0,g.default)(d(y),"olmDevice",void 0),(0,g.default)(d(y),"deviceList",void 0),(0,g.default)(d(y),"dehydrationManager",void 0),(0,g.default)(d(y),"secretStorage",void 0),(0,g.default)(d(y),"reEmitter",void 0),(0,g.default)(d(y),"verificationMethods",void 0),(0,g.default)(d(y),"supportedAlgorithms",void 0),(0,g.default)(d(y),"outgoingRoomKeyRequestManager",void 0),(0,g.default)(d(y),"toDeviceVerificationRequests",void 0),(0,g.default)(d(y),"inRoomVerificationRequests",void 0),(0,g.default)(d(y),"trustCrossSignedDevices",!0),(0,g.default)(d(y),"lastOneTimeKeyCheck",null),(0,g.default)(d(y),"oneTimeKeyCheckInProgress",!1),(0,g.default)(d(y),"roomEncryptors",{}),(0,g.default)(d(y),"roomDecryptors",{}),(0,g.default)(d(y),"deviceKeys",{}),(0,g.default)(d(y),"globalBlacklistUnverifiedDevices",!1),(0,g.default)(d(y),"globalErrorOnUnknownDevices",!0),(0,g.default)(d(y),"receivedRoomKeyRequests",[]),(0,g.default)(d(y),"receivedRoomKeyRequestCancellations",[]),(0,g.default)(d(y),"processingRoomKeyRequests",!1),(0,g.default)(d(y),"lazyLoadMembers",!1),(0,g.default)(d(y),"roomDeviceTrackingState",{}),(0,g.default)(d(y),"lastNewSessionForced",{}),(0,g.default)(d(y),"sendKeyRequestsImmediately",!1),(0,g.default)(d(y),"oneTimeKeyCount",void 0),(0,g.default)(d(y),"needsNewFallback",void 0),(0,g.default)(d(y),"onDeviceListUserCrossSigningUpdated",function(){var e=u(s.mark((function e(t){var n,r,i,o,a;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==y.userId){e.next=15;break}if(n=y.deviceList.getStoredCrossSigningForUser(t),r=n?n.getId():null,i=y.crossSigningInfo.getId(),o=i!==r,!i||!r||o){e.next=10;break}return e.next=8,y.checkOwnCrossSigningTrust();case 8:e.next=13;break;case 10:y.storeTrustedSelfKeys(null),y.emit("crossSigning.keysChanged",{}),y.emit("userTrustStatusChanged",y.userId,y.checkUserTrust(t));case 13:e.next=20;break;case 15:return e.next=17,y.checkDeviceVerifications(t);case 17:(a=y.deviceList.getStoredCrossSigningForUser(t))&&(a.updateCrossSigningVerifiedBefore(y.checkUserTrust(t).isCrossSigningVerified()),y.deviceList.setRawStoredCrossSigningForUser(t,a.toStorage())),y.emit("userTrustStatusChanged",t,y.checkUserTrust(t));case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,g.default)(d(y),"onToDeviceEvent",(function(e){try{b.logger.log("received to_device ".concat(e.getType()," from: ")+"".concat(e.getSender()," id: ").concat(e.getId())),"m.room_key"==e.getType()||"m.forwarded_room_key"==e.getType()?y.onRoomKeyEvent(e):"m.room_key_request"==e.getType()?y.onRoomKeyRequestEvent(e):"m.secret.request"===e.getType()?y.secretStorage.onRequestReceived(e):"m.secret.send"===e.getType()?y.secretStorage.onSecretReceived(e):"org.matrix.room_key.withheld"===e.getType()?y.onRoomKeyWithheldEvent(e):e.getContent().transaction_id?y.onKeyVerificationMessage(e):"m.bad.encrypted"===e.getContent().msgtype?y.onToDeviceBadEncrypted(e):(e.isBeingDecrypted()||e.shouldAttemptDecryption())&&(e.isBeingDecrypted()||e.attemptDecryption(d(y)),e.once("Event.decrypted",(function(e){y.onToDeviceEvent(e)})))}catch(t){b.logger.error("Error handling toDeviceEvent:",t)}})),(0,g.default)(d(y),"onTimelineEvent",(function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=i.liveEvent,a=void 0===o||o;if(N.InRoomChannel.validateEvent(e,y.baseApis)){var s=function(e){var t=new N.InRoomChannel(y.baseApis,e.getRoomId());return new U.VerificationRequest(t,y.verificationMethods,y.baseApis)};y.handleVerificationEvent(e,y.inRoomVerificationRequests,s,a)}})),y.reEmitter=new k.ReEmitter(d(y)),v){y.verificationMethods=new Map;var m,_=a(v);try{for(_.s();!(m=_.n()).done;){var T=m.value;"string"===typeof T?$[T]&&y.verificationMethods.set(T,$[T]):T.NAME?y.verificationMethods.set(T.NAME,T):b.logger.warn("Excluding unknown verification method ".concat(T))}}catch(D){_.e(D)}finally{_.f()}}else y.verificationMethods=$;y.backupManager=new q.BackupManager(e,u(s.mark((function e(){var t,n,r,i,a,u;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.getSessionBackupPrivateKey();case 2:if(!(t=e.sent)){e.next=5;break}return e.abrupt("return",t);case 5:return e.next=7,y.getSecret("m.megolm_backup.v1");case 7:if(!(n=e.sent)){e.next=19;break}if(!(r=Q(n))){e.next=18;break}return e.next=13,y.getSecretStorageKey();case 13:return i=e.sent,a=o(i,1),u=a[0],e.next=18,y.storeSecret("m.megolm_backup.v1",r,[u]);case 18:return e.abrupt("return",w.decodeBase64(r||n));case 19:if(!y.baseApis.cryptoCallbacks||!y.baseApis.cryptoCallbacks.getBackupKey){e.next=23;break}return e.next=22,y.baseApis.cryptoCallbacks.getBackupKey();case 22:return e.abrupt("return",e.sent);case 23:throw new Error("Unable to get private key");case 24:case"end":return e.stop()}}),e)})))),y.olmDevice=new S.OlmDevice(h),y.deviceList=new E.DeviceList(e,h,y.olmDevice),y.deviceList.on("userCrossSigningUpdated",y.onDeviceListUserCrossSigningUpdated),y.reEmitter.reEmit(y.deviceList,["crypto.devicesUpdated","crypto.willUpdateDevices"]),y.supportedAlgorithms=Object.keys(x.DECRYPTION_CLASSES),y.outgoingRoomKeyRequestManager=new O.OutgoingRoomKeyRequestManager(e,y.deviceId,y.cryptoStore),y.toDeviceVerificationRequests=new L.ToDeviceRequests,y.inRoomVerificationRequests=new N.InRoomRequests;var C=y.baseApis.cryptoCallbacks||{},P=(0,I.createCryptoStoreCacheCallbacks)(h,y.olmDevice);return y.crossSigningInfo=new I.CrossSigningInfo(r,C,P),y.secretStorage=new R.SecretStorage(e,C,e),y.dehydrationManager=new F.DehydrationManager(d(y)),!C.getCrossSigningKey&&C.getSecretStorageKey&&(C.getCrossSigningKey=function(){var e=u(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",I.CrossSigningInfo.getFromSecretStorage(t,y.secretStorage));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),y}return l(i,[{key:"init",value:function(){var t=u(s.mark((function t(){var n,r,i,o,a,u=this,c=arguments;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=c.length>0&&void 0!==c[0]?c[0]:{},r=n.exportedOlmDevice,i=n.pickleKey,b.logger.log("Crypto: initialising Olm..."),t.next=4,e.Olm.init();case 4:return b.logger.log(r?"Crypto: initialising Olm device from exported device...":"Crypto: initialising Olm device..."),t.next=7,this.olmDevice.init({fromExportedDevice:r,pickleKey:i});case 7:return b.logger.log("Crypto: loading device list..."),t.next=10,this.deviceList.load();case 10:return this.deviceKeys["ed25519:"+this.deviceId]=this.olmDevice.deviceEd25519Key,this.deviceKeys["curve25519:"+this.deviceId]=this.olmDevice.deviceCurve25519Key,b.logger.log("Crypto: fetching own devices..."),(o=this.deviceList.getRawStoredDevicesForUser(this.userId))||(o={}),o[this.deviceId]||(b.logger.log("Crypto: adding this device to the store..."),a={keys:this.deviceKeys,algorithms:this.supportedAlgorithms,verified:H.VERIFIED,known:!0},o[this.deviceId]=a,this.deviceList.storeDevicesForUser(this.userId,o),this.deviceList.saveIfDirty()),t.next=18,this.cryptoStore.doTxn("readonly",[C.IndexedDBCryptoStore.STORE_ACCOUNT],(function(e){u.cryptoStore.getCrossSigningKeys(e,(function(e){e&&0!==Object.keys(e).length&&(b.logger.log("Loaded cross-signing public keys from crypto store"),u.crossSigningInfo.setKeys(e))}))}));case 18:this.deviceList.startTrackingDeviceList(this.userId),b.logger.log("Crypto: checking for key backup..."),this.backupManager.checkAndStart();case 21:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getCryptoTrustCrossSignedDevices",value:function(){return this.trustCrossSignedDevices}},{key:"setCryptoTrustCrossSignedDevices",value:function(e){this.trustCrossSignedDevices=e;var t,n=a(this.deviceList.getKnownUserIds());try{for(n.s();!(t=n.n()).done;)for(var r=t.value,i=this.deviceList.getRawStoredDevicesForUser(r),o=0,s=Object.keys(i);o<s.length;o++){var u=s[o],c=this.checkDeviceTrust(r,u);if(!c.isLocallyVerified()&&c.isCrossSigningVerified()){var l=this.deviceList.getStoredDevice(r,u);this.emit("deviceVerificationChanged",r,u,l)}}}catch(d){n.e(d)}finally{n.f()}}},{key:"createRecoveryKeyFromPassphrase",value:function(){var t=u(s.mark((function t(n){var r,i,o,a,u;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=new e.Olm.PkDecryption,t.prev=1,i={},!n){t.next=11;break}return t.next=6,(0,A.keyFromPassphrase)(n);case 6:o=t.sent,i.passphrase={algorithm:"m.pbkdf2",iterations:o.iterations,salt:o.salt},i.pubkey=r.init_with_private_key(o.key),t.next=12;break;case 11:i.pubkey=r.generate_key();case 12:return a=r.get_private_key(),u=(0,M.encodeRecoveryKey)(a),t.abrupt("return",{keyInfo:i,encodedPrivateKey:u,privateKey:a});case 15:return t.prev=15,r&&r.free(),t.finish(15);case 18:case"end":return t.stop()}}),t,null,[[1,,15,18]])})));return function(e){return t.apply(this,arguments)}}()},{key:"isCrossSigningReady",value:function(){var e=u(s.mark((function e(){var t,n;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.crossSigningInfo.getId(),e.next=3,this.crossSigningInfo.isStoredInKeyCache();case 3:if(e.t0=e.sent,e.t0){e.next=8;break}return e.next=7,this.crossSigningInfo.isStoredInSecretStorage(this.secretStorage);case 7:e.t0=e.sent;case 8:return n=e.t0,e.abrupt("return",!(!t||!n));case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isSecretStorageReady",value:function(){var e=u(s.mark((function e(){var t,n,r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.secretStorage.hasKey();case 2:return t=e.sent,e.next=5,this.crossSigningInfo.isStoredInSecretStorage(this.secretStorage);case 5:if(n=e.sent,e.t0=!this.backupManager.getKeyBackupEnabled(),e.t0){e.next=11;break}return e.next=10,this.baseApis.isKeyBackupKeyStored();case 10:e.t0=e.sent;case 11:return r=e.t0,e.abrupt("return",!!(t&&n&&r));case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"bootstrapCrossSigning",value:function(){var e=u(s.mark((function e(){var t,n,r,i,o,a,c,l,d,f,h,p,v,g,y=this,m=arguments;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=m.length>0&&void 0!==m[0]?m[0]:{},n=t.authUploadDeviceSigningKeys,r=t.setupNewCrossSigning,b.logger.log("Bootstrapping cross-signing"),i=this.baseApis.cryptoCallbacks,o=new T.EncryptionSetupBuilder(this.baseApis.store.accountData,i),a=new I.CrossSigningInfo(this.userId,o.crossSigningCallbacks,o.crossSigningCallbacks),c=function(){var e=u(s.mark((function e(){var t,r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.resetKeys(),e.next=3,y.signObject(a.keys.master);case 3:return o.addCrossSigningKeys(n,a.keys),t=y.deviceList.getStoredDevice(y.userId,y.deviceId),e.next=7,a.signDevice(y.userId,t);case 7:if(r=e.sent,o.addKeySignature(y.userId,y.deviceId,r),!y.backupManager.backupInfo){e.next=13;break}return e.next=12,a.signObject(y.backupManager.backupInfo.auth_data,"master");case 12:o.addSessionBackup(y.backupManager.backupInfo);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),l=this.crossSigningInfo.getId(),e.next=9,this.crossSigningInfo.isStoredInKeyCache();case 9:return d=e.sent,e.next=12,this.crossSigningInfo.isStoredInSecretStorage(this.secretStorage);case 12:if(f=e.sent,h=d||f,b.logger.log({setupNewCrossSigning:r,publicKeysOnDevice:l,privateKeysInCache:d,privateKeysInStorage:f,privateKeysExistSomewhere:h}),h&&!r){e.next=21;break}return b.logger.log("Cross-signing private keys not found locally or in secret storage, creating new keys"),e.next=19,c();case 19:e.next=29;break;case 21:if(!l||!d){e.next=25;break}b.logger.log("Cross-signing public keys trusted and private keys found locally"),e.next=29;break;case 25:if(!f){e.next=29;break}return b.logger.log("Cross-signing private keys not found locally, but they are available in secret storage, reading storage and caching locally"),e.next=29,this.checkOwnCrossSigningTrust({allowPrivateKeyRequests:!0});case 29:if(!(p=o.crossSigningCallbacks.privateKeys).size||this.baseApis.cryptoCallbacks.saveCrossSigningKeys){e.next=38;break}return v=new R.SecretStorage(o.accountDataClientAdapter,o.ssssCryptoCallbacks),e.next=34,v.hasKey();case 34:if(!e.sent){e.next=38;break}return b.logger.log("Storing new cross-signing private keys in secret storage"),e.next=38,I.CrossSigningInfo.storeInSecretStorage(p,v);case 38:return g=o.buildOperation(),e.next=41,g.apply(this);case 41:return e.next=43,o.persist(this);case 43:b.logger.log("Cross-signing ready");case 44:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"bootstrapSecretStorage",value:function(){var e=u(s.mark((function e(){var t,n,r,i,a,c,l,d,f,h,v,g,y,m,k,S,E,_,x,O,C,P,D,A,U,N,L,j,B,F,q,V,G,W=this,H=arguments;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=H.length>0&&void 0!==H[0]?H[0]:{},n=t.createSecretStorageKey,r=void 0===n?u(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{});case 1:case"end":return e.stop()}}),e)}))):n,i=t.keyBackupInfo,a=t.setupNewKeyBackup,c=t.setupNewSecretStorage,l=t.getKeyBackupPassphrase,b.logger.log("Bootstrapping Secure Secret Storage"),d=this.baseApis.cryptoCallbacks,f=new T.EncryptionSetupBuilder(this.baseApis.store.accountData,d),h=new R.SecretStorage(f.accountDataClientAdapter,f.ssssCryptoCallbacks),v=null,g=function(){var e=u(s.mark((function e(t,n){var r,i,o;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},n&&(t.key=n),e.next=4,h.addKey(R.SECRET_STORAGE_ALGORITHM_V1_AES,t);case 4:return r=e.sent,i=r.keyId,o=r.keyInfo,n&&f.ssssCryptoCallbacks.addPrivateKey(i,o,n),e.next=10,h.setDefaultKeyId(i);case 10:return e.abrupt("return",i);case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),y=function(){var e=u(s.mark((function e(t,n){var r,i,o,a,u;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.mac){e.next=16;break}return e.next=3,W.baseApis.cryptoCallbacks.getSecretStorageKey({keys:p({},t,n)},"");case 3:if(!(r=e.sent)){e.next=16;break}return i=r[1],f.ssssCryptoCallbacks.addPrivateKey(t,n,i),e.next=9,(0,K.calculateKeyCheck)(i);case 9:return o=e.sent,a=o.iv,u=o.mac,n.iv=a,n.mac=u,e.next=16,f.setAccountData("m.secret_storage.key.".concat(t),n);case 16:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),m=function(){var e=u(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=W.crossSigningInfo.getId(),!e.t0){e.next=5;break}return e.next=4,W.crossSigningInfo.isStoredInKeyCache("master");case 4:e.t0=e.sent;case 5:if(!e.t0){e.next=17;break}return e.prev=6,b.logger.log("Adding cross-signing signature to key backup"),e.next=10,W.crossSigningInfo.signObject(t,"master");case 10:e.next=15;break;case 12:e.prev=12,e.t1=e.catch(6),b.logger.error("Signing key backup with cross-signing keys failed",e.t1);case 15:e.next=18;break;case 17:b.logger.warn("Cross-signing keys not available, skipping signature on key backup");case 18:case"end":return e.stop()}}),e,null,[[6,12]])})));return function(t){return e.apply(this,arguments)}}(),e.next=11,this.getSecretStorageKey();case 11:if(k=e.sent,S=o(k||[null,null],2),E=S[0],_=S[1],x=!c&&_&&_.algorithm===R.SECRET_STORAGE_ALGORITHM_V1_AES,b.logger.log({keyBackupInfo:i,setupNewKeyBackup:a,setupNewSecretStorage:c,storageExists:x,oldKeyInfo:_}),x||i){e.next=27;break}return b.logger.log("Secret storage does not exist, creating new storage key"),e.next=19,r();case 19:return O=e.sent,C=O.keyInfo,P=O.privateKey,e.next=24,g(C,P);case 24:v=e.sent,e.next=53;break;case 27:if(x||!i){e.next=49;break}return b.logger.log("Secret storage does not exist, using key backup key"),e.next=31,this.getSessionBackupPrivateKey();case 31:if(e.t0=e.sent,e.t0){e.next=36;break}return e.next=35,l();case 35:e.t0=e.sent;case 36:return D=e.t0,A={},i.auth_data.private_key_salt&&i.auth_data.private_key_iterations&&(A.passphrase={algorithm:"m.pbkdf2",iterations:i.auth_data.private_key_iterations,salt:i.auth_data.private_key_salt,bits:256}),e.next=41,g(A,D);case 41:return v=e.sent,e.next=44,h.store("m.megolm_backup.v1",w.encodeBase64(D),[v]);case 44:return e.next=46,m(i.auth_data);case 46:f.addSessionBackup(i),e.next=53;break;case 49:if(b.logger.log("Secret storage exists"),!_||_.algorithm!==R.SECRET_STORAGE_ALGORITHM_V1_AES){e.next=53;break}return e.next=53,y(E,_);case 53:if(e.t2=!this.baseApis.cryptoCallbacks.saveCrossSigningKeys,!e.t2){e.next=58;break}return e.next=57,this.isCrossSigningReady();case 57:e.t2=e.sent;case 58:if(e.t1=e.t2,!e.t1){e.next=66;break}if(e.t3=v,e.t3){e.next=65;break}return e.next=64,this.crossSigningInfo.isStoredInSecretStorage(h);case 64:e.t3=!e.sent;case 65:e.t1=e.t3;case 66:if(!e.t1){e.next=73;break}return b.logger.log("Copying cross-signing private keys from cache to secret storage"),e.next=70,this.crossSigningInfo.getCrossSigningKeysFromCache();case 70:return U=e.sent,e.next=73,I.CrossSigningInfo.storeInSecretStorage(U,h);case 73:if(!a||i){e.next=87;break}return b.logger.log("Creating new message key backup version"),e.next=77,this.baseApis.prepareKeyBackupVersion(null,{secureSecretStorage:!1});case 77:return N=e.sent,L=(0,M.decodeRecoveryKey)(N.recovery_key),e.next=81,h.store("m.megolm_backup.v1",w.encodeBase64(L));case 81:return j={algorithm:N.algorithm,auth_data:N.auth_data},e.next=84,m(j.auth_data);case 84:return e.next=86,this.signObject(j.auth_data);case 86:f.addSessionBackup(j);case 87:return e.next=89,h.get("m.megolm_backup.v1");case 89:if(!(B=e.sent)){e.next=101;break}if(b.logger.info("Got session backup key from secret storage: caching"),!(F=Q(B))){e.next=96;break}return e.next=96,h.store("m.megolm_backup.v1",F,[v||E]);case 96:return q=new Uint8Array(w.decodeBase64(F||B)),e.next=99,f.addSessionBackupPrivateKeyToCache(q);case 99:e.next=116;break;case 101:if(!this.backupManager.getKeyBackupEnabled()){e.next=116;break}return e.next=104,this.getSessionBackupPrivateKey();case 104:if(e.t4=e.sent,e.t4){e.next=109;break}return e.next=108,l();case 108:e.t4=e.sent;case 109:if(V=e.t4){e.next=113;break}return b.logger.error("Key backup is enabled but couldn't get key backup key!"),e.abrupt("return");case 113:return b.logger.info("Got session backup key from cache/user that wasn't in SSSS: saving to SSSS"),e.next=116,h.store("m.megolm_backup.v1",w.encodeBase64(V));case 116:return G=f.buildOperation(),e.next=119,G.apply(this);case 119:return e.next=121,f.persist(this);case 121:b.logger.log("Secure Secret Storage ready");case 122:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"addSecretStorageKey",value:function(e,t,n){return this.secretStorage.addKey(e,t,n)}},{key:"hasSecretStorageKey",value:function(e){return this.secretStorage.hasKey(e)}},{key:"getSecretStorageKey",value:function(e){return this.secretStorage.getKey(e)}},{key:"storeSecret",value:function(e,t,n){return this.secretStorage.store(e,t,n)}},{key:"getSecret",value:function(e){return this.secretStorage.get(e)}},{key:"isSecretStored",value:function(e,t){return this.secretStorage.isStored(e,t)}},{key:"requestSecret",value:function(e,t){return t||(t=Object.keys(this.deviceList.getRawStoredDevicesForUser(this.userId))),this.secretStorage.request(e,t)}},{key:"getDefaultSecretStorageKeyId",value:function(){return this.secretStorage.getDefaultKeyId()}},{key:"setDefaultSecretStorageKeyId",value:function(e){return this.secretStorage.setDefaultKeyId(e)}},{key:"checkSecretStorageKey",value:function(e,t){return this.secretStorage.checkKey(e,t)}},{key:"checkSecretStoragePrivateKey",value:function(t,n){var r=null;try{return(r=new e.Olm.PkDecryption).init_with_private_key(t)===n}finally{r&&r.free()}}},{key:"getSessionBackupPrivateKey",value:function(){var e=u(s.mark((function e(){var t,n,i,o=this;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){o.cryptoStore.doTxn("readonly",[C.IndexedDBCryptoStore.STORE_ACCOUNT],(function(t){o.cryptoStore.getSecretStorePrivateKey(t,e,"m.megolm_backup.v1")}))}));case 2:if(!(t=e.sent)||"string"!==typeof t){e.next=7;break}return t=new Uint8Array(w.decodeBase64(Q(t)||t)),e.next=7,this.storeSessionBackupPrivateKey(t);case 7:if(!t||!t.ciphertext){e.next=13;break}return n=r.from(this.olmDevice.pickleKey),e.next=11,(0,K.decryptAES)(t,n,"m.megolm_backup.v1");case 11:i=e.sent,t=w.decodeBase64(i);case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"storeSessionBackupPrivateKey",value:function(){var e=u(s.mark((function e(t){var n,i,o=this;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof Uint8Array){e.next=2;break}throw new Error("storeSessionBackupPrivateKey expects Uint8Array, got ".concat(t));case 2:return n=r.from(this.olmDevice.pickleKey),e.next=5,(0,K.encryptAES)(w.encodeBase64(t),n,"m.megolm_backup.v1");case 5:return i=e.sent,e.abrupt("return",this.cryptoStore.doTxn("readwrite",[C.IndexedDBCryptoStore.STORE_ACCOUNT],(function(e){o.cryptoStore.storeSecretStorePrivateKey(e,"m.megolm_backup.v1",i)})));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkCrossSigningPrivateKey",value:function(t,n){var r=null;try{return(r=new e.Olm.PkSigning).init_with_seed(t)===n}finally{r&&r.free()}}},{key:"afterCrossSigningLocalKeyChange",value:function(){var e=u(s.mark((function e(){var t,n,r,i,u,c,l,d,f,h,v,g,y,m,k=this;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b.logger.info("Starting cross-signing key change post-processing"),t=this.deviceList.getStoredDevice(this.userId,this.deviceId),e.next=4,this.crossSigningInfo.signDevice(this.userId,t);case 4:if(n=e.sent,b.logger.info("Starting background key sig upload for ".concat(this.deviceId)),function e(t){var r=t.shouldEmit;return k.baseApis.uploadKeySignatures(p({},k.userId,p({},k.deviceId,n))).then((function(t){var n=(t||{}).failures;if(Object.keys(n||[]).length>0)throw r&&k.baseApis.emit("crypto.keySignatureUploadFailure",n,"afterCrossSigningLocalKeyChange",e),new B.KeySignatureUploadError("Key upload failed",{failures:n});b.logger.info("Finished background key sig upload for ".concat(k.deviceId))})).catch((function(e){b.logger.error("Error during background key sig upload for ".concat(k.deviceId),e)}))}({shouldEmit:!0}),!(r=this.baseApis.cryptoCallbacks.shouldUpgradeDeviceVerifications)){e.next=53;break}b.logger.info("Starting device verification upgrade"),i={},u=0,c=Object.entries(this.deviceList.crossSigningInfo);case 13:if(!(u<c.length)){e.next=22;break}return l=o(c[u],2),d=l[0],f=l[1],e.next=17,this.checkForDeviceVerificationUpgrade(d,I.CrossSigningInfo.fromStorage(f,d));case 17:(h=e.sent)&&(i[d]=h);case 19:u++,e.next=13;break;case 22:if(!(Object.keys(i).length>0)){e.next=52;break}return b.logger.info("Found ".concat(Object.keys(i).length," verif users to upgrade")),e.prev=24,e.next=27,r({users:i});case 27:if(!(v=e.sent)){e.next=47;break}g=a(v),e.prev=30,g.s();case 32:if((y=g.n()).done){e.next=39;break}if(!((m=y.value)in i)){e.next=37;break}return e.next=37,this.baseApis.setDeviceVerified(m,i[m].crossSigningInfo.getId());case 37:e.next=32;break;case 39:e.next=44;break;case 41:e.prev=41,e.t0=e.catch(30),g.e(e.t0);case 44:return e.prev=44,g.f(),e.finish(44);case 47:e.next=52;break;case 49:e.prev=49,e.t1=e.catch(24),b.logger.log("shouldUpgradeDeviceVerifications threw an error: not upgrading",e.t1);case 52:b.logger.info("Finished device verification upgrade");case 53:b.logger.info("Finished cross-signing key change post-processing");case 54:case"end":return e.stop()}}),e,this,[[24,49],[30,41,44,47]])})));return function(){return e.apply(this,arguments)}}()},{key:"checkForDeviceVerificationUpgrade",value:function(){var e=u(s.mark((function e(t,n){var r,i,o;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.crossSigningInfo.checkUserTrust(n),!n.firstUse||r.isVerified()){e.next=8;break}return i=this.deviceList.getRawStoredDevicesForUser(t),e.next=5,this.checkForValidDeviceSignature(t,n.keys.master,i);case 5:if(!(o=e.sent).length){e.next=8;break}return e.abrupt("return",{devices:o.map((function(e){return _.DeviceInfo.fromStorage(i[e],e)})),crossSigningInfo:n});case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"checkForValidDeviceSignature",value:function(){var e=u(s.mark((function e(t,n,r){var i,a,u,c,l,d,f;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=[],!(r&&n.signatures&&n.signatures[t])){e.next=18;break}a=0,u=Object.keys(n.signatures[t]);case 3:if(!(a<u.length)){e.next=18;break}if(c=u[a],l=c.split(":",2),d=o(l,2),!((f=d[1])in r)||r[f].verified!==H.VERIFIED){e.next=15;break}return e.prev=7,e.next=10,w.verifySignature(this.olmDevice,n,t,f,r[f].keys[c]);case 10:i.push(f),e.next=15;break;case 13:e.prev=13,e.t0=e.catch(7);case 15:a++,e.next=3;break;case 18:return e.abrupt("return",i);case 19:case"end":return e.stop()}}),e,this,[[7,13]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getCrossSigningId",value:function(e){return this.crossSigningInfo.getId(e)}},{key:"getStoredCrossSigningForUser",value:function(e){return this.deviceList.getStoredCrossSigningForUser(e)}},{key:"checkUserTrust",value:function(e){var t=this.deviceList.getStoredCrossSigningForUser(e);return t?this.crossSigningInfo.checkUserTrust(t):new I.UserTrustLevel(!1,!1,!1)}},{key:"checkDeviceTrust",value:function(e,t){var n=this.deviceList.getStoredDevice(e,t);return this.checkDeviceInfoTrust(e,n)}},{key:"checkDeviceInfoTrust",value:function(e,t){var n=!(!t||!t.isVerified()),r=this.deviceList.getStoredCrossSigningForUser(e);if(t&&r){var i=this.trustCrossSignedDevices||e===this.userId;return this.crossSigningInfo.checkDeviceTrust(r,t,n,i)}return new I.DeviceTrustLevel(!1,!1,n,!1)}},{key:"checkOwnCrossSigningTrust",value:function(){var e=u(s.mark((function e(){var t,n,r,i,o,a,u,c,l,d,f,h,v,g,y,m,k,S,w,E,_,x,I,T,R,O,C,P=this,D=arguments;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=D.length>0&&void 0!==D[0]?D[0]:{},n=t.allowPrivateKeyRequests,r=void 0!==n&&n,i=this.userId,e.next=4,this.downloadKeys([this.userId]);case 4:return e.next=6,this.crossSigningInfo.getCrossSigningKeysFromCache();case 6:if(o=e.sent,a=this.deviceList.getStoredCrossSigningForUser(i)){e.next=11;break}return b.logger.error("Got cross-signing update event for user "+i+" but no new cross-signing information found!"),e.abrupt("return");case 11:if(u=a.getId(),c=this.crossSigningInfo.getId()!==u,l=a.getId()&&!o.has("master"),c&&b.logger.info("Got new master public key",u),!r||!c&&!l){e.next=27;break}return b.logger.info("Attempting to retrieve cross-signing master private key"),d=null,e.prev=18,e.next=21,this.crossSigningInfo.getCrossSigningKey("master",u);case 21:f=e.sent,d=f[1],b.logger.info("Got cross-signing master private key");case 24:return e.prev=24,d&&d.free(),e.finish(24);case 27:if(h=this.crossSigningInfo.getId("self_signing"),v=this.crossSigningInfo.getId("user_signing"),this.storeTrustedSelfKeys(a.keys),g=h!==a.getId("self_signing"),y=v!==a.getId("user_signing"),m=a.getId("self_signing")&&!o.has("self_signing"),k=a.getId("user_signing")&&!o.has("user_signing"),S={},g&&b.logger.info("Got new self-signing key",a.getId("self_signing")),!r||!g&&!m){e.next=53;break}return b.logger.info("Attempting to retrieve cross-signing self-signing private key"),w=null,e.prev=39,e.next=42,this.crossSigningInfo.getCrossSigningKey("self_signing",a.getId("self_signing"));case 42:E=e.sent,w=E[1],b.logger.info("Got cross-signing self-signing private key");case 45:return e.prev=45,w&&w.free(),e.finish(45);case 48:return _=this.deviceList.getStoredDevice(this.userId,this.deviceId),e.next=51,this.crossSigningInfo.signDevice(this.userId,_);case 51:x=e.sent,S[this.deviceId]=x;case 53:if(y&&b.logger.info("Got new user-signing key",a.getId("user_signing")),!r||!y&&!k){e.next=66;break}return b.logger.info("Attempting to retrieve cross-signing user-signing private key"),I=null,e.prev=57,e.next=60,this.crossSigningInfo.getCrossSigningKey("user_signing",a.getId("user_signing"));case 60:T=e.sent,I=T[1],b.logger.info("Got cross-signing user-signing private key");case 63:return e.prev=63,I&&I.free(),e.finish(63);case 66:if(!c){e.next=72;break}return R=this.crossSigningInfo.keys.master,e.next=70,this.signObject(R);case 70:O=R.signatures[this.userId]["ed25519:"+this.deviceId],S[this.crossSigningInfo.getId()]=Object.assign({},R,{signatures:p({},this.userId,p({},"ed25519:"+this.deviceId,O))});case 72:if((C=Object.keys(S)).length&&function e(t){var n=t.shouldEmit;return b.logger.info("Starting background key sig upload for ".concat(C)),P.baseApis.uploadKeySignatures(p({},P.userId,S)).then((function(t){var r=(t||{}).failures;if(b.logger.info("Finished background key sig upload for ".concat(C)),Object.keys(r||[]).length>0)throw n&&P.baseApis.emit("crypto.keySignatureUploadFailure",r,"checkOwnCrossSigningTrust",e),new B.KeySignatureUploadError("Key upload failed",{failures:r})})).catch((function(e){b.logger.error("Error during background key sig upload for ".concat(C),e)}))}({shouldEmit:!0}),this.emit("userTrustStatusChanged",i,this.checkUserTrust(i)),!c){e.next=79;break}return this.baseApis.emit("crossSigning.keysChanged",{}),e.next=79,this.afterCrossSigningLocalKeyChange();case 79:return e.next=81,this.backupManager.checkKeyBackup();case 81:case"end":return e.stop()}}),e,this,[[18,,24,27],[39,,45,48],[57,,63,66]])})));return function(){return e.apply(this,arguments)}}()},{key:"storeTrustedSelfKeys",value:function(){var e=u(s.mark((function e(t){var n=this;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t?this.crossSigningInfo.setKeys(t):this.crossSigningInfo.clearKeys(),e.next=3,this.cryptoStore.doTxn("readwrite",[C.IndexedDBCryptoStore.STORE_ACCOUNT],(function(e){n.cryptoStore.storeCrossSigningKeys(e,n.crossSigningInfo.keys)}));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkDeviceVerifications",value:function(){var e=u(s.mark((function e(t){var n,r,i;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.baseApis.cryptoCallbacks.shouldUpgradeDeviceVerifications){e.next=3;break}return e.abrupt("return");case 3:if(b.logger.info("Starting device verification upgrade for ".concat(t)),!this.crossSigningInfo.keys.user_signing){e.next=17;break}if(!(r=this.deviceList.getStoredCrossSigningForUser(t))){e.next=17;break}return e.next=9,this.checkForDeviceVerificationUpgrade(t,r);case 9:if(!(i=e.sent)){e.next=17;break}return e.next=13,n({users:p({},t,i)});case 13:if(!e.sent.includes(t)){e.next=17;break}return e.next=17,this.baseApis.setDeviceVerified(t,r.getId());case 17:b.logger.info("Finished device verification upgrade for ".concat(t));case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setTrustedBackupPubKey",value:function(){var e=u(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.sessionStore.setLocalTrustedBackupPubKey(t),e.next=3,this.backupManager.checkKeyBackup();case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"enableLazyLoading",value:function(){this.lazyLoadMembers=!0}},{key:"registerEventHandlers",value:function(e){var t=this;e.on("RoomMember.membership",(function(e,n,r){try{t.onRoomMembership(e,n,r)}catch(i){b.logger.error("Error handling membership change:",i)}})),e.on("toDeviceEvent",this.onToDeviceEvent),e.on("Room.timeline",this.onTimelineEvent),e.on("Event.decrypted",this.onTimelineEvent)}},{key:"start",value:function(){this.outgoingRoomKeyRequestManager.start()}},{key:"stop",value:function(){this.outgoingRoomKeyRequestManager.stop(),this.deviceList.stop(),this.dehydrationManager.stop()}},{key:"getDeviceEd25519Key",value:function(){return this.olmDevice.deviceEd25519Key}},{key:"getDeviceCurve25519Key",value:function(){return this.olmDevice.deviceCurve25519Key}},{key:"setGlobalBlacklistUnverifiedDevices",value:function(e){this.globalBlacklistUnverifiedDevices=e}},{key:"getGlobalBlacklistUnverifiedDevices",value:function(){return this.globalBlacklistUnverifiedDevices}},{key:"setGlobalErrorOnUnknownDevices",value:function(e){this.globalErrorOnUnknownDevices=e}},{key:"getGlobalErrorOnUnknownDevices",value:function(){return this.globalErrorOnUnknownDevices}},{key:"uploadDeviceKeys",value:function(){var e=this,t={algorithms:this.supportedAlgorithms,device_id:this.deviceId,keys:this.deviceKeys,user_id:this.userId};return this.signObject(t).then((function(){return e.baseApis.uploadKeysRequest({device_keys:t})}))}},{key:"updateOneTimeKeyCount",value:function(e){if(!isFinite(e))throw new TypeError("Parameter for updateOneTimeKeyCount has to be a number");this.oneTimeKeyCount=e}},{key:"setNeedsNewFallback",value:function(e){this.needsNewFallback=!!e}},{key:"getNeedsNewFallback",value:function(){return this.needsNewFallback}},{key:"maybeUploadOneTimeKeys",value:function(){var e=this;if(!this.oneTimeKeyCheckInProgress){var t=Date.now();if(!(null!==this.lastOneTimeKeyCheck&&t-this.lastOneTimeKeyCheck<6e4)){this.lastOneTimeKeyCheck=t;var n=this.olmDevice.maxNumberOfOneTimeKeys(),r=Math.floor(n/2),i=function(){var t=u(s.mark((function t(n){var i,o;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r>n||e.getNeedsNewFallback())){t.next=21;break}if(!(r>n)){t.next=6;break}return b.logger.info("generating oneTimeKeys"),i=Math.min(r-n,5),t.next=6,e.olmDevice.generateOneTimeKeys(i);case 6:if(!e.getNeedsNewFallback()){t.next=10;break}return b.logger.info("generating fallback key"),t.next=10,e.olmDevice.generateFallbackKey();case 10:return b.logger.info("calling uploadOneTimeKeys"),t.next=13,e.uploadOneTimeKeys();case 13:if(!(o=t.sent).one_time_key_counts||!o.one_time_key_counts.signed_curve25519){t.next=18;break}n=o.one_time_key_counts.signed_curve25519,t.next=19;break;case 18:throw new Error("response for uploading keys does not contain one_time_key_counts.signed_curve25519");case 19:t.next=0;break;case 21:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();this.oneTimeKeyCheckInProgress=!0,Promise.resolve().then((function(){return void 0!==e.oneTimeKeyCount?Promise.resolve(e.oneTimeKeyCount):e.baseApis.uploadKeysRequest({}).then((function(e){return e.one_time_key_counts.signed_curve25519||0}))})).then((function(e){return i(e)})).catch((function(e){b.logger.error("Error uploading one-time keys",e.stack||e)})).finally((function(){e.oneTimeKeyCount=void 0,e.oneTimeKeyCheckInProgress=!1}))}}}},{key:"uploadOneTimeKeys",value:function(){var e=u(s.mark((function e(){var t,n,r,i,a,u,c,l,d,f,h,p,v,g;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],n={},!this.getNeedsNewFallback()){e.next=8;break}return e.next=5,this.olmDevice.getFallbackKey();case 5:for(r=e.sent,i=0,a=Object.entries(r.curve25519);i<a.length;i++)u=o(a[i],2),c=u[0],l=u[1],d={key:l,fallback:!0},n["signed_curve25519:"+c]=d,t.push(this.signObject(d));this.setNeedsNewFallback(!1);case 8:return e.next=10,this.olmDevice.getOneTimeKeys();case 10:for(p in f=e.sent,h={},f.curve25519)f.curve25519.hasOwnProperty(p)&&(v={key:f.curve25519[p]},h["signed_curve25519:"+p]=v,t.push(this.signObject(v)));return e.next=15,Promise.all(t);case 15:return e.next=17,this.baseApis.uploadKeysRequest({one_time_keys:h,"org.matrix.msc2732.fallback_keys":n});case 17:return g=e.sent,e.next=20,this.olmDevice.markKeysAsPublished();case 20:return e.abrupt("return",g);case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"downloadKeys",value:function(e,t){return this.deviceList.downloadKeys(e,t)}},{key:"getStoredDevicesForUser",value:function(e){return this.deviceList.getStoredDevicesForUser(e)}},{key:"getStoredDevice",value:function(e,t){return this.deviceList.getStoredDevice(e,t)}},{key:"saveDeviceList",value:function(e){return this.deviceList.saveIfDirty(e)}},{key:"setDeviceVerification",value:function(){var e=u(s.mark((function e(t,n,r,i,o){var a,c,l,d,f,h,v,g,y,m,k=this;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===r&&(r=null),void 0===i&&(i=null),void 0===o&&(o=null),!(a=this.deviceList.getStoredCrossSigningForUser(t))||a.getId()!==n){e.next=23;break}if(null===i&&null===o){e.next=7;break}throw new Error("Cannot set blocked or known for a cross-signing key");case 7:if(r){e.next=9;break}throw new Error("Cannot set a cross-signing key as unverified");case 9:if(this.crossSigningInfo.getId()||t!==this.crossSigningInfo.userId||(this.storeTrustedSelfKeys(a.keys),this.emit("userTrustStatusChanged",this.userId,this.checkUserTrust(t))),t===this.userId){e.next=22;break}return b.logger.info("Master key "+a.getId()+" for "+t+" marked verified. Signing..."),e.next=14,this.crossSigningInfo.signUser(a);case 14:if(!(c=e.sent)){e.next=19;break}return l=function(){var e=u(s.mark((function e(r){var i,o,a;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.shouldEmit,b.logger.info("Uploading signature for "+t+"..."),e.next=4,k.baseApis.uploadKeySignatures(p({},t,p({},n,c)));case 4:if(o=e.sent,a=(o||{}).failures,!(Object.keys(a||[]).length>0)){e.next=9;break}throw i&&k.baseApis.emit("crypto.keySignatureUploadFailure",a,"setDeviceVerification",l),new B.KeySignatureUploadError("Key upload failed",{failures:a});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=19,l({shouldEmit:!0});case 19:return e.abrupt("return",c);case 22:return e.abrupt("return",a);case 23:if((d=this.deviceList.getRawStoredDevicesForUser(t))&&d[n]){e.next=26;break}throw new Error("Unknown device "+t+":"+n);case 26:if(f=d[n],h=f.verified,r?h=H.VERIFIED:null!==r&&h==H.VERIFIED&&(h=H.UNVERIFIED),i?h=H.BLOCKED:null!==i&&h==H.BLOCKED&&(h=H.UNVERIFIED),v=f.known,null!==o&&(v=o),f.verified===h&&f.known===v||(f.verified=h,f.known=v,this.deviceList.storeDevicesForUser(t,d),this.deviceList.saveIfDirty()),!r||t!==this.userId){e.next=47;break}if(b.logger.info("Own device "+n+" marked verified: signing"),!this.checkDeviceTrust(t,n).isCrossSigningVerified()){e.next=40;break}b.logger.log("Own device ".concat(n," already cross-signing verified")),e.next=43;break;case 40:return e.next=42,this.crossSigningInfo.signDevice(t,_.DeviceInfo.fromStorage(f,n));case 42:g=e.sent;case 43:if(!g){e.next=47;break}return y=function(){var e=u(s.mark((function e(r){var i,o,a;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.shouldEmit,b.logger.info("Uploading signature for "+n),e.next=4,k.baseApis.uploadKeySignatures(p({},t,p({},n,g)));case 4:if(o=e.sent,a=(o||{}).failures,!(Object.keys(a||[]).length>0)){e.next=9;break}throw i&&k.baseApis.emit("crypto.keySignatureUploadFailure",a,"setDeviceVerification",y),new B.KeySignatureUploadError("Key upload failed",{failures:a});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=47,y({shouldEmit:!0});case 47:return m=_.DeviceInfo.fromStorage(f,n),this.emit("deviceVerificationChanged",t,n,m),e.abrupt("return",m);case 50:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}()},{key:"findVerificationRequestDMInProgress",value:function(e){return this.inRoomVerificationRequests.findRequestInProgress(e)}},{key:"getVerificationRequestsToDeviceInProgress",value:function(e){return this.toDeviceVerificationRequests.getRequestsInProgress(e)}},{key:"requestVerificationDM",value:function(e,t){var n=this.inRoomVerificationRequests.findRequestInProgress(t);if(n)return Promise.resolve(n);var r=new N.InRoomChannel(this.baseApis,t,e);return this.requestVerificationWithChannel(e,r,this.inRoomVerificationRequests)}},{key:"requestVerification",value:function(e,t){t||(t=Object.keys(this.deviceList.getRawStoredDevicesForUser(e)));var n=this.toDeviceVerificationRequests.findRequestInProgress(e,t);if(n)return Promise.resolve(n);var r=new L.ToDeviceChannel(this.baseApis,e,t,L.ToDeviceChannel.makeTransactionId());return this.requestVerificationWithChannel(e,r,this.toDeviceVerificationRequests)}},{key:"requestVerificationWithChannel",value:function(){var e=u(s.mark((function e(t,n,r){var i,o;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new U.VerificationRequest(n,this.verificationMethods,this.baseApis),n.transactionId&&r.setRequestByChannel(n,i),e.next=4,i.sendRequest();case 4:return(o=r.getRequestByChannel(n))?i=o:(b.logger.log("Crypto: adding new request to "+"requestsByTxnId with id ".concat(n.transactionId," ").concat(n.roomId)),r.setRequestByChannel(n,i)),e.abrupt("return",i);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"beginKeyVerification",value:function(e,t,n){var r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(i){if(!(r=this.toDeviceVerificationRequests.getRequestBySenderAndTxnId(t,i)))throw new Error("No request found for user ".concat(t," with ")+"transactionId ".concat(i))}else{i=L.ToDeviceChannel.makeTransactionId();var o=new L.ToDeviceChannel(this.baseApis,t,[n],i,n);r=new U.VerificationRequest(o,this.verificationMethods,this.baseApis),this.toDeviceVerificationRequests.setRequestBySenderAndTxnId(t,i,r)}return r.beginKeyVerification(e,{userId:t,deviceId:n})}},{key:"legacyDeviceVerification",value:function(){var e=u(s.mark((function e(t,n,r){var i,o,a,u;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=L.ToDeviceChannel.makeTransactionId(),o=new L.ToDeviceChannel(this.baseApis,t,[n],i,n),a=new U.VerificationRequest(o,this.verificationMethods,this.baseApis),this.toDeviceVerificationRequests.setRequestBySenderAndTxnId(t,i,a),u=a.beginKeyVerification(r,{userId:t,deviceId:n}),e.next=7,Promise.race([u.verify(),a.waitFor((function(e){return e.started}))]);case 7:return e.abrupt("return",a);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getOlmSessionsForUser",value:function(){var e=u(s.mark((function e(t){var n,r,i,o,a,u;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.getStoredDevicesForUser(t)||[],r={},i=0;case 3:if(!(i<n.length)){e.next=13;break}return o=n[i],a=o.getIdentityKey(),e.next=8,this.olmDevice.getSessionInfoForDevice(a);case 8:u=e.sent,r[o.deviceId]={deviceIdKey:a,sessions:u};case 10:++i,e.next=3;break;case 13:return e.abrupt("return",r);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getEventSenderDeviceInfo",value:function(e){var t=e.getSenderKey(),n=e.getWireContent().algorithm;if(!t||!n)return null;if(e.getForwardingCurve25519KeyChain().length>0)return null;if(e.isKeySourceUntrusted())return null;var r=this.deviceList.getDeviceByIdentityKey(n,t);if(null===r)return null;var i=e.getClaimedEd25519Key();return i?i!==r.getFingerprint()?(b.logger.warn("Event "+e.getId()+" claims ed25519 key "+i+" but sender device has key "+r.getFingerprint()),null):r:(b.logger.warn("Event "+e.getId()+" claims no ed25519 key: cannot verify sending device"),null)}},{key:"getEventEncryptionInfo",value:function(e){var t={};if(t.senderKey=e.getSenderKey(),t.algorithm=e.getWireContent().algorithm,!t.senderKey||!t.algorithm)return t.encrypted=!1,t;t.encrypted=!0,e.getForwardingCurve25519KeyChain().length>0||e.isKeySourceUntrusted()?t.authenticated=!1:t.authenticated=!0,t.sender=this.deviceList.getDeviceByIdentityKey(t.algorithm,t.senderKey);var n=e.getClaimedEd25519Key();return n||(b.logger.warn("Event "+e.getId()+" claims no ed25519 key: cannot verify sending device"),t.mismatchedSender=!0),t.sender&&n!==t.sender.getFingerprint()&&(b.logger.warn("Event "+e.getId()+" claims ed25519 key "+n+"but sender device has key "+t.sender.getFingerprint()),t.mismatchedSender=!0),t}},{key:"forceDiscardSession",value:function(e){var t=this.roomEncryptors[e];if(void 0===t)throw new Error("Room not encrypted");if(void 0===t.forceDiscardSession)throw new Error("Room encryption algorithm doesn't support session discarding");t.forceDiscardSession()}},{key:"setRoomEncryption",value:function(){var e=u(s.mark((function e(t,n,r){var i,o,a,u;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.algorithm){e.next=3;break}return b.logger.log("Ignoring setRoomEncryption with no algorithm"),e.abrupt("return");case 3:if(!(i=this.roomList.getRoomEncryption(t))){e.next=8;break}if(JSON.stringify(i)==JSON.stringify(n)){e.next=8;break}return b.logger.error("Ignoring m.room.encryption event which requests a change of config in "+t),e.abrupt("return");case 8:if(!this.roomEncryptors[t]){e.next=11;break}return e.abrupt("return");case 11:if(o=null,i||(o=this.roomList.setRoomEncryption(t,n)),a=x.ENCRYPTION_CLASSES[n.algorithm]){e.next=16;break}throw new Error("Unable to encrypt with "+n.algorithm);case 16:if(u=new a({userId:this.userId,deviceId:this.deviceId,crypto:this,olmDevice:this.olmDevice,baseApis:this.baseApis,roomId:t,config:n}),this.roomEncryptors[t]=u,!o){e.next=21;break}return e.next=21,o;case 21:if(this.lazyLoadMembers){e.next=28;break}return b.logger.log("Enabling encryption in "+t+"; starting to track device lists for all users therein"),e.next=25,this.trackRoomDevices(t);case 25:r||this.deviceList.refreshOutdatedDeviceLists(),e.next=29;break;case 28:b.logger.log("Enabling encryption in "+t);case 29:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"trackRoomDevices",value:function(e){var t=this,n=function(){var n=u(s.mark((function n(){var r;return s.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.roomEncryptors[e]){n.next=2;break}return n.abrupt("return");case 2:if(r=t.clientStore.getRoom(e)){n.next=5;break}throw new Error("Unable to start tracking devices in unknown room ".concat(e));case 5:return b.logger.log("Starting to track devices for room ".concat(e," ...")),n.next=8,r.getEncryptionTargetMembers();case 8:n.sent.forEach((function(e){t.deviceList.startTrackingDeviceList(e.userId)}));case 10:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),r=this.roomDeviceTrackingState[e];return r||(r=n(),this.roomDeviceTrackingState[e]=r.catch((function(n){throw t.roomDeviceTrackingState[e]=null,n}))),r}},{key:"ensureOlmSessionsForUsers",value:function(e){for(var t={},n=0;n<e.length;++n){var r=e[n];t[r]=[];for(var i=this.getStoredDevicesForUser(r)||[],o=0;o<i.length;++o){var a=i[o];a.getIdentityKey()!=this.olmDevice.deviceCurve25519Key&&(a.verified!=H.BLOCKED&&t[r].push(a))}}return w.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,t)}},{key:"exportRoomKeys",value:function(){var e=u(s.mark((function e(){var t,n=this;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,this.cryptoStore.doTxn("readonly",[C.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS],(function(e){n.cryptoStore.getAllEndToEndInboundGroupSessions(e,(function(e){if(null!==e){var r=n.olmDevice.exportInboundGroupSession(e.senderKey,e.sessionId,e.sessionData);delete r.first_known_index,r.algorithm=w.MEGOLM_ALGORITHM,t.push(r)}}))}));case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"importRoomKeys",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=0,i=0,o=e.length;function a(){n.progressCallback({stage:"load_keys",successes:r,failures:i,total:o})}return Promise.all(e.map((function(e){return e.room_id&&e.algorithm?t.getRoomDecryptor(e.room_id,e.algorithm).importRoomKey(e,n).finally((function(){r++,n.progressCallback&&a()})):(b.logger.warn("ignoring room key entry with missing fields",e),i++,n.progressCallback&&a(),null)})))}},{key:"countSessionsNeedingBackup",value:function(){return this.backupManager.countSessionsNeedingBackup()}},{key:"prepareToEncrypt",value:function(e){var t=this.roomEncryptors[e.roomId];t&&t.prepareToEncrypt(e)}},{key:"encryptEvent",value:function(){var e=u(s.mark((function e(t,n){var r,i,o,a,u,c;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}throw new Error("Cannot send encrypted messages in unknown rooms");case 2:if(r=t.getRoomId(),i=this.roomEncryptors[r]){e.next=6;break}throw new Error("Room was previously configured to use encryption, but is no longer. Perhaps the homeserver is hiding the configuration event.");case 6:return this.roomDeviceTrackingState[r]||this.trackRoomDevices(r),e.next=9,this.roomDeviceTrackingState[r];case 9:return o=t.getContent(),(a=o["m.relates_to"])&&delete(o=Object.assign({},o))["m.relates_to"],(u=o["io.element.performance_metrics"])&&delete(o=Object.assign({},o))["io.element.performance_metrics"],e.next=16,i.encryptMessage(n,t.getType(),o);case 16:c=e.sent,a&&(c["m.relates_to"]=a),u&&(c["io.element.performance_metrics"]=u),t.makeEncrypted("m.room.encrypted",c,this.olmDevice.deviceCurve25519Key,this.olmDevice.deviceEd25519Key);case 20:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"decryptEvent",value:function(){var e=u(s.mark((function e(t){var n,r,i,o;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isRedacted()){e.next=8;break}return n=new V.MatrixEvent(t.getUnsigned().redacted_because),e.next=4,this.decryptEvent(n);case 4:return r=e.sent,e.abrupt("return",{clearEvent:{room_id:t.getRoomId(),type:"m.room.message",content:{},unsigned:{redacted_because:r.clearEvent}}});case 8:return i=t.getWireContent(),o=this.getRoomDecryptor(t.getRoomId(),i.algorithm),e.next=12,o.decryptEvent(t);case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleDeviceListChanges",value:function(){var e=u(s.mark((function e(t,n){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.oldSyncToken){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.evalDeviceListChanges(n);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"requestRoomKey",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.outgoingRoomKeyRequestManager.queueRoomKeyRequest(e,t,r).then((function(){n.sendKeyRequestsImmediately&&n.outgoingRoomKeyRequestManager.sendQueuedRequests()})).catch((function(e){b.logger.error("Error requesting key for event",e)}))}},{key:"cancelRoomKeyRequest",value:function(e){this.outgoingRoomKeyRequestManager.cancelRoomKeyRequest(e).catch((function(e){b.logger.warn("Error clearing pending room key requests",e)}))}},{key:"cancelAndResendAllOutgoingKeyRequests",value:function(){var e=u(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.outgoingRoomKeyRequestManager.cancelAndResendAllOutgoingRequests();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onCryptoEvent",value:function(){var e=u(s.mark((function e(t){var n,r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getRoomId(),r=t.getContent(),e.prev=2,e.next=5,this.setRoomEncryption(n,r,!0);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),b.logger.error("Error configuring encryption in room "+n+":",e.t0);case 10:case"end":return e.stop()}}),e,this,[[2,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onSyncWillProcess",value:function(){var e=u(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.oldSyncToken||(b.logger.log("Initial sync performed - resetting device tracking state"),this.deviceList.stopTrackingAllDeviceLists(),this.deviceList.startTrackingDeviceList(this.userId),this.roomDeviceTrackingState={}),this.sendKeyRequestsImmediately=!1;case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onSyncCompleted",value:function(){var e=u(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.deviceList.setSyncToken(t.nextSyncToken),this.deviceList.saveIfDirty(),this.deviceList.startTrackingDeviceList(this.userId),this.deviceList.refreshOutdatedDeviceLists(),t.catchingUp||(this.maybeUploadOneTimeKeys(),this.processReceivedRoomKeyRequests(),this.outgoingRoomKeyRequestManager.sendQueuedRequests(),this.sendKeyRequestsImmediately=!0);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"evalDeviceListChanges",value:function(){var e=u(s.mark((function e(t){var n,r=this;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.changed&&Array.isArray(t.changed)&&t.changed.forEach((function(e){r.deviceList.invalidateUserDeviceList(e)})),!(t.left&&Array.isArray(t.left)&&t.left.length)){e.next=8;break}return e.t0=Set,e.next=5,this.getTrackedE2eUsers();case 5:e.t1=e.sent,n=new e.t0(e.t1),t.left.forEach((function(e){n.has(e)||r.deviceList.stopTrackingDeviceList(e)}));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getTrackedE2eUsers",value:function(){var e=u(s.mark((function e(){var t,n,r,i,o,u,c,l;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=a(this.getTrackedE2eRooms()),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=13;break}return i=r.value,e.next=8,i.getEncryptionTargetMembers();case 8:o=e.sent,u=a(o);try{for(u.s();!(c=u.n()).done;)l=c.value,t.push(l.userId)}catch(s){u.e(s)}finally{u.f()}case 11:e.next=4;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(2),n.e(e.t0);case 18:return e.prev=18,n.f(),e.finish(18);case 21:return e.abrupt("return",t);case 22:case"end":return e.stop()}}),e,this,[[2,15,18,21]])})));return function(){return e.apply(this,arguments)}}()},{key:"getTrackedE2eRooms",value:function(){var e=this;return this.clientStore.getRooms().filter((function(t){if(!e.roomEncryptors[t.roomId])return!1;if(!e.roomDeviceTrackingState[t.roomId])return!1;var n=t.getMyMembership();return"join"===n||"invite"===n}))}},{key:"onRoomKeyEvent",value:function(e){var t=e.getContent();t.room_id&&t.algorithm?(this.backupManager.checkedForBackup||this.backupManager.checkAndStart(),this.getRoomDecryptor(t.room_id,t.algorithm).onRoomKeyEvent(e)):b.logger.error("key event is missing fields")}},{key:"onRoomKeyWithheldEvent",value:function(e){var t=e.getContent();if(("m.no_olm"===t.code||t.room_id&&t.session_id)&&t.algorithm&&t.sender_key){b.logger.info("Got room key withheld event from ".concat(e.getSender()," (").concat(t.sender_key,") ")+"for ".concat(t.algorithm,"/").concat(t.room_id,"/").concat(t.session_id," ")+"with reason ".concat(t.code," (").concat(t.reason,")"));var n=this.getRoomDecryptor(t.room_id,t.algorithm);if(n.onRoomKeyWithheldEvent&&n.onRoomKeyWithheldEvent(e),!t.room_id){var r,i=this.getRoomDecryptors(t.algorithm),o=a(i);try{for(o.s();!(r=o.n()).done;){r.value.retryDecryptionFromSender(t.sender_key)}}catch(s){o.e(s)}finally{o.f()}}}else b.logger.error("key withheld event is missing fields")}},{key:"onKeyVerificationMessage",value:function(e){var t=this;if(L.ToDeviceChannel.validateEvent(e,this.baseApis)){this.handleVerificationEvent(e,this.toDeviceVerificationRequests,(function(e){if(L.ToDeviceChannel.canCreateRequest(L.ToDeviceChannel.getEventType(e))){var n=e.getContent(),r=n&&n.from_device;if(r){var i=e.getSender(),o=new L.ToDeviceChannel(t.baseApis,i,[r]);return new U.VerificationRequest(o,t.verificationMethods,t.baseApis)}}}))}}},{key:"handleVerificationEvent",value:function(){var e=u(s.mark((function e(t,n,r){var i,o,a,u,c,l=arguments;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=!(l.length>3&&void 0!==l[3])||l[3],!t.isSending()||t.status==V.EventStatus.SENT){e.next=15;break}return e.prev=2,e.next=5,new Promise((function(e,n){o=e,a=function(){t.status==V.EventStatus.CANCELLED&&n(new Error("Event status set to CANCELLED."))},t.once("Event.localEventIdReplaced",o),t.on("Event.status",a)}));case 5:e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(2),b.logger.error("error while waiting for the verification event to be sent: "+e.t0.message),e.abrupt("return");case 11:return e.prev=11,t.removeListener("Event.localEventIdReplaced",o),t.removeListener("Event.status",a),e.finish(11);case 15:if(u=n.getRequest(t),c=!1,u){e.next=24;break}if(u=r(t)){e.next=22;break}return b.logger.log("Crypto: could not find VerificationRequest for "+"".concat(t.getType(),", and could not create one, so ignoring.")),e.abrupt("return");case 22:c=!0,n.setRequest(t,u);case 24:return t.setVerificationRequest(u),e.prev=25,e.next=28,u.channel.handleEvent(t,u,i);case 28:e.next=33;break;case 30:e.prev=30,e.t1=e.catch(25),b.logger.error("error while handling verification event: "+e.t1.message);case 33:c&&!u.initiatedByMe&&!u.invalid&&!u.observeOnly&&this.baseApis.emit("crypto.verification.request",u);case 35:case"end":return e.stop()}}),e,this,[[2,7,11,15],[25,30]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"onToDeviceBadEncrypted",value:function(){var e=u(s.mark((function e(t){var n,r,i,o,u,c,l,d,f,h,v,g,y,m=this;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.getWireContent(),r=t.getSender(),i=n.algorithm,o=n.sender_key,u=function(){var e,t=m.getRoomDecryptors(w.MEGOLM_ALGORITHM),n=a(t);try{for(n.s();!(e=n.n()).done;){e.value.retryDecryptionFromSender(o)}}catch(r){n.e(r)}finally{n.f()}},void 0!==r&&void 0!==o&&void 0!==o){e.next=7;break}return e.abrupt("return");case 7:if(this.lastNewSessionForced[r]=this.lastNewSessionForced[r]||{},!((c=this.lastNewSessionForced[r][o]||0)+36e5>Date.now())){e.next=15;break}return b.logger.debug("New session already forced with device "+r+":"+o+" at "+c+": not forcing another"),e.next=13,this.olmDevice.recordSessionProblem(o,"wedged",!0);case 13:return u(),e.abrupt("return");case 15:if(l=this.deviceList.getDeviceByIdentityKey(i,o)){e.next=26;break}return e.next=19,this.downloadKeys([r],!1);case 19:if(l=this.deviceList.getDeviceByIdentityKey(i,o)){e.next=26;break}return b.logger.info("Couldn't find device for identity key "+o+": not re-establishing session"),e.next=24,this.olmDevice.recordSessionProblem(o,"wedged",!1);case 24:return u(),e.abrupt("return");case 26:return(d={})[r]=[l],e.next=30,w.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,d,!0);case 30:return this.lastNewSessionForced[r][o]=Date.now(),f={algorithm:w.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}},e.next=34,w.encryptMessageForDevice(f.ciphertext,this.userId,this.deviceId,this.olmDevice,r,l,{type:"m.dummy"});case 34:return e.next=36,this.olmDevice.recordSessionProblem(o,"wedged",!0);case 36:return u(),e.next=39,this.baseApis.sendToDevice("m.room.encrypted",p({},r,p({},l.deviceId,f)));case 39:return e.next=41,this.outgoingRoomKeyRequestManager.getOutgoingSentRoomKeyRequest(r,l.deviceId);case 41:h=e.sent,v=a(h);try{for(v.s();!(g=v.n()).done;)y=g.value,this.requestRoomKey(y.requestBody,y.recipients,!0)}catch(s){v.e(s)}finally{v.f()}case 44:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onRoomMembership",value:function(e,t,n){var r=t.roomId,i=this.roomEncryptors[r];i&&(this.roomDeviceTrackingState[r]&&("join"==t.membership?(b.logger.log("Join event for "+t.userId+" in "+r),this.deviceList.startTrackingDeviceList(t.userId)):"invite"==t.membership&&this.clientStore.getRoom(r).shouldEncryptForInvitedMembers()&&(b.logger.log("Invite event for "+t.userId+" in "+r),this.deviceList.startTrackingDeviceList(t.userId))),i.onRoomMembership(e,t,n))}},{key:"onRoomKeyRequestEvent",value:function(e){var t=e.getContent();if("request"===t.action){var n=new J(e);this.receivedRoomKeyRequests.push(n)}else if("request_cancellation"===t.action){var r=new X(e);this.receivedRoomKeyRequestCancellations.push(r)}}},{key:"processReceivedRoomKeyRequests",value:function(){var e=u(s.mark((function e(){var t,n,r=this;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.processingRoomKeyRequests){e.next=2;break}return e.abrupt("return");case 2:return this.processingRoomKeyRequests=!0,e.prev=3,t=this.receivedRoomKeyRequests,this.receivedRoomKeyRequests=[],n=this.receivedRoomKeyRequestCancellations,this.receivedRoomKeyRequestCancellations=[],e.next=10,Promise.all(t.map((function(e){return r.processReceivedRoomKeyRequest(e)})));case 10:return e.next=12,Promise.all(n.map((function(e){return r.processReceivedRoomKeyRequestCancellation(e)})));case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),b.logger.error("Error processing room key requsts: ".concat(e.t0));case 17:return e.prev=17,this.processingRoomKeyRequests=!1,e.finish(17);case 20:case"end":return e.stop()}}),e,this,[[3,14,17,20]])})));return function(){return e.apply(this,arguments)}}()},{key:"processReceivedRoomKeyRequest",value:function(){var e=u(s.mark((function e(t){var n,r,i,o,a,u,c,l;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.userId,r=t.deviceId,i=t.requestBody,o=i.room_id,a=i.algorithm,b.logger.log("m.room_key_request from ".concat(n,":").concat(r)+" for ".concat(o," / ").concat(i.session_id," (id ").concat(t.requestId,")")),n===this.userId){e.next=24;break}if(this.roomEncryptors[o]){e.next=10;break}return b.logger.debug("room key request for unencrypted room ".concat(o)),e.abrupt("return");case 10:if(u=this.roomEncryptors[o],c=this.deviceList.getStoredDevice(n,r)){e.next=15;break}return b.logger.debug("Ignoring keyshare for unknown device ".concat(n,":").concat(r)),e.abrupt("return");case 15:return e.prev=15,e.next=18,u.reshareKeyWithDevice(i.sender_key,i.session_id,n,c);case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(15),b.logger.warn("Failed to re-share keys for session "+i.session_id+" with device "+n+":"+c.deviceId,e.t0);case 23:return e.abrupt("return");case 24:if(r!==this.deviceId){e.next=27;break}return b.logger.log("Ignoring room key request from ourselves"),e.abrupt("return");case 27:if(this.roomDecryptors[o]){e.next=30;break}return b.logger.log("room key request for unencrypted room ".concat(o)),e.abrupt("return");case 30:if(l=this.roomDecryptors[o][a]){e.next=34;break}return b.logger.log("room key request for unknown alg ".concat(a," in room ").concat(o)),e.abrupt("return");case 34:return e.next=36,l.hasKeysForKeyRequest(t);case 36:if(e.sent){e.next=39;break}return b.logger.log("room key request for unknown session ".concat(o," / ")+i.session_id),e.abrupt("return");case 39:if(t.share=function(){l.shareKeysWithDevice(t)},!this.checkDeviceTrust(n,r).isVerified()){e.next=44;break}return b.logger.log("device is already verified: sharing keys"),t.share(),e.abrupt("return");case 44:this.emit("crypto.roomKeyRequest",t);case 45:case"end":return e.stop()}}),e,this,[[15,20]])})));return function(t){return e.apply(this,arguments)}}()},{key:"processReceivedRoomKeyRequestCancellation",value:function(){var e=u(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:b.logger.log("m.room_key_request cancellation for ".concat(t.userId,":")+"".concat(t.deviceId," (id ").concat(t.requestId,")")),this.emit("crypto.roomKeyRequestCancellation",t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRoomDecryptor",value:function(e,t){var n,r;if((e=e||null)&&((n=this.roomDecryptors[e])||(this.roomDecryptors[e]=n={}),r=n[t]))return r;var i=x.DECRYPTION_CLASSES[t];if(!i)throw new x.DecryptionError("UNKNOWN_ENCRYPTION_ALGORITHM",'Unknown encryption algorithm "'+t+'".');return r=new i({userId:this.userId,crypto:this,olmDevice:this.olmDevice,baseApis:this.baseApis,roomId:e}),n&&(n[t]=r),r}},{key:"getRoomDecryptors",value:function(e){for(var t=[],n=0,r=Object.values(this.roomDecryptors);n<r.length;n++){var i=r[n];e in i&&t.push(i[e])}return t}},{key:"signObject",value:function(){var e=u(s.mark((function e(t){var n,r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.signatures||{},r=t.unsigned,delete t.signatures,delete t.unsigned,n[this.userId]=n[this.userId]||{},e.next=7,this.olmDevice.sign(y.default.stringify(t));case 7:n[this.userId]["ed25519:"+this.deviceId]=e.sent,t.signatures=n,void 0!==r&&(t.unsigned=r);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"getOlmVersion",value:function(){return S.OlmDevice.getOlmVersion()}}]),i}(m.EventEmitter);function Q(e){if("string"!==typeof e||e.indexOf(",")<0)return null;var t=Uint8Array.from(e.split(","),(function(e){return parseInt(e)}));return w.encodeBase64(t)}t.Crypto=Y;var J=function e(t){c(this,e),(0,g.default)(this,"userId",void 0),(0,g.default)(this,"deviceId",void 0),(0,g.default)(this,"requestId",void 0),(0,g.default)(this,"requestBody",void 0),(0,g.default)(this,"share",void 0);var n=t.getContent();this.userId=t.getSender(),this.deviceId=n.requesting_device_id,this.requestId=n.request_id,this.requestBody=n.body||{},this.share=function(){throw new Error("don't know how to share keys for this request yet")}};t.IncomingRoomKeyRequest=J;var X=function e(t){c(this,e),(0,g.default)(this,"userId",void 0),(0,g.default)(this,"deviceId",void 0),(0,g.default)(this,"requestId",void 0);var n=t.getContent();this.userId=t.getSender(),this.deviceId=n.requesting_device_id,this.requestId=n.request_id}}).call(this,n(14),n(24).Buffer)},function(e,t,n){"use strict";var r=n(6),i=n(7),o=n(0),a=n(2),s=n(11),u=n(9),c=n(10),l=n(1)(n(3)),d=n(5),f=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=v(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}r.default=e,n&&n.set(e,r);return r}(n(19)),h=n(41),p=n(54);function v(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(v=function(e){return e?n:t})(e)}var g=h.DeviceInfo.DeviceVerification,y=function(e){u(n,e);var t=c(n);function n(){var e;o(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,l.default)(s(e),"sessionPrepared",!1),(0,l.default)(s(e),"prepPromise",null),e}return a(n,[{key:"ensureSession",value:function(e){var t=this;return this.prepPromise?this.prepPromise:this.sessionPrepared?Promise.resolve():(this.prepPromise=this.crypto.downloadKeys(e).then((function(n){return t.crypto.ensureOlmSessionsForUsers(e)})).then((function(){t.sessionPrepared=!0})).finally((function(){t.prepPromise=null})),this.prepPromise)}},{key:"encryptMessage",value:function(){var e=i(r.mark((function e(t,n,i){var o,a,s,u,c,l,d,h,p,v;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getEncryptionTargetMembers();case 2:return o=e.sent,a=o.map((function(e){return e.userId})),e.next=6,this.ensureSession(a);case 6:s={room_id:t.roomId,type:n,content:i},u={algorithm:f.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}},c=[],l=0;case 10:if(!(l<a.length)){e.next=28;break}d=a[l],h=this.crypto.getStoredDevicesForUser(d),p=0;case 14:if(!(p<h.length)){e.next=25;break}if(v=h[p],v.getIdentityKey()!=this.olmDevice.deviceCurve25519Key){e.next=19;break}return e.abrupt("continue",22);case 19:if(v.verified!=g.BLOCKED){e.next=21;break}return e.abrupt("continue",22);case 21:c.push(f.encryptMessageForDevice(u.ciphertext,this.userId,this.deviceId,this.olmDevice,d,v,s));case 22:++p,e.next=14;break;case 25:++l,e.next=10;break;case 28:return e.next=30,Promise.all(c).then((function(){return u}));case 30:return e.abrupt("return",e.sent);case 31:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(p.EncryptionAlgorithm),m=function(e){u(n,e);var t=c(n);function n(){return o(this,n),t.apply(this,arguments)}return a(n,[{key:"decryptEvent",value:function(){var e=i(r.mark((function e(t){var n,i,o,a,s,u,c;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.getWireContent(),i=n.sender_key,o=n.ciphertext){e.next=5;break}throw new p.DecryptionError("OLM_MISSING_CIPHERTEXT","Missing ciphertext");case 5:if(this.olmDevice.deviceCurve25519Key in o){e.next=7;break}throw new p.DecryptionError("OLM_NOT_INCLUDED_IN_RECIPIENTS","Not included in recipients");case 7:return a=o[this.olmDevice.deviceCurve25519Key],e.prev=8,e.next=11,this.decryptMessage(i,a);case 11:s=e.sent,e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(8),new p.DecryptionError("OLM_BAD_ENCRYPTED_MESSAGE","Bad Encrypted Message",{sender:i,err:e.t0});case 17:if((u=JSON.parse(s)).recipient==this.userId){e.next=20;break}throw new p.DecryptionError("OLM_BAD_RECIPIENT","Message was intented for "+u.recipient);case 20:if(u.recipient_keys.ed25519==this.olmDevice.deviceEd25519Key){e.next=22;break}throw new p.DecryptionError("OLM_BAD_RECIPIENT_KEY","Message not intended for this device",{intended:u.recipient_keys.ed25519,our_key:this.olmDevice.deviceEd25519Key});case 22:if(u.sender==t.getSender()){e.next=24;break}throw new p.DecryptionError("OLM_FORWARDED_MESSAGE","Message forwarded from "+u.sender,{reported_sender:t.getSender()});case 24:if(u.room_id===t.getRoomId()){e.next=26;break}throw new p.DecryptionError("OLM_BAD_ROOM","Message intended for room "+u.room_id,{reported_room:t.getRoomId()});case 26:return c=u.keys||{},e.abrupt("return",{clearEvent:u,senderCurve25519Key:i,claimedEd25519Key:c.ed25519||null});case 28:case"end":return e.stop()}}),e,this,[[8,14]])})));return function(t){return e.apply(this,arguments)}}()},{key:"decryptMessage",value:function(){var e=i(r.mark((function e(t,n){var i,o=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0===n.type){e.next=4;break}return e.abrupt("return",this.reallyDecryptMessage(t,n));case 4:return i=this.olmDevice.olmPrekeyPromise.then((function(){return o.reallyDecryptMessage(t,n)})),this.olmDevice.olmPrekeyPromise=i.catch((function(){})),e.next=8,i;case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"reallyDecryptMessage",value:function(){var e=i(r.mark((function e(t,n){var i,o,a,s,u,c;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.olmDevice.getSessionIdsForDevice(t);case 2:i=e.sent,o={},a=0;case 5:if(!(a<i.length)){e.next=26;break}return s=i[a],e.prev=7,e.next=10,this.olmDevice.decryptMessage(t,s,n.type,n.body);case 10:return u=e.sent,d.logger.log("Decrypted Olm message from "+t+" with session "+s),e.abrupt("return",u);case 15:return e.prev=15,e.t0=e.catch(7),e.next=19,this.olmDevice.matchesSession(t,s,n.type,n.body);case 19:if(!e.sent){e.next=22;break}throw new Error("Error decrypting prekey message with existing session id "+s+": "+e.t0.message);case 22:o[s]=e.t0.message;case 23:a++,e.next=5;break;case 26:if(0===n.type){e.next=30;break}if(0!==i.length){e.next=29;break}throw new Error("No existing sessions");case 29:throw new Error("Error decrypting non-prekey message with existing sessions: "+JSON.stringify(o));case 30:return e.prev=30,e.next=33,this.olmDevice.createInboundSession(t,n.type,n.body);case 33:c=e.sent,e.next=40;break;case 36:throw e.prev=36,e.t1=e.catch(30),o["(new)"]=e.t1.message,new Error("Error decrypting prekey message: "+JSON.stringify(o));case 40:return d.logger.log("created new inbound Olm session ID "+c.session_id+" with "+t),e.abrupt("return",c.payload);case 42:case"end":return e.stop()}}),e,this,[[7,15],[30,36]])})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(p.DecryptionAlgorithm);(0,p.registerAlgorithm)(f.OLM_ALGORITHM,y,m)},function(e,t,n){"use strict";var r=n(8),i=n(21),o=n(13),a=n(6),s=n(7),u=n(0),c=n(2),l=n(11),d=n(9),f=n(10),h=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.DeviceList=t.TrackingStatus=void 0;var p,v=h(n(3)),g=n(15),y=n(5),m=n(41),k=n(42),b=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=E(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}r.default=e,n&&n.set(e,r);return r}(n(19)),S=n(22),w=n(12);function E(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(E=function(e){return e?n:t})(e)}t.TrackingStatus=p,function(e){e[e.NotTracked=0]="NotTracked",e[e.PendingDownload=1]="PendingDownload",e[e.DownloadInProgress=2]="DownloadInProgress",e[e.UpToDate=3]="UpToDate"}(p||(t.TrackingStatus=p={}));var _=function(e){d(n,e);var t=f(n);function n(e,r,i){var o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:250;return u(this,n),(o=t.call(this)).cryptoStore=r,o.keyDownloadChunkSize=a,(0,v.default)(l(o),"devices",{}),(0,v.default)(l(o),"crossSigningInfo",{}),(0,v.default)(l(o),"userByIdentityKey",{}),(0,v.default)(l(o),"deviceTrackingStatus",{}),(0,v.default)(l(o),"syncToken",null),(0,v.default)(l(o),"keyDownloadsInProgressByUser",{}),(0,v.default)(l(o),"dirty",!1),(0,v.default)(l(o),"savePromise",null),(0,v.default)(l(o),"resolveSavePromise",null),(0,v.default)(l(o),"savePromiseTime",null),(0,v.default)(l(o),"saveTimer",null),(0,v.default)(l(o),"hasFetched",null),(0,v.default)(l(o),"serialiser",void 0),o.serialiser=new x(e,i,l(o)),o}return c(n,[{key:"load",value:function(){var e=s(a.mark((function e(){var t,n,r,i=this;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cryptoStore.doTxn("readonly",[S.IndexedDBCryptoStore.STORE_DEVICE_DATA],(function(e){i.cryptoStore.getEndToEndDeviceData(e,(function(e){i.hasFetched=Boolean(e&&e.devices),i.devices=e?e.devices:{},i.crossSigningInfo=e&&e.crossSigningInfo||{},i.deviceTrackingStatus=e?e.trackingStatus:{},i.syncToken=e?e.syncToken:null,i.userByIdentityKey={};for(var t=0,n=Object.keys(i.devices);t<n.length;t++)for(var r=n[t],o=i.devices[r],a=0,s=Object.keys(o);a<s.length;a++){var u=s[a],c=o[u].keys["curve25519:"+u];void 0!==c&&(i.userByIdentityKey[c]=r)}}))}));case 2:for(t=0,n=Object.keys(this.deviceTrackingStatus);t<n.length;t++)r=n[t],this.deviceTrackingStatus[r]==p.DownloadInProgress&&(this.deviceTrackingStatus[r]=p.PendingDownload);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){null!==this.saveTimer&&clearTimeout(this.saveTimer)}},{key:"saveIfDirty",value:function(){var e=s(a.mark((function e(){var t,n,r,i,o=this,s=arguments;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:500,this.dirty){e.next=3;break}return e.abrupt("return",Promise.resolve(!1));case 3:return n=Date.now()+t,this.savePromiseTime&&n<this.savePromiseTime&&(clearTimeout(this.saveTimer),this.saveTimer=null,this.savePromiseTime=null),null===(r=this.savePromise)&&(r=new Promise((function(e,t){o.resolveSavePromise=e})),this.savePromise=r),null===this.saveTimer&&(i=this.resolveSavePromise,this.savePromiseTime=n,this.saveTimer=setTimeout((function(){y.logger.log("Saving device tracking data",o.syncToken),o.savePromiseTime=null,o.saveTimer=null,o.savePromise=null,o.resolveSavePromise=null,o.cryptoStore.doTxn("readwrite",[S.IndexedDBCryptoStore.STORE_DEVICE_DATA],(function(e){o.cryptoStore.storeEndToEndDeviceData({devices:o.devices,crossSigningInfo:o.crossSigningInfo,trackingStatus:o.deviceTrackingStatus,syncToken:o.syncToken},e)})).then((function(){o.dirty=!1,i(!0)}),(function(e){y.logger.error("Failed to save device tracking data",o.syncToken),y.logger.error(e)}))}),t)),e.abrupt("return",r);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getSyncToken",value:function(){return this.syncToken}},{key:"setSyncToken",value:function(e){this.syncToken=e}},{key:"downloadKeys",value:function(e,t){var n=this,r=[],i=[];if(e.forEach((function(e){var o=n.deviceTrackingStatus[e];n.keyDownloadsInProgressByUser[e]?(y.logger.log("downloadKeys: already have a download in progress for "+"".concat(e,": awaiting its result")),i.push(n.keyDownloadsInProgressByUser[e])):(t||o!=p.UpToDate)&&r.push(e)})),0!=r.length){y.logger.log("downloadKeys: downloading for",r);var o=this.doKeyDownload(r);i.push(o)}return 0===i.length&&y.logger.log("downloadKeys: already have all necessary keys"),Promise.all(i).then((function(){return n.getDevicesFromStore(e)}))}},{key:"getDevicesFromStore",value:function(e){var t=this,n={};return e.map((function(e){n[e]={},(t.getStoredDevicesForUser(e)||[]).map((function(t){n[e][t.deviceId]=t}))})),n}},{key:"getKnownUserIds",value:function(){return Object.keys(this.devices)}},{key:"getStoredDevicesForUser",value:function(e){var t=this.devices[e];if(!t)return null;var n=[];for(var r in t)t.hasOwnProperty(r)&&n.push(m.DeviceInfo.fromStorage(t[r],r));return n}},{key:"getRawStoredDevicesForUser",value:function(e){return this.devices[e]}},{key:"getStoredCrossSigningForUser",value:function(e){return this.crossSigningInfo[e]?k.CrossSigningInfo.fromStorage(this.crossSigningInfo[e],e):null}},{key:"storeCrossSigningForUser",value:function(e,t){this.crossSigningInfo[e]=t,this.dirty=!0}},{key:"getStoredDevice",value:function(e,t){var n=this.devices[e];if(n&&n[t])return m.DeviceInfo.fromStorage(n[t],t)}},{key:"getUserByIdentityKey",value:function(e,t){return e!==b.OLM_ALGORITHM&&e!==b.MEGOLM_ALGORITHM?null:this.userByIdentityKey[t]}},{key:"getDeviceByIdentityKey",value:function(e,t){var n=this.getUserByIdentityKey(e,t);if(!n)return null;var r=this.devices[n];if(!r)return null;for(var i in r)if(r.hasOwnProperty(i)){var o=r[i];for(var a in o.keys){if(o.keys.hasOwnProperty(a))if(0===a.indexOf("curve25519:"))if(o.keys[a]==t)return m.DeviceInfo.fromStorage(o,i)}}return null}},{key:"storeDevicesForUser",value:function(e,t){this.setRawStoredDevicesForUser(e,t),this.dirty=!0}},{key:"startTrackingDeviceList",value:function(e){if("string"!==typeof e)throw new Error("userId must be a string; was "+e);this.deviceTrackingStatus[e]||(y.logger.log("Now tracking device list for "+e),this.deviceTrackingStatus[e]=p.PendingDownload,this.dirty=!0)}},{key:"stopTrackingDeviceList",value:function(e){this.deviceTrackingStatus[e]&&(y.logger.log("No longer tracking device list for "+e),this.deviceTrackingStatus[e]=p.NotTracked,this.dirty=!0)}},{key:"stopTrackingAllDeviceLists",value:function(){for(var e=0,t=Object.keys(this.deviceTrackingStatus);e<t.length;e++){var n=t[e];this.deviceTrackingStatus[n]=p.NotTracked}this.dirty=!0}},{key:"invalidateUserDeviceList",value:function(e){this.deviceTrackingStatus[e]&&(y.logger.log("Marking device list outdated for",e),this.deviceTrackingStatus[e]=p.PendingDownload,this.dirty=!0)}},{key:"refreshOutdatedDeviceLists",value:function(){this.saveIfDirty();for(var e=[],t=0,n=Object.keys(this.deviceTrackingStatus);t<n.length;t++){var r=n[t];this.deviceTrackingStatus[r]==p.PendingDownload&&e.push(r)}return this.doKeyDownload(e)}},{key:"setRawStoredDevicesForUser",value:function(e,t){if(void 0!==this.devices[e])for(var n=0,r=Object.entries(this.devices[e]);n<r.length;n++){var i=o(r[n],2),a=i[0],s=i[1].keys["curve25519:"+a];delete this.userByIdentityKey[s]}this.devices[e]=t;for(var u=0,c=Object.entries(t);u<c.length;u++){var l=o(c[u],2),d=l[0],f=l[1].keys["curve25519:"+d];this.userByIdentityKey[f]=e}}},{key:"setRawStoredCrossSigningForUser",value:function(e,t){this.crossSigningInfo[e]=t}},{key:"doKeyDownload",value:function(e){var t=this;if(0===e.length)return Promise.resolve();var n=this.serialiser.updateDevicesForUsers(e,this.syncToken).then((function(){r(!0)}),(function(t){throw y.logger.error("Error downloading keys for "+e+":",t),r(!1),t}));e.forEach((function(e){t.keyDownloadsInProgressByUser[e]=n,t.deviceTrackingStatus[e]==p.PendingDownload&&(t.deviceTrackingStatus[e]=p.DownloadInProgress)}));var r=function(r){t.emit("crypto.willUpdateDevices",e,!t.hasFetched),e.forEach((function(e){(t.dirty=!0,t.keyDownloadsInProgressByUser[e]===n)?(delete t.keyDownloadsInProgressByUser[e],t.deviceTrackingStatus[e]==p.DownloadInProgress&&(r?(t.deviceTrackingStatus[e]=p.UpToDate,y.logger.log("Device list for",e,"now up to date")):t.deviceTrackingStatus[e]=p.PendingDownload)):y.logger.log("Another update in the queue for",e,"- not marking up-to-date")})),t.saveIfDirty(),t.emit("crypto.devicesUpdated",e,!t.hasFetched),t.hasFetched=!0};return n}}]),n}(g.EventEmitter);t.DeviceList=_;var x=function(){function e(t,n,r){u(this,e),this.baseApis=t,this.olmDevice=n,this.deviceList=r,(0,v.default)(this,"downloadInProgress",!1),(0,v.default)(this,"keyDownloadsQueuedByUser",{}),(0,v.default)(this,"queuedQueryDeferred",null),(0,v.default)(this,"syncToken",null)}return c(e,[{key:"updateDevicesForUsers",value:function(e,t){var n=this;return e.forEach((function(e){n.keyDownloadsQueuedByUser[e]=!0})),this.queuedQueryDeferred||(this.queuedQueryDeferred=(0,w.defer)()),this.syncToken=t,this.downloadInProgress?(y.logger.log("Queued key download for",e),this.queuedQueryDeferred.promise):this.doQueuedQueries()}},{key:"doQueuedQueries",value:function(){var e=this;if(this.downloadInProgress)throw new Error("DeviceListUpdateSerialiser.doQueuedQueries called with request active");var t=Object.keys(this.keyDownloadsQueuedByUser);this.keyDownloadsQueuedByUser={};var n=this.queuedQueryDeferred;this.queuedQueryDeferred=null,y.logger.log("Starting key download for",t),this.downloadInProgress=!0;var o={};this.syncToken&&(o.token=this.syncToken);for(var u=[],c=function(n){var r=t.slice(n,n+e.deviceList.keyDownloadChunkSize);u.push((function(){return e.baseApis.downloadKeysForUsers(r,o)}))},l=0;l<t.length;l+=this.deviceList.keyDownloadChunkSize)c(l);return(0,w.chunkPromises)(u,3).then(function(){var n=s(a.mark((function n(o){var s,u,c,l,d,f,h;return a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:s=Object.assign.apply(Object,[{}].concat(i(o.map((function(e){return e.device_keys||{}}))))),u=Object.assign.apply(Object,[{}].concat(i(o.map((function(e){return e.master_keys||{}}))))),c=Object.assign.apply(Object,[{}].concat(i(o.map((function(e){return e.self_signing_keys||{}}))))),l=Object.assign.apply(Object,[{}].concat(i(o.map((function(e){return e.user_signing_keys||{}}))))),d=r(t),n.prev=5,d.s();case 7:if((f=d.n()).done){n.next=21;break}return h=f.value,n.next=11,(0,w.sleep)(5);case 11:return n.prev=11,n.next=14,e.processQueryResponseForUser(h,s[h],{master:u[h],self_signing:c[h],user_signing:l[h]});case 14:n.next=19;break;case 16:n.prev=16,n.t0=n.catch(11),y.logger.error("Error processing keys for ".concat(h,":"),n.t0);case 19:n.next=7;break;case 21:n.next=26;break;case 23:n.prev=23,n.t1=n.catch(5),d.e(n.t1);case 26:return n.prev=26,d.f(),n.finish(26);case 29:case"end":return n.stop()}}),n,null,[[5,23,26,29],[11,16]])})));return function(e){return n.apply(this,arguments)}}()).then((function(){y.logger.log("Completed key download for "+t),e.downloadInProgress=!1,n.resolve(),e.queuedQueryDeferred&&e.doQueuedQueries()}),(function(r){y.logger.warn("Error downloading keys for "+t+":",r),e.downloadInProgress=!1,n.reject(r)})),n.promise}},{key:"processQueryResponseForUser",value:function(){var e=s(a.mark((function e(t,n,r){var i,o,s,u;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y.logger.log("got device keys for "+t+":",n),y.logger.log("got cross-signing keys for "+t+":",r),i={},(o=this.deviceList.getRawStoredDevicesForUser(t))&&Object.keys(o).forEach((function(e){var t=m.DeviceInfo.fromStorage(o[e],e);i[e]=t})),e.next=7,I(this.olmDevice,t,i,n||{},this.baseApis.getUserId(),this.baseApis.deviceId);case 7:s={},Object.keys(i).forEach((function(e){s[e]=i[e].toStorage()})),this.deviceList.setRawStoredDevicesForUser(t,s),r&&(r.master||r.self_signing||r.user_signing)&&((u=this.deviceList.getStoredCrossSigningForUser(t)||new k.CrossSigningInfo(t)).setKeys(r),this.deviceList.setRawStoredCrossSigningForUser(t,u.toStorage()),this.deviceList.emit("userCrossSigningUpdated",t));case 11:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),e}();function I(e,t,n,r,i,o){return T.apply(this,arguments)}function T(){return(T=s(a.mark((function e(t,n,r,i,o,s){var u,c,l,d;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u=!1,e.t0=a.keys(r);case 2:if((e.t1=e.t0()).done){e.next=15;break}if(c=e.t1.value,r.hasOwnProperty(c)){e.next=6;break}return e.abrupt("continue",2);case 6:if(c in i){e.next=13;break}if(n!==o||c!==s){e.next=10;break}return y.logger.warn("Local device ".concat(c," missing from sync, skipping removal")),e.abrupt("continue",2);case 10:y.logger.log("Device "+n+":"+c+" has been removed"),delete r[c],u=!0;case 13:e.next=2;break;case 15:e.t2=a.keys(i);case 16:if((e.t3=e.t2()).done){e.next=33;break}if(l=e.t3.value,i.hasOwnProperty(l)){e.next=20;break}return e.abrupt("continue",16);case 20:if((d=i[l]).user_id===n){e.next=24;break}return y.logger.warn("Mismatched user_id "+d.user_id+" in keys from "+n+":"+l),e.abrupt("continue",16);case 24:if(d.device_id===l){e.next=27;break}return y.logger.warn("Mismatched device_id "+d.device_id+" in keys from "+n+":"+l),e.abrupt("continue",16);case 27:return e.next=29,R(t,r,d);case 29:if(!e.sent){e.next=31;break}u=!0;case 31:e.next=16;break;case 33:return e.abrupt("return",u);case 34:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e,t,n){return O.apply(this,arguments)}function O(){return(O=s(a.mark((function e(t,n,r){var i,o,s,u,c,l,d;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.keys){e.next=2;break}return e.abrupt("return",!1);case 2:if(i=r.device_id,o=r.user_id,s="ed25519:"+i,u=r.keys[s]){e.next=9;break}return y.logger.warn("Device "+o+":"+i+" has no ed25519 key"),e.abrupt("return",!1);case 9:return c=r.unsigned||{},l=r.signatures||{},e.prev=11,e.next=14,b.verifySignature(t,r,o,i,u);case 14:e.next=20;break;case 16:return e.prev=16,e.t0=e.catch(11),y.logger.warn("Unable to verify signature on device "+o+":"+i+":"+e.t0),e.abrupt("return",!1);case 20:if(!(i in n)){e.next=27;break}if((d=n[i]).getFingerprint()==u){e.next=25;break}return y.logger.warn("Ed25519 key for device "+o+":"+i+" has changed"),e.abrupt("return",!1);case 25:e.next=28;break;case 27:n[i]=d=new m.DeviceInfo(i);case 28:return d.keys=r.keys||{},d.algorithms=r.algorithms||[],d.unsigned=c,d.signatures=l,e.abrupt("return",!0);case 33:case"end":return e.stop()}}),e,null,[[11,16]])})))).apply(this,arguments)}},function(e,t,n){"use strict";var r=n(11),i=n(9),o=n(10),a=n(8),s=n(13),u=n(6),c=n(7),l=n(0),d=n(2),f=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.EncryptionSetupOperation=t.EncryptionSetupBuilder=void 0;var h=f(n(3)),p=n(5),v=n(18),g=n(15),y=n(42),m=n(22),k=n(53),b=function(){function e(t,n){l(this,e),(0,h.default)(this,"accountDataClientAdapter",void 0),(0,h.default)(this,"crossSigningCallbacks",void 0),(0,h.default)(this,"ssssCryptoCallbacks",void 0),(0,h.default)(this,"crossSigningKeys",null),(0,h.default)(this,"keySignatures",null),(0,h.default)(this,"keyBackupInfo",null),(0,h.default)(this,"sessionBackupPrivateKey",void 0),this.accountDataClientAdapter=new w(t),this.crossSigningCallbacks=new E,this.ssssCryptoCallbacks=new _(n)}return d(e,[{key:"addCrossSigningKeys",value:function(e,t){this.crossSigningKeys={authUpload:e,keys:t}}},{key:"addSessionBackup",value:function(e){this.keyBackupInfo=e}},{key:"addSessionBackupPrivateKeyToCache",value:function(e){this.sessionBackupPrivateKey=e}},{key:"addKeySignature",value:function(e,t,n){this.keySignatures||(this.keySignatures={});var r=this.keySignatures[e]||{};this.keySignatures[e]=r,r[t]=n}},{key:"setAccountData",value:function(){var e=c(u.mark((function e(t,n){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountDataClientAdapter.setAccountData(t,n);case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"buildOperation",value:function(){var e=this.accountDataClientAdapter.values;return new S(e,this.crossSigningKeys,this.keyBackupInfo,this.keySignatures)}},{key:"persist",value:function(){var e=c(u.mark((function e(t){var n,r,i,o,a,s=this;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.crossSigningKeys){e.next=14;break}n=(0,y.createCryptoStoreCacheCallbacks)(t.cryptoStore,t.olmDevice),r=0,i=["master","self_signing","user_signing"];case 3:if(!(r<i.length)){e.next=12;break}return o=i[r],p.logger.log("Cache ".concat(o," cross-signing private key locally")),a=this.crossSigningCallbacks.privateKeys.get(o),e.next=9,n.storeCrossSigningKeyCache(o,a);case 9:r++,e.next=3;break;case 12:return e.next=14,t.cryptoStore.doTxn("readwrite",[m.IndexedDBCryptoStore.STORE_ACCOUNT],(function(e){t.cryptoStore.storeCrossSigningKeys(e,s.crossSigningKeys.keys)}));case 14:if(!this.sessionBackupPrivateKey){e.next=17;break}return e.next=17,t.storeSessionBackupPrivateKey(this.sessionBackupPrivateKey);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();t.EncryptionSetupBuilder=b;var S=function(){function e(t,n,r,i){l(this,e),this.accountData=t,this.crossSigningKeys=n,this.keyBackupInfo=r,this.keySignatures=i}return d(e,[{key:"apply",value:function(){var e=c(u.mark((function e(t){var n,r,i,o,c,l,d,f,h,p,v,g;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.baseApis,!this.crossSigningKeys){e.next=7;break}for(r={},i=0,o=Object.entries(this.crossSigningKeys.keys);i<o.length;i++)c=s(o[i],2),l=c[0],d=c[1],r[l+"_key"]=d;return e.next=6,this.crossSigningKeys.authUpload((function(e){return n.uploadDeviceSigningKeys(e,r)}));case 6:t.crossSigningInfo.setKeys(this.crossSigningKeys.keys);case 7:if(!this.accountData){e.next=25;break}f=a(this.accountData),e.prev=9,f.s();case 11:if((h=f.n()).done){e.next=17;break}return p=s(h.value,2),v=p[0],g=p[1],e.next=15,n.setAccountData(v,g);case 15:e.next=11;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(9),f.e(e.t0);case 22:return e.prev=22,f.f(),e.finish(22);case 25:if(!this.keySignatures){e.next=28;break}return e.next=28,n.uploadKeySignatures(this.keySignatures);case 28:if(!this.keyBackupInfo){e.next=36;break}if(!this.keyBackupInfo.version){e.next=34;break}return e.next=32,n.http.authedRequest(void 0,"PUT","/room_keys/version/"+this.keyBackupInfo.version,void 0,{algorithm:this.keyBackupInfo.algorithm,auth_data:this.keyBackupInfo.auth_data},{prefix:k.PREFIX_UNSTABLE});case 32:e.next=36;break;case 34:return e.next=36,n.http.authedRequest(void 0,"POST","/room_keys/version",void 0,this.keyBackupInfo,{prefix:k.PREFIX_UNSTABLE});case 36:case"end":return e.stop()}}),e,this,[[9,19,22,25]])})));return function(t){return e.apply(this,arguments)}}()}]),e}();t.EncryptionSetupOperation=S;var w=function(e){i(n,e);var t=o(n);function n(e){var i;return l(this,n),(i=t.call(this)).existingValues=e,(0,h.default)(r(i),"values",new Map),i}return d(n,[{key:"getAccountDataFromServer",value:function(e){return Promise.resolve(this.getAccountData(e))}},{key:"getAccountData",value:function(e){var t=this.values.get(e);if(t)return t;var n=this.existingValues[e];return n?n.getContent():null}},{key:"setAccountData",value:function(e,t){var n=this,r=this.values.get(e);return this.values.set(e,t),Promise.resolve().then((function(){var i=new v.MatrixEvent({type:e,content:t});return n.emit("accountData",i,r),{}}))}}]),n}(g.EventEmitter),E=function(){function e(){l(this,e),(0,h.default)(this,"privateKeys",new Map)}return d(e,[{key:"getCrossSigningKeyCache",value:function(e,t){return this.getCrossSigningKey(e,t)}},{key:"storeCrossSigningKeyCache",value:function(e,t){return this.privateKeys.set(e,t),Promise.resolve()}},{key:"getCrossSigningKey",value:function(e,t){return Promise.resolve(this.privateKeys.get(e))}},{key:"saveCrossSigningKeys",value:function(e){for(var t=0,n=Object.entries(e);t<n.length;t++){var r=s(n[t],2),i=r[0],o=r[1];this.privateKeys.set(i,o)}}}]),e}(),_=function(){function e(t){l(this,e),this.delegateCryptoCallbacks=t,(0,h.default)(this,"privateKeys",new Map)}return d(e,[{key:"getSecretStorageKey",value:function(){var e=c(u.mark((function e(t,n){var r,i,o,a,c,l,d,f,h,p;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.keys,o=0,a=Object.keys(r);case 2:if(!(o<a.length)){e.next=10;break}if(c=a[o],!(l=this.privateKeys.get(c))){e.next=7;break}return e.abrupt("return",[c,l]);case 7:o++,e.next=2;break;case 10:if(null===this||void 0===this||null===(i=this.delegateCryptoCallbacks)||void 0===i||!i.getSecretStorageKey){e.next=16;break}return e.next=13,this.delegateCryptoCallbacks.getSecretStorageKey({keys:r},n);case 13:return(d=e.sent)&&(f=s(d,2),h=f[0],p=f[1],this.privateKeys.set(h,p)),e.abrupt("return",d);case 16:return e.abrupt("return",null);case 17:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"addPrivateKey",value:function(e,t,n){var r,i;this.privateKeys.set(e,n),null===(r=this.delegateCryptoCallbacks)||void 0===r||null===(i=r.cacheSecretStorageKey)||void 0===i||i.call(r,e,t,n)}}]),e}()},function(e,t,n){"use strict";var r=n(13),i=n(16),o=n(8),a=n(6),s=n(7),u=n(0),c=n(2),l=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.SecretStorage=t.SECRET_STORAGE_ALGORITHM_V1_AES=void 0;var d=l(n(3)),f=n(5),h=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=g(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}r.default=e,n&&n.set(e,r);return r}(n(19)),p=n(32),v=n(33);function g(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(g=function(e){return e?n:t})(e)}var y="m.secret_storage.v1.aes-hmac-sha2";t.SECRET_STORAGE_ALGORITHM_V1_AES=y;var m=function(){function e(t,n,r){u(this,e),this.accountDataAdapter=t,this.cryptoCallbacks=n,this.baseApis=r,(0,d.default)(this,"requests",new Map)}return c(e,[{key:"getDefaultKeyId",value:function(){var e=s(a.mark((function e(){var t;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.default_key");case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",null);case 5:return e.abrupt("return",t.key);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setDefaultKeyId",value:function(e){var t=this;return new Promise((function(n,r){var i=function r(i){"m.secret_storage.default_key"===i.getType()&&i.getContent().key===e&&(t.accountDataAdapter.removeListener("accountData",r),n())};t.accountDataAdapter.on("accountData",i),t.accountDataAdapter.setAccountData("m.secret_storage.default_key",{key:e}).catch((function(e){t.accountDataAdapter.removeListener("accountData",i),r(e)}))}))}},{key:"addKey",value:function(){var e=s(a.mark((function e(t,n,r){var i,o,s,u;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i={algorithm:t},n||(n={}),n.name&&(i.name=n.name),t!==y){e.next=15;break}if(n.passphrase&&(i.passphrase=n.passphrase),!n.key){e.next=13;break}return e.next=8,(0,v.calculateKeyCheck)(n.key);case 8:o=e.sent,s=o.iv,u=o.mac,i.iv=s,i.mac=u;case 13:e.next=16;break;case 15:throw new Error("Unknown key algorithm ".concat(t));case 16:if(r){e.next=21;break}case 17:r=(0,p.randomString)(32);case 18:return e.next=20,this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(r));case 20:if(e.sent){e.next=17;break}case 21:return e.next=23,this.accountDataAdapter.setAccountData("m.secret_storage.key.".concat(r),i);case 23:return e.abrupt("return",{keyId:r,keyInfo:i});case 24:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getKey",value:function(){var e=s(a.mark((function e(t){var n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=4;break}return e.next=3,this.getDefaultKeyId();case 3:t=e.sent;case 4:if(t){e.next=6;break}return e.abrupt("return",null);case 6:return e.next=8,this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+t);case 8:return n=e.sent,e.abrupt("return",n?[t,n]:null);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hasKey",value:function(){var e=s(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Boolean,e.next=3,this.getKey(t);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkKey",value:function(){var e=s(a.mark((function e(t,n){var r,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.algorithm!==y){e.next=12;break}if(!n.mac){e.next=9;break}return e.next=4,(0,v.calculateKeyCheck)(t,n.iv);case 4:return r=e.sent,i=r.mac,e.abrupt("return",n.mac.replace(/=+$/g,"")===i.replace(/=+$/g,""));case 9:return e.abrupt("return",!0);case 10:e.next=13;break;case 12:throw new Error("Unknown algorithm");case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"store",value:function(){var e=s(a.mark((function e(t,n,s){var u,c,l,d,h,p,v,g,m,k;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u={},s){e.next=8;break}return e.next=4,this.getDefaultKeyId();case 4:if(c=e.sent){e.next=7;break}throw new Error("No keys specified and no default key present");case 7:s=[c];case 8:if(0!==s.length){e.next=10;break}throw new Error("Zero keys given to encrypt with!");case 10:l=o(s),e.prev=11,l.s();case 13:if((d=l.n()).done){e.next=35;break}return h=d.value,e.next=17,this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+h);case 17:if(p=e.sent){e.next=20;break}throw new Error("Unknown key: "+h);case 20:if(p.algorithm!==y){e.next=32;break}return v=i({},h,p),e.next=24,this.getSecretStorageKey(v,t);case 24:return g=e.sent,m=r(g,2),k=m[1],e.next=29,k.encrypt(n);case 29:u[h]=e.sent,e.next=33;break;case 32:f.logger.warn("unknown algorithm for secret storage key "+h+": "+p.algorithm);case 33:e.next=13;break;case 35:e.next=40;break;case 37:e.prev=37,e.t0=e.catch(11),l.e(e.t0);case 40:return e.prev=40,l.f(),e.finish(40);case 43:return e.next=45,this.accountDataAdapter.setAccountData(t,{encrypted:u});case 45:case"end":return e.stop()}}),e,this,[[11,37,40,43]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=s(a.mark((function e(t){var n,i,o,s,u,c,l,d,f,p,v,g;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountDataAdapter.getAccountDataFromServer(t);case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return");case 5:if(n.encrypted){e.next=7;break}throw new Error("Content is not encrypted!");case 7:i={},o=0,s=Object.keys(n.encrypted);case 9:if(!(o<s.length)){e.next=19;break}return u=s[o],e.next=13,this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+u);case 13:c=e.sent,l=n.encrypted[u],c.algorithm===y&&l.iv&&l.ciphertext&&l.mac&&(i[u]=c);case 16:o++,e.next=9;break;case 19:if(0!==Object.keys(i).length){e.next=21;break}throw new Error("Could not decrypt ".concat(t," because none of ")+"the keys it is encrypted with are for a supported algorithm");case 21:return e.prev=21,e.next=24,this.getSecretStorageKey(i,t);case 24:if(p=e.sent,v=r(p,2),d=v[0],f=v[1],!(g=n.encrypted[d]).passthrough){e.next=31;break}return e.abrupt("return",(0,h.encodeBase64)(f.get_private_key()));case 31:return e.next=33,f.decrypt(g);case 33:return e.abrupt("return",e.sent);case 34:return e.prev=34,f&&f.free&&f.free(),e.finish(34);case 37:case"end":return e.stop()}}),e,this,[[21,,34,37]])})));return function(t){return e.apply(this,arguments)}}()},{key:"isStored",value:function(){var e=s(a.mark((function e(t,n){var r,i,o,s,u,c,l;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountDataAdapter.getAccountDataFromServer(t);case 2:if(r=e.sent){e.next=5;break}return e.abrupt("return",null);case 5:if(r.encrypted){e.next=7;break}return e.abrupt("return",null);case 7:void 0===n&&(n=!0),i={},o=0,s=Object.keys(r.encrypted);case 10:if(!(o<s.length)){e.next=22;break}return u=s[o],e.next=14,this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+u);case 14:if(c=e.sent){e.next=17;break}return e.abrupt("continue",19);case 17:l=r.encrypted[u],c.algorithm===y&&l.iv&&l.ciphertext&&l.mac&&(i[u]=c);case 19:o++,e.next=10;break;case 22:return e.abrupt("return",Object.keys(i).length?i:null);case 23:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"request",value:function(e,t){var n,r,a=this,s=this.baseApis.makeTxnId(),u=new Promise((function(e,t){n=e,r=t}));this.requests.set(s,{name:e,devices:t,resolve:n,reject:r});var c,l={name:e,action:"request",requesting_device_id:this.baseApis.deviceId,request_id:s},d={},h=o(t);try{for(h.s();!(c=h.n()).done;){d[c.value]=l}}catch(p){h.e(p)}finally{h.f()}return f.logger.info("Request secret ".concat(e," from ").concat(t,", id ").concat(s)),this.baseApis.sendToDevice("m.secret.request",i({},this.baseApis.getUserId(),d)),{requestId:s,promise:u,cancel:function(e){var n,u={action:"request_cancellation",requesting_device_id:a.baseApis.deviceId,request_id:s},c={},l=o(t);try{for(l.s();!(n=l.n()).done;){c[n.value]=u}}catch(p){l.e(p)}finally{l.f()}a.baseApis.sendToDevice("m.secret.request",i({},a.baseApis.getUserId(),c)),r(new Error(e||"Cancelled"))}}}},{key:"onRequestReceived",value:function(){var e=s(a.mark((function e(t){var n,r,o,s,u,c,l;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.getSender(),r=t.getContent(),n===this.baseApis.getUserId()&&(r.name&&r.action&&r.requesting_device_id&&r.request_id)){e.next=4;break}return e.abrupt("return");case 4:if(o=r.requesting_device_id,"request_cancellation"!==r.action){e.next=8;break}e.next=31;break;case 8:if("request"!==r.action){e.next=31;break}if(o!==this.baseApis.deviceId){e.next=11;break}return e.abrupt("return");case 11:if(f.logger.info("received request for secret ("+n+", "+o+", "+r.request_id+")"),this.cryptoCallbacks.onSecretRequested){e.next=14;break}return e.abrupt("return");case 14:return e.next=16,this.cryptoCallbacks.onSecretRequested(n,o,r.request_id,r.name,this.baseApis.checkDeviceTrust(n,o));case 16:if(!(s=e.sent)){e.next=30;break}return f.logger.info("Preparing ".concat(r.name," secret for ").concat(o)),u={type:"m.secret.send",content:{request_id:r.request_id,secret:s}},c={algorithm:h.OLM_ALGORITHM,sender_key:this.baseApis.crypto.olmDevice.deviceCurve25519Key,ciphertext:{}},e.next=23,h.ensureOlmSessionsForDevices(this.baseApis.crypto.olmDevice,this.baseApis,i({},n,[this.baseApis.getStoredDevice(n,o)]));case 23:return e.next=25,h.encryptMessageForDevice(c.ciphertext,this.baseApis.getUserId(),this.baseApis.deviceId,this.baseApis.crypto.olmDevice,n,this.baseApis.getStoredDevice(n,o),u);case 25:l=i({},n,i({},o,c)),f.logger.info("Sending ".concat(r.name," secret for ").concat(o)),this.baseApis.sendToDevice("m.room.encrypted",l),e.next=31;break;case 30:f.logger.info("Request denied for ".concat(r.name," secret for ").concat(o));case 31:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onSecretReceived",value:function(e){if(e.getSender()===this.baseApis.getUserId()){var t=e.getContent();f.logger.log("got secret share for request",t.request_id);var n=this.requests.get(t.request_id);if(n){var r=this.baseApis.crypto.deviceList.getDeviceByIdentityKey(h.OLM_ALGORITHM,e.getSenderKey());if(!r)return void f.logger.log("secret share from unknown device with key",e.getSenderKey());if(!n.devices.includes(r.deviceId))return void f.logger.log("unsolicited secret share from device",r.deviceId);f.logger.log("Successfully received secret ".concat(n.name," ")+"from ".concat(r.deviceId)),n.resolve(t.secret)}}}},{key:"getSecretStorageKey",value:function(){var e=s(a.mark((function e(t,n){var i,o,u,c,l;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cryptoCallbacks.getSecretStorageKey){e.next=2;break}throw new Error("No getSecretStorageKey callback supplied");case 2:return e.next=4,this.cryptoCallbacks.getSecretStorageKey({keys:t},n);case 4:if(i=e.sent){e.next=7;break}throw new Error("getSecretStorageKey callback returned falsey");case 7:if(!(i.length<2)){e.next=9;break}throw new Error("getSecretStorageKey callback returned invalid data");case 9:if(o=r(i,2),u=o[0],c=o[1],t[u]){e.next=12;break}throw new Error("App returned unknown key from getSecretStorageKey!");case 12:if(t[u].algorithm!==y){e.next=17;break}return l={encrypt:function(){var e=s(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,v.encryptAES)(t,c,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),decrypt:function(){var e=s(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,v.decryptAES)(t,c,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},e.abrupt("return",[u,l]);case 17:throw new Error("Unknown key type: "+t[u].algorithm);case 18:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}();t.SecretStorage=m},function(e,t,n){"use strict";var r=n(8),i=n(6),o=n(7),a=n(0),s=n(2),u=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.OutgoingRoomKeyRequestManager=t.RoomKeyRequestState=void 0;var c,l=u(n(3)),d=n(5),f=n(17);t.RoomKeyRequestState=c,function(e){e[e.Unsent=0]="Unsent",e[e.Sent=1]="Sent",e[e.CancellationPending=2]="CancellationPending",e[e.CancellationPendingAndWillResend=3]="CancellationPendingAndWillResend"}(c||(t.RoomKeyRequestState=c={}));var h=function(){function e(t,n,r){a(this,e),this.baseApis=t,this.deviceId=n,this.cryptoStore=r,(0,l.default)(this,"sendOutgoingRoomKeyRequestsTimer",null),(0,l.default)(this,"sendOutgoingRoomKeyRequestsRunning",!1),(0,l.default)(this,"clientRunning",!1)}return s(e,[{key:"start",value:function(){this.clientRunning=!0}},{key:"stop",value:function(){d.logger.log("stopping OutgoingRoomKeyRequestManager"),this.clientRunning=!1}},{key:"sendQueuedRequests",value:function(){this.startTimer()}},{key:"queueRoomKeyRequest",value:function(){var e=o(i.mark((function e(t,n){var r,o,a,s,u,l=arguments;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.length>2&&void 0!==l[2]&&l[2],e.next=3,this.cryptoStore.getOutgoingRoomKeyRequest(t);case 3:if(o=e.sent){e.next=9;break}return e.next=7,this.cryptoStore.getOrAddOutgoingRoomKeyRequest({requestBody:t,recipients:n,requestId:this.baseApis.makeTxnId(),state:c.Unsent});case 7:e.next=36;break;case 9:e.t0=o.state,e.next=e.t0===c.CancellationPendingAndWillResend||e.t0===c.Unsent?12:e.t0===c.CancellationPending?13:e.t0===c.Sent?17:35;break;case 12:return e.abrupt("return");case 13:return a=r?c.CancellationPendingAndWillResend:c.Sent,e.next=16,this.cryptoStore.updateOutgoingRoomKeyRequest(o.requestId,c.CancellationPending,{state:a,cancellationTxnId:this.baseApis.makeTxnId()});case 16:return e.abrupt("break",36);case 17:if(!r){e.next=34;break}return s=c.CancellationPendingAndWillResend,e.next=21,this.cryptoStore.updateOutgoingRoomKeyRequest(o.requestId,c.Sent,{state:s,cancellationTxnId:this.baseApis.makeTxnId(),requestTxnId:this.baseApis.makeTxnId()});case 21:if(u=e.sent){e.next=26;break}return e.next=25,this.queueRoomKeyRequest(t,n,r);case 25:return e.abrupt("return",e.sent);case 26:return e.prev=26,e.next=29,this.sendOutgoingRoomKeyRequestCancellation(u,!0);case 29:e.next=34;break;case 31:e.prev=31,e.t1=e.catch(26),d.logger.error("Error sending room key request cancellation; will retry later.",e.t1);case 34:return e.abrupt("break",36);case 35:throw new Error("unhandled state: "+o.state);case 36:case"end":return e.stop()}}),e,this,[[26,31]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"cancelRoomKeyRequest",value:function(e){var t=this;return this.cryptoStore.getOutgoingRoomKeyRequest(e).then((function(n){if(n)switch(n.state){case c.CancellationPending:case c.CancellationPendingAndWillResend:return;case c.Unsent:return d.logger.log("deleting unnecessary room key request for "+p(e)),t.cryptoStore.deleteOutgoingRoomKeyRequest(n.requestId,c.Unsent);case c.Sent:return t.cryptoStore.updateOutgoingRoomKeyRequest(n.requestId,c.Sent,{state:c.CancellationPending,cancellationTxnId:t.baseApis.makeTxnId()}).then((function(n){n?t.sendOutgoingRoomKeyRequestCancellation(n).catch((function(e){d.logger.error("Error sending room key request cancellation; will retry later.",e),t.startTimer()})):d.logger.log("Tried to cancel room key request for "+p(e)+" but it was already cancelled in another tab")}));default:throw new Error("unhandled state: "+n.state)}}))}},{key:"getOutgoingSentRoomKeyRequest",value:function(e,t){return this.cryptoStore.getOutgoingRoomKeyRequestsByTarget(e,t,[c.Sent])}},{key:"cancelAndResendAllOutgoingRequests",value:function(){var e=o(i.mark((function e(){var t,n=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cryptoStore.getAllOutgoingRoomKeyRequestsByState(c.Sent);case 2:return t=e.sent,e.abrupt("return",Promise.all(t.map((function(e){var t=e.requestBody,r=e.recipients;return n.queueRoomKeyRequest(t,r,!0)}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"startTimer",value:function(){var e=this;if(!this.sendOutgoingRoomKeyRequestsTimer){this.sendOutgoingRoomKeyRequestsTimer=setTimeout((function(){if(e.sendOutgoingRoomKeyRequestsRunning)throw new Error("RoomKeyRequestSend already in progress!");e.sendOutgoingRoomKeyRequestsRunning=!0,e.sendOutgoingRoomKeyRequests().finally((function(){e.sendOutgoingRoomKeyRequestsRunning=!1})).catch((function(e){d.logger.warn("error in OutgoingRoomKeyRequestManager: ".concat(e))}))}),500)}}},{key:"sendOutgoingRoomKeyRequests",value:function(){var e=this;return this.clientRunning?this.cryptoStore.getOutgoingRoomKeyRequestByState([c.CancellationPending,c.CancellationPendingAndWillResend,c.Unsent]).then((function(t){if(t){var n;switch(t.state){case c.Unsent:n=e.sendOutgoingRoomKeyRequest(t);break;case c.CancellationPending:n=e.sendOutgoingRoomKeyRequestCancellation(t);break;case c.CancellationPendingAndWillResend:n=e.sendOutgoingRoomKeyRequestCancellation(t,!0)}return n.then((function(){return e.sendOutgoingRoomKeyRequests()})).catch((function(t){d.logger.error("Error sending room key request; will retry later.",t),e.sendOutgoingRoomKeyRequestsTimer=null}))}e.sendOutgoingRoomKeyRequestsTimer=null})):(this.sendOutgoingRoomKeyRequestsTimer=null,Promise.resolve())}},{key:"sendOutgoingRoomKeyRequest",value:function(e){var t=this;d.logger.log("Requesting keys for ".concat(p(e.requestBody))+" from ".concat(v(e.recipients))+"(id ".concat(e.requestId,")"));var n={action:"request",requesting_device_id:this.deviceId,request_id:e.requestId,body:e.requestBody};return this.sendMessageToDevices(n,e.recipients,e.requestTxnId||e.requestId).then((function(){return t.cryptoStore.updateOutgoingRoomKeyRequest(e.requestId,c.Unsent,{state:c.Sent})}))}},{key:"sendOutgoingRoomKeyRequestCancellation",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];d.logger.log("Sending cancellation for key request for "+"".concat(p(e.requestBody)," to ")+"".concat(v(e.recipients)," ")+"(cancellation id ".concat(e.cancellationTxnId,")"));var r={action:"request_cancellation",requesting_device_id:this.deviceId,request_id:e.requestId};return this.sendMessageToDevices(r,e.recipients,e.cancellationTxnId).then((function(){return n?t.cryptoStore.updateOutgoingRoomKeyRequest(e.requestId,c.CancellationPendingAndWillResend,{state:c.Unsent}):t.cryptoStore.deleteOutgoingRoomKeyRequest(e.requestId,c.CancellationPending)}))}},{key:"sendMessageToDevices",value:function(e,t,n){var i,o={},a=r(t);try{for(a.s();!(i=a.n()).done;){var s=i.value;o[s.userId]||(o[s.userId]={}),o[s.userId][s.deviceId]=e}}catch(u){a.e(u)}finally{a.f()}return this.baseApis.sendToDevice(f.EventType.RoomKeyRequest,o,n)}}]),e}();function p(e){return e.room_id+" / "+e.session_id}function v(e){return"["+e.map((function(e){return"".concat(e.userId,":").concat(e.deviceId)})).join(",")+"]"}t.OutgoingRoomKeyRequestManager=h},function(e,t,n){"use strict";(function(e){var r=n(13),i=n(6),o=n(7),a=n(0),s=n(2),u=n(11),c=n(9),l=n(10),d=n(8),f=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.SAS=void 0;var h,p=f(n(3)),v=n(55),g=f(n(40)),y=n(34),m=n(5),k="m.key.verification.start",b=["m.key.verification.accept","m.key.verification.key","m.key.verification.mac"],S=(0,y.errorFactory)("m.mismatched_sas","Mismatched short authentication string"),w=(0,y.errorFactory)("m.mismatched_commitment","Mismatched commitment");var E=[["\ud83d\udc36","dog"],["\ud83d\udc31","cat"],["\ud83e\udd81","lion"],["\ud83d\udc0e","horse"],["\ud83e\udd84","unicorn"],["\ud83d\udc37","pig"],["\ud83d\udc18","elephant"],["\ud83d\udc30","rabbit"],["\ud83d\udc3c","panda"],["\ud83d\udc13","rooster"],["\ud83d\udc27","penguin"],["\ud83d\udc22","turtle"],["\ud83d\udc1f","fish"],["\ud83d\udc19","octopus"],["\ud83e\udd8b","butterfly"],["\ud83c\udf37","flower"],["\ud83c\udf33","tree"],["\ud83c\udf35","cactus"],["\ud83c\udf44","mushroom"],["\ud83c\udf0f","globe"],["\ud83c\udf19","moon"],["\u2601\ufe0f","cloud"],["\ud83d\udd25","fire"],["\ud83c\udf4c","banana"],["\ud83c\udf4e","apple"],["\ud83c\udf53","strawberry"],["\ud83c\udf3d","corn"],["\ud83c\udf55","pizza"],["\ud83c\udf82","cake"],["\u2764\ufe0f","heart"],["\ud83d\ude42","smiley"],["\ud83e\udd16","robot"],["\ud83c\udfa9","hat"],["\ud83d\udc53","glasses"],["\ud83d\udd27","spanner"],["\ud83c\udf85","santa"],["\ud83d\udc4d","thumbs up"],["\u2602\ufe0f","umbrella"],["\u231b","hourglass"],["\u23f0","clock"],["\ud83c\udf81","gift"],["\ud83d\udca1","light bulb"],["\ud83d\udcd5","book"],["\u270f\ufe0f","pencil"],["\ud83d\udcce","paperclip"],["\u2702\ufe0f","scissors"],["\ud83d\udd12","lock"],["\ud83d\udd11","key"],["\ud83d\udd28","hammer"],["\u260e\ufe0f","telephone"],["\ud83c\udfc1","flag"],["\ud83d\ude82","train"],["\ud83d\udeb2","bicycle"],["\u2708\ufe0f","aeroplane"],["\ud83d\ude80","rocket"],["\ud83c\udfc6","trophy"],["\u26bd","ball"],["\ud83c\udfb8","guitar"],["\ud83c\udfba","trumpet"],["\ud83d\udd14","bell"],["\u2693\ufe0f","anchor"],["\ud83c\udfa7","headphones"],["\ud83d\udcc1","folder"],["\ud83d\udccc","pin"]];var _={decimal:function(e){return[1e3+(e[0]<<5|e[1]>>3),1e3+((7&e[1])<<10|e[2]<<2|e[3]>>6),1e3+((63&e[3])<<7|e[4]>>1)]},emoji:function(e){return[e[0]>>2,(3&e[0])<<4|e[1]>>4,(15&e[1])<<2|e[2]>>6,63&e[2],e[3]>>2,(3&e[3])<<4|e[4]>>4,(15&e[4])<<2|e[5]>>6].map((function(e){return E[e]}))}};function x(e,t){var n,r={},i=d(t);try{for(i.s();!(n=i.n()).done;){var o=n.value;o in _&&(r[o]=_[o](e))}}catch(a){i.e(a)}finally{i.f()}return r}var I={"hkdf-hmac-sha256":"calculate_mac","hmac-sha256":"calculate_mac_long_kdf"};function T(e,t){return function(){for(var n=e[I[t]],r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];var a=n.apply(e,i);return m.logger.log("SAS calculateMAC:",t,i,a),a}}var R={"curve25519-hkdf-sha256":function(e,t,n){var r="".concat(e.baseApis.getUserId(),"|").concat(e.baseApis.deviceId,"|")+"".concat(e.ourSASPubKey,"|"),i="".concat(e.userId,"|").concat(e.deviceId,"|").concat(e.theirSASPubKey,"|"),o="MATRIX_KEY_VERIFICATION_SAS|"+(e.initiatedByMe?r+i:i+r)+e.channel.transactionId;return t.generate_bytes(o,n)},curve25519:function(e,t,n){var r="".concat(e.baseApis.getUserId()).concat(e.baseApis.deviceId),i="".concat(e.userId).concat(e.deviceId),o="MATRIX_KEY_VERIFICATION_SAS"+(e.initiatedByMe?r+i:i+r)+e.channel.transactionId;return t.generate_bytes(o,n)}},O=["curve25519-hkdf-sha256","curve25519"],C=["sha256"],P=["hkdf-hmac-sha256","hmac-sha256"],D=Object.keys(_),A=new Set(O),M=new Set(C),U=new Set(P),N=new Set(D);function L(e,t){return e instanceof Array?e.filter((function(e){return t.has(e)})):[]}var j=function(t){c(d,t);var n=l(d);function d(){var t;a(this,d);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return t=n.call.apply(n,[this].concat(s)),(0,p.default)(u(t),"waitingForAccept",void 0),(0,p.default)(u(t),"ourSASPubKey",void 0),(0,p.default)(u(t),"theirSASPubKey",void 0),(0,p.default)(u(t),"sasEvent",void 0),(0,p.default)(u(t),"doVerification",o(i.mark((function n(){var r;return i.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.Olm.init();case 2:return h=h||new e.Olm.Utility,n.next=5,t.baseApis.downloadKeys([t.userId]);case 5:r=!1;case 6:if(n.prev=6,!t.initiatedByMe){n.next=13;break}return n.next=10,t.doSendVerification();case 10:return n.abrupt("return",n.sent);case 13:return n.next=15,t.doRespondVerification();case 15:return n.abrupt("return",n.sent);case 16:n.next=26;break;case 18:if(n.prev=18,n.t0=n.catch(6),!(n.t0 instanceof v.SwitchStartEventError)){n.next=25;break}t.startEvent=n.t0.startEvent,r=!0,n.next=26;break;case 25:throw n.t0;case 26:if(r){n.next=6;break}case 27:case"end":return n.stop()}}),n,null,[[6,18]])})))),t}return s(d,[{key:"events",get:function(){return b}},{key:"canSwitchStartEvent",value:function(e){if(e.getType()!==k)return!1;var t=e.getContent();return t&&t.method===d.NAME&&this.waitingForAccept}},{key:"sendStart",value:function(){var e=o(i.mark((function e(){var t;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.channel.completeContent(k,{method:d.NAME,from_device:this.baseApis.deviceId,key_agreement_protocols:O,hashes:C,message_authentication_codes:P,short_authentication_string:D}),e.next=3,this.channel.sendCompleted(k,t);case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"doSendVerification",value:function(){var t=o(i.mark((function t(){var n,a,s,u,c,l,d,f,p,m,k,b,E,_=this;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.waitingForAccept=!0,!this.startEvent){t.next=5;break}n=this.channel.completedContentFromEvent(this.startEvent),t.next=8;break;case 5:return t.next=7,this.sendStart();case 7:n=t.sent;case 8:if(this.initiatedByMe){t.next=10;break}throw new v.SwitchStartEventError(this.startEvent);case 10:return t.prev=10,t.next=13,this.waitForEvent("m.key.verification.accept");case 13:a=t.sent;case 14:return t.prev=14,this.waitingForAccept=!1,t.finish(14);case 17:if(s=a.getContent(),u=L(s.short_authentication_string,N),A.has(s.key_agreement_protocol)&&M.has(s.hash)&&U.has(s.message_authentication_code)&&u.length){t.next=21;break}throw(0,y.newUnknownMethodError)();case 21:if("string"===typeof s.commitment){t.next=23;break}throw(0,y.newInvalidMessageError)();case 23:return c=s.key_agreement_protocol,l=s.message_authentication_code,d=s.commitment,f=new e.Olm.SAS,t.prev=27,this.ourSASPubKey=f.get_pubkey(),t.next=31,this.send("m.key.verification.key",{key:this.ourSASPubKey});case 31:return t.next=33,this.waitForEvent("m.key.verification.key");case 33:if(a=t.sent,s=a.getContent(),p=s.key+g.default.stringify(n),h.sha256(p)===d){t.next=38;break}throw w();case 38:return this.theirSASPubKey=s.key,f.set_their_key(s.key),m=R[c](this,f,6),k=new Promise((function(e,t){_.sasEvent={sas:x(m,u),confirm:function(){var n=o(i.mark((function n(){return i.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,_.sendMAC(f,l);case 3:e(),n.next=9;break;case 6:n.prev=6,n.t0=n.catch(0),t(n.t0);case 9:case"end":return n.stop()}}),n,null,[[0,6]])})));return function(){return n.apply(this,arguments)}}(),cancel:function(){return t((0,y.newUserCancelledError)())},mismatch:function(){return t(S())}},_.emit("show_sas",_.sasEvent)})),t.next=44,Promise.all([this.waitForEvent("m.key.verification.mac").then((function(e){return _.expectedEvent="m.key.verification.done",e})),k]);case 44:return b=t.sent,E=r(b,1),a=E[0],s=a.getContent(),t.next=50,this.checkMAC(f,s,l);case 50:return t.prev=50,f.free(),t.finish(50);case 53:case"end":return t.stop()}}),t,this,[[10,,14,17],[27,,50,53]])})));return function(){return t.apply(this,arguments)}}()},{key:"doRespondVerification",value:function(){var t=o(i.mark((function t(){var n,a,s,u,c,l,d,f,p,v,m,k,b=this;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.channel.completedContentFromEvent(this.startEvent),a=L(O,new Set(n.key_agreement_protocols))[0],s=L(C,new Set(n.hashes))[0],u=L(P,new Set(n.message_authentication_codes))[0],c=L(n.short_authentication_string,N),void 0!==a&&void 0!==s&&void 0!==u&&c.length){t.next=7;break}throw(0,y.newUnknownMethodError)();case 7:return l=new e.Olm.SAS,t.prev=8,d=l.get_pubkey()+g.default.stringify(n),t.next=12,this.send("m.key.verification.accept",{key_agreement_protocol:a,hash:s,message_authentication_code:u,short_authentication_string:c,commitment:h.sha256(d)});case 12:return t.next=14,this.waitForEvent("m.key.verification.key");case 14:return f=t.sent,n=f.getContent(),this.theirSASPubKey=n.key,l.set_their_key(n.key),this.ourSASPubKey=l.get_pubkey(),t.next=21,this.send("m.key.verification.key",{key:this.ourSASPubKey});case 21:return p=R[a](this,l,6),v=new Promise((function(e,t){b.sasEvent={sas:x(p,c),confirm:function(){var n=o(i.mark((function n(){return i.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,b.sendMAC(l,u);case 3:e(),n.next=9;break;case 6:n.prev=6,n.t0=n.catch(0),t(n.t0);case 9:case"end":return n.stop()}}),n,null,[[0,6]])})));return function(){return n.apply(this,arguments)}}(),cancel:function(){return t((0,y.newUserCancelledError)())},mismatch:function(){return t(S())}},b.emit("show_sas",b.sasEvent)})),t.next=25,Promise.all([this.waitForEvent("m.key.verification.mac").then((function(e){return b.expectedEvent="m.key.verification.done",e})),v]);case 25:return m=t.sent,k=r(m,1),f=k[0],n=f.getContent(),t.next=31,this.checkMAC(l,n,u);case 31:return t.prev=31,l.free(),t.finish(31);case 34:case"end":return t.stop()}}),t,this,[[8,,31,34]])})));return function(){return t.apply(this,arguments)}}()},{key:"sendMAC",value:function(e,t){var n={},r=[],i="MATRIX_KEY_VERIFICATION_MAC"+this.baseApis.getUserId()+this.baseApis.deviceId+this.userId+this.deviceId+this.channel.transactionId,o="ed25519:".concat(this.baseApis.deviceId);n[o]=T(e,t)(this.baseApis.getDeviceEd25519Key(),i+o),r.push(o);var a=this.baseApis.getCrossSigningId();if(a){var s="ed25519:".concat(a);n[s]=T(e,t)(a,i+s),r.push(s)}var u=T(e,t)(r.sort().join(","),i+"KEY_IDS");return this.send("m.key.verification.mac",{mac:n,keys:u})}},{key:"checkMAC",value:function(){var e=o(i.mark((function e(t,n,r){var o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o="MATRIX_KEY_VERIFICATION_MAC"+this.userId+this.deviceId+this.baseApis.getUserId()+this.baseApis.deviceId+this.channel.transactionId,n.keys===T(t,r)(Object.keys(n.mac).sort().join(","),o+"KEY_IDS")){e.next=3;break}throw(0,y.newKeyMismatchError)();case 3:return e.next=5,this.verifyKeys(this.userId,n.mac,(function(e,n,i){if(i!==T(t,r)(n.keys[e],o+e))throw(0,y.newKeyMismatchError)()}));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}],[{key:"NAME",get:function(){return"m.sas.v1"}}]),d}(v.VerificationBase);t.SAS=j}).call(this,n(14))},function(e,t,n){var r=n(146);e.exports=r("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")},function(e,t,n){"use strict";var r=n(147).Buffer;e.exports=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<e.length;i++){var o=e.charAt(i),a=o.charCodeAt(0);if(255!==t[a])throw new TypeError(o+" is ambiguous");t[a]=i}var s=e.length,u=e.charAt(0),c=Math.log(s)/Math.log(256),l=Math.log(256)/Math.log(s);function d(e){if("string"!==typeof e)throw new TypeError("Expected String");if(0===e.length)return r.alloc(0);var n=0;if(" "!==e[n]){for(var i=0,o=0;e[n]===u;)i++,n++;for(var a=(e.length-n)*c+1>>>0,l=new Uint8Array(a);e[n];){var d=t[e.charCodeAt(n)];if(255===d)return;for(var f=0,h=a-1;(0!==d||f<o)&&-1!==h;h--,f++)d+=s*l[h]>>>0,l[h]=d%256>>>0,d=d/256>>>0;if(0!==d)throw new Error("Non-zero carry");o=f,n++}if(" "!==e[n]){for(var p=a-o;p!==a&&0===l[p];)p++;var v=r.allocUnsafe(i+(a-p));v.fill(0,0,i);for(var g=i;p!==a;)v[g++]=l[p++];return v}}}return{encode:function(t){if((Array.isArray(t)||t instanceof Uint8Array)&&(t=r.from(t)),!r.isBuffer(t))throw new TypeError("Expected Buffer");if(0===t.length)return"";for(var n=0,i=0,o=0,a=t.length;o!==a&&0===t[o];)o++,n++;for(var c=(a-o)*l+1>>>0,d=new Uint8Array(c);o!==a;){for(var f=t[o],h=0,p=c-1;(0!==f||h<i)&&-1!==p;p--,h++)f+=256*d[p]>>>0,d[p]=f%s>>>0,f=f/s>>>0;if(0!==f)throw new Error("Non-zero carry");i=h,o++}for(var v=c-i;v!==c&&0===d[v];)v++;for(var g=u.repeat(n);v<c;++v)g+=e.charAt(d[v]);return g},decodeUnsafe:d,decode:function(e){var t=d(e);if(t)return t;throw new Error("Non-base"+s+" character")}}}},function(e,t,n){var r=n(24),i=r.Buffer;function o(e,t){for(var n in e)t[n]=e[n]}function a(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(o(r,t),t.Buffer=a),a.prototype=Object.create(i.prototype),o(i,a),a.from=function(e,t,n){if("number"===typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},a.alloc=function(e,t,n){if("number"!==typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"===typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},a.allocUnsafe=function(e){if("number"!==typeof e)throw new TypeError("Argument must be a number");return i(e)},a.allocUnsafeSlow=function(e){if("number"!==typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},function(e,t,n){"use strict";var r=n(8),i=n(6),o=n(7),a=n(0),s=n(2),u=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.InRoomRequests=t.InRoomChannel=void 0;var c=u(n(3)),l=n(58),d=n(5),f=n(17).EventType.RoomMessage,h="m.reference",p="m.relates_to",v=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;a(this,e),this.client=t,this.roomId=n,this.userId=r,(0,c.default)(this,"requestEventId",null)}return s(e,[{key:"receiveStartFromOtherDevices",get:function(){return!0}},{key:"transactionId",get:function(){return this.requestEventId}},{key:"getTimestamp",value:function(e){return e.getTs()}},{key:"canCreateRequest",value:function(t){return e.canCreateRequest(t)}},{key:"handleEvent",value:function(){var t=o(i.mark((function t(n,r){var o,a,s,u,c,l,f,h=arguments;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=h.length>2&&void 0!==h[2]&&h[2],!r.hasEventId(n.getId())){t.next=3;break}return t.abrupt("return");case 3:if(a=e.getEventType(n),n.getRoomId()===this.roomId){t.next=6;break}return t.abrupt("return");case 6:if(null===this.userId&&(s=e.getOtherPartyUserId(n,this.client))&&(this.userId=s),u=this.client.getUserId(),c=n.getSender(),null===this.userId){t.next=13;break}if(c===u||c===this.userId){t.next=13;break}return d.logger.log("InRoomChannel: ignoring verification event from "+"non-participating sender ".concat(c)),t.abrupt("return");case 13:return null===this.requestEventId&&(this.requestEventId=e.getTransactionId(n)),l=!!n.getUnsigned().transaction_id,f=n.getSender()===this.client.getUserId(),t.next=18,r.handleEvent(a,n,o,l,f);case 18:return t.abrupt("return",t.sent);case 19:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"completedContentFromEvent",value:function(e){var t=Object.assign({},e.getContent());return t[p]=e.getRelation(),t}},{key:"completeContent",value:function(e,t){return t=Object.assign({},t),e!==l.REQUEST_TYPE&&e!==l.READY_TYPE&&e!==l.START_TYPE||(t.from_device=this.client.getDeviceId()),e===l.REQUEST_TYPE?t={body:this.client.getUserId()+" is requesting to verify your key, but your client does not support in-chat key verification.  You will need to use legacy key verification to verify keys.",msgtype:l.REQUEST_TYPE,to:this.userId,from_device:t.from_device,methods:t.methods}:t[p]={rel_type:h,event_id:this.transactionId},t}},{key:"send",value:function(e,t){var n=this.completeContent(e,t);return this.sendCompleted(e,n)}},{key:"sendCompleted",value:function(){var e=o(i.mark((function e(t,n){var r,o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t,t===l.REQUEST_TYPE&&(r=f),e.next=4,this.client.sendEvent(this.roomId,r,n);case 4:o=e.sent,t===l.REQUEST_TYPE&&(this.requestEventId=o.event_id);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}],[{key:"getOtherPartyUserId",value:function(t,n){if(e.getEventType(t)===l.REQUEST_TYPE){var r=n.getUserId(),i=t.getSender(),o=t.getContent().to;return i===r?o:o===r?i:void 0}}},{key:"canCreateRequest",value:function(e){return e===l.REQUEST_TYPE}},{key:"getTransactionId",value:function(t){if(e.getEventType(t)===l.REQUEST_TYPE)return t.getId();var n=t.getRelation();return n&&n.rel_type===h?n.event_id:void 0}},{key:"validateEvent",value:function(t,n){var r=e.getTransactionId(t);if("string"!==typeof r||0===r.length)return!1;var i=e.getEventType(t),o=t.getContent();if(i===l.REQUEST_TYPE){if(!o||"string"!==typeof o.to||!o.to.length)return d.logger.log("InRoomChannel: validateEvent: no valid to "+(o&&o.to)),!1;if(!e.getOtherPartyUserId(t,n))return d.logger.log("InRoomChannel: validateEvent: "+"not directed to or sent by me: ".concat(t.getSender())+", ".concat(o&&o.to)),!1}return l.VerificationRequest.validateEvent(i,t,n)}},{key:"getEventType",value:function(e){var t=e.getType();if(t===f){var n=e.getContent();if(n)if(n.msgtype===l.REQUEST_TYPE)return l.REQUEST_TYPE}return t&&t!==l.REQUEST_TYPE?t:""}}]),e}();t.InRoomChannel=v;var g=function(){function e(){a(this,e),(0,c.default)(this,"requestsByRoomId",new Map)}return s(e,[{key:"getRequest",value:function(e){var t=e.getRoomId(),n=v.getTransactionId(e);return this.getRequestByTxnId(t,n)}},{key:"getRequestByChannel",value:function(e){return this.getRequestByTxnId(e.roomId,e.transactionId)}},{key:"getRequestByTxnId",value:function(e,t){var n=this.requestsByRoomId.get(e);if(n)return n.get(t)}},{key:"setRequest",value:function(e,t){this.doSetRequest(e.getRoomId(),v.getTransactionId(e),t)}},{key:"setRequestByChannel",value:function(e,t){this.doSetRequest(e.roomId,e.transactionId,t)}},{key:"doSetRequest",value:function(e,t,n){var r=this.requestsByRoomId.get(e);r||(r=new Map,this.requestsByRoomId.set(e,r)),r.set(t,n)}},{key:"removeRequest",value:function(e){var t=e.getRoomId(),n=this.requestsByRoomId.get(t);n&&(n.delete(v.getTransactionId(e)),0===n.size&&this.requestsByRoomId.delete(t))}},{key:"findRequestInProgress",value:function(e){var t=this.requestsByRoomId.get(e);if(t){var n,i=r(t.values());try{for(i.s();!(n=i.n()).done;){var o=n.value;if(o.pending)return o}}catch(a){i.e(a)}finally{i.f()}}}}]),e}();t.InRoomRequests=g},function(e,t,n){"use strict";var r=n(16),i=n(6),o=n(7),a=n(8),s=n(0),u=n(2),c=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.ToDeviceRequests=t.ToDeviceChannel=void 0;var l=c(n(3)),d=n(32),f=n(5),h=n(58),p=n(34),v=n(18),g=function(){function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;s(this,e),this.client=t,this.userId=n,this.devices=r,this.transactionId=i,this.deviceId=o,(0,l.default)(this,"request",void 0)}return u(e,[{key:"isToDevices",value:function(e){if(e.length===this.devices.length){var t,n=a(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(!this.devices.includes(r))return!1}}catch(i){n.e(i)}finally{n.f()}return!0}return!1}},{key:"canCreateRequest",value:function(t){return e.canCreateRequest(t)}},{key:"getTimestamp",value:function(e){var t=e.getContent();return t&&t.timestamp}},{key:"handleEvent",value:function(){var e=o(i.mark((function e(t,n){var r,o,a,s,u,c,l,d,f,v=this,g=arguments;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=g.length>2&&void 0!==g[2]&&g[2],o=t.getType(),a=t.getContent(),o!==h.REQUEST_TYPE&&o!==h.READY_TYPE&&o!==h.START_TYPE){e.next=10;break}if(this.transactionId||(this.transactionId=a.transaction_id),s=a.from_device,!this.deviceId&&this.devices.includes(s)&&(this.deviceId=s),this.deviceId&&this.deviceId===s){e.next=10;break}return u=this.completeContent(h.CANCEL_TYPE,(0,p.errorFromEvent)((0,p.newUnexpectedMessageError)())),e.abrupt("return",this.sendToDevices(h.CANCEL_TYPE,u,[s]));case 10:return c=n.phase===h.PHASE_STARTED||n.phase===h.PHASE_READY,e.next=13,n.handleEvent(t.getType(),t,r,!1,!1);case 13:if(l=n.phase===h.PHASE_STARTED||n.phase===h.PHASE_READY,!(o===h.START_TYPE||o===h.READY_TYPE)||c||!l||!this.deviceId){e.next=21;break}if(!(d=this.devices.filter((function(e){return e!==v.deviceId&&e!==v.client.getDeviceId()}))).length){e.next=21;break}return f=this.completeContent(h.CANCEL_TYPE,{code:"m.accepted",reason:"Verification request accepted by another device"}),e.next=21,this.sendToDevices(h.CANCEL_TYPE,f,d);case 21:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"completedContentFromEvent",value:function(e){return e.getContent()}},{key:"completeContent",value:function(e,t){return t=Object.assign({},t),this.transactionId&&(t.transaction_id=this.transactionId),e!==h.REQUEST_TYPE&&e!==h.READY_TYPE&&e!==h.START_TYPE||(t.from_device=this.client.getDeviceId()),e===h.REQUEST_TYPE&&(t.timestamp=Date.now()),t}},{key:"send",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t!==h.REQUEST_TYPE&&t!==h.START_TYPE||this.transactionId||(this.transactionId=e.makeTransactionId());var r=this.completeContent(t,n);return this.sendCompleted(t,r)}},{key:"sendCompleted",value:function(){var e=o(i.mark((function e(t,n){var r,o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==h.REQUEST_TYPE&&(t!==h.CANCEL_TYPE||this.deviceId)){e.next=6;break}return e.next=3,this.sendToDevices(t,n,this.devices);case 3:r=e.sent,e.next=9;break;case 6:return e.next=8,this.sendToDevices(t,n,[this.deviceId]);case 8:r=e.sent;case 9:return o=new v.MatrixEvent({sender:this.client.getUserId(),content:n,type:t}),e.next=12,this.request.handleEvent(t,o,!0,!0,!0);case 12:return e.abrupt("return",r);case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"sendToDevices",value:function(){var e=o(i.mark((function e(t,n,o){var s,u,c,l;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o.length){e.next=6;break}s={},u=a(o);try{for(u.s();!(c=u.n()).done;)l=c.value,s[l]=n}catch(i){u.e(i)}finally{u.f()}return e.next=6,this.client.sendToDevice(t,r({},this.userId,s));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}],[{key:"getEventType",value:function(e){return e.getType()}},{key:"getTransactionId",value:function(e){var t=e.getContent();return t&&t.transaction_id}},{key:"canCreateRequest",value:function(e){return e===h.REQUEST_TYPE||e===h.START_TYPE}},{key:"validateEvent",value:function(e,t){if(e.isCancelled())return f.logger.warn("Ignoring flagged verification request from "+e.getSender()),!1;var n=e.getContent();if(!n)return f.logger.warn("ToDeviceChannel.validateEvent: invalid: no content"),!1;if(!n.transaction_id)return f.logger.warn("ToDeviceChannel.validateEvent: invalid: no transaction_id"),!1;var r=e.getType();if(r===h.REQUEST_TYPE){if(!Number.isFinite(n.timestamp))return f.logger.warn("ToDeviceChannel.validateEvent: invalid: no timestamp"),!1;if(e.getSender()===t.getUserId()&&n.from_device==t.getDeviceId())return f.logger.warn("ToDeviceChannel.validateEvent: invalid: from own device"),!1}return h.VerificationRequest.validateEvent(r,e,t)}},{key:"makeTransactionId",value:function(){return(0,d.randomString)(32)}}]),e}();t.ToDeviceChannel=g;var y=function(){function e(){s(this,e),(0,l.default)(this,"requestsByUserId",new Map)}return u(e,[{key:"getRequest",value:function(e){return this.getRequestBySenderAndTxnId(e.getSender(),g.getTransactionId(e))}},{key:"getRequestByChannel",value:function(e){return this.getRequestBySenderAndTxnId(e.userId,e.transactionId)}},{key:"getRequestBySenderAndTxnId",value:function(e,t){var n=this.requestsByUserId.get(e);if(n)return n.get(t)}},{key:"setRequest",value:function(e,t){this.setRequestBySenderAndTxnId(e.getSender(),g.getTransactionId(e),t)}},{key:"setRequestByChannel",value:function(e,t){this.setRequestBySenderAndTxnId(e.userId,e.transactionId,t)}},{key:"setRequestBySenderAndTxnId",value:function(e,t,n){var r=this.requestsByUserId.get(e);r||(r=new Map,this.requestsByUserId.set(e,r)),r.set(t,n)}},{key:"removeRequest",value:function(e){var t=e.getSender(),n=this.requestsByUserId.get(t);n&&(n.delete(g.getTransactionId(e)),0===n.size&&this.requestsByUserId.delete(t))}},{key:"findRequestInProgress",value:function(e,t){var n=this.requestsByUserId.get(e);if(n){var r,i=a(n.values());try{for(i.s();!(r=i.n()).done;){var o=r.value;if(o.pending&&o.channel.isToDevices(t))return o}}catch(s){i.e(s)}finally{i.f()}}}},{key:"getRequestsInProgress",value:function(e){var t=this.requestsByUserId.get(e);return t?Array.from(t.values()).filter((function(e){return e.pending})):[]}}]),e}();t.ToDeviceRequests=y},function(e,t,n){"use strict";var r=n(6),i=n(7),o=n(0),a=n(2),s=n(11),u=n(9),c=n(10),l=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.IllegalMethod=void 0;var d=l(n(3)),f=function(e){u(n,e);var t=c(n);function n(){var e;o(this,n);for(var a=arguments.length,u=new Array(a),c=0;c<a;c++)u[c]=arguments[c];return e=t.call.apply(t,[this].concat(u)),(0,d.default)(s(e),"doVerification",i(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Verification is not possible with this method");case 1:case"end":return e.stop()}}),e)})))),e}return a(n,null,[{key:"factory",value:function(e,t,r,i,o,a){return new n(e,t,r,i,o,a)}},{key:"NAME",get:function(){return"org.matrix.illegal_method"}}]),n}(n(55).VerificationBase);t.IllegalMethod=f},function(e,t,n){"use strict";var r=n(0),i=n(2);Object.defineProperty(t,"__esModule",{value:!0}),t.SearchResult=void 0;var o=n(152),a=function(){function e(t,n){r(this,e),this.rank=t,this.context=n}return i(e,null,[{key:"fromJson",value:function(t,n){var r=t.context||{},i=r.events_before||[],a=r.events_after||[],s=new o.EventContext(n(t.result));return s.setPaginateToken(r.start,!0),s.addEvents(i.map(n),!0),s.addEvents(a.map(n),!1),s.setPaginateToken(r.end,!1),new e(t.rank,s)}}]),e}();t.SearchResult=a},function(e,t,n){"use strict";var r=n(16),i=n(0),o=n(2),a=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.EventContext=void 0;var s=a(n(3)),u=n(23),c=function(){function e(t){var n;i(this,e),(0,s.default)(this,"timeline",void 0),(0,s.default)(this,"ourEventIndex",0),(0,s.default)(this,"paginateTokens",(r(n={},u.Direction.Backward,null),r(n,u.Direction.Forward,null),n)),this.timeline=[t]}return o(e,[{key:"getEvent",value:function(){return this.timeline[this.ourEventIndex]}},{key:"getTimeline",value:function(){return this.timeline}},{key:"getOurEventIndex",value:function(){return this.ourEventIndex}},{key:"getPaginateToken",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.paginateTokens[e?u.Direction.Backward:u.Direction.Forward]}},{key:"setPaginateToken",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.paginateTokens[t?u.Direction.Backward:u.Direction.Forward]=e}},{key:"addEvents",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t?(this.timeline=e.concat(this.timeline),this.ourEventIndex+=e.length):this.timeline=this.timeline.concat(e)}}]),e}();t.EventContext=c},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.CrossSigningKey=void 0,t.CrossSigningKey=r,function(e){e.Master="master",e.SelfSigning="self_signing",e.UserSigning="user_signing"}(r||(t.CrossSigningKey=r={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.eventMapperFor=function(e,t){var n=Boolean(t.preventReEmit),i=!1!==t.decrypt;return function(t){var o=new r.MatrixEvent(t);return o.isEncrypted()&&(n||e.reEmitter.reEmit(o,["Event.decrypted"]),i&&e.decryptEventIfNeeded(o)),n||e.reEmitter.reEmit(o,["Event.replaced"]),o}};var r=n(18)},function(e,t,n){"use strict";var r,i=n(8),o=n(21),a=n(6),s=n(7),u=n(0),c=n(2),l=n(16),d=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.MSC3089TreeSpace=t.TreePermissions=t.DEFAULT_TREE_POWER_LEVELS_TEMPLATE=void 0;var f=d(n(3)),h=n(17),p=n(5),v=n(12),g=n(156),y=d(n(66)),m=n(83);function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){(0,f.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var S,w={invite:100,kick:100,ban:100,redact:50,state_default:50,events_default:50,users_default:0,events:(r={},l(r,h.EventType.RoomPowerLevels,100),l(r,h.EventType.RoomHistoryVisibility,100),l(r,h.EventType.RoomTombstone,100),l(r,h.EventType.RoomEncryption,100),l(r,h.EventType.RoomName,50),l(r,h.EventType.RoomMessage,50),l(r,h.EventType.RoomMessageEncrypted,50),l(r,h.EventType.Sticker,50),r),users:{}};t.DEFAULT_TREE_POWER_LEVELS_TEMPLATE=w,t.TreePermissions=S,function(e){e.Viewer="viewer",e.Editor="editor",e.Owner="owner"}(S||(t.TreePermissions=S={}));var E=function(){function e(t,n){if(u(this,e),this.client=t,this.roomId=n,(0,f.default)(this,"room",void 0),this.room=this.client.getRoom(this.roomId),!this.room)throw new Error("Unknown room")}return c(e,[{key:"id",get:function(){return this.roomId}},{key:"isTopLevel",get:function(){var e=this.room.currentState.getStateEvents(h.EventType.SpaceParent);return null===e||void 0===e||!e.length||e.every((function(e){var t;return!(null!==(t=e.getContent())&&void 0!==t&&t.via)}))}},{key:"setName",value:function(){var e=s(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.sendStateEvent(this.roomId,h.EventType.RoomName,{name:t},"");case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"invite",value:function(){var e=s(a.mark((function e(t){var n,r,i,s=this,u=arguments;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(u.length>1&&void 0!==u[1])||u[1],r=!(u.length>2&&void 0!==u[2])||u[2],i=[this.retryInvite(t)],n&&i.push.apply(i,o(this.getDirectories().map((function(e){return e.invite(t,n,r)})))),e.abrupt("return",Promise.all(i).then((function(){r&&(0,m.isRoomSharedHistory)(s.room)&&s.client.sendSharedHistoryKeys(s.roomId,[t])})));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"retryInvite",value:function(e){var t=this;return(0,v.simpleRetryOperation)(s(a.mark((function n(){return a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.client.invite(t.roomId,e).catch((function(e){if("M_FORBIDDEN"===(null===e||void 0===e?void 0:e.errcode))throw new y.default.AbortError(e);throw e}));case 2:case"end":return n.stop()}}),n)}))))}},{key:"setPermissions",value:function(){var e=s(a.mark((function e(t,n){var r,i,o,s,u,c,l;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.room.currentState.getStateEvents(h.EventType.RoomPowerLevels,""),!Array.isArray(i)){e.next=3;break}throw new Error("Unexpected return type for power levels");case 3:o=i.getContent()||{},s=o.users_default||0,u=o.events_default||50,c=(null===(r=o.events)||void 0===r?void 0:r[h.EventType.RoomPowerLevels])||100,l=o.users||{},e.t0=n,e.next=e.t0===S.Viewer?11:e.t0===S.Editor?13:e.t0===S.Owner?15:17;break;case 11:return l[t]=s,e.abrupt("break",18);case 13:return l[t]=u,e.abrupt("break",18);case 15:return l[t]=c,e.abrupt("break",18);case 17:throw new Error("Invalid role: "+n);case 18:return o.users=l,e.next=21,this.client.sendStateEvent(this.roomId,h.EventType.RoomPowerLevels,o,"");case 21:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getPermissions",value:function(e){var t,n,r=this.room.currentState.getStateEvents(h.EventType.RoomPowerLevels,"");if(Array.isArray(r))throw new Error("Unexpected return type for power levels");var i=r.getContent()||{},o=i.users_default||0,a=i.events_default||50,s=(null===(t=i.events)||void 0===t?void 0:t[h.EventType.RoomPowerLevels])||100,u=(null===(n=i.users)||void 0===n?void 0:n[e])||o;return u>=s?S.Owner:u>=a?S.Editor:S.Viewer}},{key:"createDirectory",value:function(){var e=s(a.mark((function e(t){var n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.unstableCreateFileTree(t);case 2:return n=e.sent,e.next=5,this.client.sendStateEvent(this.roomId,h.EventType.SpaceChild,{via:[this.client.getDomain()]},n.roomId);case 5:return e.next=7,this.client.sendStateEvent(n.roomId,h.EventType.SpaceParent,{via:[this.client.getDomain()]},this.roomId);case 7:return e.abrupt("return",n);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDirectories",value:function(){var e,t=[],n=this.room.currentState.getStateEvents(h.EventType.SpaceChild),r=i(n);try{for(r.s();!(e=r.n()).done;){var o=e.value;try{var a=this.client.unstableGetFileTreeSpace(o.getStateKey());a&&t.push(a)}catch(s){p.logger.warn("Unable to create tree space instance for listing. Are we joined?",s)}}}catch(u){r.e(u)}finally{r.f()}return t}},{key:"getDirectory",value:function(e){return this.getDirectories().find((function(t){return t.roomId===e}))}},{key:"delete",value:function(){var e=s(a.mark((function e(){var t,n,r,o,s,u,c,l,d;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.getDirectories(),n=i(t),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return o=r.value,e.next=8,o.delete();case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:s=["invite","knock","join"],u=this.room.currentState.getStateEvents(h.EventType.RoomMember),c=i(u),e.prev=21,c.s();case 23:if((l=c.n()).done){e.next=31;break}if(d=l.value,!(d.getStateKey()!==this.client.getUserId())||!s.includes(d.getContent().membership)){e.next=29;break}return e.next=29,this.client.kick(this.roomId,d.getStateKey(),"Room deleted");case 29:e.next=23;break;case 31:e.next=36;break;case 33:e.prev=33,e.t1=e.catch(21),c.e(e.t1);case 36:return e.prev=36,c.f(),e.finish(36);case 39:return e.next=41,this.client.leave(this.roomId);case 41:case"end":return e.stop()}}),e,this,[[2,12,15,18],[21,33,36,39]])})));return function(){return e.apply(this,arguments)}}()},{key:"getOrderedChildren",value:function(e){var t=this,n=e.map((function(e){return{roomId:e.getStateKey(),order:e.getContent().order}}));return n.sort((function(e,n){if(e.order&&!n.order)return-1;if(!e.order&&n.order)return 1;if(e.order||n.order)return(0,v.lexicographicCompare)(e.order,n.order);var r,i,o,a,s=t.client.getRoom(e.roomId),u=t.client.getRoom(n.roomId);if(!s||!u)return(0,v.lexicographicCompare)(e.roomId,n.roomId);var c=null!==(r=null===(i=s.currentState.getStateEvents(h.EventType.RoomCreate,""))||void 0===i?void 0:i.getTs())&&void 0!==r?r:0,l=null!==(o=null===(a=u.currentState.getStateEvents(h.EventType.RoomCreate,""))||void 0===a?void 0:a.getTs())&&void 0!==o?o:0;return c===l?(0,v.lexicographicCompare)(e.roomId,n.roomId):c-l})),n}},{key:"getParentRoom",value:function(){var e=this.room.currentState.getStateEvents(h.EventType.SpaceParent)[0];if(!e)throw new Error("Expected to have a parent in a non-top level space");var t=this.client.getRoom(e.getStateKey());if(!t)throw new Error("Unable to locate room for parent");return t}},{key:"getOrder",value:function(){var e=this;if(this.isTopLevel)return-1;var t=this.getParentRoom().currentState.getStateEvents(h.EventType.SpaceChild);return this.getOrderedChildren(t).findIndex((function(t){return t.roomId===e.roomId}))}},{key:"setOrder",value:function(){var e=s(a.mark((function e(t){var n,r,i,o,s,u,c,l,d,f,p,g,y,m,k,S,w,E,_,x;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isTopLevel){e.next=2;break}throw new Error("Cannot set order of top level spaces currently");case 2:if(r=this.getParentRoom(),i=r.currentState.getStateEvents(h.EventType.SpaceChild),o=this.getOrderedChildren(i),t=Math.max(Math.min(t,o.length-1),0),s=this.getOrder(),(u=s<t)&&t===o.length-1?t--:u||0!==t||t++,c=o[u?t:t-1],l=o[u?t+1:t],d=v.DEFAULT_ALPHABET[0],f=!1,c?t===o.length-1?null!==l&&void 0!==l&&l.order&&(d=(0,v.nextString)(l.order)):(p=null===c||void 0===c?void 0:c.order,g=null===l||void 0===l?void 0:l.order,p&&g?d=p===g?(0,v.nextString)(p):(0,v.averageBetweenStrings)(p,g):p?d=(0,v.nextString)(p):g?d=(0,v.prevString)(g):f=!0):null!==l&&void 0!==l&&l.order&&(d=(0,v.prevString)(l.order)),!f){e.next=32;break}m=0;case 16:if(!(m<=t)){e.next=31;break}if(k=o[m],0===m&&(y=k.order),k.order){e.next=27;break}return y=y?(0,v.nextString)(y):v.DEFAULT_ALPHABET[0],w=r.currentState.getStateEvents(h.EventType.SpaceChild,k.roomId),E=null!==(S=null===w||void 0===w?void 0:w.getContent())&&void 0!==S?S:{via:[this.client.getDomain()]},e.next=25,this.client.sendStateEvent(r.roomId,h.EventType.SpaceChild,b(b({},E),{},{order:y}),k.roomId);case 25:e.next=28;break;case 27:y=k.order;case 28:m++,e.next=16;break;case 31:d=(0,v.nextString)(y);case 32:return _=r.currentState.getStateEvents(h.EventType.SpaceChild,this.roomId),x=null!==(n=null===_||void 0===_?void 0:_.getContent())&&void 0!==n?n:{via:[this.client.getDomain()]},e.next=36,this.client.sendStateEvent(r.roomId,h.EventType.SpaceChild,b(b({},x),{},{order:d}),this.roomId);case 36:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createFile",value:function(){var e=s(a.mark((function e(t,n,r,i){var o,s,u,c;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.uploadContent(new Blob([n]),{includeFilename:!1,onlyContentUri:!0});case 2:return s=e.sent,r.url=s,u={msgtype:h.MsgType.File,body:t,url:s,file:r},(i=null!==(o=i)&&void 0!==o?o:{})["m.new_content"]&&(i["m.new_content"]=u),e.next=9,this.client.sendMessage(this.roomId,b(b(b({},i),u),{},l({},h.UNSTABLE_MSC3089_LEAF.name,{})));case 9:return c=e.sent,e.next=12,this.client.sendStateEvent(this.roomId,h.UNSTABLE_MSC3089_BRANCH.name,{active:!0,name:t},c.event_id);case 12:return e.abrupt("return",c);case 13:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"getFile",value:function(e){var t=this.room.currentState.getStateEvents(h.UNSTABLE_MSC3089_BRANCH.name,e);return t?new g.MSC3089Branch(this.client,t,this):null}},{key:"listFiles",value:function(){return this.listAllFiles().filter((function(e){return e.isActive}))}},{key:"listAllFiles",value:function(){var e,t=this;return(null!==(e=this.room.currentState.getStateEvents(h.UNSTABLE_MSC3089_BRANCH.name))&&void 0!==e?e:[]).map((function(e){return new g.MSC3089Branch(t.client,e,t)}))}}]),e}();t.MSC3089TreeSpace=E},function(e,t,n){"use strict";var r=n(21),i=n(6),o=n(7),a=n(0),s=n(2),u=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.MSC3089Branch=void 0;var c=u(n(3)),l=n(17);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){(0,c.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var h=function(){function e(t,n,r){a(this,e),this.client=t,this.indexEvent=n,this.directory=r}return s(e,[{key:"id",get:function(){return this.indexEvent.getStateKey()}},{key:"isActive",get:function(){return!0===this.indexEvent.getContent().active}},{key:"version",get:function(){var e;return null!==(e=this.indexEvent.getContent().version)&&void 0!==e?e:1}},{key:"roomId",get:function(){return this.indexEvent.getRoomId()}},{key:"delete",value:function(){var e=o(i.mark((function e(){var t;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.sendStateEvent(this.roomId,l.UNSTABLE_MSC3089_BRANCH.name,{},this.id);case 2:return e.next=4,this.client.redactEvent(this.roomId,this.id);case 4:return e.next=6,this.getVersionHistory();case 6:if(!(t=e.sent[1])){e.next=10;break}return e.next=10,t.delete();case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getName",value:function(){return this.indexEvent.getContent().name||"Unnamed File"}},{key:"setName",value:function(){var e=o(i.mark((function e(t){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.sendStateEvent(this.roomId,l.UNSTABLE_MSC3089_BRANCH.name,f(f({},this.indexEvent.getContent()),{},{name:t}),this.id);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isLocked",value:function(){return this.indexEvent.getContent().locked||!1}},{key:"setLocked",value:function(){var e=o(i.mark((function e(t){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.sendStateEvent(this.roomId,l.UNSTABLE_MSC3089_BRANCH.name,f(f({},this.indexEvent.getContent()),{},{locked:t}),this.id);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFileInfo",value:function(){var e=o(i.mark((function e(){var t,n,r;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getFileEvent();case 2:return t=e.sent,n=t.getOriginalContent().file,r=this.client.mxcUrlToHttp(n.url),e.abrupt("return",{info:n,httpUrl:r});case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFileEvent",value:function(){var e=o(i.mark((function e(){var t,n;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.client.getRoom(this.roomId)){e.next=3;break}throw new Error("Unknown room");case 3:if(n=t.getUnfilteredTimelineSet().findEventById(this.id)){e.next=6;break}throw new Error("Failed to find event");case 6:return e.next=8,this.client.decryptEventIfNeeded(n,{emit:!0,isRetry:!0});case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createNewVersion",value:function(){var e=o(i.mark((function e(t,n,r,o){var a;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.directory.createFile(t,n,r,f(f({},null!==o&&void 0!==o?o:{}),{},{"m.new_content":!0,"m.relates_to":{rel_type:l.RelationType.Replace,event_id:this.id}}));case 2:return a=e.sent,e.next=5,this.client.sendStateEvent(this.roomId,l.UNSTABLE_MSC3089_BRANCH.name,{active:!0,name:t,version:this.version+1},a.event_id);case 5:return e.next=7,this.client.sendStateEvent(this.roomId,l.UNSTABLE_MSC3089_BRANCH.name,f(f({},this.indexEvent.getContent()),{},{active:!1}),this.id);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"getVersionHistory",value:function(){var e=o(i.mark((function e(){var t,n,o,a,s,u;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=[]).push(this),n=this.client.getRoom(this.roomId)){e.next=5;break}throw new Error("Invalid or unknown room");case 5:return o=r(n.getLiveTimeline().getEvents()).reverse(),e.next=8,this.getFileEvent();case 8:s=e.sent;case 9:if(!(a=o.find((function(e){return e.replacingEventId()===s.getId()})))){e.next=18;break}if(!(u=this.directory.getFile(a.getId()))){e.next=17;break}t.push(u),s=a,e.next=18;break;case 17:return e.abrupt("break",19);case 18:if(a){e.next=9;break}case 19:return e.abrupt("return",t);case 20:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();t.MSC3089Branch=h},function(e,t,n){"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0}),t.SearchOrderBy=void 0,function(e){e.RoomId="room_id",e.Sender="sender"}(r||(r={})),t.SearchOrderBy=i,function(e){e.Recent="recent",e.Rank="rank"}(i||(t.SearchOrderBy=i={}))},function(e,t,n){"use strict";var r=n(8),i=n(6),o=n(7),a=n(0),s=n(2),u=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaHandler=void 0;var c=u(n(3)),l=n(5),d=function(){function e(){a(this,e),(0,c.default)(this,"audioInput",void 0),(0,c.default)(this,"videoInput",void 0),(0,c.default)(this,"userMediaStreams",[]),(0,c.default)(this,"screensharingStreams",[])}return s(e,[{key:"setAudioInput",value:function(e){this.audioInput=e}},{key:"setVideoInput",value:function(e){this.videoInput=e}},{key:"hasAudioDevice",value:function(){var e=o(i.mark((function e(){var t;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.enumerateDevices();case 2:return t=e.sent,e.abrupt("return",t.filter((function(e){return"audioinput"===e.kind})).length>0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"hasVideoDevice",value:function(){var e=o(i.mark((function e(){var t;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.enumerateDevices();case 2:return t=e.sent,e.abrupt("return",t.filter((function(e){return"videoinput"===e.kind})).length>0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getUserMediaStream",value:function(){var e=o(i.mark((function e(t,n){var r,o,a,s,u;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t,!e.t0){e.next=5;break}return e.next=4,this.hasAudioDevice();case 4:e.t0=e.sent;case 5:if(r=e.t0,e.t1=n,!e.t1){e.next=11;break}return e.next=10,this.hasVideoDevice();case 10:e.t1=e.sent;case 11:if(o=e.t1,!(s=this.userMediaStreams.find((function(e){return r===e.getAudioTracks().length>0&&o===e.getVideoTracks().length>0})))){e.next=18;break}l.logger.log("Cloning user media stream",s.id),a=s.clone(),e.next=23;break;case 18:return u=this.getUserMediaContraints(r,o),l.logger.log("Getting user media with constraints",u),e.next=22,navigator.mediaDevices.getUserMedia(u);case 22:a=e.sent;case 23:return this.userMediaStreams.push(a),e.abrupt("return",a);case 25:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"stopUserMediaStream",value:function(e){l.logger.debug("Stopping usermedia stream",e.id);var t,n=r(e.getTracks());try{for(n.s();!(t=n.n()).done;){t.value.stop()}}catch(o){n.e(o)}finally{n.f()}var i=this.userMediaStreams.indexOf(e);-1!==i&&(l.logger.debug("Splicing usermedia stream out stream array",e.id),this.userMediaStreams.splice(i,1))}},{key:"getScreensharingStream",value:function(){var e=o(i.mark((function e(t){var n,r,o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.screensharingStreams.length){e.next=17;break}if(r=this.getScreenshareContraints(t)){e.next=4;break}return e.abrupt("return",null);case 4:if(!t){e.next=11;break}return l.logger.debug("Getting screensharing stream using getUserMedia()",t),e.next=8,navigator.mediaDevices.getUserMedia(r);case 8:n=e.sent,e.next=15;break;case 11:return l.logger.debug("Getting screensharing stream using getDisplayMedia()"),e.next=14,navigator.mediaDevices.getDisplayMedia(r);case 14:n=e.sent;case 15:e.next=20;break;case 17:o=this.screensharingStreams[this.screensharingStreams.length-1],l.logger.log("Cloning screensharing stream",o.id),n=o.clone();case 20:return this.screensharingStreams.push(n),e.abrupt("return",n);case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopScreensharingStream",value:function(e){l.logger.debug("Stopping screensharing stream",e.id);var t,n=r(e.getTracks());try{for(n.s();!(t=n.n()).done;){t.value.stop()}}catch(o){n.e(o)}finally{n.f()}var i=this.screensharingStreams.indexOf(e);-1!==i&&(l.logger.debug("Splicing screensharing stream out stream array",e.id),this.screensharingStreams.splice(i,1))}},{key:"stopAllStreams",value:function(){var e,t=r(this.userMediaStreams);try{for(t.s();!(e=t.n()).done;){var n,i=e.value,o=r(i.getTracks());try{for(o.s();!(n=o.n()).done;){n.value.stop()}}catch(d){o.e(d)}finally{o.f()}}}catch(d){t.e(d)}finally{t.f()}var a,s=r(this.screensharingStreams);try{for(s.s();!(a=s.n()).done;){var u,c=a.value,l=r(c.getTracks());try{for(l.s();!(u=l.n()).done;){u.value.stop()}}catch(d){l.e(d)}finally{l.f()}}}catch(d){s.e(d)}finally{s.f()}this.userMediaStreams=[],this.screensharingStreams=[]}},{key:"getUserMediaContraints",value:function(e,t){var n=!!navigator.webkitGetUserMedia;return{audio:!!e&&{deviceId:this.audioInput?{ideal:this.audioInput}:void 0},video:!!t&&{deviceId:this.videoInput?{ideal:this.videoInput}:void 0,width:n?{exact:640}:{ideal:640},height:n?{exact:360}:{ideal:360}}}}},{key:"getScreenshareContraints",value:function(e){return e?(l.logger.debug("Using desktop capturer source",e),{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e}}}):(l.logger.debug("Not using desktop capturer source"),{audio:!1,video:!0})}}]),e}();t.MediaHandler=d},function(e,t,n){"use strict";var r=n(0),i=n(2),o=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.TimelineIndex=t.TimelineWindow=void 0;var a=o(n(3)),s=n(23),u=(n(5),function(){}),c=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r(this,e),this.client=t,this.timelineSet=n,(0,a.default)(this,"windowLimit",void 0),(0,a.default)(this,"start",null),(0,a.default)(this,"end",null),(0,a.default)(this,"eventCount",0),this.windowLimit=i.windowLimit||1e3}return i(e,[{key:"load",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,r=function(r){var i,o=r.getEvents();if(e){for(var a=0;a<o.length;a++)if(o[a].getId()==e){i=a;break}if(void 0===i)throw new Error("getEventTimeline result didn't include requested event")}else i=o.length;var s=Math.min(o.length,i+Math.ceil(n/2)),u=Math.max(0,s-n);t.start=new l(r,u-r.getBaseIndex()),t.end=new l(r,s-r.getBaseIndex()),t.eventCount=s-u};if(e){var i=this.timelineSet.getTimelineForEvent(e);if(i)return r(i),Promise.resolve(i);var o=this.client.getEventTimeline(this.timelineSet,e);return o.then(r)}var a=this.timelineSet.getLiveTimeline();return r(a),Promise.resolve()}},{key:"getTimelineIndex",value:function(e){if(e==s.EventTimeline.BACKWARDS)return this.start;if(e==s.EventTimeline.FORWARDS)return this.end;throw new Error("Invalid direction '"+e+"'")}},{key:"extend",value:function(e,t){var n=this.getTimelineIndex(e);if(!n)return u("TimelineWindow: no timeline yet"),!1;var r=e==s.EventTimeline.BACKWARDS?n.retreat(t):n.advance(t);if(r){this.eventCount+=r,u("TimelineWindow: increased cap by "+r+" (now "+this.eventCount+")");var i=this.eventCount-this.windowLimit;return i>0&&this.unpaginate(i,e!=s.EventTimeline.BACKWARDS),!0}return!1}},{key:"canPaginate",value:function(e){var t=this.getTimelineIndex(e);if(!t)return u("TimelineWindow: no timeline yet"),!1;if(e==s.EventTimeline.BACKWARDS){if(t.index>t.minIndex())return!0}else if(t.index<t.maxIndex())return!0;return Boolean(t.timeline.getNeighbouringTimeline(e)||t.timeline.getPaginationToken(e))}},{key:"paginate",value:function(e,t){var n=this,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,o=this.getTimelineIndex(e);if(!o)return u("TimelineWindow: no timeline yet"),Promise.resolve(!1);if(o.pendingPaginate)return o.pendingPaginate;if(this.extend(e,t))return Promise.resolve(!0);if(!r||0===i)return Promise.resolve(!1);var a=o.timeline.getPaginationToken(e);if(!a)return u("TimelineWindow: no token"),Promise.resolve(!1);u("TimelineWindow: starting request");var c=this.client.paginateEventTimeline(o.timeline,{backwards:e==s.EventTimeline.BACKWARDS,limit:t}).finally((function(){o.pendingPaginate=null})).then((function(r){return u("TimelineWindow: request completed with result "+r),!!r&&n.paginate(e,t,!0,i-1)}));return o.pendingPaginate=c,c}},{key:"unpaginate",value:function(e,t){var n=t?this.start:this.end;if(e>this.eventCount||e<0)throw new Error("Attemting to unpaginate "+e+" events, but only have "+this.eventCount+" in the timeline");for(;e>0;){var r=t?n.advance(e):n.retreat(e);if(r<=0)throw new Error("Unable to unpaginate any further, but still have "+this.eventCount+" events");e-=r,this.eventCount-=r,u("TimelineWindow.unpaginate: dropped "+r+" (now "+this.eventCount+")")}}},{key:"getEvents",value:function(){if(!this.start)return[];for(var e=[],t=this.start.timeline;;){var n=t.getEvents(),r=0,i=n.length;t===this.start.timeline&&(r=this.start.index+t.getBaseIndex()),t===this.end.timeline&&(i=this.end.index+t.getBaseIndex());for(var o=r;o<i;o++)e.push(n[o]);if(t===this.end.timeline)break;t=t.getNeighbouringTimeline(s.EventTimeline.FORWARDS)}return e}}]),e}();t.TimelineWindow=c;var l=function(){function e(t,n){r(this,e),this.timeline=t,this.index=n,(0,a.default)(this,"pendingPaginate",void 0)}return i(e,[{key:"minIndex",value:function(){return-1*this.timeline.getBaseIndex()}},{key:"maxIndex",value:function(){return this.timeline.getEvents().length-this.timeline.getBaseIndex()}},{key:"advance",value:function(e){if(!e)return 0;var t;if(e<0){if((t=Math.max(e,this.minIndex()-this.index))<0)return this.index+=t,t}else if((t=Math.min(e,this.maxIndex()-this.index))>0)return this.index+=t,t;var n=this.timeline.getNeighbouringTimeline(e<0?s.EventTimeline.BACKWARDS:s.EventTimeline.FORWARDS);return n?(this.timeline=n,this.index=e<0?this.maxIndex():this.minIndex(),u("paginate: switched to new neighbour"),this.advance(e)):0}},{key:"retreat",value:function(e){return-1*this.advance(-1*e)}}]),e}();t.TimelineIndex=l},function(e,t,n){"use strict";var r=n(8),i=n(6),o=n(7),a=n(2),s=n(0),u=n(11),c=n(9),l=n(10),d=n(25),f=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.InteractiveAuth=t.AuthType=void 0;var h=f(n(3)),p=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=g(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}r.default=e,n&&n.set(e,r);return r}(n(12)),v=n(5);function g(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(g=function(e){return e?n:t})(e)}var y,m="m.login.email.identity",k="m.login.msisdn";t.AuthType=y,function(e){e.Password="m.login.password",e.Recaptcha="m.login.recaptcha",e.Terms="m.login.terms",e.Email="m.login.email.identity",e.Msisdn="m.login.msisdn",e.Sso="m.login.sso",e.SsoUnstable="org.matrix.login.sso",e.Dummy="m.login.dummy"}(y||(t.AuthType=y={}));var b=function(e){c(n,e);var t=l(n);function n(e,r,i){var o;return s(this,n),(o=t.call(this,e)).required_stages=r,o.flows=i,(0,h.default)(u(o),"name","NoAuthFlowFoundError"),o}return n}(d(Error)),S=function(){function e(t){var n;s(this,e),(0,h.default)(this,"matrixClient",void 0),(0,h.default)(this,"inputs",void 0),(0,h.default)(this,"clientSecret",void 0),(0,h.default)(this,"requestCallback",void 0),(0,h.default)(this,"busyChangedCallback",void 0),(0,h.default)(this,"stateUpdatedCallback",void 0),(0,h.default)(this,"requestEmailTokenCallback",void 0),(0,h.default)(this,"data",void 0),(0,h.default)(this,"emailSid",void 0),(0,h.default)(this,"requestingEmailToken",!1),(0,h.default)(this,"attemptAuthDeferred",null),(0,h.default)(this,"chosenFlow",null),(0,h.default)(this,"currentStage",null),(0,h.default)(this,"submitPromise",null),this.matrixClient=t.matrixClient,this.data=t.authData||{},this.requestCallback=t.doRequest,this.busyChangedCallback=t.busyChanged,this.stateUpdatedCallback=t.stateUpdated||t.startAuthStage,this.requestEmailTokenCallback=t.requestEmailToken,this.inputs=t.inputs||{},t.sessionId&&(this.data.session=t.sessionId),this.clientSecret=t.clientSecret||this.matrixClient.generateClientSecret(),this.emailSid=null!==(n=t.emailSid)&&void 0!==n?n:null}return a(e,[{key:"attemptAuth",value:function(){var e,t=this;this.attemptAuthDeferred=(0,p.defer)();var n=this.attemptAuthDeferred.promise;if(null!==(e=this.data)&&void 0!==e&&e.flows)this.startNextAuthStage();else{var r;null===(r=this.busyChangedCallback)||void 0===r||r.call(this,!0);var i=null;this.data.session&&(i={session:this.data.session}),this.doRequest(i).finally((function(){var e;null===(e=t.busyChangedCallback)||void 0===e||e.call(t,!1)}))}return n}},{key:"poll",value:function(){var e=o(i.mark((function e(){var t,n,r;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.data.session){e.next=2;break}return e.abrupt("return");case 2:if(this.attemptAuthDeferred){e.next=4;break}return e.abrupt("return");case 4:if(!this.submitPromise){e.next=6;break}return e.abrupt("return");case 6:if(t={},this.currentStage!=m){e.next=16;break}if(!this.emailSid){e.next=16;break}return n={sid:this.emailSid,client_secret:this.clientSecret},e.next=12,this.matrixClient.doesServerRequireIdServerParam();case 12:if(!e.sent){e.next=15;break}r=new URL(this.matrixClient.getIdentityServerUrl()),n.id_server=r.host;case 15:t={type:m,threepid_creds:n,threepidCreds:n};case 16:this.submitAuthDict(t,!0);case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getSessionId",value:function(){return this.data?this.data.session:void 0}},{key:"getClientSecret",value:function(){return this.clientSecret}},{key:"getStageParams",value:function(e){var t;return null===(t=this.data.params)||void 0===t?void 0:t[e]}},{key:"getChosenFlow",value:function(){return this.chosenFlow}},{key:"submitAuthDict",value:function(){var e=o(i.mark((function e(t){var n,r,o,a,s=arguments;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.length>1&&void 0!==s[1]&&s[1],this.attemptAuthDeferred){e.next=3;break}throw new Error("submitAuthDict() called before attemptAuth()");case 3:n||null===(r=this.busyChangedCallback)||void 0===r||r.call(this,!0);case 4:if(!this.submitPromise){e.next=14;break}return e.prev=5,e.next=8,this.submitPromise;case 8:e.next=12;break;case 10:e.prev=10,e.t0=e.catch(5);case 12:e.next=4;break;case 14:return this.data.session?(o={session:this.data.session},p.extend(o,t)):o=t,e.prev=15,this.submitPromise=this.doRequest(o,n),e.next=19,this.submitPromise;case 19:return e.prev=19,this.submitPromise=null,n||null===(a=this.busyChangedCallback)||void 0===a||a.call(this,!1),e.finish(19);case 23:case"end":return e.stop()}}),e,this,[[5,10],[15,,19,23]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getEmailSid",value:function(){return this.emailSid}},{key:"setEmailSid",value:function(e){this.emailSid=e}},{key:"doRequest",value:function(){var e=o(i.mark((function e(t){var n,r,o,a,s,u,c,l,d=arguments;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=d.length>1&&void 0!==d[1]&&d[1],e.prev=1,e.next=4,this.requestCallback(t,n);case 4:r=e.sent,this.attemptAuthDeferred.resolve(r),this.attemptAuthDeferred=null,e.next=33;break;case 9:e.prev=9,e.t0=e.catch(1),s=null!==(o=null===(a=e.t0.data)||void 0===a?void 0:a.flows)&&void 0!==o?o:null,u=this.data.flows||Boolean(s),401===e.t0.httpStatus&&e.t0.data&&u||(n?v.logger.log("Background poll request failed doing UI auth: ignoring",e.t0):null===(c=this.attemptAuthDeferred)||void 0===c||c.reject(e.t0)),e.t0.data.flows||e.t0.data.completed||e.t0.data.session||(e.t0.data.flows=this.data.flows,e.t0.data.completed=this.data.completed,e.t0.data.session=this.data.session),this.data=e.t0.data;try{this.startNextAuthStage()}catch(i){this.attemptAuthDeferred.reject(i),this.attemptAuthDeferred=null}if(this.emailSid||this.requestingEmailToken||!this.chosenFlow.stages.includes(y.Email)){e.next=33;break}return this.requestingEmailToken=!0,e.prev=19,e.next=22,this.requestEmailTokenCallback(this.inputs.emailAddress,this.clientSecret,1,this.data.session);case 22:l=e.sent,this.emailSid=l.sid,e.next=30;break;case 26:e.prev=26,e.t1=e.catch(19),this.attemptAuthDeferred.reject(e.t1),this.attemptAuthDeferred=null;case 30:return e.prev=30,this.requestingEmailToken=!1,e.finish(30);case 33:case"end":return e.stop()}}),e,this,[[1,9],[19,26,30,33]])})));return function(t){return e.apply(this,arguments)}}()},{key:"startNextAuthStage",value:function(){var e=this.chooseStage();if(!e)throw new Error("No incomplete flows from the server");if(this.currentStage=e,e!==y.Dummy)if(this.data&&this.data.errcode||this.data.error)this.stateUpdatedCallback(e,{errcode:this.data.errcode||"",error:this.data.error||""});else{var t={};e==m&&(t.emailSid=this.emailSid),this.stateUpdatedCallback(e,t)}else this.submitAuthDict({type:"m.login.dummy"})}},{key:"chooseStage",value:function(){null===this.chosenFlow&&(this.chosenFlow=this.chooseFlow()),v.logger.log("Active flow => %s",JSON.stringify(this.chosenFlow));var e=this.firstUncompletedStage(this.chosenFlow);return v.logger.log("Next stage: %s",e),e}},{key:"chooseFlow",value:function(){var e,t=this.data.flows||[],n=Boolean(this.inputs.emailAddress)||Boolean(this.emailSid),i=Boolean(this.inputs.phoneCountry)&&Boolean(this.inputs.phoneNumber),o=r(t);try{for(o.s();!(e=o.n()).done;){var a,s=e.value,u=!1,c=!1,l=r(s.stages);try{for(l.s();!(a=l.n()).done;){var d=a.value;d===m?u=!0:d==k&&(c=!0)}}catch(h){l.e(h)}finally{l.f()}if(u==n&&c==i)return s}}catch(h){o.e(h)}finally{o.f()}var f=[];throw n&&f.push(m),i&&f.push(k),new b("No appropriate authentication flow found",f,t)}},{key:"firstUncompletedStage",value:function(e){for(var t=this.data.completed||[],n=0;n<e.stages.length;++n){var r=e.stages[n];if(-1===t.indexOf(r))return r}}}]),e}();t.InteractiveAuth=S},function(e,t,n){"use strict";var r=n(6),i=n(7),o=n(13),a=n(8),s=n(0),u=n(2),c=n(11),l=n(9),d=n(10),f=n(73),h=n(30),p=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedDBStore=void 0;var v=p(n(3)),g=n(15),y=n(67),m=n(162),k=n(163),b=n(31),S=n(18),w=n(5),E=function(e){l(n,e);var t=d(n);function n(e){var r,i,o,u,l;if(s(this,n),l=t.call(this,e),(0,v.default)(c(l),"backend",void 0),(0,v.default)(c(l),"startedUp",!1),(0,v.default)(c(l),"syncTs",0),(0,v.default)(c(l),"userModifiedMap",{}),(0,v.default)(c(l),"emitter",new g.EventEmitter),(0,v.default)(c(l),"on",l.emitter.on.bind(l.emitter)),(0,v.default)(c(l),"getSavedSync",l.degradable((function(){return l.backend.getSavedSync()}),"getSavedSync")),(0,v.default)(c(l),"isNewlyCreated",l.degradable((function(){return l.backend.isNewlyCreated()}),"isNewlyCreated")),(0,v.default)(c(l),"getSavedSyncToken",l.degradable((function(){return l.backend.getNextBatchToken()}),"getSavedSyncToken")),(0,v.default)(c(l),"deleteAllData",l.degradable((function(){return f((r=c(l),h(n.prototype)),"deleteAllData",r).call(r),l.backend.clearDatabase().then((function(){w.logger.log("Deleted indexeddb data.")}),(function(e){throw w.logger.error("Failed to delete indexeddb data: ".concat(e)),e}))}))),(0,v.default)(c(l),"reallySave",l.degradable((function(){l.syncTs=Date.now();var e,t=[],n=a(l.getUsers());try{for(n.s();!(e=n.n()).done;){var r=e.value;l.userModifiedMap[r.userId]!==r.getLastModifiedTime()&&(r.events.presence&&(t.push([r.userId,r.events.presence.event]),l.userModifiedMap[r.userId]=r.getLastModifiedTime()))}}catch(i){n.e(i)}finally{n.f()}return l.backend.syncToDatabase(t)}))),(0,v.default)(c(l),"setSyncData",l.degradable((function(e){return l.backend.setSyncData(e)}),"setSyncData")),(0,v.default)(c(l),"getOutOfBandMembers",l.degradable((function(e){return l.backend.getOutOfBandMembers(e)}),"getOutOfBandMembers")),(0,v.default)(c(l),"setOutOfBandMembers",l.degradable((function(e,t){return f((i=c(l),h(n.prototype)),"setOutOfBandMembers",i).call(i,e,t),l.backend.setOutOfBandMembers(e,t)}),"setOutOfBandMembers")),(0,v.default)(c(l),"clearOutOfBandMembers",l.degradable((function(e){return f((o=c(l),h(n.prototype)),"clearOutOfBandMembers",o).call(o,e),l.backend.clearOutOfBandMembers(e)}),"clearOutOfBandMembers")),(0,v.default)(c(l),"getClientOptions",l.degradable((function(){return l.backend.getClientOptions()}),"getClientOptions")),(0,v.default)(c(l),"storeClientOptions",l.degradable((function(e){return f((u=c(l),h(n.prototype)),"storeClientOptions",u).call(u,e),l.backend.storeClientOptions(e)}),"storeClientOptions")),!e.indexedDB)throw new Error("Missing required option: indexedDB");return e.workerFactory?l.backend=new k.RemoteIndexedDBStoreBackend(e.workerFactory,e.dbName):l.backend=new m.LocalIndexedDBStoreBackend(e.indexedDB,e.dbName),l}return u(n,[{key:"startup",value:function(){var e=this;return this.startedUp?(w.logger.log("IndexedDBStore.startup: already started"),Promise.resolve()):(w.logger.log("IndexedDBStore.startup: connecting to backend"),this.backend.connect().then((function(){return w.logger.log("IndexedDBStore.startup: loading presence events"),e.backend.getUserPresenceEvents()})).then((function(t){w.logger.log("IndexedDBStore.startup: processing presence events"),t.forEach((function(t){var n=o(t,2),r=n[0],i=n[1],a=new b.User(r);i&&a.setPresenceEvent(new S.MatrixEvent(i)),e.userModifiedMap[a.userId]=a.getLastModifiedTime(),e.storeUser(a)}))})))}},{key:"wantsSave",value:function(){return Date.now()-this.syncTs>3e5}},{key:"save",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e||this.wantsSave()?this.reallySave():Promise.resolve()}},{key:"degradable",value:function(e,t){var o=this,a=f(h(n.prototype),t,this);return i(r.mark((function t(){var n,i,s,u=arguments;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n=u.length,i=new Array(n),s=0;s<n;s++)i[s]=u[s];return t.prev=1,t.abrupt("return",e.call.apply(e,[o].concat(i)));case 5:return t.prev=5,t.t0=t.catch(1),w.logger.error("IndexedDBStore failure, degrading to MemoryStore",t.t0),o.emitter.emit("degraded",t.t0),t.prev=9,w.logger.log("IndexedDBStore trying to delete degraded data"),t.next=13,o.backend.clearDatabase();case 13:w.logger.log("IndexedDBStore delete after degrading succeeded"),t.next=19;break;case 16:t.prev=16,t.t1=t.catch(9),w.logger.warn("IndexedDBStore delete after degrading failed",t.t1);case 19:if(!a){t.next=21;break}return t.abrupt("return",a.apply(void 0,i));case 21:case"end":return t.stop()}}),t,null,[[1,5],[9,16]])})))}}],[{key:"exists",value:function(e,t){return m.LocalIndexedDBStoreBackend.exists(e,t)}}]),n}(y.MemoryStore);t.IndexedDBStore=E},function(e,t,n){"use strict";var r=n(8),i=n(6),o=n(7),a=n(13),s=n(0),u=n(2),c=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.LocalIndexedDBStoreBackend=void 0;var l=c(n(3)),d=n(51),f=g(n(12)),h=g(n(79)),p=n(5);function v(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(v=function(e){return e?n:t})(e)}function g(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=v(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}function y(e,t,n){var r=e.openCursor(t);return new Promise((function(e,t){var i=[];r.onerror=function(){t(new Error("Query failed: "+r.error))},r.onsuccess=function(){var t=r.result;t?(i.push(n(t)),t.continue()):e(i)}}))}function m(e){return new Promise((function(t,n){e.oncomplete=function(e){t(e)},e.onerror=function(){n(e.error)}}))}function k(e){return new Promise((function(t,n){e.onsuccess=function(e){t(e)},e.onerror=function(){n(e.error)}}))}function b(e){return new Promise((function(t,n){e.onsuccess=function(){return t(e)},e.onerror=function(e){return n(e)}}))}function S(e){return k(e).then((function(t){return e.result}))}var w=function(){function e(t,n){s(this,e),this.indexedDB=t,(0,l.default)(this,"dbName",void 0),(0,l.default)(this,"syncAccumulator",void 0),(0,l.default)(this,"db",null),(0,l.default)(this,"disconnected",!0),(0,l.default)(this,"_isNewlyCreated",!1),this.dbName="matrix-js-sdk:"+(n||"default"),this.syncAccumulator=new d.SyncAccumulator}return u(e,[{key:"connect",value:function(){var e=this;if(!this.disconnected)return p.logger.log("LocalIndexedDBStoreBackend.connect: already connected or connecting"),Promise.resolve();this.disconnected=!1,p.logger.log("LocalIndexedDBStoreBackend.connect: connecting...");var t=this.indexedDB.open(this.dbName,3);return t.onupgradeneeded=function(n){var r=t.result,i=n.oldVersion;p.logger.log("LocalIndexedDBStoreBackend.connect: upgrading from ".concat(i)),i<1&&(e._isNewlyCreated=!0,function(e){e.createObjectStore("users",{keyPath:["userId"]}),e.createObjectStore("accountData",{keyPath:["type"]}),e.createObjectStore("sync",{keyPath:["clobber"]})}(r)),i<2&&function(e){e.createObjectStore("oob_membership_events",{keyPath:["room_id","state_key"]}).createIndex("room","room_id")}(r),i<3&&function(e){e.createObjectStore("client_options",{keyPath:["clobber"]})}(r)},t.onblocked=function(){p.logger.log("can't yet open LocalIndexedDBStoreBackend because it is open elsewhere")},p.logger.log("LocalIndexedDBStoreBackend.connect: awaiting connection..."),k(t).then((function(){return p.logger.log("LocalIndexedDBStoreBackend.connect: connected"),e.db=t.result,e.db.onversionchange=function(){e.db.close()},e.init()}))}},{key:"isNewlyCreated",value:function(){return Promise.resolve(this._isNewlyCreated)}},{key:"init",value:function(){var e=this;return Promise.all([this.loadAccountData(),this.loadSyncData()]).then((function(t){var n=a(t,2),r=n[0],i=n[1];p.logger.log("LocalIndexedDBStoreBackend: loaded initial data"),e.syncAccumulator.accumulate({next_batch:i.nextBatch,rooms:i.roomsData,groups:i.groupsData,account_data:{events:r}},!0)}))}},{key:"getOutOfBandMembers",value:function(e){var t=this;return new Promise((function(n,r){var i=t.db.transaction(["oob_membership_events"],"readonly").objectStore("oob_membership_events").index("room"),o=IDBKeyRange.only(e),a=i.openCursor(o),s=[],u=!1;a.onsuccess=function(){var e=a.result;if(!e)return s.length||u?n(s):n(null);var t=e.value;t.oob_written?u=!0:s.push(t),e.continue()},a.onerror=function(e){r(e)}})).then((function(t){return p.logger.log("LL: got ".concat(t&&t.length," membershipEvents from storage for room ").concat(e," ...")),t}))}},{key:"setOutOfBandMembers",value:function(){var e=o(i.mark((function e(t,n){var r,o,a;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p.logger.log("LL: backend about to store ".concat(n.length)+" members for ".concat(t)),r=this.db.transaction(["oob_membership_events"],"readwrite"),o=r.objectStore("oob_membership_events"),n.forEach((function(e){o.put(e)})),a={room_id:t,oob_written:!0,state_key:0},o.put(a),e.next=8,m(r);case 8:p.logger.log("LL: backend done storing for ".concat(t,"!"));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"clearOutOfBandMembers",value:function(){var e=o(i.mark((function e(t){var n,r,o,s,u,c,l,d,f,h,v,g,y;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.db.transaction(["oob_membership_events"],"readonly"),r=n.objectStore("oob_membership_events"),o=r.index("room"),s=IDBKeyRange.only(t),u=S(o.openKeyCursor(s,"next")).then((function(e){return e&&e.primaryKey[1]})),c=S(o.openKeyCursor(s,"prev")).then((function(e){return e&&e.primaryKey[1]})),e.next=8,Promise.all([u,c]);case 8:return l=e.sent,d=a(l,2),f=d[0],h=d[1],v=this.db.transaction(["oob_membership_events"],"readwrite"),g=v.objectStore("oob_membership_events"),y=IDBKeyRange.bound([t,f],[t,h]),p.logger.log("LL: Deleting all users + marker in storage for room ".concat(t,", with key range:"),[t,f],[t,h]),e.next=18,b(g.delete(y));case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"clearDatabase",value:function(){var e=this;return new Promise((function(t){p.logger.log("Removing indexeddb instance: ".concat(e.dbName));var n=e.indexedDB.deleteDatabase(e.dbName);n.onblocked=function(){p.logger.log("can't yet delete indexeddb ".concat(e.dbName," because it is open elsewhere"))},n.onerror=function(){p.logger.warn("unable to delete js-sdk store indexeddb: ".concat(n.error)),t()},n.onsuccess=function(){p.logger.log("Removed indexeddb instance: ".concat(e.dbName)),t()}}))}},{key:"getSavedSync",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.syncAccumulator.getJSON();return t.nextBatch?e?Promise.resolve(f.deepCopy(t)):Promise.resolve(t):Promise.resolve(null)}},{key:"getNextBatchToken",value:function(){return Promise.resolve(this.syncAccumulator.getNextBatchToken())}},{key:"setSyncData",value:function(e){var t=this;return Promise.resolve().then((function(){t.syncAccumulator.accumulate(e)}))}},{key:"syncToDatabase",value:function(){var e=o(i.mark((function e(t){var n;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.syncAccumulator.getJSON(!0),e.next=3,Promise.all([this.persistUserPresenceEvents(t),this.persistAccountData(n.accountData),this.persistSyncData(n.nextBatch,n.roomsData,n.groupsData)]);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"persistSyncData",value:function(e,t,n){var r=this;return p.logger.log("Persisting sync data up to",e),f.promiseTry((function(){var i=r.db.transaction(["sync"],"readwrite");return i.objectStore("sync").put({clobber:"-",nextBatch:e,roomsData:t,groupsData:n}),m(i).then()}))}},{key:"persistAccountData",value:function(e){var t=this;return f.promiseTry((function(){for(var n=t.db.transaction(["accountData"],"readwrite"),r=n.objectStore("accountData"),i=0;i<e.length;i++)r.put(e[i]);return m(n).then()}))}},{key:"persistUserPresenceEvents",value:function(e){var t=this;return f.promiseTry((function(){var n,i=t.db.transaction(["users"],"readwrite"),o=i.objectStore("users"),a=r(e);try{for(a.s();!(n=a.n()).done;){var s=n.value;o.put({userId:s[0],event:s[1]})}}catch(u){a.e(u)}finally{a.f()}return m(i).then()}))}},{key:"getUserPresenceEvents",value:function(){var e=this;return f.promiseTry((function(){return y(e.db.transaction(["users"],"readonly").objectStore("users"),void 0,(function(e){return[e.value.userId,e.value.event]}))}))}},{key:"loadAccountData",value:function(){var e=this;return p.logger.log("LocalIndexedDBStoreBackend: loading account data..."),f.promiseTry((function(){return y(e.db.transaction(["accountData"],"readonly").objectStore("accountData"),void 0,(function(e){return e.value})).then((function(e){return p.logger.log("LocalIndexedDBStoreBackend: loaded account data"),e}))}))}},{key:"loadSyncData",value:function(){var e=this;return p.logger.log("LocalIndexedDBStoreBackend: loading sync data..."),f.promiseTry((function(){return y(e.db.transaction(["sync"],"readonly").objectStore("sync"),void 0,(function(e){return e.value})).then((function(e){return p.logger.log("LocalIndexedDBStoreBackend: loaded sync data"),e.length>1&&p.logger.warn("loadSyncData: More than 1 sync row found."),e.length>0?e[0]:{}}))}))}},{key:"getClientOptions",value:function(){var e=this;return Promise.resolve().then((function(){return y(e.db.transaction(["client_options"],"readonly").objectStore("client_options"),void 0,(function(e){if(e.value&&e.value&&e.value.options)return e.value.options})).then((function(e){return e[0]}))}))}},{key:"storeClientOptions",value:function(){var e=o(i.mark((function e(t){var n;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.db.transaction(["client_options"],"readwrite"),n.objectStore("client_options").put({clobber:"-",options:t}),e.next=5,m(n);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"exists",value:function(e,t){return t="matrix-js-sdk:"+(t||"default"),h.exists(e,t)}}]),e}();t.LocalIndexedDBStoreBackend=w},function(e,t,n){"use strict";var r=n(0),i=n(2),o=n(1);Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteIndexedDBStoreBackend=void 0;var a=o(n(3)),s=n(5),u=n(12),c=function(){function e(t,n){var i=this;r(this,e),this.workerFactory=t,this.dbName=n,(0,a.default)(this,"worker",void 0),(0,a.default)(this,"nextSeq",0),(0,a.default)(this,"inFlight",{}),(0,a.default)(this,"startPromise",null),(0,a.default)(this,"onWorkerMessage",(function(e){var t=e.data;if("cmd_success"==t.command||"cmd_fail"==t.command){if(void 0===t.seq)return void s.logger.error("Got reply from worker with no seq");var n=i.inFlight[t.seq];if(void 0===n)return void s.logger.error("Got reply for unknown seq "+t.seq);if(delete i.inFlight[t.seq],"cmd_success"==t.command)n.resolve(t.result);else{var r=new Error(t.error.message);r.name=t.error.name,n.reject(r)}}else s.logger.warn("Unrecognised message from worker: ",t)}))}return i(e,[{key:"connect",value:function(){var e=this;return this.ensureStarted().then((function(){return e.doCmd("connect")}))}},{key:"clearDatabase",value:function(){var e=this;return this.ensureStarted().then((function(){return e.doCmd("clearDatabase")}))}},{key:"isNewlyCreated",value:function(){return this.doCmd("isNewlyCreated")}},{key:"getSavedSync",value:function(){return this.doCmd("getSavedSync")}},{key:"getNextBatchToken",value:function(){return this.doCmd("getNextBatchToken")}},{key:"setSyncData",value:function(e){return this.doCmd("setSyncData",[e])}},{key:"syncToDatabase",value:function(e){return this.doCmd("syncToDatabase",[e])}},{key:"getOutOfBandMembers",value:function(e){return this.doCmd("getOutOfBandMembers",[e])}},{key:"setOutOfBandMembers",value:function(e,t){return this.doCmd("setOutOfBandMembers",[e,t])}},{key:"clearOutOfBandMembers",value:function(e){return this.doCmd("clearOutOfBandMembers",[e])}},{key:"getClientOptions",value:function(){return this.doCmd("getClientOptions")}},{key:"storeClientOptions",value:function(e){return this.doCmd("storeClientOptions",[e])}},{key:"getUserPresenceEvents",value:function(){return this.doCmd("getUserPresenceEvents")}},{key:"ensureStarted",value:function(){return null===this.startPromise&&(this.worker=this.workerFactory(),this.worker.onmessage=this.onWorkerMessage,this.startPromise=this.doCmd("_setupWorker",[this.dbName]).then((function(){s.logger.log("IndexedDB worker is ready")}))),this.startPromise}},{key:"doCmd",value:function(e,t){var n=this;return Promise.resolve().then((function(){var r=n.nextSeq++,i=(0,u.defer)();return n.inFlight[r]=i,n.worker.postMessage({command:e,seq:r,args:t}),i.promise}))}}]),e}();t.RemoteIndexedDBStoreBackend=c},function(e,t,n){"use strict";var r=n(8);Object.defineProperty(t,"__esModule",{value:!0}),t.WebStorageSessionStore=s;var i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=o(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(12));n(5);function o(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(o=function(e){return e?n:t})(e)}var a="session.e2e.";function s(e){if(this.store=e,!i.isFunction(e.getItem)||!i.isFunction(e.setItem)||!i.isFunction(e.removeItem)||!i.isFunction(e.key)||"number"!==typeof e.length)throw new Error("Supplied webStore does not meet the WebStorage API interface")}s.prototype={removeEndToEndAccount:function(){this.store.removeItem(u)},getEndToEndAccount:function(){return this.store.getItem(u)},getAllEndToEndDevices:function(){for(var e=f(""),t={},n=0;n<this.store.length;++n){var r=this.store.key(n),i=r.substr(e.length);r.startsWith(e)&&(t[i]=v(this.store,r))}return t},getEndToEndDeviceTrackingStatus:function(){return v(this.store,l)},getEndToEndDeviceSyncToken:function(){return v(this.store,c)},removeEndToEndDeviceData:function(){y(this.store,f("")),y(this.store,l),y(this.store,c)},getEndToEndSessions:function(e){return v(this.store,h(e))},getAllEndToEndSessions:function(){var e,t=g(this.store,h("")),n={},i=r(t);try{for(i.s();!(e=i.n()).done;){var o=e.value;n[o.substr(h("").length)]=v(this.store,o)}}catch(a){i.e(a)}finally{i.f()}return n},removeAllEndToEndSessions:function(){y(this.store,h(""))},getAllEndToEndInboundGroupSessionKeys:function(){for(var e=a+"inboundgroupsessions/",t=[],n=0;n<this.store.length;n++){var r=this.store.key(n);r.startsWith(e)&&t.push({senderKey:r.substr(e.length,43),sessionId:r.substr(e.length+44)})}return t},getEndToEndInboundGroupSession:function(e,t){var n=function(e,t){return a+"inboundgroupsessions/"+e+"/"+t}(e,t);return this.store.getItem(n)},removeAllEndToEndInboundGroupSessions:function(){y(this.store,a+"inboundgroupsessions/")},getAllEndToEndRooms:function(){var e,t=g(this.store,p("")),n={},i=r(t);try{for(i.s();!(e=i.n()).done;){var o=e.value;n[o.substr(p("").length)]=v(this.store,o)}}catch(a){i.e(a)}finally{i.f()}return n},removeAllEndToEndRooms:function(){y(this.store,p(""))},setLocalTrustedBackupPubKey:function(e){this.store.setItem(d,e)},getLocalTrustedBackupPubKey:function(){return this.store.getItem(d)}};var u=a+"account",c=a+"device_sync_token",l=a+"device_tracking",d=a+"trusted_backup_pubkey";function f(e){return a+"devices/"+e}function h(e){return a+"sessions/"+e}function p(e){return a+"rooms/"+e}function v(e,t){try{return JSON.parse(e.getItem(t))}catch(n){m("Failed to get key %s: %s",t,n),m(n.stack)}return null}function g(e,t){for(var n=[],r=0;r<e.length;++r){var i=e.key(r);i.startsWith(t)&&n.push(i)}return n}function y(e,t){for(var n=[],r=0;r<e.length;++r){var i=e.key(r);i.startsWith(t)&&n.push(i)}for(var o=0,a=n;o<a.length;o++){var s=a[o];e.removeItem(s)}}function m(){}},function(e,t,n){var r,i,o;i=[],void 0===(o="function"===typeof(r=function(){var e=XMLHttpRequest;if(!e)throw new Error("missing XMLHttpRequest");n.log={trace:o,debug:o,info:o,warn:o,error:o};var t=18e4;function n(e,t){if("function"!==typeof t)throw new Error("Bad callback given: "+t);if(!e)throw new Error("No options given");var r=e.onResponse;if((e="string"===typeof e?{uri:e}:JSON.parse(JSON.stringify(e))).onResponse=r,e.verbose&&(n.log=a()),e.url&&(e.uri=e.url,delete e.url),!e.uri&&""!==e.uri)throw new Error("options.uri is a required argument");if("string"!=typeof e.uri)throw new Error("options.uri must be a string");for(var s=["proxy","_redirectsFollowed","maxRedirects","followRedirect"],u=0;u<s.length;u++)if(e[s[u]])throw new Error("options."+s[u]+" is not supported");if(e.callback=t,e.method=e.method||"GET",e.headers=e.headers||{},e.body=e.body||null,e.timeout=e.timeout||n.DEFAULT_TIMEOUT,e.headers.host)throw new Error("Options.headers.host is not supported");e.json&&(e.headers.accept=e.headers.accept||"application/json","GET"!==e.method&&(e.headers["content-type"]="application/json"),"boolean"!==typeof e.json?e.body=JSON.stringify(e.json):"string"!==typeof e.body&&(e.body=JSON.stringify(e.body)));var l=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")};if(e.qs){var d="string"==typeof e.qs?e.qs:l(e.qs);-1!==e.uri.indexOf("?")?e.uri=e.uri+"&"+d:e.uri=e.uri+"?"+d}var f=function(e){var t={};t.boundry="-------------------------------"+Math.floor(1e9*Math.random());var n=[];for(var r in e)e.hasOwnProperty(r)&&n.push("--"+t.boundry+'\nContent-Disposition: form-data; name="'+r+'"\n\n'+e[r]+"\n");return n.push("--"+t.boundry+"--"),t.body=n.join(""),t.length=t.body.length,t.type="multipart/form-data; boundary="+t.boundry,t};if(e.form){if("string"==typeof e.form)throw"form name unsupported";if("POST"===e.method){var h=(e.encoding||"application/x-www-form-urlencoded").toLowerCase();switch(e.headers["content-type"]=h,h){case"application/x-www-form-urlencoded":e.body=l(e.form).replace(/%20/g,"+");break;case"multipart/form-data":var p=f(e.form);e.body=p.body,e.headers["content-type"]=p.type;break;default:throw new Error("unsupported encoding:"+h)}}}return e.onResponse=e.onResponse||o,!0===e.onResponse&&(e.onResponse=t,e.callback=o),!e.headers.authorization&&e.auth&&(e.headers.authorization="Basic "+c(e.auth.username+":"+e.auth.password)),i(e)}var r=0;function i(t){var i=new e,o=!1,a=u(t.uri),s="withCredentials"in i;if(r+=1,i.seq_id=r,i.id=r+": "+t.method+" "+t.uri,i._id=i.id,a&&!s){var c=new Error("Browser does not support cross-origin request: "+t.uri);return c.cors="unsupported",t.callback(c,i)}function l(){o=!0;var e=new Error("ETIMEDOUT");return e.code="ETIMEDOUT",e.duration=t.timeout,n.log.error("Timeout",{id:i._id,milliseconds:t.timeout}),t.callback(e,i)}i.timeoutTimer=setTimeout(l,t.timeout);var d={response:!1,loading:!1,end:!1};return i.onreadystatechange=f,i.open(t.method,t.uri,!0),a&&(i.withCredentials=!!t.withCredentials),i.send(t.body),i;function f(r){if(o)return n.log.debug("Ignoring timed out state change",{state:i.readyState,id:i.id});if(n.log.debug("State change",{state:i.readyState,id:i.id,timed_out:o}),i.readyState===e.OPENED)for(var a in n.log.debug("Request started",{id:i.id}),t.headers)i.setRequestHeader(a,t.headers[a]);else i.readyState===e.HEADERS_RECEIVED?h():i.readyState===e.LOADING?(h(),p()):i.readyState===e.DONE&&(h(),p(),v())}function h(){if(!d.response){if(d.response=!0,n.log.debug("Got response",{id:i.id,status:i.status}),clearTimeout(i.timeoutTimer),i.statusCode=i.status,a&&0==i.statusCode){var e=new Error("CORS request rejected: "+t.uri);return e.cors="rejected",d.loading=!0,d.end=!0,t.callback(e,i)}t.onResponse(null,i)}}function p(){d.loading||(d.loading=!0,n.log.debug("Response body loading",{id:i.id}))}function v(){if(!d.end){if(d.end=!0,n.log.debug("Request done",{id:i.id}),i.body=i.responseText,t.json)try{i.body=JSON.parse(i.responseText)}catch(e){return t.callback(e,i)}t.callback(null,i,i.body)}}}function o(){}function a(){var e,t,n={},r=["trace","debug","info","warn","error"];for(t=0;t<r.length;t++)n[e=r[t]]=o,"undefined"!==typeof console&&console&&console[e]&&(n[e]=s(console,e));return n}function s(e,t){return n;function n(n,r){return"object"===typeof r&&(n+=" "+JSON.stringify(r)),e[t].call(e,n)}}function u(e){var t,n=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;try{t=location.href}catch(o){(t=document.createElement("a")).href="",t=t.href}var r=n.exec(t.toLowerCase())||[],i=n.exec(e.toLowerCase());return!(!i||i[1]==r[1]&&i[2]==r[2]&&(i[3]||("http:"===i[1]?80:443))==(r[3]||("http:"===r[1]?80:443)))}function c(e){var t,n,r,i,o,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s=0,u=0,c="",l=[];if(!e)return e;do{t=(o=e.charCodeAt(s++)<<16|e.charCodeAt(s++)<<8|e.charCodeAt(s++))>>18&63,n=o>>12&63,r=o>>6&63,i=63&o,l[u++]=a.charAt(t)+a.charAt(n)+a.charAt(r)+a.charAt(i)}while(s<e.length);switch(c=l.join(""),e.length%3){case 1:c=c.slice(0,-2)+"==";break;case 2:c=c.slice(0,-1)+"="}return c}return n.withCredentials=!1,n.DEFAULT_TIMEOUT=t,n.defaults=function(e,t){var r=function(t){return function(n,r){for(var i in n="string"===typeof n?{uri:n}:JSON.parse(JSON.stringify(n)),e)void 0===n[i]&&(n[i]=e[i]);return t(n,r)}},i=r(n);return i.get=r(n.get),i.post=r(n.post),i.put=r(n.put),i.head=r(n.head),i},["get","put","post","head"].forEach((function(e){var t=e.toUpperCase();n[e.toLowerCase()]=function(e){"string"===typeof e?e={method:t,uri:e}:(e=JSON.parse(JSON.stringify(e))).method=t;var r=[e].concat(Array.prototype.slice.apply(arguments,[1]));return n.apply(this,r)}})),n.couch=function(e,t){return"string"===typeof e&&(e={uri:e}),e.json=!0,e.body&&(e.json=e.body),delete e.body,t=t||o,n(e,r);function r(e,n,r){if(e)return t(e,n,r);if((n.statusCode<200||n.statusCode>299)&&r.error){for(var i in e=new Error("CouchDB error: "+(r.error.reason||r.error.error)),r)e[i]=r[i];return t(e,n,r)}return t(e,n,r)}},n})?r.apply(t,i):r)||(e.exports=o)},function(e,t,n){"use strict";var r=n(167),i=n(177),o=n(61);e.exports={formats:o,parse:i,stringify:r}},function(e,t,n){"use strict";var r=n(168),i=n(88),o=n(61),a=Object.prototype.hasOwnProperty,s={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},u=Array.isArray,c=Array.prototype.push,l=function(e,t){c.apply(e,u(t)?t:[t])},d=Date.prototype.toISOString,f=o.default,h={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:i.encode,encodeValuesOnly:!1,format:f,formatter:o.formatters[f],indices:!1,serializeDate:function(e){return d.call(e)},skipNulls:!1,strictNullHandling:!1},p=function e(t,n,o,a,s,c,d,f,p,v,g,y,m,k,b){var S,w=t;if(b.has(t))throw new RangeError("Cyclic object value");if("function"===typeof d?w=d(n,w):w instanceof Date?w=v(w):"comma"===o&&u(w)&&(w=i.maybeMap(w,(function(e){return e instanceof Date?v(e):e}))),null===w){if(a)return c&&!m?c(n,h.encoder,k,"key",g):n;w=""}if("string"===typeof(S=w)||"number"===typeof S||"boolean"===typeof S||"symbol"===typeof S||"bigint"===typeof S||i.isBuffer(w))return c?[y(m?n:c(n,h.encoder,k,"key",g))+"="+y(c(w,h.encoder,k,"value",g))]:[y(n)+"="+y(String(w))];var E,_=[];if("undefined"===typeof w)return _;if("comma"===o&&u(w))E=[{value:w.length>0?w.join(",")||null:void 0}];else if(u(d))E=d;else{var x=Object.keys(w);E=f?x.sort(f):x}for(var I=0;I<E.length;++I){var T=E[I],R="object"===typeof T&&void 0!==T.value?T.value:w[T];if(!s||null!==R){var O=u(w)?"function"===typeof o?o(n,T):n:n+(p?"."+T:"["+T+"]");b.set(t,!0);var C=r();l(_,e(R,O,o,a,s,c,d,f,p,v,g,y,m,k,C))}}return _};e.exports=function(e,t){var n,i=e,c=function(e){if(!e)return h;if(null!==e.encoder&&void 0!==e.encoder&&"function"!==typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||h.charset;if("undefined"!==typeof e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=o.default;if("undefined"!==typeof e.format){if(!a.call(o.formatters,e.format))throw new TypeError("Unknown format option provided.");n=e.format}var r=o.formatters[n],i=h.filter;return("function"===typeof e.filter||u(e.filter))&&(i=e.filter),{addQueryPrefix:"boolean"===typeof e.addQueryPrefix?e.addQueryPrefix:h.addQueryPrefix,allowDots:"undefined"===typeof e.allowDots?h.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"===typeof e.charsetSentinel?e.charsetSentinel:h.charsetSentinel,delimiter:"undefined"===typeof e.delimiter?h.delimiter:e.delimiter,encode:"boolean"===typeof e.encode?e.encode:h.encode,encoder:"function"===typeof e.encoder?e.encoder:h.encoder,encodeValuesOnly:"boolean"===typeof e.encodeValuesOnly?e.encodeValuesOnly:h.encodeValuesOnly,filter:i,format:n,formatter:r,serializeDate:"function"===typeof e.serializeDate?e.serializeDate:h.serializeDate,skipNulls:"boolean"===typeof e.skipNulls?e.skipNulls:h.skipNulls,sort:"function"===typeof e.sort?e.sort:null,strictNullHandling:"boolean"===typeof e.strictNullHandling?e.strictNullHandling:h.strictNullHandling}}(t);"function"===typeof c.filter?i=(0,c.filter)("",i):u(c.filter)&&(n=c.filter);var d,f=[];if("object"!==typeof i||null===i)return"";d=t&&t.arrayFormat in s?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var v=s[d];n||(n=Object.keys(i)),c.sort&&n.sort(c.sort);for(var g=r(),y=0;y<n.length;++y){var m=n[y];c.skipNulls&&null===i[m]||l(f,p(i[m],m,v,c.strictNullHandling,c.skipNulls,c.encode?c.encoder:null,c.filter,c.sort,c.allowDots,c.serializeDate,c.format,c.formatter,c.encodeValuesOnly,c.charset,g))}var k=f.join(c.delimiter),b=!0===c.addQueryPrefix?"?":"";return c.charsetSentinel&&("iso-8859-1"===c.charset?b+="utf8=%26%2310003%3B&":b+="utf8=%E2%9C%93&"),k.length>0?b+k:""}},function(e,t,n){"use strict";var r=n(59),i=n(173),o=n(175),a=r("%TypeError%"),s=r("%WeakMap%",!0),u=r("%Map%",!0),c=i("WeakMap.prototype.get",!0),l=i("WeakMap.prototype.set",!0),d=i("WeakMap.prototype.has",!0),f=i("Map.prototype.get",!0),h=i("Map.prototype.set",!0),p=i("Map.prototype.has",!0),v=function(e,t){for(var n,r=e;null!==(n=r.next);r=n)if(n.key===t)return r.next=n.next,n.next=e.next,e.next=n,n};e.exports=function(){var e,t,n,r={assert:function(e){if(!r.has(e))throw new a("Side channel does not contain "+o(e))},get:function(r){if(s&&r&&("object"===typeof r||"function"===typeof r)){if(e)return c(e,r)}else if(u){if(t)return f(t,r)}else if(n)return function(e,t){var n=v(e,t);return n&&n.value}(n,r)},has:function(r){if(s&&r&&("object"===typeof r||"function"===typeof r)){if(e)return d(e,r)}else if(u){if(t)return p(t,r)}else if(n)return function(e,t){return!!v(e,t)}(n,r);return!1},set:function(r,i){s&&r&&("object"===typeof r||"function"===typeof r)?(e||(e=new s),l(e,r,i)):u?(t||(t=new u),h(t,r,i)):(n||(n={key:{},next:null}),function(e,t,n){var r=v(e,t);r?r.value=n:e.next={key:t,next:e.next,value:n}}(n,r,i))}};return r}},function(e,t,n){"use strict";var r="undefined"!==typeof Symbol&&Symbol,i=n(170);e.exports=function(){return"function"===typeof r&&("function"===typeof Symbol&&("symbol"===typeof r("foo")&&("symbol"===typeof Symbol("bar")&&i())))}},function(e,t,n){"use strict";e.exports=function(){if("function"!==typeof Symbol||"function"!==typeof Object.getOwnPropertySymbols)return!1;if("symbol"===typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"===typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(t in e[t]=42,e)return!1;if("function"===typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"===typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var r=Object.getOwnPropertySymbols(e);if(1!==r.length||r[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"===typeof Object.getOwnPropertyDescriptor){var i=Object.getOwnPropertyDescriptor(e,t);if(42!==i.value||!0!==i.enumerable)return!1}return!0}},function(e,t,n){"use strict";var r="Function.prototype.bind called on incompatible ",i=Array.prototype.slice,o=Object.prototype.toString,a="[object Function]";e.exports=function(e){var t=this;if("function"!==typeof t||o.call(t)!==a)throw new TypeError(r+t);for(var n,s=i.call(arguments,1),u=function(){if(this instanceof n){var r=t.apply(this,s.concat(i.call(arguments)));return Object(r)===r?r:this}return t.apply(e,s.concat(i.call(arguments)))},c=Math.max(0,t.length-s.length),l=[],d=0;d<c;d++)l.push("$"+d);if(n=Function("binder","return function ("+l.join(",")+"){ return binder.apply(this,arguments); }")(u),t.prototype){var f=function(){};f.prototype=t.prototype,n.prototype=new f,f.prototype=null}return n}},function(e,t,n){"use strict";var r=n(60);e.exports=r.call(Function.call,Object.prototype.hasOwnProperty)},function(e,t,n){"use strict";var r=n(59),i=n(174),o=i(r("String.prototype.indexOf"));e.exports=function(e,t){var n=r(e,!!t);return"function"===typeof n&&o(e,".prototype.")>-1?i(n):n}},function(e,t,n){"use strict";var r=n(60),i=n(59),o=i("%Function.prototype.apply%"),a=i("%Function.prototype.call%"),s=i("%Reflect.apply%",!0)||r.call(a,o),u=i("%Object.getOwnPropertyDescriptor%",!0),c=i("%Object.defineProperty%",!0),l=i("%Math.max%");if(c)try{c({},"a",{value:1})}catch(f){c=null}e.exports=function(e){var t=s(r,a,arguments);if(u&&c){var n=u(t,"length");n.configurable&&c(t,"length",{value:1+l(0,e.length-(arguments.length-1))})}return t};var d=function(){return s(r,o,arguments)};c?c(e.exports,"apply",{value:d}):e.exports.apply=d},function(e,t,n){var r="function"===typeof Map&&Map.prototype,i=Object.getOwnPropertyDescriptor&&r?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,o=r&&i&&"function"===typeof i.get?i.get:null,a=r&&Map.prototype.forEach,s="function"===typeof Set&&Set.prototype,u=Object.getOwnPropertyDescriptor&&s?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,c=s&&u&&"function"===typeof u.get?u.get:null,l=s&&Set.prototype.forEach,d="function"===typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,f="function"===typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,h=Boolean.prototype.valueOf,p=Object.prototype.toString,v=Function.prototype.toString,g=String.prototype.match,y="function"===typeof BigInt?BigInt.prototype.valueOf:null,m=Object.getOwnPropertySymbols,k="function"===typeof Symbol?Symbol.prototype.toString:null,b=Object.prototype.propertyIsEnumerable,S=n(176).custom,w=S&&I(S)?S:null;function E(e,t,n){var r="double"===(n.quoteStyle||t)?'"':"'";return r+e+r}function _(e){return String(e).replace(/"/g,"&quot;")}function x(e){return"[object Array]"===O(e)}function I(e){return"[object Symbol]"===O(e)}e.exports=function e(t,n,r,i){var s=n||{};if(R(s,"quoteStyle")&&"single"!==s.quoteStyle&&"double"!==s.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(R(s,"maxStringLength")&&("number"===typeof s.maxStringLength?s.maxStringLength<0&&s.maxStringLength!==1/0:null!==s.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var u=!R(s,"customInspect")||s.customInspect;if("boolean"!==typeof u)throw new TypeError('option "customInspect", if provided, must be `true` or `false`');if(R(s,"indent")&&null!==s.indent&&"\t"!==s.indent&&!(parseInt(s.indent,10)===s.indent&&s.indent>0))throw new TypeError('options "indent" must be "\\t", an integer > 0, or `null`');if("undefined"===typeof t)return"undefined";if(null===t)return"null";if("boolean"===typeof t)return t?"true":"false";if("string"===typeof t)return P(t,s);if("number"===typeof t)return 0===t?1/0/t>0?"0":"-0":String(t);if("bigint"===typeof t)return String(t)+"n";var p="undefined"===typeof s.depth?5:s.depth;if("undefined"===typeof r&&(r=0),r>=p&&p>0&&"object"===typeof t)return x(t)?"[Array]":"[Object]";var m=function(e,t){var n;if("\t"===e.indent)n="\t";else{if(!("number"===typeof e.indent&&e.indent>0))return null;n=Array(e.indent+1).join(" ")}return{base:n,prev:Array(t+1).join(n)}}(s,r);if("undefined"===typeof i)i=[];else if(C(i,t)>=0)return"[Circular]";function b(t,n,o){if(n&&(i=i.slice()).push(n),o){var a={depth:s.depth};return R(s,"quoteStyle")&&(a.quoteStyle=s.quoteStyle),e(t,a,r+1,i)}return e(t,s,r+1,i)}if("function"===typeof t){var S=function(e){if(e.name)return e.name;var t=g.call(v.call(e),/^function\s*([\w$]+)/);if(t)return t[1];return null}(t),T=L(t,b);return"[Function"+(S?": "+S:" (anonymous)")+"]"+(T.length>0?" { "+T.join(", ")+" }":"")}if(I(t)){var D=k.call(t);return"object"===typeof t?A(D):D}if(function(e){if(!e||"object"!==typeof e)return!1;if("undefined"!==typeof HTMLElement&&e instanceof HTMLElement)return!0;return"string"===typeof e.nodeName&&"function"===typeof e.getAttribute}(t)){for(var j="<"+String(t.nodeName).toLowerCase(),B=t.attributes||[],K=0;K<B.length;K++)j+=" "+B[K].name+"="+E(_(B[K].value),"double",s);return j+=">",t.childNodes&&t.childNodes.length&&(j+="..."),j+="</"+String(t.nodeName).toLowerCase()+">"}if(x(t)){if(0===t.length)return"[]";var F=L(t,b);return m&&!function(e){for(var t=0;t<e.length;t++)if(C(e[t],"\n")>=0)return!1;return!0}(F)?"["+N(F,m)+"]":"[ "+F.join(", ")+" ]"}if(function(e){return"[object Error]"===O(e)}(t)){var q=L(t,b);return 0===q.length?"["+String(t)+"]":"{ ["+String(t)+"] "+q.join(", ")+" }"}if("object"===typeof t&&u){if(w&&"function"===typeof t[w])return t[w]();if("function"===typeof t.inspect)return t.inspect()}if(function(e){if(!o||!e||"object"!==typeof e)return!1;try{o.call(e);try{c.call(e)}catch(j){return!0}return e instanceof Map}catch(t){}return!1}(t)){var V=[];return a.call(t,(function(e,n){V.push(b(n,t,!0)+" => "+b(e,t))})),U("Map",o.call(t),V,m)}if(function(e){if(!c||!e||"object"!==typeof e)return!1;try{c.call(e);try{o.call(e)}catch(t){return!0}return e instanceof Set}catch(n){}return!1}(t)){var G=[];return l.call(t,(function(e){G.push(b(e,t))})),U("Set",c.call(t),G,m)}if(function(e){if(!d||!e||"object"!==typeof e)return!1;try{d.call(e,d);try{f.call(e,f)}catch(j){return!0}return e instanceof WeakMap}catch(t){}return!1}(t))return M("WeakMap");if(function(e){if(!f||!e||"object"!==typeof e)return!1;try{f.call(e,f);try{d.call(e,d)}catch(j){return!0}return e instanceof WeakSet}catch(t){}return!1}(t))return M("WeakSet");if(function(e){return"[object Number]"===O(e)}(t))return A(b(Number(t)));if(function(e){return"[object BigInt]"===O(e)}(t))return A(b(y.call(t)));if(function(e){return"[object Boolean]"===O(e)}(t))return A(h.call(t));if(function(e){return"[object String]"===O(e)}(t))return A(b(String(t)));if(!function(e){return"[object Date]"===O(e)}(t)&&!function(e){return"[object RegExp]"===O(e)}(t)){var W=L(t,b);return 0===W.length?"{}":m?"{"+N(W,m)+"}":"{ "+W.join(", ")+" }"}return String(t)};var T=Object.prototype.hasOwnProperty||function(e){return e in this};function R(e,t){return T.call(e,t)}function O(e){return p.call(e)}function C(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}function P(e,t){if(e.length>t.maxStringLength){var n=e.length-t.maxStringLength,r="... "+n+" more character"+(n>1?"s":"");return P(e.slice(0,t.maxStringLength),t)+r}return E(e.replace(/(['\\])/g,"\\$1").replace(/[\x00-\x1f]/g,D),"single",t)}function D(e){var t=e.charCodeAt(0),n={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return n?"\\"+n:"\\x"+(t<16?"0":"")+t.toString(16).toUpperCase()}function A(e){return"Object("+e+")"}function M(e){return e+" { ? }"}function U(e,t,n,r){return e+" ("+t+") {"+(r?N(n,r):n.join(", "))+"}"}function N(e,t){if(0===e.length)return"";var n="\n"+t.prev+t.base;return n+e.join(","+n)+"\n"+t.prev}function L(e,t){var n=x(e),r=[];if(n){r.length=e.length;for(var i=0;i<e.length;i++)r[i]=R(e,i)?t(e[i],e):""}for(var o in e)R(e,o)&&(n&&String(Number(o))===o&&o<e.length||(/[^\w$]/.test(o)?r.push(t(o,e)+": "+t(e[o],e)):r.push(o+": "+t(e[o],e))));if("function"===typeof m)for(var a=m(e),s=0;s<a.length;s++)b.call(e,a[s])&&r.push("["+t(a[s])+"]: "+t(e[a[s]],e));return r}},,function(e,t,n){"use strict";var r=n(88),i=Object.prototype.hasOwnProperty,o=Array.isArray,a={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:r.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},s=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},u=function(e,t){return e&&"string"===typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},c=function(e,t,n,r){if(e){var o=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,a=/(\[[^[\]]*])/g,s=n.depth>0&&/(\[[^[\]]*])/.exec(o),c=s?o.slice(0,s.index):o,l=[];if(c){if(!n.plainObjects&&i.call(Object.prototype,c)&&!n.allowPrototypes)return;l.push(c)}for(var d=0;n.depth>0&&null!==(s=a.exec(o))&&d<n.depth;){if(d+=1,!n.plainObjects&&i.call(Object.prototype,s[1].slice(1,-1))&&!n.allowPrototypes)return;l.push(s[1])}return s&&l.push("["+o.slice(s.index)+"]"),function(e,t,n,r){for(var i=r?t:u(t,n),o=e.length-1;o>=0;--o){var a,s=e[o];if("[]"===s&&n.parseArrays)a=[].concat(i);else{a=n.plainObjects?Object.create(null):{};var c="["===s.charAt(0)&&"]"===s.charAt(s.length-1)?s.slice(1,-1):s,l=parseInt(c,10);n.parseArrays||""!==c?!isNaN(l)&&s!==c&&String(l)===c&&l>=0&&n.parseArrays&&l<=n.arrayLimit?(a=[])[l]=i:a[c]=i:a={0:i}}i=a}return i}(l,t,n,r)}};e.exports=function(e,t){var n=function(e){if(!e)return a;if(null!==e.decoder&&void 0!==e.decoder&&"function"!==typeof e.decoder)throw new TypeError("Decoder has to be a function.");if("undefined"!==typeof e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t="undefined"===typeof e.charset?a.charset:e.charset;return{allowDots:"undefined"===typeof e.allowDots?a.allowDots:!!e.allowDots,allowPrototypes:"boolean"===typeof e.allowPrototypes?e.allowPrototypes:a.allowPrototypes,allowSparse:"boolean"===typeof e.allowSparse?e.allowSparse:a.allowSparse,arrayLimit:"number"===typeof e.arrayLimit?e.arrayLimit:a.arrayLimit,charset:t,charsetSentinel:"boolean"===typeof e.charsetSentinel?e.charsetSentinel:a.charsetSentinel,comma:"boolean"===typeof e.comma?e.comma:a.comma,decoder:"function"===typeof e.decoder?e.decoder:a.decoder,delimiter:"string"===typeof e.delimiter||r.isRegExp(e.delimiter)?e.delimiter:a.delimiter,depth:"number"===typeof e.depth||!1===e.depth?+e.depth:a.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"===typeof e.interpretNumericEntities?e.interpretNumericEntities:a.interpretNumericEntities,parameterLimit:"number"===typeof e.parameterLimit?e.parameterLimit:a.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"===typeof e.plainObjects?e.plainObjects:a.plainObjects,strictNullHandling:"boolean"===typeof e.strictNullHandling?e.strictNullHandling:a.strictNullHandling}}(t);if(""===e||null===e||"undefined"===typeof e)return n.plainObjects?Object.create(null):{};for(var l="string"===typeof e?function(e,t){var n,c={},l=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,d=t.parameterLimit===1/0?void 0:t.parameterLimit,f=l.split(t.delimiter,d),h=-1,p=t.charset;if(t.charsetSentinel)for(n=0;n<f.length;++n)0===f[n].indexOf("utf8=")&&("utf8=%E2%9C%93"===f[n]?p="utf-8":"utf8=%26%2310003%3B"===f[n]&&(p="iso-8859-1"),h=n,n=f.length);for(n=0;n<f.length;++n)if(n!==h){var v,g,y=f[n],m=y.indexOf("]="),k=-1===m?y.indexOf("="):m+1;-1===k?(v=t.decoder(y,a.decoder,p,"key"),g=t.strictNullHandling?null:""):(v=t.decoder(y.slice(0,k),a.decoder,p,"key"),g=r.maybeMap(u(y.slice(k+1),t),(function(e){return t.decoder(e,a.decoder,p,"value")}))),g&&t.interpretNumericEntities&&"iso-8859-1"===p&&(g=s(g)),y.indexOf("[]=")>-1&&(g=o(g)?[g]:g),i.call(c,v)?c[v]=r.combine(c[v],g):c[v]=g}return c}(e,n):e,d=n.plainObjects?Object.create(null):{},f=Object.keys(l),h=0;h<f.length;++h){var p=f[h],v=c(p,l[p],n,"string"===typeof e);d=r.merge(d,v,n)}return!0===n.allowSparse?d:r.compact(d)}},,function(e,t,n){"use strict";n(43);var r=n(20),i=60103;if(t.Fragment=60107,"function"===typeof Symbol&&Symbol.for){var o=Symbol.for;i=o("react.element"),t.Fragment=o("react.fragment")}var a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s=Object.prototype.hasOwnProperty,u={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,o={},c=null,l=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(l=t.ref),t)s.call(t,r)&&!u.hasOwnProperty(r)&&(o[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===o[r]&&(o[r]=t[r]);return{$$typeof:i,type:e,key:c,ref:l,props:o,_owner:a.current}}t.jsx=c,t.jsxs=c}]]);
//# sourceMappingURL=2.b4d193f4.chunk.js.map