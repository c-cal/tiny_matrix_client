/*! For license information please see 2.a1223741.chunk.js.LICENSE.txt */
(this.webpackJsonptiny_matrix_client=this.webpackJsonptiny_matrix_client||[]).push([[2],[function(e,t,n){"use strict";e.exports=n(81)},function(e,t,n){"use strict";var r=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.logger=void 0;var i=r(n(92));i.default.methodFactory=function(e,t,n){return function(){var t,n,r="error"===e||"warn"===e||"trace"===e||"info"===e;return r?(t=console)[e].apply(t,arguments):(n=console).log.apply(n,arguments)}};var o=i.default.getLogger("matrix");t.logger=o,o.setLevel(i.default.levels.DEBUG)},function(e,t,n){e.exports=n(91)},function(e,t){function n(e,t,n,r,i,o,s){try{var a=e[o](s),u=a.value}catch(c){return void n(c)}a.done?t(u):Promise.resolve(u).then(r,i)}e.exports=function(e){return function(){var t=this,r=arguments;return new Promise((function(i,o){var s=e.apply(t,r);function a(e){n(s,i,o,a,u,"next",e)}function u(e){n(s,i,o,a,u,"throw",e)}a(void 0)}))}}},function(e,t,n){var r=n(87);function i(){if("function"!==typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}e.exports=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!==typeof e)return{default:e};var t=i();if(t&&t.has(e))return t.get(e);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var a=o?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(n,s,a):n[s]=e[s]}return n.default=e,t&&t.set(e,n),n}},function(e,t,n){"use strict";var r=n(2),i=n(6),o=n(3),s=n(32),a=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.encodeParams=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t+="&"+encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.substring(1)},t.encodeUri=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e=e.replace(n,encodeURIComponent(t[n])));return e},t.map=function(e,t){for(var n=new Array(e.length),r=0;r<e.length;r++)n[r]=t(e[r]);return n},t.filter=function(e,t){for(var n=[],r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n},t.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t},t.values=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t},t.forEach=function(e,t){for(var n=0;n<e.length;n++)t(e[n],n)},t.findElement=function(e,t,n){var r;if(n){for(r=e.length-1;r>=0;r--)if(t(e[r],r,e))return e[r]}else for(r=0;r<e.length;r++)if(t(e[r],r,e))return e[r]},t.removeElement=function(e,t,n){var r,i;if(n){for(r=e.length-1;r>=0;r--)if(t(e[r],r,e))return i=e[r],e.splice(r,1),i}else for(r=0;r<e.length;r++)if(t(e[r],r,e))return i=e[r],e.splice(r,1),i;return!1},t.isFunction=function(e){return"[object Function]"===Object.prototype.toString.call(e)},t.isArray=function(e){return Array.isArray?Array.isArray(e):Boolean(e&&e.constructor===Array)},t.checkObjectHasKeys=function(e,t){for(var n=0;n<t.length;n++)if(!e.hasOwnProperty(t[n]))throw new Error("Missing required key: "+t[n])},t.checkObjectHasNoAdditionalKeys=function(e,t){for(var n in e)if(e.hasOwnProperty(n)&&-1===t.indexOf(n))throw new Error("Unknown key: "+n)},t.deepCopy=function(e){return JSON.parse(JSON.stringify(e))},t.deepCompare=function e(t,n){if(t===n)return!0;if(typeof t!==typeof n)return!1;if("number"===typeof t&&isNaN(t)&&isNaN(n))return!0;if(null===t||null===n)return t===n;if(!(t instanceof Object))return!1;if(t.constructor!==n.constructor||t.prototype!==n.prototype)return!1;if(t instanceof RegExp||t instanceof Date)return t.toString()===n.toString();if(t instanceof Array){if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(!e(t[r],n[r]))return!1}else{var i;for(i in n)if(n.hasOwnProperty(i)!==t.hasOwnProperty(i))return!1;for(i in n){if(n.hasOwnProperty(i)!==t.hasOwnProperty(i))return!1;if(!e(t[i],n[i]))return!1}}return!0},t.extend=function(){for(var e=(arguments.length<=0?void 0:arguments[0])||{},t=1;t<arguments.length;t++){var n=t<0||arguments.length<=t?void 0:arguments[t];if(n)for(var r in n)e[r]=n[r]}return e},t.runPolyfills=function(){Array.prototype.filter||(Array.prototype.filter=function(e){if(void 0===this||null===this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!==typeof e)throw new TypeError;for(var r=[],i=arguments.length,o=new Array(i>1?i-1:0),s=1;s<i;s++)o[s-1]=arguments[s];for(var a=o?o[0]:void 0,u=0;u<n;u++)if(u in t){var c=t[u];e.call(a,c,u,t)&&r.push(c)}return r});Array.prototype.map||(Array.prototype.map=function(e,t){var n,r;if(null===this||void 0===this)throw new TypeError(" this is null or not defined");var i=Object(this),o=i.length>>>0;if("function"!==typeof e)throw new TypeError(e+" is not a function");arguments.length>1&&(n=t);var s=new Array(o);for(r=0;r<o;){var a=void 0,u=void 0;r in i&&(a=i[r],u=e.call(n,a,r,i),s[r]=u),r++}return s});Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var n,r;if(null===this||void 0===this)throw new TypeError(" this is null or not defined");var i=Object(this),o=i.length>>>0;if("function"!==typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(n=t),r=0;r<o;){var s=void 0;r in i&&(s=i[r],e.call(n,s,r,i)),r++}})},t.inherits=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},t.polyfillSuper=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];try{t.call.apply(t,[e].concat(r))}catch(a){var o=s(t,r);Object.assign(e,o)}},t.isNumber=function(e){return"number"===typeof e&&isFinite(e)},t.removeHiddenChars=function(e){if("string"===typeof e)return(0,u.default)(e.normalize("NFD").replace(l,""));return""},t.escapeRegExp=d,t.globToRegexp=function(e,t){t="boolean"!==typeof t||t;var n=d(e);n=(n=n.replace(/\\\*/g,".*")).replace(/\?/g,"."),t&&(n=n.replace(/\\\[(!|)(.*)\\]/g,(function(e,t,n,r,i){return"["+(t?"^":"")+n.replace(/\\-/,"-")+"]"})));return n},t.ensureNoTrailingSlash=function(e){return e&&e.endsWith("/")?e.substr(0,e.length-1):e},t.sleep=function(e,t){return new Promise((function(n){setTimeout(n,e,t)}))},t.isNullOrUndefined=function(e){return null===e||void 0===e},t.defer=function(){var e,t,n=new Promise((function(n,r){e=n,t=r}));return{resolve:e,reject:t,promise:n}},t.promiseMapSeries=function(e,t){return f.apply(this,arguments)},t.promiseTry=function(e){return new Promise((function(t){return t(e())}))},t.setCrypto=function(e){c=e},t.getCrypto=function(){return c};var u=a(n(93));var c,l=/[\u2000-\u200F\u202A-\u202F\u0300-\u036f\uFEFF\s]/g;function d(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function f(){return(f=o(r.mark((function e(t,n){var o,s,a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=i,e.next=3,t;case 3:e.t1=e.sent,o=(0,e.t0)(e.t1),e.prev=5,o.s();case 7:if((s=o.n()).done){e.next=17;break}return a=s.value,e.t2=n,e.next=12,a;case 12:return e.t3=e.sent,e.next=15,(0,e.t2)(e.t3);case 15:e.next=7;break;case 17:e.next=22;break;case 19:e.prev=19,e.t4=e.catch(5),o.e(e.t4);case 22:return e.prev=22,o.f(),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[5,19,22,25]])})))).apply(this,arguments)}},function(e,t,n){var r=n(44);e.exports=function(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,u=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw s}}}}},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(r){"object"===typeof window&&(n=window)}e.exports=n},function(e,t,n){var r=n(88),i=n(89),o=n(44),s=n(90);e.exports=function(e,t){return r(e)||i(e,t)||o(e,t)||s()}},function(e,t,n){"use strict";var r,i="object"===typeof Reflect?Reflect:null,o=i&&"function"===typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&"function"===typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!==e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise((function(n,r){function i(){void 0!==o&&e.removeListener("error",o),n([].slice.call(arguments))}var o;"error"!==t&&(o=function(n){e.removeListener(t,i),r(n)},e.once("error",o)),e.once(t,i)}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var u=10;function c(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function d(e,t,n,r){var i,o,s,a;if(c(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),void 0===s)s=o[t]=n,++e._eventsCount;else if("function"===typeof s?s=o[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(i=l(e))>0&&s.length>i&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,a=u,console&&console.warn&&console.warn(a)}return e}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=f.bind(r);return i.listener=n,r.wrapFn=i,i}function h(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"===typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):g(i,i.length)}function v(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"===typeof n)return 1;if(void 0!==n)return n.length}return 0}function g(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!==typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return l(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var u=i[e];if(void 0===u)return!1;if("function"===typeof u)o(u,this,t);else{var c=u.length,l=g(u,c);for(n=0;n<c;++n)o(l[n],this,t)}return!0},a.prototype.addListener=function(e,t){return d(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return d(this,e,t,!0)},a.prototype.once=function(e,t){return c(t),this.on(e,p(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return c(t),this.prependListener(e,p(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,r,i,o,s;if(c(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!==typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return h(this,e,!0)},a.prototype.rawListeners=function(e){return h(this,e,!1)},a.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):v.call(e,t)},a.prototype.listenerCount=v,a.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){var r=n(45);e.exports=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},function(e,t,n){var r=n(62),i=n(59),o=n(104);e.exports=function(e){var t=i();return function(){var n,i=r(e);if(t){var s=r(this).constructor;n=Reflect.construct(i,arguments,s)}else n=i.apply(this,arguments);return o(this,n)}}},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){"use strict";var r=n(2),i=n(3),o=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixEvent=t.EventStatus=void 0;var s=n(11),a=o(n(5)),u=n(1);t.EventStatus={NOT_SENT:"not_sent",ENCRYPTING:"encrypting",SENDING:"sending",QUEUED:"queued",SENT:"sent",CANCELLED:"cancelled"};var c={};function l(e){return c[e]||(c[e]=e),c[e]}var d=function(e){["state_key","type","sender","room_id","membership"].forEach((function(t){e[t]&&(e[t]=l(e[t]))})),["membership","avatar_url","displayname"].forEach((function(t){e.content&&e.content[t]&&(e.content[t]=l(e.content[t]))})),["rel_type"].forEach((function(t){e.content&&e.content["m.relates_to"]&&e.content["m.relates_to"][t]&&(e.content["m.relates_to"][t]=l(e.content["m.relates_to"][t]))})),this.event=e||{},this.sender=null,this.target=null,this.status=null,this.error=null,this.forwardLooking=!0,this._pushActions=null,this._replacingEvent=null,this._localRedactionEvent=null,this._isCancelled=!1,this._clearEvent={},this._senderCurve25519Key=null,this._claimedEd25519Key=null,this._forwardingCurve25519KeyChain=[],this._untrusted=null,this._decryptionPromise=null,this._retryDecryption=!1,this.verificationRequest=null,this._txnId=null,this._localTimestamp=Date.now()-this.getAge()};t.MatrixEvent=d,a.inherits(d,s.EventEmitter),a.extend(d.prototype,{getId:function(){return this.event.event_id},getSender:function(){return this.event.sender||this.event.user_id},getType:function(){return this._clearEvent.type||this.event.type},getWireType:function(){return this.event.type},getRoomId:function(){return this.event.room_id},getTs:function(){return this.event.origin_server_ts},getDate:function(){return this.event.origin_server_ts?new Date(this.event.origin_server_ts):null},getOriginalContent:function(){return this._localRedactionEvent?{}:this._clearEvent.content||this.event.content||{}},getContent:function(){return this._localRedactionEvent?{}:this._replacingEvent?this._replacingEvent.getContent()["m.new_content"]||{}:this.getOriginalContent()},getWireContent:function(){return this.event.content||{}},getPrevContent:function(){return this.getUnsigned().prev_content||this.event.prev_content||{}},getDirectionalContent:function(){return this.forwardLooking?this.getContent():this.getPrevContent()},getAge:function(){return this.getUnsigned().age||this.event.age},getLocalAge:function(){return Date.now()-this._localTimestamp},getStateKey:function(){return this.event.state_key},isState:function(){return void 0!==this.event.state_key},makeEncrypted:function(e,t,n,r){this._clearEvent={type:this.event.type,content:this.event.content},this.event.type=e,this.event.content=t,this._senderCurve25519Key=n,this._claimedEd25519Key=r},isBeingDecrypted:function(){return null!=this._decryptionPromise},isDecryptionFailure:function(){return this._clearEvent&&this._clearEvent.content&&"m.bad.encrypted"===this._clearEvent.content.msgtype},attemptDecryption:function(){var e=i(r.mark((function e(t,n){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isEncrypted()){e.next=2;break}throw new Error("Attempt to decrypt event which isn't encrypted");case 2:if(!this._clearEvent||!this._clearEvent.content||"m.bad.encrypted"===this._clearEvent.content.msgtype){e.next=4;break}throw new Error("Attempt to decrypt event which has already been decrypted");case 4:if(!this._decryptionPromise){e.next=8;break}return u.logger.log("Event ".concat(this.getId()," already being decrypted; queueing a retry")),this._retryDecryption=!0,e.abrupt("return",this._decryptionPromise);case 8:return this._decryptionPromise=this._decryptionLoop(t,n),e.abrupt("return",this._decryptionPromise);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),cancelAndResendKeyRequest:function(e,t){var n=this.getWireContent();return e.requestRoomKey({algorithm:n.algorithm,room_id:this.getRoomId(),session_id:n.session_id,sender_key:n.sender_key},this.getKeyRequestRecipients(t),!0)},getKeyRequestRecipients:function(e){var t=this.getWireContent(),n=[{userId:e,deviceId:"*"}],r=this.getSender();return r!==e&&n.push({userId:r,deviceId:t.device_id}),n},_decryptionLoop:function(){var e=i(r.mark((function e(t,n){var i,o,s;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve();case 2:if(this._retryDecryption=!1,i=void 0,o=void 0,e.prev=6,t){e.next=11;break}i=this._badEncryptedMessage("Encryption not enabled"),e.next=15;break;case 11:return e.next=13,t.decryptEvent(this);case 13:i=e.sent,n&&u.logger.info("Decrypted event on retry (id=".concat(this.getId(),")"));case 15:e.next=31;break;case 17:if(e.prev=17,e.t0=e.catch(6),"DecryptionError"===e.t0.name){e.next=25;break}return s=n?"re":"",u.logger.error("Error ".concat(s,"decrypting event ")+"(id=".concat(this.getId(),"): ").concat(e.t0.stack||e.t0)),this._decryptionPromise=null,this._retryDecryption=!1,e.abrupt("return");case 25:if(o=e.t0,!this._retryDecryption){e.next=29;break}return u.logger.log("Got error decrypting event (id=".concat(this.getId(),": ")+"".concat(e.t0,"), but retrying")),e.abrupt("continue",2);case 29:u.logger.warn("Error decrypting event (id=".concat(this.getId(),"): ").concat(e.t0.detailedString)),i=this._badEncryptedMessage(e.t0.message);case 31:return this._decryptionPromise=null,this._retryDecryption=!1,this._setClearData(i),this.setPushActions(null),this.emit("Event.decrypted",this,o),e.abrupt("return");case 39:case"end":return e.stop()}}),e,this,[[6,17]])})));return function(t,n){return e.apply(this,arguments)}}(),_badEncryptedMessage:function(e){return{clearEvent:{type:"m.room.message",content:{msgtype:"m.bad.encrypted",body:"** Unable to decrypt: "+e+" **"}}}},_setClearData:function(e){this._clearEvent=e.clearEvent,this._senderCurve25519Key=e.senderCurve25519Key||null,this._claimedEd25519Key=e.claimedEd25519Key||null,this._forwardingCurve25519KeyChain=e.forwardingCurve25519KeyChain||[],this._untrusted=e.untrusted||!1},getClearContent:function(){var e=this._clearEvent;return e&&e.content?e.content:null},isEncrypted:function(){return!this.isState()&&"m.room.encrypted"===this.event.type},getSenderKey:function(){return this._senderCurve25519Key},getKeysClaimed:function(){return{ed25519:this._claimedEd25519Key}},getClaimedEd25519Key:function(){return this._claimedEd25519Key},getForwardingCurve25519KeyChain:function(){return this._forwardingCurve25519KeyChain},isKeySourceUntrusted:function(){return this._untrusted},getUnsigned:function(){return this.event.unsigned||{}},unmarkLocallyRedacted:function(){var e=this._localRedactionEvent;return this._localRedactionEvent=null,this.event.unsigned&&(this.event.unsigned.redacted_because=null),!!e},markLocallyRedacted:function(e){this._localRedactionEvent||(this.emit("Event.beforeRedaction",this,e),this._localRedactionEvent=e,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event)},makeRedacted:function(e){if(!e.event)throw new Error("invalid redaction_event in makeRedacted");var t;for(t in this._localRedactionEvent=null,this.emit("Event.beforeRedaction",this,e),this._replacingEvent=null,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event,this.event)this.event.hasOwnProperty(t)&&(f[t]||delete this.event[t]);var n=p[this.getType()]||{},r=this.getContent();for(t in r)r.hasOwnProperty(t)&&(n[t]||delete r[t])},isRedacted:function(){return Boolean(this.getUnsigned().redacted_because)},isRedaction:function(){return"m.room.redaction"===this.getType()},getPushActions:function(){return this._pushActions},setPushActions:function(e){this._pushActions=e},handleRemoteEcho:function(e){var t=this.getUnsigned(),n=this.getId();this.event=e,t.redacted_because&&(this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=t.redacted_because),this.setStatus(null),this.getId()!==n&&this.emit("Event.localEventIdReplaced",this)},isSending:function(){return!!this.status},setStatus:function(e){this.status=e,this.emit("Event.status",this,e)},replaceLocalEventId:function(e){this.event.event_id=e,this.emit("Event.localEventIdReplaced",this)},isRelation:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=this.getWireContent(),n=t&&t["m.relates_to"];return n&&n.rel_type&&n.event_id&&(e&&n.rel_type===e||!e)},getRelation:function(){return this.isRelation()?this.getWireContent()["m.relates_to"]:null},makeReplaced:function(e){this.isRedacted()&&e||this._replacingEvent!==e&&(this._replacingEvent=e,this.emit("Event.replaced",this))},getAssociatedStatus:function(){return this._replacingEvent?this._replacingEvent.status:this._localRedactionEvent?this._localRedactionEvent.status:this.status},getServerAggregatedRelation:function(e){var t=this.getUnsigned()["m.relations"];if(t)return t[e]},replacingEventId:function(){var e=this.getServerAggregatedRelation("m.replace");return e?e.event_id:this._replacingEvent?this._replacingEvent.getId():void 0},replacingEvent:function(){return this._replacingEvent},replacingEventDate:function(){var e=this.getServerAggregatedRelation("m.replace");if(e){var t=e.origin_server_ts;if(Number.isFinite(t))return new Date(t)}else if(this._replacingEvent)return this._replacingEvent.getDate()},localRedactionEvent:function(){return this._localRedactionEvent},getAssociatedId:function(){var e=this.getRelation();return e?e.event_id:this.isRedaction()?this.event.redacts:void 0},hasAssocation:function(){return!!this.getAssociatedId()},updateAssociatedId:function(e){var t=this.getRelation();t?t.event_id=e:this.isRedaction()&&(this.event.redacts=e)},flagCancelled:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isCancelled=e},isCancelled:function(){return this._isCancelled},toJSON:function(){var e={type:this.getType(),sender:this.getSender(),content:this.getContent(),event_id:this.getId(),origin_server_ts:this.getTs(),unsigned:this.getUnsigned(),room_id:this.getRoomId()};return this.isRedaction()&&(e.redacts=this.event.redacts),this.isEncrypted()?{decrypted:e,encrypted:this.event}:e},setVerificationRequest:function(e){this.verificationRequest=e},setTxnId:function(e){this._txnId=e},getTxnId:function(){return this._txnId}});var f=["event_id","type","room_id","user_id","sender","state_key","prev_state","content","unsigned","origin_server_ts"].reduce((function(e,t){return e[t]=1,e}),{}),p={"m.room.member":{membership:1},"m.room.create":{creator:1},"m.room.join_rules":{join_rule:1},"m.room.power_levels":{ban:1,events:1,events_default:1,kick:1,redact:1,state_default:1,users:1,users_default:1},"m.room.aliases":{aliases:1}}},function(e,t,n){"use strict";(function(e,r){var i=n(35),o=n(6),s=n(10),a=n(2),u=n(3),c=n(12),l=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptMessageForDevice=function(e,t,n,r,i,o,s){return h.apply(this,arguments)},t.getExistingOlmSessions=function(e,t,n){return v.apply(this,arguments)},t.ensureOlmSessionsForDevices=function(e,t,n,r,i,o){return g.apply(this,arguments)},t.verifySignature=_,t.pkSign=function(t,n,r,i){var o=!1;if(n instanceof Uint8Array){var s=new e.Olm.PkSigning;i=s.init_with_seed(n),n=s,o=!0}var a=t.signatures||{};delete t.signatures;var u=t.unsigned;t.unsigned&&delete t.unsigned;try{var c=a[r]||{};return a[r]=c,c["ed25519:"+i]=n.sign(p.default.stringify(t))}finally{t.signatures=a,u&&(t.unsigned=u),o&&n.free()}},t.pkVerify=function(t,n,r){var i="ed25519:"+n;if(!(t.signatures&&t.signatures[r]&&t.signatures[r][i]))throw new Error("No signature");var o=t.signatures[r][i],s=new e.Olm.Utility,a=t.signatures;delete t.signatures;var u=t.unsigned;t.unsigned&&delete t.unsigned;try{s.ed25519_verify(n,p.default.stringify(t),o)}finally{t.signatures=a,u&&(t.unsigned=u),s.free()}},t.encodeBase64=k,t.encodeUnpaddedBase64=function(e){return k(e).replace(/=+$/g,"")},t.decodeBase64=function(e){return r.from(e,"base64")},t.MEGOLM_BACKUP_ALGORITHM=t.MEGOLM_ALGORITHM=t.OLM_ALGORITHM=void 0;var d=n(1),f=l(n(5)),p=c(n(37));t.OLM_ALGORITHM="m.olm.v1.curve25519-aes-sha2";t.MEGOLM_ALGORITHM="m.megolm.v1.aes-sha2";function h(){return(h=u(a.mark((function e(t,n,r,i,o,s,u){var c,l,p;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=s.getIdentityKey(),e.next=3,i.getSessionIdForDevice(c);case 3:if(null!==(l=e.sent)){e.next=6;break}return e.abrupt("return");case 6:return d.logger.log("Using sessionid "+l+" for device "+o+":"+s.deviceId),p={sender:n,sender_device:r,keys:{ed25519:i.deviceEd25519Key},recipient:o,recipient_keys:{ed25519:s.getFingerprint()}},f.extend(p,u),e.next=11,i.encryptMessage(c,l,JSON.stringify(p));case 11:t[c]=e.sent;case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(){return(v=u(a.mark((function e(t,n,r){var i,c,l,d,f,p;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i={},c={},l=[],d=function(){var e,n=s(p[f],2),r=n[0],d=n[1],h=o(d);try{var v=function(){var n=e.value,o=n.deviceId,s=n.getIdentityKey();l.push(u(a.mark((function e(){var u;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getSessionIdForDevice(s,!0);case 2:null===(u=e.sent)?(i[r]=i[r]||[],i[r].push(n)):(c[r]=c[r]||{},c[r][o]={device:n,sessionId:u});case 4:case"end":return e.stop()}}),e)})))())};for(h.s();!(e=h.n()).done;)v()}catch(g){h.e(g)}finally{h.f()}},f=0,p=Object.entries(r);f<p.length;f++)d();return e.next=7,Promise.all(l);case 7:return e.abrupt("return",[i,c]);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(){return(g=u(a.mark((function e(t,n,r,u,c,l){var f,p,h,v,g,m,_,b,k,S,E,w,x,I,T,R,O,C,D,P,A;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"number"===typeof u&&(l=c,c=u,u=!1),f=[],p={},h={},v=0,g=Object.entries(r);case 5:if(!(v<g.length)){e.next=30;break}m=s(g[v],2),_=m[0],b=m[1],p[_]={},k=o(b),e.prev=9,E=a.mark((function e(){var n,r,i,o;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=S.value,r=n.deviceId,(i=n.getIdentityKey())!==t.deviceCurve25519Key){e.next=7;break}return d.logger.info("Attempted to start session with ourself! Ignoring"),p[_][r]={device:n,sessionId:null},e.abrupt("return","continue");case 7:return t._sessionsInProgress[i]||(t._sessionsInProgress[i]=new Promise((function(e,n){h[i]={resolve:function(){delete t._sessionsInProgress[i],e.apply(void 0,arguments)},reject:function(){delete t._sessionsInProgress[i],n.apply(void 0,arguments)}}}))),e.next=10,t.getSessionIdForDevice(i,h[i]);case 10:null!==(o=e.sent)&&h[i]&&(delete t._sessionsInProgress[i],h[i].resolve(),delete h[i]),(null===o||u)&&(u?d.logger.info("Forcing new Olm session for "+_+":"+r):d.logger.info("Making new Olm session for "+_+":"+r),f.push([_,r])),p[_][r]={device:n,sessionId:o};case 14:case"end":return e.stop()}}),e)})),k.s();case 12:if((S=k.n()).done){e.next=19;break}return e.delegateYield(E(),"t0",14);case 14:if("continue"!==e.t0){e.next=17;break}return e.abrupt("continue",17);case 17:e.next=12;break;case 19:e.next=24;break;case 21:e.prev=21,e.t1=e.catch(9),k.e(e.t1);case 24:return e.prev=24,k.f(),e.finish(24);case 27:v++,e.next=5;break;case 30:if(0!==f.length){e.next=32;break}return e.abrupt("return",p);case 32:return w="signed_curve25519",e.prev=33,e.next=36,n.claimOneTimeKeys(f,w,c);case 36:x=e.sent,e.next=44;break;case 39:for(e.prev=39,e.t2=e.catch(33),I=0,T=Object.values(h);I<T.length;I++)T[I].resolve();throw d.logger.log("failed to claim one-time keys",e.t2,f),e.t2;case 44:l&&"failures"in x&&(R=l).push.apply(R,i(Object.keys(x.failures))),O=x.one_time_keys||{},C=[],D=function(){for(var e=s(A[P],2),n=e[0],r=e[1],i=O[n]||{},o=function(e){var o=r[e],s=o.deviceId,a=o.getIdentityKey();if(a===t.deviceCurve25519Key)return"continue";if(p[n][s].sessionId&&!u)return"continue";var c=i[s]||{},l=null;for(var f in c)0===f.indexOf(w+":")&&(l=c[f]);if(!l){var v="No one-time keys (alg="+w+") for device "+n+":"+s;return d.logger.warn(v),h[a]&&h[a].resolve(),"continue"}C.push(y(t,l,n,o).then((function(e){h[a]&&h[a].resolve(e),p[n][s].sessionId=e}),(function(e){throw h[a]&&h[a].resolve(),e})))},a=0;a<r.length;a++)o(a)};for(P=0,A=Object.entries(r);P<A.length;P++)D();return e.next=51,Promise.all(C);case 51:return e.abrupt("return",p);case 52:case"end":return e.stop()}}),e,null,[[9,21,24,27],[33,39]])})))).apply(this,arguments)}function y(e,t,n,r){return m.apply(this,arguments)}function m(){return(m=u(a.mark((function e(t,n,r,i){var o,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=i.deviceId,e.prev=1,e.next=4,_(t,n,r,o,i.getFingerprint());case 4:e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(1),d.logger.error("Unable to verify signature on one-time key for device "+r+":"+o+":",e.t0),e.abrupt("return",null);case 10:return e.prev=10,e.next=13,t.createOutboundSession(i.getIdentityKey(),n.key);case 13:s=e.sent,e.next=20;break;case 16:return e.prev=16,e.t1=e.catch(10),d.logger.error("Error starting olm session with device "+r+":"+o+": "+e.t1),e.abrupt("return",null);case 20:return d.logger.log("Started new olm sessionid "+s+" for device "+r+":"+o),e.abrupt("return",s);case 22:case"end":return e.stop()}}),e,null,[[1,6],[10,16]])})))).apply(this,arguments)}function _(e,t,n,r,i){return b.apply(this,arguments)}function b(){return(b=u(a.mark((function e(t,n,r,i,o){var s,u,c,l,d,f;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s="ed25519:"+i,u=n.signatures||{},c=u[r]||{},l=c[s]){e.next=6;break}throw Error("No signature");case 6:delete(d=Object.assign({},n)).unsigned,delete d.signatures,f=p.default.stringify(d),t.verifySignature(o,f,l);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return r.from(e).toString("base64")}t.MEGOLM_BACKUP_ALGORITHM="m.megolm_backup.v1.curve25519-aes-sha2"}).call(this,n(9),n(19).Buffer)},function(e,t,n){"use strict";e.exports=n(82)},function(e,t,n){"use strict";(function(e){var r=n(120),i=n(121),o=n(122);function s(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(null===e&&(e=new u(t)),e.length=t),e}function u(e,t,n){if(!u.TYPED_ARRAY_SUPPORT&&!(this instanceof u))return new u(e,t,n);if("number"===typeof e){if("string"===typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return c(this,e,t,n)}function c(e,t,n,r){if("number"===typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!==typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);u.TYPED_ARRAY_SUPPORT?(e=t).__proto__=u.prototype:e=f(e,t);return e}(e,t,n,r):"string"===typeof t?function(e,t,n){"string"===typeof n&&""!==n||(n="utf8");if(!u.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|h(t,n),i=(e=a(e,r)).write(t,n);i!==r&&(e=e.slice(0,i));return e}(e,t,n):function(e,t){if(u.isBuffer(t)){var n=0|p(t.length);return 0===(e=a(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!==typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!==typeof t.length||(r=t.length)!==r?a(e,0):f(e,t);if("Buffer"===t.type&&o(t.data))return f(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!==typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t){if(l(t),e=a(e,t<0?0:0|p(t)),!u.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function f(e,t){var n=t.length<0?0:0|p(t.length);e=a(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function p(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function h(e,t){if(u.isBuffer(e))return e.length;if("undefined"!==typeof ArrayBuffer&&"function"===typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!==typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return q(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return F(e).length;default:if(r)return q(e).length;t=(""+t).toLowerCase(),r=!0}}function v(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return C(this,t,n);case"utf8":case"utf-8":return I(this,t,n);case"ascii":return R(this,t,n);case"latin1":case"binary":return O(this,t,n);case"base64":return x(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function g(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function y(e,t,n,r,i){if(0===e.length)return-1;if("string"===typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"===typeof t&&(t=u.from(t,r)),u.isBuffer(t))return 0===t.length?-1:m(e,t,n,r,i);if("number"===typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"===typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):m(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function m(e,t,n,r,i){var o,s=1,a=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,u/=2,n/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var l=-1;for(o=n;o<a;o++)if(c(e,o)===c(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*s}else-1!==l&&(o-=o-l),l=-1}else for(n+u>a&&(n=a-u),o=n;o>=0;o--){for(var d=!0,f=0;f<u;f++)if(c(e,o+f)!==c(t,f)){d=!1;break}if(d)return o}return-1}function _(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;if(o%2!==0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[n+s]=a}return s}function b(e,t,n,r){return V(q(t,e.length-n),e,n,r)}function k(e,t,n,r){return V(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function S(e,t,n,r){return k(e,t,n,r)}function E(e,t,n,r){return V(F(t),e,n,r)}function w(e,t,n,r){return V(function(e,t){for(var n,r,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)r=(n=e.charCodeAt(s))>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function x(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function I(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,s,a,u,c=e[i],l=null,d=c>239?4:c>223?3:c>191?2:1;if(i+d<=n)switch(d){case 1:c<128&&(l=c);break;case 2:128===(192&(o=e[i+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=e[i+1],s=e[i+2],128===(192&o)&&128===(192&s)&&(u=(15&c)<<12|(63&o)<<6|63&s)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128===(192&o)&&128===(192&s)&&128===(192&a)&&(u=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,d=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=d}return function(e){var t=e.length;if(t<=T)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=T));return n}(r)}t.Buffer=u,t.SlowBuffer=function(e){+e!=e&&(e=0);return u.alloc(+e)},t.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"===typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(t){return!1}}(),t.kMaxLength=s(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,n){return c(null,e,t,n)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!==typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(e,t,n){return function(e,t,n,r){return l(t),t<=0?a(e,t):void 0!==n?"string"===typeof r?a(e,t).fill(n,r):a(e,t).fill(n):a(e,t)}(null,e,t,n)},u.allocUnsafe=function(e){return d(null,e)},u.allocUnsafeSlow=function(e){return d(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=u.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var s=e[n];if(!u.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,i),i+=s.length}return r},u.byteLength=h,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?I(this,0,e):v.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},u.prototype.compare=function(e,t,n,r,i){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),a=Math.min(o,s),c=this.slice(r,i),l=e.slice(t,n),d=0;d<a;++d)if(c[d]!==l[d]){o=c[d],s=l[d];break}return o<s?-1:s<o?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},u.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"===typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return _(this,e,t,n);case"utf8":case"utf-8":return b(this,e,t,n);case"ascii":return k(this,e,t,n);case"latin1":case"binary":return S(this,e,t,n);case"base64":return E(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var T=4096;function R(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function O(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function C(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=j(e[o]);return i}function D(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function P(e,t,n){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function A(e,t,n,r,i,o){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function M(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function U(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function N(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function L(e,t,n,r,o){return o||N(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function K(e,t,n,r,o){return o||N(e,0,n,8),i.write(e,t,n,r,52,8),n+8}u.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=u.prototype;else{var i=t-e;n=new u(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+e]}return n},u.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||P(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},u.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||P(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},u.prototype.readUInt8=function(e,t){return t||P(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||P(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||P(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||P(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||P(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||P(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},u.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||P(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},u.prototype.readInt8=function(e,t){return t||P(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||P(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(e,t){t||P(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(e,t){return t||P(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||P(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||P(e,4,this.length),i.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||P(e,4,this.length),i.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||P(e,8,this.length),i.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||P(e,8,this.length),i.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||A(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},u.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||A(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},u.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):M(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):M(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):U(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):U(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);A(this,e,t,n,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<n&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},u.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);A(this,e,t,n,i-1,-i)}var o=n-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):M(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):M(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):U(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):U(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,n){return L(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return L(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return K(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return K(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,o=r-n;if(this===e&&n<t&&t<r)for(i=o-1;i>=0;--i)e[i+t]=this[i+n];else if(o<1e3||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},u.prototype.fill=function(e,t,n,r){if("string"===typeof e){if("string"===typeof t?(r=t,t=0,n=this.length):"string"===typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!==typeof r)throw new TypeError("encoding must be a string");if("string"===typeof r&&!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"===typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"===typeof e)for(o=t;o<n;++o)this[o]=e;else{var s=u.isBuffer(e)?e:q(new u(e,r).toString()),a=s.length;for(o=0;o<n-t;++o)this[o+t]=s[o%a]}return this};var B=/[^+\/0-9A-Za-z-_]/g;function j(e){return e<16?"0"+e.toString(16):e.toString(16)}function q(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],s=0;s<r;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function F(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(B,"")).length<2)return"";for(;e.length%4!==0;)e+="=";return e}(e))}function V(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(9))},function(e,t,n){"use strict";(function(e){var r=n(7),i=n(8),o=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedDBCryptoStore=void 0;var s=n(1),a=n(124),u=n(43),c=o(n(125)),l=n(36),d=o(n(69)),f=function(){function t(e,n){r(this,t),this._indexedDB=e,this._dbName=n,this._backendPromise=null,this._backend=null}return i(t,[{key:"startup",value:function(){var n=this;return this._backendPromise||(this._backendPromise=new Promise((function(e,t){if(n._indexedDB){s.logger.log("connecting to indexeddb ".concat(n._dbName));var r=n._indexedDB.open(n._dbName,c.VERSION);r.onupgradeneeded=function(e){var t=e.target.result,n=e.oldVersion;c.upgradeDatabase(t,n)},r.onblocked=function(){s.logger.log("can't yet open IndexedDBCryptoStore because it is open elsewhere")},r.onerror=function(e){s.logger.log("Error connecting to indexeddb",e),t(e.target.error)},r.onsuccess=function(t){var r=t.target.result;s.logger.log("connected to indexeddb ".concat(n._dbName)),e(new c.Backend(r))}}else t(new Error("no indexeddb support available"))})).then((function(e){return e.doTxn("readonly",[t.STORE_INBOUND_GROUP_SESSIONS,t.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(function(t){e.getEndToEndInboundGroupSession("","",t,(function(){}))})).then((function(){return e}))})).catch((function(t){if("VersionError"===t.name)throw s.logger.warn("Crypto DB is too new for us to use!",t),new l.InvalidCryptoStoreError(l.InvalidCryptoStoreError.TOO_NEW);s.logger.warn("unable to connect to indexeddb ".concat(n._dbName)+": falling back to localStorage store: ".concat(t));try{return new a.LocalStorageCryptoStore(e.localStorage)}catch(t){return s.logger.warn("unable to open localStorage: falling back to in-memory store: ".concat(t)),new u.MemoryCryptoStore}})).then((function(e){n._backend=e}))),this._backendPromise}},{key:"deleteAllData",value:function(){var e=this;return new Promise((function(t,n){if(e._indexedDB){s.logger.log("Removing indexeddb instance: ".concat(e._dbName));var r=e._indexedDB.deleteDatabase(e._dbName);r.onblocked=function(){s.logger.log("can't yet delete IndexedDBCryptoStore because it is open elsewhere")},r.onerror=function(e){s.logger.log("Error deleting data from indexeddb",e),n(e.target.error)},r.onsuccess=function(){s.logger.log("Removed indexeddb instance: ".concat(e._dbName)),t()}}else n(new Error("no indexeddb support available"))})).catch((function(e){s.logger.warn("unable to delete IndexedDBCryptoStore: ".concat(e))}))}},{key:"getOrAddOutgoingRoomKeyRequest",value:function(e){return this._backend.getOrAddOutgoingRoomKeyRequest(e)}},{key:"getOutgoingRoomKeyRequest",value:function(e){return this._backend.getOutgoingRoomKeyRequest(e)}},{key:"getOutgoingRoomKeyRequestByState",value:function(e){return this._backend.getOutgoingRoomKeyRequestByState(e)}},{key:"getAllOutgoingRoomKeyRequestsByState",value:function(e){return this._backend.getAllOutgoingRoomKeyRequestsByState(e)}},{key:"getOutgoingRoomKeyRequestsByTarget",value:function(e,t,n){return this._backend.getOutgoingRoomKeyRequestsByTarget(e,t,n)}},{key:"updateOutgoingRoomKeyRequest",value:function(e,t,n){return this._backend.updateOutgoingRoomKeyRequest(e,t,n)}},{key:"deleteOutgoingRoomKeyRequest",value:function(e,t){return this._backend.deleteOutgoingRoomKeyRequest(e,t)}},{key:"getAccount",value:function(e,t){this._backend.getAccount(e,t)}},{key:"storeAccount",value:function(e,t){this._backend.storeAccount(e,t)}},{key:"getCrossSigningKeys",value:function(e,t){this._backend.getCrossSigningKeys(e,t)}},{key:"getSecretStorePrivateKey",value:function(e,t,n){this._backend.getSecretStorePrivateKey(e,t,n)}},{key:"storeCrossSigningKeys",value:function(e,t){this._backend.storeCrossSigningKeys(e,t)}},{key:"storeSecretStorePrivateKey",value:function(e,t,n){this._backend.storeSecretStorePrivateKey(e,t,n)}},{key:"countEndToEndSessions",value:function(e,t){this._backend.countEndToEndSessions(e,t)}},{key:"getEndToEndSession",value:function(e,t,n,r){this._backend.getEndToEndSession(e,t,n,r)}},{key:"getEndToEndSessions",value:function(e,t,n){this._backend.getEndToEndSessions(e,t,n)}},{key:"getAllEndToEndSessions",value:function(e,t){this._backend.getAllEndToEndSessions(e,t)}},{key:"storeEndToEndSession",value:function(e,t,n,r){this._backend.storeEndToEndSession(e,t,n,r)}},{key:"storeEndToEndSessionProblem",value:function(e,t,n){return this._backend.storeEndToEndSessionProblem(e,t,n)}},{key:"getEndToEndSessionProblem",value:function(e,t){return this._backend.getEndToEndSessionProblem(e,t)}},{key:"filterOutNotifiedErrorDevices",value:function(e){return this._backend.filterOutNotifiedErrorDevices(e)}},{key:"getEndToEndInboundGroupSession",value:function(e,t,n,r){this._backend.getEndToEndInboundGroupSession(e,t,n,r)}},{key:"getAllEndToEndInboundGroupSessions",value:function(e,t){this._backend.getAllEndToEndInboundGroupSessions(e,t)}},{key:"addEndToEndInboundGroupSession",value:function(e,t,n,r){this._backend.addEndToEndInboundGroupSession(e,t,n,r)}},{key:"storeEndToEndInboundGroupSession",value:function(e,t,n,r){this._backend.storeEndToEndInboundGroupSession(e,t,n,r)}},{key:"storeEndToEndInboundGroupSessionWithheld",value:function(e,t,n,r){this._backend.storeEndToEndInboundGroupSessionWithheld(e,t,n,r)}},{key:"storeEndToEndDeviceData",value:function(e,t){this._backend.storeEndToEndDeviceData(e,t)}},{key:"getEndToEndDeviceData",value:function(e,t){this._backend.getEndToEndDeviceData(e,t)}},{key:"storeEndToEndRoom",value:function(e,t,n){this._backend.storeEndToEndRoom(e,t,n)}},{key:"getEndToEndRooms",value:function(e,t){this._backend.getEndToEndRooms(e,t)}},{key:"getSessionsNeedingBackup",value:function(e){return this._backend.getSessionsNeedingBackup(e)}},{key:"countSessionsNeedingBackup",value:function(e){return this._backend.countSessionsNeedingBackup(e)}},{key:"unmarkSessionsNeedingBackup",value:function(e,t){return this._backend.unmarkSessionsNeedingBackup(e,t)}},{key:"markSessionsNeedingBackup",value:function(e,t){return this._backend.markSessionsNeedingBackup(e,t)}},{key:"doTxn",value:function(e,t,n){return this._backend.doTxn(e,t,n)}}],[{key:"exists",value:function(e,t){return d.exists(e,t)}}]),t}();t.IndexedDBCryptoStore=f,f.STORE_ACCOUNT="account",f.STORE_SESSIONS="sessions",f.STORE_INBOUND_GROUP_SESSIONS="inbound_group_sessions",f.STORE_INBOUND_GROUP_SESSIONS_WITHHELD="inbound_group_sessions_withheld",f.STORE_DEVICE_DATA="device_data",f.STORE_ROOMS="rooms",f.STORE_BACKUP="sessions_needing_backup"}).call(this,n(9))},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e){return(i="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return!t||"object"!==i(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=r(e);if(t){var s=r(this).constructor;n=Reflect.construct(i,arguments,s)}else n=i.apply(this,arguments);return o(this,n)}}n.d(t,"a",(function(){return s}))},function(e,t,n){"use strict";function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function i(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";var r=n(6);Object.defineProperty(t,"__esModule",{value:!0}),t.EventTimeline=o;var i=n(65);function o(e){this._eventTimelineSet=e,this._roomId=e.room?e.room.roomId:null,this._events=[],this._baseIndex=0,this._startState=new i.RoomState(this._roomId),this._startState.paginationToken=null,this._endState=new i.RoomState(this._roomId),this._endState.paginationToken=null,this._prevTimeline=null,this._nextTimeline=null,this._paginationRequests={b:null,f:null},this._name=this._roomId+":"+(new Date).toISOString()}o.BACKWARDS="b",o.FORWARDS="f",o.prototype.initialiseState=function(e){if(this._events.length>0)throw new Error("Cannot initialise state after events are added");var t,n=r(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;Object.freeze(i)}}catch(o){n.e(o)}finally{n.f()}this._startState.setStateEvents(e),this._endState.setStateEvents(e)},o.prototype.forkLive=function(e){var t=this.getState(e),n=new o(this._eventTimelineSet);return n._startState=t.clone(),n._endState=t,this._endState=t.clone(),n},o.prototype.fork=function(e){var t=this.getState(e),n=new o(this._eventTimelineSet);return n._startState=t.clone(),n._endState=t.clone(),n},o.prototype.getRoomId=function(){return this._roomId},o.prototype.getFilter=function(){return this._eventTimelineSet.getFilter()},o.prototype.getTimelineSet=function(){return this._eventTimelineSet},o.prototype.getBaseIndex=function(){return this._baseIndex},o.prototype.getEvents=function(){return this._events},o.prototype.getState=function(e){if(e==o.BACKWARDS)return this._startState;if(e==o.FORWARDS)return this._endState;throw new Error("Invalid direction '"+e+"'")},o.prototype.getPaginationToken=function(e){return this.getState(e).paginationToken},o.prototype.setPaginationToken=function(e,t){this.getState(t).paginationToken=e},o.prototype.getNeighbouringTimeline=function(e){if(e==o.BACKWARDS)return this._prevTimeline;if(e==o.FORWARDS)return this._nextTimeline;throw new Error("Invalid direction '"+e+"'")},o.prototype.setNeighbouringTimeline=function(e,t){if(this.getNeighbouringTimeline(t))throw new Error("timeline already has a neighbouring timeline - cannot reset neighbour (direction: "+t+")");if(t==o.BACKWARDS)this._prevTimeline=e;else{if(t!=o.FORWARDS)throw new Error("Invalid direction '"+t+"'");this._nextTimeline=e}this.setPaginationToken(null,t)},o.prototype.addEvent=function(e,t){var n,r=t?this._startState:this._endState,i=this.getTimelineSet();i.room&&i.room.getUnfilteredTimelineSet()===i&&(o.setEventMetadata(e,r,t),e.isState()&&(r.setStateEvents([e]),e.sender&&("m.room.member"!==e.getType()||t)||o.setEventMetadata(e,r,t))),n=t?0:this._events.length,this._events.splice(n,0,e),t&&this._baseIndex++},o.setEventMetadata=function(e,t,n){e.sender=t.getSentinelMember(e.getSender()),"m.room.member"===e.getType()&&(e.target=t.getSentinelMember(e.getStateKey())),e.isState()&&n&&(e.forwardLooking=!1)},o.prototype.removeEvent=function(e){for(var t=this._events.length-1;t>=0;t--){var n=this._events[t];if(n.getId()==e)return this._events.splice(t,1),t<this._baseIndex&&this._baseIndex--,n}return null},o.prototype.toString=function(){return this._name}},function(e,t,n){"use strict";var r=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.User=s;var i=r(n(5)),o=n(11);function s(e){this.userId=e,this.presence="offline",this.presenceStatusMsg=null,this._unstable_statusMessage="",this.displayName=e,this.rawDisplayName=e,this.avatarUrl=null,this.lastActiveAgo=0,this.lastPresenceTs=0,this.currentlyActive=!1,this.events={presence:null,profile:null},this._updateModifiedTime()}i.inherits(s,o.EventEmitter),s.prototype.setPresenceEvent=function(e){if("m.presence"===e.getType()){var t=null===this.events.presence;this.events.presence=e;var n=[];(e.getContent().presence!==this.presence||t)&&n.push("User.presence"),e.getContent().avatar_url&&e.getContent().avatar_url!==this.avatarUrl&&n.push("User.avatarUrl"),e.getContent().displayname&&e.getContent().displayname!==this.displayName&&n.push("User.displayName"),void 0!==e.getContent().currently_active&&e.getContent().currently_active!==this.currentlyActive&&n.push("User.currentlyActive"),this.presence=e.getContent().presence,n.push("User.lastPresenceTs"),e.getContent().status_msg&&(this.presenceStatusMsg=e.getContent().status_msg),e.getContent().displayname&&(this.displayName=e.getContent().displayname),e.getContent().avatar_url&&(this.avatarUrl=e.getContent().avatar_url),this.lastActiveAgo=e.getContent().last_active_ago,this.lastPresenceTs=Date.now(),this.currentlyActive=e.getContent().currently_active,this._updateModifiedTime();for(var r=0;r<n.length;r++)this.emit(n[r],e,this)}},s.prototype.setDisplayName=function(e){var t=this.displayName;this.displayName="string"===typeof e?e:void 0,e!==t&&this._updateModifiedTime()},s.prototype.setRawDisplayName=function(e){this.rawDisplayName="string"===typeof e?e:void 0},s.prototype.setAvatarUrl=function(e){var t=this.avatarUrl;this.avatarUrl=e,e!==t&&this._updateModifiedTime()},s.prototype._updateModifiedTime=function(){this._modified=Date.now()},s.prototype.getLastModifiedTime=function(){return this._modified},s.prototype.getLastActiveTs=function(){return this.lastPresenceTs-this.lastActiveAgo},s.prototype._unstable_updateStatusMessage=function(e){e.getContent()?this._unstable_statusMessage=e.getContent().status:this._unstable_statusMessage="",this._updateModifiedTime(),this.emit("User._unstable_statusMessage",this)}},function(e,t,n){var r=n(62),i=n(45),o=n(106),s=n(32);function a(t){var n="function"===typeof Map?new Map:void 0;return e.exports=a=function(e){if(null===e||!o(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return s(e,arguments,r(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i(t,e)},a(t)}e.exports=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.newVerificationError=i,t.errorFactory=o,t.errorFromEvent=function(e){var t=e.getContent();if(t){var n=t.code,r=t.reason;return{code:n,reason:r}}return{code:"Unknown error",reason:"m.unknown"}},t.newInvalidMessageError=t.newUserMismatchError=t.newKeyMismatchError=t.newUnexpectedMessageError=t.newUnknownMethodError=t.newUnknownTransactionError=t.newTimeoutError=t.newUserCancelledError=void 0;var r=n(16);function i(e,t,n){var i=Object.assign({},{code:e,reason:t},n);return new r.MatrixEvent({type:"m.key.verification.cancel",content:i})}function o(e,t){return function(n){return i(e,t,n)}}var s=o("m.user","Cancelled by user");t.newUserCancelledError=s;var a=o("m.timeout","Timed out");t.newTimeoutError=a;var u=o("m.unknown_transaction","Unknown transaction");t.newUnknownTransactionError=u;var c=o("m.unknown_method","Unknown method");t.newUnknownMethodError=c;var l=o("m.unexpected_message","Unexpected message");t.newUnexpectedMessageError=l;var d=o("m.key_mismatch","Key mismatch");t.newKeyMismatchError=d;var f=o("m.user_error","User mismatch");t.newUserMismatchError=f;var p=o("m.invalid_message","Invalid message");t.newInvalidMessageError=p},function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"a",(function(){return r}))},function(e,t,n){var r=n(45),i=n(59);function o(t,n,s){return i()?e.exports=o=Reflect.construct:e.exports=o=function(e,t,n){var i=[null];i.push.apply(i,t);var o=new(Function.bind.apply(e,i));return n&&r(o,n.prototype),o},o.apply(null,arguments)}e.exports=o},function(e,t,n){"use strict";(function(e){var r=n(2),i=n(3),o=n(8),s=n(7),a=n(13),u=n(14),c=n(29),l=n(4),d=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixHttpApi=_,t.retryNetworkOperation=function(e,t){return w.apply(this,arguments)},t.AbortError=t.ConnectionError=t.MatrixError=t.PREFIX_MEDIA_R0=t.PREFIX_IDENTITY_V2=t.PREFIX_IDENTITY_V1=t.PREFIX_UNSTABLE=t.PREFIX_R0=void 0;var f=d(n(21)),p=n(107),h=l(n(5)),v=n(1),g=l(n(108));function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){(0,f.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.PREFIX_R0="/_matrix/client/r0";t.PREFIX_UNSTABLE="/_matrix/client/unstable";t.PREFIX_IDENTITY_V1="/_matrix/identity/api/v1";t.PREFIX_IDENTITY_V2="/_matrix/identity/v2";function _(e,t){h.checkObjectHasKeys(t,["baseUrl","request","prefix"]),t.onlyData=t.onlyData||!1,this.event_emitter=e,this.opts=t,this.useAuthorizationHeader=Boolean(t.useAuthorizationHeader),this.uploads=[]}t.PREFIX_MEDIA_R0="/_matrix/media/r0",_.prototype={setIdBaseUrl:function(e){this.opts.idBaseUrl=e},getContentUri:function(){var e={access_token:this.opts.accessToken};return{base:this.opts.baseUrl,path:"/_matrix/media/r0/upload",params:e}},uploadContent:function(t,n){h.isFunction(n)?n={callback:n}:void 0===n&&(n={});var r=!1!==n.includeFilename,i=n.type||t.type||"application/octet-stream",o=n.name||t.name,s=t;s.stream&&"function"!==typeof s.stream&&(v.logger.warn("Using `file.stream` as the content to upload. Future versions of the js-sdk will change this to expect `file` to be the content directly."),s=s.stream);var a=n.rawResponse;void 0===a&&(e.XMLHttpRequest?a=!1:(v.logger.warn("Returning the raw JSON from uploadContent(). Future versions of the js-sdk will change this default, to return the parsed object. Set opts.rawResponse=false to change this behaviour now."),a=!0));var u=n.onlyContentUri;a||void 0!==u||(e.XMLHttpRequest?(v.logger.warn("Returning only the content-uri from uploadContent(). Future versions of the js-sdk will change this default, to return the whole response object. Set opts.onlyContentUri=false to change this behaviour now."),u=!0):u=!1);var c,l={loaded:0,total:0},d=null;if(a||(d=function(e){var t=JSON.parse(e);if(u&&void 0===(t=t.content_uri))throw Error("Bad response");return t}),e.XMLHttpRequest){var f=h.defer(),p=new e.XMLHttpRequest;l.xhr=p;var y=b(f,n.callback,this.opts.onlyData),m=function(){p.abort(),y(new Error("Timeout"))};p.timeout_timer=g.setTimeout(m,3e4),p.onreadystatechange=function(){switch(p.readyState){case e.XMLHttpRequest.DONE:var t;g.clearTimeout(p.timeout_timer);try{if(0===p.status)throw new E;if(!p.responseText)throw new Error("No response body.");t=p.responseText,d&&(t=d(t))}catch(n){return n.http_status=p.status,void y(n)}y(void 0,p,t)}},p.upload.addEventListener("progress",(function(e){g.clearTimeout(p.timeout_timer),l.loaded=e.loaded,l.total=e.total,p.timeout_timer=g.setTimeout(m,3e4),n.progressHandler&&n.progressHandler({loaded:e.loaded,total:e.total})}));var _=this.opts.baseUrl+"/_matrix/media/r0/upload",k=[];r&&o&&k.push("filename="+encodeURIComponent(o)),this.useAuthorizationHeader||k.push("access_token="+encodeURIComponent(this.opts.accessToken)),k.length>0&&(_+="?"+k.join("&")),p.open("POST",_),this.useAuthorizationHeader&&p.setRequestHeader("Authorization","Bearer "+this.opts.accessToken),p.setRequestHeader("Content-Type",i),p.send(s),(c=f.promise).abort=p.abort.bind(p)}else{var S={};r&&o&&(S.filename=o),c=this.authedRequest(n.callback,"POST","/upload",S,s,{prefix:"/_matrix/media/r0",headers:{"Content-Type":i},json:!1,bodyParser:d})}var w=this,x=c.finally((function(){for(var e=0;e<w.uploads.length;++e)if(w.uploads[e]===l)return void w.uploads.splice(e,1)}));return x.abort=c.abort,l.promise=x,this.uploads.push(l),x},cancelUpload:function(e){return!!e.abort&&(e.abort(),!0)},getCurrentUploads:function(){return this.uploads},idServerRequest:function(e,t,n,r,i,o){if(!this.opts.idBaseUrl)throw new Error("No Identity Server base URL set");var s=this.opts.idBaseUrl+i+n;if(void 0!==e&&!h.isFunction(e))throw Error("Expected callback to be a function but got "+typeof e);var a={uri:s,method:t,withCredentials:!1,json:!0,_matrix_opts:this.opts,headers:{}};"GET"===t?a.qs=r:"object"===typeof r&&(a.json=r),o&&(a.headers.Authorization="Bearer ".concat(o));var u=h.defer();return this.opts.request(a,b(u,e,this.opts.onlyData)),u.promise},authedRequest:function(e,t,n,r,i,o){r||(r={}),this.useAuthorizationHeader?(isFinite(o)&&(o={localTimeoutMs:o}),o||(o={}),o.headers||(o.headers={}),o.headers.Authorization||(o.headers.Authorization="Bearer "+this.opts.accessToken),r.access_token&&delete r.access_token):r.access_token||(r.access_token=this.opts.accessToken);var s=this.request(e,t,n,r,i,o),a=this;return s.catch((function(e){"M_UNKNOWN_TOKEN"==e.errcode?a.event_emitter.emit("Session.logged_out",e):"M_CONSENT_NOT_GIVEN"==e.errcode&&a.event_emitter.emit("no_consent",e.message,e.data.consent_uri)})),s},request:function(e,t,n,r,i,o){var s=void 0!==(o=o||{}).prefix?o.prefix:this.opts.prefix,a=this.opts.baseUrl+s+n;return this.requestOtherUrl(e,t,a,r,i,o)},requestOtherUrl:function(e,t,n,r,i,o){return void 0===o||null===o?o={}:isFinite(o)&&(o={localTimeoutMs:o}),this._request(e,t,n,r,i,o)},getUrl:function(e,t,n){var r="";return t&&(r="?"+h.encodeParams(t)),this.opts.baseUrl+n+e+r},_request:function(e,t,n,r,i,o){if(void 0!==e&&!h.isFunction(e))throw Error("Expected callback to be a function but got "+typeof e);o=o||{};var s=this;this.opts.extraParams&&(r=m(m({},r),this.opts.extraParams));var a=h.extend({},o.headers||{}),u=void 0===o.json||o.json,c=o.bodyParser;u&&(i&&(i=JSON.stringify(i),a["content-type"]="application/json"),a.accept||(a.accept="application/json"),void 0===c&&(c=function(e){return JSON.parse(e)}));var l,d,f=h.defer(),p=!1,v=o.localTimeoutMs||this.opts.localTimeoutMs,y=function(){v&&(l&&g.clearTimeout(l),l=g.setTimeout((function(){p=!0,d&&d.abort&&d.abort(),f.reject(new k({error:"Locally timed out waiting for a response",errcode:"ORG.MATRIX.JSSDK_TIMEOUT",timeout:v}))}),v))};y();var _=f.promise;try{(d=this.opts.request({uri:n,method:t,withCredentials:!1,qs:r,qsStringifyOptions:o.qsStringifyOptions,useQuerystring:!0,body:i,json:!1,timeout:v,headers:a||{},_matrix_opts:this.opts},(function(t,n,r){v&&(g.clearTimeout(l),p)||b(f,e,s.opts.onlyData,c)(t,n,r)})))&&("onprogress"in d&&(d.onprogress=function(e){y()}),d.abort&&(_.abort=d.abort.bind(d)))}catch(S){f.reject(S),e&&e(S)}return _}};var b=function(e,t,n,r){return t=t||function(){},function(i,o,s){i&&("AbortError"===i.name||"aborted"===i||i instanceof k||(i=new S("request failed",i)));if(!i)try{o.statusCode>=400?i=function(e,t){var n,r=e.statusCode,i=function(e){var t;e.getResponseHeader?t=e.getResponseHeader("Content-Type"):e.headers&&(t=e.headers["content-type"]||null);if(!t)return null;try{return(0,p.parse)(t)}catch(n){throw new Error("Error parsing Content-Type '".concat(t,"': ").concat(n))}}(e);if(i)if("application/json"===i.type){var o="object"===typeof t?t:JSON.parse(t);n=new k(o)}else"text/plain"===i.type&&(n=new Error("Server returned ".concat(r," error: ").concat(t)));n||(n=new Error("Server returned ".concat(r," error")));return n.httpStatus=r,n}(o,s):r&&(s=r(s))}catch(u){i=new Error("Error parsing server response: ".concat(u))}if(i)e.reject(i),t(i);else{var a={code:o.statusCode,headers:o.headers,data:s};e.resolve(n?s:a),t(null,n?s:a)}}};var k=function(e){a(n,e);var t=u(n);function n(e){var r;return s(this,n),e=e||{},(r=t.call(this,"MatrixError: ".concat(e.errcode))).errcode=e.errcode,r.name=e.errcode||"Unknown error code",r.message=e.error||"Unknown message",r.data=e,r}return n}(c(Error));t.MatrixError=k;var S=function(e){a(n,e);var t=u(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return s(this,n),(r=t.call(this,e+(i?": ".concat(i.message):"")))._cause=i,r}return o(n,[{key:"name",get:function(){return"ConnectionError"}},{key:"cause",get:function(){return this._cause}}]),n}(c(Error));t.ConnectionError=S;var E=function(e){a(n,e);var t=u(n);function n(){return s(this,n),t.call(this,"Operation aborted")}return o(n,[{key:"name",get:function(){return"AbortError"}}]),n}(c(Error));function w(){return(w=i(r.mark((function e(t,n){var i,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=0,o=null;case 2:if(!(i<t)){e.next=21;break}if(e.prev=3,!(i>0)){e.next=6;break}return e.delegateYield(r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=1e3*Math.pow(2,i),v.logger.log("network operation failed ".concat(i," times,")+" retrying in ".concat(t,"ms...")),e.next=4,new Promise((function(e){return setTimeout(e,t)}));case 4:case"end":return e.stop()}}),e)}))(),"t0",6);case 6:return e.next=8,n();case 8:return e.abrupt("return",e.sent);case 11:if(e.prev=11,e.t1=e.catch(3),!(e.t1 instanceof S)){e.next=18;break}i+=1,o=e.t1,e.next=19;break;case 18:throw e.t1;case 19:e.next=2;break;case 21:throw o;case 22:case"end":return e.stop()}}),e,null,[[3,11]])})))).apply(this,arguments)}t.AbortError=E}).call(this,n(9))},function(e,t,n){"use strict";var r=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.getHttpUriForMxc=function(e,t,n,r,o,s){if("string"!==typeof t||!t)return"";if(0!==t.indexOf("mxc://"))return s?t:"";var a=t.slice(6),u="/_matrix/media/r0/download/",c={};n&&(c.width=Math.round(n));r&&(c.height=Math.round(r));o&&(c.method=o);i.keys(c).length>0&&(u="/_matrix/media/r0/thumbnail/");var l=a.indexOf("#"),d="";l>=0&&(d=a.substr(l),a=a.substr(0,l));return e+u+a+(0===i.keys(c).length?"":"?"+i.encodeParams(c))+d};var i=r(n(5))},function(e,t,n){var r=n(112),i=n(113),o=n(44),s=n(114);e.exports=function(e){return r(e)||i(e)||o(e)||s()}},function(e,t,n){"use strict";var r=n(7),i=n(13),o=n(14),s=n(29);function a(e,t){var n="Store is invalid because ".concat(e,", ")+"please stop the client, delete all data and start the client again",r=Reflect.construct(Error,[n]);return Reflect.setPrototypeOf(r,Reflect.getPrototypeOf(this)),r.reason=e,r.value=t,r}function u(e){var t="Crypto store is invalid because ".concat(e,", ")+"please stop the client, delete all data and start the client again",n=Reflect.construct(Error,[t]);return Reflect.setPrototypeOf(n,Reflect.getPrototypeOf(this)),n.reason=e,n.name="InvalidCryptoStoreError",n}Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidStoreError=a,t.InvalidCryptoStoreError=u,t.KeySignatureUploadError=void 0,a.TOGGLED_LAZY_LOADING="TOGGLED_LAZY_LOADING",a.prototype=Object.create(Error.prototype,{constructor:{value:Error,enumerable:!1,writable:!0,configurable:!0}}),Reflect.setPrototypeOf(a,Error),u.TOO_NEW="TOO_NEW",u.prototype=Object.create(Error.prototype,{constructor:{value:Error,enumerable:!1,writable:!0,configurable:!0}}),Reflect.setPrototypeOf(u,Error);var c=function(e){i(n,e);var t=o(n);function n(e,i){var o;return r(this,n),(o=t.call(this,e)).value=i,o}return n}(s(Error));t.KeySignatureUploadError=c},function(e,t,n){"use strict";for(var r=/[\\\"\x00-\x1F]/g,i={},o=0;o<32;++o)i[String.fromCharCode(o)]="\\U"+("0000"+o.toString(16)).slice(-4).toUpperCase();function s(e){return r.lastIndex=0,e.replace(r,(function(e){return i[e]}))}function a(e){switch(typeof e){case"string":return'"'+s(e)+'"';case"number":return isFinite(e)?e:"null";case"boolean":return e;case"object":return null===e?"null":Array.isArray(e)?function(e){for(var t="[",n="",r=0;r<e.length;++r)n+=t,t=",",n+=a(e[r]);return","!=t?"[]":n+"]"}(e):function(e){var t="{",n="",r=Object.keys(e);r.sort();for(var i=0;i<r.length;++i){var o=r[i];n+=t+'"'+s(o)+'":',t=",",n+=a(e[o])}return","!=t?"{}":n+"}"}(e);default:throw new Error("Cannot stringify: "+typeof e)}}i["\b"]="\\b",i["\t"]="\\t",i["\n"]="\\n",i["\f"]="\\f",i["\r"]="\\r",i['"']='\\"',i["\\"]="\\\\",e.exports={stringify:a}},function(e,t,n){"use strict";function r(e){Object.defineProperty(this,"deviceId",{enumerable:!0,value:e}),this.algorithms=[],this.keys={},this.verified=i.UNVERIFIED,this.known=!1,this.unsigned={},this.signatures={}}Object.defineProperty(t,"__esModule",{value:!0}),t.DeviceInfo=r,r.fromStorage=function(e,t){var n=new r(t);for(var i in e)e.hasOwnProperty(i)&&(n[i]=e[i]);return n},r.prototype.toStorage=function(){return{algorithms:this.algorithms,keys:this.keys,verified:this.verified,known:this.known,unsigned:this.unsigned,signatures:this.signatures}},r.prototype.getFingerprint=function(){return this.keys["ed25519:"+this.deviceId]},r.prototype.getIdentityKey=function(){return this.keys["curve25519:"+this.deviceId]},r.prototype.getDisplayName=function(){return this.unsigned.device_display_name||null},r.prototype.isBlocked=function(){return this.verified==i.BLOCKED},r.prototype.isVerified=function(){return this.verified==i.VERIFIED},r.prototype.isUnverified=function(){return this.verified==i.UNVERIFIED},r.prototype.isKnown=function(){return 1==this.known},r.DeviceVerification={VERIFIED:1,UNVERIFIED:0,BLOCKED:-1};var i=r.DeviceVerification},function(e,t,n){"use strict";(function(e,r){var i=n(6),o=n(10),s=n(15),a=n(2),u=n(3),c=n(7),l=n(8),d=n(22),f=n(13),p=n(14);Object.defineProperty(t,"__esModule",{value:!0}),t.createCryptoStoreCacheCallbacks=function(e,t){return{getCrossSigningKeyCache:function(){var n=u(a.mark((function n(i,o){var s,u,c;return a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,new Promise((function(t){return e.doTxn("readonly",[y.IndexedDBCryptoStore.STORE_ACCOUNT],(function(n){e.getSecretStorePrivateKey(n,t,i)}))}));case 2:if(!(s=n.sent)||!s.ciphertext){n.next=11;break}return u=r.from(t._pickleKey),n.next=7,(0,m.decryptAES)(s,u,i);case 7:return c=n.sent,n.abrupt("return",(0,h.decodeBase64)(c));case 11:return n.abrupt("return",s);case 12:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}(),storeCrossSigningKeyCache:function(){var n=u(a.mark((function n(i,o){var s;return a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o instanceof Uint8Array){n.next=2;break}throw new Error("storeCrossSigningKeyCache expects Uint8Array, got ".concat(o));case 2:return s=r.from(t._pickleKey),n.next=5,(0,m.encryptAES)((0,h.encodeBase64)(o),s,i);case 5:return o=n.sent,n.abrupt("return",e.doTxn("readwrite",[y.IndexedDBCryptoStore.STORE_ACCOUNT],(function(t){e.storeSecretStorePrivateKey(t,i,o)})));case 7:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()}},t.requestKeysDuringVerification=function(e,t,n){return w.apply(this,arguments)},t.DeviceTrustLevel=t.UserTrustLevel=t.CrossSigningLevel=t.CrossSigningInfo=void 0;var h=n(17),v=n(11),g=n(1),y=n(20),m=n(40);function _(e){return Object.values(e.keys)[0]}var b=function(t){f(r,t);var n=p(r);function r(e,t,i){var o;return c(this,r),o=n.call(this),Object.defineProperty(d(o),"userId",{enumerable:!0,value:e}),o._callbacks=t||{},o._cacheCallbacks=i||{},o.keys={},o.firstUse=!0,o.crossSigningVerifiedBefore=!1,o}return l(r,[{key:"toStorage",value:function(){return{keys:this.keys,firstUse:this.firstUse,crossSigningVerifiedBefore:this.crossSigningVerifiedBefore}}},{key:"getCrossSigningKey",value:function(){var t=u(a.mark((function t(n,r){var i,o,s,u,c;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=function(t){if(t){var n=new e.Olm.PkSigning,i=n.init_with_seed(t);if(i===r)return[i,n];n.free()}},i=["master","self_signing","user_signing"].indexOf(n)>=0,this._callbacks.getCrossSigningKey){t.next=4;break}throw new Error("No getCrossSigningKey callback supplied");case 4:if(void 0===r&&(r=this.getId(n)),!this._cacheCallbacks.getCrossSigningKeyCache||!i){t.next=9;break}return t.next=8,this._cacheCallbacks.getCrossSigningKeyCache(n,r);case 8:s=t.sent;case 9:if(!(u=o(s))){t.next=12;break}return t.abrupt("return",u);case 12:return t.next=14,this._callbacks.getCrossSigningKey(n,r);case 14:if(s=t.sent,!(c=o(s))){t.next=21;break}if(!this._cacheCallbacks.storeCrossSigningKeyCache||!i){t.next=20;break}return t.next=20,this._cacheCallbacks.storeCrossSigningKeyCache(n,s);case 20:return t.abrupt("return",c);case 21:if(s){t.next=23;break}throw new Error("getCrossSigningKey callback for "+n+" returned falsey");case 23:throw new Error("Key type "+n+" from getCrossSigningKey callback did not match");case 24:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"isStoredInSecretStorage",value:function(){var e=u(a.mark((function e(t){var n,r,i,o,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(e){for(var t=0,r=Object.keys(n);t<r.length;t++){var i=r[t];e[i]||delete n[i]}},e.next=3,t.isStored("m.cross_signing.master",!1);case 3:if(e.t0=e.sent,e.t0){e.next=6;break}e.t0={};case 6:n=e.t0,i=0,o=["self_signing","user_signing"];case 8:if(!(i<o.length)){e.next=21;break}return s=o[i],e.t1=r,e.next=13,t.isStored("m.cross_signing.".concat(s),!1);case 13:if(e.t2=e.sent,e.t2){e.next=16;break}e.t2={};case 16:e.t3=e.t2,(0,e.t1)(e.t3);case 18:i++,e.next=8;break;case 21:return e.abrupt("return",Object.keys(n).length?n:null);case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"isStoredInKeyCache",value:function(){var e=u(a.mark((function e(t){var n,r,i,o;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._cacheCallbacks){e.next=3;break}return e.abrupt("return",!1);case 3:r=0,i=t?[t]:["master","self_signing","user_signing"];case 5:if(!(r<i.length)){e.next=14;break}return o=i[r],e.next=9,n.getCrossSigningKeyCache(o);case 9:if(e.sent){e.next=11;break}return e.abrupt("return",!1);case 11:r++,e.next=5;break;case 14:return e.abrupt("return",!0);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getCrossSigningKeysFromCache",value:function(){var e=u(a.mark((function e(){var t,n,r,i,o,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=new Map,n=this._cacheCallbacks){e.next=4;break}return e.abrupt("return",t);case 4:r=0,i=["master","self_signing","user_signing"];case 5:if(!(r<i.length)){e.next=16;break}return o=i[r],e.next=9,n.getCrossSigningKeyCache(o);case 9:if(s=e.sent){e.next=12;break}return e.abrupt("continue",13);case 12:t.set(o,s);case 13:r++,e.next=5;break;case 16:return e.abrupt("return",t);case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getId",value:function(e){return e=e||"master",this.keys[e]?_(this.keys[e]):null}},{key:"resetKeys",value:function(){var t=u(a.mark((function t(n){var r,i,u,c,l,d,f,p,v,g;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._callbacks.saveCrossSigningKeys){t.next=2;break}throw new Error("No saveCrossSigningKeys callback supplied");case 2:if(!(void 0===n||n&k.MASTER)&&this.keys.master){t.next=6;break}n=k.MASTER|k.USER_SIGNING|k.SELF_SIGNING,t.next=8;break;case 6:if(0!==n){t.next=8;break}return t.abrupt("return");case 8:if(r={},i={},t.prev=10,!(n&k.MASTER)){t.next=18;break}u=new e.Olm.PkSigning,r.master=u.generate_seed(),c=u.init_with_seed(r.master),i.master={user_id:this.userId,usage:["master"],keys:s({},"ed25519:"+c,c)},t.next=24;break;case 18:return t.next=20,this.getCrossSigningKey("master");case 20:l=t.sent,d=o(l,2),c=d[0],u=d[1];case 24:if(n&k.SELF_SIGNING){f=new e.Olm.PkSigning;try{r.self_signing=f.generate_seed(),p=f.init_with_seed(r.self_signing),i.self_signing={user_id:this.userId,usage:["self_signing"],keys:s({},"ed25519:"+p,p)},(0,h.pkSign)(i.self_signing,u,this.userId,c)}finally{f.free()}}if(n&k.USER_SIGNING){v=new e.Olm.PkSigning;try{r.user_signing=v.generate_seed(),g=v.init_with_seed(r.user_signing),i.user_signing={user_id:this.userId,usage:["user_signing"],keys:s({},"ed25519:"+g,g)},(0,h.pkSign)(i.user_signing,u,this.userId,c)}finally{v.free()}}Object.assign(this.keys,i),this._callbacks.saveCrossSigningKeys(r);case 28:return t.prev=28,u&&u.free(),t.finish(28);case 31:case"end":return t.stop()}}),t,this,[[10,,28,31]])})));return function(e){return t.apply(this,arguments)}}()},{key:"clearKeys",value:function(){this.keys={}}},{key:"setKeys",value:function(e){var t={};if(e.master){if(e.master.user_id!==this.userId){var n="Mismatched user ID "+e.master.user_id+" in master key from "+this.userId;throw g.logger.error(n),new Error(n)}this.keys.master?_(e.master)!==this.getId()&&(this.firstUse=!1):this.firstUse=!0,t.master=e.master}else{if(!this.keys.master)throw new Error("Tried to set cross-signing keys without a master key");t.master=this.keys.master}var r=_(t.master);if(e.user_signing){if(e.user_signing.user_id!==this.userId){var i="Mismatched user ID "+e.master.user_id+" in user_signing key from "+this.userId;throw g.logger.error(i),new Error(i)}try{(0,h.pkVerify)(e.user_signing,r,this.userId)}catch(s){throw g.logger.error("invalid signature on user-signing key"),s}}if(e.self_signing){if(e.self_signing.user_id!==this.userId){var o="Mismatched user ID "+e.master.user_id+" in self_signing key from "+this.userId;throw g.logger.error(o),new Error(o)}try{(0,h.pkVerify)(e.self_signing,r,this.userId)}catch(s){throw g.logger.error("invalid signature on self-signing key"),s}}e.master&&(this.keys.master=e.master,this.keys.self_signing=null,this.keys.user_signing=null),e.self_signing&&(this.keys.self_signing=e.self_signing),e.user_signing&&(this.keys.user_signing=e.user_signing)}},{key:"updateCrossSigningVerifiedBefore",value:function(e){!this.crossSigningVerifiedBefore&&e&&(this.crossSigningVerifiedBefore=!0)}},{key:"signObject",value:function(){var e=u(a.mark((function e(t,n){var r,i,s,u;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.keys[n]){e.next=2;break}throw new Error("Attempted to sign with "+n+" key but no such key present");case 2:return e.next=4,this.getCrossSigningKey(n);case 4:return r=e.sent,i=o(r,2),s=i[0],u=i[1],e.prev=8,(0,h.pkSign)(t,u,this.userId,s),e.abrupt("return",t);case 11:return e.prev=11,u.free(),e.finish(11);case 14:case"end":return e.stop()}}),e,this,[[8,,11,14]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"signUser",value:function(){var e=u(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.keys.user_signing){e.next=3;break}return g.logger.info("No user signing key: not signing user"),e.abrupt("return");case 3:return e.abrupt("return",this.signObject(t.keys.master,"user_signing"));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"signDevice",value:function(){var e=u(a.mark((function e(t,n){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t===this.userId){e.next=2;break}throw new Error("Trying to sign ".concat(t,"'s device; can only sign our own device"));case 2:if(this.keys.self_signing){e.next=5;break}return g.logger.info("No self signing key: not signing device"),e.abrupt("return");case 5:return e.abrupt("return",this.signObject({algorithms:n.algorithms,keys:n.keys,device_id:n.deviceId,user_id:t},"self_signing"));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"checkUserTrust",value:function(e){if(this.userId===e.userId&&this.getId()&&this.getId()===e.getId()&&this.getId("self_signing")&&this.getId("self_signing")===e.getId("self_signing"))return new S(!0,!0,this.firstUse);if(!this.keys.user_signing)return new S(!1,!1,e.firstUse);var t,n=e.keys.master,r=this.getId("user_signing");try{(0,h.pkVerify)(n,r,this.userId),t=!0}catch(i){t=!1}return new S(t,e.crossSigningVerifiedBefore,e.firstUse)}},{key:"checkDeviceTrust",value:function(e,t,n,r){var i=this.checkUserTrust(e),o=e.keys.self_signing;if(!o)return new E(!1,!1,n,r);var s=function(e,t){return{algorithms:e.algorithms,keys:e.keys,device_id:e.deviceId,user_id:t,signatures:e.signatures}}(t,e.userId);try{return(0,h.pkVerify)(o,e.getId(),e.userId),(0,h.pkVerify)(s,_(o),e.userId),E.fromUserTrustLevel(i,n,r)}catch(a){return new E(!1,!1,n,r)}}},{key:"getCacheCallbacks",value:function(){return this._cacheCallbacks}}],[{key:"fromStorage",value:function(e,t){var n=new r(t);for(var i in e)e.hasOwnProperty(i)&&(n[i]=e[i]);return n}},{key:"storeInSecretStorage",value:function(){var e=u(a.mark((function e(t,n){var r,s,u,c,l,d;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=i(t),e.prev=1,r.s();case 3:if((s=r.n()).done){e.next=10;break}return u=o(s.value,2),c=u[0],l=u[1],d=(0,h.encodeBase64)(l),e.next=8,n.store("m.cross_signing.".concat(c),d);case 8:e.next=3;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[1,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getFromSecretStorage",value:function(){var e=u(a.mark((function e(t,n){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.get("m.cross_signing.".concat(t));case 2:if(r=e.sent){e.next=5;break}return e.abrupt("return",null);case 5:return e.abrupt("return",(0,h.decodeBase64)(r));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),r}(v.EventEmitter);t.CrossSigningInfo=b;var k={MASTER:4,USER_SIGNING:2,SELF_SIGNING:1};t.CrossSigningLevel=k;var S=function(){function e(t,n,r){c(this,e),this._crossSigningVerified=t,this._crossSigningVerifiedBefore=n,this._tofu=r}return l(e,[{key:"isVerified",value:function(){return this.isCrossSigningVerified()}},{key:"isCrossSigningVerified",value:function(){return this._crossSigningVerified}},{key:"wasCrossSigningVerified",value:function(){return this._crossSigningVerifiedBefore}},{key:"isTofu",value:function(){return this._tofu}}]),e}();t.UserTrustLevel=S;var E=function(){function e(t,n,r,i){c(this,e),this._crossSigningVerified=t,this._tofu=n,this._localVerified=r,this._trustCrossSignedDevices=i}return l(e,[{key:"isVerified",value:function(){return Boolean(this.isLocallyVerified()||this._trustCrossSignedDevices&&this.isCrossSigningVerified())}},{key:"isCrossSigningVerified",value:function(){return this._crossSigningVerified}},{key:"isLocallyVerified",value:function(){return this._localVerified}},{key:"isTofu",value:function(){return this._tofu}}],[{key:"fromUserTrustLevel",value:function(t,n,r){return new e(t._crossSigningVerified,t._tofu,n,r)}}]),e}();function w(){return(w=u(a.mark((function e(t,n,r){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.getUserId()===n){e.next=2;break}return e.abrupt("return");case 2:return g.logger.log("Cross-signing: Self-verification done; requesting keys"),e.abrupt("return",new Promise((function(e,n){var i=t,o=i._crypto._crossSigningInfo,s=new b(o.userId,{getCrossSigningKey:function(){var e=u(a.mark((function e(t){var n,o,s,u;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g.logger.debug("Cross-signing: requesting secret",t,r),n=i.requestSecret("m.cross_signing.".concat(t),[r]),o=n.promise,e.next=4,o;case 4:return s=e.sent,u=(0,h.decodeBase64)(s),e.abrupt("return",Uint8Array.from(u));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},o._cacheCallbacks);s.keys=o.keys;var c=new Promise((function(e,t){setTimeout(e,6e4,new Error("Timeout"))})),l=new Promise(function(){var e=u(a.mark((function e(t){var n,o,s,u;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i._crypto.getSessionBackupPrivateKey();case 2:if(e.sent){e.next=18;break}return g.logger.info("No cached backup key found. Requesting..."),n=i.requestSecret("m.megolm_backup.v1",[r]),e.next=8,n.promise;case 8:return o=e.sent,g.logger.info("Got key backup key, decoding..."),s=(0,h.decodeBase64)(o),g.logger.info("Decoded backup key, storing..."),i._crypto.storeSessionBackupPrivateKey(Uint8Array.from(s)),g.logger.info("Backup key stored. Starting backup restore..."),e.next=16,i.getKeyBackupVersion();case 16:u=e.sent,i.restoreKeyBackupWithCache(void 0,void 0,u).then((function(){g.logger.info("Backup restored.")}));case 18:t();case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());return Promise.race([Promise.all([s.getCrossSigningKey("master"),s.getCrossSigningKey("self_signing"),s.getCrossSigningKey("user_signing"),l]),c]).then(e,n)})).catch((function(e){g.logger.warn("Cross-signing: failure while requesting keys:",e)})));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}t.DeviceTrustLevel=E}).call(this,n(9),n(19).Buffer)},function(e,t,n){"use strict";(function(e){var r=n(2),i=n(10),o=n(3);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAES=function(){return u?v.apply(void 0,arguments):l.apply(void 0,arguments)},t.decryptAES=function(){return u?y.apply(void 0,arguments):f.apply(void 0,arguments)};var s=n(5),a=n(17),u="undefined"!==typeof window&&window.crypto?window.crypto.subtle||window.crypto.webkitSubtle:null,c=new Uint8Array(8);function l(e,t,n,r){return d.apply(this,arguments)}function d(){return(d=o(r.mark((function e(t,n,o,u){var c,l,d,f,p,v,g,y,m;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=(0,s.getCrypto)()){e.next=3;break}throw new Error("No usable crypto implementation");case 3:return(l=u?(0,a.decodeBase64)(u):c.randomBytes(16))[8]&=127,d=h(n,o),f=i(d,2),p=f[0],v=f[1],g=c.createCipheriv("aes-256-ctr",p,l),y=g.update(t,"utf-8","base64")+g.final("base64"),m=c.createHmac("sha256",v).update(y,"base64").digest("base64"),e.abrupt("return",{iv:(0,a.encodeBase64)(l),ciphertext:y,mac:m});case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e,t,n){return p.apply(this,arguments)}function p(){return(p=o(r.mark((function e(t,n,o){var u,c,l,d,f,p;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=(0,s.getCrypto)()){e.next=3;break}throw new Error("No usable crypto implementation");case 3:if(c=h(n,o),l=i(c,2),d=l[0],f=l[1],u.createHmac("sha256",f).update(t.ciphertext,"base64").digest("base64").replace(/=+$/g,"")===t.mac.replace(/=+$/g,"")){e.next=7;break}throw new Error("Error decrypting secret ".concat(o,": bad MAC"));case 7:return p=u.createDecipheriv("aes-256-ctr",d,(0,a.decodeBase64)(t.iv)),e.abrupt("return",p.update(t.ciphertext,"base64","utf-8")+p.final("utf-8"));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(t,n){var r=(0,s.getCrypto)(),i=r.createHmac("sha256",c).update(t).digest(),o=e.alloc(1,1),a=r.createHmac("sha256",i).update(n,"utf-8").update(o).digest();return o[0]=2,[a,r.createHmac("sha256",i).update(a).update(n,"utf-8").update(o).digest()]}function v(e,t,n,r){return g.apply(this,arguments)}function g(){return(g=o(r.mark((function e(t,n,o,s){var c,l,d,f,p,h,v,g;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s?c=(0,a.decodeBase64)(s):(c=new Uint8Array(16),window.crypto.getRandomValues(c)),c[8]&=127,e.next=4,_(n,o);case 4:return l=e.sent,d=i(l,2),f=d[0],p=d[1],h=(new TextEncoder).encode(t),e.next=11,u.encrypt({name:"AES-CTR",counter:c,length:64},f,h);case 11:return v=e.sent,e.next=14,u.sign({name:"HMAC"},p,v);case 14:return g=e.sent,e.abrupt("return",{iv:(0,a.encodeBase64)(c),ciphertext:(0,a.encodeBase64)(v),mac:(0,a.encodeBase64)(g)});case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e,t,n){return m.apply(this,arguments)}function m(){return(m=o(r.mark((function e(t,n,o){var s,c,l,d,f,p;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_(n,o);case 2:return s=e.sent,c=i(s,2),l=c[0],d=c[1],f=(0,a.decodeBase64)(t.ciphertext),e.next=9,u.verify({name:"HMAC"},d,(0,a.decodeBase64)(t.mac),f);case 9:if(e.sent){e.next=11;break}throw new Error("Error decrypting secret ".concat(o,": bad MAC"));case 11:return e.next=13,u.decrypt({name:"AES-CTR",counter:(0,a.decodeBase64)(t.iv),length:64},l,f);case 13:return p=e.sent,e.abrupt("return",(new TextDecoder).decode(new Uint8Array(p)));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e,t){return b.apply(this,arguments)}function b(){return(b=o(r.mark((function e(t,n){var i,o,s,a,l,d;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.importKey("raw",t,{name:"HKDF"},!1,["deriveBits"]);case 2:return i=e.sent,e.next=5,u.deriveBits({name:"HKDF",salt:c,info:(new TextEncoder).encode(n),hash:"SHA-256"},i,512);case 5:return o=e.sent,s=o.slice(0,32),a=o.slice(32),l=u.importKey("raw",s,{name:"AES-CTR"},!1,["encrypt","decrypt"]),d=u.importKey("raw",a,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign","verify"]),e.next=12,Promise.all([l,d]);case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}).call(this,n(19).Buffer)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.randomString=function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;++r)t+=n.charAt(Math.floor(Math.random()*n.length));return t}},function(e,t,n){"use strict";var r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;function s(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(i){return!1}}()?Object.assign:function(e,t){for(var n,a,u=s(e),c=1;c<arguments.length;c++){for(var l in n=Object(arguments[c]))i.call(n,l)&&(u[l]=n[l]);if(r){a=r(n);for(var d=0;d<a.length;d++)o.call(n,a[d])&&(u[a[d]]=n[a[d]])}}return u}},function(e,t,n){"use strict";var r=n(15),i=n(10),o=n(6),s=n(2),a=n(3),u=n(7),c=n(8),l=n(4),d=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.MemoryCryptoStore=void 0;var f=d(n(21)),p=n(1),h=l(n(5));function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){(0,f.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var y=function(){function e(){u(this,e),this._outgoingRoomKeyRequests=[],this._account=null,this._crossSigningKeys=null,this._privateKeys={},this._backupKeys={},this._sessions={},this._sessionProblems={},this._notifiedErrorDevices={},this._inboundGroupSessions={},this._inboundGroupSessionsWithheld={},this._deviceData=null,this._rooms={},this._sessionsNeedingBackup={}}return c(e,[{key:"startup",value:function(){var e=a(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"deleteAllData",value:function(){return Promise.resolve()}},{key:"getOrAddOutgoingRoomKeyRequest",value:function(e){var t=this,n=e.requestBody;return h.promiseTry((function(){var r=t._getOutgoingRoomKeyRequest(n);return r?(p.logger.log("already have key request outstanding for "+"".concat(n.room_id," / ").concat(n.session_id,": ")+"not sending another"),r):(p.logger.log("enqueueing key request for ".concat(n.room_id," / ")+n.session_id),t._outgoingRoomKeyRequests.push(e),e)}))}},{key:"getOutgoingRoomKeyRequest",value:function(e){return Promise.resolve(this._getOutgoingRoomKeyRequest(e))}},{key:"_getOutgoingRoomKeyRequest",value:function(e){var t,n=o(this._outgoingRoomKeyRequests);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(h.deepCompare(r.requestBody,e))return r}}catch(i){n.e(i)}finally{n.f()}return null}},{key:"getOutgoingRoomKeyRequestByState",value:function(e){var t,n=o(this._outgoingRoomKeyRequests);try{for(n.s();!(t=n.n()).done;){var r,i=t.value,s=o(e);try{for(s.s();!(r=s.n()).done;){var a=r.value;if(i.state===a)return Promise.resolve(i)}}catch(u){s.e(u)}finally{s.f()}}}catch(u){n.e(u)}finally{n.f()}return Promise.resolve(null)}},{key:"getAllOutgoingRoomKeyRequestsByState",value:function(e){return Promise.resolve(this._outgoingRoomKeyRequests.filter((function(t){return t.state==e})))}},{key:"getOutgoingRoomKeyRequestsByTarget",value:function(e,t,n){var r,i=[],s=o(this._outgoingRoomKeyRequests);try{for(s.s();!(r=s.n()).done;){var a,u=r.value,c=o(n);try{for(c.s();!(a=c.n()).done;){var l=a.value;u.state===l&&u.recipients.includes({userId:e,deviceId:t})&&i.push(u)}}catch(d){c.e(d)}finally{c.f()}}}catch(d){s.e(d)}finally{s.f()}return Promise.resolve(i)}},{key:"updateOutgoingRoomKeyRequest",value:function(e,t,n){var r,i=o(this._outgoingRoomKeyRequests);try{for(i.s();!(r=i.n()).done;){var s=r.value;if(s.requestId===e)return s.state!=t?(p.logger.warn("Cannot update room key request from ".concat(t," ")+"as it was already updated to ".concat(s.state)),Promise.resolve(null)):(Object.assign(s,n),Promise.resolve(s))}}catch(a){i.e(a)}finally{i.f()}return Promise.resolve(null)}},{key:"deleteOutgoingRoomKeyRequest",value:function(e,t){for(var n=0;n<this._outgoingRoomKeyRequests.length;n++){var r=this._outgoingRoomKeyRequests[n];if(r.requestId===e)return r.state!=t?(p.logger.warn("Cannot delete room key request in state ".concat(r.state," ")+"(expected ".concat(t,")")),Promise.resolve(null)):(this._outgoingRoomKeyRequests.splice(n,1),Promise.resolve(r))}return Promise.resolve(null)}},{key:"getAccount",value:function(e,t){t(this._account)}},{key:"storeAccount",value:function(e,t){this._account=t}},{key:"getCrossSigningKeys",value:function(e,t){t(this._crossSigningKeys)}},{key:"getSecretStorePrivateKey",value:function(e,t,n){return t(this._privateKeys[n]||null)}},{key:"storeCrossSigningKeys",value:function(e,t){this._crossSigningKeys=t}},{key:"storeSecretStorePrivateKey",value:function(e,t,n){this._privateKeys[t]=n}},{key:"countEndToEndSessions",value:function(e,t){return Object.keys(this._sessions).length}},{key:"getEndToEndSession",value:function(e,t,n,r){r((this._sessions[e]||{})[t]||null)}},{key:"getEndToEndSessions",value:function(e,t,n){n(this._sessions[e]||{})}},{key:"getAllEndToEndSessions",value:function(e,t){Object.entries(this._sessions).forEach((function(e){var n=i(e,2),r=n[0],o=n[1];Object.entries(o).forEach((function(e){var n=i(e,2),o=n[0],s=n[1];t(g(g({},s),{},{deviceKey:r,sessionId:o}))}))}))}},{key:"storeEndToEndSession",value:function(e,t,n,r){var i=this._sessions[e];void 0===i&&(i={},this._sessions[e]=i),i[t]=n}},{key:"storeEndToEndSessionProblem",value:function(){var e=a(s.mark((function e(t,n,r){var i;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(i=this._sessionProblems[t]=this._sessionProblems[t]||[]).push({type:n,fixed:r,time:Date.now()}),i.sort((function(e,t){return e.time-t.time}));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getEndToEndSessionProblem",value:function(){var e=a(s.mark((function e(t,n){var r,i,a,u,c;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=this._sessionProblems[t]||[]).length){e.next=3;break}return e.abrupt("return",null);case 3:i=r[r.length-1],a=o(r),e.prev=5,a.s();case 7:if((u=a.n()).done){e.next=13;break}if(!((c=u.value).time>n)){e.next=11;break}return e.abrupt("return",Object.assign({},c,{fixed:i.fixed}));case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),a.e(e.t0);case 18:return e.prev=18,a.f(),e.finish(18);case 21:if(!i.fixed){e.next=25;break}return e.abrupt("return",null);case 25:return e.abrupt("return",i);case 26:case"end":return e.stop()}}),e,this,[[5,15,18,21]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"filterOutNotifiedErrorDevices",value:function(){var e=a(s.mark((function e(t){var n,i,a,u,c,l,d;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this._notifiedErrorDevices,i=[],a=o(t);try{for(a.s();!(u=a.n()).done;)c=u.value,l=c.userId,d=c.deviceInfo,l in n?d.deviceId in n[l]||(i.push(c),n[l][d.deviceId]=!0):(i.push(c),n[l]=r({},d.deviceId,!0))}catch(s){a.e(s)}finally{a.f()}return e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getEndToEndInboundGroupSession",value:function(e,t,n,r){var i=e+"/"+t;r(this._inboundGroupSessions[i]||null,this._inboundGroupSessionsWithheld[i]||null)}},{key:"getAllEndToEndInboundGroupSessions",value:function(e,t){for(var n=0,r=Object.keys(this._inboundGroupSessions);n<r.length;n++){var i=r[n];t({senderKey:i.substr(0,43),sessionId:i.substr(44),sessionData:this._inboundGroupSessions[i]})}t(null)}},{key:"addEndToEndInboundGroupSession",value:function(e,t,n,r){var i=e+"/"+t;void 0===this._inboundGroupSessions[i]&&(this._inboundGroupSessions[i]=n)}},{key:"storeEndToEndInboundGroupSession",value:function(e,t,n,r){this._inboundGroupSessions[e+"/"+t]=n}},{key:"storeEndToEndInboundGroupSessionWithheld",value:function(e,t,n,r){var i=e+"/"+t;this._inboundGroupSessionsWithheld[i]=n}},{key:"getEndToEndDeviceData",value:function(e,t){t(this._deviceData)}},{key:"storeEndToEndDeviceData",value:function(e,t){this._deviceData=e}},{key:"storeEndToEndRoom",value:function(e,t,n){this._rooms[e]=t}},{key:"getEndToEndRooms",value:function(e,t){t(this._rooms)}},{key:"getSessionsNeedingBackup",value:function(e){var t=[];for(var n in this._sessionsNeedingBackup)if(this._inboundGroupSessions[n]&&(t.push({senderKey:n.substr(0,43),sessionId:n.substr(44),sessionData:this._inboundGroupSessions[n]}),e&&n.length>=e))break;return Promise.resolve(t)}},{key:"countSessionsNeedingBackup",value:function(){return Promise.resolve(Object.keys(this._sessionsNeedingBackup).length)}},{key:"unmarkSessionsNeedingBackup",value:function(e){var t,n=o(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.senderKey+"/"+r.sessionId;delete this._sessionsNeedingBackup[i]}}catch(s){n.e(s)}finally{n.f()}return Promise.resolve()}},{key:"markSessionsNeedingBackup",value:function(e){var t,n=o(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.senderKey+"/"+r.sessionId;this._sessionsNeedingBackup[i]=!0}}catch(s){n.e(s)}finally{n.f()}return Promise.resolve()}},{key:"doTxn",value:function(e,t,n){return Promise.resolve(n(null))}}]),e}();t.MemoryCryptoStore=y},function(e,t,n){var r=n(58);e.exports=function(e,t){if(e){if("string"===typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}},function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,r)}e.exports=n},function(e,t,n){"use strict";var r=n(97),i=n(99);function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=_,t.resolve=function(e,t){return _(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?_(e,!1,!0).resolveObject(t):t},t.format=function(e){i.isString(e)&&(e=_(e));return e instanceof o?e.format():o.prototype.format.call(e)},t.Url=o;var s=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,u=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),l=["'"].concat(c),d=["%","/","?",";","#"].concat(l),f=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,h=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,v={javascript:!0,"javascript:":!0},g={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},m=n(100);function _(e,t,n){if(e&&i.isObject(e)&&e instanceof o)return e;var r=new o;return r.parse(e,t,n),r}o.prototype.parse=function(e,t,n){if(!i.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var o=e.indexOf("?"),a=-1!==o&&o<e.indexOf("#")?"?":"#",c=e.split(a);c[0]=c[0].replace(/\\/g,"/");var _=e=c.join(a);if(_=_.trim(),!n&&1===e.split("#").length){var b=u.exec(_);if(b)return this.path=_,this.href=_,this.pathname=b[1],b[2]?(this.search=b[2],this.query=t?m.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var k=s.exec(_);if(k){var S=(k=k[0]).toLowerCase();this.protocol=S,_=_.substr(k.length)}if(n||k||_.match(/^\/\/[^@\/]+@[^@\/]+/)){var E="//"===_.substr(0,2);!E||k&&g[k]||(_=_.substr(2),this.slashes=!0)}if(!g[k]&&(E||k&&!y[k])){for(var w,x,I=-1,T=0;T<f.length;T++){-1!==(R=_.indexOf(f[T]))&&(-1===I||R<I)&&(I=R)}-1!==(x=-1===I?_.lastIndexOf("@"):_.lastIndexOf("@",I))&&(w=_.slice(0,x),_=_.slice(x+1),this.auth=decodeURIComponent(w)),I=-1;for(T=0;T<d.length;T++){var R;-1!==(R=_.indexOf(d[T]))&&(-1===I||R<I)&&(I=R)}-1===I&&(I=_.length),this.host=_.slice(0,I),_=_.slice(I),this.parseHost(),this.hostname=this.hostname||"";var O="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!O)for(var C=this.hostname.split(/\./),D=(T=0,C.length);T<D;T++){var P=C[T];if(P&&!P.match(p)){for(var A="",M=0,U=P.length;M<U;M++)P.charCodeAt(M)>127?A+="x":A+=P[M];if(!A.match(p)){var N=C.slice(0,T),L=C.slice(T+1),K=P.match(h);K&&(N.push(K[1]),L.unshift(K[2])),L.length&&(_="/"+L.join(".")+_),this.hostname=N.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),O||(this.hostname=r.toASCII(this.hostname));var B=this.port?":"+this.port:"",j=this.hostname||"";this.host=j+B,this.href+=this.host,O&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==_[0]&&(_="/"+_))}if(!v[S])for(T=0,D=l.length;T<D;T++){var q=l[T];if(-1!==_.indexOf(q)){var F=encodeURIComponent(q);F===q&&(F=escape(q)),_=_.split(q).join(F)}}var V=_.indexOf("#");-1!==V&&(this.hash=_.substr(V),_=_.slice(0,V));var G=_.indexOf("?");if(-1!==G?(this.search=_.substr(G),this.query=_.substr(G+1),t&&(this.query=m.parse(this.query)),_=_.slice(0,G)):t&&(this.search="",this.query={}),_&&(this.pathname=_),y[S]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){B=this.pathname||"";var H=this.search||"";this.path=B+H}return this.href=this.format(),this},o.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",o=!1,s="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&i.isObject(this.query)&&Object.keys(this.query).length&&(s=m.stringify(this.query));var a=this.search||s&&"?"+s||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||y[t])&&!1!==o?(o="//"+(o||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):o||(o=""),r&&"#"!==r.charAt(0)&&(r="#"+r),a&&"?"!==a.charAt(0)&&(a="?"+a),t+o+(n=n.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(a=a.replace("#","%23"))+r},o.prototype.resolve=function(e){return this.resolveObject(_(e,!1,!0)).format()},o.prototype.resolveObject=function(e){if(i.isString(e)){var t=new o;t.parse(e,!1,!0),e=t}for(var n=new o,r=Object.keys(this),s=0;s<r.length;s++){var a=r[s];n[a]=this[a]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var u=Object.keys(e),c=0;c<u.length;c++){var l=u[c];"protocol"!==l&&(n[l]=e[l])}return y[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!y[e.protocol]){for(var d=Object.keys(e),f=0;f<d.length;f++){var p=d[f];n[p]=e[p]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||g[e.protocol])n.pathname=e.pathname;else{for(var h=(e.pathname||"").split("/");h.length&&!(e.host=h.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==h[0]&&h.unshift(""),h.length<2&&h.unshift(""),n.pathname=h.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var v=n.pathname||"",m=n.search||"";n.path=v+m}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var _=n.pathname&&"/"===n.pathname.charAt(0),b=e.host||e.pathname&&"/"===e.pathname.charAt(0),k=b||_||n.host&&e.pathname,S=k,E=n.pathname&&n.pathname.split("/")||[],w=(h=e.pathname&&e.pathname.split("/")||[],n.protocol&&!y[n.protocol]);if(w&&(n.hostname="",n.port=null,n.host&&(""===E[0]?E[0]=n.host:E.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===h[0]?h[0]=e.host:h.unshift(e.host)),e.host=null),k=k&&(""===h[0]||""===E[0])),b)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,E=h;else if(h.length)E||(E=[]),E.pop(),E=E.concat(h),n.search=e.search,n.query=e.query;else if(!i.isNullOrUndefined(e.search)){if(w)n.hostname=n.host=E.shift(),(O=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=O.shift(),n.host=n.hostname=O.shift());return n.search=e.search,n.query=e.query,i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!E.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var x=E.slice(-1)[0],I=(n.host||e.host||E.length>1)&&("."===x||".."===x)||""===x,T=0,R=E.length;R>=0;R--)"."===(x=E[R])?E.splice(R,1):".."===x?(E.splice(R,1),T++):T&&(E.splice(R,1),T--);if(!k&&!S)for(;T--;T)E.unshift("..");!k||""===E[0]||E[0]&&"/"===E[0].charAt(0)||E.unshift(""),I&&"/"!==E.join("/").substr(-1)&&E.push("");var O,C=""===E[0]||E[0]&&"/"===E[0].charAt(0);w&&(n.hostname=n.host=C?"":E.length?E.shift():"",(O=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=O.shift(),n.host=n.hostname=O.shift()));return(k=k||n.host&&E.length)&&!C&&E.unshift(""),E.length?n.pathname=E.join("/"):(n.pathname=null,n.path=null),i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},o.prototype.parseHost=function(){var e=this.host,t=a.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,t,n){"use strict";var r=n(6);Object.defineProperty(t,"__esModule",{value:!0}),t.PushProcessor=u;var i=n(5),o=n(1),s=["override","content","room","sender","underride"],a=[{rule_id:".m.rule.tombstone",default:!0,enabled:!0,conditions:[{kind:"event_match",key:"type",pattern:"m.room.tombstone"},{kind:"event_match",key:"state_key",pattern:""}],actions:["notify",{set_tweak:"highlight",value:!0}]},{rule_id:".m.rule.reaction",default:!0,enabled:!0,conditions:[{kind:"event_match",key:"type",pattern:"m.reaction"}],actions:["dont_notify"]}];function u(e){var t=this,n={},o=function(e,t){var n={rule_id:t.rule_id,actions:t.actions,conditions:[]};switch(e){case"underride":case"override":n.conditions=t.conditions;break;case"room":if(!t.rule_id)return null;n.conditions.push({kind:"event_match",key:"room_id",value:t.rule_id});break;case"sender":if(!t.rule_id)return null;n.conditions.push({kind:"event_match",key:"user_id",value:t.rule_id});break;case"content":if(!t.pattern)return null;n.conditions.push({kind:"event_match",key:"content.body",pattern:t.pattern})}return n},a=function(e,t){var n={event_match:f,contains_display_name:d,room_member_count:l,sender_notification_permission:c};return!!n[e.kind]&&n[e.kind](e,t)},c=function(t,n){var r=t.key;if(!r)return!1;var i=e.getRoom(n.getRoomId());return!(!i||!i.currentState)&&i.currentState.mayTriggerNotifOfType(r,n.getSender())},l=function(t,n){if(!t.is)return!1;var r=e.getRoom(n.getRoomId());if(!r||!r.currentState||!r.currentState.members)return!1;var i=r.currentState.getJoinedMemberCount(),o=t.is.match(/^([=<>]*)([0-9]*)$/);if(!o)return!1;var s=o[1],a=parseInt(o[2]);if(isNaN(a))return!1;switch(s){case"":case"==":return i==a;case"<":return i<a;case">":return i>a;case"<=":return i<=a;case">=":return i>=a;default:return!1}},d=function(t,n){var r=n.getContent();if(n.isEncrypted()&&n.getClearContent()&&(r=n.getClearContent()),!r||!r.body||"string"!=typeof r.body)return!1;var o=e.getRoom(n.getRoomId());if(!o||!o.currentState||!o.currentState.members||!o.currentState.getMember(e.credentials.userId))return!1;var s=o.currentState.getMember(e.credentials.userId).name,a=new RegExp("(^|\\W)"+(0,i.escapeRegExp)(s)+"(\\W|$)","i");return r.body.search(a)>-1},f=function(e,t){if(!e.key)return!1;var n,r=h(e.key,t);return"string"===typeof r&&(e.value?e.value===r:(n="content.body"==e.key?p("(^|\\W)",e.pattern,"(\\W|$)"):p("^",e.pattern,"$"),!!r.match(n)))},p=function(e,t,r){return n[t]||(n[t]=new RegExp(e+(0,i.globToRegexp)(t)+r,"i")),n[t]},h=function(e,t){var n,r=e.split("."),o=r[0];for("content"===o?(n=t.getContent(),r.shift()):"type"===o?(n=t.getType(),r.shift()):n=t.event;r.length>0;){var s=r.shift();if((0,i.isNullOrUndefined)(n[s]))return null;n=n[s]}return n},v=function(n,r){return r?n.getSender()===e.credentials.userId?null:function(e,n){for(var r=0;r<s.length;++r){var i=s[r],a=n[i];if(a)for(var u=0;u<a.length;++u){var c=a[u];if(c.enabled){var l=o(i,c);if(l&&t.ruleMatchesEvent(l,e))return c.kind=i,c}}}return null}(n,r.global):null};this.ruleMatchesEvent=function(e,t){for(var n=!0,r=0;r<e.conditions.length;++r){var i=e.conditions[r];n&=a(i,t)}return n},this.actionsForEvent=function(t){return function(e,t){var n=v(e,t);if(!n)return{};var r=u.actionListToActionsObject(n.actions);return void 0===r.tweaks.highlight&&(r.tweaks.highlight="content"==n.kind),r}(t,e.pushRules)},this.getPushRuleById=function(t){for(var n=0,i=["global"];n<i.length;n++){var o=i[n];if(void 0!==e.pushRules[o]){var a,u=r(s);try{for(u.s();!(a=u.n()).done;){var c=a.value;if(void 0!==e.pushRules[o][c]){var l,d=r(e.pushRules[o][c]);try{for(d.s();!(l=d.n()).done;){var f=l.value;if(f.rule_id===t)return f}}catch(p){d.e(p)}finally{d.f()}}}}catch(p){u.e(p)}finally{u.f()}}}return null}}u.actionListToActionsObject=function(e){for(var t={notify:!1,tweaks:{}},n=0;n<e.length;++n){var r=e[n];"notify"===r?t.notify=!0:"object"===typeof r&&(void 0===r.value&&(r.value=!0),t.tweaks[r.set_tweak]=r.value)}return t},u.rewriteDefaultRules=function(e){var t=JSON.parse(JSON.stringify(e));t||(t={}),t.global||(t.global={}),t.global.override||(t.global.override=[]);var n,i=t.global.override,s=r(a);try{var u=function(){var e=n.value,t=i.find((function(t){return t.rule_id===e.rule_id}));if(t)t.default=e.default,t.conditions=e.conditions,t.actions=e.actions;else{var r=e.rule_id;o.logger.warn("Adding default global override for ".concat(r)),i.push(e)}};for(s.s();!(n=s.n()).done;)u()}catch(c){s.e(c)}finally{s.f()}return t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Filter=o;var r=n(109);function i(e,t,n){for(var r=t.split("."),i=e,o=0;o<r.length-1;o++)i[r[o]]||(i[r[o]]={}),i=i[r[o]];i[r[r.length-1]]=n}function o(e,t){this.userId=e,this.filterId=t,this.definition={}}o.LAZY_LOADING_MESSAGES_FILTER={lazy_load_members:!0},o.prototype.getFilterId=function(){return this.filterId},o.prototype.getDefinition=function(){return this.definition},o.prototype.setDefinition=function(e){this.definition=e;var t=e.room,n={};t&&(t.rooms&&(n.rooms=t.rooms),t.rooms&&(n.not_rooms=t.not_rooms),this._include_leave=t.include_leave||!1),this._room_filter=new r.FilterComponent(n),this._room_timeline_filter=new r.FilterComponent(t&&t.timeline||{})},o.prototype.getRoomTimelineFilterComponent=function(){return this._room_timeline_filter},o.prototype.filterRoomTimeline=function(e){return this._room_timeline_filter.filter(this._room_filter.filter(e))},o.prototype.setTimelineLimit=function(e){i(this.definition,"room.timeline.limit",e)},o.prototype.setLazyLoadMembers=function(e){i(this.definition,"room.state.lazy_load_members",!!e)},o.prototype.setIncludeLeaveRooms=function(e){i(this.definition,"room.include_leave",e)},o.fromJson=function(e,t,n){var r=new o(e,t);return r.setDefinition(n),r}},function(e,t,n){"use strict";var r=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.RoomMember=a;var i=n(11),o=n(34),s=r(n(5));function a(e,t){this.roomId=e,this.userId=t,this.typing=!1,this.name=t,this.rawDisplayName=t,this.powerLevel=0,this.powerLevelNorm=0,this.user=null,this.membership=null,this.events={member:null},this._isOutOfBand=!1,this._updateModifiedTime()}s.inherits(a,i.EventEmitter),a.prototype.markOutOfBand=function(){this._isOutOfBand=!0},a.prototype.isOutOfBand=function(){return this._isOutOfBand},a.prototype.setMembershipEvent=function(e,t){if("m.room.member"===e.getType()){this._isOutOfBand=!1,this.events.member=e;var n=this.membership;this.membership=e.getDirectionalContent().membership;var r=this.name;this.name=function(e,t,n){if(!t||t===e)return e;if(!s.removeHiddenChars(t))return e;if(!n)return t;var r=/@.+:.+/.test(t);r||(r=/[\u200E\u200F\u202A-\u202F]/.test(t));if(!r){r=n.getUserIdsWithDisplayName(t).some((function(t){return t!==e}))}if(r)return t+" ("+e+")";return t}(this.userId,e.getDirectionalContent().displayname,t),this.rawDisplayName=e.getDirectionalContent().displayname||this.userId,n!==this.membership&&(this._updateModifiedTime(),this.emit("RoomMember.membership",e,this,n)),r!==this.name&&(this._updateModifiedTime(),this.emit("RoomMember.name",e,this,r))}},a.prototype.setPowerLevelEvent=function(e){if("m.room.power_levels"===e.getType()){var t=e.getDirectionalContent(),n=t.users_default||0;s.forEach(s.values(t.users),(function(e){n=Math.max(n,e)}));var r=this.powerLevel,i=this.powerLevelNorm;t.users&&void 0!==t.users[this.userId]?this.powerLevel=t.users[this.userId]:void 0!==t.users_default?this.powerLevel=t.users_default:this.powerLevel=0,this.powerLevelNorm=0,n>0&&(this.powerLevelNorm=100*this.powerLevel/n),r===this.powerLevel&&i===this.powerLevelNorm||(this._updateModifiedTime(),this.emit("RoomMember.powerLevel",e,this))}},a.prototype.setTypingEvent=function(e){if("m.typing"===e.getType()){var t=this.typing;this.typing=!1;var n=e.getContent().user_ids;s.isArray(n)&&(-1!==n.indexOf(this.userId)&&(this.typing=!0),t!==this.typing&&(this._updateModifiedTime(),this.emit("RoomMember.typing",e,this)))}},a.prototype._updateModifiedTime=function(){this._modified=Date.now()},a.prototype.getLastModifiedTime=function(){return this._modified},a.prototype.isKicked=function(){return"leave"===this.membership&&this.events.member.getSender()!==this.events.member.getStateKey()},a.prototype.getDMInviter=function(){if(this.events.member){var e=this.events.member,t=e.getContent(),n=e.getSender();if("join"===t.membership&&(t=e.getPrevContent(),n=e.getUnsigned().prev_sender),"invite"===t.membership&&t.is_direct)return n}},a.prototype.getAvatarUrl=function(e,t,n,r,i,s){void 0===i&&(i=!0);var a=this.getMxcAvatarUrl();if(!a&&!i)return null;var u=(0,o.getHttpUriForMxc)(e,a,t,n,r,s);return u||null},a.prototype.getMxcAvatarUrl=function(){return this.events.member?this.events.member.getDirectionalContent().avatar_url:this.user?this.user.avatarUrl:null}},function(e,t,n){"use strict";var r=n(6),i=n(7),o=n(8);Object.defineProperty(t,"__esModule",{value:!0}),t.ReEmitter=void 0;var s=function(){function e(t){i(this,e),this.target=t,this.boundHandlers={}}return o(e,[{key:"_handleEvent",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.target).emit.apply(t,[e].concat(r))}},{key:"reEmit",value:function(e,t){var n,i=function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.apply(void 0,r.concat([e]))},o=r(t);try{for(o.s();!(n=o.n()).done;){var s=n.value;void 0===this.boundHandlers[s]&&(this.boundHandlers[s]=this._handleEvent.bind(this,s));var a=i.bind(this,this.boundHandlers[s]);e.on(s,a)}}catch(u){o.e(u)}finally{o.f()}}}]),e}();t.ReEmitter=s},function(e,t,n){"use strict";var r=n(15),i=n(2),o=n(6),s=n(3),a=n(8),u=n(7),c=n(22),l=n(13),d=n(14),f=n(29),p=n(4),h=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.setAudioOutput=function(e){T=e},t.setAudioInput=function(e){R=e},t.setVideoInput=function(e){O=e},t.createNewMatrixCall=function(e,t,n){if("undefined"===typeof window||"undefined"===typeof document)return S.logger.info("No window or document object: WebRTC is not supported in this environment"),null;try{if(!Boolean(window.RTCPeerConnection||window.RTCSessionDescription||window.RTCIceCandidate||navigator.mediaDevices))return S.logger.error("WebRTC is not supported in this browser / environment"),null}catch(s){return S.logger.error("Exception thrown when trying to access WebRTC",s),null}var r=!!n&&n.forceTURN,i={client:e,roomId:t,turnServers:e.getTurnServers(),forceTURN:e._forceTURN||r},o=new C(i);return e.reEmitter.reEmit(o,Object.values(_)),o},t.MatrixCall=t.CallError=t.CallErrorCode=t.CallEvent=t.CallParty=t.CallDirection=t.CallType=t.CallState=void 0;var v,g,y,m,_,b,k=h(n(21)),S=n(1),E=n(11),w=p(n(5)),x=n(67);t.CallState=v,function(e){e.Fledgling="fledgling",e.InviteSent="invite_sent",e.WaitLocalMedia="wait_local_media",e.CreateOffer="create_offer",e.CreateAnswer="create_answer",e.Connecting="connecting",e.Connected="connected",e.Ringing="ringing",e.Ended="ended"}(v||(t.CallState=v={})),t.CallType=g,function(e){e.Voice="voice",e.Video="video"}(g||(t.CallType=g={})),t.CallDirection=y,function(e){e.Inbound="inbound",e.Outbound="outbound"}(y||(t.CallDirection=y={})),t.CallParty=m,function(e){e.Local="local",e.Remote="remote"}(m||(t.CallParty=m={})),t.CallEvent=_,function(e){e.Hangup="hangup",e.State="state",e.Error="error",e.Replaced="replaced",e.LocalHoldUnhold="local_hold_unhold",e.RemoteHoldUnhold="remote_hold_unhold",e.HoldUnhold="hold_unhold"}(_||(t.CallEvent=_={})),t.CallErrorCode=b,function(e){e.UserHangup="user_hangup",e.LocalOfferFailed="local_offer_failed",e.NoUserMedia="no_user_media",e.UnknownDevices="unknown_devices",e.SendInvite="send_invite",e.CreateAnswer="create_answer",e.SendAnswer="send_answer",e.SetRemoteDescription="set_remote_description",e.SetLocalDescription="set_local_description",e.AnsweredElsewhere="answered_elsewhere",e.IceFailed="ice_failed",e.InviteTimeout="invite_timeout",e.Replaced="replaced",e.SignallingFailed="signalling_timeout"}(b||(t.CallErrorCode=b={}));var I=function(e){l(n,e);var t=d(n);function n(e,r,i){var o;return u(this,n),o=t.call(this,r+": "+i),(0,k.default)(c(o),"code",void 0),o.code=e,o}return n}(f(Error));t.CallError=I;var T,R,O,C=function(e){l(n,e);var t=d(n);function n(e){var a;u(this,n),a=t.call(this),(0,k.default)(c(a),"roomId",void 0),(0,k.default)(c(a),"type",void 0),(0,k.default)(c(a),"callId",void 0),(0,k.default)(c(a),"state",void 0),(0,k.default)(c(a),"hangupParty",void 0),(0,k.default)(c(a),"hangupReason",void 0),(0,k.default)(c(a),"direction",void 0),(0,k.default)(c(a),"ourPartyId",void 0),(0,k.default)(c(a),"client",void 0),(0,k.default)(c(a),"forceTURN",void 0),(0,k.default)(c(a),"turnServers",void 0),(0,k.default)(c(a),"candidateSendQueue",void 0),(0,k.default)(c(a),"candidateSendTries",void 0),(0,k.default)(c(a),"sentEndOfCandidates",void 0),(0,k.default)(c(a),"peerConn",void 0),(0,k.default)(c(a),"localVideoElement",void 0),(0,k.default)(c(a),"remoteVideoElement",void 0),(0,k.default)(c(a),"remoteAudioElement",void 0),(0,k.default)(c(a),"screenSharingStream",void 0),(0,k.default)(c(a),"remoteStream",void 0),(0,k.default)(c(a),"localAVStream",void 0),(0,k.default)(c(a),"inviteOrAnswerSent",void 0),(0,k.default)(c(a),"waitForLocalAVStream",void 0),(0,k.default)(c(a),"msg",void 0),(0,k.default)(c(a),"config",void 0),(0,k.default)(c(a),"successor",void 0),(0,k.default)(c(a),"opponentMember",void 0),(0,k.default)(c(a),"opponentVersion",void 0),(0,k.default)(c(a),"opponentPartyId",void 0),(0,k.default)(c(a),"inviteTimeout",void 0),(0,k.default)(c(a),"remoteOnHold",void 0),(0,k.default)(c(a),"unholdingRemote",void 0),(0,k.default)(c(a),"micMuted",void 0),(0,k.default)(c(a),"vidMuted",void 0),(0,k.default)(c(a),"makingOffer",void 0),(0,k.default)(c(a),"ignoreOffer",void 0),(0,k.default)(c(a),"gotUserMediaForInvite",function(){var e=s(i.mark((function e(t){var n,r,s,u,c,l,d;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.successor){e.next=3;break}return a.successor.gotUserMediaForAnswer(t),e.abrupt("return");case 3:if(!a.callHasEnded()){e.next=5;break}return e.abrupt("return");case 5:if(a.setState(v.CreateOffer),S.logger.debug("gotUserMediaForInvite -> "+a.type),!(n=a.getLocalVideoElement())||a.type!==g.Video){e.next=20;break}return n.autoplay=!0,a.screenSharingStream?(S.logger.debug("Setting screen sharing stream to the local video element"),n.srcObject=a.screenSharingStream):n.srcObject=t,n.muted=!0,e.prev=12,e.next=15,n.play();case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(12),S.logger.info("Failed to play local video element",e.t0);case 20:a.localAVStream=t,S.logger.info("Got local AV stream with id "+a.localAVStream.id),D(t.getAudioTracks(),!0),a.peerConn=a.createPeerConnection(),r=o(t.getAudioTracks());try{for(r.s();!(s=r.n()).done;)u=s.value,S.logger.info("Adding audio track with id "+u.id),a.peerConn.addTrack(u,t)}catch(i){r.e(i)}finally{r.f()}c=o((a.screenSharingStream||t).getVideoTracks());try{for(c.s();!(l=c.n()).done;)d=l.value,S.logger.info("Adding audio track with id "+d.id),a.peerConn.addTrack(d,t)}catch(i){c.e(i)}finally{c.f()}case 28:case"end":return e.stop()}}),e,null,[[12,17]])})));return function(t){return e.apply(this,arguments)}}()),(0,k.default)(c(a),"gotUserMediaForAnswer",function(){var e=s(i.mark((function e(t){var n,r,s,u,c;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.callHasEnded()){e.next=2;break}return e.abrupt("return");case 2:if(!(n=a.getLocalVideoElement())||a.type!==g.Video){e.next=15;break}return n.autoplay=!0,n.srcObject=t,n.muted=!0,e.prev=7,e.next=10,n.play();case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(7),S.logger.info("Failed to play local video element",e.t0);case 15:a.localAVStream=t,S.logger.info("Got local AV stream with id "+a.localAVStream.id),D(t.getAudioTracks(),!0),r=o(t.getTracks());try{for(r.s();!(s=r.n()).done;)u=s.value,a.peerConn.addTrack(u,t)}catch(i){r.e(i)}finally{r.f()}return a.setState(v.CreateAnswer),e.prev=21,e.next=24,a.peerConn.createAnswer();case 24:c=e.sent,e.next=32;break;case 27:return e.prev=27,e.t1=e.catch(21),S.logger.debug("Failed to create answer: ",e.t1),a.terminate(m.Local,b.CreateAnswer,!0),e.abrupt("return");case 32:return e.prev=32,e.next=35,a.peerConn.setLocalDescription(c);case 35:return a.setState(v.Connecting),e.next=38,new Promise((function(e){setTimeout(e,200)}));case 38:a.sendAnswer(),e.next=46;break;case 41:return e.prev=41,e.t2=e.catch(32),S.logger.debug("Error setting local description!",e.t2),a.terminate(m.Local,b.SetLocalDescription,!0),e.abrupt("return");case 46:case"end":return e.stop()}}),e,null,[[7,12],[21,27],[32,41]])})));return function(t){return e.apply(this,arguments)}}()),(0,k.default)(c(a),"gotLocalIceCandidate",(function(e){if(e.candidate){if(S.logger.debug("Got local ICE "+e.candidate.sdpMid+" candidate: "+e.candidate.candidate),a.callHasEnded())return;""===e.candidate.candidate&&a.sentEndOfCandidates||(a.queueCandidate(e.candidate),""===e.candidate.candidate&&(a.sentEndOfCandidates=!0))}})),(0,k.default)(c(a),"onIceGatheringStateChange",(function(e){if(S.logger.debug("ice gathering state changed to "+a.peerConn.iceGatheringState),"complete"===a.peerConn.iceGatheringState&&!a.sentEndOfCandidates){a.queueCandidate({candidate:""}),a.sentEndOfCandidates=!0}})),(0,k.default)(c(a),"gotLocalOffer",function(){var e=s(i.mark((function e(t){var n,o,s,u,c,l;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(S.logger.debug("Created offer: ",t),!a.callHasEnded()){e.next=4;break}return S.logger.debug("Ignoring newly created offer on call ID "+a.callId+" because the call has ended"),e.abrupt("return");case 4:return e.prev=4,e.next=7,a.peerConn.setLocalDescription(t);case 7:e.next=14;break;case 9:return e.prev=9,e.t0=e.catch(4),S.logger.debug("Error setting local description!",e.t0),a.terminate(m.Local,b.SetLocalDescription,!0),e.abrupt("return");case 14:if("gathering"!==a.peerConn.iceGatheringState){e.next=17;break}return e.next=17,new Promise((function(e){setTimeout(e,200)}));case 17:if(!a.callHasEnded()){e.next=19;break}return e.abrupt("return");case 19:return o=a.state===v.CreateOffer?"offer":"description",s=a.state===v.CreateOffer?x.EventType.CallInvite:x.EventType.CallNegotiate,r(n={},o,a.peerConn.localDescription),r(n,"lifetime",6e4),u=n,S.logger.info("Discarding ".concat(a.candidateSendQueue.length," candidates that will be sent in offer")),a.candidateSendQueue=[],e.prev=24,e.next=27,a.sendVoipEvent(s,u);case 27:a.sendCandidateQueue(),a.state===v.CreateOffer&&(a.inviteOrAnswerSent=!0,a.setState(v.InviteSent),a.inviteTimeout=setTimeout((function(){a.inviteTimeout=null,a.state===v.InviteSent&&a.hangup(b.InviteTimeout,!1)}),6e4)),e.next=40;break;case 31:e.prev=31,e.t1=e.catch(24),a.client.cancelPendingEvent(e.t1.event),c=b.SignallingFailed,l="Signalling failed",a.state===v.CreateOffer&&(c=b.SendInvite,l="Failed to send invite"),"UnknownDeviceError"==e.t1.name&&(c=b.UnknownDevices,l="Unknown devices present in the room"),a.emit(_.Error,new I(c,l,e.t1)),a.terminate(m.Local,c,!1);case 40:case"end":return e.stop()}}),e,null,[[4,9],[24,31]])})));return function(t){return e.apply(this,arguments)}}()),(0,k.default)(c(a),"getLocalOfferFailed",(function(e){S.logger.error("Failed to get local offer",e),a.emit(_.Error,new I(b.LocalOfferFailed,"Failed to get local offer!",e)),a.terminate(m.Local,b.LocalOfferFailed,!1)})),(0,k.default)(c(a),"getUserMediaFailed",(function(e){a.successor?a.successor.getUserMediaFailed(e):(S.logger.warn("Failed to get user media - ending call",e),a.emit(_.Error,new I(b.NoUserMedia,"Couldn't start capturing media! Is your microphone set up and does this app have permission?",e)),a.terminate(m.Local,b.NoUserMedia,!1))})),(0,k.default)(c(a),"onIceConnectionStateChanged",(function(){a.callHasEnded()||(S.logger.debug("ICE connection state changed to: "+a.peerConn.iceConnectionState),"connected"==a.peerConn.iceConnectionState?a.setState(v.Connected):"failed"==a.peerConn.iceConnectionState&&a.hangup(b.IceFailed,!1))})),(0,k.default)(c(a),"onSignallingStateChanged",(function(){S.logger.debug("call "+a.callId+": Signalling state changed to: "+a.peerConn.signalingState)})),(0,k.default)(c(a),"onTrack",(function(e){0!==e.streams.length?a.remoteStream&&e.streams[0].id!==a.remoteStream.id?S.logger.warn("Ignoring new stream ID ".concat(e.streams[0].id,": we already have stream ID ").concat(a.remoteStream.id)):(a.remoteStream||S.logger.info("Got remote stream with id "+e.streams[0].id),a.remoteStream=e.streams[0],S.logger.debug("Track id ".concat(e.track.id," of kind ").concat(e.track.kind," added")),"video"===e.track.kind?a.remoteVideoElement&&a.playRemoteVideo():a.remoteAudioElement&&a.playRemoteAudio()):S.logger.warn("Streamless ".concat(e.track.kind," found: ignoring."))})),(0,k.default)(c(a),"onNegotiationNeeded",s(i.mark((function e(){var t;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(S.logger.info("Negotation is needed!"),a.state===v.CreateOffer||0!==a.opponentVersion){e.next=4;break}return S.logger.info("Opponent does not support renegotiation: ignoring negotiationneeded event"),e.abrupt("return");case 4:return a.makingOffer=!0,e.prev=5,e.next=8,a.peerConn.createOffer();case 8:return t=e.sent,e.next=11,a.gotLocalOffer(t);case 11:e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(5),a.getLocalOfferFailed(e.t0),e.abrupt("return");case 17:return e.prev=17,a.makingOffer=!1,e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[5,13,17,20]])})))),(0,k.default)(c(a),"onHangupReceived",(function(e){S.logger.debug("Hangup received"),a.partyIdMatches(e)||void 0===a.opponentPartyId||a.state===v.Ringing?a.terminate(m.Remote,e.reason||b.UserHangup,!0):S.logger.info("Ignoring message from party ID ".concat(e.party_id,": our partner is ").concat(a.opponentPartyId))})),(0,k.default)(c(a),"onRejectReceived",(function(e){S.logger.debug("Reject received"),a.state===v.InviteSent?a.terminate(m.Remote,b.UserHangup,!0):S.logger.debug("Call is in state: ".concat(a.state,": ignoring reject"))})),(0,k.default)(c(a),"onAnsweredElsewhere",(function(e){S.logger.debug("Answered elsewhere"),a.terminate(m.Remote,b.AnsweredElsewhere,!0)})),a.roomId=e.roomId,a.client=e.client,a.type=null,a.forceTURN=e.forceTURN,a.ourPartyId=a.client.deviceId,a.turnServers=e.turnServers||[],0===a.turnServers.length&&a.client.isFallbackICEServerAllowed()&&a.turnServers.push({urls:["stun:turn.matrix.org"]});var l,d=o(a.turnServers);try{for(d.s();!(l=d.n()).done;){var f=l.value;w.checkObjectHasKeys(f,["urls"])}}catch(p){d.e(p)}finally{d.f()}return a.callId="c"+(new Date).getTime()+Math.random(),a.state=v.Fledgling,a.candidateSendQueue=[],a.candidateSendTries=0,a.sentEndOfCandidates=!1,a.inviteOrAnswerSent=!1,a.makingOffer=!1,a.remoteOnHold=!1,a.unholdingRemote=!1,a.micMuted=!1,a.vidMuted=!1,a}return a(n,[{key:"placeVoiceCall",value:function(){S.logger.debug("placeVoiceCall"),this.checkForErrorListener(),this.placeCallWithConstraints(P(g.Voice)),this.type=g.Voice}},{key:"placeVideoCall",value:function(e,t){S.logger.debug("placeVideoCall"),this.checkForErrorListener(),this.localVideoElement=t,this.remoteVideoElement=e,this.placeCallWithConstraints(P(g.Video)),this.type=g.Video}},{key:"placeScreenSharingCall",value:function(){var e=s(i.mark((function e(t,n){var r;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S.logger.debug("placeScreenSharingCall"),this.checkForErrorListener(),this.localVideoElement=n,this.remoteVideoElement=t,e.prev=4,e.next=7,navigator.mediaDevices.getDisplayMedia({audio:!1});case 7:this.screenSharingStream=e.sent,S.logger.debug("Got screen stream, requesting audio stream..."),r=P(g.Voice),this.placeCallWithConstraints(r),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(4),this.emit(_.Error,new I(b.NoUserMedia,"Failed to get screen-sharing stream: ",e.t0));case 16:this.type=g.Video;case 17:case"end":return e.stop()}}),e,this,[[4,13]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getOpponentMember",value:function(){return this.opponentMember}},{key:"getLocalVideoElement",value:function(){return this.localVideoElement}},{key:"getRemoteVideoElement",value:function(){return this.remoteVideoElement}},{key:"getRemoteAudioElement",value:function(){return this.remoteAudioElement}},{key:"setLocalVideoElement",value:function(){var e=s(i.mark((function e(t){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.localVideoElement=t,!t||!this.localAVStream||this.type!==g.Video){e.next=13;break}return t.autoplay=!0,t.srcObject=this.localAVStream,t.muted=!0,e.prev=5,e.next=8,t.play();case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(5),S.logger.info("Failed to play local video element",e.t0);case 13:case"end":return e.stop()}}),e,this,[[5,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"setRemoteVideoElement",value:function(e){e!==this.remoteVideoElement&&(e.autoplay=!0,this.remoteAudioElement&&(e.muted=!0),this.remoteVideoElement=e,this.remoteStream&&this.playRemoteVideo())}},{key:"setRemoteAudioElement",value:function(){var e=s(i.mark((function e(t){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==this.remoteAudioElement){e.next=2;break}return e.abrupt("return");case 2:this.remoteAudioElement=t,this.remoteStream&&this.playRemoteAudio();case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"initWithInvite",value:function(){var e=s(i.mark((function e(t){var n=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.msg=t.getContent(),this.peerConn=this.createPeerConnection(),e.prev=2,e.next=5,this.peerConn.setRemoteDescription(this.msg.offer);case 5:e.next=12;break;case 7:return e.prev=7,e.t0=e.catch(2),S.logger.debug("Failed to set remote description",e.t0),this.terminate(m.Local,b.SetRemoteDescription,!1),e.abrupt("return");case 12:if(this.remoteStream&&0!==this.remoteStream.getTracks().length){e.next=16;break}return S.logger.error("No remote stream or no tracks after setting remote description!"),this.terminate(m.Local,b.SetRemoteDescription,!1),e.abrupt("return");case 16:this.type=this.remoteStream.getTracks().some((function(e){return"video"===e.kind}))?g.Video:g.Voice,this.setState(v.Ringing),this.direction=y.Inbound,this.opponentVersion=this.msg.version,this.opponentPartyId=this.msg.party_id||null,this.opponentMember=t.sender,t.getLocalAge()&&setTimeout((function(){n.state==v.Ringing&&(S.logger.debug("Call invite has expired. Hanging up."),n.hangupParty=m.Remote,n.setState(v.Ended),n.stopAllMedia(),"closed"!=n.peerConn.signalingState&&n.peerConn.close(),n.emit(_.Hangup))}),this.msg.lifetime-t.getLocalAge());case 23:case"end":return e.stop()}}),e,this,[[2,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"initWithHangup",value:function(e){this.msg=e.getContent(),this.setState(v.Ended)}},{key:"answer",value:function(){var e=s(i.mark((function e(){var t,n;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.inviteOrAnswerSent){e.next=2;break}return e.abrupt("return");case 2:if(S.logger.debug("Answering call ".concat(this.callId," of type ").concat(this.type)),this.localAVStream||this.waitForLocalAVStream){e.next=22;break}return t=P(this.type),S.logger.log("Getting user media with constraints",t),this.setState(v.WaitLocalMedia),this.waitForLocalAVStream=!0,e.prev=8,e.next=11,navigator.mediaDevices.getUserMedia(t);case 11:n=e.sent,this.waitForLocalAVStream=!1,this.gotUserMediaForAnswer(n),e.next=20;break;case 16:return e.prev=16,e.t0=e.catch(8),this.getUserMediaFailed(e.t0),e.abrupt("return");case 20:e.next=23;break;case 22:this.localAVStream?this.gotUserMediaForAnswer(this.localAVStream):this.waitForLocalAVStream&&this.setState(v.WaitLocalMedia);case 23:case"end":return e.stop()}}),e,this,[[8,16]])})));return function(){return e.apply(this,arguments)}}()},{key:"replacedBy",value:function(e){S.logger.debug(this.callId+" being replaced by "+e.callId),this.state===v.WaitLocalMedia?(S.logger.debug("Telling new call to wait for local media"),e.waitForLocalAVStream=!0):(this.state===v.CreateOffer||this.state===v.InviteSent)&&(S.logger.debug("Handing local stream to new call"),e.gotUserMediaForAnswer(this.localAVStream),delete this.localAVStream),e.localVideoElement=this.localVideoElement,e.remoteVideoElement=this.remoteVideoElement,e.remoteAudioElement=this.remoteAudioElement,this.successor=e,this.emit(_.Replaced,e),this.hangup(b.Replaced,!0)}},{key:"hangup",value:function(e,t){if(!this.callHasEnded()){S.logger.debug("Ending call "+this.callId),this.terminate(m.Local,e,!t);b.UserHangup,this.sendVoipEvent(x.EventType.CallHangup,{})}}},{key:"reject",value:function(){if(this.state!==v.Ringing)throw Error("Call must be in 'ringing' state to reject!");if(this.opponentVersion<1)return S.logger.info("Opponent version is less than 1 (".concat(this.opponentVersion,"): sending hangup instead of reject")),void this.hangup(b.UserHangup,!0);S.logger.debug("Rejecting call: "+this.callId),this.terminate(m.Local,b.UserHangup,!0),this.sendVoipEvent(x.EventType.CallReject,{})}},{key:"setLocalVideoMuted",value:function(e){this.vidMuted=e,this.updateMuteStatus()}},{key:"isLocalVideoMuted",value:function(){return this.vidMuted}},{key:"setMicrophoneMuted",value:function(e){this.micMuted=e,this.updateMuteStatus()}},{key:"isMicrophoneMuted",value:function(){return this.micMuted}},{key:"isRemoteOnHold",value:function(){return this.remoteOnHold}},{key:"setRemoteOnHold",value:function(e){if(this.isRemoteOnHold()!==e){this.remoteOnHold=e,e||(this.unholdingRemote=!0);var t,n=o(this.peerConn.getTransceivers());try{for(n.s();!(t=n.n()).done;){t.value.direction=e?"inactive":"sendrecv"}}catch(r){n.e(r)}finally{n.f()}this.updateMuteStatus(),e||this.playRemoteAudio(),this.emit(_.RemoteHoldUnhold,this.remoteOnHold)}}},{key:"isLocalOnHold",value:function(){if(this.state!==v.Connected)return!1;if(this.unholdingRemote)return!1;var e,t=!0,n=o(this.peerConn.getTransceivers());try{for(n.s();!(e=n.n()).done;){var r=e.value;["inactive","recvonly"].includes(r.currentDirection)||(t=!1)}}catch(i){n.e(i)}finally{n.f()}return t}},{key:"updateMuteStatus",value:function(){if(this.localAVStream){var e=this.micMuted||this.remoteOnHold;D(this.localAVStream.getAudioTracks(),!e);var t=this.vidMuted||this.remoteOnHold;D(this.localAVStream.getVideoTracks(),!t),this.remoteOnHold?this.remoteAudioElement&&this.remoteAudioElement.srcObject===this.remoteStream?this.remoteAudioElement.muted=!0:this.remoteVideoElement&&this.remoteVideoElement.srcObject===this.remoteStream&&(this.remoteVideoElement.muted=!0):this.playRemoteAudio()}}},{key:"sendAnswer",value:function(){var e=this,t={answer:{sdp:this.peerConn.localDescription.sdp,type:this.peerConn.localDescription.type}};S.logger.info("Discarding ".concat(this.candidateSendQueue.length," candidates that will be sent in answer")),this.candidateSendQueue=[],this.sendVoipEvent(x.EventType.CallAnswer,t).then((function(){e.inviteOrAnswerSent=!0,e.sendCandidateQueue()})).catch((function(t){e.setState(v.Ringing),e.client.cancelPendingEvent(t.event);var n=b.SendAnswer,r="Failed to send answer";throw"UnknownDeviceError"==t.name&&(n=b.UnknownDevices,r="Unknown devices present in the room"),e.emit(_.Error,new I(n,r,t)),t}))}},{key:"onRemoteIceCandidatesReceived",value:function(e){if(!this.callHasEnded())if(this.partyIdMatches(e.getContent())){var t=e.getContent().candidates;if(t){var n,r=o(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;if((null===i.sdpMid||void 0===i.sdpMid)&&(null===i.sdpMLineIndex||void 0===i.sdpMLineIndex))return void S.logger.debug("Ignoring remote ICE candidate with no sdpMid or sdpMLineIndex");S.logger.debug("Got remote ICE "+i.sdpMid+" candidate: "+i.candidate);try{this.peerConn.addIceCandidate(i)}catch(s){this.ignoreOffer||S.logger.info("Failed to add remore ICE candidate",s)}}}catch(s){r.e(s)}finally{r.f()}}else S.logger.info("Ignoring candidates event with no candidates!")}else S.logger.info("Ignoring candidates from party ID ".concat(e.getContent().party_id,": ")+"we have chosen party ID ".concat(this.opponentPartyId))}},{key:"onAnswerReceived",value:function(){var e=s(i.mark((function e(t){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.callHasEnded()){e.next=2;break}return e.abrupt("return");case 2:if(void 0===this.opponentPartyId){e.next=5;break}return S.logger.info("Ignoring answer from party ID ".concat(t.getContent().party_id,": ")+"we already have an answer/reject from ".concat(this.opponentPartyId)),e.abrupt("return");case 5:return this.opponentVersion=t.getContent().version,this.opponentPartyId=t.getContent().party_id||null,this.opponentMember=t.sender,this.setState(v.Connecting),e.prev=9,e.next=12,this.peerConn.setRemoteDescription(t.getContent().answer);case 12:e.next=19;break;case 14:return e.prev=14,e.t0=e.catch(9),S.logger.debug("Failed to set remote description",e.t0),this.terminate(m.Local,b.SetRemoteDescription,!1),e.abrupt("return");case 19:if(null===this.opponentPartyId){e.next=28;break}return e.prev=20,e.next=23,this.sendVoipEvent(x.EventType.CallSelectAnswer,{selected_party_id:this.opponentPartyId});case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(20),S.logger.warn("Failed to send select_answer event",e.t1);case 28:case"end":return e.stop()}}),e,this,[[9,14],[20,25]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onSelectAnswerReceived",value:function(){var e=s(i.mark((function e(t){var n;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.direction===y.Inbound){e.next=3;break}return S.logger.warn("Got select_answer for an outbound call: ignoring"),e.abrupt("return");case 3:if(void 0!==(n=t.getContent().selected_party_id)&&null!==n){e.next=7;break}return S.logger.warn("Got nonsensical select_answer with null/undefined selected_party_id: ignoring"),e.abrupt("return");case 7:n!==this.ourPartyId&&(S.logger.info("Got select_answer for party ID ".concat(n,": we are party ID ").concat(this.ourPartyId,".")),this.terminate(m.Remote,b.AnsweredElsewhere,!0));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onNegotiateReceived",value:function(){var e=s(i.mark((function e(t){var n,r,o,s,a,u;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=t.getContent().description)&&n.sdp&&n.type){e.next=4;break}return S.logger.info("Ignoring invalid m.call.negotiate event"),e.abrupt("return");case 4:if(r=this.direction===y.Inbound,o="offer"===n.type&&(this.makingOffer||"stable"!=this.peerConn.signalingState),this.ignoreOffer=!r&&o,!this.ignoreOffer){e.next=10;break}return S.logger.info("Ignoring colliding negotiate event because we're impolite"),e.abrupt("return");case 10:return s=this.isLocalOnHold(),"answer"===n.type&&(this.unholdingRemote=!1),e.prev=12,e.next=15,this.peerConn.setRemoteDescription(n);case 15:if("offer"!==n.type){e.next=22;break}return e.next=18,this.peerConn.createAnswer();case 18:return a=e.sent,e.next=21,this.peerConn.setLocalDescription(a);case 21:this.sendVoipEvent(x.EventType.CallNegotiate,{description:this.peerConn.localDescription});case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(12),S.logger.warn("Failed to complete negotiation",e.t0);case 27:u=this.isLocalOnHold(),s!==u&&(this.emit(_.LocalHoldUnhold,u),this.emit(_.HoldUnhold,u));case 29:case"end":return e.stop()}}),e,this,[[12,24]])})));return function(t){return e.apply(this,arguments)}}()},{key:"callHasEnded",value:function(){return this.state===v.Ended}},{key:"playRemoteAudio",value:function(){var e=s(i.mark((function e(){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.remoteVideoElement&&(this.remoteVideoElement.muted=!0),this.remoteAudioElement.muted=!1,this.remoteAudioElement.srcObject=this.remoteStream,e.prev=3,!T){e.next=8;break}return S.logger.info("Setting audio sink to "+T+", was "+this.remoteAudioElement.sinkId),e.next=8,this.remoteAudioElement.setSinkId(T);case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),S.logger.warn("Couldn't set requested audio output device: using default",e.t0);case 13:return e.prev=13,e.next=16,this.remoteAudioElement.play();case 16:e.next=21;break;case 18:e.prev=18,e.t1=e.catch(13),S.logger.error("Failed to play remote audio element",e.t1);case 21:case"end":return e.stop()}}),e,this,[[3,10],[13,18]])})));return function(){return e.apply(this,arguments)}}()},{key:"playRemoteVideo",value:function(){var e=s(i.mark((function e(){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.remoteVideoElement.srcObject=this.remoteStream,S.logger.info("playing remote video. stream active? "+this.remoteStream.active),e.prev=2,e.next=5,this.remoteVideoElement.play();case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),S.logger.info("Failed to play remote video element",e.t0);case 10:case"end":return e.stop()}}),e,this,[[2,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"setState",value:function(e){var t=this.state;this.state=e,this.emit(_.State,e,t)}},{key:"sendVoipEvent",value:function(e,t){return this.client.sendEvent(this.roomId,e,Object.assign({},t,{version:1,call_id:this.callId,party_id:this.ourPartyId}))}},{key:"queueCandidate",value:function(e){var t=this;if(this.candidateSendQueue.push(e),this.state!==v.Ringing&&this.inviteOrAnswerSent){var n=this.direction===y.Inbound?500:2e3;0===this.candidateSendTries&&setTimeout((function(){t.sendCandidateQueue()}),n)}}},{key:"terminate",value:function(){var e=s(i.mark((function e(t,n,r){var o,s,a;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.callHasEnded()){e.next=2;break}return e.abrupt("return");case 2:if(this.inviteTimeout&&(clearTimeout(this.inviteTimeout),this.inviteTimeout=null),o=this.getRemoteVideoElement(),s=this.getRemoteAudioElement(),a=this.getLocalVideoElement(),o&&(o.pause(),o.srcObject=null),!s){e.next=18;break}return s.pause(),s.srcObject=null,e.prev=10,e.next=13,this.remoteAudioElement.setSinkId("");case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(10),S.logger.warn("Failed to set sink ID back to default");case 18:a&&(a.pause(),a.srcObject=null),this.hangupParty=t,this.hangupReason=n,this.setState(v.Ended),this.stopAllMedia(),this.peerConn&&"closed"!==this.peerConn.signalingState&&this.peerConn.close(),r&&this.emit(_.Hangup,this);case 25:case"end":return e.stop()}}),e,this,[[10,15]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"stopAllMedia",value:function(){if(S.logger.debug("stopAllMedia (stream=".concat(this.localAVStream,")")),this.localAVStream){var e,t=o(this.localAVStream.getTracks());try{for(t.s();!(e=t.n()).done;){e.value.stop()}}catch(a){t.e(a)}finally{t.f()}}if(this.screenSharingStream){var n,r=o(this.screenSharingStream.getTracks());try{for(r.s();!(n=r.n()).done;){n.value.stop()}}catch(a){r.e(a)}finally{r.f()}}if(this.remoteStream){var i,s=o(this.remoteStream.getTracks());try{for(s.s();!(i=s.n()).done;){i.value.stop()}}catch(a){s.e(a)}finally{s.f()}}}},{key:"checkForErrorListener",value:function(){if(0===this.listeners("error").length)throw new Error("You MUST attach an error listener using call.on('error', function() {})")}},{key:"sendCandidateQueue",value:function(){var e=this;if(0!==this.candidateSendQueue.length){var t=this.candidateSendQueue;this.candidateSendQueue=[],++this.candidateSendTries;var n={candidates:t};S.logger.debug("Attempting to send "+t.length+" candidates"),this.sendVoipEvent(x.EventType.CallCandidates,n).then((function(){e.candidateSendTries=0,e.sendCandidateQueue()}),(function(n){for(var r=0;r<t.length;r++)e.candidateSendQueue.push(t[r]);if(e.candidateSendTries>5)return S.logger.debug("Failed to send candidates on attempt "+e.candidateSendTries+". Giving up for now.",n),void(e.candidateSendTries=0);var i=500*Math.pow(2,e.candidateSendTries);++e.candidateSendTries,S.logger.debug("Failed to send candidates. Retrying in "+i+"ms",n),setTimeout((function(){e.sendCandidateQueue()}),i)}))}}},{key:"placeCallWithConstraints",value:function(){var e=s(i.mark((function e(t){var n;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S.logger.log("Getting user media with constraints",t),this.client._callEventHandler.calls.set(this.callId,this),this.setState(v.WaitLocalMedia),this.direction=y.Outbound,this.config=t,e.prev=5,e.next=8,navigator.mediaDevices.getUserMedia(t);case 8:n=e.sent,this.gotUserMediaForInvite(n),e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(5),this.getUserMediaFailed(e.t0),e.abrupt("return");case 16:case"end":return e.stop()}}),e,this,[[5,12]])})));return function(t){return e.apply(this,arguments)}}()},{key:"createPeerConnection",value:function(){var e=new window.RTCPeerConnection({iceTransportPolicy:this.forceTURN?"relay":void 0,iceServers:this.turnServers});return e.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChanged),e.addEventListener("signalingstatechange",this.onSignallingStateChanged),e.addEventListener("icecandidate",this.gotLocalIceCandidate),e.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),e.addEventListener("track",this.onTrack),e.addEventListener("negotiationneeded",this.onNegotiationNeeded),e}},{key:"partyIdMatches",value:function(e){return(e.party_id||null)===this.opponentPartyId}}]),n}(E.EventEmitter);function D(e,t){for(var n=0;n<e.length;n++)e[n].enabled=t}function P(e){var t=!!navigator.webkitGetUserMedia;switch(e){case g.Voice:return{audio:{deviceId:R?{ideal:R}:void 0},video:!1};case g.Video:return{audio:{deviceId:R?{ideal:R}:void 0},video:{deviceId:O?{ideal:O}:void 0,width:t?{exact:640}:{ideal:640},height:t?{exact:360}:{ideal:360}}}}}t.MatrixCall=C},function(e,t,n){"use strict";var r=n(22),i=n(13),o=n(14),s=n(29),a=n(2),u=n(3),c=n(7),l=n(8);Object.defineProperty(t,"__esModule",{value:!0}),t.registerAlgorithm=function(e,t,n){d[e]=t,f[e]=n},t.UnknownDeviceError=t.DecryptionError=t.DecryptionAlgorithm=t.EncryptionAlgorithm=t.DECRYPTION_CLASSES=t.ENCRYPTION_CLASSES=void 0;var d={};t.ENCRYPTION_CLASSES=d;var f={};t.DECRYPTION_CLASSES=f;var p=function(){function e(t){c(this,e),this._userId=t.userId,this._deviceId=t.deviceId,this._crypto=t.crypto,this._olmDevice=t.olmDevice,this._baseApis=t.baseApis,this._roomId=t.roomId}return l(e,[{key:"prepareToEncrypt",value:function(e){}},{key:"onRoomMembership",value:function(e,t,n){}}]),e}();t.EncryptionAlgorithm=p;var h=function(){function e(t){c(this,e),this._userId=t.userId,this._crypto=t.crypto,this._olmDevice=t.olmDevice,this._baseApis=t.baseApis,this._roomId=t.roomId}return l(e,[{key:"onRoomKeyEvent",value:function(e){}},{key:"importRoomKey",value:function(e){}},{key:"hasKeysForKeyRequest",value:function(e){return Promise.resolve(!1)}},{key:"shareKeysWithDevice",value:function(e){throw new Error("shareKeysWithDevice not supported for this DecryptionAlgorithm")}},{key:"retryDecryptionFromSender",value:function(){var e=u(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}();t.DecryptionAlgorithm=h;var v=function(e){i(n,e);var t=o(n);function n(e,i,o){var s;return c(this,n),(s=t.call(this,i)).code=e,s.name="DecryptionError",s.detailedString=function(e,t){var n=e.name+"[msg: "+e.message;t&&(n+=", "+Object.keys(t).map((function(e){return e+": "+t[e]})).join(", "));return n+="]"}(r(s),o),s}return n}(s(Error));t.DecryptionError=v;var g=function(e){i(n,e);var t=o(n);function n(e,r){var i;return c(this,n),(i=t.call(this,e)).name="UnknownDeviceError",i.devices=r,i}return n}(s(Error));t.UnknownDeviceError=g},function(e,t,n){"use strict";var r=n(2),i=n(15),o=n(10),s=n(3),a=n(8),u=n(7),c=n(13),l=n(14),d=n(29);Object.defineProperty(t,"__esModule",{value:!0}),t.VerificationBase=t.SwitchStartEventError=void 0;var f=n(16),p=n(11),h=n(1),v=n(38),g=n(30),y=n(39),m=new Error("Verification timed out"),_=function(e){c(n,e);var t=l(n);function n(e){var r;return u(this,n),(r=t.call(this)).startEvent=e,r}return n}(d(Error));t.SwitchStartEventError=_;var b=function(e){c(n,e);var t=l(n);function n(e,r,i,o,s,a){var c;return u(this,n),(c=t.call(this))._channel=e,c._baseApis=r,c.userId=i,c.deviceId=o,c.startEvent=s,c.request=a,c.cancelled=!1,c._done=!1,c._promise=null,c._transactionTimeoutTimer=null,c}return a(n,[{key:"_resetTimer",value:function(){var e=this;h.logger.info("Refreshing/starting the verification transaction timeout timer"),null!==this._transactionTimeoutTimer&&clearTimeout(this._transactionTimeoutTimer),this._transactionTimeoutTimer=setTimeout((function(){e._done||e.cancelled||(h.logger.info("Triggering verification timeout"),e.cancel(m))}),6e5)}},{key:"_endTimer",value:function(){null!==this._transactionTimeoutTimer&&(clearTimeout(this._transactionTimeoutTimer),this._transactionTimeoutTimer=null)}},{key:"_send",value:function(e,t){return this._channel.send(e,t)}},{key:"_waitForEvent",value:function(e){var t=this;if(this._done)return Promise.reject(new Error("Verification is already done"));var n=this.request.getEventFromOtherParty(e);return n?Promise.resolve(n):(this._expectedEvent=e,new Promise((function(e,n){t._resolveEvent=e,t._rejectEvent=n})))}},{key:"canSwitchStartEvent",value:function(){return!1}},{key:"switchStartEvent",value:function(e){if(this.canSwitchStartEvent(e))if(h.logger.log("Verification Base: switching verification start event",{restartingFlow:!!this._rejectEvent}),this._rejectEvent){var t=this._rejectEvent;this._rejectEvent=void 0,t(new _(e))}else this.startEvent=e}},{key:"handleEvent",value:function(e){if(!this._done)if(e.getType()===this._expectedEvent)"m.key.verification.done"!==this._expectedEvent&&(this._expectedEvent=void 0,this._rejectEvent=void 0,this._resetTimer(),this._resolveEvent(e));else if("m.key.verification.cancel"===e.getType()){var t=this._reject;if(this._reject=void 0,t){var n=e.getContent(),r=n.reason,i=n.code;t(new Error("Other side cancelled verification "+"because ".concat(r," (").concat(i,")")))}}else if(this._expectedEvent){var o=new Error("Unexpected message: expecting "+this._expectedEvent+" but got "+e.getType());if(this._expectedEvent=void 0,this._rejectEvent){var s=this._rejectEvent;this._rejectEvent=void 0,s(o)}this.cancel(o)}}},{key:"done",value:function(){if(this._endTimer(),!this._done)return this.request.onVerifierFinished(),this._resolve(),(0,y.requestKeysDuringVerification)(this._baseApis,this.userId,this.deviceId)}},{key:"cancel",value:function(e){if(this._endTimer(),!this._done){if(this.cancelled=!0,this.request.onVerifierCancelled(),this.userId&&this.deviceId)if(e===m){var t=(0,g.newTimeoutError)();this._send(t.getType(),t.getContent())}else if(e instanceof f.MatrixEvent){if(e.getSender()!==this.userId){var n=e.getContent();"m.key.verification.cancel"===e.getType()?(n.code=n.code||"m.unknown",n.reason=n.reason||n.body||"Unknown reason",this._send("m.key.verification.cancel",n)):this._send("m.key.verification.cancel",{code:"m.unknown",reason:n.body||"Unknown reason"})}}else this._send("m.key.verification.cancel",{code:"m.unknown",reason:e.toString()});null!==this._promise?this._reject&&this._reject(e):this._promise=Promise.reject(e),this.emit("cancel",e)}}},{key:"verify",value:function(){var e=this;return this._promise||(this._promise=new Promise((function(t,n){e._resolve=function(){e._done=!0,e._endTimer(),t.apply(void 0,arguments)},e._reject=function(){e._done=!0,e._endTimer(),n.apply(void 0,arguments)}})),this._doVerification&&!this._started&&(this._started=!0,this._resetTimer(),Promise.resolve(this._doVerification()).then(this.done.bind(this),this.cancel.bind(this)))),this._promise}},{key:"_verifyKeys",value:function(){var e=s(r.mark((function e(t,n,s){var a,u,c,l,d,f,p,g,y,m,_,b;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=[],u=0,c=Object.entries(n);case 2:if(!(u<c.length)){e.next=23;break}if(l=o(c[u],2),d=l[0],f=l[1],p=d.split(":",2)[1],!(g=this._baseApis.getStoredDevice(t,p))){e.next=12;break}return e.next=9,s(d,g,f);case 9:a.push(p),e.next=20;break;case 12:if(!(y=this._baseApis._crypto._deviceList.getStoredCrossSigningForUser(t))||y.getId()!==p){e.next=19;break}return e.next=16,s(d,v.DeviceInfo.fromStorage({keys:i({},d,p)},p),f);case 16:a.push(p),e.next=20;break;case 19:h.logger.warn("verification: Could not find device ".concat(p," to verify"));case 20:u++,e.next=2;break;case 23:if(a.length){e.next=25;break}throw new Error("No devices could be verified");case 25:h.logger.info("Verification completed! Marking devices verified: ",a),m=0,_=a;case 27:if(!(m<_.length)){e.next=34;break}return b=_[m],e.next=31,this._baseApis.setDeviceVerified(t,b);case 31:m++,e.next=27;break;case 34:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"initiatedByMe",get:function(){if(!this.startEvent)return!0;var e=this.startEvent.getSender(),t=this.startEvent.getContent();return e===this._baseApis.getUserId()&&t.from_device===this._baseApis.getDeviceId()}}]),n}(p.EventEmitter);t.VerificationBase=b},function(e,t,n){"use strict";var r=n(10),i=n(6),o=n(2),s=n(35),a=n(3),u=n(7),c=n(8),l=n(22),d=n(13),f=n(14),p=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.VerificationRequest=t.PHASE_DONE=t.PHASE_CANCELLED=t.PHASE_STARTED=t.PHASE_READY=t.PHASE_REQUESTED=t.PHASE_UNSENT=t.READY_TYPE=t.DONE_TYPE=t.CANCEL_TYPE=t.START_TYPE=t.REQUEST_TYPE=t.EVENT_PREFIX=void 0;var h=p(n(21)),v=n(1),g=n(11),y=n(30),m=n(72),_="m.key.verification.";t.EVENT_PREFIX=_;var b=_+"request";t.REQUEST_TYPE=b;var k=_+"start";t.START_TYPE=k;var S=_+"cancel";t.CANCEL_TYPE=S;var E=_+"done";t.DONE_TYPE=E;var w=_+"ready";t.READY_TYPE=w;t.PHASE_UNSENT=1;t.PHASE_REQUESTED=2;t.PHASE_READY=3;t.PHASE_STARTED=4;t.PHASE_CANCELLED=5;t.PHASE_DONE=6;var x=function(e){d(n,e);var t=f(n);function n(e,r,i){var o;return u(this,n),o=t.call(this),(0,h.default)(l(o),"_cancelOnTimeout",(function(){try{o.initiatedByMe?o.cancel({reason:"Other party didn't accept in time",code:"m.timeout"}):o.cancel({reason:"User didn't accept in time",code:"m.timeout"})}catch(e){v.logger.error("Error while cancelling verification request",e)}})),o.channel=e,o.channel._request=l(o),o._verificationMethods=r,o._client=i,o._commonMethods=[],o._setPhase(1,!1),o._eventsByUs=new Map,o._eventsByThem=new Map,o._observeOnly=!1,o._timeoutTimer=null,o._accepting=!1,o._declining=!1,o._verifierHasFinished=!1,o._cancelled=!1,o._chosenMethod=null,o._qrCodeData=null,o._requestReceivedAt=null,o}return c(n,[{key:"calculateEventTimeout",value:function(e){var t=this.channel.getTimestamp(e)+6e5;if(this._requestReceivedAt&&!this.initiatedByMe&&this.phase<=2){var n=this._requestReceivedAt+12e4;t=Math.min(t,n)}return Math.max(0,t-Date.now())}},{key:"otherPartySupportsMethod",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t&&!this.ready&&!this.started)return!1;var n=this._eventsByThem.get(b)||this._eventsByThem.get(w);if(!n){if(this.started&&this.initiatedByMe){var r=this._eventsByUs.get(k),i=r&&r.getContent(),o=i&&i.method;return e==o}return!1}var s=n.getContent();if(!s)return!1;var a=s.methods;return!!Array.isArray(a)&&a.includes(e)}},{key:"beginKeyVerification",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!this.observeOnly&&!this._verifier){var n=2===this.phase||3===this.phase||1===this.phase&&this.channel.constructor.canCreateRequest(k);if(n){if(this._commonMethods.length&&!this._commonMethods.includes(e))throw(0,y.newUnknownMethodError)();if(this._verifier=this._createVerifier(e,null,t),!this._verifier)throw(0,y.newUnknownMethodError)();this._chosenMethod=e}}return this._verifier}},{key:"sendRequest",value:function(){var e=a(o.mark((function e(){var t;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.observeOnly||1!==this._phase){e.next=4;break}return t=s(this._verificationMethods.keys()),e.next=4,this.channel.send(b,{methods:t});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"cancel",value:function(){var e=a(o.mark((function e(){var t,n,r,i,s,a=arguments;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:{},n=t.reason,r=void 0===n?"User declined":n,i=t.code,s=void 0===i?"m.user":i,this.observeOnly||5===this._phase){e.next=11;break}if(this._declining=!0,this.emit("change"),!this._verifier){e.next=8;break}return e.abrupt("return",this._verifier.cancel((0,y.errorFactory)(s,r)()));case 8:return this._cancellingUserId=this._client.getUserId(),e.next=11,this.channel.send(S,{code:s,reason:r});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"accept",value:function(){var e=a(o.mark((function e(){var t;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.observeOnly||2!==this.phase||this.initiatedByMe){e.next=6;break}return t=s(this._verificationMethods.keys()),this._accepting=!0,this.emit("change"),e.next=6,this.channel.send(w,{methods:t});case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"waitFor",value:function(e){var t=this;return new Promise((function(n,r){var i=function i(){var o=!1;return e(t)?(n(t),o=!0):t.cancelled&&(r(new Error("cancelled")),o=!0),o&&t.off("change",i),o};i()||t.on("change",i)}))}},{key:"_setPhase",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._phase=e,t&&this.emit("change")}},{key:"_getEventByEither",value:function(e){return this._eventsByThem.get(e)||this._eventsByUs.get(e)}},{key:"_getEventBy",value:function(e,t){return t?this._eventsByThem.get(e):this._eventsByUs.get(e)}},{key:"_calculatePhaseTransitions",value:function(){var e=[{phase:1}],t=function(){return e[e.length-1].phase},n=this._eventsByThem.has(b),r=this._getEventBy(b,n);r&&e.push({phase:2,event:r});var i,o=r&&this._getEventBy(w,!n);if(o&&2===t()&&e.push({phase:3,event:o}),o||!r){var s=this._eventsByThem.get(k),a=this._eventsByUs.get(k);i=s&&a?s.getSender()<a.getSender()?s:a:s||a}else i=this._getEventBy(k,!n);if(i){var u=2===t()&&r.getSender()!==i.getSender(),c=1===t()&&this.channel.constructor.canCreateRequest(k);(u||3===t()||c)&&e.push({phase:4,event:i})}var l=this._eventsByUs.get(E);(this._verifierHasFinished||l&&4===t())&&e.push({phase:6});var d=this._getEventByEither(S);return(this._cancelled||d)&&6!==t()?(e.push({phase:5,event:d}),e):e}},{key:"_transitionToPhase",value:function(e){var t=this,n=e.phase,r=e.event;if((2===n||3===n)&&!this._wasSentByOwnDevice(r)){var i=r.getContent();this._commonMethods=i.methods.filter((function(e){return t._verificationMethods.has(e)}))}if(this.observeOnly||2!==n&&4!==n&&3!==n||this.channel.receiveStartFromOtherDevices&&this._wasSentByOwnUser(r)&&!this._wasSentByOwnDevice(r)&&(this._observeOnly=!0),4===n){var o=r.getContent().method;this._verifier||this.observeOnly||(this._verifier=this._createVerifier(o,r),this._verifier?this._chosenMethod=o:this.cancel({code:"m.unknown_method",reason:"Unknown method: ".concat(o)}))}}},{key:"_applyPhaseTransitions",value:function(){var e,t=this,n=this._calculatePhaseTransitions(),r=n.findIndex((function(e){return e.phase===t.phase})),o=n.slice(r+1),s=i(o);try{for(s.s();!(e=s.n()).done;){var a=e.value;this._transitionToPhase(a)}}catch(u){s.e(u)}finally{s.f()}return o}},{key:"_isWinningStartRace",value:function(e){if(e.getType()!==k)return!1;var t,n,r=this._verifier.startEvent;if(this.isSelfVerification)if(r){var i=r.getContent();t=i&&i.from_device}else t=this._client.getDeviceId();else t=r?r.getSender():this._client.getUserId();if(this.isSelfVerification){var o=e.getContent();n=o&&o.from_device}else n=e.getSender();return n<t}},{key:"hasEventId",value:function(e){var t,n=i(this._eventsByUs.values());try{for(n.s();!(t=n.n()).done;){if(t.value.getId()===e)return!0}}catch(s){n.e(s)}finally{n.f()}var r,o=i(this._eventsByThem.values());try{for(o.s();!(r=o.n()).done;){if(r.value.getId()===e)return!0}}catch(s){o.e(s)}finally{o.f()}return!1}},{key:"handleEvent",value:function(){var e=a(o.mark((function e(t,n,r,i,s){var a,u,c,l,d,f;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.done&&!this.cancelled){e.next=2;break}return e.abrupt("return");case 2:if(a=this._observeOnly,this._adjustObserveOnly(n,r),this.observeOnly||i){e.next=9;break}return e.next=7,this._cancelOnError(t,n);case 7:if(!e.sent){e.next=9;break}return e.abrupt("return");case 9:if(!(s?this._eventsByUs.has(t):this._eventsByThem.has(t))){e.next=12;break}return e.abrupt("return");case 12:if(u=this.phase,this._addEvent(t,n,s),c=this._applyPhaseTransitions(),e.prev=15,this._verifier&&!this.observeOnly&&(l=this._isWinningStartRace(n),this._verifier.canSwitchStartEvent(n)&&l?this._verifier.switchStartEvent(n):i||(t===S||this._verifier.events&&this._verifier.events.includes(t))&&this._verifier.handleEvent(n)),!c.length){e.next=30;break}if(!r||!c.some((function(e){return 3===e.phase}))){e.next=24;break}if(!this.otherPartySupportsMethod(m.SCAN_QR_CODE_METHOD,!0)){e.next=24;break}return e.next=23,m.QRCodeData.create(this,this._client);case 23:this._qrCodeData=e.sent;case 24:d=c[c.length-1],f=d.phase,this._setupTimeout(f),this._setPhase(f),e.next=31;break;case 30:this._observeOnly!==a&&this.emit("change");case 31:return e.prev=31,v.logger.log("Verification request ".concat(this.channel.transactionId,": ")+"".concat(t," event with id:").concat(n.getId(),", ")+"content:".concat(JSON.stringify(n.getContent())," ")+"deviceId:".concat(this.channel.deviceId,", ")+"sender:".concat(n.getSender(),", isSentByUs:").concat(s,", ")+"isLiveEvent:".concat(r,", isRemoteEcho:").concat(i,", ")+"phase:".concat(u,"=>").concat(this.phase,", ")+"observeOnly:".concat(a,"=>").concat(this._observeOnly)),e.finish(31);case 34:case"end":return e.stop()}}),e,this,[[15,,31,34]])})));return function(t,n,r,i,o){return e.apply(this,arguments)}}()},{key:"_setupTimeout",value:function(e){(!this._timeoutTimer&&!this.observeOnly&&2===e&&(this._timeoutTimer=setTimeout(this._cancelOnTimeout,this.timeout)),this._timeoutTimer)&&((4===e||3===e||6===e||5===e)&&(clearTimeout(this._timeoutTimer),this._timeoutTimer=null))}},{key:"_cancelOnError",value:function(){var e=a(o.mark((function e(t,n){var r,i,s,a;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==k){e.next=6;break}if(r=n.getContent().method,this._verificationMethods.has(r)){e.next=6;break}return e.next=5,this.cancel((0,y.errorFromEvent)((0,y.newUnknownMethodError)()));case 5:return e.abrupt("return",!0);case 6:if(i=t===b&&1!==this.phase,s=t===w&&2!==this.phase,1===this.phase||!i&&!s){e.next=14;break}return v.logger.warn("Cancelling, unexpected ".concat(t," verification ")+"event from ".concat(n.getSender())),a="Unexpected ".concat(t," event in phase ").concat(this.phase),e.next=13,this.cancel((0,y.errorFromEvent)((0,y.newUnexpectedMessageError)({reason:a})));case 13:return e.abrupt("return",!0);case 14:return e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_adjustObserveOnly",value:function(e,t){t||(this._observeOnly=!0),this.calculateEventTimeout(e)<3e3&&(this._observeOnly=!0)}},{key:"_addEvent",value:function(e,t,n){if(n?this._eventsByUs.set(e,t):this._eventsByThem.set(e,t),e===b){var o,s=i(this._eventsByThem.entries());try{for(s.s();!(o=s.n()).done;){var a=r(o.value,2),u=a[0];a[1].getSender()!==this.otherUserId&&this._eventsByThem.delete(u)}}catch(c){s.e(c)}finally{s.f()}this._requestReceivedAt=Date.now()}}},{key:"_createVerifier",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;n||(n=this.targetDevice);var r=n,i=r.userId,o=r.deviceId,s=this._verificationMethods.get(e);if(s)return new s(this.channel,this._client,i,o,t,this);v.logger.warn("could not find verifier constructor for method",e)}},{key:"_wasSentByOwnUser",value:function(e){return e.getSender()===this._client.getUserId()}},{key:"_wasSentByOwnDevice",value:function(e){if(!this._wasSentByOwnUser(e))return!1;var t=e.getContent();return!(!t||t.from_device!==this._client.getDeviceId())}},{key:"onVerifierCancelled",value:function(){this._cancelled=!0;var e=this._applyPhaseTransitions();e.length&&this._setPhase(e[e.length-1].phase)}},{key:"onVerifierFinished",value:function(){this.channel.send("m.key.verification.done",{}),this._verifierHasFinished=!0;var e=this._applyPhaseTransitions();e.length&&this._setPhase(e[e.length-1].phase)}},{key:"getEventFromOtherParty",value:function(e){return this._eventsByThem.get(e)}},{key:"invalid",get:function(){return 1===this.phase}},{key:"requested",get:function(){return 2===this.phase}},{key:"cancelled",get:function(){return 5===this.phase}},{key:"ready",get:function(){return 3===this.phase}},{key:"started",get:function(){return 4===this.phase}},{key:"done",get:function(){return 6===this.phase}},{key:"methods",get:function(){return this._commonMethods}},{key:"chosenMethod",get:function(){return this._chosenMethod}},{key:"timeout",get:function(){var e=this._getEventByEither(b);return e?this.calculateEventTimeout(e):0}},{key:"requestEvent",get:function(){return this._getEventByEither(b)}},{key:"phase",get:function(){return this._phase}},{key:"verifier",get:function(){return this._verifier}},{key:"canAccept",get:function(){return this.phase<3&&!this._accepting&&!this._declining}},{key:"accepting",get:function(){return this._accepting}},{key:"declining",get:function(){return this._declining}},{key:"pending",get:function(){return!this.observeOnly&&6!==this._phase&&5!==this._phase}},{key:"qrCodeData",get:function(){return this._qrCodeData}},{key:"initiatedByMe",get:function(){var e=this._eventsByUs.size+this._eventsByThem.size===0;if(1===this._phase&&e)return!0;var t=this._eventsByUs.has(b),n=this._eventsByThem.has(b);if(t&&!n)return!0;if(!t&&n)return!1;var r=this._eventsByUs.has(k),i=this._eventsByThem.has(k);return!(!r||i)}},{key:"requestingUserId",get:function(){return this.initiatedByMe?this._client.getUserId():this.otherUserId}},{key:"receivingUserId",get:function(){return this.initiatedByMe?this.otherUserId:this._client.getUserId()}},{key:"otherUserId",get:function(){return this.channel.userId}},{key:"isSelfVerification",get:function(){return this._client.getUserId()===this.otherUserId}},{key:"cancellingUserId",get:function(){var e=this._eventsByUs.get(S),t=this._eventsByThem.get(S);return e&&(!t||e.getId()<t.getId())?e.getSender():t?t.getSender():void 0}},{key:"cancellationCode",get:function(){var e=this._getEventByEither(S);return e?e.getContent().code:null}},{key:"observeOnly",get:function(){return this._observeOnly}},{key:"targetDevice",get:function(){var e=(this._eventsByThem.get(b)||this._eventsByThem.get(w)||this._eventsByThem.get(k)).getContent().from_device;return{userId:this.otherUserId,deviceId:e}}}],[{key:"validateEvent",value:function(e,t,n){var r=t.getContent();return!(!e||!e.startsWith(_))&&(r?e!==b&&e!==w||Array.isArray(r.methods)?e!==b&&e!==w&&e!==k||"string"===typeof r.from_device&&0!==r.from_device.length||(v.logger.log("VerificationRequest: validateEvent: fail because from_device"),!1):(v.logger.log("VerificationRequest: validateEvent: fail because methods"),!1):(v.logger.log("VerificationRequest: validateEvent: no content"),!1))}}]),n}(g.EventEmitter);t.VerificationRequest=x},function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty,i=Array.isArray,o=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),s=function(e,t){for(var n=t&&t.plainObjects?Object.create(null):{},r=0;r<e.length;++r)"undefined"!==typeof e[r]&&(n[r]=e[r]);return n};e.exports={arrayToObject:s,assign:function(e,t){return Object.keys(t).reduce((function(e,n){return e[n]=t[n],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],n=[],r=0;r<t.length;++r)for(var o=t[r],s=o.obj[o.prop],a=Object.keys(s),u=0;u<a.length;++u){var c=a[u],l=s[c];"object"===typeof l&&null!==l&&-1===n.indexOf(l)&&(t.push({obj:s,prop:c}),n.push(l))}return function(e){for(;e.length>1;){var t=e.pop(),n=t.obj[t.prop];if(i(n)){for(var r=[],o=0;o<n.length;++o)"undefined"!==typeof n[o]&&r.push(n[o]);t.obj[t.prop]=r}}}(t),e},decode:function(e,t,n){var r=e.replace(/\+/g," ");if("iso-8859-1"===n)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(i){return r}},encode:function(e,t,n){if(0===e.length)return e;var r=e;if("symbol"===typeof e?r=Symbol.prototype.toString.call(e):"string"!==typeof e&&(r=String(e)),"iso-8859-1"===n)return escape(r).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var i="",s=0;s<r.length;++s){var a=r.charCodeAt(s);45===a||46===a||95===a||126===a||a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122?i+=r.charAt(s):a<128?i+=o[a]:a<2048?i+=o[192|a>>6]+o[128|63&a]:a<55296||a>=57344?i+=o[224|a>>12]+o[128|a>>6&63]+o[128|63&a]:(s+=1,a=65536+((1023&a)<<10|1023&r.charCodeAt(s)),i+=o[240|a>>18]+o[128|a>>12&63]+o[128|a>>6&63]+o[128|63&a])}return i},isBuffer:function(e){return!(!e||"object"!==typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(i(e)){for(var n=[],r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)},merge:function e(t,n,o){if(!n)return t;if("object"!==typeof n){if(i(t))t.push(n);else{if(!t||"object"!==typeof t)return[t,n];(o&&(o.plainObjects||o.allowPrototypes)||!r.call(Object.prototype,n))&&(t[n]=!0)}return t}if(!t||"object"!==typeof t)return[t].concat(n);var a=t;return i(t)&&!i(n)&&(a=s(t,o)),i(t)&&i(n)?(n.forEach((function(n,i){if(r.call(t,i)){var s=t[i];s&&"object"===typeof s&&n&&"object"===typeof n?t[i]=e(s,n,o):t.push(n)}else t[i]=n})),t):Object.keys(n).reduce((function(t,i){var s=n[i];return r.call(t,i)?t[i]=e(t[i],s,o):t[i]=s,t}),a)}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(31);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}},function(e,t,n){"use strict";(function(e){var r=n(12);Object.defineProperty(t,"__esModule",{value:!0});var i={ContentHelpers:!0,request:!0,getRequest:!0,wrapRequest:!0,setCryptoStoreFactory:!0,createClient:!0,createNewMatrixCall:!0,setMatrixCallAudioOutput:!0,setMatrixCallAudioInput:!0,setMatrixCallVideoInput:!0};t.request=function(e){C=e},t.getRequest=function(){return C},t.wrapRequest=function(e){var t=C;C=function(n,r){return e(t,n,r)}},t.setCryptoStoreFactory=function(e){A=e},t.createClient=function(t){"string"===typeof t&&(t={baseUrl:t});return t.request=t.request||C,t.store=t.store||new a.MemoryStore({localStorage:e.localStorage}),t.scheduler=t.scheduler||new u.MatrixScheduler,t.cryptoStore=t.cryptoStore||A(),new c.MatrixClient(t)},Object.defineProperty(t,"createNewMatrixCall",{enumerable:!0,get:function(){return D.createNewMatrixCall}}),Object.defineProperty(t,"setMatrixCallAudioOutput",{enumerable:!0,get:function(){return D.setAudioOutput}}),Object.defineProperty(t,"setMatrixCallAudioInput",{enumerable:!0,get:function(){return D.setAudioInput}}),Object.defineProperty(t,"setMatrixCallVideoInput",{enumerable:!0,get:function(){return D.setVideoInput}}),t.ContentHelpers=void 0;var o=r(n(4)),s=n(43);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===s[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}}))}));var a=n(60);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}));var u=n(95);Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===u[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}}))}));var c=n(96);Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===c[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}}))}));var l=n(33);Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===l[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}}))}));var d=n(76);Object.keys(d).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===d[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}}))}));var f=n(77);Object.keys(f).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===f[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}}))}));var p=n(36);Object.keys(p).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===p[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return p[e]}}))}));var h=n(16);Object.keys(h).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===h[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return h[e]}}))}));var v=n(63);Object.keys(v).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===v[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return v[e]}}))}));var g=n(66);Object.keys(g).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===g[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return g[e]}}))}));var y=n(27);Object.keys(y).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===y[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return y[e]}}))}));var m=n(64);Object.keys(m).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===m[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return m[e]}}))}));var _=n(49);Object.keys(_).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===_[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return _[e]}}))}));var b=n(65);Object.keys(b).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===b[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return b[e]}}))}));var k=n(28);Object.keys(k).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===k[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return k[e]}}))}));var S=n(48);Object.keys(S).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===S[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return S[e]}}))}));var E=n(140);Object.keys(E).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===E[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return E[e]}}))}));var w=n(141);Object.keys(w).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===w[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return w[e]}}))}));var x=n(61);Object.keys(x).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===x[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return x[e]}}))}));var I=n(142);Object.keys(I).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===I[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return I[e]}}))}));var T=n(145);Object.keys(T).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===T[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return T[e]}}))}));var R=n(20);Object.keys(R).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===R[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return R[e]}}))}));var O=n(34);Object.keys(O).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===O[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return O[e]}}))}));var C,D=n(51),P=Promise.resolve().then((function(){return(0,o.default)(n(68))}));t.ContentHelpers=P;var A=function(){return new s.MemoryCryptoStore}}).call(this,n(9))},function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}},function(e,t){e.exports=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}},function(e,t,n){"use strict";var r=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.MemoryStore=a;var i=n(28),o=r(n(5));function s(e){return"string"===typeof e&&!!e&&"undefined"!==e&&"null"!==e||"number"===typeof e}function a(e){e=e||{},this.rooms={},this.groups={},this.users={},this.syncToken=null,this.filters={},this.accountData={},this.localStorage=e.localStorage,this._oobMembers={},this._clientOptions={}}a.prototype={getSyncToken:function(){return this.syncToken},isNewlyCreated:function(){return Promise.resolve(!0)},setSyncToken:function(e){this.syncToken=e},storeGroup:function(e){this.groups[e.groupId]=e},getGroup:function(e){return this.groups[e]||null},getGroups:function(){return o.values(this.groups)},storeRoom:function(e){this.rooms[e.roomId]=e,e.currentState.on("RoomState.members",this._onRoomMember.bind(this));var t=this;e.currentState.getMembers().forEach((function(n){t._onRoomMember(null,e.currentState,n)}))},_onRoomMember:function(e,t,n){if("invite"!==n.membership){var r=this.users[n.userId]||new i.User(n.userId);n.name&&(r.setDisplayName(n.name),n.events.member&&r.setRawDisplayName(n.events.member.getDirectionalContent().displayname)),n.events.member&&n.events.member.getContent().avatar_url&&r.setAvatarUrl(n.events.member.getContent().avatar_url),this.users[r.userId]=r}},getRoom:function(e){return this.rooms[e]||null},getRooms:function(){return o.values(this.rooms)},removeRoom:function(e){this.rooms[e]&&this.rooms[e].removeListener("RoomState.members",this._onRoomMember),delete this.rooms[e]},getRoomSummaries:function(){return o.map(o.values(this.rooms),(function(e){return e.summary}))},storeUser:function(e){this.users[e.userId]=e},getUser:function(e){return this.users[e]||null},getUsers:function(){return o.values(this.users)},scrollback:function(e,t){return[]},storeEvents:function(e,t,n,r){},storeFilter:function(e){e&&(this.filters[e.userId]||(this.filters[e.userId]={}),this.filters[e.userId][e.filterId]=e)},getFilter:function(e,t){return this.filters[e]&&this.filters[e][t]?this.filters[e][t]:null},getFilterIdByName:function(e){if(!this.localStorage)return null;var t="mxjssdk_memory_filter_"+e;try{var n=this.localStorage.getItem(t);if(s(n))return n}catch(r){}return null},setFilterIdByName:function(e,t){if(this.localStorage){var n="mxjssdk_memory_filter_"+e;try{s(t)?this.localStorage.setItem(n,t):this.localStorage.removeItem(n)}catch(r){}}},storeAccountDataEvents:function(e){var t=this;e.forEach((function(e){t.accountData[e.getType()]=e}))},getAccountData:function(e){return this.accountData[e]},setSyncData:function(e){return Promise.resolve()},wantsSave:function(){return!1},save:function(e){},startup:function(){return Promise.resolve()},getSavedSync:function(){return Promise.resolve(null)},getSavedSyncToken:function(){return Promise.resolve(null)},deleteAllData:function(){return this.rooms={},this.users={},this.syncToken=null,this.filters={},this.accountData={},Promise.resolve()},getOutOfBandMembers:function(e){return Promise.resolve(this._oobMembers[e]||null)},setOutOfBandMembers:function(e,t){return this._oobMembers[e]=t,Promise.resolve()},clearOutOfBandMembers:function(){return this._oobMembers={},Promise.resolve()},getClientOptions:function(){return Promise.resolve(this._clientOptions)},storeClientOptions:function(e){return this._clientOptions=Object.assign({},e),Promise.resolve()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SERVICE_TYPES=void 0;var r=Object.freeze({IS:"SERVICE_TYPE_IS",IM:"SERVICE_TYPE_IM"});t.SERVICE_TYPES=r},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){"use strict";var r=n(10),i=n(2),o=n(6),s=n(3),a=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.Room=b;var u=n(11),c=n(64),l=n(27),d=n(34),f=a(n(5)),p=n(16),h=n(49),v=n(115),g=n(1),y=n(50),m=["1","2","3","4","5"];function _(e,t,n){var r={content:{},type:"m.receipt",room_id:t.getRoomId()};return r.content[t.getId()]={},r.content[t.getId()][n]={},r.content[t.getId()][n][e]={ts:t.getTs()},new p.MatrixEvent(r)}function b(e,t,n,r){if((r=r||{}).pendingEventOrdering=r.pendingEventOrdering||"chronological",this.setMaxListeners(100),this.reEmitter=new y.ReEmitter(this),-1===["chronological","detached"].indexOf(r.pendingEventOrdering))throw new Error("opts.pendingEventOrdering MUST be either 'chronological' or 'detached'. Got: '"+r.pendingEventOrdering+"'");this.myUserId=n,this.roomId=e,this.name=e,this.tags={},this.accountData={},this.summary=null,this.storageToken=r.storageToken,this._opts=r,this._txnToEvent={},this._receipts={},this._receiptCacheByEventId={},this._realReceipts={},this._notificationCounts={},this._timelineSets=[new c.EventTimelineSet(this,r)],this.reEmitter.reEmit(this.getUnfilteredTimelineSet(),["Room.timeline","Room.timelineReset"]),this._fixUpLegacyTimelineFields(),this._filteredTimelineSets={},"detached"==this._opts.pendingEventOrdering&&(this._pendingEventList=[]),this._blacklistUnverifiedDevices=null,this._selfMembership=null,this._summaryHeroes=null,this._client=t,this._opts.lazyLoadMembers?this._membersPromise=null:this._membersPromise=Promise.resolve()}f.inherits(b,u.EventEmitter),b.prototype.getVersion=function(){var e=this.currentState.getStateEvents("m.room.create","");if(!e)return g.logger.warn("Room "+this.roomId+" does not have an m.room.create event"),"1";var t=e.getContent().room_version;return void 0===t?"1":t},b.prototype.shouldUpgradeToVersion=function(){return m.includes(this.getVersion())?null:"5"},b.prototype.getRecommendedVersion=s(i.mark((function e(){var t,n,r,s,a,u,c;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._client.getCapabilities();case 2:if(t=e.sent,!(n=t["m.room_versions"])){n={default:"5",available:{}},r=o(m);try{for(r.s();!(s=r.n()).done;)a=s.value,n.available[a]="stable"}catch(i){r.e(i)}finally{r.f()}}if(!(u=this._checkVersionAgainstCapability(n)).urgent||!u.needsUpgrade){e.next=18;break}return g.logger.warn("Refreshing room version capability because the server looks to be supporting a newer room version we don't know about."),e.next=10,this._client.getCapabilities(!0);case 10:if(c=e.sent,n=c["m.room_versions"]){e.next=17;break}return g.logger.warn("No room version capability - assuming upgrade required."),e.abrupt("return",u);case 17:u=this._checkVersionAgainstCapability(n);case 18:return e.abrupt("return",u);case 19:case"end":return e.stop()}}),e,this)}))),b.prototype._checkVersionAgainstCapability=function(e){var t=this.getVersion();g.logger.log("[".concat(this.roomId,"] Current version: ").concat(t)),g.logger.log("[".concat(this.roomId,"] Version capability: "),e);var n={version:t,needsUpgrade:!1,urgent:!1};return t===e.default||Object.keys(e.available).filter((function(t){return"stable"===e.available[t]})).includes(t)||(n.version=e.default,n.needsUpgrade=!0,n.urgent=!!this.getVersion().match(/^[0-9]+[0-9.]*$/g),n.urgent?g.logger.warn("URGENT upgrade required on ".concat(this.roomId)):g.logger.warn("Non-urgent upgrade required on ".concat(this.roomId))),n},b.prototype.userMayUpgradeRoom=function(e){return this.currentState.maySendStateEvent("m.room.tombstone",e)},b.prototype.getPendingEvents=function(){if("detached"!==this._opts.pendingEventOrdering)throw new Error("Cannot call getPendingEvents with pendingEventOrdering == "+this._opts.pendingEventOrdering);return this._pendingEventList},b.prototype.hasPendingEvent=function(e){return"detached"===this._opts.pendingEventOrdering&&this._pendingEventList.some((function(t){return t.getId()===e}))},b.prototype.getPendingEvent=function(e){return"detached"!==this._opts.pendingEventOrdering?null:this._pendingEventList.find((function(t){return t.getId()===e}))},b.prototype.getLiveTimeline=function(){return this.getUnfilteredTimelineSet().getLiveTimeline()},b.prototype.getLastActiveTimestamp=function(){var e=this.getLiveTimeline().getEvents();return e.length?e[e.length-1].getTs():Number.MIN_SAFE_INTEGER},b.prototype.getMyMembership=function(){return this._selfMembership},b.prototype.getDMInviter=function(){if(this.myUserId){var e=this.getMember(this.myUserId);if(e)return e.getDMInviter()}if("invite"===this._selfMembership&&(2==this.getInvitedAndJoinedMemberCount()&&this._summaryHeroes.length))return this._summaryHeroes[0]},b.prototype.guessDMUserId=function(){var e=this,t=this.getMember(this.myUserId);if(t){var n=t.getDMInviter();if(n)return n}if(Array.isArray(this._summaryHeroes)&&this._summaryHeroes.length)return this._summaryHeroes[0];var r=this.currentState.getMembers().find((function(t){return t.userId!==e.myUserId}));return r?r.userId:this.myUserId},b.prototype.getAvatarFallbackMember=function(){var e=this;if(!(this.getInvitedAndJoinedMemberCount()>2)){var t=Array.isArray(this._summaryHeroes)&&this._summaryHeroes.length;if(t){var n=this._summaryHeroes.map((function(t){return e.getMember(t)})).find((function(e){return!!e}));if(n)return n}var r=this.currentState.getMembers();if(r.length<=2){var i=r.find((function(t){return t.userId!==e.myUserId}));if(i)return i}if(t){var o=this._summaryHeroes.map((function(t){return e._client.getUser(t)})).find((function(e){return!!e}));if(o){var s=new h.RoomMember(this.roomId,o.userId);return s.user=o,s}}}},b.prototype.updateMyMembership=function(e){var t=this._selfMembership;this._selfMembership=e,t!==e&&("leave"===e&&this._cleanupAfterLeaving(),this.emit("Room.myMembership",this,e,t))},b.prototype._loadMembersFromServer=s(i.mark((function e(){var t,n,r,o,s;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._client.store.getSyncToken(),n=f.encodeParams({not_membership:"leave",at:t}),r=f.encodeUri("/rooms/$roomId/members?"+n,{$roomId:this.roomId}),o=this._client._http,e.next=6,o.authedRequest(void 0,"GET",r);case 6:return s=e.sent,e.abrupt("return",s.chunk);case 8:case"end":return e.stop()}}),e,this)}))),b.prototype._loadMembers=s(i.mark((function e(){var t,n,r;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!1,e.next=3,this._client.store.getOutOfBandMembers(this.roomId);case 3:if(null!==(n=e.sent)){e.next=10;break}return t=!0,e.next=8,this._loadMembersFromServer();case 8:n=e.sent,g.logger.log("LL: got ".concat(n.length," ")+"members from server for room ".concat(this.roomId));case 10:return r=n.map(this._client.getEventMapper()),e.abrupt("return",{memberEvents:r,fromServer:t});case 12:case"end":return e.stop()}}),e,this)}))),b.prototype.loadMembersIfNeeded=function(){var e=this;if(this._membersPromise)return this._membersPromise;this.currentState.markOutOfBandMembersStarted();var t=this._loadMembers().then((function(t){return e.currentState.setOutOfBandMembers(t.memberEvents),e._client.isCryptoEnabled()&&e._client.isRoomEncrypted(e.roomId)&&e._client._crypto.trackRoomDevices(e.roomId),t.fromServer})).catch((function(t){throw e._membersPromise=null,e.currentState.markOutOfBandMembersFailed(),t}));return t.then((function(t){if(t){var n=e.currentState.getMembers().filter((function(e){return e.isOutOfBand()})).map((function(e){return e.events.member.event}));return g.logger.log("LL: telling store to write ".concat(n.length)+" members for room ".concat(e.roomId)),e._client.store.setOutOfBandMembers(e.roomId,n).catch((function(e){g.logger.log("LL: storing OOB room members failed, oh well",e)}))}})).catch((function(e){g.logger.error(e)})),this._membersPromise=t,this._membersPromise},b.prototype.clearLoadedMembersIfNeeded=s(i.mark((function e(){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._opts.lazyLoadMembers||!this._membersPromise){e.next=7;break}return e.next=3,this.loadMembersIfNeeded();case 3:return e.next=5,this._client.store.clearOutOfBandMembers(this.roomId);case 5:this.currentState.clearOutOfBandMembers(),this._membersPromise=null;case 7:case"end":return e.stop()}}),e,this)}))),b.prototype._cleanupAfterLeaving=function(){var e=this;this.clearLoadedMembersIfNeeded().catch((function(t){g.logger.error("error after clearing loaded members from "+"room ".concat(e.roomId," after leaving")),g.logger.log(t)}))},b.prototype.resetLiveTimeline=function(e,t){for(var n=0;n<this._timelineSets.length;n++)this._timelineSets[n].resetLiveTimeline(e,t);this._fixUpLegacyTimelineFields()},b.prototype._fixUpLegacyTimelineFields=function(){this.timeline=this.getLiveTimeline().getEvents(),this.oldState=this.getLiveTimeline().getState(l.EventTimeline.BACKWARDS),this.currentState=this.getLiveTimeline().getState(l.EventTimeline.FORWARDS)},b.prototype.hasUnverifiedDevices=s(i.mark((function e(){var t,n,r,s;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._client.isRoomEncrypted(this.roomId)){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,this.getEncryptionTargetMembers();case 4:t=e.sent,n=o(t),e.prev=6,n.s();case 8:if((r=n.n()).done){e.next=15;break}if(s=r.value,!this._client.getStoredDevicesForUser(s.userId).some((function(e){return e.isUnverified()}))){e.next=13;break}return e.abrupt("return",!0);case 13:e.next=8;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(6),n.e(e.t0);case 20:return e.prev=20,n.f(),e.finish(20);case 23:return e.abrupt("return",!1);case 24:case"end":return e.stop()}}),e,this,[[6,17,20,23]])}))),b.prototype.getTimelineSets=function(){return this._timelineSets},b.prototype.getUnfilteredTimelineSet=function(){return this._timelineSets[0]},b.prototype.getTimelineForEvent=function(e){return this.getUnfilteredTimelineSet().getTimelineForEvent(e)},b.prototype.addTimeline=function(){return this.getUnfilteredTimelineSet().addTimeline()},b.prototype.findEventById=function(e){return this.getUnfilteredTimelineSet().findEventById(e)},b.prototype.getUnreadNotificationCount=function(e){return e=e||"total",this._notificationCounts[e]},b.prototype.setUnreadNotificationCount=function(e,t){this._notificationCounts[e]=t},b.prototype.setSummary=function(e){var t=this,n=e["m.heroes"],r=e["m.joined_member_count"],i=e["m.invited_member_count"];Number.isInteger(r)&&this.currentState.setJoinedMemberCount(r),Number.isInteger(i)&&this.currentState.setInvitedMemberCount(i),Array.isArray(n)&&(this._summaryHeroes=n.filter((function(e){return e!==t.myUserId})))},b.prototype.setBlacklistUnverifiedDevices=function(e){this._blacklistUnverifiedDevices=e},b.prototype.getBlacklistUnverifiedDevices=function(){return this._blacklistUnverifiedDevices},b.prototype.getAvatarUrl=function(e,t,n,r,i){var o=this.currentState.getStateEvents("m.room.avatar","");if(void 0===i&&(i=!0),!o&&!i)return null;var s=o?o.getContent().url:null;return s?(0,d.getHttpUriForMxc)(e,s,t,n,r):null},b.prototype.getAliases=function(){var e=[],t=this.currentState.getStateEvents("m.room.aliases");if(t)for(var n=function(n){var r=t[n];if(f.isArray(r.getContent().aliases)){var i=r.getContent().aliases.filter((function(e){return"string"===typeof e&&("#"===e[0]&&!!e.endsWith(":".concat(r.getStateKey())))}));Array.prototype.push.apply(e,i)}},r=0;r<t.length;++r)n(r);return e},b.prototype.getCanonicalAlias=function(){var e=this.currentState.getStateEvents("m.room.canonical_alias","");return e&&e.getContent().alias||null},b.prototype.getAltAliases=function(){var e=this.currentState.getStateEvents("m.room.canonical_alias","");return e&&e.getContent().alt_aliases||[]},b.prototype.addEventsToTimeline=function(e,t,n,r){n.getTimelineSet().addEventsToTimeline(e,t,n,r)},b.prototype.getMember=function(e){return this.currentState.getMember(e)},b.prototype.getJoinedMembers=function(){return this.getMembersWithMembership("join")},b.prototype.getJoinedMemberCount=function(){return this.currentState.getJoinedMemberCount()},b.prototype.getInvitedMemberCount=function(){return this.currentState.getInvitedMemberCount()},b.prototype.getInvitedAndJoinedMemberCount=function(){return this.getInvitedMemberCount()+this.getJoinedMemberCount()},b.prototype.getMembersWithMembership=function(e){return f.filter(this.currentState.getMembers(),(function(t){return t.membership===e}))},b.prototype.getEncryptionTargetMembers=s(i.mark((function e(){var t;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadMembersIfNeeded();case 2:return t=this.getMembersWithMembership("join"),this.shouldEncryptForInvitedMembers()&&(t=t.concat(this.getMembersWithMembership("invite"))),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)}))),b.prototype.shouldEncryptForInvitedMembers=function(){var e=this.currentState.getStateEvents("m.room.history_visibility","");return e&&e.getContent()&&"joined"!==e.getContent().history_visibility},b.prototype.getDefaultRoomName=function(e){return S(this,e,!0)},b.prototype.hasMembershipState=function(e,t){var n=this.getMember(e);return!!n&&n.membership===t},b.prototype.getOrCreateFilteredTimelineSet=function(e){if(this._filteredTimelineSets[e.filterId])return this._filteredTimelineSets[e.filterId];var t=Object.assign({filter:e},this._opts),n=new c.EventTimelineSet(this,t);this.reEmitter.reEmit(n,["Room.timeline","Room.timelineReset"]),this._filteredTimelineSets[e.filterId]=n,this._timelineSets.push(n);var r=this.getLiveTimeline();r.getEvents().forEach((function(e){n.addLiveEvent(e)}));for(var i=r;i.getNeighbouringTimeline(l.EventTimeline.BACKWARDS);)i=i.getNeighbouringTimeline(l.EventTimeline.BACKWARDS);return n.getLiveTimeline().setPaginationToken(i.getPaginationToken(l.EventTimeline.BACKWARDS),l.EventTimeline.BACKWARDS),n},b.prototype.removeFilteredTimelineSet=function(e){var t=this._filteredTimelineSets[e.filterId];delete this._filteredTimelineSets[e.filterId];var n=this._timelineSets.indexOf(t);n>-1&&this._timelineSets.splice(n,1)},b.prototype._addLiveEvent=function(e,t,n){if(e.isRedaction()){var r=e.event.redacts,i=this.getUnfilteredTimelineSet().findEventById(r);if(i){if(i.makeRedacted(e),i.getStateKey())this.currentState.getStateEvents(i.getType(),i.getStateKey()).getId()===i.getId()&&this.currentState.setStateEvents([i]);this.emit("Room.redaction",e,this)}}if(e.getUnsigned().transaction_id){var o=this._txnToEvent[e.getUnsigned().transaction_id];if(o)return void this._handleRemoteEcho(e,o)}for(var s=0;s<this._timelineSets.length;s++)this._timelineSets[s].addLiveEvent(e,t,n);e.sender&&"m.room.redaction"!==e.getType()&&this.addReceipt(_(e.sender.userId,e,"m.read"),!0)},b.prototype.addPendingEvent=function(e,t){if(e.status!==p.EventStatus.SENDING)throw new Error("addPendingEvent called on an event with status "+e.status);if(this._txnToEvent[t])throw new Error("addPendingEvent called on an event with known txnId "+t);if(l.EventTimeline.setEventMetadata(e,this.getLiveTimeline().getState(l.EventTimeline.FORWARDS),!1),this._txnToEvent[t]=e,"detached"==this._opts.pendingEventOrdering){if(this._pendingEventList.some((function(e){return e.status===p.EventStatus.NOT_SENT}))&&(g.logger.warn("Setting event as NOT_SENT due to messages in the same state"),e.setStatus(p.EventStatus.NOT_SENT)),this._pendingEventList.push(e),e.isRelation()&&this._aggregateNonLiveRelation(e),e.isRedaction()){var n=e.event.redacts,r=this._pendingEventList&&this._pendingEventList.find((function(e){return e.getId()===n}));r||(r=this.getUnfilteredTimelineSet().findEventById(n)),r&&(r.markLocallyRedacted(e),this.emit("Room.redaction",e,this))}}else for(var i=0;i<this._timelineSets.length;i++){var o=this._timelineSets[i];o.getFilter()?o.getFilter().filterRoomTimeline([e]).length&&o.addEventToTimeline(e,o.getLiveTimeline(),!1):o.addEventToTimeline(e,o.getLiveTimeline(),!1)}this.emit("Room.localEchoUpdated",e,this,null,null)},b.prototype._aggregateNonLiveRelation=function(e){for(var t=0;t<this._timelineSets.length;t++){var n=this._timelineSets[t];n.getFilter()?n.getFilter().filterRoomTimeline([e]).length&&n.aggregateRelations(e):n.aggregateRelations(e)}},b.prototype._handleRemoteEcho=function(e,t){var n=t.getId(),r=e.getId(),i=t.status;g.logger.debug("Got remote echo for event ".concat(n," -> ").concat(r," ")+"old status ".concat(i)),delete this._txnToEvent[e.getUnsigned().transaction_id],this._pendingEventList&&f.removeElement(this._pendingEventList,(function(e){return e.getId()==n}),!1),t.handleRemoteEcho(e.event);for(var o=0;o<this._timelineSets.length;o++){this._timelineSets[o].handleRemoteEcho(t,n,r)}this.emit("Room.localEchoUpdated",t,this,n,i)};var k={};function S(e,t,n){if(!n){var r=e.currentState.getStateEvents("m.room.name","");if(r&&r.getContent()&&r.getContent().name)return r.getContent().name}var i=e.getCanonicalAlias();if(!i){var o=e.getAltAliases();o.length&&(i=o[0])}if(i)return i;var s=e.currentState.getJoinedMemberCount()+e.currentState.getInvitedMemberCount()-1,a=null;if(e._summaryHeroes)a=e._summaryHeroes.map((function(t){var n=e.getMember(t);return n?n.name:t}));else{var u=e.currentState.getMembers().filter((function(e){return e.userId!==t&&("invite"===e.membership||"join"===e.membership)}));u.sort((function(e,t){return e.userId.localeCompare(t.userId)})),a=(u=u.slice(0,5)).map((function(e){return e.name}))}if(s)return E(a,s);if("join"==e.getMyMembership()){var c=e.currentState.getStateEvents("m.room.third_party_invite");if(c&&c.length){var l=c.map((function(e){return e.getContent().display_name}));return"Inviting ".concat(E(l))}}var d=a;return d.length||(d=e.currentState.getMembers().filter((function(e){return e.userId!==t&&"invite"!==e.membership&&"join"!==e.membership})).map((function(e){return e.name}))),d.length?"Empty room (was ".concat(E(d),")"):"Empty room"}function E(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length+1,n=t-1;if(e.length){if(1===e.length&&n<=1)return e[0];if(2===e.length&&n<=2)return"".concat(e[0]," and ").concat(e[1]);var r=n>1;return r?"".concat(e[0]," and ").concat(n," others"):"".concat(e[0]," and 1 other")}return"Empty room"}k[p.EventStatus.ENCRYPTING]=[p.EventStatus.SENDING,p.EventStatus.NOT_SENT],k[p.EventStatus.SENDING]=[p.EventStatus.ENCRYPTING,p.EventStatus.QUEUED,p.EventStatus.NOT_SENT,p.EventStatus.SENT],k[p.EventStatus.QUEUED]=[p.EventStatus.SENDING,p.EventStatus.CANCELLED],k[p.EventStatus.SENT]=[],k[p.EventStatus.NOT_SENT]=[p.EventStatus.SENDING,p.EventStatus.QUEUED,p.EventStatus.CANCELLED],k[p.EventStatus.CANCELLED]=[],b.prototype.updatePendingEvent=function(e,t,n){if(g.logger.log("setting pendingEvent status to ".concat(t," in ").concat(e.getRoomId()," ")+"event ID ".concat(e.getId()," -> ").concat(n)),t==p.EventStatus.SENT&&!n)throw new Error("updatePendingEvent called with status=SENT, but no new event id");if(t==p.EventStatus.SENT&&this.getUnfilteredTimelineSet().eventIdToTimeline(n))return;var i=e.status,o=e.getId();if(!i)throw new Error("updatePendingEventStatus called on an event which is not a local echo.");var s=k[i];if(!s||s.indexOf(t)<0)throw new Error("Invalid EventStatus transition "+i+"->"+t);if(e.setStatus(t),t==p.EventStatus.SENT){e.replaceLocalEventId(n);for(var a=0;a<this._timelineSets.length;a++)this._timelineSets[a].replaceEventId(o,n)}else if(t==p.EventStatus.CANCELLED){if(this._pendingEventList){var u=this._pendingEventList.findIndex((function(e){return e.getId()===o}));if(-1!==u){var c=this._pendingEventList.splice(u,1),l=r(c,1)[0];l.isRedaction()&&this._revertRedactionLocalEcho(l)}}this.removeEvent(o)}this.emit("Room.localEchoUpdated",e,this,o,i)},b.prototype._revertRedactionLocalEcho=function(e){var t=e.event.redacts;if(t){var n=this.getUnfilteredTimelineSet().findEventById(t);n&&(n.unmarkLocallyRedacted(),this.emit("Room.redactionCancelled",e,this),n.isRelation()&&this._aggregateNonLiveRelation(n))}},b.prototype.addLiveEvents=function(e,t,n){var r;if(t&&-1===["replace","ignore"].indexOf(t))throw new Error("duplicateStrategy MUST be either 'replace' or 'ignore'");for(r=0;r<this._timelineSets.length;r++){var i=this._timelineSets[r].getLiveTimeline();if(i.getPaginationToken(l.EventTimeline.FORWARDS))throw new Error("live timeline "+r+" is no longer live - it has a pagination token ("+i.getPaginationToken(l.EventTimeline.FORWARDS)+")");if(i.getNeighbouringTimeline(l.EventTimeline.FORWARDS))throw new Error("live timeline "+r+" is no longer live - it has a neighbouring timeline")}for(r=0;r<e.length;r++)this._addLiveEvent(e[r],t,n)},b.prototype.addEphemeralEvents=function(e){var t,n=o(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;"m.typing"===r.getType()?this.currentState.setTypingEvent(r):"m.receipt"===r.getType()&&this.addReceipt(r)}}catch(i){n.e(i)}finally{n.f()}},b.prototype.removeEvents=function(e){for(var t=0;t<e.length;++t)this.removeEvent(e[t])},b.prototype.removeEvent=function(e){for(var t=!1,n=0;n<this._timelineSets.length;n++){var r=this._timelineSets[n].removeEvent(e);r&&(r.isRedaction()&&this._revertRedactionLocalEcho(r),t=!0)}return t},b.prototype.recalculate=function(){var e=this,t=this.currentState.getStateEvents("m.room.member",this.myUserId);if(t&&"invite"===t.getContent().membership){var n=t.event.invite_room_state||[];f.forEach(n,(function(t){e.currentState.getStateEvents(t.type,t.state_key)||e.currentState.setStateEvents([new p.MatrixEvent({type:t.type,state_key:t.state_key,content:t.content,event_id:"$fake"+Date.now(),room_id:e.roomId,user_id:e.myUserId})])}))}var r=this.name;this.name=S(this,this.myUserId),this.summary=new v.RoomSummary(this.roomId,{title:this.name}),r!==this.name&&this.emit("Room.name",this)},b.prototype.getUsersReadUpTo=function(e){return this.getReceiptsForEvent(e).filter((function(e){return"m.read"===e.type})).map((function(e){return e.userId}))},b.prototype.getEventReadUpTo=function(e,t){var n=this._receipts;return t&&(n=this._realReceipts),void 0===n["m.read"]||void 0===n["m.read"][e]?null:n["m.read"][e].eventId},b.prototype.hasUserReadEvent=function(e,t){var n=this.getEventReadUpTo(e,!1);if(n===t)return!0;if(this.timeline.length&&this.timeline[this.timeline.length-1].getSender()&&this.timeline[this.timeline.length-1].getSender()===e)return!0;for(var r=this.timeline.length-1;r>=0;--r){var i=this.timeline[r];if(i.getId()===t)return!1;if(i.getId()===n)return!0}return!1},b.prototype.getReceiptsForEvent=function(e){return this._receiptCacheByEventId[e.getId()]||[]},b.prototype.addReceipt=function(e,t){void 0===t&&(t=!1),t||this._addReceiptsToStructure(e,this._realReceipts),this._addReceiptsToStructure(e,this._receipts),this._receiptCacheByEventId=this._buildReceiptCache(this._receipts),this.emit("Room.receipt",e,this)},b.prototype._addReceiptsToStructure=function(e,t){var n=this;f.keys(e.getContent()).forEach((function(r){f.keys(e.getContent()[r]).forEach((function(i){f.keys(e.getContent()[r][i]).forEach((function(o){var s=e.getContent()[r][i][o];t[i]||(t[i]={});var a=t[i][o];if(a){var u=n.getUnfilteredTimelineSet().compareEventOrdering(a.eventId,r);if(null!==u&&u>=0)return}else t[i][o]={};t[i][o]={eventId:r,data:s}}))}))}))},b.prototype._buildReceiptCache=function(e){var t={};return f.keys(e).forEach((function(n){f.keys(e[n]).forEach((function(r){var i=e[n][r];t[i.eventId]||(t[i.eventId]=[]),t[i.eventId].push({userId:r,type:n,data:i.data})}))})),t},b.prototype._addLocalEchoReceipt=function(e,t,n){this.addReceipt(_(e,t,n),!0)},b.prototype.addTags=function(e){this.tags=e.getContent().tags||{},this.emit("Room.tags",e,this)},b.prototype.addAccountData=function(e){for(var t=0;t<e.length;t++){var n=e[t];"m.tag"===n.getType()&&this.addTags(n);var r=this.accountData[n.getType()];this.accountData[n.getType()]=n,this.emit("Room.accountData",n,this,r)}},b.prototype.getAccountData=function(e){return this.accountData[e]},b.prototype.maySendMessage=function(){return"join"===this.getMyMembership()&&this.currentState.maySendEvent("m.room.message",this.myUserId)}},function(e,t,n){"use strict";var r=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.EventTimelineSet=d;var i,o=n(11),s=n(27),a=n(16),u=r(n(5)),c=n(1),l=n(111);function d(e,t){this.room=e,this._timelineSupport=Boolean(t.timelineSupport),this._liveTimeline=new s.EventTimeline(this),this._unstableClientRelationAggregation=!!t.unstableClientRelationAggregation,this._timelines=[this._liveTimeline],this._eventIdToTimeline={},this._filter=t.filter||null,this._unstableClientRelationAggregation&&(this._relations={})}i=c.logger.log.bind(c.logger),u.inherits(d,o.EventEmitter),d.prototype.getTimelines=function(){return this._timelines},d.prototype.getFilter=function(){return this._filter},d.prototype.setFilter=function(e){this._filter=e},d.prototype.getPendingEvents=function(){return this.room?this._filter?this._filter.filterRoomTimeline(this.room.getPendingEvents()):this.room.getPendingEvents():[]},d.prototype.getLiveTimeline=function(){return this._liveTimeline},d.prototype.eventIdToTimeline=function(e){return this._eventIdToTimeline[e]},d.prototype.replaceEventId=function(e,t){var n=this._eventIdToTimeline[e];n&&(delete this._eventIdToTimeline[e],this._eventIdToTimeline[t]=n)},d.prototype.resetLiveTimeline=function(e,t){var n=!this._timelineSupport||!t,r=this._liveTimeline,i=n?r.forkLive(s.EventTimeline.FORWARDS):r.fork(s.EventTimeline.FORWARDS);n?(this._timelines=[i],this._eventIdToTimeline={}):this._timelines.push(i),t&&r.setPaginationToken(t,s.EventTimeline.FORWARDS),i.setPaginationToken(e,s.EventTimeline.BACKWARDS),this._liveTimeline=i,this.emit("Room.timelineReset",this.room,this,n)},d.prototype.getTimelineForEvent=function(e){var t=this._eventIdToTimeline[e];return void 0===t?null:t},d.prototype.findEventById=function(e){var t=this.getTimelineForEvent(e);if(t)return u.findElement(t.getEvents(),(function(t){return t.getId()==e}))},d.prototype.addTimeline=function(){if(!this._timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");var e=new s.EventTimeline(this);return this._timelines.push(e),e},d.prototype.addEventsToTimeline=function(e,t,n,r){if(!n)throw new Error("'timeline' not specified for EventTimelineSet.addEventsToTimeline");if(!t&&n==this._liveTimeline)throw new Error("EventTimelineSet.addEventsToTimeline cannot be used for adding events to the live timeline - use Room.addLiveEvents instead");if(!this._filter||(e=this._filter.filterRoomTimeline(e)).length){for(var o=t?s.EventTimeline.BACKWARDS:s.EventTimeline.FORWARDS,a=t?s.EventTimeline.FORWARDS:s.EventTimeline.BACKWARDS,u=!1,l=!1,d=0;d<e.length;d++){var f=e[d],p=f.getId(),h=this._eventIdToTimeline[p];if(h)if(l=!1,h!=n){var v=n.getNeighbouringTimeline(o);if(v)i(h==v?"Event "+p+" in neighbouring timeline - switching to "+h:"Event "+p+" already in a different timeline "+h),n=h;else{c.logger.info("Already have timeline for "+p+" - joining timeline "+n+" to "+h);var g=h===this._liveTimeline,y=n===this._liveTimeline,m=o===s.EventTimeline.BACKWARDS&&g,_=o===s.EventTimeline.FORWARDS&&y;m||_?(m&&c.logger.warn("Refusing to set a preceding existingTimeLine on our timeline as the existingTimeLine is live ("+h+")"),_&&c.logger.warn("Refusing to set our preceding timeline on a existingTimeLine as our timeline is live ("+n+")")):(n.setNeighbouringTimeline(h,o),h.setNeighbouringTimeline(n,a),n=h,u=!0)}}else i("Event "+p+" already in timeline "+n);else this.addEventToTimeline(f,n,t),l=!0,u=!0}if(l||!u){if(o===s.EventTimeline.FORWARDS&&n===this._liveTimeline)return c.logger.warn({lastEventWasNew:l,didUpdate:u}),void c.logger.warn("Refusing to set forwards pagination token of live timeline "+"".concat(n," to ").concat(r));n.setPaginationToken(r,o)}}},d.prototype.addLiveEvent=function(e,t,n){if(this._filter&&!this._filter.filterRoomTimeline([e]).length)return;var r=this._eventIdToTimeline[e.getId()];if(r)if("replace"===t){i("EventTimelineSet.addLiveEvent: replacing duplicate event "+e.getId());for(var o=r.getEvents(),a=0;a<o.length;a++)if(o[a].getId()===e.getId()){s.EventTimeline.setEventMetadata(e,r.getState(s.EventTimeline.FORWARDS),!1),o[a].encryptedType||(o[a]=e);break}}else i("EventTimelineSet.addLiveEvent: ignoring duplicate event "+e.getId());else this.addEventToTimeline(e,this._liveTimeline,!1,n)},d.prototype.addEventToTimeline=function(e,t,n,r){var i=e.getId();t.addEvent(e,n),this._eventIdToTimeline[i]=t,this.setRelationsTarget(e),this.aggregateRelations(e);var o={timeline:t,liveEvent:!n&&t==this._liveTimeline&&!r};this.emit("Room.timeline",e,this.room,Boolean(n),!1,o)},d.prototype.handleRemoteEcho=function(e,t,n){var r=this._eventIdToTimeline[t];r?(delete this._eventIdToTimeline[t],this._eventIdToTimeline[n]=r):this._filter?this._filter.filterRoomTimeline([e]).length&&this.addEventToTimeline(e,this._liveTimeline,!1):this.addEventToTimeline(e,this._liveTimeline,!1)},d.prototype.removeEvent=function(e){var t=this._eventIdToTimeline[e];if(!t)return null;var n=t.removeEvent(e);if(n){delete this._eventIdToTimeline[e];var r={timeline:t};this.emit("Room.timeline",n,this.room,void 0,!0,r)}return n},d.prototype.compareEventOrdering=function(e,t){if(e==t)return 0;var n=this._eventIdToTimeline[e],r=this._eventIdToTimeline[t];if(void 0===n)return null;if(void 0===r)return null;if(n===r){for(var i,o,a=n.getEvents(),u=0;u<a.length&&(void 0===i||void 0===o);u++){var c=a[u].getId();c==e&&(i=u),c==t&&(o=u)}return i-o}for(var l=n;l;){if(l===r)return-1;l=l.getNeighbouringTimeline(s.EventTimeline.FORWARDS)}for(l=n;l;){if(l===r)return 1;l=l.getNeighbouringTimeline(s.EventTimeline.BACKWARDS)}return null},d.prototype.getRelationsForEvent=function(e,t,n){if(!this._unstableClientRelationAggregation)throw new Error("Client-side relation aggregation is disabled");if(!e||!t||!n)throw new Error("Invalid arguments for `getRelationsForEvent`");return((this._relations[e]||{})[t]||{})[n]},d.prototype.setRelationsTarget=function(e){if(this._unstableClientRelationAggregation){var t=this._relations[e.getId()];if(t){var n=t["m.replace"];if(n){var r=n["m.room.message"];r&&r.setTargetEvent(e)}}}},d.prototype.aggregateRelations=function(e){var t=this;if(this._unstableClientRelationAggregation&&!e.isRedacted()&&e.status!==a.EventStatus.CANCELLED)if(e.isBeingDecrypted())e.once("Event.decrypted",(function(){t.aggregateRelations(e)}));else{var n=e.getRelation();if(n){var r=n.event_id,i=n.rel_type,o=e.getType(),s=this._relations[r];s||(s=this._relations[r]={});var u=s[i];u||(u=s[i]={});var c,d=u[o],f=!1;d||(d=u[o]=new l.Relations(i,o,this.room),f=!0,(c=this.findEventById(r)||this.room.getPendingEvent(r))&&d.setTargetEvent(c)),d.addEvent(e),f&&c&&c.emit("Event.relationsCreated",i,o)}}}},function(e,t,n){"use strict";var r=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.RoomState=u;var i=n(11),o=n(49),s=n(1),a=r(n(5));function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;this.roomId=e,this.members={},this.events=new Map,this.paginationToken=null,this._sentinels={},this._updateModifiedTime(),this._displayNameToUserIds={},this._userIdsToDisplayNames={},this._tokenToInvite={},this._joinedMemberCount=null,this._summaryJoinedMemberCount=null,this._invitedMemberCount=null,this._summaryInvitedMemberCount=null,t||(t={status:1}),this._oobMemberFlags=t}function c(e,t,n){var r=e._userIdsToDisplayNames[t];if(delete e._userIdsToDisplayNames[t],r){var i=a.removeHiddenChars(r),o=e._displayNameToUserIds[i];if(o){var s=o.filter((function(e){return e!==t}));e._displayNameToUserIds[i]=s}}e._userIdsToDisplayNames[t]=n;var u=n&&a.removeHiddenChars(n);u&&(e._displayNameToUserIds[u]||(e._displayNameToUserIds[u]=[]),e._displayNameToUserIds[u].push(t))}a.inherits(u,i.EventEmitter),u.prototype.getJoinedMemberCount=function(){return null!==this._summaryJoinedMemberCount?this._summaryJoinedMemberCount:(null===this._joinedMemberCount&&(this._joinedMemberCount=this.getMembers().reduce((function(e,t){return"join"===t.membership?e+1:e}),0)),this._joinedMemberCount)},u.prototype.setJoinedMemberCount=function(e){this._summaryJoinedMemberCount=e},u.prototype.getInvitedMemberCount=function(){return null!==this._summaryInvitedMemberCount?this._summaryInvitedMemberCount:(null===this._invitedMemberCount&&(this._invitedMemberCount=this.getMembers().reduce((function(e,t){return"invite"===t.membership?e+1:e}),0)),this._invitedMemberCount)},u.prototype.setInvitedMemberCount=function(e){this._summaryInvitedMemberCount=e},u.prototype.getMembers=function(){return a.values(this.members)},u.prototype.getMembersExcept=function(e){return a.values(this.members).filter((function(t){return!e.includes(t.userId)}))},u.prototype.getMember=function(e){return this.members[e]||null},u.prototype.getSentinelMember=function(e){if(!e)return null;var t=this._sentinels[e];if(void 0===t){t=new o.RoomMember(this.roomId,e);var n=this.members[e];n&&t.setMembershipEvent(n.events.member,this),this._sentinels[e]=t}return t},u.prototype.getStateEvents=function(e,t){if(!this.events.has(e))return void 0===t?[]:null;if(void 0===t)return Array.from(this.events.get(e).values());var n=this.events.get(e).get(t);return n||null},u.prototype.clone=function(){var e=new u(this.roomId,this._oobMemberFlags),t=this._oobMemberFlags.status;return this._oobMemberFlags.status=1,Array.from(this.events.values()).forEach((function(t){e.setStateEvents(Array.from(t.values()))})),this._oobMemberFlags.status=t,null!==this._summaryInvitedMemberCount&&e.setInvitedMemberCount(this.getInvitedMemberCount()),null!==this._summaryJoinedMemberCount&&e.setJoinedMemberCount(this.getJoinedMemberCount()),3==this._oobMemberFlags.status&&this.getMembers().forEach((function(t){t.isOutOfBand()&&e.getMember(t.userId).markOutOfBand()})),e},u.prototype.setUnknownStateEvents=function(e){var t=this,n=e.filter((function(e){return!t.events.has(e.getType())||!t.events.get(e.getType()).has(e.getStateKey())}));this.setStateEvents(n)},u.prototype.setStateEvents=function(e){var t=this;this._updateModifiedTime(),a.forEach(e,(function(e){if(e.getRoomId()===t.roomId&&e.isState()){var n=t._getStateEventMatching(e);t._setStateEvent(e),"m.room.member"===e.getType()&&(c(t,e.getStateKey(),e.getContent().displayname),function(e,t){if(!t.getContent().third_party_invite)return;var n=(t.getContent().third_party_invite.signed||{}).token;if(!n)return;if(!e.getStateEvents("m.room.third_party_invite",n))return;e._tokenToInvite[n]=t}(t,e)),t.emit("RoomState.events",e,t,n)}})),a.forEach(e,(function(e){if(e.getRoomId()===t.roomId&&e.isState())if("m.room.member"===e.getType()){var n=e.getStateKey();"leave"!==e.getContent().membership&&"ban"!==e.getContent().membership||(e.getContent().avatar_url=e.getContent().avatar_url||e.getPrevContent().avatar_url,e.getContent().displayname=e.getContent().displayname||e.getPrevContent().displayname);var r=t._getOrCreateMember(n,e);r.setMembershipEvent(e,t),t._updateMember(r),t.emit("RoomState.members",e,t,r)}else if("m.room.power_levels"===e.getType()){var i=a.values(t.members);a.forEach(i,(function(n){n.setPowerLevelEvent(e),t.emit("RoomState.members",e,t,n)})),t._sentinels={}}}))},u.prototype._getOrCreateMember=function(e,t){var n=this.members[e];return n||(n=new o.RoomMember(this.roomId,e),this.members[e]=n,this.emit("RoomState.newMember",t,this,n)),n},u.prototype._setStateEvent=function(e){this.events.has(e.getType())||this.events.set(e.getType(),new Map),this.events.get(e.getType()).set(e.getStateKey(),e)},u.prototype._getStateEventMatching=function(e){return this.events.has(e.getType())?this.events.get(e.getType()).get(e.getStateKey()):null},u.prototype._updateMember=function(e){var t=this.getStateEvents("m.room.power_levels","");t&&e.setPowerLevelEvent(t),delete this._sentinels[e.userId],this.members[e.userId]=e,this._joinedMemberCount=null,this._invitedMemberCount=null},u.prototype.needsOutOfBandMembers=function(){return 1===this._oobMemberFlags.status},u.prototype.markOutOfBandMembersStarted=function(){1===this._oobMemberFlags.status&&(this._oobMemberFlags.status=2)},u.prototype.markOutOfBandMembersFailed=function(){2===this._oobMemberFlags.status&&(this._oobMemberFlags.status=1)},u.prototype.clearOutOfBandMembers=function(){var e=this,t=0;Object.keys(this.members).forEach((function(n){e.members[n].isOutOfBand()&&(++t,delete e.members[n])})),s.logger.log("LL: RoomState removed ".concat(t," members...")),this._oobMemberFlags.status=1},u.prototype.setOutOfBandMembers=function(e){var t=this;s.logger.log("LL: RoomState about to set ".concat(e.length," OOB members ...")),2===this._oobMemberFlags.status&&(s.logger.log("LL: RoomState put in OOB_STATUS_FINISHED state ..."),this._oobMemberFlags.status=3,e.forEach((function(e){return t._setOutOfBandMember(e)})))},u.prototype._setOutOfBandMember=function(e){if("m.room.member"===e.getType()){var t=e.getStateKey(),n=this.getMember(t);if(!n||n.isOutOfBand()){var r=this._getOrCreateMember(t,e);r.setMembershipEvent(e,this),r.markOutOfBand(),c(this,r.userId,r.name),this._setStateEvent(e),this._updateMember(r),this.emit("RoomState.members",e,this,r)}}},u.prototype.setTypingEvent=function(e){a.forEach(a.values(this.members),(function(t){t.setTypingEvent(e)}))},u.prototype.getInviteForThreePidToken=function(e){return this._tokenToInvite[e]||null},u.prototype._updateModifiedTime=function(){this._modified=Date.now()},u.prototype.getLastModifiedTime=function(){return this._modified},u.prototype.getUserIdsWithDisplayName=function(e){return this._displayNameToUserIds[a.removeHiddenChars(e)]||[]},u.prototype.maySendRedactionForEvent=function(e,t){var n=this.getMember(t);if(!n||"leave"===n.membership)return!1;if(e.status||e.isRedacted())return!1;var r=this.maySendEvent("m.room.redaction",t);return e.getSender()===t?r:this._hasSufficientPowerLevelFor("redact",n.powerLevel)},u.prototype._hasSufficientPowerLevelFor=function(e,t){var n=this.getStateEvents("m.room.power_levels",""),r={};n&&(r=n.getContent());var i=50;return a.isNumber(r[e])&&(i=r[e]),t>=i},u.prototype.maySendMessage=function(e){return this._maySendEventOfType("m.room.message",e,!1)},u.prototype.maySendEvent=function(e,t){return this._maySendEventOfType(e,t,!1)},u.prototype.mayClientSendStateEvent=function(e,t){return!t.isGuest()&&this.maySendStateEvent(e,t.credentials.userId)},u.prototype.maySendStateEvent=function(e,t){return this._maySendEventOfType(e,t,!0)},u.prototype._maySendEventOfType=function(e,t,n){var r,i=this.getStateEvents("m.room.power_levels",""),o={},s=0,a=0,u=0;if(i){o=(r=i.getContent()).events||{},s=Number.isFinite(r.state_default)?r.state_default:50;var c=r.users&&r.users[t];Number.isFinite(c)?u=c:Number.isFinite(r.users_default)&&(u=r.users_default),Number.isFinite(r.events_default)&&(a=r.events_default)}var l=n?s:a;return Number.isFinite(o[e])&&(l=o[e]),u>=l},u.prototype.mayTriggerNotifOfType=function(e,t){var n=this.getMember(t);if(!n)return!1;var r=this.getStateEvents("m.room.power_levels",""),i=50;return r&&r.getContent()&&r.getContent().notifications&&a.isNumber(r.getContent().notifications[e])&&(i=r.getContent().notifications[e]),n.powerLevel>=i}},function(e,t,n){"use strict";var r=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.Group=s;var i=r(n(5)),o=n(11);function s(e){this.groupId=e,this.name=null,this.avatarUrl=null,this.myMembership=null,this.inviter=null}i.inherits(s,o.EventEmitter),s.prototype.setProfile=function(e,t){this.name===e&&this.avatarUrl===t||(this.name=e||this.groupId,this.avatarUrl=t,this.emit("Group.profile",this))},s.prototype.setMyMembership=function(e){this.myMembership!==e&&(this.myMembership=e,this.emit("Group.myMembership",this))},s.prototype.setInviter=function(e){this.inviter=e}},function(e,t,n){"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0}),t.MsgType=t.EventType=void 0,t.EventType=r,function(e){e.RoomCanonicalAlias="m.room.canonical_alias",e.RoomCreate="m.room.create",e.RoomJoinRules="m.room.join_rules",e.RoomMember="m.room.member",e.RoomThirdPartyInvite="m.room.third_party_invite",e.RoomPowerLevels="m.room.power_levels",e.RoomName="m.room.name",e.RoomTopic="m.room.topic",e.RoomAvatar="m.room.avatar",e.RoomPinnedEvents="m.room.pinned_events",e.RoomEncryption="m.room.encryption",e.RoomHistoryVisibility="m.room.history_visibility",e.RoomGuestAccess="m.room.guest_access",e.RoomServerAcl="m.room.server_acl",e.RoomTombstone="m.room.tombstone",e.RoomAliases="m.room.aliases",e.RoomRedaction="m.room.redaction",e.RoomMessage="m.room.message",e.RoomMessageEncrypted="m.room.encrypted",e.Sticker="m.sticker",e.CallInvite="m.call.invite",e.CallCandidates="m.call.candidates",e.CallAnswer="m.call.answer",e.CallHangup="m.call.hangup",e.CallReject="m.call.reject",e.CallSelectAnswer="m.call.select_answer",e.CallNegotiate="m.call.negotiate",e.KeyVerificationRequest="m.key.verification.request",e.KeyVerificationStart="m.key.verification.start",e.KeyVerificationCancel="m.key.verification.cancel",e.KeyVerificationMac="m.key.verification.mac",e.RoomMessageFeedback="m.room.message.feedback",e.Typing="m.typing",e.Receipt="m.receipt",e.Presence="m.presence",e.FullyRead="m.fully_read",e.Tag="m.tag",e.PushRules="m.push_rules",e.Direct="m.direct",e.IgnoredUserList="m.ignored_user_list",e.RoomKey="m.room_key",e.RoomKeyRequest="m.room_key_request",e.ForwardedRoomKey="m.forwarded_room_key",e.Dummy="m.dummy"}(r||(t.EventType=r={})),t.MsgType=i,function(e){e.Text="m.text",e.Emote="m.emote",e.Notice="m.notice",e.Image="m.image",e.File="m.file",e.Audio="m.audio",e.Location="m.location",e.Video="m.video"}(i||(t.MsgType=i={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeHtmlMessage=function(e,t){return{msgtype:"m.text",format:"org.matrix.custom.html",body:e,formatted_body:t}},t.makeHtmlNotice=function(e,t){return{msgtype:"m.notice",format:"org.matrix.custom.html",body:e,formatted_body:t}},t.makeHtmlEmote=function(e,t){return{msgtype:"m.emote",format:"org.matrix.custom.html",body:e,formatted_body:t}},t.makeTextMessage=function(e){return{msgtype:"m.text",body:e}},t.makeNotice=function(e){return{msgtype:"m.notice",body:e}},t.makeEmoteMessage=function(e){return{msgtype:"m.emote",body:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.exists=function(e,t){return new Promise((function(n,r){var i=!0,o=e.open(t);o.onupgradeneeded=function(){i=!1},o.onblocked=function(){return r()},o.onsuccess=function(){o.result.close(),i||e.deleteDatabase(t),n(i)},o.onerror=function(e){return r(e.target.error)}}))}},function(e,t,n){"use strict";(function(e){var r=n(6),i=n(2),o=n(3),s=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.OlmDevice=d,t.WITHHELD_MESSAGES=void 0;var a=n(1),u=n(20),c=s(n(71));function l(e){if(void 0===e)throw new Error("payloadString undefined");if(e.length>49152){var t=new Error("Message too long ("+e.length+" bytes). The maximum for an encrypted message is 49152 bytes.");throw t.data={errcode:"M_TOO_LARGE",error:"Payload too large for encrypted message"},t}}function d(e){this._cryptoStore=e,this._pickleKey="DEFAULT_KEY",this.deviceCurve25519Key=null,this.deviceEd25519Key=null,this._maxOneTimeKeys=null,this._outboundGroupSessionStore={},this._inboundGroupSessionMessageIndexes={},this._sessionsInProgress={},this._olmPrekeyPromise=Promise.resolve()}function f(e,t,n,r){return p.apply(this,arguments)}function p(){return(p=o(i.mark((function e(t,n,r,o){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.doTxn("readwrite",[u.IndexedDBCryptoStore.STORE_ACCOUNT,u.IndexedDBCryptoStore.STORE_SESSIONS],(function(e){n.storeAccount(e,t.pickledAccount),t.sessions.forEach((function(t){var r=t.deviceKey,i=t.sessionId,o={session:t.session,lastReceivedMessageTs:t.lastReceivedMessageTs};n.storeEndToEndSession(r,i,o,e)}))}));case 2:o.unpickle(r,t.pickledAccount);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e,t,n){return v.apply(this,arguments)}function v(){return(v=o(i.mark((function e(t,n,r){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.doTxn("readwrite",[u.IndexedDBCryptoStore.STORE_ACCOUNT],(function(e){t.getAccount(e,(function(i){null!==i?r.unpickle(n,i):(r.create(),i=r.pickle(n),t.storeAccount(e,i))}))}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}d.prototype.init=o(i.mark((function t(){var n,r,o,s,u,c=arguments;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=c.length>0&&void 0!==c[0]?c[0]:{},o=new e.Olm.Account,s=n.pickleKey,u=n.fromExportedDevice,t.prev=3,!u){t.next=11;break}return s&&a.logger.warn("ignoring opts.pickleKey because opts.fromExportedDevice is present."),this._pickleKey=u.pickleKey,t.next=9,f(u,this._cryptoStore,this._pickleKey,o);case 9:t.next=14;break;case 11:return s&&(this._pickleKey=s),t.next=14,h(this._cryptoStore,this._pickleKey,o);case 14:r=JSON.parse(o.identity_keys()),this._maxOneTimeKeys=o.max_number_of_one_time_keys();case 16:return t.prev=16,o.free(),t.finish(16);case 19:this.deviceCurve25519Key=r.curve25519,this.deviceEd25519Key=r.ed25519;case 21:case"end":return t.stop()}}),t,this,[[3,,16,19]])}))),d.getOlmVersion=function(){return e.Olm.get_library_version()},d.prototype._getAccount=function(t,n){var r=this;this._cryptoStore.getAccount(t,(function(t){var i=new e.Olm.Account;try{i.unpickle(r._pickleKey,t),n(i)}finally{i.free()}}))},d.prototype._storeAccount=function(e,t){this._cryptoStore.storeAccount(e,t.pickle(this._pickleKey))},d.prototype.export=o(i.mark((function e(){var t,n=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={pickleKey:this._pickleKey},e.next=3,this._cryptoStore.doTxn("readonly",[u.IndexedDBCryptoStore.STORE_ACCOUNT,u.IndexedDBCryptoStore.STORE_SESSIONS],(function(e){n._cryptoStore.getAccount(e,(function(e){t.pickledAccount=e})),t.sessions=[],n._cryptoStore.getAllEndToEndSessions(e,(function(e){t.sessions.push(e)}))}));case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)}))),d.prototype._getSession=function(e,t,n,r){var i=this;this._cryptoStore.getEndToEndSession(e,t,n,(function(e){i._unpickleSession(e,r)}))},d.prototype._unpickleSession=function(t,n){var r=new e.Olm.Session;try{r.unpickle(this._pickleKey,t.session),n(Object.assign({},t,{session:r}))}finally{r.free()}},d.prototype._saveSession=function(e,t,n){var r=t.session.session_id(),i=Object.assign(t,{session:t.session.pickle(this._pickleKey)});this._cryptoStore.storeEndToEndSession(e,r,i,n)},d.prototype._getUtility=function(t){var n=new e.Olm.Utility;try{return t(n)}finally{n.free()}},d.prototype.sign=function(){var e=o(i.mark((function e(t){var n,r=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._cryptoStore.doTxn("readonly",[u.IndexedDBCryptoStore.STORE_ACCOUNT],(function(e){r._getAccount(e,(function(e){n=e.sign(t)}))}));case 2:return e.abrupt("return",n);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),d.prototype.getOneTimeKeys=o(i.mark((function e(){var t,n=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._cryptoStore.doTxn("readonly",[u.IndexedDBCryptoStore.STORE_ACCOUNT],(function(e){n._getAccount(e,(function(e){t=JSON.parse(e.one_time_keys())}))}));case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)}))),d.prototype.maxNumberOfOneTimeKeys=function(){return this._maxOneTimeKeys},d.prototype.markKeysAsPublished=o(i.mark((function e(){var t=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._cryptoStore.doTxn("readwrite",[u.IndexedDBCryptoStore.STORE_ACCOUNT],(function(e){t._getAccount(e,(function(n){n.mark_keys_as_published(),t._storeAccount(e,n)}))}));case 2:case"end":return e.stop()}}),e,this)}))),d.prototype.generateOneTimeKeys=function(e){var t=this;return this._cryptoStore.doTxn("readwrite",[u.IndexedDBCryptoStore.STORE_ACCOUNT],(function(n){t._getAccount(n,(function(r){r.generate_one_time_keys(e),t._storeAccount(n,r)}))}))},d.prototype.generateFallbackKey=o(i.mark((function e(){var t=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._cryptoStore.doTxn("readwrite",[u.IndexedDBCryptoStore.STORE_ACCOUNT],(function(e){t._getAccount(e,(function(n){n.generate_fallback_key(),t._storeAccount(e,n)}))}));case 2:case"end":return e.stop()}}),e,this)}))),d.prototype.getFallbackKey=o(i.mark((function e(){var t,n=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._cryptoStore.doTxn("readonly",[u.IndexedDBCryptoStore.STORE_ACCOUNT],(function(e){n._getAccount(e,(function(e){t=JSON.parse(e.fallback_key())}))}));case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)}))),d.prototype.createOutboundSession=function(){var t=o(i.mark((function t(n,r){var o,s=this;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._cryptoStore.doTxn("readwrite",[u.IndexedDBCryptoStore.STORE_ACCOUNT,u.IndexedDBCryptoStore.STORE_SESSIONS],(function(t){s._getAccount(t,(function(i){var a=new e.Olm.Session;try{a.create_outbound(i,n,r),o=a.session_id(),s._storeAccount(t,i);var u={session:a,lastReceivedMessageTs:Date.now()};s._saveSession(n,u,t)}finally{a.free()}}))}));case 2:return t.abrupt("return",o);case 3:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}(),d.prototype.createInboundSession=function(){var t=o(i.mark((function t(n,r,o){var s,a=this;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0===r){t.next=2;break}throw new Error("Need messageType == 0 to create inbound session");case 2:return t.next=4,this._cryptoStore.doTxn("readwrite",[u.IndexedDBCryptoStore.STORE_ACCOUNT,u.IndexedDBCryptoStore.STORE_SESSIONS],(function(t){a._getAccount(t,(function(i){var u=new e.Olm.Session;try{u.create_inbound_from(i,n,o),i.remove_one_time_keys(u),a._storeAccount(t,i);var c=u.decrypt(r,o),l={session:u,lastReceivedMessageTs:Date.now()};a._saveSession(n,l,t),s={payload:c,session_id:u.session_id()}}finally{u.free()}}))}));case 4:return t.abrupt("return",s);case 5:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}(),d.prototype.getSessionIdsForDevice=function(){var e=o(i.mark((function e(t){var n,r=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._sessionsInProgress[t]){e.next=9;break}return a.logger.log("waiting for olm session to be created"),e.prev=2,e.next=5,this._sessionsInProgress[t];case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:return e.next=11,this._cryptoStore.doTxn("readonly",[u.IndexedDBCryptoStore.STORE_SESSIONS],(function(e){r._cryptoStore.getEndToEndSessions(t,e,(function(e){n=Object.keys(e)}))}));case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}}),e,this,[[2,7]])})));return function(t){return e.apply(this,arguments)}}(),d.prototype.getSessionIdForDevice=function(){var e=o(i.mark((function e(t,n){var r,o,s,a,u,c,l;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSessionInfoForDevice(t,n);case 2:if(0!==(r=e.sent).length){e.next=5;break}return e.abrupt("return",null);case 5:for(o=0,s=1;s<r.length;s++)a=r[s],u=void 0===a.lastReceivedMessageTs?0:a.lastReceivedMessageTs,c=r[o],l=void 0===c.lastReceivedMessageTs?0:c.lastReceivedMessageTs,(u>l||u===l&&a.sessionId<c.sessionId)&&(o=s);return e.abrupt("return",r[o].sessionId);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),d.prototype.getSessionInfoForDevice=function(){var e=o(i.mark((function e(t,n){var o,s=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._sessionsInProgress[t]||n){e.next=9;break}return a.logger.log("waiting for olm session to be created"),e.prev=2,e.next=5,this._sessionsInProgress[t];case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:return o=[],e.next=12,this._cryptoStore.doTxn("readonly",[u.IndexedDBCryptoStore.STORE_SESSIONS],(function(e){s._cryptoStore.getEndToEndSessions(t,e,(function(e){var t,n=Object.keys(e).sort(),i=r(n);try{var a=function(){var n=t.value;s._unpickleSession(e[n],(function(e){o.push({lastReceivedMessageTs:e.lastReceivedMessageTs,hasReceivedMessage:e.session.has_received_message(),sessionId:n})}))};for(i.s();!(t=i.n()).done;)a()}catch(u){i.e(u)}finally{i.f()}}))}));case 12:return e.abrupt("return",o);case 13:case"end":return e.stop()}}),e,this,[[2,7]])})));return function(t,n){return e.apply(this,arguments)}}(),d.prototype.encryptMessage=function(){var e=o(i.mark((function e(t,n,r){var o,s=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l(r),e.next=3,this._cryptoStore.doTxn("readwrite",[u.IndexedDBCryptoStore.STORE_SESSIONS],(function(e){s._getSession(t,n,e,(function(i){var u=i.session.describe();a.logger.log("encryptMessage: Olm Session ID "+n+" to "+t+": "+u),o=i.session.encrypt(r),s._saveSession(t,i,e)}))}));case 3:return e.abrupt("return",o);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),d.prototype.decryptMessage=function(){var e=o(i.mark((function e(t,n,r,o){var s,c=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._cryptoStore.doTxn("readwrite",[u.IndexedDBCryptoStore.STORE_SESSIONS],(function(e){c._getSession(t,n,e,(function(i){var u=i.session.describe();a.logger.log("decryptMessage: Olm Session ID "+n+" from "+t+": "+u),s=i.session.decrypt(r,o),i.lastReceivedMessageTs=Date.now(),c._saveSession(t,i,e)}))}));case 2:return e.abrupt("return",s);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),d.prototype.matchesSession=function(){var e=o(i.mark((function e(t,n,r,o){var s,a=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0===r){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,this._cryptoStore.doTxn("readonly",[u.IndexedDBCryptoStore.STORE_SESSIONS],(function(e){a._getSession(t,n,e,(function(e){s=e.session.matches_inbound(o)}))}));case 4:return e.abrupt("return",s);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),d.prototype.recordSessionProblem=function(){var e=o(i.mark((function e(t,n,r){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._cryptoStore.storeEndToEndSessionProblem(t,n,r);case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),d.prototype.sessionMayHaveProblems=function(){var e=o(i.mark((function e(t,n){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._cryptoStore.getEndToEndSessionProblem(t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),d.prototype.filterOutNotifiedErrorDevices=function(){var e=o(i.mark((function e(t){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._cryptoStore.filterOutNotifiedErrorDevices(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),d.prototype._saveOutboundGroupSession=function(e){var t=e.pickle(this._pickleKey);this._outboundGroupSessionStore[e.session_id()]=t},d.prototype._getOutboundGroupSession=function(t,n){var r=this._outboundGroupSessionStore[t];if(void 0===r)throw new Error("Unknown outbound group session "+t);var i=new e.Olm.OutboundGroupSession;try{return i.unpickle(this._pickleKey,r),n(i)}finally{i.free()}},d.prototype.createOutboundGroupSession=function(){var t=new e.Olm.OutboundGroupSession;try{return t.create(),this._saveOutboundGroupSession(t),t.session_id()}finally{t.free()}},d.prototype.encryptGroupMessage=function(e,t){var n=this;return a.logger.log("encrypting msg with megolm session ".concat(e)),l(t),this._getOutboundGroupSession(e,(function(e){var r=e.encrypt(t);return n._saveOutboundGroupSession(e),r}))},d.prototype.getOutboundGroupSessionKey=function(e){return this._getOutboundGroupSession(e,(function(e){return{chain_index:e.message_index(),key:e.session_key()}}))},d.prototype._unpickleInboundGroupSession=function(t,n){var r=new e.Olm.InboundGroupSession;try{return r.unpickle(this._pickleKey,t.session),n(r)}finally{r.free()}},d.prototype._getInboundGroupSession=function(e,t,n,r,i){var o=this;this._cryptoStore.getEndToEndInboundGroupSession(t,n,r,(function(t,n){if(null!==t){if(null!==e&&e!==t.room_id)throw new Error("Mismatched room_id for inbound group session (expected "+t.room_id+", was "+e+")");o._unpickleInboundGroupSession(t,(function(e){i(e,t,n)}))}else i(null,null,n)}))},d.prototype.addInboundGroupSession=function(){var t=o(i.mark((function t(n,r,o,s,c,l,d){var f,p=this,h=arguments;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return f=h.length>7&&void 0!==h[7]?h[7]:{},t.next=3,this._cryptoStore.doTxn("readwrite",[u.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,u.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(function(t){p._getInboundGroupSession(n,r,s,t,(function(i,u){var h=new e.Olm.InboundGroupSession;try{if(d?h.import_session(c):h.create(c),s!=h.session_id())throw new Error("Mismatched group session ID from senderKey: "+r);if(i&&(a.logger.log("Update for megolm session "+r+"/"+s),i.first_known_index()<=h.first_known_index()))return void a.logger.log("Keeping existing megolm session ".concat(s));a.logger.info("Storing megolm session "+r+"/"+s+" with first index "+h.first_known_index());var v=Object.assign({},f,{room_id:n,session:h.pickle(p._pickleKey),keysClaimed:l,forwardingCurve25519KeyChain:o});p._cryptoStore.storeEndToEndInboundGroupSession(r,s,v,t)}finally{h.free()}}))}));case 3:case"end":return t.stop()}}),t,this)})));return function(e,n,r,i,o,s,a){return t.apply(this,arguments)}}(),d.prototype.addInboundGroupSessionWithheld=function(){var e=o(i.mark((function e(t,n,r,o,s){var a=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._cryptoStore.doTxn("readwrite",[u.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(function(e){a._cryptoStore.storeEndToEndInboundGroupSessionWithheld(n,r,{room_id:t,code:o,reason:s},e)}));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}();var g={"m.unverified":"The sender has disabled encrypting to unverified devices.","m.blacklisted":"The sender has blocked you.","m.unauthorised":"You are not authorised to read the message.","m.no_olm":"Unable to establish a secure channel."};function y(e){return e.code&&e.code in g?g[e.code]:e.reason?e.reason:"decryption key withheld"}t.WITHHELD_MESSAGES=g,d.prototype.decryptGroupMessage=function(){var e=o(i.mark((function e(t,n,r,o,s,a){var l,d,f=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._cryptoStore.doTxn("readwrite",[u.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,u.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(function(e){f._getInboundGroupSession(t,n,r,e,(function(t,i,u){if(null===t)return u&&(d=new c.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",y(u),{session:n+"|"+r})),void(l=null);var p;try{p=t.decrypt(o)}catch(m){return void(d=m&&"OLM.UNKNOWN_MESSAGE_INDEX"===m.message&&u?new c.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",y(u),{session:n+"|"+r}):m)}var h=p.plaintext;if(void 0===h)h=p;else{var v=n+"|"+r+"|"+p.message_index;if(v in f._inboundGroupSessionMessageIndexes){var g=f._inboundGroupSessionMessageIndexes[v];if(g.id!==s||g.timestamp!==a)return void(d=new Error("Duplicate message index, possible replay attack: "+v))}f._inboundGroupSessionMessageIndexes[v]={id:s,timestamp:a}}i.session=t.pickle(f._pickleKey),f._cryptoStore.storeEndToEndInboundGroupSession(n,r,i,e),l={result:h,keysClaimed:i.keysClaimed||{},senderKey:n,forwardingCurve25519KeyChain:i.forwardingCurve25519KeyChain||[],untrusted:i.untrusted}}))}));case 2:if(!d){e.next=4;break}throw d;case 4:return e.abrupt("return",l);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o,s){return e.apply(this,arguments)}}(),d.prototype.hasInboundSessionKeys=function(){var e=o(i.mark((function e(t,n,r){var o,s=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._cryptoStore.doTxn("readonly",[u.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,u.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(function(e){s._cryptoStore.getEndToEndInboundGroupSession(n,r,e,(function(e){null!==e?t!==e.room_id?(a.logger.warn("requested keys for inbound group session ".concat(n,"|")+"".concat(r,", with incorrect room_id ")+"(expected ".concat(e.room_id,", ")+"was ".concat(t,")")),o=!1):o=!0:o=!1}))}));case 2:return e.abrupt("return",o);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),d.prototype.getInboundGroupSessionKey=function(){var e=o(i.mark((function e(t,n,r,o){var s,a=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._cryptoStore.doTxn("readonly",[u.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,u.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(function(e){a._getInboundGroupSession(t,n,r,e,(function(e,t){if(null!==e){void 0===o&&(o=e.first_known_index());var n=e.export_session(o),r=(t.keysClaimed||{}).ed25519||null;s={chain_index:o,key:n,forwarding_curve25519_key_chain:t.forwardingCurve25519KeyChain||[],sender_claimed_ed25519_key:r}}else s=null}))}));case 2:return e.abrupt("return",s);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),d.prototype.exportInboundGroupSession=function(e,t,n){return this._unpickleInboundGroupSession(n,(function(r){var i=r.first_known_index();return{sender_key:e,sender_claimed_keys:n.keysClaimed,room_id:n.room_id,session_id:t,session_key:r.export_session(i),forwarding_curve25519_key_chain:r.forwardingCurve25519KeyChain||[],first_known_index:r.first_known_index()}}))},d.prototype.verifySignature=function(e,t,n){this._getUtility((function(r){r.ed25519_verify(e,t,n)}))}}).call(this,n(9))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(127),n(128);var r=n(52);Object.keys(r).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===r[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}}))}))},function(e,t,n){"use strict";(function(e,r){var i=n(32),o=n(2),s=n(3),a=n(7),u=n(8),c=n(13),l=n(14);Object.defineProperty(t,"__esModule",{value:!0}),t.QRCodeData=t.ReciprocateQRCode=t.SCAN_QR_CODE_METHOD=t.SHOW_QR_CODE_METHOD=void 0;var d=n(53),f=n(30),p=n(17),h=n(1);t.SHOW_QR_CODE_METHOD="m.qr_code.show.v1";t.SCAN_QR_CODE_METHOD="m.qr_code.scan.v1";var v=function(e){c(n,e);var t=l(n);function n(){return a(this,n),t.apply(this,arguments)}return u(n,[{key:"_doVerification",value:function(){var e=s(o.mark((function e(){var t,n,r,i,s,a=this;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.startEvent){e.next=2;break}throw new Error("It is not currently possible to start verificationwith this method yet.");case 2:if(t=this.request.qrCodeData,this.startEvent.getContent().secret===t.encodedSharedSecret){e.next=5;break}throw(0,f.newKeyMismatchError)();case 5:return e.next=7,new Promise((function(e,t){a.reciprocateQREvent={confirm:e,cancel:function(){return t((0,f.newUserCancelledError)())}},a.emit("show_reciprocate_qr",a.reciprocateQREvent)}));case 7:n={},e.t0=t.mode,e.next=e.t0===g?11:e.t0===y?14:e.t0===m?17:20;break;case 11:return r=t.otherUserMasterKey,n["ed25519:".concat(r)]=r,e.abrupt("break",20);case 14:return i=this.request.targetDevice.deviceId,n["ed25519:".concat(i)]=t.otherDeviceKey,e.abrupt("break",20);case 17:return s=t.myMasterKey,n["ed25519:".concat(s)]=s,e.abrupt("break",20);case 20:return e.next=22,this._verifyKeys(this.userId,n,(function(e,t,r){var i=n[e];if(!i)throw(0,f.newKeyMismatchError)();if(r!==i)throw h.logger.error("key ID from key info does not match"),(0,f.newKeyMismatchError)();for(var o in t.keys)if(o.startsWith("ed25519")){var s=n[o];if(!s)throw(0,f.newKeyMismatchError)();if(t.keys[o]!==s)throw h.logger.error("master key does not match"),(0,f.newKeyMismatchError)()}}));case 22:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}],[{key:"factory",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return i(n,t)}},{key:"NAME",get:function(){return"m.reciprocate.v1"}}]),n}(d.VerificationBase);t.ReciprocateQRCode=v;var g=0,y=1,m=2,_=function(){function t(e,n,r,i,o,s){a(this,t),this._sharedSecret=n,this._mode=e,this._otherUserMasterKey=r,this._otherDeviceKey=i,this._myMasterKey=o,this._buffer=s}return u(t,[{key:"buffer",get:function(){return this._buffer}},{key:"mode",get:function(){return this._mode}},{key:"otherDeviceKey",get:function(){return this._otherDeviceKey}},{key:"otherUserMasterKey",get:function(){return this._otherUserMasterKey}},{key:"myMasterKey",get:function(){return this._myMasterKey}},{key:"encodedSharedSecret",get:function(){return this._sharedSecret}}],[{key:"create",value:function(){var e=s(o.mark((function e(n,r){var i,s,a,u,c,l,d,f,p,h;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t._generateSharedSecret(),s=t._determineMode(n,r),a=null,u=null,c=null,s!==g){e.next=10;break}l=r.getStoredCrossSigningForUser(n.otherUserId),a=l.getId("master"),e.next=17;break;case 10:if(s!==y){e.next=16;break}return e.next=13,t._getOtherDeviceKey(n,r);case 13:u=e.sent,e.next=17;break;case 16:s===m&&(d=r.getUserId(),f=r.getStoredCrossSigningForUser(d),c=f.getId("master"));case 17:return p=t._generateQrData(n,r,s,i,a,u,c),h=t._generateBuffer(p),e.abrupt("return",new t(s,i,a,u,c,h));case 20:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_generateSharedSecret",value:function(){var t=new Uint8Array(11);return e.crypto.getRandomValues(t),(0,p.encodeUnpaddedBase64)(t)}},{key:"_getOtherDeviceKey",value:function(){var e=s(o.mark((function e(t,n){var r,i,s,a,u;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.getUserId(),i=t.targetDevice,s=i?i.deviceId:null,a=n.getStoredDevice(r,s)){e.next=6;break}throw new Error("could not find device "+s);case 6:return u=a.getFingerprint(),e.abrupt("return",u);case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_determineMode",value:function(e,t){var n=t.getUserId(),r=e.otherUserId,i=g;n===r&&(i=t.checkUserTrust(n).isCrossSigningVerified()?y:m);return i}},{key:"_generateQrData",value:function(e,t,n,r,i,o,s){var a=t.getUserId(),u={prefix:"MATRIX",version:2,mode:n,transactionId:e.channel.transactionId,firstKeyB64:"",secondKeyB64:"",secretB64:r},c=t.getStoredCrossSigningForUser(a);return n===g?(u.firstKeyB64=c.getId("master"),u.secondKeyB64=i):n===y?(u.firstKeyB64=c.getId("master"),u.secondKeyB64=o):n===m&&(u.firstKeyB64=t.getDeviceEd25519Key(),u.secondKeyB64=s),u}},{key:"_generateBuffer",value:function(e){var t=r.alloc(0),n=function(e){var n=r.from([e]);t=r.concat([t,n])},i=function(e){var n=r.alloc(2);n.writeInt16BE(e,0),t=r.concat([t,n])},o=function(e,n){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=r.from(e,n);o&&i(s.byteLength),t=r.concat([t,s])},s=function(e){var n=(0,p.decodeBase64)(e),i=r.from(n);t=r.concat([t,i])};return o(e.prefix,"ascii",!1),n(e.version),n(e.mode),o(e.transactionId,"utf-8"),s(e.firstKeyB64),s(e.secondKeyB64),s(e.secretB64),t}}]),t}();t.QRCodeData=_}).call(this,n(9),n(19).Buffer)},function(e,t,n){"use strict";(function(e){var r=n(2),i=n(3);Object.defineProperty(t,"__esModule",{value:!0}),t.keyFromAuthData=function(e,t){return u.apply(this,arguments)},t.keyFromPassphrase=function(e){return c.apply(this,arguments)},t.deriveKey=l;var o=n(41),s=5e5,a=256;function u(){return(u=i(r.mark((function t(n,i){return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.Olm){t.next=2;break}throw new Error("Olm is not available");case 2:if(n.private_key_salt&&n.private_key_iterations){t.next=4;break}throw new Error("Salt and/or iterations not found: this backup cannot be restored with a passphrase");case 4:return t.next=6,l(i,n.private_key_salt,n.private_key_iterations,n.private_key_bits||a);case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function c(){return(c=i(r.mark((function t(n){var i,u;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.Olm){t.next=2;break}throw new Error("Olm is not available");case 2:return i=(0,o.randomString)(32),t.next=5,l(n,i,s,a);case 5:return u=t.sent,t.abrupt("return",{key:u,salt:i,iterations:s});case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function l(e,t,n){return d.apply(this,arguments)}function d(){return(d=i(r.mark((function t(n,i,o){var s,u,c,l,d,f=arguments;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=f.length>3&&void 0!==f[3]?f[3]:a,u=e.crypto.subtle,c=e.TextEncoder,u&&c){t.next=5;break}throw new Error("Password-based backup is not avaiable on this platform");case 5:return t.next=7,u.importKey("raw",(new c).encode(n),{name:"PBKDF2"},!1,["deriveBits"]);case 7:return l=t.sent,t.next=10,u.deriveBits({name:"PBKDF2",salt:(new c).encode(i),iterations:o,hash:"SHA-512"},l,s);case 10:return d=t.sent,t.abrupt("return",new Uint8Array(d));case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}}).call(this,n(9))},function(e,t,n){"use strict";(function(e,r){var i=n(6),o=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.encodeRecoveryKey=function(t){var n=new e(a.length+t.length+1);n.set(a,0),n.set(t,a.length);for(var r=0,i=0;i<n.length-1;++i)r^=n[i];return n[n.length-1]=r,s.default.encode(n).match(/.{1,4}/g).join(" ")},t.decodeRecoveryKey=function(e){var t,n=s.default.decode(e.replace(/ /g,"")),o=0,u=i(n);try{for(u.s();!(t=u.n()).done;){var c=t.value;o^=c}}catch(d){u.e(d)}finally{u.f()}if(0!==o)throw new Error("Incorrect parity");for(var l=0;l<a.length;++l)if(n[l]!==a[l])throw new Error("Incorrect prefix");if(n.length!==a.length+r.Olm.PRIVATE_KEY_LENGTH+1)throw new Error("Incorrect length");return Uint8Array.from(n.slice(a.length,a.length+r.Olm.PRIVATE_KEY_LENGTH))};var s=o(n(134)),a=[139,1]}).call(this,n(19).Buffer,n(9))},function(e,t,n){"use strict";(function(e,r){var i=n(10),o=n(15),s=n(2),a=n(3),u=n(7),c=n(8),l=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.DehydrationManager=t.DEHYDRATION_ALGORITHM=void 0;var d=l(n(21)),f=n(17),p=n(20),h=n(40),v=l(n(37)),g=n(1),y="org.matrix.msc2697.v1.olm.libolm_pickle";t.DEHYDRATION_ALGORITHM=y;var m=6048e5,_=function(){function t(e){u(this,t),this.crypto=e,(0,d.default)(this,"inProgress",!1),(0,d.default)(this,"timeoutId",void 0),(0,d.default)(this,"key",void 0),(0,d.default)(this,"keyInfo",void 0),(0,d.default)(this,"deviceDisplayName",void 0),this.getDehydrationKeyFromCache()}return c(t,[{key:"getDehydrationKeyFromCache",value:function(){var t=a(s.mark((function t(){var n=this;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.crypto._cryptoStore.doTxn("readonly",[p.IndexedDBCryptoStore.STORE_ACCOUNT],(function(t){n.crypto._cryptoStore.getSecretStorePrivateKey(t,function(){var t=a(s.mark((function t(i){var o,a,u,c,l,d,p,v;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!i){t.next=12;break}return o=i.key,a=i.keyInfo,u=i.deviceDisplayName,c=i.time,l=e.from(n.crypto._olmDevice._pickleKey),t.next=5,(0,h.decryptAES)(o,l,y);case 5:d=t.sent,n.key=(0,f.decodeBase64)(d),n.keyInfo=a,n.deviceDisplayName=u,p=Date.now(),v=Math.max(1,c+m-p),n.timeoutId=r.setTimeout(n.dehydrateDevice.bind(n),v);case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),"dehydration")}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"setKeyAndQueueDehydration",value:function(){var e=a(s.mark((function e(t){var n,r,i=arguments;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:{},r=i.length>2&&void 0!==i[2]?i[2]:void 0,e.next=4,this.setKey(t,n,r);case 4:e.sent||this.dehydrateDevice();case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setKey",value:function(){var e=a(s.mark((function e(t){var n,i,o,a,u=this,c=arguments;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=c.length>1&&void 0!==c[1]?c[1]:{},i=c.length>2&&void 0!==c[2]?c[2]:void 0,t){e.next=9;break}return this.timeoutId&&(r.clearTimeout(this.timeoutId),this.timeoutId=void 0),e.next=6,this.crypto._cryptoStore.doTxn("readwrite",[p.IndexedDBCryptoStore.STORE_ACCOUNT],(function(e){u.crypto._cryptoStore.storeSecretStorePrivateKey(e,"dehydration",null)}));case 6:return this.key=void 0,this.keyInfo=void 0,e.abrupt("return");case 9:for(o=this.key&&t.length==this.key.length,a=0;o&&a<t.length;a++)t[a]!=this.key[a]&&(o=!1);return o||(this.key=t,this.keyInfo=n,this.deviceDisplayName=i),e.abrupt("return",o);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"dehydrateDevice",value:function(){var t=a(s.mark((function t(){var n,a,u,c,l,d,_,b,k,S,E,w,x,I,T,R,O,C,D,P,A,M,U,N,L,K,B,j,q,F,V=this;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.inProgress){t.next=3;break}return g.logger.log("Dehydration already in progress -- not starting new dehydration"),t.abrupt("return");case 3:return this.inProgress=!0,this.timeoutId&&(r.clearTimeout(this.timeoutId),this.timeoutId=void 0),t.prev=5,a=e.from(this.crypto._olmDevice._pickleKey),t.next=9,(0,h.encryptAES)((0,f.encodeBase64)(this.key),a,y);case 9:return u=t.sent,t.next=12,this.crypto._cryptoStore.doTxn("readwrite",[p.IndexedDBCryptoStore.STORE_ACCOUNT],(function(e){V.crypto._cryptoStore.storeSecretStorePrivateKey(e,"dehydration",{keyInfo:V.keyInfo,key:u,deviceDisplayName:V.deviceDisplayName,time:Date.now()})}));case 12:return g.logger.log("Attempting to dehydrate device"),g.logger.log("Creating account"),(c=new r.Olm.Account).create(),l=JSON.parse(c.identity_keys()),d=c.max_number_of_one_time_keys(),c.generate_one_time_keys(d/2),c.generate_fallback_key(),_=JSON.parse(c.one_time_keys()),b=JSON.parse(c.fallback_key()),c.mark_keys_as_published(),k=c.pickle(new Uint8Array(this.key)),S={algorithm:y,account:k},this.keyInfo.passphrase&&(S.passphrase=this.keyInfo.passphrase),g.logger.log("Uploading account to server"),t.next=29,this.crypto._baseApis._http.authedRequest(void 0,"PUT","/dehydrated_device",void 0,{device_data:S,initial_device_display_name:this.deviceDisplayName},{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"});case 29:if(E=t.sent,w=E.device_id,g.logger.log("Preparing device keys",w),x={algorithms:this.crypto._supportedAlgorithms,device_id:w,user_id:this.crypto._userId,keys:(n={},o(n,"ed25519:".concat(w),l.ed25519),o(n,"curve25519:".concat(w),l.curve25519),n)},I=c.sign(v.default.stringify(x)),x.signatures=o({},this.crypto._userId,o({},"ed25519:".concat(w),I)),!this.crypto._crossSigningInfo.getId("self_signing")){t.next=38;break}return t.next=38,this.crypto._crossSigningInfo.signObject(x,"self_signing");case 38:for(g.logger.log("Preparing one-time keys"),T={},R=0,O=Object.entries(_.curve25519);R<O.length;R++)C=i(O[R],2),D=C[0],P=C[1],A={key:P},M=c.sign(v.default.stringify(A)),A.signatures=o({},this.crypto._userId,o({},"ed25519:".concat(w),M)),T["signed_curve25519:".concat(D)]=A;for(g.logger.log("Preparing fallback keys"),U={},N=0,L=Object.entries(b.curve25519);N<L.length;N++)K=i(L[N],2),B=K[0],j=K[1],q={key:j,fallback:!0},F=c.sign(v.default.stringify(q)),q.signatures=o({},this.crypto._userId,o({},"ed25519:".concat(w),F)),U["signed_curve25519:".concat(B)]=q;return g.logger.log("Uploading keys to server"),t.next=47,this.crypto._baseApis._http.authedRequest(void 0,"POST","/keys/upload/"+encodeURI(w),void 0,{device_keys:x,one_time_keys:T,"org.matrix.msc2732.fallback_keys":U});case 47:return g.logger.log("Done dehydrating"),this.timeoutId=r.setTimeout(this.dehydrateDevice.bind(this),m),t.abrupt("return",w);case 50:return t.prev=50,this.inProgress=!1,t.finish(50);case 53:case"end":return t.stop()}}),t,this,[[5,,50,53]])})));return function(){return t.apply(this,arguments)}}()},{key:"stop",value:function(){this.timeoutId&&(r.clearTimeout(this.timeoutId),this.timeoutId=void 0)}}]),t}();t.DehydrationManager=_}).call(this,n(19).Buffer,n(9))},function(e,t,n){"use strict";var r=n(2),i=n(3),o=n(8),s=n(7);Object.defineProperty(t,"__esModule",{value:!0}),t.AutoDiscovery=void 0;var a=n(1),u=n(46),c=function(){function e(){s(this,e)}return o(e,null,[{key:"fromDiscoveryConfig",value:function(){var t=i(r.mark((function t(n){var i,o,s,u,c,l;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i={"m.homeserver":{state:e.FAIL_ERROR,error:e.ERROR_INVALID,base_url:null},"m.identity_server":{state:e.PROMPT,error:null,base_url:null}},n&&n["m.homeserver"]){t.next=6;break}return a.logger.error("No m.homeserver key in config"),i["m.homeserver"].state=e.FAIL_PROMPT,i["m.homeserver"].error=e.ERROR_INVALID,t.abrupt("return",Promise.resolve(i));case 6:if(n["m.homeserver"].base_url){t.next=11;break}return a.logger.error("No m.homeserver base_url in config"),i["m.homeserver"].state=e.FAIL_PROMPT,i["m.homeserver"].error=e.ERROR_INVALID_HS_BASE_URL,t.abrupt("return",Promise.resolve(i));case 11:if(o=this._sanitizeWellKnownUrl(n["m.homeserver"].base_url)){t.next=16;break}return a.logger.error("Invalid base_url for m.homeserver"),i["m.homeserver"].error=e.ERROR_INVALID_HS_BASE_URL,t.abrupt("return",Promise.resolve(i));case 16:return t.next=18,this._fetchWellKnownObject("".concat(o,"/_matrix/client/versions"));case 18:if((s=t.sent)&&s.raw.versions){t.next=24;break}return a.logger.error("Invalid /versions response"),i["m.homeserver"].error=e.ERROR_INVALID_HOMESERVER,i["m.homeserver"].base_url=o,t.abrupt("return",Promise.resolve(i));case 24:if(i["m.homeserver"]={state:e.SUCCESS,error:null,base_url:o},u="",!n["m.identity_server"]){t.next=41;break}if(c={"m.homeserver":i["m.homeserver"],"m.identity_server":{state:e.FAIL_PROMPT,error:e.ERROR_INVALID_IS,base_url:null}},u=this._sanitizeWellKnownUrl(n["m.identity_server"].base_url)){t.next=33;break}return a.logger.error("Invalid base_url for m.identity_server"),c["m.identity_server"].error=e.ERROR_INVALID_IS_BASE_URL,t.abrupt("return",Promise.resolve(c));case 33:return t.next=35,this._fetchWellKnownObject("".concat(u,"/_matrix/identity/api/v1"));case 35:if((l=t.sent)&&l.raw&&"SUCCESS"===l.action){t.next=41;break}return a.logger.error("Invalid /api/v1 response"),c["m.identity_server"].error=e.ERROR_INVALID_IDENTITY_SERVER,c["m.identity_server"].base_url=u,t.abrupt("return",Promise.resolve(c));case 41:return u&&u.length>0&&(i["m.identity_server"]={state:e.SUCCESS,error:null,base_url:u}),Object.keys(n).map((function(e){if("m.homeserver"===e||"m.identity_server"===e)for(var t=["error","state","base_url"],r=0,o=Object.keys(n[e]);r<o.length;r++){var s=o[r];t.includes(s)||(i[e][s]=n[e][s])}else i[e]=n[e]})),t.abrupt("return",Promise.resolve(i));case 44:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"findClientConfig",value:function(){var t=i(r.mark((function t(n){var i,o;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n&&"string"===typeof n&&0!==n.length){t.next=2;break}throw new Error("'domain' must be a string of non-zero length");case 2:return i={"m.homeserver":{state:e.FAIL_ERROR,error:e.ERROR_INVALID,base_url:null},"m.identity_server":{state:e.PROMPT,error:null,base_url:null}},t.next=5,this._fetchWellKnownObject("https://".concat(n,"/.well-known/matrix/client"));case 5:if((o=t.sent)&&"SUCCESS"===o.action){t.next=11;break}return a.logger.error("No response or error when parsing .well-known"),o.reason&&a.logger.error(o.reason),"IGNORE"===o.action?i["m.homeserver"]={state:e.PROMPT,error:null,base_url:null}:(i["m.homeserver"].state=e.FAIL_PROMPT,i["m.homeserver"].error=e.ERROR_INVALID),t.abrupt("return",Promise.resolve(i));case 11:return t.abrupt("return",e.fromDiscoveryConfig(o.raw));case 12:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getRawClientConfig",value:function(){var e=i(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&"string"===typeof t&&0!==t.length){e.next=2;break}throw new Error("'domain' must be a string of non-zero length");case 2:return e.next=4,this._fetchWellKnownObject("https://".concat(t,"/.well-known/matrix/client"));case 4:if(n=e.sent){e.next=7;break}return e.abrupt("return",{});case 7:return e.abrupt("return",n.raw||{});case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_sanitizeWellKnownUrl",value:function(e){if(!e)return!1;try{var t=null;try{t=u.URL?new u.URL(e):new URL(e)}catch(o){t=new URL(e)}if(!t||!t.hostname)return!1;if("http:"!==t.protocol&&"https:"!==t.protocol)return!1;var n=t.port?":".concat(t.port):"",r=t.pathname?t.pathname:"",i="".concat(t.protocol,"//").concat(t.hostname).concat(n).concat(r);return i.endsWith("/")&&(i=i.substring(0,i.length-1)),i}catch(o){return a.logger.error(o),!1}}},{key:"_fetchWellKnownObject",value:function(){var t=i(r.mark((function t(i){return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,r){var o=n(57).getRequest();if(!o)throw new Error("No request library available");o({method:"GET",uri:i,timeout:5e3},(function(n,r,i){if(n||r&&(r.statusCode<200||r.statusCode>=300)){var o="FAIL_PROMPT",s=(n?n.message:null)||"General failure";return r&&404===r.statusCode&&(o="IGNORE",s=e.ERROR_MISSING_WELLKNOWN),void t({raw:{},action:o,reason:s,error:n})}try{t({raw:JSON.parse(i),action:"SUCCESS"})}catch(u){var a=e.ERROR_INVALID;"SyntaxError"===u.name&&(a=e.ERROR_INVALID_JSON),t({raw:{},action:"FAIL_PROMPT",reason:a,error:u})}}))})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"ERROR_INVALID",get:function(){return"Invalid homeserver discovery response"}},{key:"ERROR_GENERIC_FAILURE",get:function(){return"Failed to get autodiscovery configuration from server"}},{key:"ERROR_INVALID_HS_BASE_URL",get:function(){return"Invalid base_url for m.homeserver"}},{key:"ERROR_INVALID_HOMESERVER",get:function(){return"Homeserver URL does not appear to be a valid Matrix homeserver"}},{key:"ERROR_INVALID_IS_BASE_URL",get:function(){return"Invalid base_url for m.identity_server"}},{key:"ERROR_INVALID_IDENTITY_SERVER",get:function(){return"Identity server URL does not appear to be a valid identity server"}},{key:"ERROR_INVALID_IS",get:function(){return"Invalid identity server discovery response"}},{key:"ERROR_MISSING_WELLKNOWN",get:function(){return"No .well-known JSON file found"}},{key:"ERROR_INVALID_JSON",get:function(){return"Invalid JSON"}},{key:"ALL_ERRORS",get:function(){return[e.ERROR_INVALID,e.ERROR_GENERIC_FAILURE,e.ERROR_INVALID_HS_BASE_URL,e.ERROR_INVALID_HOMESERVER,e.ERROR_INVALID_IS_BASE_URL,e.ERROR_INVALID_IDENTITY_SERVER,e.ERROR_INVALID_IS,e.ERROR_MISSING_WELLKNOWN,e.ERROR_INVALID_JSON]}},{key:"FAIL_ERROR",get:function(){return"FAIL_ERROR"}},{key:"FAIL_PROMPT",get:function(){return"FAIL_PROMPT"}},{key:"PROMPT",get:function(){return"PROMPT"}},{key:"SUCCESS",get:function(){return"SUCCESS"}}]),e}();t.AutoDiscovery=c},function(e,t,n){"use strict";var r=n(7),i=n(8);Object.defineProperty(t,"__esModule",{value:!0}),t.SyncAccumulator=void 0;var o=n(1),s=n(5),a=function(){function e(t){r(this,e),(t=t||{}).maxTimelineEntries=t.maxTimelineEntries||50,this.opts=t,this.accountData={},this.inviteRooms={},this.joinRooms={},this.nextBatch=null,this.groups={invite:{},join:{},leave:{}}}return i(e,[{key:"accumulate",value:function(e,t){this._accumulateRooms(e,t),this._accumulateGroups(e),this._accumulateAccountData(e),this.nextBatch=e.next_batch}},{key:"_accumulateAccountData",value:function(e){var t=this;e.account_data&&e.account_data.events&&e.account_data.events.forEach((function(e){t.accountData[e.type]=e}))}},{key:"_accumulateRooms",value:function(e,t){var n=this;e.rooms&&(e.rooms.invite&&Object.keys(e.rooms.invite).forEach((function(r){n._accumulateRoom(r,"invite",e.rooms.invite[r],t)})),e.rooms.join&&Object.keys(e.rooms.join).forEach((function(r){n._accumulateRoom(r,"join",e.rooms.join[r],t)})),e.rooms.leave&&Object.keys(e.rooms.leave).forEach((function(r){n._accumulateRoom(r,"leave",e.rooms.leave[r],t)})))}},{key:"_accumulateRoom",value:function(e,t,n,r){switch(t){case"invite":this._accumulateInviteState(e,n);break;case"join":this.inviteRooms[e]&&delete this.inviteRooms[e],this._accumulateJoinState(e,n,r);break;case"leave":this.inviteRooms[e]?delete this.inviteRooms[e]:delete this.joinRooms[e];break;default:o.logger.error("Unknown cateogory: ",t)}}},{key:"_accumulateInviteState",value:function(e,t){if(t.invite_state&&t.invite_state.events)if(this.inviteRooms[e]){var n=this.inviteRooms[e];t.invite_state.events.forEach((function(e){for(var t=!1,r=0;r<n.invite_state.events.length;r++){var i=n.invite_state.events[r];i.type===e.type&&i.state_key==e.state_key&&(n.invite_state.events[r]=e,t=!0)}t||n.invite_state.events.push(e)}))}else this.inviteRooms[e]={invite_state:t.invite_state}}},{key:"_accumulateJoinState",value:function(e,t,n){this.joinRooms[e]||(this.joinRooms[e]={_currentState:Object.create(null),_timeline:[],_accountData:Object.create(null),_unreadNotifications:{},_summary:{},_readReceipts:{}});var r=this.joinRooms[e];if(t.account_data&&t.account_data.events&&t.account_data.events.forEach((function(e){r._accountData[e.type]=e})),t.unread_notifications&&(r._unreadNotifications=t.unread_notifications),t.summary){var i="m.heroes",o="m.invited_member_count",s="m.joined_member_count",a=r._summary,c=t.summary;a[i]=c[i]||a[i],a[s]=c[s]||a[s],a[o]=c[o]||a[o]}if(t.ephemeral&&t.ephemeral.events&&t.ephemeral.events.forEach((function(e){"m.receipt"===e.type&&e.content&&Object.keys(e.content).forEach((function(t){e.content[t]["m.read"]&&Object.keys(e.content[t]["m.read"]).forEach((function(n){r._readReceipts[n]={data:e.content[t]["m.read"][n],eventId:t}}))}))})),t.timeline&&t.timeline.limited&&(r._timeline=[]),t.state&&t.state.events&&t.state.events.forEach((function(e){u(r._currentState,e)})),t.timeline&&t.timeline.events&&t.timeline.events.forEach((function(e,i){var o;if(u(r._currentState,e),n)o=e;else{void 0!==(o=Object.assign({},e)).unsigned&&(o.unsigned=Object.assign({},o.unsigned));var s=e.unsigned?e.unsigned.age:e.age;void 0!==s&&(o._localTs=Date.now()-s)}r._timeline.push({event:o,token:0===i?t.timeline.prev_batch:null})})),r._timeline.length>this.opts.maxTimelineEntries)for(var l=r._timeline.length-this.opts.maxTimelineEntries;l<r._timeline.length;l++)if(r._timeline[l].token){r._timeline=r._timeline.slice(l,r._timeline.length);break}}},{key:"_accumulateGroups",value:function(e){var t=this;e.groups&&(e.groups.invite&&Object.keys(e.groups.invite).forEach((function(n){t._accumulateGroup(n,"invite",e.groups.invite[n])})),e.groups.join&&Object.keys(e.groups.join).forEach((function(n){t._accumulateGroup(n,"join",e.groups.join[n])})),e.groups.leave&&Object.keys(e.groups.leave).forEach((function(n){t._accumulateGroup(n,"leave",e.groups.leave[n])})))}},{key:"_accumulateGroup",value:function(e,t,n){for(var r=0,i=["invite","join","leave"];r<i.length;r++){var o=i[r];delete this.groups[o][e]}this.groups[t][e]=n}},{key:"getJSON",value:function(e){var t=this,n={join:{},invite:{},leave:{}};Object.keys(this.inviteRooms).forEach((function(e){n.invite[e]=t.inviteRooms[e]})),Object.keys(this.joinRooms).forEach((function(r){var i=t.joinRooms[r],o={ephemeral:{events:[]},account_data:{events:[]},state:{events:[]},timeline:{events:[],prev_batch:null},unread_notifications:i._unreadNotifications,summary:i._summary};Object.keys(i._accountData).forEach((function(e){o.account_data.events.push(i._accountData[e])}));var a={type:"m.receipt",room_id:r,content:{}};Object.keys(i._readReceipts).forEach((function(e){var t=i._readReceipts[e];a.content[t.eventId]||(a.content[t.eventId]={"m.read":{}}),a.content[t.eventId]["m.read"][e]=t.data})),Object.keys(a.content).length>0&&o.ephemeral.events.push(a),i._timeline.forEach((function(t){if(!o.timeline.prev_batch){if(!t.token)return;o.timeline.prev_batch=t.token}var n;!e&&t.event._localTs?(void 0!==(n=Object.assign({},t.event)).unsigned&&(n.unsigned=Object.assign({},n.unsigned)),delete n._localTs,n.unsigned=n.unsigned||{},n.unsigned.age=Date.now()-t.event._localTs):n=t.event,o.timeline.events.push(n)}));for(var c=Object.create(null),l=o.timeline.events.length-1;l>=0;l--){var d=o.timeline.events[l];if(null!==d.state_key&&void 0!==d.state_key){var f=(0,s.deepCopy)(d);f.unsigned&&(f.unsigned.prev_content&&(f.content=f.unsigned.prev_content),f.unsigned.prev_sender&&(f.sender=f.unsigned.prev_sender)),u(c,f)}}Object.keys(i._currentState).forEach((function(e){Object.keys(i._currentState[e]).forEach((function(t){var n=i._currentState[e][t];c[e]&&c[e][t]&&(n=c[e][t]),o.state.events.push(n)}))})),n.join[r]=o}));var r=[];return Object.keys(this.accountData).forEach((function(e){r.push(t.accountData[e])})),{nextBatch:this.nextBatch,roomsData:n,groupsData:this.groups,accountData:r}}},{key:"getNextBatchToken",value:function(){return this.nextBatch}}]),e}();function u(e,t){null!==t.state_key&&void 0!==t.state_key&&t.type&&(e[t.type]||(e[t.type]=Object.create(null)),e[t.type][t.state_key]=t)}t.SyncAccumulator=a},function(e,t,n){"use strict";var r=String.prototype.replace,i=/%20/g,o=n(55),s={RFC1738:"RFC1738",RFC3986:"RFC3986"};e.exports=o.assign({default:s.RFC3986,formatters:{RFC1738:function(e){return r.call(e,i,"+")},RFC3986:function(e){return String(e)}}},s)},function(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(83)},function(e,t,n){"use strict";(function(e){var r=n(12),i=n(4);Object.defineProperty(t,"__esModule",{value:!0});var o={};t.default=void 0;var s=i(n(57));Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||e in t&&t[e]===s[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}}))}));var a,u=r(n(146)),c=r(n(147));s.request((function(e,t){return e.qs=c.default.stringify(e.qs||{},e.qsStringifyOptions),(0,u.default)(e,t)}));try{a=e.indexedDB}catch(d){}a&&s.setCryptoStoreFactory((function(){return new s.IndexedDBCryptoStore(a,"matrix-js-sdk:crypto")}));var l=s;t.default=l,e.matrixcs=s}).call(this,n(9))},function(e,t,n){"use strict";n(42);var r=n(18),i=60103;if(t.Fragment=60107,"function"===typeof Symbol&&Symbol.for){var o=Symbol.for;i=o("react.element"),t.Fragment=o("react.fragment")}var s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a=Object.prototype.hasOwnProperty,u={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,o={},c=null,l=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(l=t.ref),t)a.call(t,r)&&!u.hasOwnProperty(r)&&(o[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===o[r]&&(o[r]=t[r]);return{$$typeof:i,type:e,key:c,ref:l,props:o,_owner:s.current}}t.jsx=c,t.jsxs=c},function(e,t,n){"use strict";var r=n(42),i=60103,o=60106;t.Fragment=60107,t.StrictMode=60108,t.Profiler=60114;var s=60109,a=60110,u=60112;t.Suspense=60113;var c=60115,l=60116;if("function"===typeof Symbol&&Symbol.for){var d=Symbol.for;i=d("react.element"),o=d("react.portal"),t.Fragment=d("react.fragment"),t.StrictMode=d("react.strict_mode"),t.Profiler=d("react.profiler"),s=d("react.provider"),a=d("react.context"),u=d("react.forward_ref"),t.Suspense=d("react.suspense"),c=d("react.memo"),l=d("react.lazy")}var f="function"===typeof Symbol&&Symbol.iterator;function p(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var h={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v={};function g(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||h}function y(){}function m(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||h}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error(p(85));this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=g.prototype;var _=m.prototype=new y;_.constructor=m,r(_,g.prototype),_.isPureReactComponent=!0;var b={current:null},k=Object.prototype.hasOwnProperty,S={key:!0,ref:!0,__self:!0,__source:!0};function E(e,t,n){var r,o={},s=null,a=null;if(null!=t)for(r in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(s=""+t.key),t)k.call(t,r)&&!S.hasOwnProperty(r)&&(o[r]=t[r]);var u=arguments.length-2;if(1===u)o.children=n;else if(1<u){for(var c=Array(u),l=0;l<u;l++)c[l]=arguments[l+2];o.children=c}if(e&&e.defaultProps)for(r in u=e.defaultProps)void 0===o[r]&&(o[r]=u[r]);return{$$typeof:i,type:e,key:s,ref:a,props:o,_owner:b.current}}function w(e){return"object"===typeof e&&null!==e&&e.$$typeof===i}var x=/\/+/g;function I(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function T(e,t,n,r,s){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var u=!1;if(null===e)u=!0;else switch(a){case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case i:case o:u=!0}}if(u)return s=s(u=e),e=""===r?"."+I(u,0):r,Array.isArray(s)?(n="",null!=e&&(n=e.replace(x,"$&/")+"/"),T(s,t,n,"",(function(e){return e}))):null!=s&&(w(s)&&(s=function(e,t){return{$$typeof:i,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(s,n+(!s.key||u&&u.key===s.key?"":(""+s.key).replace(x,"$&/")+"/")+e)),t.push(s)),1;if(u=0,r=""===r?".":r+":",Array.isArray(e))for(var c=0;c<e.length;c++){var l=r+I(a=e[c],c);u+=T(a,t,n,l,s)}else if("function"===typeof(l=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e)))for(e=l.call(e),c=0;!(a=e.next()).done;)u+=T(a=a.value,t,n,l=r+I(a,c++),s);else if("object"===a)throw t=""+e,Error(p(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t));return u}function R(e,t,n){if(null==e)return e;var r=[],i=0;return T(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function O(e){if(-1===e._status){var t=e._result;t=t(),e._status=0,e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}if(1===e._status)return e._result;throw e._result}var C={current:null};function D(){var e=C.current;if(null===e)throw Error(p(321));return e}var P={ReactCurrentDispatcher:C,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:b,IsSomeRendererActing:{current:!1},assign:r};t.Children={map:R,forEach:function(e,t,n){R(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return R(e,(function(){t++})),t},toArray:function(e){return R(e,(function(e){return e}))||[]},only:function(e){if(!w(e))throw Error(p(143));return e}},t.Component=g,t.PureComponent=m,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=P,t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error(p(267,e));var o=r({},e.props),s=e.key,a=e.ref,u=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,u=b.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(l in t)k.call(t,l)&&!S.hasOwnProperty(l)&&(o[l]=void 0===t[l]&&void 0!==c?c[l]:t[l])}var l=arguments.length-2;if(1===l)o.children=n;else if(1<l){c=Array(l);for(var d=0;d<l;d++)c[d]=arguments[d+2];o.children=c}return{$$typeof:i,type:e.type,key:s,ref:a,props:o,_owner:u}},t.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:a,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=E,t.createFactory=function(e){var t=E.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:u,render:e}},t.isValidElement=w,t.lazy=function(e){return{$$typeof:l,_payload:{_status:-1,_result:e},_init:O}},t.memo=function(e,t){return{$$typeof:c,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return D().useCallback(e,t)},t.useContext=function(e,t){return D().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return D().useEffect(e,t)},t.useImperativeHandle=function(e,t,n){return D().useImperativeHandle(e,t,n)},t.useLayoutEffect=function(e,t){return D().useLayoutEffect(e,t)},t.useMemo=function(e,t){return D().useMemo(e,t)},t.useReducer=function(e,t,n){return D().useReducer(e,t,n)},t.useRef=function(e){return D().useRef(e)},t.useState=function(e){return D().useState(e)},t.version="17.0.1"},function(e,t,n){"use strict";var r=n(18),i=n(42),o=n(84);function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!r)throw Error(s(227));var a=new Set,u={};function c(e,t){l(e,t),l(e+"Capture",t)}function l(e,t){for(u[e]=t,e=0;e<t.length;e++)a.add(t[e])}var d=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p=Object.prototype.hasOwnProperty,h={},v={};function g(e,t,n,r,i,o,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=s}var y={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){y[e]=new g(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];y[t]=new g(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){y[e]=new g(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){y[e]=new g(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){y[e]=new g(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){y[e]=new g(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){y[e]=new g(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){y[e]=new g(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){y[e]=new g(e,5,!1,e.toLowerCase(),null,!1,!1)}));var m=/[\-:]([a-z])/g;function _(e){return e[1].toUpperCase()}function b(e,t,n,r){var i=y.hasOwnProperty(t)?y[t]:null;(null!==i?0===i.type:!r&&(2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1])))||(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!p.call(v,e)||!p.call(h,e)&&(f.test(e)?v[e]=!0:(h[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(m,_);y[t]=new g(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(m,_);y[t]=new g(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(m,_);y[t]=new g(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){y[e]=new g(e,1,!1,e.toLowerCase(),null,!1,!1)})),y.xlinkHref=new g("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){y[e]=new g(e,1,!1,e.toLowerCase(),null,!0,!0)}));var k=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,S=60103,E=60106,w=60107,x=60108,I=60114,T=60109,R=60110,O=60112,C=60113,D=60120,P=60115,A=60116,M=60121,U=60128,N=60129,L=60130,K=60131;if("function"===typeof Symbol&&Symbol.for){var B=Symbol.for;S=B("react.element"),E=B("react.portal"),w=B("react.fragment"),x=B("react.strict_mode"),I=B("react.profiler"),T=B("react.provider"),R=B("react.context"),O=B("react.forward_ref"),C=B("react.suspense"),D=B("react.suspense_list"),P=B("react.memo"),A=B("react.lazy"),M=B("react.block"),B("react.scope"),U=B("react.opaque.id"),N=B("react.debug_trace_mode"),L=B("react.offscreen"),K=B("react.legacy_hidden")}var j,q="function"===typeof Symbol&&Symbol.iterator;function F(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=q&&e[q]||e["@@iterator"])?e:null}function V(e){if(void 0===j)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);j=t&&t[1]||""}return"\n"+j+e}var G=!1;function H(e,t){if(!e||G)return"";G=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var r=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){r=u}e.call(t.prototype)}else{try{throw Error()}catch(u){r=u}e()}}catch(u){if(u&&r&&"string"===typeof u.stack){for(var i=u.stack.split("\n"),o=r.stack.split("\n"),s=i.length-1,a=o.length-1;1<=s&&0<=a&&i[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(i[s]!==o[a]){if(1!==s||1!==a)do{if(s--,0>--a||i[s]!==o[a])return"\n"+i[s].replace(" at new "," at ")}while(1<=s&&0<=a);break}}}finally{G=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?V(e):""}function $(e){switch(e.tag){case 5:return V(e.type);case 16:return V("Lazy");case 13:return V("Suspense");case 19:return V("SuspenseList");case 0:case 2:case 15:return e=H(e.type,!1);case 11:return e=H(e.type.render,!1);case 22:return e=H(e.type._render,!1);case 1:return e=H(e.type,!0);default:return""}}function W(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case w:return"Fragment";case E:return"Portal";case I:return"Profiler";case x:return"StrictMode";case C:return"Suspense";case D:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case R:return(e.displayName||"Context")+".Consumer";case T:return(e._context.displayName||"Context")+".Provider";case O:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case P:return W(e.type);case M:return W(e._render);case A:t=e._payload,e=e._init;try{return W(e(t))}catch(n){}}return null}function z(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function Y(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function Q(e){e._valueTracker||(e._valueTracker=function(e){var t=Y(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function J(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=Y(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function X(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Z(e,t){var n=t.checked;return i({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function ee(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=z(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function te(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function ne(e,t){te(e,t);var n=z(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ie(e,t.type,n):t.hasOwnProperty("defaultValue")&&ie(e,t.type,z(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function re(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ie(e,t,n){"number"===t&&X(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}function oe(e,t){return e=i({children:void 0},t),(t=function(e){var t="";return r.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(t.children))&&(e.children=t),e}function se(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+z(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function ae(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(s(91));return i({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ue(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(s(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(s(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:z(n)}}function ce(e,t){var n=z(t.value),r=z(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function le(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}var de="http://www.w3.org/1999/xhtml",fe="http://www.w3.org/2000/svg";function pe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function he(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?pe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ve,ge,ye=(ge=function(e,t){if(e.namespaceURI!==fe||"innerHTML"in e)e.innerHTML=t;else{for((ve=ve||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ve.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return ge(e,t)}))}:ge);function me(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var _e={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},be=["Webkit","ms","Moz","O"];function ke(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||_e.hasOwnProperty(e)&&_e[e]?(""+t).trim():t+"px"}function Se(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=ke(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(_e).forEach((function(e){be.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),_e[t]=_e[e]}))}));var Ee=i({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function we(e,t){if(t){if(Ee[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(s(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(s(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(s(62))}}function xe(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function Ie(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Te=null,Re=null,Oe=null;function Ce(e){if(e=ei(e)){if("function"!==typeof Te)throw Error(s(280));var t=e.stateNode;t&&(t=ni(t),Te(e.stateNode,e.type,t))}}function De(e){Re?Oe?Oe.push(e):Oe=[e]:Re=e}function Pe(){if(Re){var e=Re,t=Oe;if(Oe=Re=null,Ce(e),t)for(e=0;e<t.length;e++)Ce(t[e])}}function Ae(e,t){return e(t)}function Me(e,t,n,r,i){return e(t,n,r,i)}function Ue(){}var Ne=Ae,Le=!1,Ke=!1;function Be(){null===Re&&null===Oe||(Ue(),Pe())}function je(e,t){var n=e.stateNode;if(null===n)return null;var r=ni(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(s(231,t,typeof n));return n}var qe=!1;if(d)try{var Fe={};Object.defineProperty(Fe,"passive",{get:function(){qe=!0}}),window.addEventListener("test",Fe,Fe),window.removeEventListener("test",Fe,Fe)}catch(ge){qe=!1}function Ve(e,t,n,r,i,o,s,a,u){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(l){this.onError(l)}}var Ge=!1,He=null,$e=!1,We=null,ze={onError:function(e){Ge=!0,He=e}};function Ye(e,t,n,r,i,o,s,a,u){Ge=!1,He=null,Ve.apply(ze,arguments)}function Qe(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(1026&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Je(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Xe(e){if(Qe(e)!==e)throw Error(s(188))}function Ze(e){if(!(e=function(e){var t=e.alternate;if(!t){if(null===(t=Qe(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(r=i.return)){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return Xe(i),e;if(o===r)return Xe(i),t;o=o.sibling}throw Error(s(188))}if(n.return!==r.return)n=i,r=o;else{for(var a=!1,u=i.child;u;){if(u===n){a=!0,n=i,r=o;break}if(u===r){a=!0,r=i,n=o;break}u=u.sibling}if(!a){for(u=o.child;u;){if(u===n){a=!0,n=o,r=i;break}if(u===r){a=!0,r=o,n=i;break}u=u.sibling}if(!a)throw Error(s(189))}}if(n.alternate!==r)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function et(e,t){for(var n=e.alternate;null!==t;){if(t===e||t===n)return!0;t=t.return}return!1}var tt,nt,rt,it,ot=!1,st=[],at=null,ut=null,ct=null,lt=new Map,dt=new Map,ft=[],pt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ht(e,t,n,r,i){return{blockedOn:e,domEventName:t,eventSystemFlags:16|n,nativeEvent:i,targetContainers:[r]}}function vt(e,t){switch(e){case"focusin":case"focusout":at=null;break;case"dragenter":case"dragleave":ut=null;break;case"mouseover":case"mouseout":ct=null;break;case"pointerover":case"pointerout":lt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":dt.delete(t.pointerId)}}function gt(e,t,n,r,i,o){return null===e||e.nativeEvent!==o?(e=ht(t,n,r,i,o),null!==t&&(null!==(t=ei(t))&&nt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function yt(e){var t=Zr(e.target);if(null!==t){var n=Qe(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Je(n)))return e.blockedOn=t,void it(e.lanePriority,(function(){o.unstable_runWithPriority(e.priority,(function(){rt(n)}))}))}else if(3===t&&n.stateNode.hydrate)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function mt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Zt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=ei(n))&&nt(t),e.blockedOn=n,!1;t.shift()}return!0}function _t(e,t,n){mt(e)&&n.delete(t)}function bt(){for(ot=!1;0<st.length;){var e=st[0];if(null!==e.blockedOn){null!==(e=ei(e.blockedOn))&&tt(e);break}for(var t=e.targetContainers;0<t.length;){var n=Zt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n){e.blockedOn=n;break}t.shift()}null===e.blockedOn&&st.shift()}null!==at&&mt(at)&&(at=null),null!==ut&&mt(ut)&&(ut=null),null!==ct&&mt(ct)&&(ct=null),lt.forEach(_t),dt.forEach(_t)}function kt(e,t){e.blockedOn===t&&(e.blockedOn=null,ot||(ot=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,bt)))}function St(e){function t(t){return kt(t,e)}if(0<st.length){kt(st[0],e);for(var n=1;n<st.length;n++){var r=st[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==at&&kt(at,e),null!==ut&&kt(ut,e),null!==ct&&kt(ct,e),lt.forEach(t),dt.forEach(t),n=0;n<ft.length;n++)(r=ft[n]).blockedOn===e&&(r.blockedOn=null);for(;0<ft.length&&null===(n=ft[0]).blockedOn;)yt(n),null===n.blockedOn&&ft.shift()}function Et(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var wt={animationend:Et("Animation","AnimationEnd"),animationiteration:Et("Animation","AnimationIteration"),animationstart:Et("Animation","AnimationStart"),transitionend:Et("Transition","TransitionEnd")},xt={},It={};function Tt(e){if(xt[e])return xt[e];if(!wt[e])return e;var t,n=wt[e];for(t in n)if(n.hasOwnProperty(t)&&t in It)return xt[e]=n[t];return e}d&&(It=document.createElement("div").style,"AnimationEvent"in window||(delete wt.animationend.animation,delete wt.animationiteration.animation,delete wt.animationstart.animation),"TransitionEvent"in window||delete wt.transitionend.transition);var Rt=Tt("animationend"),Ot=Tt("animationiteration"),Ct=Tt("animationstart"),Dt=Tt("transitionend"),Pt=new Map,At=new Map,Mt=["abort","abort",Rt,"animationEnd",Ot,"animationIteration",Ct,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Dt,"transitionEnd","waiting","waiting"];function Ut(e,t){for(var n=0;n<e.length;n+=2){var r=e[n],i=e[n+1];i="on"+(i[0].toUpperCase()+i.slice(1)),At.set(r,t),Pt.set(r,i),c(i,[r])}}(0,o.unstable_now)();var Nt=8;function Lt(e){if(0!==(1&e))return Nt=15,1;if(0!==(2&e))return Nt=14,2;if(0!==(4&e))return Nt=13,4;var t=24&e;return 0!==t?(Nt=12,t):0!==(32&e)?(Nt=11,32):0!==(t=192&e)?(Nt=10,t):0!==(256&e)?(Nt=9,256):0!==(t=3584&e)?(Nt=8,t):0!==(4096&e)?(Nt=7,4096):0!==(t=4186112&e)?(Nt=6,t):0!==(t=62914560&e)?(Nt=5,t):67108864&e?(Nt=4,67108864):0!==(134217728&e)?(Nt=3,134217728):0!==(t=805306368&e)?(Nt=2,t):0!==(1073741824&e)?(Nt=1,1073741824):(Nt=8,e)}function Kt(e,t){var n=e.pendingLanes;if(0===n)return Nt=0;var r=0,i=0,o=e.expiredLanes,s=e.suspendedLanes,a=e.pingedLanes;if(0!==o)r=o,i=Nt=15;else if(0!==(o=134217727&n)){var u=o&~s;0!==u?(r=Lt(u),i=Nt):0!==(a&=o)&&(r=Lt(a),i=Nt)}else 0!==(o=n&~s)?(r=Lt(o),i=Nt):0!==a&&(r=Lt(a),i=Nt);if(0===r)return 0;if(r=n&((0>(r=31-Gt(r))?0:1<<r)<<1)-1,0!==t&&t!==r&&0===(t&s)){if(Lt(t),i<=Nt)return t;Nt=i}if(0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-Gt(t)),r|=e[n],t&=~i;return r}function Bt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function jt(e,t){switch(e){case 15:return 1;case 14:return 2;case 12:return 0===(e=qt(24&~t))?jt(10,t):e;case 10:return 0===(e=qt(192&~t))?jt(8,t):e;case 8:return 0===(e=qt(3584&~t))&&(0===(e=qt(4186112&~t))&&(e=512)),e;case 2:return 0===(t=qt(805306368&~t))&&(t=268435456),t}throw Error(s(358,e))}function qt(e){return e&-e}function Ft(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Vt(e,t,n){e.pendingLanes|=t;var r=t-1;e.suspendedLanes&=r,e.pingedLanes&=r,(e=e.eventTimes)[t=31-Gt(t)]=n}var Gt=Math.clz32?Math.clz32:function(e){return 0===e?32:31-(Ht(e)/$t|0)|0},Ht=Math.log,$t=Math.LN2;var Wt=o.unstable_UserBlockingPriority,zt=o.unstable_runWithPriority,Yt=!0;function Qt(e,t,n,r){Le||Ue();var i=Xt,o=Le;Le=!0;try{Me(i,e,t,n,r)}finally{(Le=o)||Be()}}function Jt(e,t,n,r){zt(Wt,Xt.bind(null,e,t,n,r))}function Xt(e,t,n,r){var i;if(Yt)if((i=0===(4&t))&&0<st.length&&-1<pt.indexOf(e))e=ht(null,e,t,n,r),st.push(e);else{var o=Zt(e,t,n,r);if(null===o)i&&vt(e,r);else{if(i){if(-1<pt.indexOf(e))return e=ht(o,e,t,n,r),void st.push(e);if(function(e,t,n,r,i){switch(t){case"focusin":return at=gt(at,e,t,n,r,i),!0;case"dragenter":return ut=gt(ut,e,t,n,r,i),!0;case"mouseover":return ct=gt(ct,e,t,n,r,i),!0;case"pointerover":var o=i.pointerId;return lt.set(o,gt(lt.get(o)||null,e,t,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,dt.set(o,gt(dt.get(o)||null,e,t,n,r,i)),!0}return!1}(o,e,t,n,r))return;vt(e,r)}Pr(e,t,r,null,n)}}}function Zt(e,t,n,r){var i=Ie(r);if(null!==(i=Zr(i))){var o=Qe(i);if(null===o)i=null;else{var s=o.tag;if(13===s){if(null!==(i=Je(o)))return i;i=null}else if(3===s){if(o.stateNode.hydrate)return 3===o.tag?o.stateNode.containerInfo:null;i=null}else o!==i&&(i=null)}}return Pr(e,t,r,i,n),null}var en=null,tn=null,nn=null;function rn(){if(nn)return nn;var e,t,n=tn,r=n.length,i="value"in en?en.value:en.textContent,o=i.length;for(e=0;e<r&&n[e]===i[e];e++);var s=r-e;for(t=1;t<=s&&n[r-t]===i[o-t];t++);return nn=i.slice(e,1<t?1-t:void 0)}function on(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function sn(){return!0}function an(){return!1}function un(e){function t(t,n,r,i,o){for(var s in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(i):i[s]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?sn:an,this.isPropagationStopped=an,this}return i(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=sn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=sn)},persist:function(){},isPersistent:sn}),t}var cn,ln,dn,fn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pn=un(fn),hn=i({},fn,{view:0,detail:0}),vn=un(hn),gn=i({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==dn&&(dn&&"mousemove"===e.type?(cn=e.screenX-dn.screenX,ln=e.screenY-dn.screenY):ln=cn=0,dn=e),cn)},movementY:function(e){return"movementY"in e?e.movementY:ln}}),yn=un(gn),mn=un(i({},gn,{dataTransfer:0})),_n=un(i({},hn,{relatedTarget:0})),bn=un(i({},fn,{animationName:0,elapsedTime:0,pseudoElement:0})),kn=un(i({},fn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),Sn=un(i({},fn,{data:0})),En={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},xn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function In(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=xn[e])&&!!t[e]}function Tn(){return In}var Rn=un(i({},hn,{key:function(e){if(e.key){var t=En[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=on(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tn,charCode:function(e){return"keypress"===e.type?on(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?on(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),On=un(i({},gn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Cn=un(i({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tn})),Dn=un(i({},fn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Pn=un(i({},gn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),An=[9,13,27,32],Mn=d&&"CompositionEvent"in window,Un=null;d&&"documentMode"in document&&(Un=document.documentMode);var Nn=d&&"TextEvent"in window&&!Un,Ln=d&&(!Mn||Un&&8<Un&&11>=Un),Kn=String.fromCharCode(32),Bn=!1;function jn(e,t){switch(e){case"keyup":return-1!==An.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function qn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Fn=!1;var Vn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Vn[e.type]:"textarea"===t}function Hn(e,t,n,r){De(r),0<(t=Mr(t,"onChange")).length&&(n=new pn("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var $n=null,Wn=null;function zn(e){Ir(e,0)}function Yn(e){if(J(ti(e)))return e}function Qn(e,t){if("change"===e)return t}var Jn=!1;if(d){var Xn;if(d){var Zn="oninput"in document;if(!Zn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Zn="function"===typeof er.oninput}Xn=Zn}else Xn=!1;Jn=Xn&&(!document.documentMode||9<document.documentMode)}function tr(){$n&&($n.detachEvent("onpropertychange",nr),Wn=$n=null)}function nr(e){if("value"===e.propertyName&&Yn(Wn)){var t=[];if(Hn(t,Wn,e,Ie(e)),e=zn,Le)e(t);else{Le=!0;try{Ae(e,t)}finally{Le=!1,Be()}}}}function rr(e,t,n){"focusin"===e?(tr(),Wn=n,($n=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yn(Wn)}function or(e,t){if("click"===e)return Yn(t)}function sr(e,t){if("input"===e||"change"===e)return Yn(t)}var ar="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},ur=Object.prototype.hasOwnProperty;function cr(e,t){if(ar(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!ur.call(t,n[r])||!ar(e[n[r]],t[n[r]]))return!1;return!0}function lr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function dr(e,t){var n,r=lr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=lr(r)}}function fr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?fr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function pr(){for(var e=window,t=X();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=X((e=t.contentWindow).document)}return t}function hr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var vr=d&&"documentMode"in document&&11>=document.documentMode,gr=null,yr=null,mr=null,_r=!1;function br(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;_r||null==gr||gr!==X(r)||("selectionStart"in(r=gr)&&hr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},mr&&cr(mr,r)||(mr=r,0<(r=Mr(yr,"onSelect")).length&&(t=new pn("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=gr)))}Ut("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),Ut("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),Ut(Mt,2);for(var kr="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),Sr=0;Sr<kr.length;Sr++)At.set(kr[Sr],0);l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Er="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),wr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Er));function xr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,o,a,u,c){if(Ye.apply(this,arguments),Ge){if(!Ge)throw Error(s(198));var l=He;Ge=!1,He=null,$e||($e=!0,We=l)}}(r,t,void 0,e),e.currentTarget=null}function Ir(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var o=void 0;if(t)for(var s=r.length-1;0<=s;s--){var a=r[s],u=a.instance,c=a.currentTarget;if(a=a.listener,u!==o&&i.isPropagationStopped())break e;xr(i,a,c),o=u}else for(s=0;s<r.length;s++){if(u=(a=r[s]).instance,c=a.currentTarget,a=a.listener,u!==o&&i.isPropagationStopped())break e;xr(i,a,c),o=u}}}if($e)throw e=We,$e=!1,We=null,e}function Tr(e,t){var n=ri(t),r=e+"__bubble";n.has(r)||(Dr(t,e,2,!1),n.add(r))}var Rr="_reactListening"+Math.random().toString(36).slice(2);function Or(e){e[Rr]||(e[Rr]=!0,a.forEach((function(t){wr.has(t)||Cr(t,!1,e,null),Cr(t,!0,e,null)})))}function Cr(e,t,n,r){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,o=n;if("selectionchange"===e&&9!==n.nodeType&&(o=n.ownerDocument),null!==r&&!t&&wr.has(e)){if("scroll"!==e)return;i|=2,o=r}var s=ri(o),a=e+"__"+(t?"capture":"bubble");s.has(a)||(t&&(i|=4),Dr(o,e,i,t),s.add(a))}function Dr(e,t,n,r){var i=At.get(t);switch(void 0===i?2:i){case 0:i=Qt;break;case 1:i=Jt;break;default:i=Xt}n=i.bind(null,t,n,e),i=void 0,!qe||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Pr(e,t,n,r,i){var o=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var s=r.tag;if(3===s||4===s){var a=r.stateNode.containerInfo;if(a===i||8===a.nodeType&&a.parentNode===i)break;if(4===s)for(s=r.return;null!==s;){var u=s.tag;if((3===u||4===u)&&((u=s.stateNode.containerInfo)===i||8===u.nodeType&&u.parentNode===i))return;s=s.return}for(;null!==a;){if(null===(s=Zr(a)))return;if(5===(u=s.tag)||6===u){r=o=s;continue e}a=a.parentNode}}r=r.return}!function(e,t,n){if(Ke)return e(t,n);Ke=!0;try{Ne(e,t,n)}finally{Ke=!1,Be()}}((function(){var r=o,i=Ie(n),s=[];e:{var a=Pt.get(e);if(void 0!==a){var u=pn,c=e;switch(e){case"keypress":if(0===on(n))break e;case"keydown":case"keyup":u=Rn;break;case"focusin":c="focus",u=_n;break;case"focusout":c="blur",u=_n;break;case"beforeblur":case"afterblur":u=_n;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":u=yn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":u=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":u=Cn;break;case Rt:case Ot:case Ct:u=bn;break;case Dt:u=Dn;break;case"scroll":u=vn;break;case"wheel":u=Pn;break;case"copy":case"cut":case"paste":u=kn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":u=On}var l=0!==(4&t),d=!l&&"scroll"===e,f=l?null!==a?a+"Capture":null:a;l=[];for(var p,h=r;null!==h;){var v=(p=h).stateNode;if(5===p.tag&&null!==v&&(p=v,null!==f&&(null!=(v=je(h,f))&&l.push(Ar(h,v,p)))),d)break;h=h.return}0<l.length&&(a=new u(a,c,null,n,i),s.push({event:a,listeners:l}))}}if(0===(7&t)){if(u="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||0!==(16&t)||!(c=n.relatedTarget||n.fromElement)||!Zr(c)&&!c[Jr])&&(u||a)&&(a=i.window===i?i:(a=i.ownerDocument)?a.defaultView||a.parentWindow:window,u?(u=r,null!==(c=(c=n.relatedTarget||n.toElement)?Zr(c):null)&&(c!==(d=Qe(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(u=null,c=r),u!==c)){if(l=yn,v="onMouseLeave",f="onMouseEnter",h="mouse","pointerout"!==e&&"pointerover"!==e||(l=On,v="onPointerLeave",f="onPointerEnter",h="pointer"),d=null==u?a:ti(u),p=null==c?a:ti(c),(a=new l(v,h+"leave",u,n,i)).target=d,a.relatedTarget=p,v=null,Zr(i)===r&&((l=new l(f,h+"enter",c,n,i)).target=p,l.relatedTarget=d,v=l),d=v,u&&c)e:{for(f=c,h=0,p=l=u;p;p=Ur(p))h++;for(p=0,v=f;v;v=Ur(v))p++;for(;0<h-p;)l=Ur(l),h--;for(;0<p-h;)f=Ur(f),p--;for(;h--;){if(l===f||null!==f&&l===f.alternate)break e;l=Ur(l),f=Ur(f)}l=null}else l=null;null!==u&&Nr(s,a,u,l,!1),null!==c&&null!==d&&Nr(s,d,c,l,!0)}if("select"===(u=(a=r?ti(r):window).nodeName&&a.nodeName.toLowerCase())||"input"===u&&"file"===a.type)var g=Qn;else if(Gn(a))if(Jn)g=sr;else{g=ir;var y=rr}else(u=a.nodeName)&&"input"===u.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(g=or);switch(g&&(g=g(e,r))?Hn(s,g,n,i):(y&&y(e,a,r),"focusout"===e&&(y=a._wrapperState)&&y.controlled&&"number"===a.type&&ie(a,"number",a.value)),y=r?ti(r):window,e){case"focusin":(Gn(y)||"true"===y.contentEditable)&&(gr=y,yr=r,mr=null);break;case"focusout":mr=yr=gr=null;break;case"mousedown":_r=!0;break;case"contextmenu":case"mouseup":case"dragend":_r=!1,br(s,n,i);break;case"selectionchange":if(vr)break;case"keydown":case"keyup":br(s,n,i)}var m;if(Mn)e:{switch(e){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else Fn?jn(e,n)&&(_="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(_="onCompositionStart");_&&(Ln&&"ko"!==n.locale&&(Fn||"onCompositionStart"!==_?"onCompositionEnd"===_&&Fn&&(m=rn()):(tn="value"in(en=i)?en.value:en.textContent,Fn=!0)),0<(y=Mr(r,_)).length&&(_=new Sn(_,e,null,n,i),s.push({event:_,listeners:y}),m?_.data=m:null!==(m=qn(n))&&(_.data=m))),(m=Nn?function(e,t){switch(e){case"compositionend":return qn(t);case"keypress":return 32!==t.which?null:(Bn=!0,Kn);case"textInput":return(e=t.data)===Kn&&Bn?null:e;default:return null}}(e,n):function(e,t){if(Fn)return"compositionend"===e||!Mn&&jn(e,t)?(e=rn(),nn=tn=en=null,Fn=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Ln&&"ko"!==t.locale?null:t.data;default:return null}}(e,n))&&(0<(r=Mr(r,"onBeforeInput")).length&&(i=new Sn("onBeforeInput","beforeinput",null,n,i),s.push({event:i,listeners:r}),i.data=m))}Ir(s,t)}))}function Ar(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Mr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,o=i.stateNode;5===i.tag&&null!==o&&(i=o,null!=(o=je(e,n))&&r.unshift(Ar(e,o,i)),null!=(o=je(e,t))&&r.push(Ar(e,o,i))),e=e.return}return r}function Ur(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Nr(e,t,n,r,i){for(var o=t._reactName,s=[];null!==n&&n!==r;){var a=n,u=a.alternate,c=a.stateNode;if(null!==u&&u===r)break;5===a.tag&&null!==c&&(a=c,i?null!=(u=je(n,o))&&s.unshift(Ar(n,u,a)):i||null!=(u=je(n,o))&&s.push(Ar(n,u,a))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}function Lr(){}var Kr=null,Br=null;function jr(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function qr(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Fr="function"===typeof setTimeout?setTimeout:void 0,Vr="function"===typeof clearTimeout?clearTimeout:void 0;function Gr(e){1===e.nodeType?e.textContent="":9===e.nodeType&&(null!=(e=e.body)&&(e.textContent=""))}function Hr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function $r(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var Wr=0;var zr=Math.random().toString(36).slice(2),Yr="__reactFiber$"+zr,Qr="__reactProps$"+zr,Jr="__reactContainer$"+zr,Xr="__reactEvents$"+zr;function Zr(e){var t=e[Yr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Jr]||n[Yr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=$r(e);null!==e;){if(n=e[Yr])return n;e=$r(e)}return t}n=(e=n).parentNode}return null}function ei(e){return!(e=e[Yr]||e[Jr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function ti(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(s(33))}function ni(e){return e[Qr]||null}function ri(e){var t=e[Xr];return void 0===t&&(t=e[Xr]=new Set),t}var ii=[],oi=-1;function si(e){return{current:e}}function ai(e){0>oi||(e.current=ii[oi],ii[oi]=null,oi--)}function ui(e,t){oi++,ii[oi]=e.current,e.current=t}var ci={},li=si(ci),di=si(!1),fi=ci;function pi(e,t){var n=e.type.contextTypes;if(!n)return ci;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,o={};for(i in n)o[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function hi(e){return null!==(e=e.childContextTypes)&&void 0!==e}function vi(){ai(di),ai(li)}function gi(e,t,n){if(li.current!==ci)throw Error(s(168));ui(li,t),ui(di,n)}function yi(e,t,n){var r=e.stateNode;if(e=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var o in r=r.getChildContext())if(!(o in e))throw Error(s(108,W(t)||"Unknown",o));return i({},n,r)}function mi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ci,fi=li.current,ui(li,e),ui(di,di.current),!0}function _i(e,t,n){var r=e.stateNode;if(!r)throw Error(s(169));n?(e=yi(e,t,fi),r.__reactInternalMemoizedMergedChildContext=e,ai(di),ai(li),ui(li,e)):ai(di),ui(di,n)}var bi=null,ki=null,Si=o.unstable_runWithPriority,Ei=o.unstable_scheduleCallback,wi=o.unstable_cancelCallback,xi=o.unstable_shouldYield,Ii=o.unstable_requestPaint,Ti=o.unstable_now,Ri=o.unstable_getCurrentPriorityLevel,Oi=o.unstable_ImmediatePriority,Ci=o.unstable_UserBlockingPriority,Di=o.unstable_NormalPriority,Pi=o.unstable_LowPriority,Ai=o.unstable_IdlePriority,Mi={},Ui=void 0!==Ii?Ii:function(){},Ni=null,Li=null,Ki=!1,Bi=Ti(),ji=1e4>Bi?Ti:function(){return Ti()-Bi};function qi(){switch(Ri()){case Oi:return 99;case Ci:return 98;case Di:return 97;case Pi:return 96;case Ai:return 95;default:throw Error(s(332))}}function Fi(e){switch(e){case 99:return Oi;case 98:return Ci;case 97:return Di;case 96:return Pi;case 95:return Ai;default:throw Error(s(332))}}function Vi(e,t){return e=Fi(e),Si(e,t)}function Gi(e,t,n){return e=Fi(e),Ei(e,t,n)}function Hi(){if(null!==Li){var e=Li;Li=null,wi(e)}$i()}function $i(){if(!Ki&&null!==Ni){Ki=!0;var e=0;try{var t=Ni;Vi(99,(function(){for(;e<t.length;e++){var n=t[e];do{n=n(!0)}while(null!==n)}})),Ni=null}catch(n){throw null!==Ni&&(Ni=Ni.slice(e+1)),Ei(Oi,Hi),n}finally{Ki=!1}}}var Wi=k.ReactCurrentBatchConfig;function zi(e,t){if(e&&e.defaultProps){for(var n in t=i({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var Yi=si(null),Qi=null,Ji=null,Xi=null;function Zi(){Xi=Ji=Qi=null}function eo(e){var t=Yi.current;ai(Yi),e.type._context._currentValue=t}function to(e,t){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)===t){if(null===n||(n.childLanes&t)===t)break;n.childLanes|=t}else e.childLanes|=t,null!==n&&(n.childLanes|=t);e=e.return}}function no(e,t){Qi=e,Xi=Ji=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Ms=!0),e.firstContext=null)}function ro(e,t){if(Xi!==e&&!1!==t&&0!==t)if("number"===typeof t&&1073741823!==t||(Xi=e,t=1073741823),t={context:e,observedBits:t,next:null},null===Ji){if(null===Qi)throw Error(s(308));Ji=t,Qi.dependencies={lanes:0,firstContext:t,responders:null}}else Ji=Ji.next=t;return e._currentValue}var io=!1;function oo(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function so(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ao(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function uo(e,t){if(null!==(e=e.updateQueue)){var n=(e=e.shared).pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}}function co(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?i=o=s:o=o.next=s,n=n.next}while(null!==n);null===o?i=o=t:o=o.next=t}else i=o=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function lo(e,t,n,r){var o=e.updateQueue;io=!1;var s=o.firstBaseUpdate,a=o.lastBaseUpdate,u=o.shared.pending;if(null!==u){o.shared.pending=null;var c=u,l=c.next;c.next=null,null===a?s=l:a.next=l,a=c;var d=e.alternate;if(null!==d){var f=(d=d.updateQueue).lastBaseUpdate;f!==a&&(null===f?d.firstBaseUpdate=l:f.next=l,d.lastBaseUpdate=c)}}if(null!==s){for(f=o.baseState,a=0,d=l=c=null;;){u=s.lane;var p=s.eventTime;if((r&u)===u){null!==d&&(d=d.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var h=e,v=s;switch(u=t,p=n,v.tag){case 1:if("function"===typeof(h=v.payload)){f=h.call(p,f,u);break e}f=h;break e;case 3:h.flags=-4097&h.flags|64;case 0:if(null===(u="function"===typeof(h=v.payload)?h.call(p,f,u):h)||void 0===u)break e;f=i({},f,u);break e;case 2:io=!0}}null!==s.callback&&(e.flags|=32,null===(u=o.effects)?o.effects=[s]:u.push(s))}else p={eventTime:p,lane:u,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===d?(l=d=p,c=f):d=d.next=p,a|=u;if(null===(s=s.next)){if(null===(u=o.shared.pending))break;s=u.next,u.next=null,o.lastBaseUpdate=u,o.shared.pending=null}}null===d&&(c=f),o.baseState=c,o.firstBaseUpdate=l,o.lastBaseUpdate=d,Ka|=a,e.lanes=a,e.memoizedState=f}}function fo(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(s(191,i));i.call(r)}}}var po=(new r.Component).refs;function ho(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:i({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var vo={isMounted:function(e){return!!(e=e._reactInternals)&&Qe(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=cu(),i=lu(e),o=ao(r,i);o.payload=t,void 0!==n&&null!==n&&(o.callback=n),uo(e,o),du(e,i,r)},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=cu(),i=lu(e),o=ao(r,i);o.tag=1,o.payload=t,void 0!==n&&null!==n&&(o.callback=n),uo(e,o),du(e,i,r)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=cu(),r=lu(e),i=ao(n,r);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),uo(e,i),du(e,r,n)}};function go(e,t,n,r,i,o,s){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,o,s):!t.prototype||!t.prototype.isPureReactComponent||(!cr(n,r)||!cr(i,o))}function yo(e,t,n){var r=!1,i=ci,o=t.contextType;return"object"===typeof o&&null!==o?o=ro(o):(i=hi(t)?fi:li.current,o=(r=null!==(r=t.contextTypes)&&void 0!==r)?pi(e,i):ci),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=vo,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),t}function mo(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&vo.enqueueReplaceState(t,t.state,null)}function _o(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=po,oo(e);var o=t.contextType;"object"===typeof o&&null!==o?i.context=ro(o):(o=hi(t)?fi:li.current,i.context=pi(e,o)),lo(e,n,i,r),i.state=e.memoizedState,"function"===typeof(o=t.getDerivedStateFromProps)&&(ho(e,t,o,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&vo.enqueueReplaceState(i,i.state,null),lo(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4)}var bo=Array.isArray;function ko(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(s(309));var r=n.stateNode}if(!r)throw Error(s(147,e));var i=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===i?t.ref:((t=function(e){var t=r.refs;t===po&&(t=r.refs={}),null===e?delete t[i]:t[i]=e})._stringRef=i,t)}if("string"!==typeof e)throw Error(s(284));if(!n._owner)throw Error(s(290,e))}return e}function So(e,t){if("textarea"!==e.type)throw Error(s(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t))}function Eo(e){function t(t,n){if(e){var r=t.lastEffect;null!==r?(r.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.flags=8}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Vu(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags=2,n):r:(t.flags=2,n):n}function a(t){return e&&null===t.alternate&&(t.flags=2),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=Wu(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,r){return null!==t&&t.elementType===n.type?((r=i(t,n.props)).ref=ko(e,t,n),r.return=e,r):((r=Gu(n.type,n.key,n.props,null,e.mode,r)).ref=ko(e,t,n),r.return=e,r)}function l(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=zu(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function d(e,t,n,r,o){return null===t||7!==t.tag?((t=Hu(n,e.mode,r,o)).return=e,t):((t=i(t,n)).return=e,t)}function f(e,t,n){if("string"===typeof t||"number"===typeof t)return(t=Wu(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case S:return(n=Gu(t.type,t.key,t.props,null,e.mode,n)).ref=ko(e,null,t),n.return=e,n;case E:return(t=zu(t,e.mode,n)).return=e,t}if(bo(t)||F(t))return(t=Hu(t,e.mode,n,null)).return=e,t;So(e,t)}return null}function p(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n||"number"===typeof n)return null!==i?null:u(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case S:return n.key===i?n.type===w?d(e,t,n.props.children,r,i):c(e,t,n,r):null;case E:return n.key===i?l(e,t,n,r):null}if(bo(n)||F(n))return null!==i?null:d(e,t,n,r,null);So(e,n)}return null}function h(e,t,n,r,i){if("string"===typeof r||"number"===typeof r)return u(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case S:return e=e.get(null===r.key?n:r.key)||null,r.type===w?d(t,e,r.props.children,i,r.key):c(t,e,r,i);case E:return l(t,e=e.get(null===r.key?n:r.key)||null,r,i)}if(bo(r)||F(r))return d(t,e=e.get(n)||null,r,i,null);So(t,r)}return null}function v(i,s,a,u){for(var c=null,l=null,d=s,v=s=0,g=null;null!==d&&v<a.length;v++){d.index>v?(g=d,d=null):g=d.sibling;var y=p(i,d,a[v],u);if(null===y){null===d&&(d=g);break}e&&d&&null===y.alternate&&t(i,d),s=o(y,s,v),null===l?c=y:l.sibling=y,l=y,d=g}if(v===a.length)return n(i,d),c;if(null===d){for(;v<a.length;v++)null!==(d=f(i,a[v],u))&&(s=o(d,s,v),null===l?c=d:l.sibling=d,l=d);return c}for(d=r(i,d);v<a.length;v++)null!==(g=h(d,i,v,a[v],u))&&(e&&null!==g.alternate&&d.delete(null===g.key?v:g.key),s=o(g,s,v),null===l?c=g:l.sibling=g,l=g);return e&&d.forEach((function(e){return t(i,e)})),c}function g(i,a,u,c){var l=F(u);if("function"!==typeof l)throw Error(s(150));if(null==(u=l.call(u)))throw Error(s(151));for(var d=l=null,v=a,g=a=0,y=null,m=u.next();null!==v&&!m.done;g++,m=u.next()){v.index>g?(y=v,v=null):y=v.sibling;var _=p(i,v,m.value,c);if(null===_){null===v&&(v=y);break}e&&v&&null===_.alternate&&t(i,v),a=o(_,a,g),null===d?l=_:d.sibling=_,d=_,v=y}if(m.done)return n(i,v),l;if(null===v){for(;!m.done;g++,m=u.next())null!==(m=f(i,m.value,c))&&(a=o(m,a,g),null===d?l=m:d.sibling=m,d=m);return l}for(v=r(i,v);!m.done;g++,m=u.next())null!==(m=h(v,i,g,m.value,c))&&(e&&null!==m.alternate&&v.delete(null===m.key?g:m.key),a=o(m,a,g),null===d?l=m:d.sibling=m,d=m);return e&&v.forEach((function(e){return t(i,e)})),l}return function(e,r,o,u){var c="object"===typeof o&&null!==o&&o.type===w&&null===o.key;c&&(o=o.props.children);var l="object"===typeof o&&null!==o;if(l)switch(o.$$typeof){case S:e:{for(l=o.key,c=r;null!==c;){if(c.key===l){switch(c.tag){case 7:if(o.type===w){n(e,c.sibling),(r=i(c,o.props.children)).return=e,e=r;break e}break;default:if(c.elementType===o.type){n(e,c.sibling),(r=i(c,o.props)).ref=ko(e,c,o),r.return=e,e=r;break e}}n(e,c);break}t(e,c),c=c.sibling}o.type===w?((r=Hu(o.props.children,e.mode,u,o.key)).return=e,e=r):((u=Gu(o.type,o.key,o.props,null,e.mode,u)).ref=ko(e,r,o),u.return=e,e=u)}return a(e);case E:e:{for(c=o.key;null!==r;){if(r.key===c){if(4===r.tag&&r.stateNode.containerInfo===o.containerInfo&&r.stateNode.implementation===o.implementation){n(e,r.sibling),(r=i(r,o.children||[])).return=e,e=r;break e}n(e,r);break}t(e,r),r=r.sibling}(r=zu(o,e.mode,u)).return=e,e=r}return a(e)}if("string"===typeof o||"number"===typeof o)return o=""+o,null!==r&&6===r.tag?(n(e,r.sibling),(r=i(r,o)).return=e,e=r):(n(e,r),(r=Wu(o,e.mode,u)).return=e,e=r),a(e);if(bo(o))return v(e,r,o,u);if(F(o))return g(e,r,o,u);if(l&&So(e,o),"undefined"===typeof o&&!c)switch(e.tag){case 1:case 22:case 0:case 11:case 15:throw Error(s(152,W(e.type)||"Component"))}return n(e,r)}}var wo=Eo(!0),xo=Eo(!1),Io={},To=si(Io),Ro=si(Io),Oo=si(Io);function Co(e){if(e===Io)throw Error(s(174));return e}function Do(e,t){switch(ui(Oo,t),ui(Ro,e),ui(To,Io),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:he(null,"");break;default:t=he(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}ai(To),ui(To,t)}function Po(){ai(To),ai(Ro),ai(Oo)}function Ao(e){Co(Oo.current);var t=Co(To.current),n=he(t,e.type);t!==n&&(ui(Ro,e),ui(To,n))}function Mo(e){Ro.current===e&&(ai(To),ai(Ro))}var Uo=si(0);function No(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(64&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Lo=null,Ko=null,Bo=!1;function jo(e,t){var n=qu(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.flags=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function qo(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);case 13:default:return!1}}function Fo(e){if(Bo){var t=Ko;if(t){var n=t;if(!qo(e,t)){if(!(t=Hr(n.nextSibling))||!qo(e,t))return e.flags=-1025&e.flags|2,Bo=!1,void(Lo=e);jo(Lo,n)}Lo=e,Ko=Hr(t.firstChild)}else e.flags=-1025&e.flags|2,Bo=!1,Lo=e}}function Vo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Lo=e}function Go(e){if(e!==Lo)return!1;if(!Bo)return Vo(e),Bo=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!qr(t,e.memoizedProps))for(t=Ko;t;)jo(e,t),t=Hr(t.nextSibling);if(Vo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){Ko=Hr(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}Ko=null}}else Ko=Lo?Hr(e.stateNode.nextSibling):null;return!0}function Ho(){Ko=Lo=null,Bo=!1}var $o=[];function Wo(){for(var e=0;e<$o.length;e++)$o[e]._workInProgressVersionPrimary=null;$o.length=0}var zo=k.ReactCurrentDispatcher,Yo=k.ReactCurrentBatchConfig,Qo=0,Jo=null,Xo=null,Zo=null,es=!1,ts=!1;function ns(){throw Error(s(321))}function rs(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ar(e[n],t[n]))return!1;return!0}function is(e,t,n,r,i,o){if(Qo=o,Jo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,zo.current=null===e||null===e.memoizedState?Cs:Ds,e=n(r,i),ts){o=0;do{if(ts=!1,!(25>o))throw Error(s(301));o+=1,Zo=Xo=null,t.updateQueue=null,zo.current=Ps,e=n(r,i)}while(ts)}if(zo.current=Os,t=null!==Xo&&null!==Xo.next,Qo=0,Zo=Xo=Jo=null,es=!1,t)throw Error(s(300));return e}function os(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Zo?Jo.memoizedState=Zo=e:Zo=Zo.next=e,Zo}function ss(){if(null===Xo){var e=Jo.alternate;e=null!==e?e.memoizedState:null}else e=Xo.next;var t=null===Zo?Jo.memoizedState:Zo.next;if(null!==t)Zo=t,Xo=e;else{if(null===e)throw Error(s(310));e={memoizedState:(Xo=e).memoizedState,baseState:Xo.baseState,baseQueue:Xo.baseQueue,queue:Xo.queue,next:null},null===Zo?Jo.memoizedState=Zo=e:Zo=Zo.next=e}return Zo}function as(e,t){return"function"===typeof t?t(e):t}function us(e){var t=ss(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=Xo,i=r.baseQueue,o=n.pending;if(null!==o){if(null!==i){var a=i.next;i.next=o.next,o.next=a}r.baseQueue=i=o,n.pending=null}if(null!==i){i=i.next,r=r.baseState;var u=a=o=null,c=i;do{var l=c.lane;if((Qo&l)===l)null!==u&&(u=u.next={lane:0,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null}),r=c.eagerReducer===e?c.eagerState:e(r,c.action);else{var d={lane:l,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null};null===u?(a=u=d,o=r):u=u.next=d,Jo.lanes|=l,Ka|=l}c=c.next}while(null!==c&&c!==i);null===u?o=r:u.next=a,ar(r,t.memoizedState)||(Ms=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=u,n.lastRenderedState=r}return[t.memoizedState,n.dispatch]}function cs(e){var t=ss(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,o=t.memoizedState;if(null!==i){n.pending=null;var a=i=i.next;do{o=e(o,a.action),a=a.next}while(a!==i);ar(o,t.memoizedState)||(Ms=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function ls(e,t,n){var r=t._getVersion;r=r(t._source);var i=t._workInProgressVersionPrimary;if(null!==i?e=i===r:(e=e.mutableReadLanes,(e=(Qo&e)===e)&&(t._workInProgressVersionPrimary=r,$o.push(t))),e)return n(t._source);throw $o.push(t),Error(s(350))}function ds(e,t,n,r){var i=Ca;if(null===i)throw Error(s(349));var o=t._getVersion,a=o(t._source),u=zo.current,c=u.useState((function(){return ls(i,t,n)})),l=c[1],d=c[0];c=Zo;var f=e.memoizedState,p=f.refs,h=p.getSnapshot,v=f.source;f=f.subscribe;var g=Jo;return e.memoizedState={refs:p,source:t,subscribe:r},u.useEffect((function(){p.getSnapshot=n,p.setSnapshot=l;var e=o(t._source);if(!ar(a,e)){e=n(t._source),ar(d,e)||(l(e),e=lu(g),i.mutableReadLanes|=e&i.pendingLanes),e=i.mutableReadLanes,i.entangledLanes|=e;for(var r=i.entanglements,s=e;0<s;){var u=31-Gt(s),c=1<<u;r[u]|=e,s&=~c}}}),[n,t,r]),u.useEffect((function(){return r(t._source,(function(){var e=p.getSnapshot,n=p.setSnapshot;try{n(e(t._source));var r=lu(g);i.mutableReadLanes|=r&i.pendingLanes}catch(o){n((function(){throw o}))}}))}),[t,r]),ar(h,n)&&ar(v,t)&&ar(f,r)||((e={pending:null,dispatch:null,lastRenderedReducer:as,lastRenderedState:d}).dispatch=l=Rs.bind(null,Jo,e),c.queue=e,c.baseQueue=null,d=ls(i,t,n),c.memoizedState=c.baseState=d),d}function fs(e,t,n){return ds(ss(),e,t,n)}function ps(e){var t=os();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:as,lastRenderedState:e}).dispatch=Rs.bind(null,Jo,e),[t.memoizedState,e]}function hs(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=Jo.updateQueue)?(t={lastEffect:null},Jo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function vs(e){return e={current:e},os().memoizedState=e}function gs(){return ss().memoizedState}function ys(e,t,n,r){var i=os();Jo.flags|=e,i.memoizedState=hs(1|t,n,void 0,void 0===r?null:r)}function ms(e,t,n,r){var i=ss();r=void 0===r?null:r;var o=void 0;if(null!==Xo){var s=Xo.memoizedState;if(o=s.destroy,null!==r&&rs(r,s.deps))return void hs(t,n,o,r)}Jo.flags|=e,i.memoizedState=hs(1|t,n,o,r)}function _s(e,t){return ys(516,4,e,t)}function bs(e,t){return ms(516,4,e,t)}function ks(e,t){return ms(4,2,e,t)}function Ss(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Es(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,ms(4,2,Ss.bind(null,t,e),n)}function ws(){}function xs(e,t){var n=ss();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&rs(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Is(e,t){var n=ss();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&rs(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Ts(e,t){var n=qi();Vi(98>n?98:n,(function(){e(!0)})),Vi(97<n?97:n,(function(){var n=Yo.transition;Yo.transition=1;try{e(!1),t()}finally{Yo.transition=n}}))}function Rs(e,t,n){var r=cu(),i=lu(e),o={lane:i,action:n,eagerReducer:null,eagerState:null,next:null},s=t.pending;if(null===s?o.next=o:(o.next=s.next,s.next=o),t.pending=o,s=e.alternate,e===Jo||null!==s&&s===Jo)ts=es=!0;else{if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var a=t.lastRenderedState,u=s(a,n);if(o.eagerReducer=s,o.eagerState=u,ar(u,a))return}catch(c){}du(e,i,r)}}var Os={readContext:ro,useCallback:ns,useContext:ns,useEffect:ns,useImperativeHandle:ns,useLayoutEffect:ns,useMemo:ns,useReducer:ns,useRef:ns,useState:ns,useDebugValue:ns,useDeferredValue:ns,useTransition:ns,useMutableSource:ns,useOpaqueIdentifier:ns,unstable_isNewReconciler:!1},Cs={readContext:ro,useCallback:function(e,t){return os().memoizedState=[e,void 0===t?null:t],e},useContext:ro,useEffect:_s,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,ys(4,2,Ss.bind(null,t,e),n)},useLayoutEffect:function(e,t){return ys(4,2,e,t)},useMemo:function(e,t){var n=os();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=os();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e=(e=r.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=Rs.bind(null,Jo,e),[r.memoizedState,e]},useRef:vs,useState:ps,useDebugValue:ws,useDeferredValue:function(e){var t=ps(e),n=t[0],r=t[1];return _s((function(){var t=Yo.transition;Yo.transition=1;try{r(e)}finally{Yo.transition=t}}),[e]),n},useTransition:function(){var e=ps(!1),t=e[0];return vs(e=Ts.bind(null,e[1])),[e,t]},useMutableSource:function(e,t,n){var r=os();return r.memoizedState={refs:{getSnapshot:t,setSnapshot:null},source:e,subscribe:n},ds(r,e,t,n)},useOpaqueIdentifier:function(){if(Bo){var e=!1,t=function(e){return{$$typeof:U,toString:e,valueOf:e}}((function(){throw e||(e=!0,n("r:"+(Wr++).toString(36))),Error(s(355))})),n=ps(t)[1];return 0===(2&Jo.mode)&&(Jo.flags|=516,hs(5,(function(){n("r:"+(Wr++).toString(36))}),void 0,null)),t}return ps(t="r:"+(Wr++).toString(36)),t},unstable_isNewReconciler:!1},Ds={readContext:ro,useCallback:xs,useContext:ro,useEffect:bs,useImperativeHandle:Es,useLayoutEffect:ks,useMemo:Is,useReducer:us,useRef:gs,useState:function(){return us(as)},useDebugValue:ws,useDeferredValue:function(e){var t=us(as),n=t[0],r=t[1];return bs((function(){var t=Yo.transition;Yo.transition=1;try{r(e)}finally{Yo.transition=t}}),[e]),n},useTransition:function(){var e=us(as)[0];return[gs().current,e]},useMutableSource:fs,useOpaqueIdentifier:function(){return us(as)[0]},unstable_isNewReconciler:!1},Ps={readContext:ro,useCallback:xs,useContext:ro,useEffect:bs,useImperativeHandle:Es,useLayoutEffect:ks,useMemo:Is,useReducer:cs,useRef:gs,useState:function(){return cs(as)},useDebugValue:ws,useDeferredValue:function(e){var t=cs(as),n=t[0],r=t[1];return bs((function(){var t=Yo.transition;Yo.transition=1;try{r(e)}finally{Yo.transition=t}}),[e]),n},useTransition:function(){var e=cs(as)[0];return[gs().current,e]},useMutableSource:fs,useOpaqueIdentifier:function(){return cs(as)[0]},unstable_isNewReconciler:!1},As=k.ReactCurrentOwner,Ms=!1;function Us(e,t,n,r){t.child=null===e?xo(t,null,n,r):wo(t,e.child,n,r)}function Ns(e,t,n,r,i){n=n.render;var o=t.ref;return no(t,i),r=is(e,t,n,r,o,i),null===e||Ms?(t.flags|=1,Us(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~i,na(e,t,i))}function Ls(e,t,n,r,i,o){if(null===e){var s=n.type;return"function"!==typeof s||Fu(s)||void 0!==s.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Gu(n.type,null,r,t,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,Ks(e,t,s,r,i,o))}return s=e.child,0===(i&o)&&(i=s.memoizedProps,(n=null!==(n=n.compare)?n:cr)(i,r)&&e.ref===t.ref)?na(e,t,o):(t.flags|=1,(e=Vu(s,r)).ref=t.ref,e.return=t,t.child=e)}function Ks(e,t,n,r,i,o){if(null!==e&&cr(e.memoizedProps,r)&&e.ref===t.ref){if(Ms=!1,0===(o&i))return t.lanes=e.lanes,na(e,t,o);0!==(16384&e.flags)&&(Ms=!0)}return qs(e,t,n,r,o)}function Bs(e,t,n){var r=t.pendingProps,i=r.children,o=null!==e?e.memoizedState:null;if("hidden"===r.mode||"unstable-defer-without-hiding"===r.mode)if(0===(4&t.mode))t.memoizedState={baseLanes:0},_u(t,n);else{if(0===(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e},_u(t,e),null;t.memoizedState={baseLanes:0},_u(t,null!==o?o.baseLanes:n)}else null!==o?(r=o.baseLanes|n,t.memoizedState=null):r=n,_u(t,r);return Us(e,t,i,n),t.child}function js(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=128)}function qs(e,t,n,r,i){var o=hi(n)?fi:li.current;return o=pi(t,o),no(t,i),n=is(e,t,n,r,o,i),null===e||Ms?(t.flags|=1,Us(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~i,na(e,t,i))}function Fs(e,t,n,r,i){if(hi(n)){var o=!0;mi(t)}else o=!1;if(no(t,i),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),yo(t,n,r),_o(t,n,r,i),r=!0;else if(null===e){var s=t.stateNode,a=t.memoizedProps;s.props=a;var u=s.context,c=n.contextType;"object"===typeof c&&null!==c?c=ro(c):c=pi(t,c=hi(n)?fi:li.current);var l=n.getDerivedStateFromProps,d="function"===typeof l||"function"===typeof s.getSnapshotBeforeUpdate;d||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==r||u!==c)&&mo(t,s,r,c),io=!1;var f=t.memoizedState;s.state=f,lo(t,r,s,i),u=t.memoizedState,a!==r||f!==u||di.current||io?("function"===typeof l&&(ho(t,n,l,r),u=t.memoizedState),(a=io||go(t,n,a,r,f,u,c))?(d||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||("function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"===typeof s.componentDidMount&&(t.flags|=4)):("function"===typeof s.componentDidMount&&(t.flags|=4),t.memoizedProps=r,t.memoizedState=u),s.props=r,s.state=u,s.context=c,r=a):("function"===typeof s.componentDidMount&&(t.flags|=4),r=!1)}else{s=t.stateNode,so(e,t),a=t.memoizedProps,c=t.type===t.elementType?a:zi(t.type,a),s.props=c,d=t.pendingProps,f=s.context,"object"===typeof(u=n.contextType)&&null!==u?u=ro(u):u=pi(t,u=hi(n)?fi:li.current);var p=n.getDerivedStateFromProps;(l="function"===typeof p||"function"===typeof s.getSnapshotBeforeUpdate)||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==d||f!==u)&&mo(t,s,r,u),io=!1,f=t.memoizedState,s.state=f,lo(t,r,s,i);var h=t.memoizedState;a!==d||f!==h||di.current||io?("function"===typeof p&&(ho(t,n,p,r),h=t.memoizedState),(c=io||go(t,n,c,r,f,h,u))?(l||"function"!==typeof s.UNSAFE_componentWillUpdate&&"function"!==typeof s.componentWillUpdate||("function"===typeof s.componentWillUpdate&&s.componentWillUpdate(r,h,u),"function"===typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(r,h,u)),"function"===typeof s.componentDidUpdate&&(t.flags|=4),"function"===typeof s.getSnapshotBeforeUpdate&&(t.flags|=256)):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&f===e.memoizedState||(t.flags|=256),t.memoizedProps=r,t.memoizedState=h),s.props=r,s.state=h,s.context=u,r=c):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&f===e.memoizedState||(t.flags|=256),r=!1)}return Vs(e,t,n,r,o,i)}function Vs(e,t,n,r,i,o){js(e,t);var s=0!==(64&t.flags);if(!r&&!s)return i&&_i(t,n,!1),na(e,t,o);r=t.stateNode,As.current=t;var a=s&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&s?(t.child=wo(t,e.child,null,o),t.child=wo(t,null,a,o)):Us(e,t,a,o),t.memoizedState=r.state,i&&_i(t,n,!0),t.child}function Gs(e){var t=e.stateNode;t.pendingContext?gi(0,t.pendingContext,t.pendingContext!==t.context):t.context&&gi(0,t.context,!1),Do(e,t.containerInfo)}var Hs,$s,Ws,zs={dehydrated:null,retryLane:0};function Ys(e,t,n){var r,i=t.pendingProps,o=Uo.current,s=!1;return(r=0!==(64&t.flags))||(r=(null===e||null!==e.memoizedState)&&0!==(2&o)),r?(s=!0,t.flags&=-65):null!==e&&null===e.memoizedState||void 0===i.fallback||!0===i.unstable_avoidThisFallback||(o|=1),ui(Uo,1&o),null===e?(void 0!==i.fallback&&Fo(t),e=i.children,o=i.fallback,s?(e=Qs(t,e,o,n),t.child.memoizedState={baseLanes:n},t.memoizedState=zs,e):"number"===typeof i.unstable_expectedLoadTime?(e=Qs(t,e,o,n),t.child.memoizedState={baseLanes:n},t.memoizedState=zs,t.lanes=33554432,e):((n=$u({mode:"visible",children:e},t.mode,n,null)).return=t,t.child=n)):(e.memoizedState,s?(i=Xs(e,t,i.children,i.fallback,n),s=t.child,o=e.child.memoizedState,s.memoizedState=null===o?{baseLanes:n}:{baseLanes:o.baseLanes|n},s.childLanes=e.childLanes&~n,t.memoizedState=zs,i):(n=Js(e,t,i.children,n),t.memoizedState=null,n))}function Qs(e,t,n,r){var i=e.mode,o=e.child;return t={mode:"hidden",children:t},0===(2&i)&&null!==o?(o.childLanes=0,o.pendingProps=t):o=$u(t,i,0,null),n=Hu(n,i,r,null),o.return=e,n.return=e,o.sibling=n,e.child=o,n}function Js(e,t,n,r){var i=e.child;return e=i.sibling,n=Vu(i,{mode:"visible",children:n}),0===(2&t.mode)&&(n.lanes=r),n.return=t,n.sibling=null,null!==e&&(e.nextEffect=null,e.flags=8,t.firstEffect=t.lastEffect=e),t.child=n}function Xs(e,t,n,r,i){var o=t.mode,s=e.child;e=s.sibling;var a={mode:"hidden",children:n};return 0===(2&o)&&t.child!==s?((n=t.child).childLanes=0,n.pendingProps=a,null!==(s=n.lastEffect)?(t.firstEffect=n.firstEffect,t.lastEffect=s,s.nextEffect=null):t.firstEffect=t.lastEffect=null):n=Vu(s,a),null!==e?r=Vu(e,r):(r=Hu(r,o,i,null)).flags|=2,r.return=t,n.return=t,n.sibling=r,t.child=n,r}function Zs(e,t){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),to(e.return,t)}function ea(e,t,n,r,i,o){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i,lastEffect:o}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i,s.lastEffect=o)}function ta(e,t,n){var r=t.pendingProps,i=r.revealOrder,o=r.tail;if(Us(e,t,r.children,n),0!==(2&(r=Uo.current)))r=1&r|2,t.flags|=64;else{if(null!==e&&0!==(64&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Zs(e,n);else if(19===e.tag)Zs(e,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(ui(Uo,r),0===(2&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===No(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),ea(t,!1,i,n,o,t.lastEffect);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===No(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}ea(t,!0,n,null,o,t.lastEffect);break;case"together":ea(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function na(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Ka|=t.lanes,0!==(n&t.childLanes)){if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=Vu(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Vu(e,e.pendingProps)).return=t;n.sibling=null}return t.child}return null}function ra(e,t){if(!Bo)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function ia(e,t,n){var r=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return hi(t.type)&&vi(),null;case 3:return Po(),ai(di),ai(li),Wo(),(r=t.stateNode).pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(Go(t)?t.flags|=4:r.hydrate||(t.flags|=256)),null;case 5:Mo(t);var o=Co(Oo.current);if(n=t.type,null!==e&&null!=t.stateNode)$s(e,t,n,r),e.ref!==t.ref&&(t.flags|=128);else{if(!r){if(null===t.stateNode)throw Error(s(166));return null}if(e=Co(To.current),Go(t)){r=t.stateNode,n=t.type;var a=t.memoizedProps;switch(r[Yr]=t,r[Qr]=a,n){case"dialog":Tr("cancel",r),Tr("close",r);break;case"iframe":case"object":case"embed":Tr("load",r);break;case"video":case"audio":for(e=0;e<Er.length;e++)Tr(Er[e],r);break;case"source":Tr("error",r);break;case"img":case"image":case"link":Tr("error",r),Tr("load",r);break;case"details":Tr("toggle",r);break;case"input":ee(r,a),Tr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},Tr("invalid",r);break;case"textarea":ue(r,a),Tr("invalid",r)}for(var c in we(n,a),e=null,a)a.hasOwnProperty(c)&&(o=a[c],"children"===c?"string"===typeof o?r.textContent!==o&&(e=["children",o]):"number"===typeof o&&r.textContent!==""+o&&(e=["children",""+o]):u.hasOwnProperty(c)&&null!=o&&"onScroll"===c&&Tr("scroll",r));switch(n){case"input":Q(r),re(r,a,!0);break;case"textarea":Q(r),le(r);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(r.onclick=Lr)}r=e,t.updateQueue=r,null!==r&&(t.flags|=4)}else{switch(c=9===o.nodeType?o:o.ownerDocument,e===de&&(e=pe(n)),e===de?"script"===n?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=c.createElement(n,{is:r.is}):(e=c.createElement(n),"select"===n&&(c=e,r.multiple?c.multiple=!0:r.size&&(c.size=r.size))):e=c.createElementNS(e,n),e[Yr]=t,e[Qr]=r,Hs(e,t),t.stateNode=e,c=xe(n,r),n){case"dialog":Tr("cancel",e),Tr("close",e),o=r;break;case"iframe":case"object":case"embed":Tr("load",e),o=r;break;case"video":case"audio":for(o=0;o<Er.length;o++)Tr(Er[o],e);o=r;break;case"source":Tr("error",e),o=r;break;case"img":case"image":case"link":Tr("error",e),Tr("load",e),o=r;break;case"details":Tr("toggle",e),o=r;break;case"input":ee(e,r),o=Z(e,r),Tr("invalid",e);break;case"option":o=oe(e,r);break;case"select":e._wrapperState={wasMultiple:!!r.multiple},o=i({},r,{value:void 0}),Tr("invalid",e);break;case"textarea":ue(e,r),o=ae(e,r),Tr("invalid",e);break;default:o=r}we(n,o);var l=o;for(a in l)if(l.hasOwnProperty(a)){var d=l[a];"style"===a?Se(e,d):"dangerouslySetInnerHTML"===a?null!=(d=d?d.__html:void 0)&&ye(e,d):"children"===a?"string"===typeof d?("textarea"!==n||""!==d)&&me(e,d):"number"===typeof d&&me(e,""+d):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(u.hasOwnProperty(a)?null!=d&&"onScroll"===a&&Tr("scroll",e):null!=d&&b(e,a,d,c))}switch(n){case"input":Q(e),re(e,r,!1);break;case"textarea":Q(e),le(e);break;case"option":null!=r.value&&e.setAttribute("value",""+z(r.value));break;case"select":e.multiple=!!r.multiple,null!=(a=r.value)?se(e,!!r.multiple,a,!1):null!=r.defaultValue&&se(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof o.onClick&&(e.onclick=Lr)}jr(n,r)&&(t.flags|=4)}null!==t.ref&&(t.flags|=128)}return null;case 6:if(e&&null!=t.stateNode)Ws(0,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(s(166));n=Co(Oo.current),Co(To.current),Go(t)?(r=t.stateNode,n=t.memoizedProps,r[Yr]=t,r.nodeValue!==n&&(t.flags|=4)):((r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[Yr]=t,t.stateNode=r)}return null;case 13:return ai(Uo),r=t.memoizedState,0!==(64&t.flags)?(t.lanes=n,t):(r=null!==r,n=!1,null===e?void 0!==t.memoizedProps.fallback&&Go(t):n=null!==e.memoizedState,r&&!n&&0!==(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!==(1&Uo.current)?0===Ua&&(Ua=3):(0!==Ua&&3!==Ua||(Ua=4),null===Ca||0===(134217727&Ka)&&0===(134217727&Ba)||vu(Ca,Pa))),(r||n)&&(t.flags|=4),null);case 4:return Po(),null===e&&Or(t.stateNode.containerInfo),null;case 10:return eo(t),null;case 17:return hi(t.type)&&vi(),null;case 19:if(ai(Uo),null===(r=t.memoizedState))return null;if(a=0!==(64&t.flags),null===(c=r.rendering))if(a)ra(r,!1);else{if(0!==Ua||null!==e&&0!==(64&e.flags))for(e=t.child;null!==e;){if(null!==(c=No(e))){for(t.flags|=64,ra(r,!1),null!==(a=c.updateQueue)&&(t.updateQueue=a,t.flags|=4),null===r.lastEffect&&(t.firstEffect=null),t.lastEffect=r.lastEffect,r=n,n=t.child;null!==n;)e=r,(a=n).flags&=2,a.nextEffect=null,a.firstEffect=null,a.lastEffect=null,null===(c=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=c.childLanes,a.lanes=c.lanes,a.child=c.child,a.memoizedProps=c.memoizedProps,a.memoizedState=c.memoizedState,a.updateQueue=c.updateQueue,a.type=c.type,e=c.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return ui(Uo,1&Uo.current|2),t.child}e=e.sibling}null!==r.tail&&ji()>Va&&(t.flags|=64,a=!0,ra(r,!1),t.lanes=33554432)}else{if(!a)if(null!==(e=No(c))){if(t.flags|=64,a=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),ra(r,!0),null===r.tail&&"hidden"===r.tailMode&&!c.alternate&&!Bo)return null!==(t=t.lastEffect=r.lastEffect)&&(t.nextEffect=null),null}else 2*ji()-r.renderingStartTime>Va&&1073741824!==n&&(t.flags|=64,a=!0,ra(r,!1),t.lanes=33554432);r.isBackwards?(c.sibling=t.child,t.child=c):(null!==(n=r.last)?n.sibling=c:t.child=c,r.last=c)}return null!==r.tail?(n=r.tail,r.rendering=n,r.tail=n.sibling,r.lastEffect=t.lastEffect,r.renderingStartTime=ji(),n.sibling=null,t=Uo.current,ui(Uo,a?1&t|2:1&t),n):null;case 23:case 24:return bu(),null!==e&&null!==e.memoizedState!==(null!==t.memoizedState)&&"unstable-defer-without-hiding"!==r.mode&&(t.flags|=4),null}throw Error(s(156,t.tag))}function oa(e){switch(e.tag){case 1:hi(e.type)&&vi();var t=e.flags;return 4096&t?(e.flags=-4097&t|64,e):null;case 3:if(Po(),ai(di),ai(li),Wo(),0!==(64&(t=e.flags)))throw Error(s(285));return e.flags=-4097&t|64,e;case 5:return Mo(e),null;case 13:return ai(Uo),4096&(t=e.flags)?(e.flags=-4097&t|64,e):null;case 19:return ai(Uo),null;case 4:return Po(),null;case 10:return eo(e),null;case 23:case 24:return bu(),null;default:return null}}function sa(e,t){try{var n="",r=t;do{n+=$(r),r=r.return}while(r);var i=n}catch(o){i="\nError generating stack: "+o.message+"\n"+o.stack}return{value:e,source:t,stack:i}}function aa(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}Hs=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},$s=function(e,t,n,r){var o=e.memoizedProps;if(o!==r){e=t.stateNode,Co(To.current);var s,a=null;switch(n){case"input":o=Z(e,o),r=Z(e,r),a=[];break;case"option":o=oe(e,o),r=oe(e,r),a=[];break;case"select":o=i({},o,{value:void 0}),r=i({},r,{value:void 0}),a=[];break;case"textarea":o=ae(e,o),r=ae(e,r),a=[];break;default:"function"!==typeof o.onClick&&"function"===typeof r.onClick&&(e.onclick=Lr)}for(d in we(n,r),n=null,o)if(!r.hasOwnProperty(d)&&o.hasOwnProperty(d)&&null!=o[d])if("style"===d){var c=o[d];for(s in c)c.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else"dangerouslySetInnerHTML"!==d&&"children"!==d&&"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&"autoFocus"!==d&&(u.hasOwnProperty(d)?a||(a=[]):(a=a||[]).push(d,null));for(d in r){var l=r[d];if(c=null!=o?o[d]:void 0,r.hasOwnProperty(d)&&l!==c&&(null!=l||null!=c))if("style"===d)if(c){for(s in c)!c.hasOwnProperty(s)||l&&l.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in l)l.hasOwnProperty(s)&&c[s]!==l[s]&&(n||(n={}),n[s]=l[s])}else n||(a||(a=[]),a.push(d,n)),n=l;else"dangerouslySetInnerHTML"===d?(l=l?l.__html:void 0,c=c?c.__html:void 0,null!=l&&c!==l&&(a=a||[]).push(d,l)):"children"===d?"string"!==typeof l&&"number"!==typeof l||(a=a||[]).push(d,""+l):"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&(u.hasOwnProperty(d)?(null!=l&&"onScroll"===d&&Tr("scroll",e),a||c===l||(a=[])):"object"===typeof l&&null!==l&&l.$$typeof===U?l.toString():(a=a||[]).push(d,l))}n&&(a=a||[]).push("style",n);var d=a;(t.updateQueue=d)&&(t.flags|=4)}},Ws=function(e,t,n,r){n!==r&&(t.flags|=4)};var ua="function"===typeof WeakMap?WeakMap:Map;function ca(e,t,n){(n=ao(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Wa||(Wa=!0,za=r),aa(0,t)},n}function la(e,t,n){(n=ao(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return aa(0,t),r(i)}}var o=e.stateNode;return null!==o&&"function"===typeof o.componentDidCatch&&(n.callback=function(){"function"!==typeof r&&(null===Ya?Ya=new Set([this]):Ya.add(this),aa(0,t));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}var da="function"===typeof WeakSet?WeakSet:Set;function fa(e){var t=e.ref;if(null!==t)if("function"===typeof t)try{t(null)}catch(n){Lu(e,n)}else t.current=null}function pa(e,t){switch(t.tag){case 0:case 11:case 15:case 22:return;case 1:if(256&t.flags&&null!==e){var n=e.memoizedProps,r=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:zi(t.type,n),r),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:return void(256&t.flags&&Gr(t.stateNode.containerInfo));case 5:case 6:case 4:case 17:return}throw Error(s(163))}function ha(e,t,n){switch(n.tag){case 0:case 11:case 15:case 22:if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{if(3===(3&e.tag)){var r=e.create;e.destroy=r()}e=e.next}while(e!==t)}if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{var i=e;r=i.next,0!==(4&(i=i.tag))&&0!==(1&i)&&(Mu(n,e),Au(n,e)),e=r}while(e!==t)}return;case 1:return e=n.stateNode,4&n.flags&&(null===t?e.componentDidMount():(r=n.elementType===n.type?t.memoizedProps:zi(n.type,t.memoizedProps),e.componentDidUpdate(r,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate))),void(null!==(t=n.updateQueue)&&fo(n,t,e));case 3:if(null!==(t=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 5:e=n.child.stateNode;break;case 1:e=n.child.stateNode}fo(n,t,e)}return;case 5:return e=n.stateNode,void(null===t&&4&n.flags&&jr(n.type,n.memoizedProps)&&e.focus());case 6:case 4:case 12:return;case 13:return void(null===n.memoizedState&&(n=n.alternate,null!==n&&(n=n.memoizedState,null!==n&&(n=n.dehydrated,null!==n&&St(n)))));case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(s(163))}function va(e,t){for(var n=e;;){if(5===n.tag){var r=n.stateNode;if(t)"function"===typeof(r=r.style).setProperty?r.setProperty("display","none","important"):r.display="none";else{r=n.stateNode;var i=n.memoizedProps.style;i=void 0!==i&&null!==i&&i.hasOwnProperty("display")?i.display:null,r.style.display=ke("display",i)}}else if(6===n.tag)n.stateNode.nodeValue=t?"":n.memoizedProps;else if((23!==n.tag&&24!==n.tag||null===n.memoizedState||n===e)&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}}function ga(e,t){if(ki&&"function"===typeof ki.onCommitFiberUnmount)try{ki.onCommitFiberUnmount(bi,t)}catch(o){}switch(t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var n=e=e.next;do{var r=n,i=r.destroy;if(r=r.tag,void 0!==i)if(0!==(4&r))Mu(t,n);else{r=t;try{i()}catch(o){Lu(r,o)}}n=n.next}while(n!==e)}break;case 1:if(fa(t),"function"===typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(o){Lu(t,o)}break;case 5:fa(t);break;case 4:Sa(e,t)}}function ya(e){e.alternate=null,e.child=null,e.dependencies=null,e.firstEffect=null,e.lastEffect=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.return=null,e.updateQueue=null}function ma(e){return 5===e.tag||3===e.tag||4===e.tag}function _a(e){e:{for(var t=e.return;null!==t;){if(ma(t))break e;t=t.return}throw Error(s(160))}var n=t;switch(t=n.stateNode,n.tag){case 5:var r=!1;break;case 3:case 4:t=t.containerInfo,r=!0;break;default:throw Error(s(161))}16&n.flags&&(me(t,""),n.flags&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||ma(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.flags)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.flags)){n=n.stateNode;break e}}r?ba(e,n,t):ka(e,n,t)}function ba(e,t,n){var r=e.tag,i=5===r||6===r;if(i)e=i?e.stateNode:e.stateNode.instance,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Lr));else if(4!==r&&null!==(e=e.child))for(ba(e,t,n),e=e.sibling;null!==e;)ba(e,t,n),e=e.sibling}function ka(e,t,n){var r=e.tag,i=5===r||6===r;if(i)e=i?e.stateNode:e.stateNode.instance,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(ka(e,t,n),e=e.sibling;null!==e;)ka(e,t,n),e=e.sibling}function Sa(e,t){for(var n,r,i=t,o=!1;;){if(!o){o=i.return;e:for(;;){if(null===o)throw Error(s(160));switch(n=o.stateNode,o.tag){case 5:r=!1;break e;case 3:case 4:n=n.containerInfo,r=!0;break e}o=o.return}o=!0}if(5===i.tag||6===i.tag){e:for(var a=e,u=i,c=u;;)if(ga(a,c),null!==c.child&&4!==c.tag)c.child.return=c,c=c.child;else{if(c===u)break e;for(;null===c.sibling;){if(null===c.return||c.return===u)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}r?(a=n,u=i.stateNode,8===a.nodeType?a.parentNode.removeChild(u):a.removeChild(u)):n.removeChild(i.stateNode)}else if(4===i.tag){if(null!==i.child){n=i.stateNode.containerInfo,r=!0,i.child.return=i,i=i.child;continue}}else if(ga(e,i),null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;4===(i=i.return).tag&&(o=!1)}i.sibling.return=i.return,i=i.sibling}}function Ea(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:var n=t.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var r=n=n.next;do{3===(3&r.tag)&&(e=r.destroy,r.destroy=void 0,void 0!==e&&e()),r=r.next}while(r!==n)}return;case 1:return;case 5:if(null!=(n=t.stateNode)){r=t.memoizedProps;var i=null!==e?e.memoizedProps:r;e=t.type;var o=t.updateQueue;if(t.updateQueue=null,null!==o){for(n[Qr]=r,"input"===e&&"radio"===r.type&&null!=r.name&&te(n,r),xe(e,i),t=xe(e,r),i=0;i<o.length;i+=2){var a=o[i],u=o[i+1];"style"===a?Se(n,u):"dangerouslySetInnerHTML"===a?ye(n,u):"children"===a?me(n,u):b(n,a,u,t)}switch(e){case"input":ne(n,r);break;case"textarea":ce(n,r);break;case"select":e=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!r.multiple,null!=(o=r.value)?se(n,!!r.multiple,o,!1):e!==!!r.multiple&&(null!=r.defaultValue?se(n,!!r.multiple,r.defaultValue,!0):se(n,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(s(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return void((n=t.stateNode).hydrate&&(n.hydrate=!1,St(n.containerInfo)));case 12:return;case 13:return null!==t.memoizedState&&(Fa=ji(),va(t.child,!0)),void wa(t);case 19:return void wa(t);case 17:return;case 23:case 24:return void va(t,null!==t.memoizedState)}throw Error(s(163))}function wa(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new da),t.forEach((function(t){var r=Bu.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function xa(e,t){return null!==e&&(null===(e=e.memoizedState)||null!==e.dehydrated)&&(null!==(t=t.memoizedState)&&null===t.dehydrated)}var Ia=Math.ceil,Ta=k.ReactCurrentDispatcher,Ra=k.ReactCurrentOwner,Oa=0,Ca=null,Da=null,Pa=0,Aa=0,Ma=si(0),Ua=0,Na=null,La=0,Ka=0,Ba=0,ja=0,qa=null,Fa=0,Va=1/0;function Ga(){Va=ji()+500}var Ha,$a=null,Wa=!1,za=null,Ya=null,Qa=!1,Ja=null,Xa=90,Za=[],eu=[],tu=null,nu=0,ru=null,iu=-1,ou=0,su=0,au=null,uu=!1;function cu(){return 0!==(48&Oa)?ji():-1!==iu?iu:iu=ji()}function lu(e){if(0===(2&(e=e.mode)))return 1;if(0===(4&e))return 99===qi()?1:2;if(0===ou&&(ou=La),0!==Wi.transition){0!==su&&(su=null!==qa?qa.pendingLanes:0),e=ou;var t=4186112&~su;return 0===(t&=-t)&&(0===(t=(e=4186112&~e)&-e)&&(t=8192)),t}return e=qi(),0!==(4&Oa)&&98===e?e=jt(12,ou):e=jt(e=function(e){switch(e){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}(e),ou),e}function du(e,t,n){if(50<nu)throw nu=0,ru=null,Error(s(185));if(null===(e=fu(e,t)))return null;Vt(e,t,n),e===Ca&&(Ba|=t,4===Ua&&vu(e,Pa));var r=qi();1===t?0!==(8&Oa)&&0===(48&Oa)?gu(e):(pu(e,n),0===Oa&&(Ga(),Hi())):(0===(4&Oa)||98!==r&&99!==r||(null===tu?tu=new Set([e]):tu.add(e)),pu(e,n)),qa=e}function fu(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}function pu(e,t){for(var n=e.callbackNode,r=e.suspendedLanes,i=e.pingedLanes,o=e.expirationTimes,a=e.pendingLanes;0<a;){var u=31-Gt(a),c=1<<u,l=o[u];if(-1===l){if(0===(c&r)||0!==(c&i)){l=t,Lt(c);var d=Nt;o[u]=10<=d?l+250:6<=d?l+5e3:-1}}else l<=t&&(e.expiredLanes|=c);a&=~c}if(r=Kt(e,e===Ca?Pa:0),t=Nt,0===r)null!==n&&(n!==Mi&&wi(n),e.callbackNode=null,e.callbackPriority=0);else{if(null!==n){if(e.callbackPriority===t)return;n!==Mi&&wi(n)}15===t?(n=gu.bind(null,e),null===Ni?(Ni=[n],Li=Ei(Oi,$i)):Ni.push(n),n=Mi):14===t?n=Gi(99,gu.bind(null,e)):n=Gi(n=function(e){switch(e){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(s(358,e))}}(t),hu.bind(null,e)),e.callbackPriority=t,e.callbackNode=n}}function hu(e){if(iu=-1,su=ou=0,0!==(48&Oa))throw Error(s(327));var t=e.callbackNode;if(Pu()&&e.callbackNode!==t)return null;var n=Kt(e,e===Ca?Pa:0);if(0===n)return null;var r=n,i=Oa;Oa|=16;var o=Eu();for(Ca===e&&Pa===r||(Ga(),ku(e,r));;)try{Iu();break}catch(u){Su(e,u)}if(Zi(),Ta.current=o,Oa=i,null!==Da?r=0:(Ca=null,Pa=0,r=Ua),0!==(La&Ba))ku(e,0);else if(0!==r){if(2===r&&(Oa|=64,e.hydrate&&(e.hydrate=!1,Gr(e.containerInfo)),0!==(n=Bt(e))&&(r=wu(e,n))),1===r)throw t=Na,ku(e,0),vu(e,n),pu(e,ji()),t;switch(e.finishedWork=e.current.alternate,e.finishedLanes=n,r){case 0:case 1:throw Error(s(345));case 2:Ou(e);break;case 3:if(vu(e,n),(62914560&n)===n&&10<(r=Fa+500-ji())){if(0!==Kt(e,0))break;if(((i=e.suspendedLanes)&n)!==n){cu(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=Fr(Ou.bind(null,e),r);break}Ou(e);break;case 4:if(vu(e,n),(4186112&n)===n)break;for(r=e.eventTimes,i=-1;0<n;){var a=31-Gt(n);o=1<<a,(a=r[a])>i&&(i=a),n&=~o}if(n=i,10<(n=(120>(n=ji()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Ia(n/1960))-n)){e.timeoutHandle=Fr(Ou.bind(null,e),n);break}Ou(e);break;case 5:Ou(e);break;default:throw Error(s(329))}}return pu(e,ji()),e.callbackNode===t?hu.bind(null,e):null}function vu(e,t){for(t&=~ja,t&=~Ba,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Gt(t),r=1<<n;e[n]=-1,t&=~r}}function gu(e){if(0!==(48&Oa))throw Error(s(327));if(Pu(),e===Ca&&0!==(e.expiredLanes&Pa)){var t=Pa,n=wu(e,t);0!==(La&Ba)&&(n=wu(e,t=Kt(e,t)))}else n=wu(e,t=Kt(e,0));if(0!==e.tag&&2===n&&(Oa|=64,e.hydrate&&(e.hydrate=!1,Gr(e.containerInfo)),0!==(t=Bt(e))&&(n=wu(e,t))),1===n)throw n=Na,ku(e,0),vu(e,t),pu(e,ji()),n;return e.finishedWork=e.current.alternate,e.finishedLanes=t,Ou(e),pu(e,ji()),null}function yu(e,t){var n=Oa;Oa|=1;try{return e(t)}finally{0===(Oa=n)&&(Ga(),Hi())}}function mu(e,t){var n=Oa;Oa&=-2,Oa|=8;try{return e(t)}finally{0===(Oa=n)&&(Ga(),Hi())}}function _u(e,t){ui(Ma,Aa),Aa|=t,La|=t}function bu(){Aa=Ma.current,ai(Ma)}function ku(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,Vr(n)),null!==Da)for(n=Da.return;null!==n;){var r=n;switch(r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&vi();break;case 3:Po(),ai(di),ai(li),Wo();break;case 5:Mo(r);break;case 4:Po();break;case 13:case 19:ai(Uo);break;case 10:eo(r);break;case 23:case 24:bu()}n=n.return}Ca=e,Da=Vu(e.current,null),Pa=Aa=La=t,Ua=0,Na=null,ja=Ba=Ka=0}function Su(e,t){for(;;){var n=Da;try{if(Zi(),zo.current=Os,es){for(var r=Jo.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}es=!1}if(Qo=0,Zo=Xo=Jo=null,ts=!1,Ra.current=null,null===n||null===n.return){Ua=1,Na=t,Da=null;break}e:{var o=e,s=n.return,a=n,u=t;if(t=Pa,a.flags|=2048,a.firstEffect=a.lastEffect=null,null!==u&&"object"===typeof u&&"function"===typeof u.then){var c=u;if(0===(2&a.mode)){var l=a.alternate;l?(a.updateQueue=l.updateQueue,a.memoizedState=l.memoizedState,a.lanes=l.lanes):(a.updateQueue=null,a.memoizedState=null)}var d=0!==(1&Uo.current),f=s;do{var p;if(p=13===f.tag){var h=f.memoizedState;if(null!==h)p=null!==h.dehydrated;else{var v=f.memoizedProps;p=void 0!==v.fallback&&(!0!==v.unstable_avoidThisFallback||!d)}}if(p){var g=f.updateQueue;if(null===g){var y=new Set;y.add(c),f.updateQueue=y}else g.add(c);if(0===(2&f.mode)){if(f.flags|=64,a.flags|=16384,a.flags&=-2981,1===a.tag)if(null===a.alternate)a.tag=17;else{var m=ao(-1,1);m.tag=2,uo(a,m)}a.lanes|=1;break e}u=void 0,a=t;var _=o.pingCache;if(null===_?(_=o.pingCache=new ua,u=new Set,_.set(c,u)):void 0===(u=_.get(c))&&(u=new Set,_.set(c,u)),!u.has(a)){u.add(a);var b=Ku.bind(null,o,c,a);c.then(b,b)}f.flags|=4096,f.lanes=t;break e}f=f.return}while(null!==f);u=Error((W(a.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.")}5!==Ua&&(Ua=2),u=sa(u,a),f=s;do{switch(f.tag){case 3:o=u,f.flags|=4096,t&=-t,f.lanes|=t,co(f,ca(0,o,t));break e;case 1:o=u;var k=f.type,S=f.stateNode;if(0===(64&f.flags)&&("function"===typeof k.getDerivedStateFromError||null!==S&&"function"===typeof S.componentDidCatch&&(null===Ya||!Ya.has(S)))){f.flags|=4096,t&=-t,f.lanes|=t,co(f,la(f,o,t));break e}}f=f.return}while(null!==f)}Ru(n)}catch(E){t=E,Da===n&&null!==n&&(Da=n=n.return);continue}break}}function Eu(){var e=Ta.current;return Ta.current=Os,null===e?Os:e}function wu(e,t){var n=Oa;Oa|=16;var r=Eu();for(Ca===e&&Pa===t||ku(e,t);;)try{xu();break}catch(i){Su(e,i)}if(Zi(),Oa=n,Ta.current=r,null!==Da)throw Error(s(261));return Ca=null,Pa=0,Ua}function xu(){for(;null!==Da;)Tu(Da)}function Iu(){for(;null!==Da&&!xi();)Tu(Da)}function Tu(e){var t=Ha(e.alternate,e,Aa);e.memoizedProps=e.pendingProps,null===t?Ru(e):Da=t,Ra.current=null}function Ru(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(2048&t.flags)){if(null!==(n=ia(n,t,Aa)))return void(Da=n);if(24!==(n=t).tag&&23!==n.tag||null===n.memoizedState||0!==(1073741824&Aa)||0===(4&n.mode)){for(var r=0,i=n.child;null!==i;)r|=i.lanes|i.childLanes,i=i.sibling;n.childLanes=r}null!==e&&0===(2048&e.flags)&&(null===e.firstEffect&&(e.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=t.firstEffect),e.lastEffect=t.lastEffect),1<t.flags&&(null!==e.lastEffect?e.lastEffect.nextEffect=t:e.firstEffect=t,e.lastEffect=t))}else{if(null!==(n=oa(t)))return n.flags&=2047,void(Da=n);null!==e&&(e.firstEffect=e.lastEffect=null,e.flags|=2048)}if(null!==(t=t.sibling))return void(Da=t);Da=t=e}while(null!==t);0===Ua&&(Ua=5)}function Ou(e){var t=qi();return Vi(99,Cu.bind(null,e,t)),null}function Cu(e,t){do{Pu()}while(null!==Ja);if(0!==(48&Oa))throw Error(s(327));var n=e.finishedWork;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(s(177));e.callbackNode=null;var r=n.lanes|n.childLanes,i=r,o=e.pendingLanes&~i;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=i,e.mutableReadLanes&=i,e.entangledLanes&=i,i=e.entanglements;for(var a=e.eventTimes,u=e.expirationTimes;0<o;){var c=31-Gt(o),l=1<<c;i[c]=0,a[c]=-1,u[c]=-1,o&=~l}if(null!==tu&&0===(24&r)&&tu.has(e)&&tu.delete(e),e===Ca&&(Da=Ca=null,Pa=0),1<n.flags?null!==n.lastEffect?(n.lastEffect.nextEffect=n,r=n.firstEffect):r=n:r=n.firstEffect,null!==r){if(i=Oa,Oa|=32,Ra.current=null,Kr=Yt,hr(a=pr())){if("selectionStart"in a)u={start:a.selectionStart,end:a.selectionEnd};else e:if(u=(u=a.ownerDocument)&&u.defaultView||window,(l=u.getSelection&&u.getSelection())&&0!==l.rangeCount){u=l.anchorNode,o=l.anchorOffset,c=l.focusNode,l=l.focusOffset;try{u.nodeType,c.nodeType}catch(I){u=null;break e}var d=0,f=-1,p=-1,h=0,v=0,g=a,y=null;t:for(;;){for(var m;g!==u||0!==o&&3!==g.nodeType||(f=d+o),g!==c||0!==l&&3!==g.nodeType||(p=d+l),3===g.nodeType&&(d+=g.nodeValue.length),null!==(m=g.firstChild);)y=g,g=m;for(;;){if(g===a)break t;if(y===u&&++h===o&&(f=d),y===c&&++v===l&&(p=d),null!==(m=g.nextSibling))break;y=(g=y).parentNode}g=m}u=-1===f||-1===p?null:{start:f,end:p}}else u=null;u=u||{start:0,end:0}}else u=null;Br={focusedElem:a,selectionRange:u},Yt=!1,au=null,uu=!1,$a=r;do{try{Du()}catch(I){if(null===$a)throw Error(s(330));Lu($a,I),$a=$a.nextEffect}}while(null!==$a);au=null,$a=r;do{try{for(a=e;null!==$a;){var _=$a.flags;if(16&_&&me($a.stateNode,""),128&_){var b=$a.alternate;if(null!==b){var k=b.ref;null!==k&&("function"===typeof k?k(null):k.current=null)}}switch(1038&_){case 2:_a($a),$a.flags&=-3;break;case 6:_a($a),$a.flags&=-3,Ea($a.alternate,$a);break;case 1024:$a.flags&=-1025;break;case 1028:$a.flags&=-1025,Ea($a.alternate,$a);break;case 4:Ea($a.alternate,$a);break;case 8:Sa(a,u=$a);var S=u.alternate;ya(u),null!==S&&ya(S)}$a=$a.nextEffect}}catch(I){if(null===$a)throw Error(s(330));Lu($a,I),$a=$a.nextEffect}}while(null!==$a);if(k=Br,b=pr(),_=k.focusedElem,a=k.selectionRange,b!==_&&_&&_.ownerDocument&&fr(_.ownerDocument.documentElement,_)){null!==a&&hr(_)&&(b=a.start,void 0===(k=a.end)&&(k=b),"selectionStart"in _?(_.selectionStart=b,_.selectionEnd=Math.min(k,_.value.length)):(k=(b=_.ownerDocument||document)&&b.defaultView||window).getSelection&&(k=k.getSelection(),u=_.textContent.length,S=Math.min(a.start,u),a=void 0===a.end?S:Math.min(a.end,u),!k.extend&&S>a&&(u=a,a=S,S=u),u=dr(_,S),o=dr(_,a),u&&o&&(1!==k.rangeCount||k.anchorNode!==u.node||k.anchorOffset!==u.offset||k.focusNode!==o.node||k.focusOffset!==o.offset)&&((b=b.createRange()).setStart(u.node,u.offset),k.removeAllRanges(),S>a?(k.addRange(b),k.extend(o.node,o.offset)):(b.setEnd(o.node,o.offset),k.addRange(b))))),b=[];for(k=_;k=k.parentNode;)1===k.nodeType&&b.push({element:k,left:k.scrollLeft,top:k.scrollTop});for("function"===typeof _.focus&&_.focus(),_=0;_<b.length;_++)(k=b[_]).element.scrollLeft=k.left,k.element.scrollTop=k.top}Yt=!!Kr,Br=Kr=null,e.current=n,$a=r;do{try{for(_=e;null!==$a;){var E=$a.flags;if(36&E&&ha(_,$a.alternate,$a),128&E){b=void 0;var w=$a.ref;if(null!==w){var x=$a.stateNode;switch($a.tag){case 5:b=x;break;default:b=x}"function"===typeof w?w(b):w.current=b}}$a=$a.nextEffect}}catch(I){if(null===$a)throw Error(s(330));Lu($a,I),$a=$a.nextEffect}}while(null!==$a);$a=null,Ui(),Oa=i}else e.current=n;if(Qa)Qa=!1,Ja=e,Xa=t;else for($a=r;null!==$a;)t=$a.nextEffect,$a.nextEffect=null,8&$a.flags&&((E=$a).sibling=null,E.stateNode=null),$a=t;if(0===(r=e.pendingLanes)&&(Ya=null),1===r?e===ru?nu++:(nu=0,ru=e):nu=0,n=n.stateNode,ki&&"function"===typeof ki.onCommitFiberRoot)try{ki.onCommitFiberRoot(bi,n,void 0,64===(64&n.current.flags))}catch(I){}if(pu(e,ji()),Wa)throw Wa=!1,e=za,za=null,e;return 0!==(8&Oa)||Hi(),null}function Du(){for(;null!==$a;){var e=$a.alternate;uu||null===au||(0!==(8&$a.flags)?et($a,au)&&(uu=!0):13===$a.tag&&xa(e,$a)&&et($a,au)&&(uu=!0));var t=$a.flags;0!==(256&t)&&pa(e,$a),0===(512&t)||Qa||(Qa=!0,Gi(97,(function(){return Pu(),null}))),$a=$a.nextEffect}}function Pu(){if(90!==Xa){var e=97<Xa?97:Xa;return Xa=90,Vi(e,Uu)}return!1}function Au(e,t){Za.push(t,e),Qa||(Qa=!0,Gi(97,(function(){return Pu(),null})))}function Mu(e,t){eu.push(t,e),Qa||(Qa=!0,Gi(97,(function(){return Pu(),null})))}function Uu(){if(null===Ja)return!1;var e=Ja;if(Ja=null,0!==(48&Oa))throw Error(s(331));var t=Oa;Oa|=32;var n=eu;eu=[];for(var r=0;r<n.length;r+=2){var i=n[r],o=n[r+1],a=i.destroy;if(i.destroy=void 0,"function"===typeof a)try{a()}catch(c){if(null===o)throw Error(s(330));Lu(o,c)}}for(n=Za,Za=[],r=0;r<n.length;r+=2){i=n[r],o=n[r+1];try{var u=i.create;i.destroy=u()}catch(c){if(null===o)throw Error(s(330));Lu(o,c)}}for(u=e.current.firstEffect;null!==u;)e=u.nextEffect,u.nextEffect=null,8&u.flags&&(u.sibling=null,u.stateNode=null),u=e;return Oa=t,Hi(),!0}function Nu(e,t,n){uo(e,t=ca(0,t=sa(n,t),1)),t=cu(),null!==(e=fu(e,1))&&(Vt(e,1,t),pu(e,t))}function Lu(e,t){if(3===e.tag)Nu(e,e,t);else for(var n=e.return;null!==n;){if(3===n.tag){Nu(n,e,t);break}if(1===n.tag){var r=n.stateNode;if("function"===typeof n.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Ya||!Ya.has(r))){var i=la(n,e=sa(t,e),1);if(uo(n,i),i=cu(),null!==(n=fu(n,1)))Vt(n,1,i),pu(n,i);else if("function"===typeof r.componentDidCatch&&(null===Ya||!Ya.has(r)))try{r.componentDidCatch(t,e)}catch(o){}break}}n=n.return}}function Ku(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=cu(),e.pingedLanes|=e.suspendedLanes&n,Ca===e&&(Pa&n)===n&&(4===Ua||3===Ua&&(62914560&Pa)===Pa&&500>ji()-Fa?ku(e,0):ja|=n),pu(e,t)}function Bu(e,t){var n=e.stateNode;null!==n&&n.delete(t),0===(t=0)&&(0===(2&(t=e.mode))?t=1:0===(4&t)?t=99===qi()?1:2:(0===ou&&(ou=La),0===(t=qt(62914560&~ou))&&(t=4194304))),n=cu(),null!==(e=fu(e,t))&&(Vt(e,t,n),pu(e,n))}function ju(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function qu(e,t,n,r){return new ju(e,t,n,r)}function Fu(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Vu(e,t){var n=e.alternate;return null===n?((n=qu(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Gu(e,t,n,r,i,o){var a=2;if(r=e,"function"===typeof e)Fu(e)&&(a=1);else if("string"===typeof e)a=5;else e:switch(e){case w:return Hu(n.children,i,o,t);case N:a=8,i|=16;break;case x:a=8,i|=1;break;case I:return(e=qu(12,n,t,8|i)).elementType=I,e.type=I,e.lanes=o,e;case C:return(e=qu(13,n,t,i)).type=C,e.elementType=C,e.lanes=o,e;case D:return(e=qu(19,n,t,i)).elementType=D,e.lanes=o,e;case L:return $u(n,i,o,t);case K:return(e=qu(24,n,t,i)).elementType=K,e.lanes=o,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case T:a=10;break e;case R:a=9;break e;case O:a=11;break e;case P:a=14;break e;case A:a=16,r=null;break e;case M:a=22;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=qu(a,n,t,i)).elementType=e,t.type=r,t.lanes=o,t}function Hu(e,t,n,r){return(e=qu(7,e,r,t)).lanes=n,e}function $u(e,t,n,r){return(e=qu(23,e,r,t)).elementType=L,e.lanes=n,e}function Wu(e,t,n){return(e=qu(6,e,null,t)).lanes=n,e}function zu(e,t,n){return(t=qu(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Yu(e,t,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Ft(0),this.expirationTimes=Ft(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ft(0),this.mutableSourceEagerHydrationData=null}function Qu(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:E,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}function Ju(e,t,n,r){var i=t.current,o=cu(),a=lu(i);e:if(n){t:{if(Qe(n=n._reactInternals)!==n||1!==n.tag)throw Error(s(170));var u=n;do{switch(u.tag){case 3:u=u.stateNode.context;break t;case 1:if(hi(u.type)){u=u.stateNode.__reactInternalMemoizedMergedChildContext;break t}}u=u.return}while(null!==u);throw Error(s(171))}if(1===n.tag){var c=n.type;if(hi(c)){n=yi(n,c,u);break e}}n=u}else n=ci;return null===t.context?t.context=n:t.pendingContext=n,(t=ao(o,a)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),uo(i,t),du(i,a,o),a}function Xu(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 5:default:return e.child.stateNode}}function Zu(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function ec(e,t){Zu(e,t),(e=e.alternate)&&Zu(e,t)}function tc(e,t,n){var r=null!=n&&null!=n.hydrationOptions&&n.hydrationOptions.mutableSources||null;if(n=new Yu(e,t,null!=n&&!0===n.hydrate),t=qu(3,null,null,2===t?7:1===t?3:0),n.current=t,t.stateNode=n,oo(t),e[Jr]=n.current,Or(8===e.nodeType?e.parentNode:e),r)for(e=0;e<r.length;e++){var i=(t=r[e])._getVersion;i=i(t._source),null==n.mutableSourceEagerHydrationData?n.mutableSourceEagerHydrationData=[t,i]:n.mutableSourceEagerHydrationData.push(t,i)}this._internalRoot=n}function nc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function rc(e,t,n,r,i){var o=n._reactRootContainer;if(o){var s=o._internalRoot;if("function"===typeof i){var a=i;i=function(){var e=Xu(s);a.call(e)}}Ju(t,s,e,i)}else{if(o=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new tc(e,0,t?{hydrate:!0}:void 0)}(n,r),s=o._internalRoot,"function"===typeof i){var u=i;i=function(){var e=Xu(s);u.call(e)}}mu((function(){Ju(t,s,e,i)}))}return Xu(s)}function ic(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!nc(t))throw Error(s(200));return Qu(e,t,null,n)}Ha=function(e,t,n){var r=t.lanes;if(null!==e)if(e.memoizedProps!==t.pendingProps||di.current)Ms=!0;else{if(0===(n&r)){switch(Ms=!1,t.tag){case 3:Gs(t),Ho();break;case 5:Ao(t);break;case 1:hi(t.type)&&mi(t);break;case 4:Do(t,t.stateNode.containerInfo);break;case 10:r=t.memoizedProps.value;var i=t.type._context;ui(Yi,i._currentValue),i._currentValue=r;break;case 13:if(null!==t.memoizedState)return 0!==(n&t.child.childLanes)?Ys(e,t,n):(ui(Uo,1&Uo.current),null!==(t=na(e,t,n))?t.sibling:null);ui(Uo,1&Uo.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(64&e.flags)){if(r)return ta(e,t,n);t.flags|=64}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),ui(Uo,Uo.current),r)break;return null;case 23:case 24:return t.lanes=0,Bs(e,t,n)}return na(e,t,n)}Ms=0!==(16384&e.flags)}else Ms=!1;switch(t.lanes=0,t.tag){case 2:if(r=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,i=pi(t,li.current),no(t,n),i=is(null,t,r,e,i,n),t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,hi(r)){var o=!0;mi(t)}else o=!1;t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,oo(t);var a=r.getDerivedStateFromProps;"function"===typeof a&&ho(t,r,a,e),i.updater=vo,t.stateNode=i,i._reactInternals=t,_o(t,r,e,n),t=Vs(null,t,r,!0,o,n)}else t.tag=0,Us(null,t,i,n),t=t.child;return t;case 16:i=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,i=(o=i._init)(i._payload),t.type=i,o=t.tag=function(e){if("function"===typeof e)return Fu(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===O)return 11;if(e===P)return 14}return 2}(i),e=zi(i,e),o){case 0:t=qs(null,t,i,e,n);break e;case 1:t=Fs(null,t,i,e,n);break e;case 11:t=Ns(null,t,i,e,n);break e;case 14:t=Ls(null,t,i,zi(i.type,e),r,n);break e}throw Error(s(306,i,""))}return t;case 0:return r=t.type,i=t.pendingProps,qs(e,t,r,i=t.elementType===r?i:zi(r,i),n);case 1:return r=t.type,i=t.pendingProps,Fs(e,t,r,i=t.elementType===r?i:zi(r,i),n);case 3:if(Gs(t),r=t.updateQueue,null===e||null===r)throw Error(s(282));if(r=t.pendingProps,i=null!==(i=t.memoizedState)?i.element:null,so(e,t),lo(t,r,null,n),(r=t.memoizedState.element)===i)Ho(),t=na(e,t,n);else{if((o=(i=t.stateNode).hydrate)&&(Ko=Hr(t.stateNode.containerInfo.firstChild),Lo=t,o=Bo=!0),o){if(null!=(e=i.mutableSourceEagerHydrationData))for(i=0;i<e.length;i+=2)(o=e[i])._workInProgressVersionPrimary=e[i+1],$o.push(o);for(n=xo(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|1024,n=n.sibling}else Us(e,t,r,n),Ho();t=t.child}return t;case 5:return Ao(t),null===e&&Fo(t),r=t.type,i=t.pendingProps,o=null!==e?e.memoizedProps:null,a=i.children,qr(r,i)?a=null:null!==o&&qr(r,o)&&(t.flags|=16),js(e,t),Us(e,t,a,n),t.child;case 6:return null===e&&Fo(t),null;case 13:return Ys(e,t,n);case 4:return Do(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=wo(t,null,r,n):Us(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,Ns(e,t,r,i=t.elementType===r?i:zi(r,i),n);case 7:return Us(e,t,t.pendingProps,n),t.child;case 8:case 12:return Us(e,t,t.pendingProps.children,n),t.child;case 10:e:{r=t.type._context,i=t.pendingProps,a=t.memoizedProps,o=i.value;var u=t.type._context;if(ui(Yi,u._currentValue),u._currentValue=o,null!==a)if(u=a.value,0===(o=ar(u,o)?0:0|("function"===typeof r._calculateChangedBits?r._calculateChangedBits(u,o):1073741823))){if(a.children===i.children&&!di.current){t=na(e,t,n);break e}}else for(null!==(u=t.child)&&(u.return=t);null!==u;){var c=u.dependencies;if(null!==c){a=u.child;for(var l=c.firstContext;null!==l;){if(l.context===r&&0!==(l.observedBits&o)){1===u.tag&&((l=ao(-1,n&-n)).tag=2,uo(u,l)),u.lanes|=n,null!==(l=u.alternate)&&(l.lanes|=n),to(u.return,n),c.lanes|=n;break}l=l.next}}else a=10===u.tag&&u.type===t.type?null:u.child;if(null!==a)a.return=u;else for(a=u;null!==a;){if(a===t){a=null;break}if(null!==(u=a.sibling)){u.return=a.return,a=u;break}a=a.return}u=a}Us(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=(o=t.pendingProps).children,no(t,n),r=r(i=ro(i,o.unstable_observedBits)),t.flags|=1,Us(e,t,r,n),t.child;case 14:return o=zi(i=t.type,t.pendingProps),Ls(e,t,i,o=zi(i.type,o),r,n);case 15:return Ks(e,t,t.type,t.pendingProps,r,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:zi(r,i),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,hi(r)?(e=!0,mi(t)):e=!1,no(t,n),yo(t,r,i),_o(t,r,i,n),Vs(null,t,r,!0,e,n);case 19:return ta(e,t,n);case 23:case 24:return Bs(e,t,n)}throw Error(s(156,t.tag))},tc.prototype.render=function(e){Ju(e,this._internalRoot,null,null)},tc.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;Ju(null,e,null,(function(){t[Jr]=null}))},tt=function(e){13===e.tag&&(du(e,4,cu()),ec(e,4))},nt=function(e){13===e.tag&&(du(e,67108864,cu()),ec(e,67108864))},rt=function(e){if(13===e.tag){var t=cu(),n=lu(e);du(e,n,t),ec(e,n)}},it=function(e,t){return t()},Te=function(e,t,n){switch(t){case"input":if(ne(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=ni(r);if(!i)throw Error(s(90));J(r),ne(r,i)}}}break;case"textarea":ce(e,n);break;case"select":null!=(t=n.value)&&se(e,!!n.multiple,t,!1)}},Ae=yu,Me=function(e,t,n,r,i){var o=Oa;Oa|=4;try{return Vi(98,e.bind(null,t,n,r,i))}finally{0===(Oa=o)&&(Ga(),Hi())}},Ue=function(){0===(49&Oa)&&(function(){if(null!==tu){var e=tu;tu=null,e.forEach((function(e){e.expiredLanes|=24&e.pendingLanes,pu(e,ji())}))}Hi()}(),Pu())},Ne=function(e,t){var n=Oa;Oa|=2;try{return e(t)}finally{0===(Oa=n)&&(Ga(),Hi())}};var oc={Events:[ei,ti,ni,De,Pe,Pu,{current:!1}]},sc={findFiberByHostInstance:Zr,bundleType:0,version:"17.0.1",rendererPackageName:"react-dom"},ac={bundleType:sc.bundleType,version:sc.version,rendererPackageName:sc.rendererPackageName,rendererConfig:sc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:k.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ze(e))?null:e.stateNode},findFiberByHostInstance:sc.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var uc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!uc.isDisabled&&uc.supportsFiber)try{bi=uc.inject(ac),ki=uc}catch(ge){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=oc,t.createPortal=ic,t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(s(188));throw Error(s(268,Object.keys(e)))}return e=null===(e=Ze(t))?null:e.stateNode},t.flushSync=function(e,t){var n=Oa;if(0!==(48&n))return e(t);Oa|=1;try{if(e)return Vi(99,e.bind(null,t))}finally{Oa=n,Hi()}},t.hydrate=function(e,t,n){if(!nc(t))throw Error(s(200));return rc(null,e,t,!0,n)},t.render=function(e,t,n){if(!nc(t))throw Error(s(200));return rc(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!nc(e))throw Error(s(40));return!!e._reactRootContainer&&(mu((function(){rc(null,null,e,!1,(function(){e._reactRootContainer=null,e[Jr]=null}))})),!0)},t.unstable_batchedUpdates=yu,t.unstable_createPortal=function(e,t){return ic(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!nc(n))throw Error(s(200));if(null==e||void 0===e._reactInternals)throw Error(s(38));return rc(e,t,n,!1,r)},t.version="17.0.1"},function(e,t,n){"use strict";e.exports=n(85)},function(e,t,n){"use strict";var r,i,o,s;if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var u=Date,c=u.now();t.unstable_now=function(){return u.now()-c}}if("undefined"===typeof window||"function"!==typeof MessageChannel){var l=null,d=null,f=function e(){if(null!==l)try{var n=t.unstable_now();l(!0,n),l=null}catch(r){throw setTimeout(e,0),r}};r=function(e){null!==l?setTimeout(r,0,e):(l=e,setTimeout(f,0))},i=function(e,t){d=setTimeout(e,t)},o=function(){clearTimeout(d)},t.unstable_shouldYield=function(){return!1},s=t.unstable_forceFrameRate=function(){}}else{var p=window.setTimeout,h=window.clearTimeout;if("undefined"!==typeof console){var v=window.cancelAnimationFrame;"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),"function"!==typeof v&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var g=!1,y=null,m=-1,_=5,b=0;t.unstable_shouldYield=function(){return t.unstable_now()>=b},s=function(){},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):_=0<e?Math.floor(1e3/e):5};var k=new MessageChannel,S=k.port2;k.port1.onmessage=function(){if(null!==y){var e=t.unstable_now();b=e+_;try{y(!0,e)?S.postMessage(null):(g=!1,y=null)}catch(n){throw S.postMessage(null),n}}else g=!1},r=function(e){y=e,g||(g=!0,S.postMessage(null))},i=function(e,n){m=p((function(){e(t.unstable_now())}),n)},o=function(){h(m),m=-1}}function E(e,t){var n=e.length;e.push(t);e:for(;;){var r=n-1>>>1,i=e[r];if(!(void 0!==i&&0<I(i,t)))break e;e[r]=t,e[n]=i,n=r}}function w(e){return void 0===(e=e[0])?null:e}function x(e){var t=e[0];if(void 0!==t){var n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length;r<i;){var o=2*(r+1)-1,s=e[o],a=o+1,u=e[a];if(void 0!==s&&0>I(s,n))void 0!==u&&0>I(u,s)?(e[r]=u,e[a]=n,r=a):(e[r]=s,e[o]=n,r=o);else{if(!(void 0!==u&&0>I(u,n)))break e;e[r]=u,e[a]=n,r=a}}}return t}return null}function I(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}var T=[],R=[],O=1,C=null,D=3,P=!1,A=!1,M=!1;function U(e){for(var t=w(R);null!==t;){if(null===t.callback)x(R);else{if(!(t.startTime<=e))break;x(R),t.sortIndex=t.expirationTime,E(T,t)}t=w(R)}}function N(e){if(M=!1,U(e),!A)if(null!==w(T))A=!0,r(L);else{var t=w(R);null!==t&&i(N,t.startTime-e)}}function L(e,n){A=!1,M&&(M=!1,o()),P=!0;var r=D;try{for(U(n),C=w(T);null!==C&&(!(C.expirationTime>n)||e&&!t.unstable_shouldYield());){var s=C.callback;if("function"===typeof s){C.callback=null,D=C.priorityLevel;var a=s(C.expirationTime<=n);n=t.unstable_now(),"function"===typeof a?C.callback=a:C===w(T)&&x(T),U(n)}else x(T);C=w(T)}if(null!==C)var u=!0;else{var c=w(R);null!==c&&i(N,c.startTime-n),u=!1}return u}finally{C=null,D=r,P=!1}}var K=s;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){A||P||(A=!0,r(L))},t.unstable_getCurrentPriorityLevel=function(){return D},t.unstable_getFirstCallbackNode=function(){return w(T)},t.unstable_next=function(e){switch(D){case 1:case 2:case 3:var t=3;break;default:t=D}var n=D;D=t;try{return e()}finally{D=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=K,t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=D;D=e;try{return t()}finally{D=n}},t.unstable_scheduleCallback=function(e,n,s){var a=t.unstable_now();switch("object"===typeof s&&null!==s?s="number"===typeof(s=s.delay)&&0<s?a+s:a:s=a,e){case 1:var u=-1;break;case 2:u=250;break;case 5:u=1073741823;break;case 4:u=1e4;break;default:u=5e3}return e={id:O++,callback:n,priorityLevel:e,startTime:s,expirationTime:u=s+u,sortIndex:-1},s>a?(e.sortIndex=s,E(R,e),null===w(T)&&e===w(R)&&(M?o():M=!0,i(N,s-a))):(e.sortIndex=u,E(T,e),A||P||(A=!0,r(L))),e},t.unstable_wrapCallback=function(e){var t=D;return function(){var n=D;D=t;try{return e.apply(this,arguments)}finally{D=n}}}},,function(e,t){function n(t){return"function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?e.exports=n=function(e){return typeof e}:e.exports=n=function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(t)}e.exports=n},function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(e,t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(u){i=!0,o=u}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return n}}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(e,t,n){var r=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,i="function"===typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(D){u=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var i=t&&t.prototype instanceof g?t:g,o=Object.create(i.prototype),s=new R(r||[]);return o._invoke=function(e,t,n){var r=d;return function(i,o){if(r===p)throw new Error("Generator is already running");if(r===h){if("throw"===i)throw o;return C()}for(n.method=i,n.arg=o;;){var s=n.delegate;if(s){var a=x(s,n);if(a){if(a===v)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===d)throw r=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=p;var u=l(e,t,n);if("normal"===u.type){if(r=n.done?h:f,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=h,n.method="throw",n.arg=u.arg)}}}(e,n,s),o}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(D){return{type:"throw",arg:D}}}e.wrap=c;var d="suspendedStart",f="suspendedYield",p="executing",h="completed",v={};function g(){}function y(){}function m(){}var _={};_[o]=function(){return this};var b=Object.getPrototypeOf,k=b&&b(b(O([])));k&&k!==n&&r.call(k,o)&&(_=k);var S=m.prototype=g.prototype=Object.create(_);function E(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function n(i,o,s,a){var u=l(e[i],e,o);if("throw"!==u.type){var c=u.arg,d=c.value;return d&&"object"===typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,s,a)}),(function(e){n("throw",e,s,a)})):t.resolve(d).then((function(e){c.value=e,s(c)}),(function(e){return n("throw",e,s,a)}))}a(u.arg)}var i;this._invoke=function(e,r){function o(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(o,o):o()}}function x(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,x(e,n),"throw"===n.method))return v;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var i=l(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,v;var o=i.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function O(e){if(e){var n=e[o];if(n)return n.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return s.next=s}}return{next:C}}function C(){return{value:t,done:!0}}return y.prototype=S.constructor=m,m.constructor=y,y.displayName=u(m,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,u(e,a,"GeneratorFunction")),e.prototype=Object.create(S),e},e.awrap=function(e){return{__await:e}},E(w.prototype),w.prototype[s]=function(){return this},e.AsyncIterator=w,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var s=new w(c(t,n,r,i),o);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},E(S),u(S,a,"Generator"),S[o]=function(){return this},S.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=O,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return a.type="throw",a.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var u=r.call(s,"catchLoc"),c=r.call(s,"finallyLoc");if(u&&c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(u){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:O(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}(e.exports);try{regeneratorRuntime=r}catch(i){Function("r","regeneratorRuntime = r")(r)}},function(e,t,n){var r,i;!function(o,s){"use strict";void 0===(i="function"===typeof(r=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"];function i(e,t){var n=e[t];if("function"===typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(r){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function o(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function s(r){return"debug"===r&&(r="log"),typeof console!==t&&("trace"===r&&n?o:void 0!==console[r]?i(console,r):void 0!==console.log?i(console,"log"):e)}function a(t,n){for(var i=0;i<r.length;i++){var o=r[i];this[o]=i<t?e:this.methodFactory(o,t,n)}this.log=this.debug}function u(e,n,r){return function(){typeof console!==t&&(a.call(this,n,r),this[e].apply(this,arguments))}}function c(e,t,n){return s(e)||u.apply(this,arguments)}function l(e,n,i){var o,s=this,u="loglevel";function l(e){var n=(r[e]||"silent").toUpperCase();if(typeof window!==t&&u){try{return void(window.localStorage[u]=n)}catch(i){}try{window.document.cookie=encodeURIComponent(u)+"="+n+";"}catch(i){}}}function d(){var e;if(typeof window!==t&&u){try{e=window.localStorage[u]}catch(i){}if(typeof e===t)try{var n=window.document.cookie,r=n.indexOf(encodeURIComponent(u)+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r))[1])}catch(i){}return void 0===s.levels[e]&&(e=void 0),e}}"string"===typeof e?u+=":"+e:"symbol"===typeof e&&(u=void 0),s.name=e,s.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},s.methodFactory=i||c,s.getLevel=function(){return o},s.setLevel=function(n,r){if("string"===typeof n&&void 0!==s.levels[n.toUpperCase()]&&(n=s.levels[n.toUpperCase()]),!("number"===typeof n&&n>=0&&n<=s.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(o=n,!1!==r&&l(n),a.call(s,n,e),typeof console===t&&n<s.levels.SILENT)return"No console available for logging"},s.setDefaultLevel=function(e){d()||s.setLevel(e,!1)},s.enableAll=function(e){s.setLevel(s.levels.TRACE,e)},s.disableAll=function(e){s.setLevel(s.levels.SILENT,e)};var f=d();null==f&&(f=null==n?"WARN":n),s.setLevel(f,!1)}var d=new l,f={};d.getLogger=function(e){if("symbol"!==typeof e&&"string"!==typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=f[e];return t||(t=f[e]=new l(e,d.getLevel(),d.methodFactory)),t};var p=typeof window!==t?window.log:void 0;return d.noConflict=function(){return typeof window!==t&&window.log===d&&(window.log=p),d},d.getLoggers=function(){return f},d.default=d,d})?r.call(t,n,t,e):r)||(e.exports=i)}()},function(e,t,n){"use strict";var r=n(94);var i=RegExp(Object.keys(r).map((function(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")})).join("|"),"g");function o(e){return r[e]}e.exports=function(e){return e.replace(i,o)}},function(e){e.exports=JSON.parse('{"0":"O","1":"l","\u05ad":"\u0596","\u05ae":"\u0598","\u05a8":"\u0599","\u05a4":"\u059a","\u1ab4":"\u06db","\u20db":"\u06db","\u0619":"\u0313","\u08f3":"\u0313","\u0343":"\u0313","\u0315":"\u0313","\u064f":"\u0313","\u065d":"\u0314","\u059c":"\u0301","\u059d":"\u0301","\u0618":"\u0301","\u0747":"\u0301","\u0341":"\u0301","\u0954":"\u0301","\u064e":"\u0301","\u0340":"\u0300","\u0953":"\u0300","\u030c":"\u0306","\ua67c":"\u0306","\u0658":"\u0306","\u065a":"\u0306","\u036e":"\u0306","\u06e8":"\u0306\u0307","\u0310":"\u0306\u0307","\u0901":"\u0306\u0307","\u0981":"\u0306\u0307","\u0a81":"\u0306\u0307","\u0b01":"\u0306\u0307","\u0c00":"\u0306\u0307","\u0c81":"\u0306\u0307","\u0d01":"\u0306\u0307","\ud805\udcbf":"\u0306\u0307","\u1cd0":"\u0302","\u0311":"\u0302","\u065b":"\u0302","\u07ee":"\u0302","\ua6f0":"\u0302","\u05af":"\u030a","\u06df":"\u030a","\u17d3":"\u030a","\u309a":"\u030a","\u0652":"\u030a","\u0b82":"\u030a","\u1036":"\u030a","\u17c6":"\u030a","\ud804\udf00":"\u030a","\u0e4d":"\u030a","\u0ecd":"\u030a","\u0366":"\u030a","\u2dea":"\u030a","\u08eb":"\u0308","\u07f3":"\u0308","\u064b":"\u030b","\u08f0":"\u030b","\u0342":"\u0303","\u0653":"\u0303","\u05c4":"\u0307","\u06ec":"\u0307","\u0740":"\u0307","\u08ea":"\u0307","\u0741":"\u0307","\u0358":"\u0307","\u05b9":"\u0307","\u05ba":"\u0307","\u05c2":"\u0307","\u05c1":"\u0307","\u07ed":"\u0307","\u0902":"\u0307","\u0a02":"\u0307","\u0a82":"\u0307","\u0bcd":"\u0307","\u0337":"\u0338","\u1ab7":"\u0328","\u0322":"\u0328","\u0345":"\u0328","\u1cd2":"\u0304","\u0305":"\u0304","\u0659":"\u0304","\u07eb":"\u0304","\ua6f1":"\u0304","\u1cda":"\u030e","\u0657":"\u0312","\u0357":"\u0350","\u08ff":"\u0350","\u08f8":"\u0350","\u0900":"\u0352","\u1ced":"\u0316","\u1cdc":"\u0329","\u0656":"\u0329","\u1cd5":"\u032b","\u0347":"\u0333","\u08f9":"\u0354","\u08fa":"\u0355","\u309b":"\uff9e","\u309c":"\uff9f","\u0336":"\u0335","\u302c":"\u0309","\u05c5":"\u0323","\u08ed":"\u0323","\u1cdd":"\u0323","\u05b4":"\u0323","\u065c":"\u0323","\u093c":"\u0323","\u09bc":"\u0323","\u0a3c":"\u0323","\u0abc":"\u0323","\u0b3c":"\u0323","\ud804\uddca":"\u0323","\ud805\udcc3":"\u0323","\ud802\ude3a":"\u0323","\u08ee":"\u0324","\u1cde":"\u0324","\u0f37":"\u0325","\u302d":"\u0325","\u0327":"\u0326","\u0321":"\u0326","\u0339":"\u0326","\u1cd9":"\u032d","\u1cd8":"\u032e","\u0952":"\u0331","\u0320":"\u0331","\u08f1":"\u064c","\u08e8":"\u064c","\u08e5":"\u064c","\ufc5e":"\ufe72\u0651","\u08f2":"\u064d","\ufc5f":"\ufe74\u0651","\ufcf2":"\ufe77\u0651","\ufc60":"\ufe76\u0651","\ufcf3":"\ufe79\u0651","\ufc61":"\ufe78\u0651","\u061a":"\u0650","\u0317":"\u0650","\ufcf4":"\ufe7b\u0651","\ufc62":"\ufe7a\u0651","\ufc63":"\ufe7c\u0670","\u065f":"\u0655","\u030d":"\u0670","\u0742":"\u073c","\u0a03":"\u0983","\u0c03":"\u0983","\u0c83":"\u0983","\u0d03":"\u0983","\u0d83":"\u0983","\u1038":"\u0983","\ud805\udcc1":"\u0983","\u17cb":"\u0e48","\u0ec8":"\u0e48","\u0ec9":"\u0e49","\u0eca":"\u0e4a","\u0ecb":"\u0e4b","\ua66f":"\u20e9","\\u2028":" ","\\u2029":" ","\u1680":" ","\u2000":" ","\u2001":" ","\u2002":" ","\u2003":" ","\u2004":" ","\u2005":" ","\u2006":" ","\u2008":" ","\u2009":" ","\u200a":" ","\u205f":" ","\xa0":" ","\u2007":" ","\u202f":" ","\u07fa":"_","\ufe4d":"_","\ufe4e":"_","\ufe4f":"_","\u2010":"-","\u2011":"-","\u2012":"-","\u2013":"-","\ufe58":"-","\u06d4":"-","\u2043":"-","\u02d7":"-","\u2212":"-","\u2796":"-","\u2cba":"-","\u2a29":"-\u0313","\u2e1a":"-\u0308","\ufb29":"-\u0307","\u2238":"-\u0307","\u2a2a":"-\u0323","\ua4fe":"-.","\uff5e":"\u301c","\u060d":",","\u066b":",","\u201a":",","\xb8":",","\ua4f9":",","\u2e32":"\u060c","\u066c":"\u060c","\u037e":";","\u2e35":"\u061b","\u0903":":","\u0a83":":","\uff1a":":","\u0589":":","\u0703":":","\u0704":":","\u16ec":":","\ufe30":":","\u1803":":","\u1809":":","\u205a":":","\u05c3":":","\u02f8":":","\ua789":":","\u2236":":","\u02d0":":","\ua4fd":":","\u2a74":"::=","\u29f4":":\u2192","\uff01":"!","\u01c3":"!","\u2d51":"!","\u203c":"!!","\u2049":"!?","\u0294":"?","\u0241":"?","\u097d":"?","\u13ae":"?","\ua6eb":"?","\u2048":"?!","\u2047":"??","\u2e2e":"\u061f","\ud834\udd6d":".","\u2024":".","\u0701":".","\u0702":".","\ua60e":".","\ud802\ude50":".","\u0660":".","\u06f0":".","\ua4f8":".","\ua4fb":".,","\u2025":"..","\ua4fa":"..","\u2026":"...","\ua6f4":"\ua6f3\ua6f3","\u30fb":"\xb7","\uff65":"\xb7","\u16eb":"\xb7","\u0387":"\xb7","\u2e31":"\xb7","\ud800\udd01":"\xb7","\u2022":"\xb7","\u2027":"\xb7","\u2219":"\xb7","\u22c5":"\xb7","\ua78f":"\xb7","\u1427":"\xb7","\u22ef":"\xb7\xb7\xb7","\u2d48":"\xb7\xb7\xb7","\u1444":"\xb7<","\u22d7":"\xb7>","\u1437":"\xb7>","\u1440":"\xb7>","\u152f":"\xb74","\u147e":"\xb7b","\u1480":"\xb7b\u0307","\u147a":"\xb7d","\u1498":"\xb7J","\u14b6":"\xb7L","\u1476":"\xb7P","\u1457":"\xb7U","\u143a":"\xb7V","\u143c":"\xb7\u0245","\u14ae":"\xb7\u0393","\u140e":"\xb7\u0394","\u1459":"\xb7\u0548","\u140c":"\xb7\u1401","\u1410":"\xb7\u1404","\u1412":"\xb7\u1405","\u1414":"\xb7\u1406","\u1417":"\xb7\u140a","\u1419":"\xb7\u140b","\u143e":"\xb7\u1432","\u1442":"\xb7\u1434","\u1446":"\xb7\u1439","\u145b":"\xb7\u144f","\u1454":"\xb7\u1450","\u145d":"\xb7\u1450","\u145f":"\xb7\u1451","\u1461":"\xb7\u1455","\u1463":"\xb7\u1456","\u1474":"\xb7\u146b","\u1478":"\xb7\u146e","\u147c":"\xb7\u1470","\u1492":"\xb7\u1489","\u1494":"\xb7\u148b","\u1496":"\xb7\u148c","\u149a":"\xb7\u148e","\u149c":"\xb7\u1490","\u149e":"\xb7\u1491","\u14ac":"\xb7\u14a3","\u14b0":"\xb7\u14a6","\u14b2":"\xb7\u14a7","\u14b4":"\xb7\u14a8","\u14b8":"\xb7\u14ab","\u14c9":"\xb7\u14c0","\u18c6":"\xb7\u14c2","\u18c8":"\xb7\u14c3","\u18ca":"\xb7\u14c4","\u18cc":"\xb7\u14c5","\u14cb":"\xb7\u14c7","\u14cd":"\xb7\u14c8","\u14dc":"\xb7\u14d3","\u14de":"\xb7\u14d5","\u14e0":"\xb7\u14d6","\u14e2":"\xb7\u14d7","\u14e4":"\xb7\u14d8","\u14e6":"\xb7\u14da","\u14e8":"\xb7\u14db","\u14f6":"\xb7\u14ed","\u14f8":"\xb7\u14ef","\u14fa":"\xb7\u14f0","\u14fc":"\xb7\u14f1","\u14fe":"\xb7\u14f2","\u1500":"\xb7\u14f4","\u1502":"\xb7\u14f5","\u1517":"\xb7\u1510","\u1519":"\xb7\u1511","\u151b":"\xb7\u1512","\u151d":"\xb7\u1513","\u151f":"\xb7\u1514","\u1521":"\xb7\u1515","\u1523":"\xb7\u1516","\u1531":"\xb7\u1528","\u1533":"\xb7\u1529","\u1535":"\xb7\u152a","\u1537":"\xb7\u152b","\u1539":"\xb7\u152d","\u153b":"\xb7\u152e","\u18ce":"\xb7\u1543","\u18cf":"\xb7\u1546","\u18d0":"\xb7\u1547","\u18d1":"\xb7\u1548","\u18d2":"\xb7\u1549","\u18d3":"\xb7\u154b","\u154e":"\xb7\u154c","\u155b":"\xb7\u155a","\u1568":"\xb7\u1567","\u18b3":"\xb7\u18b1","\u18b6":"\xb7\u18b4","\u18b9":"\xb7\u18b8","\u18c2":"\xb7\u18c0","\ua830":"\u0964","\u0965":"\u0964\u0964","\u1c3c":"\u1c3b\u1c3b","\u104b":"\u104a\u104a","\u1aa9":"\u1aa8\u1aa8","\u1aab":"\u1aaa\u1aa8","\u1b5f":"\u1b5e\u1b5e","\ud802\ude57":"\ud802\ude56\ud802\ude56","\ud805\udc4c":"\ud805\udc4b\ud805\udc4b","\ud805\ude42":"\ud805\ude41\ud805\ude41","\ud807\udc42":"\ud807\udc41\ud807\udc41","\u1c7f":"\u1c7e\u1c7e","\u055d":"\'","\uff07":"\'","\u2018":"\'","\u2019":"\'","\u201b":"\'","\u2032":"\'","\u2035":"\'","\u055a":"\'","\u05f3":"\'","`":"\'","\u1fef":"\'","\uff40":"\'","\xb4":"\'","\u0384":"\'","\u1ffd":"\'","\u1fbd":"\'","\u1fbf":"\'","\u1ffe":"\'","\u02b9":"\'","\u0374":"\'","\u02c8":"\'","\u02ca":"\'","\u02cb":"\'","\u02f4":"\'","\u02bb":"\'","\u02bd":"\'","\u02bc":"\'","\u02be":"\'","\ua78c":"\'","\u05d9":"\'","\u07f4":"\'","\u07f5":"\'","\u144a":"\'","\u16cc":"\'","\ud81b\udf51":"\'","\ud81b\udf52":"\'","\u1cd3":"\'\'","\\"":"\'\'","\uff02":"\'\'","\u201c":"\'\'","\u201d":"\'\'","\u201f":"\'\'","\u2033":"\'\'","\u2036":"\'\'","\u3003":"\'\'","\u05f4":"\'\'","\u02dd":"\'\'","\u02ba":"\'\'","\u02f6":"\'\'","\u02ee":"\'\'","\u05f2":"\'\'","\u2034":"\'\'\'","\u2037":"\'\'\'","\u2057":"\'\'\'\'","\u0181":"\'B","\u018a":"\'D","\u0149":"\'n","\u01a4":"\'P","\u01ac":"\'T","\u01b3":"\'Y","\uff3b":"(","\u2768":"(","\u2772":"(","\u3014":"(","\ufd3e":"(","\u2e28":"((","\u3220":"(\u30fc)","\u2475":"(2)","\u2487":"(2O)","\u2476":"(3)","\u2477":"(4)","\u2478":"(5)","\u2479":"(6)","\u247a":"(7)","\u247b":"(8)","\u247c":"(9)","\u249c":"(a)","\ud83c\udd10":"(A)","\u249d":"(b)","\ud83c\udd11":"(B)","\u249e":"(c)","\ud83c\udd12":"(C)","\u249f":"(d)","\ud83c\udd13":"(D)","\u24a0":"(e)","\ud83c\udd14":"(E)","\u24a1":"(f)","\ud83c\udd15":"(F)","\u24a2":"(g)","\ud83c\udd16":"(G)","\u24a3":"(h)","\ud83c\udd17":"(H)","\u24a4":"(i)","\u24a5":"(j)","\ud83c\udd19":"(J)","\u24a6":"(k)","\ud83c\udd1a":"(K)","\u2474":"(l)","\ud83c\udd18":"(l)","\u24a7":"(l)","\ud83c\udd1b":"(L)","\u247f":"(l2)","\u2480":"(l3)","\u2481":"(l4)","\u2482":"(l5)","\u2483":"(l6)","\u2484":"(l7)","\u2485":"(l8)","\u2486":"(l9)","\u247e":"(ll)","\u247d":"(lO)","\ud83c\udd1c":"(M)","\u24a9":"(n)","\ud83c\udd1d":"(N)","\u24aa":"(o)","\ud83c\udd1e":"(O)","\u24ab":"(p)","\ud83c\udd1f":"(P)","\u24ac":"(q)","\ud83c\udd20":"(Q)","\u24ad":"(r)","\ud83c\udd21":"(R)","\u24a8":"(rn)","\u24ae":"(s)","\ud83c\udd22":"(S)","\ud83c\udd2a":"(S)","\u24af":"(t)","\ud83c\udd23":"(T)","\u24b0":"(u)","\ud83c\udd24":"(U)","\u24b1":"(v)","\ud83c\udd25":"(V)","\u24b2":"(w)","\ud83c\udd26":"(W)","\u24b3":"(x)","\ud83c\udd27":"(X)","\u24b4":"(y)","\ud83c\udd28":"(Y)","\u24b5":"(z)","\ud83c\udd29":"(Z)","\u3200":"(\u1100)","\u320e":"(\uac00)","\u3201":"(\u1102)","\u320f":"(\ub098)","\u3202":"(\u1103)","\u3210":"(\ub2e4)","\u3203":"(\u1105)","\u3211":"(\ub77c)","\u3204":"(\u1106)","\u3212":"(\ub9c8)","\u3205":"(\u1107)","\u3213":"(\ubc14)","\u3206":"(\u1109)","\u3214":"(\uc0ac)","\u3207":"(\u110b)","\u3215":"(\uc544)","\u321d":"(\uc624\uc804)","\u321e":"(\uc624\ud6c4)","\u3208":"(\u110c)","\u3216":"(\uc790)","\u321c":"(\uc8fc)","\u3209":"(\u110e)","\u3217":"(\ucc28)","\u320a":"(\u110f)","\u3218":"(\uce74)","\u320b":"(\u1110)","\u3219":"(\ud0c0)","\u320c":"(\u1111)","\u321a":"(\ud30c)","\u320d":"(\u1112)","\u321b":"(\ud558)","\u3226":"(\u4e03)","\u3222":"(\u4e09)","\ud83c\ude41":"(\u4e09)","\u3228":"(\u4e5d)","\u3221":"(\u4e8c)","\ud83c\ude42":"(\u4e8c)","\u3224":"(\u4e94)","\u3239":"(\u4ee3)","\u323d":"(\u4f01)","\u3241":"(\u4f11)","\u3227":"(\u516b)","\u3225":"(\u516d)","\u3238":"(\u52b4)","\ud83c\ude47":"(\u52dd)","\u3229":"(\u5341)","\u323f":"(\u5354)","\u3234":"(\u540d)","\u323a":"(\u547c)","\u3223":"(\u56db)","\u322f":"(\u571f)","\u323b":"(\u5b66)","\ud83c\ude43":"(\u5b89)","\ud83c\ude45":"(\u6253)","\ud83c\ude48":"(\u6557)","\u3230":"(\u65e5)","\u322a":"(\u6708)","\u3232":"(\u6709)","\u322d":"(\u6728)","\ud83c\ude40":"(\u672c)","\u3231":"(\u682a)","\u322c":"(\u6c34)","\u322b":"(\u706b)","\ud83c\ude44":"(\u70b9)","\u3235":"(\u7279)","\ud83c\ude46":"(\u76d7)","\u323c":"(\u76e3)","\u3233":"(\u793e)","\u3237":"(\u795d)","\u3240":"(\u796d)","\u3242":"(\u81ea)","\u3243":"(\u81f3)","\u3236":"(\u8ca1)","\u323e":"(\u8cc7)","\u322e":"(\u91d1)","\uff3d":")","\u2769":")","\u2773":")","\u3015":")","\ufd3f":")","\u2e29":"))","\u2774":"{","\ud834\udd14":"{","\u2775":"}","\u301a":"\u27e6","\u301b":"\u27e7","\u27e8":"\u276c","\u2329":"\u276c","\u3008":"\u276c","\u31db":"\u276c","\u304f":"\u276c","\ud847\udfe8":"\u276c","\u27e9":"\u276d","\u232a":"\u276d","\u3009":"\u276d","\uff3e":"\ufe3f","\u2e3f":"\xb6","\u204e":"*","\u066d":"*","\u2217":"*","\ud800\udf1f":"*","\u1735":"/","\u2041":"/","\u2215":"/","\u2044":"/","\u2571":"/","\u27cb":"/","\u29f8":"/","\ud834\ude3a":"/","\u31d3":"/","\u3033":"/","\u2cc6":"/","\u30ce":"/","\u4e3f":"/","\u2f03":"/","\u29f6":"/\u0304","\u2afd":"//","\u2afb":"///","\uff3c":"\\\\","\ufe68":"\\\\","\u2216":"\\\\","\u27cd":"\\\\","\u29f5":"\\\\","\u29f9":"\\\\","\ud834\ude0f":"\\\\","\ud834\ude3b":"\\\\","\u31d4":"\\\\","\u4e36":"\\\\","\u2f02":"\\\\","\u2cf9":"\\\\\\\\","\u244a":"\\\\\\\\","\u27c8":"\\\\\u1455","\ua778":"&","\u0af0":"\u0970","\ud804\udcbb":"\u0970","\ud804\uddc7":"\u0970","\u26ac":"\u0970","\ud804\udddb":"\ua8fc","\u17d9":"\u0e4f","\u17d5":"\u0e5a","\u17da":"\u0e5b","\u0f0c":"\u0f0b","\u0f0e":"\u0f0d\u0f0d","\u02c4":"^","\u02c6":"^","\ua67e":"\u02c7","\u02d8":"\u02c7","\u203e":"\u02c9","\ufe49":"\u02c9","\ufe4a":"\u02c9","\ufe4b":"\u02c9","\ufe4c":"\u02c9","\xaf":"\u02c9","\uffe3":"\u02c9","\u2594":"\u02c9","\u044a":"\u02c9b","\ua651":"\u02c9bi","\u0375":"\u02cf","\u02fb":"\u02ea","\ua716":"\u02ea","\ua714":"\u02eb","\u3002":"\u02f3","\u2e30":"\xb0","\u02da":"\xb0","\u2218":"\xb0","\u25cb":"\xb0","\u25e6":"\xb0","\u235c":"\xb0\u0332","\u2364":"\xb0\u0308","\u2103":"\xb0C","\u2109":"\xb0F","\u0bf5":"\u0bf3","\u0f1b":"\u0f1a\u0f1a","\u0f1f":"\u0f1a\u0f1d","\u0fce":"\u0f1d\u0f1a","\u0f1e":"\u0f1d\u0f1d","\u24b8":"\xa9","\u24c7":"\xae","\u24c5":"\u2117","\ud834\ude1b":"\u2144","\u2bec":"\u219e","\u2bed":"\u219f","\u2bee":"\u21a0","\u2bef":"\u21a1","\u21b5":"\u21b2","\u2965":"\u21c3\u21c2","\u296f":"\u21c3\u16da","\ud835\udedb":"\u2202","\ud835\udf15":"\u2202","\ud835\udf4f":"\u2202","\ud835\udf89":"\u2202","\ud835\udfc3":"\u2202","\ud83a\udccc":"\u2202","\ud83a\udccd":"\u2202\u0335","\xf0":"\u2202\u0335","\u2300":"\u2205","\ud835\udec1":"\u2207","\ud835\udefb":"\u2207","\ud835\udf35":"\u2207","\ud835\udf6f":"\u2207","\ud835\udfa9":"\u2207","\ud806\udca8":"\u2207","\u2362":"\u2207\u0308","\u236b":"\u2207\u0334","\u2588":"\u220e","\u25a0":"\u220e","\u2a3f":"\u2210","\u16ed":"+","\u2795":"+","\ud800\ude9b":"+","\u2a23":"+\u0302","\u2a22":"+\u030a","\u2a24":"+\u0303","\u2214":"+\u0307","\u2a25":"+\u0323","\u2a26":"+\u0330","\u2a27":"+\u2082","\u2797":"\xf7","\u2039":"<","\u276e":"<","\u02c2":"<","\ud834\ude36":"<","\u1438":"<","\u16b2":"<","\u22d6":"<\xb7","\u2cb4":"<\xb7","\u1445":"<\xb7","\u226a":"<<","\u22d8":"<<<","\u1400":"=","\u2e40":"=","\u30a0":"=","\ua4ff":"=","\u225a":"=\u0306","\u2259":"=\u0302","\u2257":"=\u030a","\u2250":"=\u0307","\u2251":"=\u0307\u0323","\u2a6e":"=\u20f0","\u2a75":"==","\u2a76":"===","\u225e":"=\u036b","\u203a":">","\u276f":">","\u02c3":">","\ud834\ude37":">","\u1433":">","\ud81b\udf3f":">","\u1441":">\xb7","\u2aa5":"><","\u226b":">>","\u2a20":">>","\u22d9":">>>","\u2053":"~","\u02dc":"~","\u1fc0":"~","\u223c":"~","\u2368":"~\u0308","\u2e1e":"~\u0307","\u2a6a":"~\u0307","\u2e1f":"~\u0323","\ud83a\udcc8":"\u2220","\u22c0":"\u2227","\u222f":"\u222e\u222e","\u2230":"\u222e\u222e\u222e","\u2e2b":"\u2234","\u2e2a":"\u2235","\u2e2c":"\u2237","\ud804\uddde":"\u2248","\u264e":"\u224f","\ud83d\udf5e":"\u224f","\u2263":"\u2261","\u2a03":"\u228d","\u2a04":"\u228e","\ud834\ude38":"\u228f","\ud834\ude39":"\u2290","\u2a05":"\u2293","\u2a06":"\u2294","\u2a02":"\u2297","\u235f":"\u229b","\ud83d\udf71":"\u22a0","\ud83d\udf55":"\u22a1","\u25c1":"\u22b2","\u25b7":"\u22b3","\u2363":"\u22c6\u0308","\ufe34":"\u2307","\u25e0":"\u2312","\u2a3d":"\u2319","\u2325":"\u2324","\u29c7":"\u233b","\u25ce":"\u233e","\u29be":"\u233e","\u29c5":"\u2342","\u29b0":"\u2349","\u23c3":"\u234b","\u23c2":"\u234e","\u23c1":"\u2355","\u23c6":"\u236d","\u2638":"\u2388","\ufe35":"\u23dc","\ufe36":"\u23dd","\ufe37":"\u23de","\ufe38":"\u23df","\ufe39":"\u23e0","\ufe3a":"\u23e1","\u25b1":"\u23e5","\u23fc":"\u23fb","\ufe31":"\u2502","\uff5c":"\u2502","\u2503":"\u2502","\u250f":"\u250c","\u2523":"\u251c","\u2590":"\u258c","\u2597":"\u2596","\u259d":"\u2598","\u2610":"\u25a1","\uffed":"\u25aa","\u25b8":"\u25b6","\u25ba":"\u25b6","\u2ce9":"\u2627","\ud83d\udf0a":"\u2629","\ud83c\udf12":"\u263d","\ud83c\udf19":"\u263d","\u23fe":"\u263e","\ud83c\udf18":"\u263e","\u29d9":"\u299a","\ud83d\udf3a":"\u29df","\u2a3e":"\u2a1f","\ud800\udda0":"\u2ce8","\u2669":"\ud834\udd58\ud834\udd65","\u266a":"\ud834\udd58\ud834\udd65\ud834\udd6e","\u24ea":"\ud83c\udd0d","\u21ba":"\ud83c\udd0e","\u02d9":"\u0971","\u0d4e":"\u0971","\uff0d":"\u30fc","\u2014":"\u30fc","\u2015":"\u30fc","\u2500":"\u30fc","\u2501":"\u30fc","\u31d0":"\u30fc","\ua7f7":"\u30fc","\u1173":"\u30fc","\u3161":"\u30fc","\u4e00":"\u30fc","\u2f00":"\u30fc","\u1196":"\u30fc\u30fc","\ud7b9":"\u30fc\u1161","\ud7ba":"\u30fc\u1165","\ud7bb":"\u30fc\u1165\u4e28","\ud7bc":"\u30fc\u1169","\u1195":"\u30fc\u116e","\u1174":"\u30fc\u4e28","\u3162":"\u30fc\u4e28","\u1197":"\u30fc\u4e28\u116e","\ud83c\udd0f":"$\u20e0","\u20a4":"\xa3","\u3012":"\u20b8","\u3036":"\u20b8","\u1b5c":"\u1b50","\ua9c6":"\ua9d0","\ud805\udcd1":"\u09e7","\u0ce7":"\u0c67","\u1065":"\u1041","\u2460":"\u2780","\u2469":"\u2789","\u23e8":"\u2081\u2080","\ud835\udfd0":"2","\ud835\udfda":"2","\ud835\udfe4":"2","\ud835\udfee":"2","\ud835\udff8":"2","\ud83e\udff2":"2","\ua75a":"2","\u01a7":"2","\u03e8":"2","\ua644":"2","\u14bf":"2","\ua6ef":"2","\ua9cf":"\u0662","\u06f2":"\u0662","\u0ae8":"\u0968","\ud805\udcd2":"\u09e8","\u0ce8":"\u0c68","\u2461":"\u2781","\u01bb":"2\u0335","\ud83c\udd03":"2,","\u2489":"2.","\u33f5":"22\u65e5","\u336e":"22\u70b9","\u33f6":"23\u65e5","\u336f":"23\u70b9","\u33f7":"24\u65e5","\u3370":"24\u70b9","\u33f8":"25\u65e5","\u33f9":"26\u65e5","\u33fa":"27\u65e5","\u33fb":"28\u65e5","\u33fc":"29\u65e5","\u33f4":"2l\u65e5","\u336d":"2l\u70b9","\u249b":"2O.","\u33f3":"2O\u65e5","\u336c":"2O\u70b9","\u0de9":"\u0de8\u0dcf","\u0def":"\u0de8\u0dd3","\u33e1":"2\u65e5","\u32c1":"2\u6708","\u335a":"2\u70b9","\ud834\ude06":"3","\ud835\udfd1":"3","\ud835\udfdb":"3","\ud835\udfe5":"3","\ud835\udfef":"3","\ud835\udff9":"3","\ud83e\udff3":"3","\ua7ab":"3","\u021c":"3","\u01b7":"3","\ua76a":"3","\u2ccc":"3","\u0417":"3","\u04e0":"3","\ud81b\udf3b":"3","\ud806\udcca":"3","\u06f3":"\u0663","\ud83a\udcc9":"\u0663","\u0ae9":"\u0969","\u2462":"\u2782","\u0498":"3\u0326","\ud83c\udd04":"3,","\u248a":"3.","\u33fe":"3l\u65e5","\u33fd":"3O\u65e5","\u33e2":"3\u65e5","\u32c2":"3\u6708","\u335b":"3\u70b9","\ud835\udfd2":"4","\ud835\udfdc":"4","\ud835\udfe6":"4","\ud835\udff0":"4","\ud835\udffa":"4","\ud83e\udff4":"4","\u13ce":"4","\ud806\udcaf":"4","\u06f4":"\u0664","\u0aea":"\u096a","\u2463":"\u2783","\ud83c\udd05":"4,","\u248b":"4.","\u1530":"4\xb7","\u33e3":"4\u65e5","\u32c3":"4\u6708","\u335c":"4\u70b9","\ud835\udfd3":"5","\ud835\udfdd":"5","\ud835\udfe7":"5","\ud835\udff1":"5","\ud835\udffb":"5","\ud83e\udff5":"5","\u01bc":"5","\ud806\udcbb":"5","\u2464":"\u2784","\ud83c\udd06":"5,","\u248c":"5.","\u33e4":"5\u65e5","\u32c4":"5\u6708","\u335d":"5\u70b9","\ud835\udfd4":"6","\ud835\udfde":"6","\ud835\udfe8":"6","\ud835\udff2":"6","\ud835\udffc":"6","\ud83e\udff6":"6","\u2cd2":"6","\u0431":"6","\u13ee":"6","\ud806\udcd5":"6","\u06f6":"\u0666","\ud805\udcd6":"\u09ec","\u2465":"\u2785","\ud83c\udd07":"6,","\u248d":"6.","\u33e5":"6\u65e5","\u32c5":"6\u6708","\u335e":"6\u70b9","\ud834\ude12":"7","\ud835\udfd5":"7","\ud835\udfdf":"7","\ud835\udfe9":"7","\ud835\udff3":"7","\ud835\udffd":"7","\ud83e\udff7":"7","\ud801\udcd2":"7","\ud806\udcc6":"7","\u2466":"\u2786","\ud83c\udd08":"7,","\u248e":"7.","\u33e6":"7\u65e5","\u32c6":"7\u6708","\u335f":"7\u70b9","\u0b03":"8","\u09ea":"8","\u0a6a":"8","\ud83a\udccb":"8","\ud835\udfd6":"8","\ud835\udfe0":"8","\ud835\udfea":"8","\ud835\udff4":"8","\ud835\udffe":"8","\ud83e\udff8":"8","\u0223":"8","\u0222":"8","\ud800\udf1a":"8","\u0aee":"\u096e","\u2467":"\u2787","\ud83c\udd09":"8,","\u248f":"8.","\u33e7":"8\u65e5","\u32c7":"8\u6708","\u3360":"8\u70b9","\u0a67":"9","\u0b68":"9","\u09ed":"9","\u0d6d":"9","\ud835\udfd7":"9","\ud835\udfe1":"9","\ud835\udfeb":"9","\ud835\udff5":"9","\ud835\udfff":"9","\ud83e\udff9":"9","\ua76e":"9","\u2cca":"9","\ud806\udccc":"9","\ud806\udcac":"9","\ud806\udcd6":"9","\u0967":"\u0669","\ud806\udce4":"\u0669","\u06f9":"\u0669","\u0cef":"\u0c6f","\u2468":"\u2788","\ud83c\udd0a":"9,","\u2490":"9.","\u33e8":"9\u65e5","\u32c8":"9\u6708","\u3361":"9\u70b9","\u237a":"a","\uff41":"a","\ud835\udc1a":"a","\ud835\udc4e":"a","\ud835\udc82":"a","\ud835\udcb6":"a","\ud835\udcea":"a","\ud835\udd1e":"a","\ud835\udd52":"a","\ud835\udd86":"a","\ud835\uddba":"a","\ud835\uddee":"a","\ud835\ude22":"a","\ud835\ude56":"a","\ud835\ude8a":"a","\u0251":"a","\u03b1":"a","\ud835\udec2":"a","\ud835\udefc":"a","\ud835\udf36":"a","\ud835\udf70":"a","\ud835\udfaa":"a","\u0430":"a","\u2df6":"\u0363","\uff21":"A","\ud835\udc00":"A","\ud835\udc34":"A","\ud835\udc68":"A","\ud835\udc9c":"A","\ud835\udcd0":"A","\ud835\udd04":"A","\ud835\udd38":"A","\ud835\udd6c":"A","\ud835\udda0":"A","\ud835\uddd4":"A","\ud835\ude08":"A","\ud835\ude3c":"A","\ud835\ude70":"A","\u0391":"A","\ud835\udea8":"A","\ud835\udee2":"A","\ud835\udf1c":"A","\ud835\udf56":"A","\ud835\udf90":"A","\u0410":"A","\u13aa":"A","\u15c5":"A","\ua4ee":"A","\ud81b\udf40":"A","\ud800\udea0":"A","\u2376":"a\u0332","\u01ce":"\u0103","\u01cd":"\u0102","\u0227":"\xe5","\u0226":"\xc5","\u1e9a":"\u1ea3","\u2100":"a/c","\u2101":"a/s","\ua733":"aa","\ua732":"AA","\xe6":"ae","\u04d5":"ae","\xc6":"AE","\u04d4":"AE","\ua735":"ao","\ua734":"AO","\ud83d\udf07":"AR","\ua737":"au","\ua736":"AU","\ua739":"av","\ua73b":"av","\ua738":"AV","\ua73a":"AV","\ua73d":"ay","\ua73c":"AY","\uab7a":"\u1d00","\u2200":"\u2c6f","\ud834\ude17":"\u2c6f","\u15c4":"\u2c6f","\ua4ef":"\u2c6f","\ud801\udc1f":"\u2c70","\ud835\udc1b":"b","\ud835\udc4f":"b","\ud835\udc83":"b","\ud835\udcb7":"b","\ud835\udceb":"b","\ud835\udd1f":"b","\ud835\udd53":"b","\ud835\udd87":"b","\ud835\uddbb":"b","\ud835\uddef":"b","\ud835\ude23":"b","\ud835\ude57":"b","\ud835\ude8b":"b","\u0184":"b","\u042c":"b","\u13cf":"b","\u1472":"b","\u15af":"b","\uff22":"B","\u212c":"B","\ud835\udc01":"B","\ud835\udc35":"B","\ud835\udc69":"B","\ud835\udcd1":"B","\ud835\udd05":"B","\ud835\udd39":"B","\ud835\udd6d":"B","\ud835\udda1":"B","\ud835\uddd5":"B","\ud835\ude09":"B","\ud835\ude3d":"B","\ud835\ude71":"B","\ua7b4":"B","\u0392":"B","\ud835\udea9":"B","\ud835\udee3":"B","\ud835\udf1d":"B","\ud835\udf57":"B","\ud835\udf91":"B","\u0412":"B","\u13f4":"B","\u15f7":"B","\ua4d0":"B","\ud800\ude82":"B","\ud800\udea1":"B","\ud800\udf01":"B","\u0253":"b\u0314","\u1473":"b\u0307","\u0183":"b\u0304","\u0182":"b\u0304","\u0411":"b\u0304","\u0180":"b\u0335","\u048d":"b\u0335","\u048c":"b\u0335","\u0463":"b\u0335","\u0462":"b\u0335","\u147f":"b\xb7","\u1481":"b\u0307\xb7","\u1488":"b\'","\u042b":"bl","\u0432":"\u0299","\u13fc":"\u0299","\uff43":"c","\u217d":"c","\ud835\udc1c":"c","\ud835\udc50":"c","\ud835\udc84":"c","\ud835\udcb8":"c","\ud835\udcec":"c","\ud835\udd20":"c","\ud835\udd54":"c","\ud835\udd88":"c","\ud835\uddbc":"c","\ud835\uddf0":"c","\ud835\ude24":"c","\ud835\ude58":"c","\ud835\ude8c":"c","\u1d04":"c","\u03f2":"c","\u2ca5":"c","\u0441":"c","\uabaf":"c","\ud801\udc3d":"c","\u2ded":"\u0368","\ud83d\udf4c":"C","\ud806\udcf2":"C","\ud806\udce9":"C","\uff23":"C","\u216d":"C","\u2102":"C","\u212d":"C","\ud835\udc02":"C","\ud835\udc36":"C","\ud835\udc6a":"C","\ud835\udc9e":"C","\ud835\udcd2":"C","\ud835\udd6e":"C","\ud835\udda2":"C","\ud835\uddd6":"C","\ud835\ude0a":"C","\ud835\ude3e":"C","\ud835\ude72":"C","\u03f9":"C","\u2ca4":"C","\u0421":"C","\u13df":"C","\ua4da":"C","\ud800\udea2":"C","\ud800\udf02":"C","\ud801\udc15":"C","\ud801\udd1c":"C","\xa2":"c\u0338","\u023c":"c\u0338","\u20a1":"C\u20eb","\ud83c\udd6e":"C\u20e0","\xe7":"c\u0326","\u04ab":"c\u0326","\xc7":"C\u0326","\u04aa":"C\u0326","\u0187":"C\'","\u2105":"c/o","\u2106":"c/u","\ud83c\udd6d":"\u33c4\\t\u20dd","\u22f4":"\ua793","\u025b":"\ua793","\u03b5":"\ua793","\u03f5":"\ua793","\ud835\udec6":"\ua793","\ud835\udedc":"\ua793","\ud835\udf00":"\ua793","\ud835\udf16":"\ua793","\ud835\udf3a":"\ua793","\ud835\udf50":"\ua793","\ud835\udf74":"\ua793","\ud835\udf8a":"\ua793","\ud835\udfae":"\ua793","\ud835\udfc4":"\ua793","\u2c89":"\ua793","\u0454":"\ua793","\u0511":"\ua793","\uab9b":"\ua793","\ud806\udcce":"\ua793","\ud801\udc29":"\ua793","\u20ac":"\ua792","\u2c88":"\ua792","\u0404":"\ua792","\u2377":"\ua793\u0332","\u037d":"\ua73f","\u03ff":"\ua73e","\u217e":"d","\u2146":"d","\ud835\udc1d":"d","\ud835\udc51":"d","\ud835\udc85":"d","\ud835\udcb9":"d","\ud835\udced":"d","\ud835\udd21":"d","\ud835\udd55":"d","\ud835\udd89":"d","\ud835\uddbd":"d","\ud835\uddf1":"d","\ud835\ude25":"d","\ud835\ude59":"d","\ud835\ude8d":"d","\u0501":"d","\u13e7":"d","\u146f":"d","\ua4d2":"d","\u216e":"D","\u2145":"D","\ud835\udc03":"D","\ud835\udc37":"D","\ud835\udc6b":"D","\ud835\udc9f":"D","\ud835\udcd3":"D","\ud835\udd07":"D","\ud835\udd3b":"D","\ud835\udd6f":"D","\ud835\udda3":"D","\ud835\uddd7":"D","\ud835\ude0b":"D","\ud835\ude3f":"D","\ud835\ude73":"D","\u13a0":"D","\u15de":"D","\u15ea":"D","\ua4d3":"D","\u0257":"d\u0314","\u0256":"d\u0328","\u018c":"d\u0304","\u0111":"d\u0335","\u0110":"D\u0335","\xd0":"D\u0335","\u0189":"D\u0335","\u20ab":"d\u0335\u0331","\ua77a":"\ua779","\u147b":"d\xb7","\u1487":"d\'","\u02a4":"d\u021d","\u01f3":"dz","\u02a3":"dz","\u01f2":"Dz","\u01f1":"DZ","\u01c6":"d\u017e","\u01c5":"D\u017e","\u01c4":"D\u017d","\u02a5":"d\u0291","\uab70":"\u1d05","\u2e39":"\u1e9f","\u03b4":"\u1e9f","\ud835\udec5":"\u1e9f","\ud835\udeff":"\u1e9f","\ud835\udf39":"\u1e9f","\ud835\udf73":"\u1e9f","\ud835\udfad":"\u1e9f","\u056e":"\u1e9f","\u1577":"\u1e9f","\u212e":"e","\uff45":"e","\u212f":"e","\u2147":"e","\ud835\udc1e":"e","\ud835\udc52":"e","\ud835\udc86":"e","\ud835\udcee":"e","\ud835\udd22":"e","\ud835\udd56":"e","\ud835\udd8a":"e","\ud835\uddbe":"e","\ud835\uddf2":"e","\ud835\ude26":"e","\ud835\ude5a":"e","\ud835\ude8e":"e","\uab32":"e","\u0435":"e","\u04bd":"e","\u2df7":"\u0364","\u22ff":"E","\uff25":"E","\u2130":"E","\ud835\udc04":"E","\ud835\udc38":"E","\ud835\udc6c":"E","\ud835\udcd4":"E","\ud835\udd08":"E","\ud835\udd3c":"E","\ud835\udd70":"E","\ud835\udda4":"E","\ud835\uddd8":"E","\ud835\ude0c":"E","\ud835\ude40":"E","\ud835\ude74":"E","\u0395":"E","\ud835\udeac":"E","\ud835\udee6":"E","\ud835\udf20":"E","\ud835\udf5a":"E","\ud835\udf94":"E","\u0415":"E","\u2d39":"E","\u13ac":"E","\ua4f0":"E","\ud806\udca6":"E","\ud806\udcae":"E","\ud800\ude86":"E","\u011b":"\u0115","\u011a":"\u0114","\u0247":"e\u0338","\u0246":"E\u0338","\u04bf":"e\u0328","\uab7c":"\u1d07","\u0259":"\u01dd","\u04d9":"\u01dd","\u2203":"\u018e","\u2d3a":"\u018e","\ua4f1":"\u018e","\u025a":"\u01dd\u02de","\u1d14":"\u01ddo","\uab41":"\u01ddo\u0338","\uab42":"\u01ddo\u0335","\u04d8":"\u018f","\ud834\ude21":"\u0190","\u2107":"\u0190","\u0510":"\u0190","\u13cb":"\u0190","\ud81b\udf2d":"\u0190","\ud801\udc01":"\u0190","\u1d9f":"\u1d4b","\u1d08":"\u025c","\u0437":"\u025c","\u0499":"\u025c\u0326","\ud801\udc42":"\u025e","\ua79d":"\u029a","\ud801\udc2a":"\u029a","\ud835\udc1f":"f","\ud835\udc53":"f","\ud835\udc87":"f","\ud835\udcbb":"f","\ud835\udcef":"f","\ud835\udd23":"f","\ud835\udd57":"f","\ud835\udd8b":"f","\ud835\uddbf":"f","\ud835\uddf3":"f","\ud835\ude27":"f","\ud835\ude5b":"f","\ud835\ude8f":"f","\uab35":"f","\ua799":"f","\u017f":"f","\u1e9d":"f","\u0584":"f","\ud834\ude13":"F","\u2131":"F","\ud835\udc05":"F","\ud835\udc39":"F","\ud835\udc6d":"F","\ud835\udcd5":"F","\ud835\udd09":"F","\ud835\udd3d":"F","\ud835\udd71":"F","\ud835\udda5":"F","\ud835\uddd9":"F","\ud835\ude0d":"F","\ud835\ude41":"F","\ud835\ude75":"F","\ua798":"F","\u03dc":"F","\ud835\udfca":"F","\u15b4":"F","\ua4dd":"F","\ud806\udcc2":"F","\ud806\udca2":"F","\ud800\ude87":"F","\ud800\udea5":"F","\ud801\udd25":"F","\u0192":"f\u0326","\u0191":"F\u0326","\u1d6e":"f\u0334","\u213b":"FAX","\ufb00":"ff","\ufb03":"ffi","\ufb04":"ffl","\ufb01":"fi","\ufb02":"fl","\u02a9":"f\u014b","\u15b5":"\u2132","\ua4de":"\u2132","\ud834\ude30":"\ua7fb","\u15b7":"\ua7fb","\uff47":"g","\u210a":"g","\ud835\udc20":"g","\ud835\udc54":"g","\ud835\udc88":"g","\ud835\udcf0":"g","\ud835\udd24":"g","\ud835\udd58":"g","\ud835\udd8c":"g","\ud835\uddc0":"g","\ud835\uddf4":"g","\ud835\ude28":"g","\ud835\ude5c":"g","\ud835\ude90":"g","\u0261":"g","\u1d83":"g","\u018d":"g","\u0581":"g","\ud835\udc06":"G","\ud835\udc3a":"G","\ud835\udc6e":"G","\ud835\udca2":"G","\ud835\udcd6":"G","\ud835\udd0a":"G","\ud835\udd3e":"G","\ud835\udd72":"G","\ud835\udda6":"G","\ud835\uddda":"G","\ud835\ude0e":"G","\ud835\ude42":"G","\ud835\ude76":"G","\u050c":"G","\u13c0":"G","\u13f3":"G","\ua4d6":"G","\u1da2":"\u1d4d","\u0260":"g\u0314","\u01e7":"\u011f","\u01e6":"\u011e","\u01f5":"\u0123","\u01e5":"g\u0335","\u01e4":"G\u0335","\u0193":"G\'","\u050d":"\u0262","\uab90":"\u0262","\u13fb":"\u0262","\uff48":"h","\u210e":"h","\ud835\udc21":"h","\ud835\udc89":"h","\ud835\udcbd":"h","\ud835\udcf1":"h","\ud835\udd25":"h","\ud835\udd59":"h","\ud835\udd8d":"h","\ud835\uddc1":"h","\ud835\uddf5":"h","\ud835\ude29":"h","\ud835\ude5d":"h","\ud835\ude91":"h","\u04bb":"h","\u0570":"h","\u13c2":"h","\uff28":"H","\u210b":"H","\u210c":"H","\u210d":"H","\ud835\udc07":"H","\ud835\udc3b":"H","\ud835\udc6f":"H","\ud835\udcd7":"H","\ud835\udd73":"H","\ud835\udda7":"H","\ud835\udddb":"H","\ud835\ude0f":"H","\ud835\ude43":"H","\ud835\ude77":"H","\u0397":"H","\ud835\udeae":"H","\ud835\udee8":"H","\ud835\udf22":"H","\ud835\udf5c":"H","\ud835\udf96":"H","\u2c8e":"H","\u041d":"H","\u13bb":"H","\u157c":"H","\ua4e7":"H","\ud800\udecf":"H","\u1d78":"\u1d34","\u0266":"h\u0314","\ua695":"h\u0314","\u13f2":"h\u0314","\u2c67":"H\u0329","\u04a2":"H\u0329","\u0127":"h\u0335","\u210f":"h\u0335","\u045b":"h\u0335","\u0126":"H\u0335","\u04c9":"H\u0326","\u04c7":"H\u0326","\u043d":"\u029c","\uab8b":"\u029c","\u04a3":"\u029c\u0329","\u04ca":"\u029c\u0326","\u04c8":"\u029c\u0326","\u050a":"\u01f6","\uab80":"\u2c76","\u0370":"\u2c75","\u13a8":"\u2c75","\u13b0":"\u2c75","\ua6b1":"\u2c75","\ua795":"\ua727","\u02db":"i","\u2373":"i","\uff49":"i","\u2170":"i","\u2139":"i","\u2148":"i","\ud835\udc22":"i","\ud835\udc56":"i","\ud835\udc8a":"i","\ud835\udcbe":"i","\ud835\udcf2":"i","\ud835\udd26":"i","\ud835\udd5a":"i","\ud835\udd8e":"i","\ud835\uddc2":"i","\ud835\uddf6":"i","\ud835\ude2a":"i","\ud835\ude5e":"i","\ud835\ude92":"i","\u0131":"i","\ud835\udea4":"i","\u026a":"i","\u0269":"i","\u03b9":"i","\u1fbe":"i","\u037a":"i","\ud835\udeca":"i","\ud835\udf04":"i","\ud835\udf3e":"i","\ud835\udf78":"i","\ud835\udfb2":"i","\u0456":"i","\ua647":"i","\u04cf":"i","\uab75":"i","\u13a5":"i","\ud806\udcc3":"i","\u24db":"\u24be","\u2378":"i\u0332","\u01d0":"\u012d","\u01cf":"\u012c","\u0268":"i\u0335","\u1d7b":"i\u0335","\u1d7c":"i\u0335","\u2171":"ii","\u2172":"iii","\u0133":"ij","\u2173":"iv","\u2178":"ix","\uff4a":"j","\u2149":"j","\ud835\udc23":"j","\ud835\udc57":"j","\ud835\udc8b":"j","\ud835\udcbf":"j","\ud835\udcf3":"j","\ud835\udd27":"j","\ud835\udd5b":"j","\ud835\udd8f":"j","\ud835\uddc3":"j","\ud835\uddf7":"j","\ud835\ude2b":"j","\ud835\ude5f":"j","\ud835\ude93":"j","\u03f3":"j","\u0458":"j","\uff2a":"J","\ud835\udc09":"J","\ud835\udc3d":"J","\ud835\udc71":"J","\ud835\udca5":"J","\ud835\udcd9":"J","\ud835\udd0d":"J","\ud835\udd41":"J","\ud835\udd75":"J","\ud835\udda9":"J","\ud835\udddd":"J","\ud835\ude11":"J","\ud835\ude45":"J","\ud835\ude79":"J","\ua7b2":"J","\u037f":"J","\u0408":"J","\u13ab":"J","\u148d":"J","\ua4d9":"J","\u0249":"j\u0335","\u0248":"J\u0335","\u1499":"J\xb7","\ud835\udea5":"\u0237","\u0575":"\u0237","\uab7b":"\u1d0a","\ud835\udc24":"k","\ud835\udc58":"k","\ud835\udc8c":"k","\ud835\udcc0":"k","\ud835\udcf4":"k","\ud835\udd28":"k","\ud835\udd5c":"k","\ud835\udd90":"k","\ud835\uddc4":"k","\ud835\uddf8":"k","\ud835\ude2c":"k","\ud835\ude60":"k","\ud835\ude94":"k","\u212a":"K","\uff2b":"K","\ud835\udc0a":"K","\ud835\udc3e":"K","\ud835\udc72":"K","\ud835\udca6":"K","\ud835\udcda":"K","\ud835\udd0e":"K","\ud835\udd42":"K","\ud835\udd76":"K","\ud835\uddaa":"K","\ud835\uddde":"K","\ud835\ude12":"K","\ud835\ude46":"K","\ud835\ude7a":"K","\u039a":"K","\ud835\udeb1":"K","\ud835\udeeb":"K","\ud835\udf25":"K","\ud835\udf5f":"K","\ud835\udf99":"K","\u2c94":"K","\u041a":"K","\u13e6":"K","\u16d5":"K","\ua4d7":"K","\ud801\udd18":"K","\u0199":"k\u0314","\u2c69":"K\u0329","\u049a":"K\u0329","\u20ad":"K\u0335","\ua740":"K\u0335","\u049e":"K\u0335","\u0198":"K\'","\u05c0":"l","|":"l","\u2223":"l","\u23fd":"l","\uffe8":"l","\u0661":"l","\u06f1":"l","\ud800\udf20":"l","\ud83a\udcc7":"l","\ud835\udfcf":"l","\ud835\udfd9":"l","\ud835\udfe3":"l","\ud835\udfed":"l","\ud835\udff7":"l","\ud83e\udff1":"l","I":"l","\uff29":"l","\u2160":"l","\u2110":"l","\u2111":"l","\ud835\udc08":"l","\ud835\udc3c":"l","\ud835\udc70":"l","\ud835\udcd8":"l","\ud835\udd40":"l","\ud835\udd74":"l","\ud835\udda8":"l","\ud835\udddc":"l","\ud835\ude10":"l","\ud835\ude44":"l","\ud835\ude78":"l","\u0196":"l","\uff4c":"l","\u217c":"l","\u2113":"l","\ud835\udc25":"l","\ud835\udc59":"l","\ud835\udc8d":"l","\ud835\udcc1":"l","\ud835\udcf5":"l","\ud835\udd29":"l","\ud835\udd5d":"l","\ud835\udd91":"l","\ud835\uddc5":"l","\ud835\uddf9":"l","\ud835\ude2d":"l","\ud835\ude61":"l","\ud835\ude95":"l","\u01c0":"l","\u0399":"l","\ud835\udeb0":"l","\ud835\udeea":"l","\ud835\udf24":"l","\ud835\udf5e":"l","\ud835\udf98":"l","\u2c92":"l","\u0406":"l","\u04c0":"l","\u05d5":"l","\u05df":"l","\u0627":"l","\ud83b\ude00":"l","\ud83b\ude80":"l","\ufe8e":"l","\ufe8d":"l","\u07ca":"l","\u2d4f":"l","\u16c1":"l","\ua4f2":"l","\ud81b\udf28":"l","\ud800\ude8a":"l","\ud800\udf09":"l","\ud834\ude2a":"L","\u216c":"L","\u2112":"L","\ud835\udc0b":"L","\ud835\udc3f":"L","\ud835\udc73":"L","\ud835\udcdb":"L","\ud835\udd0f":"L","\ud835\udd43":"L","\ud835\udd77":"L","\ud835\uddab":"L","\ud835\udddf":"L","\ud835\ude13":"L","\ud835\ude47":"L","\ud835\ude7b":"L","\u2cd0":"L","\u13de":"L","\u14aa":"L","\ua4e1":"L","\ud81b\udf16":"L","\ud806\udca3":"L","\ud806\udcb2":"L","\ud801\udc1b":"L","\ud801\udd26":"L","\ufd3c":"l\u030b","\ufd3d":"l\u030b","\u0142":"l\u0338","\u0141":"L\u0338","\u026d":"l\u0328","\u0197":"l\u0335","\u019a":"l\u0335","\u026b":"l\u0334","\u0625":"l\u0655","\ufe88":"l\u0655","\ufe87":"l\u0655","\u0673":"l\u0655","\u0140":"l\xb7","\u013f":"l\xb7","\u14b7":"l\xb7","\ud83c\udd02":"l,","\u2488":"l.","\u05f1":"l\'","\u2493":"l2.","\u33eb":"l2\u65e5","\u32cb":"l2\u6708","\u3364":"l2\u70b9","\u2494":"l3.","\u33ec":"l3\u65e5","\u3365":"l3\u70b9","\u2495":"l4.","\u33ed":"l4\u65e5","\u3366":"l4\u70b9","\u2496":"l5.","\u33ee":"l5\u65e5","\u3367":"l5\u70b9","\u2497":"l6.","\u33ef":"l6\u65e5","\u3368":"l6\u70b9","\u2498":"l7.","\u33f0":"l7\u65e5","\u3369":"l7\u70b9","\u2499":"l8.","\u33f1":"l8\u65e5","\u336a":"l8\u70b9","\u249a":"l9.","\u33f2":"l9\u65e5","\u336b":"l9\u70b9","\u01c9":"lj","\u0132":"lJ","\u01c8":"Lj","\u01c7":"LJ","\u2016":"ll","\u2225":"ll","\u2161":"ll","\u01c1":"ll","\u05f0":"ll","\ud800\udd99":"l\u0335l\u0335","\u2492":"ll.","\u2162":"lll","\ud800\udd98":"l\u0335l\u0335S\u0335","\u33ea":"ll\u65e5","\u32ca":"ll\u6708","\u3363":"ll\u70b9","\u042e":"lO","\u2491":"lO.","\u33e9":"lO\u65e5","\u32c9":"lO\u6708","\u3362":"lO\u70b9","\u02aa":"ls","\u20b6":"lt","\u2163":"lV","\u2168":"lX","\u026e":"l\u021d","\u02ab":"lz","\u0623":"l\u0674","\ufe84":"l\u0674","\ufe83":"l\u0674","\u0672":"l\u0674","\u0675":"l\u0674","\ufdf3":"l\u0643\u0628\u0631","\ufdf2":"l\u0644\u0644\u0651\u0670o","\u33e0":"l\u65e5","\u32c0":"l\u6708","\u3359":"l\u70b9","\u2cd1":"\u029f","\uabae":"\u029f","\ud801\udc43":"\u029f","\uff2d":"M","\u216f":"M","\u2133":"M","\ud835\udc0c":"M","\ud835\udc40":"M","\ud835\udc74":"M","\ud835\udcdc":"M","\ud835\udd10":"M","\ud835\udd44":"M","\ud835\udd78":"M","\ud835\uddac":"M","\ud835\udde0":"M","\ud835\ude14":"M","\ud835\ude48":"M","\ud835\ude7c":"M","\u039c":"M","\ud835\udeb3":"M","\ud835\udeed":"M","\ud835\udf27":"M","\ud835\udf61":"M","\ud835\udf9b":"M","\u03fa":"M","\u2c98":"M","\u041c":"M","\u13b7":"M","\u15f0":"M","\u16d6":"M","\ua4df":"M","\ud800\udeb0":"M","\ud800\udf11":"M","\u04cd":"M\u0326","\ud83d\udf6b":"MB","\u2de8":"\u1ddf","\ud835\udc27":"n","\ud835\udc5b":"n","\ud835\udc8f":"n","\ud835\udcc3":"n","\ud835\udcf7":"n","\ud835\udd2b":"n","\ud835\udd5f":"n","\ud835\udd93":"n","\ud835\uddc7":"n","\ud835\uddfb":"n","\ud835\ude2f":"n","\ud835\ude63":"n","\ud835\ude97":"n","\u0578":"n","\u057c":"n","\uff2e":"N","\u2115":"N","\ud835\udc0d":"N","\ud835\udc41":"N","\ud835\udc75":"N","\ud835\udca9":"N","\ud835\udcdd":"N","\ud835\udd11":"N","\ud835\udd79":"N","\ud835\uddad":"N","\ud835\udde1":"N","\ud835\ude15":"N","\ud835\ude49":"N","\ud835\ude7d":"N","\u039d":"N","\ud835\udeb4":"N","\ud835\udeee":"N","\ud835\udf28":"N","\ud835\udf62":"N","\ud835\udf9c":"N","\u2c9a":"N","\ua4e0":"N","\ud801\udd13":"N","\ud800\udd8e":"N\u030a","\u0273":"n\u0328","\u019e":"n\u0329","\u03b7":"n\u0329","\ud835\udec8":"n\u0329","\ud835\udf02":"n\u0329","\ud835\udf3c":"n\u0329","\ud835\udf76":"n\u0329","\ud835\udfb0":"n\u0329","\u019d":"N\u0326","\u1d70":"n\u0334","\u01cc":"nj","\u01cb":"Nj","\u01ca":"NJ","\u2116":"No","\u0377":"\u1d0e","\u0438":"\u1d0e","\ud801\udc4d":"\u1d0e","\u0146":"\u0272","\u0c02":"o","\u0c82":"o","\u0d02":"o","\u0d82":"o","\u0966":"o","\u0a66":"o","\u0ae6":"o","\u0be6":"o","\u0c66":"o","\u0ce6":"o","\u0d66":"o","\u0e50":"o","\u0ed0":"o","\u1040":"o","\u0665":"o","\u06f5":"o","\uff4f":"o","\u2134":"o","\ud835\udc28":"o","\ud835\udc5c":"o","\ud835\udc90":"o","\ud835\udcf8":"o","\ud835\udd2c":"o","\ud835\udd60":"o","\ud835\udd94":"o","\ud835\uddc8":"o","\ud835\uddfc":"o","\ud835\ude30":"o","\ud835\ude64":"o","\ud835\ude98":"o","\u1d0f":"o","\u1d11":"o","\uab3d":"o","\u03bf":"o","\ud835\uded0":"o","\ud835\udf0a":"o","\ud835\udf44":"o","\ud835\udf7e":"o","\ud835\udfb8":"o","\u03c3":"o","\ud835\uded4":"o","\ud835\udf0e":"o","\ud835\udf48":"o","\ud835\udf82":"o","\ud835\udfbc":"o","\u2c9f":"o","\u043e":"o","\u10ff":"o","\u0585":"o","\u05e1":"o","\u0647":"o","\ud83b\ude24":"o","\ud83b\ude64":"o","\ud83b\ude84":"o","\ufeeb":"o","\ufeec":"o","\ufeea":"o","\ufee9":"o","\u06be":"o","\ufbac":"o","\ufbad":"o","\ufbab":"o","\ufbaa":"o","\u06c1":"o","\ufba8":"o","\ufba9":"o","\ufba7":"o","\ufba6":"o","\u06d5":"o","\u0d20":"o","\u101d":"o","\ud801\udcea":"o","\ud806\udcc8":"o","\ud806\udcd7":"o","\ud801\udc2c":"o","\u07c0":"O","\u09e6":"O","\u0b66":"O","\u3007":"O","\ud805\udcd0":"O","\ud806\udce0":"O","\ud835\udfce":"O","\ud835\udfd8":"O","\ud835\udfe2":"O","\ud835\udfec":"O","\ud835\udff6":"O","\ud83e\udff0":"O","\uff2f":"O","\ud835\udc0e":"O","\ud835\udc42":"O","\ud835\udc76":"O","\ud835\udcaa":"O","\ud835\udcde":"O","\ud835\udd12":"O","\ud835\udd46":"O","\ud835\udd7a":"O","\ud835\uddae":"O","\ud835\udde2":"O","\ud835\ude16":"O","\ud835\ude4a":"O","\ud835\ude7e":"O","\u039f":"O","\ud835\udeb6":"O","\ud835\udef0":"O","\ud835\udf2a":"O","\ud835\udf64":"O","\ud835\udf9e":"O","\u2c9e":"O","\u041e":"O","\u0555":"O","\u2d54":"O","\u12d0":"O","\u0b20":"O","\ud801\udcc2":"O","\ua4f3":"O","\ud806\udcb5":"O","\ud800\ude92":"O","\ud800\udeab":"O","\ud801\udc04":"O","\ud801\udd16":"O","\u2070":"\xba","\u1d52":"\xba","\u01d2":"\u014f","\u01d1":"\u014e","\u06ff":"o\u0302","\u0150":"\xd6","\xf8":"o\u0338","\uab3e":"o\u0338","\xd8":"O\u0338","\u2d41":"O\u0338","\u01fe":"O\u0338\u0301","\u0275":"o\u0335","\ua74b":"o\u0335","\u04e9":"o\u0335","\u0473":"o\u0335","\uab8e":"o\u0335","\uabbb":"o\u0335","\u2296":"O\u0335","\u229d":"O\u0335","\u236c":"O\u0335","\ud834\ude1a":"O\u0335","\ud83d\udf14":"O\u0335","\u019f":"O\u0335","\ua74a":"O\u0335","\u03b8":"O\u0335","\u03d1":"O\u0335","\ud835\udec9":"O\u0335","\ud835\udedd":"O\u0335","\ud835\udf03":"O\u0335","\ud835\udf17":"O\u0335","\ud835\udf3d":"O\u0335","\ud835\udf51":"O\u0335","\ud835\udf77":"O\u0335","\ud835\udf8b":"O\u0335","\ud835\udfb1":"O\u0335","\ud835\udfc5":"O\u0335","\u0398":"O\u0335","\u03f4":"O\u0335","\ud835\udeaf":"O\u0335","\ud835\udeb9":"O\u0335","\ud835\udee9":"O\u0335","\ud835\udef3":"O\u0335","\ud835\udf23":"O\u0335","\ud835\udf2d":"O\u0335","\ud835\udf5d":"O\u0335","\ud835\udf67":"O\u0335","\ud835\udf97":"O\u0335","\ud835\udfa1":"O\u0335","\u04e8":"O\u0335","\u0472":"O\u0335","\u2d31":"O\u0335","\u13be":"O\u0335","\u13eb":"O\u0335","\uab74":"o\u031b","\ufcd9":"o\u0670","\ud83c\udd01":"O,","\ud83c\udd00":"O.","\u01a1":"o\'","\u01a0":"O\'","\u13a4":"O\'","%":"\xba/\u2080","\u066a":"\xba/\u2080","\u2052":"\xba/\u2080","\u2030":"\xba/\u2080\u2080","\u0609":"\xba/\u2080\u2080","\u2031":"\xba/\u2080\u2080\u2080","\u060a":"\xba/\u2080\u2080\u2080","\u0153":"oe","\u0152":"OE","\u0276":"o\u1d07","\u221e":"oo","\ua74f":"oo","\ua699":"oo","\ua74e":"OO","\ua698":"OO","\ufcd7":"o\u062c","\ufc51":"o\u062c","\ufcd8":"o\u0645","\ufc52":"o\u0645","\ufd93":"o\u0645\u062c","\ufd94":"o\u0645\u0645","\ufc53":"o\u0649","\ufc54":"o\u0649","\u0d5f":"o\u0d30o","\u1010":"o\u102c","\u3358":"O\u70b9","\u2184":"\u0254","\u1d10":"\u0254","\u037b":"\u0254","\ud801\udc4b":"\u0254","\u2183":"\u0186","\u03fd":"\u0186","\ua4db":"\u0186","\ud801\udc23":"\u0186","\uab3f":"\u0254\u0338","\uab62":"\u0254e","\ud801\udc3f":"\u0277","\u2374":"p","\uff50":"p","\ud835\udc29":"p","\ud835\udc5d":"p","\ud835\udc91":"p","\ud835\udcc5":"p","\ud835\udcf9":"p","\ud835\udd2d":"p","\ud835\udd61":"p","\ud835\udd95":"p","\ud835\uddc9":"p","\ud835\uddfd":"p","\ud835\ude31":"p","\ud835\ude65":"p","\ud835\ude99":"p","\u03c1":"p","\u03f1":"p","\ud835\uded2":"p","\ud835\udee0":"p","\ud835\udf0c":"p","\ud835\udf1a":"p","\ud835\udf46":"p","\ud835\udf54":"p","\ud835\udf80":"p","\ud835\udf8e":"p","\ud835\udfba":"p","\ud835\udfc8":"p","\u2ca3":"p","\u0440":"p","\uff30":"P","\u2119":"P","\ud835\udc0f":"P","\ud835\udc43":"P","\ud835\udc77":"P","\ud835\udcab":"P","\ud835\udcdf":"P","\ud835\udd13":"P","\ud835\udd7b":"P","\ud835\uddaf":"P","\ud835\udde3":"P","\ud835\ude17":"P","\ud835\ude4b":"P","\ud835\ude7f":"P","\u03a1":"P","\ud835\udeb8":"P","\ud835\udef2":"P","\ud835\udf2c":"P","\ud835\udf66":"P","\ud835\udfa0":"P","\u2ca2":"P","\u0420":"P","\u13e2":"P","\u146d":"P","\ua4d1":"P","\ud800\ude95":"P","\u01a5":"p\u0314","\u1d7d":"p\u0335","\u1477":"p\xb7","\u1486":"P\'","\u1d29":"\u1d18","\uabb2":"\u1d18","\u03c6":"\u0278","\u03d5":"\u0278","\ud835\uded7":"\u0278","\ud835\udedf":"\u0278","\ud835\udf11":"\u0278","\ud835\udf19":"\u0278","\ud835\udf4b":"\u0278","\ud835\udf53":"\u0278","\ud835\udf85":"\u0278","\ud835\udf8d":"\u0278","\ud835\udfbf":"\u0278","\ud835\udfc7":"\u0278","\u2cab":"\u0278","\u0444":"\u0278","\ud835\udc2a":"q","\ud835\udc5e":"q","\ud835\udc92":"q","\ud835\udcc6":"q","\ud835\udcfa":"q","\ud835\udd2e":"q","\ud835\udd62":"q","\ud835\udd96":"q","\ud835\uddca":"q","\ud835\uddfe":"q","\ud835\ude32":"q","\ud835\ude66":"q","\ud835\ude9a":"q","\u051b":"q","\u0563":"q","\u0566":"q","\u211a":"Q","\ud835\udc10":"Q","\ud835\udc44":"Q","\ud835\udc78":"Q","\ud835\udcac":"Q","\ud835\udce0":"Q","\ud835\udd14":"Q","\ud835\udd7c":"Q","\ud835\uddb0":"Q","\ud835\udde4":"Q","\ud835\ude18":"Q","\ud835\ude4c":"Q","\ud835\ude80":"Q","\u2d55":"Q","\u02a0":"q\u0314","\ud83d\udf00":"QE","\u1d90":"\u024b","\u1d0b":"\u0138","\u03ba":"\u0138","\u03f0":"\u0138","\ud835\udecb":"\u0138","\ud835\udede":"\u0138","\ud835\udf05":"\u0138","\ud835\udf18":"\u0138","\ud835\udf3f":"\u0138","\ud835\udf52":"\u0138","\ud835\udf79":"\u0138","\ud835\udf8c":"\u0138","\ud835\udfb3":"\u0138","\ud835\udfc6":"\u0138","\u2c95":"\u0138","\u043a":"\u0138","\uabb6":"\u0138","\u049b":"\u0138\u0329","\u049f":"\u0138\u0335","\ud835\udc2b":"r","\ud835\udc5f":"r","\ud835\udc93":"r","\ud835\udcc7":"r","\ud835\udcfb":"r","\ud835\udd2f":"r","\ud835\udd63":"r","\ud835\udd97":"r","\ud835\uddcb":"r","\ud835\uddff":"r","\ud835\ude33":"r","\ud835\ude67":"r","\ud835\ude9b":"r","\uab47":"r","\uab48":"r","\u1d26":"r","\u2c85":"r","\u0433":"r","\uab81":"r","\ud834\ude16":"R","\u211b":"R","\u211c":"R","\u211d":"R","\ud835\udc11":"R","\ud835\udc45":"R","\ud835\udc79":"R","\ud835\udce1":"R","\ud835\udd7d":"R","\ud835\uddb1":"R","\ud835\udde5":"R","\ud835\ude19":"R","\ud835\ude4d":"R","\ud835\ude81":"R","\u01a6":"R","\u13a1":"R","\u13d2":"R","\ud801\udcb4":"R","\u1587":"R","\ua4e3":"R","\ud81b\udf35":"R","\u027d":"r\u0328","\u027c":"r\u0329","\u024d":"r\u0335","\u0493":"r\u0335","\u1d72":"r\u0334","\u0491":"r\'","\ud806\udce3":"rn","m":"rn","\u217f":"rn","\ud835\udc26":"rn","\ud835\udc5a":"rn","\ud835\udc8e":"rn","\ud835\udcc2":"rn","\ud835\udcf6":"rn","\ud835\udd2a":"rn","\ud835\udd5e":"rn","\ud835\udd92":"rn","\ud835\uddc6":"rn","\ud835\uddfa":"rn","\ud835\ude2e":"rn","\ud835\ude62":"rn","\ud835\ude96":"rn","\ud805\udf00":"rn","\u20a5":"rn\u0338","\u0271":"rn\u0326","\u1d6f":"rn\u0334","\u20a8":"Rs","\uab71":"\u0280","\uaba2":"\u0280","\u044f":"\u1d19","\u1d73":"\u027e\u0334","\u2129":"\u027f","\uff53":"s","\ud835\udc2c":"s","\ud835\udc60":"s","\ud835\udc94":"s","\ud835\udcc8":"s","\ud835\udcfc":"s","\ud835\udd30":"s","\ud835\udd64":"s","\ud835\udd98":"s","\ud835\uddcc":"s","\ud835\ude00":"s","\ud835\ude34":"s","\ud835\ude68":"s","\ud835\ude9c":"s","\ua731":"s","\u01bd":"s","\u0455":"s","\uabaa":"s","\ud806\udcc1":"s","\ud801\udc48":"s","\uff33":"S","\ud835\udc12":"S","\ud835\udc46":"S","\ud835\udc7a":"S","\ud835\udcae":"S","\ud835\udce2":"S","\ud835\udd16":"S","\ud835\udd4a":"S","\ud835\udd7e":"S","\ud835\uddb2":"S","\ud835\udde6":"S","\ud835\ude1a":"S","\ud835\ude4e":"S","\ud835\ude82":"S","\u0405":"S","\u054f":"S","\u13d5":"S","\u13da":"S","\ua4e2":"S","\ud81b\udf3a":"S","\ud800\ude96":"S","\ud801\udc20":"S","\u0282":"s\u0328","\u1d74":"s\u0334","\ua7b5":"\xdf","\u03b2":"\xdf","\u03d0":"\xdf","\ud835\udec3":"\xdf","\ud835\udefd":"\xdf","\ud835\udf37":"\xdf","\ud835\udf71":"\xdf","\ud835\udfab":"\xdf","\u13f0":"\xdf","\ud83d\udf5c":"sss","\ufb06":"st","\u222b":"\u0283","\uab4d":"\u0283","\u2211":"\u01a9","\u2140":"\u01a9","\u03a3":"\u01a9","\ud835\udeba":"\u01a9","\ud835\udef4":"\u01a9","\ud835\udf2e":"\u01a9","\ud835\udf68":"\u01a9","\ud835\udfa2":"\u01a9","\u2d49":"\u01a9","\u222c":"\u0283\u0283","\u222d":"\u0283\u0283\u0283","\u2a0c":"\u0283\u0283\u0283\u0283","\ud835\udc2d":"t","\ud835\udc61":"t","\ud835\udc95":"t","\ud835\udcc9":"t","\ud835\udcfd":"t","\ud835\udd31":"t","\ud835\udd65":"t","\ud835\udd99":"t","\ud835\uddcd":"t","\ud835\ude01":"t","\ud835\ude35":"t","\ud835\ude69":"t","\ud835\ude9d":"t","\u22a4":"T","\u27d9":"T","\ud83d\udf68":"T","\uff34":"T","\ud835\udc13":"T","\ud835\udc47":"T","\ud835\udc7b":"T","\ud835\udcaf":"T","\ud835\udce3":"T","\ud835\udd17":"T","\ud835\udd4b":"T","\ud835\udd7f":"T","\ud835\uddb3":"T","\ud835\udde7":"T","\ud835\ude1b":"T","\ud835\ude4f":"T","\ud835\ude83":"T","\u03a4":"T","\ud835\udebb":"T","\ud835\udef5":"T","\ud835\udf2f":"T","\ud835\udf69":"T","\ud835\udfa3":"T","\u2ca6":"T","\u0422":"T","\u13a2":"T","\ua4d4":"T","\ud81b\udf0a":"T","\ud806\udcbc":"T","\ud800\ude97":"T","\ud800\udeb1":"T","\ud800\udf15":"T","\u01ad":"t\u0314","\u2361":"T\u0308","\u023e":"T\u0338","\u021a":"\u0162","\u01ae":"T\u0328","\u04ac":"T\u0329","\u20ae":"T\u20eb","\u0167":"t\u0335","\u0166":"T\u0335","\u1d75":"t\u0334","\u10a0":"\ua786","\ua728":"T3","\u02a8":"t\u0255","\u2121":"TEL","\ua777":"tf","\u02a6":"ts","\u02a7":"t\u0283","\ua729":"t\u021d","\u03c4":"\u1d1b","\ud835\uded5":"\u1d1b","\ud835\udf0f":"\u1d1b","\ud835\udf49":"\u1d1b","\ud835\udf83":"\u1d1b","\ud835\udfbd":"\u1d1b","\u0442":"\u1d1b","\uab72":"\u1d1b","\u04ad":"\u1d1b\u0329","\u0163":"\u01ab","\u021b":"\u01ab","\u13bf":"\u01ab","\ud835\udc2e":"u","\ud835\udc62":"u","\ud835\udc96":"u","\ud835\udcca":"u","\ud835\udcfe":"u","\ud835\udd32":"u","\ud835\udd66":"u","\ud835\udd9a":"u","\ud835\uddce":"u","\ud835\ude02":"u","\ud835\ude36":"u","\ud835\ude6a":"u","\ud835\ude9e":"u","\ua79f":"u","\u1d1c":"u","\uab4e":"u","\uab52":"u","\u028b":"u","\u03c5":"u","\ud835\uded6":"u","\ud835\udf10":"u","\ud835\udf4a":"u","\ud835\udf84":"u","\ud835\udfbe":"u","\u057d":"u","\ud801\udcf6":"u","\ud806\udcd8":"u","\u222a":"U","\u22c3":"U","\ud835\udc14":"U","\ud835\udc48":"U","\ud835\udc7c":"U","\ud835\udcb0":"U","\ud835\udce4":"U","\ud835\udd18":"U","\ud835\udd4c":"U","\ud835\udd80":"U","\ud835\uddb4":"U","\ud835\udde8":"U","\ud835\ude1c":"U","\ud835\ude50":"U","\ud835\ude84":"U","\u054d":"U","\u1200":"U","\ud801\udcce":"U","\u144c":"U","\ua4f4":"U","\ud81b\udf42":"U","\ud806\udcb8":"U","\u01d4":"\u016d","\u01d3":"\u016c","\u1d7e":"u\u0335","\uab9c":"u\u0335","\u0244":"U\u0335","\u13cc":"U\u0335","\u1458":"U\xb7","\u1467":"U\'","\u1d6b":"ue","\uab63":"uo","\u1e43":"\uab51","\u057a":"\u0270","\u1223":"\u0270","\u2127":"\u01b1","\u162e":"\u01b1","\u1634":"\u01b1","\u1d7f":"\u028a\u0335","\u2228":"v","\u22c1":"v","\uff56":"v","\u2174":"v","\ud835\udc2f":"v","\ud835\udc63":"v","\ud835\udc97":"v","\ud835\udccb":"v","\ud835\udcff":"v","\ud835\udd33":"v","\ud835\udd67":"v","\ud835\udd9b":"v","\ud835\uddcf":"v","\ud835\ude03":"v","\ud835\ude37":"v","\ud835\ude6b":"v","\ud835\ude9f":"v","\u1d20":"v","\u03bd":"v","\ud835\udece":"v","\ud835\udf08":"v","\ud835\udf42":"v","\ud835\udf7c":"v","\ud835\udfb6":"v","\u0475":"v","\u05d8":"v","\ud805\udf06":"v","\uaba9":"v","\ud806\udcc0":"v","\ud834\ude0d":"V","\u0667":"V","\u06f7":"V","\u2164":"V","\ud835\udc15":"V","\ud835\udc49":"V","\ud835\udc7d":"V","\ud835\udcb1":"V","\ud835\udce5":"V","\ud835\udd19":"V","\ud835\udd4d":"V","\ud835\udd81":"V","\ud835\uddb5":"V","\ud835\udde9":"V","\ud835\ude1d":"V","\ud835\ude51":"V","\ud835\ude85":"V","\u0474":"V","\u2d38":"V","\u13d9":"V","\u142f":"V","\ua6df":"V","\ua4e6":"V","\ud81b\udf08":"V","\ud806\udca0":"V","\ud801\udd1d":"V","\ud800\udd97":"V\u0335","\u143b":"V\xb7","\ud83d\udf6c":"VB","\u2175":"vi","\u2176":"vii","\u2177":"viii","\u2165":"Vl","\u2166":"Vll","\u2167":"Vlll","\ud83d\udf08":"V\u1de4","\u1d27":"\u028c","\ud801\udcd8":"\u028c","\u0668":"\u0245","\u06f8":"\u0245","\u039b":"\u0245","\ud835\udeb2":"\u0245","\ud835\udeec":"\u0245","\ud835\udf26":"\u0245","\ud835\udf60":"\u0245","\ud835\udf9a":"\u0245","\u041b":"\u0245","\u2d37":"\u0245","\ud801\udcb0":"\u0245","\u1431":"\u0245","\ua6ce":"\u0245","\ua4e5":"\u0245","\ud81b\udf3d":"\u0245","\ud800\ude8d":"\u0245","\u04c5":"\u0245\u0326","\u143d":"\u0245\xb7","\u026f":"w","\ud835\udc30":"w","\ud835\udc64":"w","\ud835\udc98":"w","\ud835\udccc":"w","\ud835\udd00":"w","\ud835\udd34":"w","\ud835\udd68":"w","\ud835\udd9c":"w","\ud835\uddd0":"w","\ud835\ude04":"w","\ud835\ude38":"w","\ud835\ude6c":"w","\ud835\udea0":"w","\u1d21":"w","\u0461":"w","\u051d":"w","\u0561":"w","\ud805\udf0a":"w","\ud805\udf0e":"w","\ud805\udf0f":"w","\uab83":"w","\ud806\udcef":"W","\ud806\udce6":"W","\ud835\udc16":"W","\ud835\udc4a":"W","\ud835\udc7e":"W","\ud835\udcb2":"W","\ud835\udce6":"W","\ud835\udd1a":"W","\ud835\udd4e":"W","\ud835\udd82":"W","\ud835\uddb6":"W","\ud835\uddea":"W","\ud835\ude1e":"W","\ud835\ude52":"W","\ud835\ude86":"W","\u051c":"W","\u13b3":"W","\u13d4":"W","\ua4ea":"W","\u047d":"w\u0486\u0487","\ud805\udcc5":"w\u0307","\u20a9":"W\u0335","\ua761":"w\u0326","\u1d0d":"\u028d","\u043c":"\u028d","\uab87":"\u028d","\u04ce":"\u028d\u0326","\u166e":"x","\xd7":"x","\u292b":"x","\u292c":"x","\u2a2f":"x","\uff58":"x","\u2179":"x","\ud835\udc31":"x","\ud835\udc65":"x","\ud835\udc99":"x","\ud835\udccd":"x","\ud835\udd01":"x","\ud835\udd35":"x","\ud835\udd69":"x","\ud835\udd9d":"x","\ud835\uddd1":"x","\ud835\ude05":"x","\ud835\ude39":"x","\ud835\ude6d":"x","\ud835\udea1":"x","\u0445":"x","\u1541":"x","\u157d":"x","\u2def":"\u036f","\u166d":"X","\u2573":"X","\ud800\udf22":"X","\ud806\udcec":"X","\uff38":"X","\u2169":"X","\ud835\udc17":"X","\ud835\udc4b":"X","\ud835\udc7f":"X","\ud835\udcb3":"X","\ud835\udce7":"X","\ud835\udd1b":"X","\ud835\udd4f":"X","\ud835\udd83":"X","\ud835\uddb7":"X","\ud835\uddeb":"X","\ud835\ude1f":"X","\ud835\ude53":"X","\ud835\ude87":"X","\ua7b3":"X","\u03a7":"X","\ud835\udebe":"X","\ud835\udef8":"X","\ud835\udf32":"X","\ud835\udf6c":"X","\ud835\udfa6":"X","\u2cac":"X","\u0425":"X","\u2d5d":"X","\u16b7":"X","\ua4eb":"X","\ud800\ude90":"X","\ud800\udeb4":"X","\ud800\udf17":"X","\ud801\udd27":"X","\u2a30":"x\u0307","\u04b2":"X\u0329","\ud800\udd96":"X\u0335","\u217a":"xi","\u217b":"xii","\u216a":"Xl","\u216b":"Xll","\u0263":"y","\u1d8c":"y","\uff59":"y","\ud835\udc32":"y","\ud835\udc66":"y","\ud835\udc9a":"y","\ud835\udcce":"y","\ud835\udd02":"y","\ud835\udd36":"y","\ud835\udd6a":"y","\ud835\udd9e":"y","\ud835\uddd2":"y","\ud835\ude06":"y","\ud835\ude3a":"y","\ud835\ude6e":"y","\ud835\udea2":"y","\u028f":"y","\u1eff":"y","\uab5a":"y","\u03b3":"y","\u213d":"y","\ud835\udec4":"y","\ud835\udefe":"y","\ud835\udf38":"y","\ud835\udf72":"y","\ud835\udfac":"y","\u0443":"y","\u04af":"y","\u10e7":"y","\ud806\udcdc":"y","\uff39":"Y","\ud835\udc18":"Y","\ud835\udc4c":"Y","\ud835\udc80":"Y","\ud835\udcb4":"Y","\ud835\udce8":"Y","\ud835\udd1c":"Y","\ud835\udd50":"Y","\ud835\udd84":"Y","\ud835\uddb8":"Y","\ud835\uddec":"Y","\ud835\ude20":"Y","\ud835\ude54":"Y","\ud835\ude88":"Y","\u03a5":"Y","\u03d2":"Y","\ud835\udebc":"Y","\ud835\udef6":"Y","\ud835\udf30":"Y","\ud835\udf6a":"Y","\ud835\udfa4":"Y","\u2ca8":"Y","\u0423":"Y","\u04ae":"Y","\u13a9":"Y","\u13bd":"Y","\ua4ec":"Y","\ud81b\udf43":"Y","\ud806\udca4":"Y","\ud800\udeb2":"Y","\u01b4":"y\u0314","\u024f":"y\u0335","\u04b1":"y\u0335","\xa5":"Y\u0335","\u024e":"Y\u0335","\u04b0":"Y\u0335","\u0292":"\u021d","\ua76b":"\u021d","\u2ccd":"\u021d","\u04e1":"\u021d","\u10f3":"\u021d","\ud835\udc33":"z","\ud835\udc67":"z","\ud835\udc9b":"z","\ud835\udccf":"z","\ud835\udd03":"z","\ud835\udd37":"z","\ud835\udd6b":"z","\ud835\udd9f":"z","\ud835\uddd3":"z","\ud835\ude07":"z","\ud835\ude3b":"z","\ud835\ude6f":"z","\ud835\udea3":"z","\u1d22":"z","\uab93":"z","\ud806\udcc4":"z","\ud800\udef5":"Z","\ud806\udce5":"Z","\uff3a":"Z","\u2124":"Z","\u2128":"Z","\ud835\udc19":"Z","\ud835\udc4d":"Z","\ud835\udc81":"Z","\ud835\udcb5":"Z","\ud835\udce9":"Z","\ud835\udd85":"Z","\ud835\uddb9":"Z","\ud835\udded":"Z","\ud835\ude21":"Z","\ud835\ude55":"Z","\ud835\ude89":"Z","\u0396":"Z","\ud835\udead":"Z","\ud835\udee7":"Z","\ud835\udf21":"Z","\ud835\udf5b":"Z","\ud835\udf95":"Z","\u13c3":"Z","\ua4dc":"Z","\ud806\udca9":"Z","\u0290":"z\u0328","\u01b6":"z\u0335","\u01b5":"Z\u0335","\u0225":"z\u0326","\u0224":"Z\u0326","\u1d76":"z\u0334","\u01bf":"\xfe","\u03f8":"\xfe","\u03f7":"\xde","\ud801\udcc4":"\xde","\u2079":"\ua770","\u1d24":"\u01a8","\u03e9":"\u01a8","\ua645":"\u01a8","\u044c":"\u0185","\uab9f":"\u0185","\u044b":"\u0185i","\uab7e":"\u0242","\u02e4":"\u02c1","\ua6cd":"\u02a1","\u2299":"\u0298","\u2609":"\u0298","\u2a00":"\u0298","\ua668":"\u0298","\u2d59":"\u0298","\ud801\udcc3":"\u0298","\u213e":"\u0393","\ud835\udeaa":"\u0393","\ud835\udee4":"\u0393","\ud835\udf1e":"\u0393","\ud835\udf58":"\u0393","\ud835\udf92":"\u0393","\u2c84":"\u0393","\u0413":"\u0393","\u13b1":"\u0393","\u14a5":"\u0393","\ud81b\udf07":"\u0393","\u0492":"\u0393\u0335","\u14af":"\u0393\xb7","\u0490":"\u0393\'","\u2206":"\u0394","\u25b3":"\u0394","\ud83d\udf02":"\u0394","\ud835\udeab":"\u0394","\ud835\udee5":"\u0394","\ud835\udf1f":"\u0394","\ud835\udf59":"\u0394","\ud835\udf93":"\u0394","\u2c86":"\u0394","\u2d60":"\u0394","\u1403":"\u0394","\ud81b\udf1a":"\u0394","\ud800\ude85":"\u0394","\ud800\udea3":"\u0394","\u2359":"\u0394\u0332","\u140f":"\u0394\xb7","\u142c":"\u0394\u1420","\ud835\udfcb":"\u03dd","\ud835\udec7":"\u03b6","\ud835\udf01":"\u03b6","\ud835\udf3b":"\u03b6","\ud835\udf75":"\u03b6","\ud835\udfaf":"\u03b6","\u2ce4":"\u03d7","\ud835\udecc":"\u03bb","\ud835\udf06":"\u03bb","\ud835\udf40":"\u03bb","\ud835\udf7a":"\u03bb","\ud835\udfb4":"\u03bb","\u2c96":"\u03bb","\ud801\udcdb":"\u03bb","\xb5":"\u03bc","\ud835\udecd":"\u03bc","\ud835\udf07":"\u03bc","\ud835\udf41":"\u03bc","\ud835\udf7b":"\u03bc","\ud835\udfb5":"\u03bc","\ud835\udecf":"\u03be","\ud835\udf09":"\u03be","\ud835\udf43":"\u03be","\ud835\udf7d":"\u03be","\ud835\udfb7":"\u03be","\ud835\udeb5":"\u039e","\ud835\udeef":"\u039e","\ud835\udf29":"\u039e","\ud835\udf63":"\u039e","\ud835\udf9d":"\u039e","\u03d6":"\u03c0","\u213c":"\u03c0","\ud835\uded1":"\u03c0","\ud835\udee1":"\u03c0","\ud835\udf0b":"\u03c0","\ud835\udf1b":"\u03c0","\ud835\udf45":"\u03c0","\ud835\udf55":"\u03c0","\ud835\udf7f":"\u03c0","\ud835\udf8f":"\u03c0","\ud835\udfb9":"\u03c0","\ud835\udfc9":"\u03c0","\u1d28":"\u03c0","\u043f":"\u03c0","\u220f":"\u03a0","\u213f":"\u03a0","\ud835\udeb7":"\u03a0","\ud835\udef1":"\u03a0","\ud835\udf2b":"\u03a0","\ud835\udf65":"\u03a0","\ud835\udf9f":"\u03a0","\u2ca0":"\u03a0","\u041f":"\u03a0","\ua6db":"\u03a0","\ud800\udead":"\u03d8","\ud800\udf12":"\u03d8","\u03db":"\u03c2","\ud835\uded3":"\u03c2","\ud835\udf0d":"\u03c2","\ud835\udf47":"\u03c2","\ud835\udf81":"\u03c2","\ud835\udfbb":"\u03c2","\ud835\udebd":"\u03a6","\ud835\udef7":"\u03a6","\ud835\udf31":"\u03a6","\ud835\udf6b":"\u03a6","\ud835\udfa5":"\u03a6","\u2caa":"\u03a6","\u0424":"\u03a6","\u0553":"\u03a6","\u1240":"\u03a6","\u16f0":"\u03a6","\ud800\udeb3":"\u03a6","\uab53":"\u03c7","\uab55":"\u03c7","\ud835\uded8":"\u03c7","\ud835\udf12":"\u03c7","\ud835\udf4c":"\u03c7","\ud835\udf86":"\u03c7","\ud835\udfc0":"\u03c7","\u2cad":"\u03c7","\ud835\uded9":"\u03c8","\ud835\udf13":"\u03c8","\ud835\udf4d":"\u03c8","\ud835\udf87":"\u03c8","\ud835\udfc1":"\u03c8","\u0471":"\u03c8","\ud801\udcf9":"\u03c8","\ud835\udebf":"\u03a8","\ud835\udef9":"\u03a8","\ud835\udf33":"\u03a8","\ud835\udf6d":"\u03a8","\ud835\udfa7":"\u03a8","\u2cae":"\u03a8","\u0470":"\u03a8","\ud801\udcd1":"\u03a8","\u16d8":"\u03a8","\ud800\udeb5":"\u03a8","\u2375":"\u03c9","\ua7b7":"\u03c9","\ud835\udeda":"\u03c9","\ud835\udf14":"\u03c9","\ud835\udf4e":"\u03c9","\ud835\udf88":"\u03c9","\ud835\udfc2":"\u03c9","\u2cb1":"\u03c9","\ua64d":"\u03c9","\u2126":"\u03a9","\ud835\udec0":"\u03a9","\ud835\udefa":"\u03a9","\ud835\udf34":"\u03a9","\ud835\udf6e":"\u03a9","\ud835\udfa8":"\u03a9","\u162f":"\u03a9","\u1635":"\u03a9","\ud800\udeb6":"\u03a9","\u2379":"\u03c9\u0332","\u1f7d":"\u1ff4","\u2630":"\u2cb6","\u2cdc":"\u03ec","\u0497":"\u0436\u0329","\u0496":"\u0416\u0329","\ud834\ude0b":"\u0418","\u0376":"\u0418","\ua6a1":"\u0418","\ud801\udc25":"\u0418","\u0419":"\u040d","\u048a":"\u040d\u0326","\u045d":"\u0439","\u048b":"\u0439\u0326","\ud801\udcbc":"\u04c3","\u1d2b":"\u043b","\u04c6":"\u043b\u0326","\uab60":"\u0459","\ud801\udceb":"\ua669","\u1dee":"\u2dec","\ud801\udccd":"\u040b","\ud834\ude02":"\u04fe","\ud834\ude22":"\u0460","\u13c7":"\u0460","\u15ef":"\u0460","\u047c":"\u0460\u0486\u0487","\u18ed":"\u0460\xb7","\ua7b6":"\ua64c","\u04cc":"\u04b7","\u04cb":"\u04b6","\u04be":"\u04bc\u0328","\u2cbd":"\u0448","\u2cbc":"\u0428","\ua650":"\u042al","\u2108":"\u042d","\ud83d\udf01":"\ua658","\ud81b\udf1c":"\ua658","\ua992":"\u2c3f","\u0587":"\u0565\u0582","\u1294":"\u0571","\ufb14":"\u0574\u0565","\ufb15":"\u0574\u056b","\ufb17":"\u0574\u056d","\ufb13":"\u0574\u0576","\u2229":"\u0548","\u22c2":"\u0548","\ud834\ude45":"\u0548","\u1260":"\u0548","\u144e":"\u0548","\ua4f5":"\u0548","\u145a":"\u0548\xb7","\u1468":"\u0548\'","\ufb16":"\u057e\u0576","\u20bd":"\u0554","\u02d3":"\u0559","\u02bf":"\u0559","\u2135":"\u05d0","\ufb21":"\u05d0","\ufb2f":"\ufb2e","\ufb30":"\ufb2e","\ufb4f":"\u05d0\u05dc","\u2136":"\u05d1","\u2137":"\u05d2","\u2138":"\u05d3","\ufb22":"\u05d3","\ufb23":"\u05d4","\ufb39":"\ufb1d","\ufb24":"\u05db","\ufb25":"\u05dc","\ufb26":"\u05dd","\ufb20":"\u05e2","\ufb27":"\u05e8","\ufb2b":"\ufb2a","\ufb49":"\ufb2a","\ufb2d":"\ufb2c","\ufb28":"\u05ea","\ufe80":"\u0621","\u06fd":"\u0621\u0348","\ufe82":"\u0622","\ufe81":"\u0622","\ufb51":"\u0671","\ufb50":"\u0671","\ud83b\ude01":"\u0628","\ud83b\ude21":"\u0628","\ud83b\ude61":"\u0628","\ud83b\ude81":"\u0628","\ud83b\udea1":"\u0628","\ufe91":"\u0628","\ufe92":"\u0628","\ufe90":"\u0628","\ufe8f":"\u0628","\u0751":"\u0628\u06db","\u08b6":"\u0628\u06e2","\u08a1":"\u0628\u0654","\ufca0":"\u0628o","\ufce2":"\u0628o","\ufc9c":"\u0628\u062c","\ufc05":"\u0628\u062c","\ufc9d":"\u0628\u062d","\ufc06":"\u0628\u062d","\ufdc2":"\u0628\u062d\u0649","\ufc9e":"\u0628\u062e","\ufc07":"\u0628\u062e","\ufcd2":"\u0628\u062e","\ufc4b":"\u0628\u062e","\ufd9e":"\u0628\u062e\u0649","\ufc6a":"\u0628\u0631","\ufc6b":"\u0628\u0632","\ufc9f":"\u0628\u0645","\ufce1":"\u0628\u0645","\ufc6c":"\u0628\u0645","\ufc08":"\u0628\u0645","\ufc6d":"\u0628\u0646","\ufc6e":"\u0628\u0649","\ufc09":"\u0628\u0649","\ufc6f":"\u0628\u0649","\ufc0a":"\u0628\u0649","\ufb54":"\u067b","\ufb55":"\u067b","\ufb53":"\u067b","\ufb52":"\u067b","\u06d0":"\u067b","\ufbe6":"\u067b","\ufbe7":"\u067b","\ufbe5":"\u067b","\ufbe4":"\u067b","\ufb5c":"\u0680","\ufb5d":"\u0680","\ufb5b":"\u0680","\ufb5a":"\u0680","\u08a9":"\u0754","\u0767":"\u0754","\u2365":"\u0629","\xf6":"\u0629","\ufe94":"\u0629","\ufe93":"\u0629","\u06c3":"\u0629","\ud83b\ude15":"\u062a","\ud83b\ude35":"\u062a","\ud83b\ude75":"\u062a","\ud83b\ude95":"\u062a","\ud83b\udeb5":"\u062a","\ufe97":"\u062a","\ufe98":"\u062a","\ufe96":"\u062a","\ufe95":"\u062a","\ufca5":"\u062ao","\ufce4":"\u062ao","\ufca1":"\u062a\u062c","\ufc0b":"\u062a\u062c","\ufd50":"\u062a\u062c\u0645","\ufda0":"\u062a\u062c\u0649","\ufd9f":"\u062a\u062c\u0649","\ufca2":"\u062a\u062d","\ufc0c":"\u062a\u062d","\ufd52":"\u062a\u062d\u062c","\ufd51":"\u062a\u062d\u062c","\ufd53":"\u062a\u062d\u0645","\ufca3":"\u062a\u062e","\ufc0d":"\u062a\u062e","\ufd54":"\u062a\u062e\u0645","\ufda2":"\u062a\u062e\u0649","\ufda1":"\u062a\u062e\u0649","\ufc70":"\u062a\u0631","\ufc71":"\u062a\u0632","\ufca4":"\u062a\u0645","\ufce3":"\u062a\u0645","\ufc72":"\u062a\u0645","\ufc0e":"\u062a\u0645","\ufd55":"\u062a\u0645\u062c","\ufd56":"\u062a\u0645\u062d","\ufd57":"\u062a\u0645\u062e","\ufda4":"\u062a\u0645\u0649","\ufda3":"\u062a\u0645\u0649","\ufc73":"\u062a\u0646","\ufc74":"\u062a\u0649","\ufc0f":"\u062a\u0649","\ufc75":"\u062a\u0649","\ufc10":"\u062a\u0649","\ufb60":"\u067a","\ufb61":"\u067a","\ufb5f":"\u067a","\ufb5e":"\u067a","\ufb64":"\u067f","\ufb65":"\u067f","\ufb63":"\u067f","\ufb62":"\u067f","\ud83b\ude02":"\u062c","\ud83b\ude22":"\u062c","\ud83b\ude42":"\u062c","\ud83b\ude62":"\u062c","\ud83b\ude82":"\u062c","\ud83b\udea2":"\u062c","\ufe9f":"\u062c","\ufea0":"\u062c","\ufe9e":"\u062c","\ufe9d":"\u062c","\ufca7":"\u062c\u062d","\ufc15":"\u062c\u062d","\ufda6":"\u062c\u062d\u0649","\ufdbe":"\u062c\u062d\u0649","\ufdfb":"\u062c\u0644 \u062c\u0644l\u0644o","\ufca8":"\u062c\u0645","\ufc16":"\u062c\u0645","\ufd59":"\u062c\u0645\u062d","\ufd58":"\u062c\u0645\u062d","\ufda7":"\u062c\u0645\u0649","\ufda5":"\u062c\u0645\u0649","\ufd1d":"\u062c\u0649","\ufd01":"\u062c\u0649","\ufd1e":"\u062c\u0649","\ufd02":"\u062c\u0649","\ufb78":"\u0683","\ufb79":"\u0683","\ufb77":"\u0683","\ufb76":"\u0683","\ufb74":"\u0684","\ufb75":"\u0684","\ufb73":"\u0684","\ufb72":"\u0684","\ufb7c":"\u0686","\ufb7d":"\u0686","\ufb7b":"\u0686","\ufb7a":"\u0686","\ufb80":"\u0687","\ufb81":"\u0687","\ufb7f":"\u0687","\ufb7e":"\u0687","\ud83b\ude07":"\u062d","\ud83b\ude27":"\u062d","\ud83b\ude47":"\u062d","\ud83b\ude67":"\u062d","\ud83b\ude87":"\u062d","\ud83b\udea7":"\u062d","\ufea3":"\u062d","\ufea4":"\u062d","\ufea2":"\u062d","\ufea1":"\u062d","\u0685":"\u062d\u06db","\u0681":"\u062d\u0654","\u0772":"\u062d\u0654","\ufca9":"\u062d\u062c","\ufc17":"\u062d\u062c","\ufdbf":"\u062d\u062c\u0649","\ufcaa":"\u062d\u0645","\ufc18":"\u062d\u0645","\ufd5b":"\u062d\u0645\u0649","\ufd5a":"\u062d\u0645\u0649","\ufd1b":"\u062d\u0649","\ufcff":"\u062d\u0649","\ufd1c":"\u062d\u0649","\ufd00":"\u062d\u0649","\ud83b\ude17":"\u062e","\ud83b\ude37":"\u062e","\ud83b\ude57":"\u062e","\ud83b\ude77":"\u062e","\ud83b\ude97":"\u062e","\ud83b\udeb7":"\u062e","\ufea7":"\u062e","\ufea8":"\u062e","\ufea6":"\u062e","\ufea5":"\u062e","\ufcab":"\u062e\u062c","\ufc19":"\u062e\u062c","\ufc1a":"\u062e\u062d","\ufcac":"\u062e\u0645","\ufc1b":"\u062e\u0645","\ufd1f":"\u062e\u0649","\ufd03":"\u062e\u0649","\ufd20":"\u062e\u0649","\ufd04":"\u062e\u0649","\ud800\udee1":"\u062f","\ud83b\ude03":"\u062f","\ud83b\ude83":"\u062f","\ud83b\udea3":"\u062f","\ufeaa":"\u062f","\ufea9":"\u062f","\u0688":"\u062f\u0615","\ufb89":"\u062f\u0615","\ufb88":"\u062f\u0615","\u068e":"\u062f\u06db","\ufb87":"\u062f\u06db","\ufb86":"\u062f\u06db","\u06ee":"\u062f\u0302","\u08ae":"\u062f\u0324\u0323","\ud83b\ude18":"\u0630","\ud83b\ude98":"\u0630","\ud83b\udeb8":"\u0630","\ufeac":"\u0630","\ufeab":"\u0630","\ufc5b":"\u0630\u0670","\u068b":"\u068a\u0615","\ufb85":"\u068c","\ufb84":"\u068c","\ufb83":"\u068d","\ufb82":"\u068d","\ud83b\ude13":"\u0631","\ud83b\ude93":"\u0631","\ud83b\udeb3":"\u0631","\ufeae":"\u0631","\ufead":"\u0631","\u0691":"\u0631\u0615","\ufb8d":"\u0631\u0615","\ufb8c":"\u0631\u0615","\u0698":"\u0631\u06db","\ufb8b":"\u0631\u06db","\ufb8a":"\u0631\u06db","\u0692":"\u0631\u0306","\u08b9":"\u0631\u0306\u0307","\u06ef":"\u0631\u0302","\u076c":"\u0631\u0654","\ufc5c":"\u0631\u0670","\ufdf6":"\u0631\u0633\u0648\u0644","\ufdfc":"\u0631\u0649l\u0644","\ud83b\ude06":"\u0632","\ud83b\ude86":"\u0632","\ud83b\udea6":"\u0632","\ufeb0":"\u0632","\ufeaf":"\u0632","\u08b2":"\u0632\u0302","\u0771":"\u0697\u0615","\ud83b\ude0e":"\u0633","\ud83b\ude2e":"\u0633","\ud83b\ude4e":"\u0633","\ud83b\ude6e":"\u0633","\ud83b\ude8e":"\u0633","\ud83b\udeae":"\u0633","\ufeb3":"\u0633","\ufeb4":"\u0633","\ufeb2":"\u0633","\ufeb1":"\u0633","\u0634":"\u0633\u06db","\ud83b\ude14":"\u0633\u06db","\ud83b\ude34":"\u0633\u06db","\ud83b\ude54":"\u0633\u06db","\ud83b\ude74":"\u0633\u06db","\ud83b\ude94":"\u0633\u06db","\ud83b\udeb4":"\u0633\u06db","\ufeb7":"\u0633\u06db","\ufeb8":"\u0633\u06db","\ufeb6":"\u0633\u06db","\ufeb5":"\u0633\u06db","\u077e":"\u0633\u0302","\ufd31":"\u0633o","\ufce8":"\u0633o","\ufd32":"\u0633\u06dbo","\ufcea":"\u0633\u06dbo","\ufcad":"\u0633\u062c","\ufd34":"\u0633\u062c","\ufc1c":"\u0633\u062c","\ufd2d":"\u0633\u06db\u062c","\ufd37":"\u0633\u06db\u062c","\ufd25":"\u0633\u06db\u062c","\ufd09":"\u0633\u06db\u062c","\ufd5d":"\u0633\u062c\u062d","\ufd5e":"\u0633\u062c\u0649","\ufd69":"\u0633\u06db\u062c\u0649","\ufcae":"\u0633\u062d","\ufd35":"\u0633\u062d","\ufc1d":"\u0633\u062d","\ufd2e":"\u0633\u06db\u062d","\ufd38":"\u0633\u06db\u062d","\ufd26":"\u0633\u06db\u062d","\ufd0a":"\u0633\u06db\u062d","\ufd5c":"\u0633\u062d\u062c","\ufd68":"\u0633\u06db\u062d\u0645","\ufd67":"\u0633\u06db\u062d\u0645","\ufdaa":"\u0633\u06db\u062d\u0649","\ufcaf":"\u0633\u062e","\ufd36":"\u0633\u062e","\ufc1e":"\u0633\u062e","\ufd2f":"\u0633\u06db\u062e","\ufd39":"\u0633\u06db\u062e","\ufd27":"\u0633\u06db\u062e","\ufd0b":"\u0633\u06db\u062e","\ufda8":"\u0633\u062e\u0649","\ufdc6":"\u0633\u062e\u0649","\ufd2a":"\u0633\u0631","\ufd0e":"\u0633\u0631","\ufd29":"\u0633\u06db\u0631","\ufd0d":"\u0633\u06db\u0631","\ufcb0":"\u0633\u0645","\ufce7":"\u0633\u0645","\ufc1f":"\u0633\u0645","\ufd30":"\u0633\u06db\u0645","\ufce9":"\u0633\u06db\u0645","\ufd28":"\u0633\u06db\u0645","\ufd0c":"\u0633\u06db\u0645","\ufd61":"\u0633\u0645\u062c","\ufd60":"\u0633\u0645\u062d","\ufd5f":"\u0633\u0645\u062d","\ufd6b":"\u0633\u06db\u0645\u062e","\ufd6a":"\u0633\u06db\u0645\u062e","\ufd63":"\u0633\u0645\u0645","\ufd62":"\u0633\u0645\u0645","\ufd6d":"\u0633\u06db\u0645\u0645","\ufd6c":"\u0633\u06db\u0645\u0645","\ufd17":"\u0633\u0649","\ufcfb":"\u0633\u0649","\ufd18":"\u0633\u0649","\ufcfc":"\u0633\u0649","\ufd19":"\u0633\u06db\u0649","\ufcfd":"\u0633\u06db\u0649","\ufd1a":"\u0633\u06db\u0649","\ufcfe":"\u0633\u06db\u0649","\ud800\udef2":"\u0635","\ud83b\ude11":"\u0635","\ud83b\ude31":"\u0635","\ud83b\ude51":"\u0635","\ud83b\ude71":"\u0635","\ud83b\ude91":"\u0635","\ud83b\udeb1":"\u0635","\ufebb":"\u0635","\ufebc":"\u0635","\ufeba":"\u0635","\ufeb9":"\u0635","\u069e":"\u0635\u06db","\u08af":"\u0635\u0324\u0323","\ufcb1":"\u0635\u062d","\ufc20":"\u0635\u062d","\ufd65":"\u0635\u062d\u062d","\ufd64":"\u0635\u062d\u062d","\ufda9":"\u0635\u062d\u0649","\ufcb2":"\u0635\u062e","\ufd2b":"\u0635\u0631","\ufd0f":"\u0635\u0631","\ufdf5":"\u0635\u0644\u0639\u0645","\ufdf9":"\u0635\u0644\u0649","\ufdf0":"\u0635\u0644\u0649","\ufdfa":"\u0635\u0644\u0649 l\u0644\u0644o \u0639\u0644\u0649o \u0648\u0633\u0644\u0645","\ufcb3":"\u0635\u0645","\ufc21":"\u0635\u0645","\ufdc5":"\u0635\u0645\u0645","\ufd66":"\u0635\u0645\u0645","\ufd21":"\u0635\u0649","\ufd05":"\u0635\u0649","\ufd22":"\u0635\u0649","\ufd06":"\u0635\u0649","\ud83b\ude19":"\u0636","\ud83b\ude39":"\u0636","\ud83b\ude59":"\u0636","\ud83b\ude79":"\u0636","\ud83b\ude99":"\u0636","\ud83b\udeb9":"\u0636","\ufebf":"\u0636","\ufec0":"\u0636","\ufebe":"\u0636","\ufebd":"\u0636","\ufcb4":"\u0636\u062c","\ufc22":"\u0636\u062c","\ufcb5":"\u0636\u062d","\ufc23":"\u0636\u062d","\ufd6e":"\u0636\u062d\u0649","\ufdab":"\u0636\u062d\u0649","\ufcb6":"\u0636\u062e","\ufc24":"\u0636\u062e","\ufd70":"\u0636\u062e\u0645","\ufd6f":"\u0636\u062e\u0645","\ufd2c":"\u0636\u0631","\ufd10":"\u0636\u0631","\ufcb7":"\u0636\u0645","\ufc25":"\u0636\u0645","\ufd23":"\u0636\u0649","\ufd07":"\u0636\u0649","\ufd24":"\u0636\u0649","\ufd08":"\u0636\u0649","\ud800\udee8":"\u0637","\ud83b\ude08":"\u0637","\ud83b\ude68":"\u0637","\ud83b\ude88":"\u0637","\ud83b\udea8":"\u0637","\ufec3":"\u0637","\ufec4":"\u0637","\ufec2":"\u0637","\ufec1":"\u0637","\u069f":"\u0637\u06db","\ufcb8":"\u0637\u062d","\ufc26":"\u0637\u062d","\ufd33":"\u0637\u0645","\ufd3a":"\u0637\u0645","\ufc27":"\u0637\u0645","\ufd72":"\u0637\u0645\u062d","\ufd71":"\u0637\u0645\u062d","\ufd73":"\u0637\u0645\u0645","\ufd74":"\u0637\u0645\u0649","\ufd11":"\u0637\u0649","\ufcf5":"\u0637\u0649","\ufd12":"\u0637\u0649","\ufcf6":"\u0637\u0649","\ud83b\ude1a":"\u0638","\ud83b\ude7a":"\u0638","\ud83b\ude9a":"\u0638","\ud83b\udeba":"\u0638","\ufec7":"\u0638","\ufec8":"\u0638","\ufec6":"\u0638","\ufec5":"\u0638","\ufcb9":"\u0638\u0645","\ufd3b":"\u0638\u0645","\ufc28":"\u0638\u0645","\u060f":"\u0639","\ud83b\ude0f":"\u0639","\ud83b\ude2f":"\u0639","\ud83b\ude4f":"\u0639","\ud83b\ude6f":"\u0639","\ud83b\ude8f":"\u0639","\ud83b\udeaf":"\u0639","\ufecb":"\u0639","\ufecc":"\u0639","\ufeca":"\u0639","\ufec9":"\u0639","\ufcba":"\u0639\u062c","\ufc29":"\u0639\u062c","\ufdc4":"\u0639\u062c\u0645","\ufd75":"\u0639\u062c\u0645","\ufdf7":"\u0639\u0644\u0649o","\ufcbb":"\u0639\u0645","\ufc2a":"\u0639\u0645","\ufd77":"\u0639\u0645\u0645","\ufd76":"\u0639\u0645\u0645","\ufd78":"\u0639\u0645\u0649","\ufdb6":"\u0639\u0645\u0649","\ufd13":"\u0639\u0649","\ufcf7":"\u0639\u0649","\ufd14":"\u0639\u0649","\ufcf8":"\u0639\u0649","\ud83b\ude1b":"\u063a","\ud83b\ude3b":"\u063a","\ud83b\ude5b":"\u063a","\ud83b\ude7b":"\u063a","\ud83b\ude9b":"\u063a","\ud83b\udebb":"\u063a","\ufecf":"\u063a","\ufed0":"\u063a","\ufece":"\u063a","\ufecd":"\u063a","\ufcbc":"\u063a\u062c","\ufc2b":"\u063a\u062c","\ufcbd":"\u063a\u0645","\ufc2c":"\u063a\u0645","\ufd79":"\u063a\u0645\u0645","\ufd7b":"\u063a\u0645\u0649","\ufd7a":"\u063a\u0645\u0649","\ufd15":"\u063a\u0649","\ufcf9":"\u063a\u0649","\ufd16":"\u063a\u0649","\ufcfa":"\u063a\u0649","\ud83b\ude10":"\u0641","\ud83b\ude30":"\u0641","\ud83b\ude70":"\u0641","\ud83b\ude90":"\u0641","\ud83b\udeb0":"\u0641","\ufed3":"\u0641","\ufed4":"\u0641","\ufed2":"\u0641","\ufed1":"\u0641","\u06a7":"\u0641","\ufcbe":"\u0641\u062c","\ufc2d":"\u0641\u062c","\ufcbf":"\u0641\u062d","\ufc2e":"\u0641\u062d","\ufcc0":"\u0641\u062e","\ufc2f":"\u0641\u062e","\ufd7d":"\u0641\u062e\u0645","\ufd7c":"\u0641\u062e\u0645","\ufcc1":"\u0641\u0645","\ufc30":"\u0641\u0645","\ufdc1":"\u0641\u0645\u0649","\ufc7c":"\u0641\u0649","\ufc31":"\u0641\u0649","\ufc7d":"\u0641\u0649","\ufc32":"\u0641\u0649","\ud83b\ude1e":"\u06a1","\ud83b\ude7e":"\u06a1","\u08bb":"\u06a1","\u066f":"\u06a1","\ud83b\ude1f":"\u06a1","\ud83b\ude5f":"\u06a1","\u08bc":"\u06a1","\u06a4":"\u06a1\u06db","\ufb6c":"\u06a1\u06db","\ufb6d":"\u06a1\u06db","\ufb6b":"\u06a1\u06db","\ufb6a":"\u06a1\u06db","\u06a8":"\u06a1\u06db","\u08a4":"\u06a2\u06db","\ufb70":"\u06a6","\ufb71":"\u06a6","\ufb6f":"\u06a6","\ufb6e":"\u06a6","\ud83b\ude12":"\u0642","\ud83b\ude32":"\u0642","\ud83b\ude52":"\u0642","\ud83b\ude72":"\u0642","\ud83b\ude92":"\u0642","\ud83b\udeb2":"\u0642","\ufed7":"\u0642","\ufed8":"\u0642","\ufed6":"\u0642","\ufed5":"\u0642","\ufcc2":"\u0642\u062d","\ufc33":"\u0642\u062d","\ufdf1":"\u0642\u0644\u0649","\ufcc3":"\u0642\u0645","\ufc34":"\u0642\u0645","\ufdb4":"\u0642\u0645\u062d","\ufd7e":"\u0642\u0645\u062d","\ufd7f":"\u0642\u0645\u0645","\ufdb2":"\u0642\u0645\u0649","\ufc7e":"\u0642\u0649","\ufc35":"\u0642\u0649","\ufc7f":"\u0642\u0649","\ufc36":"\u0642\u0649","\ud83b\ude0a":"\u0643","\ud83b\ude2a":"\u0643","\ud83b\ude6a":"\u0643","\ufedb":"\u0643","\ufedc":"\u0643","\ufeda":"\u0643","\ufed9":"\u0643","\u06a9":"\u0643","\ufb90":"\u0643","\ufb91":"\u0643","\ufb8f":"\u0643","\ufb8e":"\u0643","\u06aa":"\u0643","\u06ad":"\u0643\u06db","\ufbd5":"\u0643\u06db","\ufbd6":"\u0643\u06db","\ufbd4":"\u0643\u06db","\ufbd3":"\u0643\u06db","\u0763":"\u0643\u06db","\ufc80":"\u0643l","\ufc37":"\u0643l","\ufcc4":"\u0643\u062c","\ufc38":"\u0643\u062c","\ufcc5":"\u0643\u062d","\ufc39":"\u0643\u062d","\ufcc6":"\u0643\u062e","\ufc3a":"\u0643\u062e","\ufcc7":"\u0643\u0644","\ufceb":"\u0643\u0644","\ufc81":"\u0643\u0644","\ufc3b":"\u0643\u0644","\ufcc8":"\u0643\u0645","\ufcec":"\u0643\u0645","\ufc82":"\u0643\u0645","\ufc3c":"\u0643\u0645","\ufdc3":"\u0643\u0645\u0645","\ufdbb":"\u0643\u0645\u0645","\ufdb7":"\u0643\u0645\u0649","\ufc83":"\u0643\u0649","\ufc3d":"\u0643\u0649","\ufc84":"\u0643\u0649","\ufc3e":"\u0643\u0649","\u0762":"\u06ac","\ufb94":"\u06af","\ufb95":"\u06af","\ufb93":"\u06af","\ufb92":"\u06af","\u08b0":"\u06af","\u06b4":"\u06af\u06db","\ufb9c":"\u06b1","\ufb9d":"\u06b1","\ufb9b":"\u06b1","\ufb9a":"\u06b1","\ufb98":"\u06b3","\ufb99":"\u06b3","\ufb97":"\u06b3","\ufb96":"\u06b3","\ud83b\ude0b":"\u0644","\ud83b\ude2b":"\u0644","\ud83b\ude4b":"\u0644","\ud83b\ude8b":"\u0644","\ud83b\udeab":"\u0644","\ufedf":"\u0644","\ufee0":"\u0644","\ufede":"\u0644","\ufedd":"\u0644","\u06b7":"\u0644\u06db","\u06b5":"\u0644\u0306","\ufefc":"\u0644l","\ufefb":"\u0644l","\ufefa":"\u0644l\u0655","\ufef9":"\u0644l\u0655","\ufef8":"\u0644l\u0674","\ufef7":"\u0644l\u0674","\ufccd":"\u0644o","\ufef6":"\u0644\u0622","\ufef5":"\u0644\u0622","\ufcc9":"\u0644\u062c","\ufc3f":"\u0644\u062c","\ufd83":"\u0644\u062c\u062c","\ufd84":"\u0644\u062c\u062c","\ufdba":"\u0644\u062c\u0645","\ufdbc":"\u0644\u062c\u0645","\ufdac":"\u0644\u062c\u0649","\ufcca":"\u0644\u062d","\ufc40":"\u0644\u062d","\ufdb5":"\u0644\u062d\u0645","\ufd80":"\u0644\u062d\u0645","\ufd82":"\u0644\u062d\u0649","\ufd81":"\u0644\u062d\u0649","\ufccb":"\u0644\u062e","\ufc41":"\u0644\u062e","\ufd86":"\u0644\u062e\u0645","\ufd85":"\u0644\u062e\u0645","\ufccc":"\u0644\u0645","\ufced":"\u0644\u0645","\ufc85":"\u0644\u0645","\ufc42":"\u0644\u0645","\ufd88":"\u0644\u0645\u062d","\ufd87":"\u0644\u0645\u062d","\ufdad":"\u0644\u0645\u0649","\ufc86":"\u0644\u0649","\ufc43":"\u0644\u0649","\ufc87":"\u0644\u0649","\ufc44":"\u0644\u0649","\ud83b\ude0c":"\u0645","\ud83b\ude2c":"\u0645","\ud83b\ude6c":"\u0645","\ud83b\ude8c":"\u0645","\ud83b\udeac":"\u0645","\ufee3":"\u0645","\ufee4":"\u0645","\ufee2":"\u0645","\ufee1":"\u0645","\u08a7":"\u0645\u06db","\u06fe":"\u0645\u0348","\ufc88":"\u0645l","\ufcce":"\u0645\u062c","\ufc45":"\u0645\u062c","\ufd8c":"\u0645\u062c\u062d","\ufd92":"\u0645\u062c\u062e","\ufd8d":"\u0645\u062c\u0645","\ufdc0":"\u0645\u062c\u0649","\ufccf":"\u0645\u062d","\ufc46":"\u0645\u062d","\ufd89":"\u0645\u062d\u062c","\ufd8a":"\u0645\u062d\u0645","\ufdf4":"\u0645\u062d\u0645\u062f","\ufd8b":"\u0645\u062d\u0649","\ufcd0":"\u0645\u062e","\ufc47":"\u0645\u062e","\ufd8e":"\u0645\u062e\u062c","\ufd8f":"\u0645\u062e\u0645","\ufdb9":"\u0645\u062e\u0649","\ufcd1":"\u0645\u0645","\ufc89":"\u0645\u0645","\ufc48":"\u0645\u0645","\ufdb1":"\u0645\u0645\u0649","\ufc49":"\u0645\u0649","\ufc4a":"\u0645\u0649","\ud83b\ude0d":"\u0646","\ud83b\ude2d":"\u0646","\ud83b\ude4d":"\u0646","\ud83b\ude6d":"\u0646","\ud83b\ude8d":"\u0646","\ud83b\udead":"\u0646","\ufee7":"\u0646","\ufee8":"\u0646","\ufee6":"\u0646","\ufee5":"\u0646","\u0768":"\u0646\u0615","\u0769":"\u0646\u0306","\ufcd6":"\u0646o","\ufcef":"\u0646o","\ufdb8":"\u0646\u062c\u062d","\ufdbd":"\u0646\u062c\u062d","\ufd98":"\u0646\u062c\u0645","\ufd97":"\u0646\u062c\u0645","\ufd99":"\u0646\u062c\u0649","\ufdc7":"\u0646\u062c\u0649","\ufcd3":"\u0646\u062d","\ufc4c":"\u0646\u062d","\ufd95":"\u0646\u062d\u0645","\ufd96":"\u0646\u062d\u0649","\ufdb3":"\u0646\u062d\u0649","\ufcd4":"\u0646\u062e","\ufc4d":"\u0646\u062e","\ufc8a":"\u0646\u0631","\ufc8b":"\u0646\u0632","\ufcd5":"\u0646\u0645","\ufcee":"\u0646\u0645","\ufc8c":"\u0646\u0645","\ufc4e":"\u0646\u0645","\ufd9b":"\u0646\u0645\u0649","\ufd9a":"\u0646\u0645\u0649","\ufc8d":"\u0646\u0646","\ufc8e":"\u0646\u0649","\ufc4f":"\u0646\u0649","\ufc8f":"\u0646\u0649","\ufc50":"\u0646\u0649","\u06c2":"\u06c0","\ufba5":"\u06c0","\ufba4":"\u06c0","\ud800\udee4":"\u0648","\ud83b\ude05":"\u0648","\ud83b\ude85":"\u0648","\ud83b\udea5":"\u0648","\ufeee":"\u0648","\ufeed":"\u0648","\u08b1":"\u0648","\u06cb":"\u0648\u06db","\ufbdf":"\u0648\u06db","\ufbde":"\u0648\u06db","\u06c7":"\u0648\u0313","\ufbd8":"\u0648\u0313","\ufbd7":"\u0648\u0313","\u06c6":"\u0648\u0306","\ufbda":"\u0648\u0306","\ufbd9":"\u0648\u0306","\u06c9":"\u0648\u0302","\ufbe3":"\u0648\u0302","\ufbe2":"\u0648\u0302","\u06c8":"\u0648\u0670","\ufbdc":"\u0648\u0670","\ufbdb":"\u0648\u0670","\u0624":"\u0648\u0674","\ufe86":"\u0648\u0674","\ufe85":"\u0648\u0674","\u0676":"\u0648\u0674","\u0677":"\u0648\u0313\u0674","\ufbdd":"\u0648\u0313\u0674","\ufdf8":"\u0648\u0633\u0644\u0645","\ufbe1":"\u06c5","\ufbe0":"\u06c5","\u066e":"\u0649","\ud83b\ude1c":"\u0649","\ud83b\ude7c":"\u0649","\u06ba":"\u0649","\ud83b\ude1d":"\u0649","\ud83b\ude5d":"\u0649","\ufb9f":"\u0649","\ufb9e":"\u0649","\u08bd":"\u0649","\ufbe8":"\u0649","\ufbe9":"\u0649","\ufef0":"\u0649","\ufeef":"\u0649","\u064a":"\u0649","\ud83b\ude09":"\u0649","\ud83b\ude29":"\u0649","\ud83b\ude49":"\u0649","\ud83b\ude69":"\u0649","\ud83b\ude89":"\u0649","\ud83b\udea9":"\u0649","\ufef3":"\u0649","\ufef4":"\u0649","\ufef2":"\u0649","\ufef1":"\u0649","\u06cc":"\u0649","\ufbfe":"\u0649","\ufbff":"\u0649","\ufbfd":"\u0649","\ufbfc":"\u0649","\u06d2":"\u0649","\ufbaf":"\u0649","\ufbae":"\u0649","\u0679":"\u0649\u0615","\ufb68":"\u0649\u0615","\ufb69":"\u0649\u0615","\ufb67":"\u0649\u0615","\ufb66":"\u0649\u0615","\u06bb":"\u0649\u0615","\ufba2":"\u0649\u0615","\ufba3":"\u0649\u0615","\ufba1":"\u0649\u0615","\ufba0":"\u0649\u0615","\u067e":"\u0649\u06db","\ufb58":"\u0649\u06db","\ufb59":"\u0649\u06db","\ufb57":"\u0649\u06db","\ufb56":"\u0649\u06db","\u062b":"\u0649\u06db","\ud83b\ude16":"\u0649\u06db","\ud83b\ude36":"\u0649\u06db","\ud83b\ude76":"\u0649\u06db","\ud83b\ude96":"\u0649\u06db","\ud83b\udeb6":"\u0649\u06db","\ufe9b":"\u0649\u06db","\ufe9c":"\u0649\u06db","\ufe9a":"\u0649\u06db","\ufe99":"\u0649\u06db","\u06bd":"\u0649\u06db","\u06d1":"\u0649\u06db","\u063f":"\u0649\u06db","\u08b7":"\u0649\u06db\u06e2","\u0756":"\u0649\u0306","\u06ce":"\u0649\u0306","\u08ba":"\u0649\u0306\u0307","\u063d":"\u0649\u0302","\u08a8":"\u0649\u0654","\ufc90":"\u0649\u0670","\ufc5d":"\u0649\u0670","\ufcde":"\u0649o","\ufcf1":"\u0649o","\ufce6":"\u0649\u06dbo","\u0626":"\u0649\u0674","\ufe8b":"\u0649\u0674","\ufe8c":"\u0649\u0674","\ufe8a":"\u0649\u0674","\ufe89":"\u0649\u0674","\u0678":"\u0649\u0674","\ufbeb":"\u0649\u0674l","\ufbea":"\u0649\u0674l","\ufc9b":"\u0649\u0674o","\ufce0":"\u0649\u0674o","\ufbed":"\u0649\u0674o","\ufbec":"\u0649\u0674o","\ufbf8":"\u0649\u0674\u067b","\ufbf7":"\u0649\u0674\u067b","\ufbf6":"\u0649\u0674\u067b","\ufc97":"\u0649\u0674\u062c","\ufc00":"\u0649\u0674\u062c","\ufc98":"\u0649\u0674\u062d","\ufc01":"\u0649\u0674\u062d","\ufc99":"\u0649\u0674\u062e","\ufc64":"\u0649\u0674\u0631","\ufc65":"\u0649\u0674\u0632","\ufc9a":"\u0649\u0674\u0645","\ufcdf":"\u0649\u0674\u0645","\ufc66":"\u0649\u0674\u0645","\ufc02":"\u0649\u0674\u0645","\ufc67":"\u0649\u0674\u0646","\ufbef":"\u0649\u0674\u0648","\ufbee":"\u0649\u0674\u0648","\ufbf1":"\u0649\u0674\u0648\u0313","\ufbf0":"\u0649\u0674\u0648\u0313","\ufbf3":"\u0649\u0674\u0648\u0306","\ufbf2":"\u0649\u0674\u0648\u0306","\ufbf5":"\u0649\u0674\u0648\u0670","\ufbf4":"\u0649\u0674\u0648\u0670","\ufbfb":"\u0649\u0674\u0649","\ufbfa":"\u0649\u0674\u0649","\ufc68":"\u0649\u0674\u0649","\ufbf9":"\u0649\u0674\u0649","\ufc03":"\u0649\u0674\u0649","\ufc69":"\u0649\u0674\u0649","\ufc04":"\u0649\u0674\u0649","\ufcda":"\u0649\u062c","\ufc55":"\u0649\u062c","\ufc11":"\u0649\u06db\u062c","\ufdaf":"\u0649\u062c\u0649","\ufcdb":"\u0649\u062d","\ufc56":"\u0649\u062d","\ufdae":"\u0649\u062d\u0649","\ufcdc":"\u0649\u062e","\ufc57":"\u0649\u062e","\ufc91":"\u0649\u0631","\ufc76":"\u0649\u06db\u0631","\ufc92":"\u0649\u0632","\ufc77":"\u0649\u06db\u0632","\ufcdd":"\u0649\u0645","\ufcf0":"\u0649\u0645","\ufc93":"\u0649\u0645","\ufc58":"\u0649\u0645","\ufca6":"\u0649\u06db\u0645","\ufce5":"\u0649\u06db\u0645","\ufc78":"\u0649\u06db\u0645","\ufc12":"\u0649\u06db\u0645","\ufd9d":"\u0649\u0645\u0645","\ufd9c":"\u0649\u0645\u0645","\ufdb0":"\u0649\u0645\u0649","\ufc94":"\u0649\u0646","\ufc79":"\u0649\u06db\u0646","\ufc95":"\u0649\u0649","\ufc59":"\u0649\u0649","\ufc96":"\u0649\u0649","\ufc5a":"\u0649\u0649","\ufc7a":"\u0649\u06db\u0649","\ufc13":"\u0649\u06db\u0649","\ufc7b":"\u0649\u06db\u0649","\ufc14":"\u0649\u06db\u0649","\ufbb1":"\u06d3","\ufbb0":"\u06d3","\ud800\udeb8":"\u2d40","\u205e":"\u2d42","\u2e3d":"\u2d42","\u2999":"\u2d42","\ufe19":"\u2d57","\u205d":"\u2d57","\u22ee":"\u2d57","\u0544":"\u1206","\u054c":"\u1261","\u053b":"\u12ae","\u054a":"\u1323","\u0906":"\u0905\u093e","\u0912":"\u0905\u093e\u0946","\u0913":"\u0905\u093e\u0947","\u0914":"\u0905\u093e\u0948","\u0904":"\u0905\u0946","\u0911":"\u0905\u0949","\u090d":"\u090f\u0945","\u090e":"\u090f\u0946","\u0910":"\u090f\u0947","\u0908":"\u0930\u094d\u0907","\u0abd":"\u093d","\ud804\udddc":"\ua8fb","\ud804\uddcb":"\u093a","\u0ac1":"\u0941","\u0ac2":"\u0942","\u0a4b":"\u0946","\u0a4d":"\u094d","\u0acd":"\u094d","\u0986":"\u0985\u09be","\u09e0":"\u098b\u09c3","\u09e1":"\u098b\u09c3","\ud805\udc92":"\u0998","\ud805\udc94":"\u099a","\ud805\udc96":"\u099c","\ud805\udc98":"\u099e","\ud805\udc99":"\u099f","\ud805\udc9b":"\u09a1","\ud805\udcaa":"\u09a3","\ud805\udc9e":"\u09a4","\ud805\udc9f":"\u09a5","\ud805\udca0":"\u09a6","\ud805\udca1":"\u09a7","\ud805\udca2":"\u09a8","\ud805\udca3":"\u09aa","\ud805\udca9":"\u09ac","\ud805\udca7":"\u09ae","\ud805\udca8":"\u09af","\ud805\udcab":"\u09b0","\ud805\udc9d":"\u09b2","\ud805\udcad":"\u09b7","\ud805\udcae":"\u09b8","\ud805\udcc4":"\u09bd","\ud805\udcb0":"\u09be","\ud805\udcb1":"\u09bf","\ud805\udcb9":"\u09c7","\ud805\udcbc":"\u09cb","\ud805\udcbe":"\u09cc","\ud805\udcc2":"\u09cd","\ud805\udcbd":"\u09d7","\u0a09":"\u0a73\u0a41","\u0a0a":"\u0a73\u0a42","\u0a06":"\u0a05\u0a3e","\u0a10":"\u0a05\u0a48","\u0a14":"\u0a05\u0a4c","\u0a07":"\u0a72\u0a3f","\u0a08":"\u0a72\u0a40","\u0a0f":"\u0a72\u0a47","\u0a86":"\u0a85\u0abe","\u0a91":"\u0a85\u0abe\u0ac5","\u0a93":"\u0a85\u0abe\u0ac7","\u0a94":"\u0a85\u0abe\u0ac8","\u0a8d":"\u0a85\u0ac5","\u0a8f":"\u0a85\u0ac7","\u0a90":"\u0a85\u0ac8","\u0b06":"\u0b05\u0b3e","\u0bee":"\u0b85","\u0bb0":"\u0b88","\u0bbe":"\u0b88","\u0beb":"\u0b88\u0bc1","\u0be8":"\u0b89","\u0d09":"\u0b89","\u0b8a":"\u0b89\u0bb3","\u0d0a":"\u0b89\u0d57","\u0bed":"\u0b8e","\u0bf7":"\u0b8e\u0bb5","\u0b9c":"\u0b90","\u0d1c":"\u0b90","\u0be7":"\u0b95","\u0bea":"\u0b9a","\u0bec":"\u0b9a\u0bc1","\u0bf2":"\u0b9a\u0bc2","\u0d3a":"\u0b9f\u0bbf","\u0d23":"\u0ba3","\u0bfa":"\u0ba8\u0bc0","\u0bf4":"\u0bae\u0bc0","\u0bf0":"\u0baf","\u0d34":"\u0bb4","\u0bd7":"\u0bb3","\u0bc8":"\u0ba9","\u0d36":"\u0bb6","\u0bf8":"\u0bb7","\u0d3f":"\u0bbf","\u0d40":"\u0bbf","\u0bca":"\u0bc6\u0b88","\u0bcc":"\u0bc6\u0bb3","\u0bcb":"\u0bc7\u0b88","\u0c85":"\u0c05","\u0c86":"\u0c06","\u0c87":"\u0c07","\u0c60":"\u0c0b\u0c3e","\u0c61":"\u0c0c\u0c3e","\u0c92":"\u0c12","\u0c14":"\u0c12\u0c4c","\u0c94":"\u0c12\u0c4c","\u0c13":"\u0c12\u0c55","\u0c93":"\u0c12\u0c55","\u0c9c":"\u0c1c","\u0c9e":"\u0c1e","\u0c22":"\u0c21\u0323","\u0ca3":"\u0c23","\u0c25":"\u0c27\u05bc","\u0c2d":"\u0c2c\u0323","\u0caf":"\u0c2f","\u0c20":"\u0c30\u05bc","\u0cb1":"\u0c31","\u0cb2":"\u0c32","\u0c37":"\u0c35\u0323","\u0c39":"\u0c35\u0c3e","\u0c2e":"\u0c35\u0c41","\u0c42":"\u0c41\u0c3e","\u0c44":"\u0c43\u0c3e","\u0ce1":"\u0c8c\u0cbe","\u0d08":"\u0d07\u0d57","\u0d10":"\u0d0e\u0d46","\u0d13":"\u0d12\u0d3e","\u0d14":"\u0d12\u0d57","\u0d61":"\u0d1e","\u0d6b":"\u0d26\u0d4d\u0d30","\u0d79":"\u0d28\u0d41","\u0d0c":"\u0d28\u0d41","\u0d19":"\u0d28\u0d41","\u0d6f":"\u0d28\u0d4d","\u0d7b":"\u0d28\u0d4d","\u0d6c":"\u0d28\u0d4d\u0d28","\u0d5a":"\u0d28\u0d4d\u0d2e","\u0d31":"\u0d30","\u0d6a":"\u0d30\u0d4d","\u0d7c":"\u0d30\u0d4d","\u0d6e":"\u0d35\u0d4d\u0d30","\u0d76":"\u0d39\u0d4d\u0d2e","\u0d42":"\u0d41","\u0d43":"\u0d41","\u0d48":"\u0d46\u0d46","\u0dea":"\u0da2","\u0deb":"\u0daf","\ud805\udc13":"\ud805\udc34\ud805\udc42\ud805\udc12","\ud805\udc19":"\ud805\udc34\ud805\udc42\ud805\udc18","\ud805\udc24":"\ud805\udc34\ud805\udc42\ud805\udc23","\ud805\udc2a":"\ud805\udc34\ud805\udc42\ud805\udc29","\ud805\udc2d":"\ud805\udc34\ud805\udc42\ud805\udc2c","\ud805\udc2f":"\ud805\udc34\ud805\udc42\ud805\udc2e","\ud805\uddd8":"\ud805\udd82","\ud805\uddd9":"\ud805\udd82","\ud805\uddda":"\ud805\udd83","\ud805\udddb":"\ud805\udd84","\ud805\udddc":"\ud805\uddb2","\ud805\udddd":"\ud805\uddb3","\u0e03":"\u0e02","\u0e14":"\u0e04","\u0e15":"\u0e04","\u0e21":"\u0e06","\u0e88":"\u0e08","\u0e0b":"\u0e0a","\u0e0f":"\u0e0e","\u0e17":"\u0e11","\u0e9a":"\u0e1a","\u0e9b":"\u0e1b","\u0e9d":"\u0e1d","\u0e9e":"\u0e1e","\u0e9f":"\u0e1f","\u0e26":"\u0e20","\u0e8d":"\u0e22","\u17d4":"\u0e2f","\u0e45":"\u0e32","\u0e33":"\u030a\u0e32","\u17b7":"\u0e34","\u17b8":"\u0e35","\u17b9":"\u0e36","\u17ba":"\u0e37","\u0eb8":"\u0e38","\u0eb9":"\u0e39","\u0e41":"\u0e40\u0e40","\u0edc":"\u0eab\u0e99","\u0edd":"\u0eab\u0ea1","\u0eb3":"\u030a\u0eb2","\u0f02":"\u0f60\u0f74\u0f82\u0f7f","\u0f03":"\u0f60\u0f74\u0f82\u0f14","\u0f6a":"\u0f62","\u0f00":"\u0f68\u0f7c\u0f7e","\u0f77":"\u0fb2\u0f71\u0f80","\u0f79":"\u0fb3\u0f71\u0f80","\ud807\udcb2":"\ud807\udcaa","\u1081":"\u1002\u103e","\u1000":"\u1002\u102c","\u1070":"\u1003\u103e","\u1066":"\u1015\u103e","\u101f":"\u1015\u102c","\u106f":"\u1015\u102c\u103e","\u107e":"\u107d\u103e","\u1029":"\u101e\u103c","\u102a":"\u101e\u103c\u1031\u102c\u103a","\u109e":"\u1083\u030a","\u17a3":"\u17a2","\u19d0":"\u199e","\u19d1":"\u19b1","\u1a80":"\u1a45","\u1a90":"\u1a45","\uaa53":"\uaa01","\uaa56":"\uaa23","\u1b52":"\u1b0d","\u1b53":"\u1b11","\u1b58":"\u1b28","\ua9a3":"\ua99d","\u1896":"\u185c","\u1855":"\u1835","\u1ff6":"\u13ef","\u140d":"\u1401\xb7","\u142b":"\u1401\u1420","\u1411":"\u1404\xb7","\u1413":"\u1405\xb7","\u142d":"\u1405\u1420","\u1415":"\u1406\xb7","\u1418":"\u140a\xb7","\u142e":"\u140a\u1420","\u141a":"\u140b\xb7","\u18dd":"\u141e\u18df","\u14d1":"\u1421","\u1540":"\u1429","\u143f":"\u1432\xb7","\u1443":"\u1434\xb7","\u2369":"\u1435","\u1447":"\u1439\xb7","\u145c":"\u144f\xb7","\u2e27":"\u1450","\u2283":"\u1450","\u145e":"\u1450\xb7","\u1469":"\u1450\'","\u27c9":"\u1450/","\u2ad7":"\u1450\u1455","\u1460":"\u1451\xb7","\u2e26":"\u1455","\u2282":"\u1455","\u1462":"\u1455\xb7","\u146a":"\u1455\'","\u1464":"\u1456\xb7","\u1475":"\u146b\xb7","\u1485":"\u146b\'","\u1479":"\u146e\xb7","\u147d":"\u1470\xb7","\u1603":"\u1489","\u1493":"\u1489\xb7","\u1495":"\u148b\xb7","\u1497":"\u148c\xb7","\u149b":"\u148e\xb7","\u1602":"\u1490","\u149d":"\u1490\xb7","\u149f":"\u1491\xb7","\u14ad":"\u14a3\xb7","\u14b1":"\u14a6\xb7","\u14b3":"\u14a7\xb7","\u14b5":"\u14a8\xb7","\u14b9":"\u14ab\xb7","\u14ca":"\u14c0\xb7","\u18c7":"\u14c2\xb7","\u18c9":"\u14c3\xb7","\u18cb":"\u14c4\xb7","\u18cd":"\u14c5\xb7","\u14cc":"\u14c7\xb7","\u14ce":"\u14c8\xb7","\u1604":"\u14d3","\u14dd":"\u14d3\xb7","\u14df":"\u14d5\xb7","\u14e1":"\u14d6\xb7","\u14e3":"\u14d7\xb7","\u14e5":"\u14d8\xb7","\u1607":"\u14da","\u14e7":"\u14da\xb7","\u14e9":"\u14db\xb7","\u14f7":"\u14ed\xb7","\u14f9":"\u14ef\xb7","\u14fb":"\u14f0\xb7","\u14fd":"\u14f1\xb7","\u14ff":"\u14f2\xb7","\u1501":"\u14f4\xb7","\u1503":"\u14f5\xb7","\u150c":"\u150b<","\u150e":"\u150bb","\u150d":"\u150b\u1455","\u150f":"\u150b\u1490","\u1518":"\u1510\xb7","\u151a":"\u1511\xb7","\u151c":"\u1512\xb7","\u151e":"\u1513\xb7","\u1520":"\u1514\xb7","\u1522":"\u1515\xb7","\u1524":"\u1516\xb7","\u1532":"\u1528\xb7","\u1534":"\u1529\xb7","\u1536":"\u152a\xb7","\u1538":"\u152b\xb7","\u153a":"\u152d\xb7","\u153c":"\u152e\xb7","\u1622":"\u1543","\u18e0":"\u1543\xb7","\u1623":"\u1546","\u1624":"\u154a","\u154f":"\u154c\xb7","\u1583":"\u1550b","\u1584":"\u1550b\u0307","\u1581":"\u1550d","\u157f":"\u1550P","\u166f":"\u1550\u146b","\u157e":"\u1550\u146c","\u1580":"\u1550\u146e","\u1582":"\u1550\u1470","\u1585":"\u1550\u1483","\u155c":"\u155a\xb7","\u18e3":"\u155e\xb7","\u18e4":"\u1566\xb7","\u1569":"\u1567\xb7","\u18e5":"\u156b\xb7","\u18e8":"\u1586\xb7","\u1591":"\u1595J","\u1670":"\u1595\u1489","\u158e":"\u1595\u148a","\u158f":"\u1595\u148b","\u1590":"\u1595\u148c","\u1592":"\u1595\u148e","\u1593":"\u1595\u1490","\u1594":"\u1595\u1491","\u1673":"\u1596J","\u1671":"\u1596\u148b","\u1672":"\u1596\u148c","\u1674":"\u1596\u148e","\u1675":"\u1596\u1490","\u1676":"\u1596\u1491","\u18ea":"\u1597\xb7","\u1677":"\u15a7\xb7","\u1678":"\u15a8\xb7","\u1679":"\u15a9\xb7","\u167a":"\u15aa\xb7","\u167b":"\u15ab\xb7","\u167c":"\u15ac\xb7","\u167d":"\u15ad\xb7","\u2aab":"\u15d2","\u2aaa":"\u15d5","\ua4f7":"\u15e1","\u18f0":"\u15f4\xb7","\u18f2":"\u161b\xb7","\u1dbb":"\u1646","\ua4ed":"\u1660","\u1dba":"\u18d4","\u1d3e":"\u18d6","\u18dc":"\u18df\u141e","\u02e1":"\u18f3","\u02b3":"\u18f4","\u02e2":"\u18f5","\u18db":"\u18f5","\ua6b0":"\u16b9","\u16e1":"\u16bc","\u237f":"\u16bd","\u16c2":"\u16bd","\ud834\ude3f":"\u16cb","\u2191":"\u16cf","\u21bf":"\u16d0","\u296e":"\u16d0\u21c2","\u2963":"\u16d0\u16da","\u2d63":"\u16ef","\u21be":"\u16da","\u2a21":"\u16da","\u22c4":"\u16dc","\u25c7":"\u16dc","\u25ca":"\u16dc","\u2662":"\u16dc","\ud83d\udf54":"\u16dc","\ud806\udcb7":"\u16dc","\ud800\ude94":"\u16dc","\u235a":"\u16dc\u0332","\u22c8":"\u16de","\u2a1d":"\u16de","\ud801\udcd0":"\u16e6","\u2195":"\u16e8","\ud803\udcfc":"\ud803\udc82","\ud803\udcfa":"\ud803\udca5","\u3131":"\u1100","\u11a8":"\u1100","\u1101":"\u1100\u1100","\u3132":"\u1100\u1100","\u11a9":"\u1100\u1100","\u11fa":"\u1100\u1102","\u115a":"\u1100\u1103","\u11c3":"\u1100\u1105","\u11fb":"\u1100\u1107","\u11aa":"\u1100\u1109","\u3133":"\u1100\u1109","\u11c4":"\u1100\u1109\u1100","\u11fc":"\u1100\u110e","\u11fd":"\u1100\u110f","\u11fe":"\u1100\u1112","\u3134":"\u1102","\u11ab":"\u1102","\u1113":"\u1102\u1100","\u11c5":"\u1102\u1100","\u1114":"\u1102\u1102","\u3165":"\u1102\u1102","\u11ff":"\u1102\u1102","\u1115":"\u1102\u1103","\u3166":"\u1102\u1103","\u11c6":"\u1102\u1103","\ud7cb":"\u1102\u1105","\u1116":"\u1102\u1107","\u115b":"\u1102\u1109","\u11c7":"\u1102\u1109","\u3167":"\u1102\u1109","\u115c":"\u1102\u110c","\u11ac":"\u1102\u110c","\u3135":"\u1102\u110c","\ud7cc":"\u1102\u110e","\u11c9":"\u1102\u1110","\u115d":"\u1102\u1112","\u11ad":"\u1102\u1112","\u3136":"\u1102\u1112","\u11c8":"\u1102\u1140","\u3168":"\u1102\u1140","\u3137":"\u1103","\u11ae":"\u1103","\u1117":"\u1103\u1100","\u11ca":"\u1103\u1100","\u1104":"\u1103\u1103","\u3138":"\u1103\u1103","\ud7cd":"\u1103\u1103","\ud7ce":"\u1103\u1103\u1107","\u115e":"\u1103\u1105","\u11cb":"\u1103\u1105","\ua960":"\u1103\u1106","\ua961":"\u1103\u1107","\ud7cf":"\u1103\u1107","\ua962":"\u1103\u1109","\ud7d0":"\u1103\u1109","\ud7d1":"\u1103\u1109\u1100","\ua963":"\u1103\u110c","\ud7d2":"\u1103\u110c","\ud7d3":"\u1103\u110e","\ud7d4":"\u1103\u1110","\u3139":"\u1105","\u11af":"\u1105","\ua964":"\u1105\u1100","\u11b0":"\u1105\u1100","\u313a":"\u1105\u1100","\ua965":"\u1105\u1100\u1100","\ud7d5":"\u1105\u1100\u1100","\u11cc":"\u1105\u1100\u1109","\u3169":"\u1105\u1100\u1109","\ud7d6":"\u1105\u1100\u1112","\u1118":"\u1105\u1102","\u11cd":"\u1105\u1102","\ua966":"\u1105\u1103","\u11ce":"\u1105\u1103","\u316a":"\u1105\u1103","\ua967":"\u1105\u1103\u1103","\u11cf":"\u1105\u1103\u1112","\u1119":"\u1105\u1105","\u11d0":"\u1105\u1105","\ud7d7":"\u1105\u1105\u110f","\ua968":"\u1105\u1106","\u11b1":"\u1105\u1106","\u313b":"\u1105\u1106","\u11d1":"\u1105\u1106\u1100","\u11d2":"\u1105\u1106\u1109","\ud7d8":"\u1105\u1106\u1112","\ua969":"\u1105\u1107","\u11b2":"\u1105\u1107","\u313c":"\u1105\u1107","\ud7d9":"\u1105\u1107\u1103","\ua96a":"\u1105\u1107\u1107","\u11d3":"\u1105\u1107\u1109","\u316b":"\u1105\u1107\u1109","\ua96b":"\u1105\u1107\u110b","\u11d5":"\u1105\u1107\u110b","\ud7da":"\u1105\u1107\u1111","\u11d4":"\u1105\u1107\u1112","\ua96c":"\u1105\u1109","\u11b3":"\u1105\u1109","\u313d":"\u1105\u1109","\u11d6":"\u1105\u1109\u1109","\u111b":"\u1105\u110b","\ud7dd":"\u1105\u110b","\ua96d":"\u1105\u110c","\ua96e":"\u1105\u110f","\u11d8":"\u1105\u110f","\u11b4":"\u1105\u1110","\u313e":"\u1105\u1110","\u11b5":"\u1105\u1111","\u313f":"\u1105\u1111","\u111a":"\u1105\u1112","\u3140":"\u1105\u1112","\u113b":"\u1105\u1112","\u11b6":"\u1105\u1112","\ud7f2":"\u1105\u1112","\u11d7":"\u1105\u1140","\u316c":"\u1105\u1140","\ud7db":"\u1105\u114c","\u11d9":"\u1105\u1159","\u316d":"\u1105\u1159","\ud7dc":"\u1105\u1159\u1112","\u3141":"\u1106","\u11b7":"\u1106","\ua96f":"\u1106\u1100","\u11da":"\u1106\u1100","\ud7de":"\u1106\u1102","\ud7df":"\u1106\u1102\u1102","\ua970":"\u1106\u1103","\u11db":"\u1106\u1105","\ud7e0":"\u1106\u1106","\u111c":"\u1106\u1107","\u316e":"\u1106\u1107","\u11dc":"\u1106\u1107","\ud7e1":"\u1106\u1107\u1109","\ua971":"\u1106\u1109","\u11dd":"\u1106\u1109","\u316f":"\u1106\u1109","\u11de":"\u1106\u1109\u1109","\u111d":"\u1106\u110b","\u3171":"\u1106\u110b","\u11e2":"\u1106\u110b","\ud7e2":"\u1106\u110c","\u11e0":"\u1106\u110e","\u11e1":"\u1106\u1112","\u11df":"\u1106\u1140","\u3170":"\u1106\u1140","\u3142":"\u1107","\u11b8":"\u1107","\u111e":"\u1107\u1100","\u3172":"\u1107\u1100","\u111f":"\u1107\u1102","\u1120":"\u1107\u1103","\u3173":"\u1107\u1103","\ud7e3":"\u1107\u1103","\u11e3":"\u1107\u1105","\ud7e4":"\u1107\u1105\u1111","\ud7e5":"\u1107\u1106","\u1108":"\u1107\u1107","\u3143":"\u1107\u1107","\ud7e6":"\u1107\u1107","\u112c":"\u1107\u1107\u110b","\u3179":"\u1107\u1107\u110b","\u1121":"\u1107\u1109","\u3144":"\u1107\u1109","\u11b9":"\u1107\u1109","\u1122":"\u1107\u1109\u1100","\u3174":"\u1107\u1109\u1100","\u1123":"\u1107\u1109\u1103","\u3175":"\u1107\u1109\u1103","\ud7e7":"\u1107\u1109\u1103","\u1124":"\u1107\u1109\u1107","\u1125":"\u1107\u1109\u1109","\u1126":"\u1107\u1109\u110c","\ua972":"\u1107\u1109\u1110","\u112b":"\u1107\u110b","\u3178":"\u1107\u110b","\u11e6":"\u1107\u110b","\u1127":"\u1107\u110c","\u3176":"\u1107\u110c","\ud7e8":"\u1107\u110c","\u1128":"\u1107\u110e","\ud7e9":"\u1107\u110e","\ua973":"\u1107\u110f","\u1129":"\u1107\u1110","\u3177":"\u1107\u1110","\u112a":"\u1107\u1111","\u11e4":"\u1107\u1111","\ua974":"\u1107\u1112","\u11e5":"\u1107\u1112","\u3145":"\u1109","\u11ba":"\u1109","\u112d":"\u1109\u1100","\u317a":"\u1109\u1100","\u11e7":"\u1109\u1100","\u112e":"\u1109\u1102","\u317b":"\u1109\u1102","\u112f":"\u1109\u1103","\u317c":"\u1109\u1103","\u11e8":"\u1109\u1103","\u1130":"\u1109\u1105","\u11e9":"\u1109\u1105","\u1131":"\u1109\u1106","\ud7ea":"\u1109\u1106","\u1132":"\u1109\u1107","\u317d":"\u1109\u1107","\u11ea":"\u1109\u1107","\u1133":"\u1109\u1107\u1100","\ud7eb":"\u1109\u1107\u110b","\u110a":"\u1109\u1109","\u3146":"\u1109\u1109","\u11bb":"\u1109\u1109","\ud7ec":"\u1109\u1109\u1100","\ud7ed":"\u1109\u1109\u1103","\ua975":"\u1109\u1109\u1107","\u1134":"\u1109\u1109\u1109","\u1135":"\u1109\u110b","\u1136":"\u1109\u110c","\u317e":"\u1109\u110c","\ud7ef":"\u1109\u110c","\u1137":"\u1109\u110e","\ud7f0":"\u1109\u110e","\u1138":"\u1109\u110f","\u1139":"\u1109\u1110","\ud7f1":"\u1109\u1110","\u113a":"\u1109\u1111","\ud7ee":"\u1109\u1140","\u3147":"\u110b","\u11bc":"\u110b","\u1141":"\u110b\u1100","\u11ec":"\u110b\u1100","\u11ed":"\u110b\u1100\u1100","\u1142":"\u110b\u1103","\ua976":"\u110b\u1105","\u1143":"\u110b\u1106","\u1144":"\u110b\u1107","\u1145":"\u110b\u1109","\u11f1":"\u110b\u1109","\u3182":"\u110b\u1109","\u1147":"\u110b\u110b","\u3180":"\u110b\u110b","\u11ee":"\u110b\u110b","\u1148":"\u110b\u110c","\u1149":"\u110b\u110e","\u11ef":"\u110b\u110f","\u114a":"\u110b\u1110","\u114b":"\u110b\u1111","\ua977":"\u110b\u1112","\u1146":"\u110b\u1140","\u11f2":"\u110b\u1140","\u3183":"\u110b\u1140","\u3148":"\u110c","\u11bd":"\u110c","\ud7f7":"\u110c\u1107","\ud7f8":"\u110c\u1107\u1107","\u114d":"\u110c\u110b","\u110d":"\u110c\u110c","\u3149":"\u110c\u110c","\ud7f9":"\u110c\u110c","\ua978":"\u110c\u110c\u1112","\u314a":"\u110e","\u11be":"\u110e","\u1152":"\u110e\u110f","\u1153":"\u110e\u1112","\u314b":"\u110f","\u11bf":"\u110f","\u314c":"\u1110","\u11c0":"\u1110","\ua979":"\u1110\u1110","\u314d":"\u1111","\u11c1":"\u1111","\u1156":"\u1111\u1107","\u11f3":"\u1111\u1107","\ud7fa":"\u1111\u1109","\u1157":"\u1111\u110b","\u3184":"\u1111\u110b","\u11f4":"\u1111\u110b","\ud7fb":"\u1111\u1110","\ua97a":"\u1111\u1112","\u314e":"\u1112","\u11c2":"\u1112","\u11f5":"\u1112\u1102","\u11f6":"\u1112\u1105","\u11f7":"\u1112\u1106","\u11f8":"\u1112\u1107","\ua97b":"\u1112\u1109","\u1158":"\u1112\u1112","\u3185":"\u1112\u1112","\u113d":"\u113c\u113c","\u113f":"\u113e\u113e","\u317f":"\u1140","\u11eb":"\u1140","\ud7f3":"\u1140\u1107","\ud7f4":"\u1140\u1107\u110b","\u3181":"\u114c","\u11f0":"\u114c","\ud7f5":"\u114c\u1106","\ud7f6":"\u114c\u1112","\u114f":"\u114e\u114e","\u1151":"\u1150\u1150","\u3186":"\u1159","\u11f9":"\u1159","\ua97c":"\u1159\u1159","\u3164":"\u1160","\u314f":"\u1161","\u11a3":"\u1161\u30fc","\u1176":"\u1161\u1169","\u1177":"\u1161\u116e","\u1162":"\u1161\u4e28","\u3150":"\u1161\u4e28","\u3151":"\u1163","\u1178":"\u1163\u1169","\u1179":"\u1163\u116d","\u11a4":"\u1163\u116e","\u1164":"\u1163\u4e28","\u3152":"\u1163\u4e28","\u3153":"\u1165","\u117c":"\u1165\u30fc","\u117a":"\u1165\u1169","\u117b":"\u1165\u116e","\u1166":"\u1165\u4e28","\u3154":"\u1165\u4e28","\u3155":"\u1167","\u11a5":"\u1167\u1163","\u117d":"\u1167\u1169","\u117e":"\u1167\u116e","\u1168":"\u1167\u4e28","\u3156":"\u1167\u4e28","\u3157":"\u1169","\u116a":"\u1169\u1161","\u3158":"\u1169\u1161","\u116b":"\u1169\u1161\u4e28","\u3159":"\u1169\u1161\u4e28","\u11a6":"\u1169\u1163","\u11a7":"\u1169\u1163\u4e28","\u117f":"\u1169\u1165","\u1180":"\u1169\u1165\u4e28","\ud7b0":"\u1169\u1167","\u1181":"\u1169\u1167\u4e28","\u1182":"\u1169\u1169","\ud7b1":"\u1169\u1169\u4e28","\u1183":"\u1169\u116e","\u116c":"\u1169\u4e28","\u315a":"\u1169\u4e28","\u315b":"\u116d","\ud7b2":"\u116d\u1161","\ud7b3":"\u116d\u1161\u4e28","\u1184":"\u116d\u1163","\u3187":"\u116d\u1163","\u1186":"\u116d\u1163","\u1185":"\u116d\u1163\u4e28","\u3188":"\u116d\u1163\u4e28","\ud7b4":"\u116d\u1165","\u1187":"\u116d\u1169","\u1188":"\u116d\u4e28","\u3189":"\u116d\u4e28","\u315c":"\u116e","\u1189":"\u116e\u1161","\u118a":"\u116e\u1161\u4e28","\u116f":"\u116e\u1165","\u315d":"\u116e\u1165","\u118b":"\u116e\u1165\u30fc","\u1170":"\u116e\u1165\u4e28","\u315e":"\u116e\u1165\u4e28","\ud7b5":"\u116e\u1167","\u118c":"\u116e\u1167\u4e28","\u118d":"\u116e\u116e","\u1171":"\u116e\u4e28","\u315f":"\u116e\u4e28","\ud7b6":"\u116e\u4e28\u4e28","\u3160":"\u1172","\u118e":"\u1172\u1161","\ud7b7":"\u1172\u1161\u4e28","\u118f":"\u1172\u1165","\u1190":"\u1172\u1165\u4e28","\u1191":"\u1172\u1167","\u318a":"\u1172\u1167","\u1192":"\u1172\u1167\u4e28","\u318b":"\u1172\u1167\u4e28","\ud7b8":"\u1172\u1169","\u1193":"\u1172\u116e","\u1194":"\u1172\u4e28","\u318c":"\u1172\u4e28","\u318d":"\u119e","\ud7c5":"\u119e\u1161","\u119f":"\u119e\u1165","\ud7c6":"\u119e\u1165\u4e28","\u11a0":"\u119e\u116e","\u11a2":"\u119e\u119e","\u11a1":"\u119e\u4e28","\u318e":"\u119e\u4e28","\u30d8":"\u3078","\u2341":"\u303c","\u29c4":"\u303c","\ua49e":"\ua04a","\ua4ac":"\ua050","\ua49c":"\ua0c0","\ua4a8":"\ua132","\ua4bf":"\ua259","\ua4be":"\ua2b1","\ua494":"\ua2cd","\ua4c0":"\ua3ab","\ua4c2":"\ua3b5","\ua4ba":"\ua3bf","\ua4b0":"\ua3c2","\ua4a7":"\ua458","\u22a5":"\ua4d5","\u27c2":"\ua4d5","\ud834\ude1c":"\ua4d5","\ua7b1":"\ua4d5","\ua79e":"\ua4e4","\u2141":"\ua4e8","\u2142":"\ua4f6","\ud834\ude15":"\ua4f6","\ud834\ude2b":"\ua4f6","\ud81b\udf26":"\ua4f6","\ud801\udc11":"\ua4f6","\u2143":"\ud81b\udf00","\ud806\udee6":"\ud806\udee5\ud806\udeef","\ud806\udee8":"\ud806\udee5\ud806\udee5","\ud806\udee9":"\ud806\udee5\ud806\udee5\ud806\udeef","\ud806\udeea":"\ud806\udee5\ud806\udee5\ud806\udef0","\ud806\udee7":"\ud806\udee5\ud806\udef0","\ud806\udef4":"\ud806\udef3\ud806\udeef","\ud806\udef6":"\ud806\udef3\ud806\udef3","\ud806\udef7":"\ud806\udef3\ud806\udef3\ud806\udeef","\ud806\udef8":"\ud806\udef3\ud806\udef3\ud806\udef0","\ud806\udef5":"\ud806\udef3\ud806\udef0","\ud806\udeec":"\ud806\udeeb\ud806\udeef","\ud806\udeed":"\ud806\udeeb\ud806\udeeb","\ud806\udeee":"\ud806\udeeb\ud806\udeeb\ud806\udeef","\u2295":"\ud800\udea8","\u2a01":"\ud800\udea8","\ud83d\udf28":"\ud800\udea8","\ua69a":"\ud800\udea8","\u25bd":"\ud800\udebc","\ud834\ude14":"\ud800\udebc","\ud83d\udf04":"\ud800\udebc","\u29d6":"\ud800\udec0","\ua79b":"\ud801\udc3a","\ua79a":"\ud801\udc12","\ud801\udca0":"\ud801\udc86","\ud800\udfd1":"\ud800\udf82","\ud800\udfd3":"\ud800\udf93","\ud808\udc38":"\ud800\udf9a","\u2625":"\ud802\udd9e","\ud80c\udef9":"\ud802\udd9e","\u3039":"\u5344","\uf967":"\u4e0d","\ud87e\udc00":"\u4e3d","\ufa70":"\u4e26","\u239c":"\u4e28","\u239f":"\u4e28","\u23a2":"\u4e28","\u23a5":"\u4e28","\u23aa":"\u4e28","\u23ae":"\u4e28","\u31d1":"\u4e28","\u1175":"\u4e28","\u3163":"\u4e28","\u2f01":"\u4e28","\u119c":"\u4e28\u30fc","\u1198":"\u4e28\u1161","\u1199":"\u4e28\u1163","\ud7bd":"\u4e28\u1163\u1169","\ud7be":"\u4e28\u1163\u4e28","\ud7bf":"\u4e28\u1167","\ud7c0":"\u4e28\u1167\u4e28","\u119a":"\u4e28\u1169","\ud7c1":"\u4e28\u1169\u4e28","\ud7c2":"\u4e28\u116d","\u119b":"\u4e28\u116e","\ud7c3":"\u4e28\u1172","\u119d":"\u4e28\u119e","\ud7c4":"\u4e28\u4e28","\uf905":"\u4e32","\ud87e\udc01":"\u4e38","\uf95e":"\u4e39","\ud87e\udc02":"\u4e41","\u31e0":"\u4e59","\u2f04":"\u4e59","\u31df":"\u4e5a","\u2e83":"\u4e5a","\u31d6":"\u4e5b","\u2e82":"\u4e5b","\u2ef2":"\u4e80","\uf91b":"\u4e82","\u31da":"\u4e85","\u2f05":"\u4e85","\uf9ba":"\u4e86","\u30cb":"\u4e8c","\u2f06":"\u4e8c","\ud87e\udc03":"\ud840\udd22","\u2f07":"\u4ea0","\uf977":"\u4eae","\u2f08":"\u4eba","\u30a4":"\u4ebb","\u2e85":"\u4ebb","\uf9fd":"\u4ec0","\ud87e\udc19":"\u4ecc","\uf9a8":"\u4ee4","\ud87e\udc04":"\u4f60","\u5002":"\u4f75","\ud87e\udc07":"\u4f75","\ufa73":"\u4f80","\uf92d":"\u4f86","\uf9b5":"\u4f8b","\ufa30":"\u4fae","\ud87e\udc05":"\u4fae","\ud87e\udc06":"\u4fbb","\uf965":"\u4fbf","\u503c":"\u5024","\uf9d4":"\u502b","\ud87e\udc08":"\u507a","\ud87e\udc09":"\u5099","\ud87e\udc0b":"\u50cf","\uf9bb":"\u50da","\ufa31":"\u50e7","\ud87e\udc0a":"\u50e7","\ud87e\udc0c":"\u349e","\u2f09":"\u513f","\ufa0c":"\u5140","\u2e8e":"\u5140","\ufa74":"\u5145","\ufa32":"\u514d","\ud87e\udc0e":"\u514d","\ud87e\udc0f":"\u5154","\ud87e\udc10":"\u5164","\u2f0a":"\u5165","\ud87e\udc14":"\u5167","\ufa72":"\u5168","\uf978":"\u5169","\u30cf":"\u516b","\u2f0b":"\u516b","\uf9d1":"\u516d","\ud87e\udc11":"\u5177","\ud87e\udc12":"\ud841\udd1c","\ud87e\udd1b":"\ud841\udd25","\ufa75":"\u5180","\ud87e\udc13":"\u34b9","\u2f0c":"\u5182","\ud87e\udc15":"\u518d","\ud87e\udc16":"\ud841\udd4b","\ud87e\udcd2":"\u5192","\ud87e\udcd3":"\u5195","\ud87e\uddca":"\u34bb","\ud87e\udcd4":"\u6700","\u2f0d":"\u5196","\ud87e\udc17":"\u5197","\ud87e\udc18":"\u51a4","\u2f0e":"\u51ab","\ud87e\udc1a":"\u51ac","\ufa71":"\u51b5","\ud87e\udc1b":"\u51b5","\uf92e":"\u51b7","\uf979":"\u51c9","\uf955":"\u51cc","\uf954":"\u51dc","\ufa15":"\u51de","\u2f0f":"\u51e0","\ud87e\udc0d":"\ud841\ude3a","\ud87e\udc1d":"\u51f5","\u2f10":"\u51f5","\u2f11":"\u5200","\u2e89":"\u5202","\ud87e\udc1e":"\u5203","\ufa00":"\u5207","\ud87e\udc50":"\u5207","\uf99c":"\u5217","\uf9dd":"\u5229","\ud87e\udc1f":"\u34df","\uf9ff":"\u523a","\ud87e\udc20":"\u523b","\ud87e\udc21":"\u5246","\ud87e\udc22":"\u5272","\ud87e\udc23":"\u5277","\uf9c7":"\u5289","\ud87e\uddd9":"\ud842\udc04","\u30ab":"\u529b","\uf98a":"\u529b","\u2f12":"\u529b","\uf99d":"\u52a3","\ud87e\udc24":"\u3515","\ud87e\udd92":"\u52b3","\ufa76":"\u52c7","\ud87e\udc25":"\u52c7","\ufa33":"\u52c9","\ud87e\udc26":"\u52c9","\uf952":"\u52d2","\uf92f":"\u52de","\ufa34":"\u52e4","\ud87e\udc27":"\u52e4","\uf97f":"\u52f5","\u2f13":"\u52f9","\ufa77":"\u52fa","\ud87e\udc28":"\u52fa","\ud87e\udc29":"\u5305","\ud87e\udc2a":"\u5306","\ud87e\udddd":"\ud842\udcde","\u2f14":"\u5315","\uf963":"\u5317","\ud87e\udc2b":"\u5317","\u2f15":"\u531a","\u2f16":"\u5338","\uf9eb":"\u533f","\u2f17":"\u5341","\u3038":"\u5341","\u303a":"\u5345","\ud87e\udc2c":"\u5349","\u0fd6":"\u534d","\u0fd5":"\u5350","\ufa35":"\u5351","\ud87e\udc2d":"\u5351","\ud87e\udc2e":"\u535a","\u30c8":"\u535c","\u2f18":"\u535c","\u2f19":"\u5369","\u2e8b":"\u353e","\ud87e\udc2f":"\u5373","\uf91c":"\u5375","\ud87e\udc30":"\u537d","\ud87e\udc31":"\u537f","\ud87e\udc32":"\u537f","\ud87e\udc33":"\u537f","\u2f1a":"\u5382","\ud87e\udc34":"\ud842\ude2c","\u2f1b":"\u53b6","\uf96b":"\u53c3","\u2f1c":"\u53c8","\ud87e\udc36":"\u53ca","\ud87e\udc37":"\u53df","\ud87e\udc38":"\ud842\udf63","\u30ed":"\u53e3","\u2f1d":"\u53e3","\u56d7":"\u53e3","\u2f1e":"\u53e3","\uf906":"\u53e5","\ud87e\udc39":"\u53eb","\ud87e\udc3a":"\u53f1","\ud87e\udc3b":"\u5406","\uf9de":"\u540f","\uf9ed":"\u541d","\ud87e\udc3d":"\u5438","\uf980":"\u5442","\ud87e\udc3e":"\u5448","\ud87e\udc3f":"\u5468","\ud87e\udc3c":"\u549e","\ud87e\udc40":"\u54a2","\uf99e":"\u54bd","\u439b":"\u3588","\ud87e\udc41":"\u54f6","\ud87e\udc42":"\u5510","\ud87e\udc43":"\u5553","\u555f":"\u5553","\ufa79":"\u5555","\ud87e\udc44":"\u5563","\ud87e\udc45":"\u5584","\ud87e\udc46":"\u5584","\uf90b":"\u5587","\ufa7a":"\u5599","\ud87e\udc47":"\u5599","\ufa36":"\u559d","\ufa78":"\u559d","\ud87e\udc48":"\u55ab","\ud87e\udc49":"\u55b3","\ufa0d":"\u55c0","\ud87e\udc4a":"\u55c2","\ufa7b":"\u55e2","\ufa37":"\u5606","\ud87e\udc4c":"\u5606","\ud87e\udc4e":"\u5651","\ud87e\udc4f":"\u5674","\ufa38":"\u5668","\uf9a9":"\u56f9","\ud87e\udc4b":"\u5716","\ud87e\udc4d":"\u5717","\u2f1f":"\u571f","\u58eb":"\u571f","\u2f20":"\u571f","\ud87e\udc55":"\u578b","\ud87e\udc52":"\u57ce","\u39b3":"\u363d","\ud87e\udc53":"\u57f4","\ud87e\udc54":"\u580d","\ud87e\udc57":"\u5831","\ud87e\udc56":"\u5832","\ufa39":"\u5840","\ufa10":"\u585a","\ufa7c":"\u585a","\uf96c":"\u585e","\u586b":"\u5861","\u58ff":"\u58ab","\ud87e\udc58":"\u58ac","\ufa7d":"\u58b3","\uf94a":"\u58d8","\uf942":"\u58df","\ud87e\udc59":"\ud845\udce4","\ud87e\udc51":"\u58ee","\ud87e\udc5a":"\u58f2","\ud87e\udc5b":"\u58f7","\u2f21":"\u5902","\ud87e\udc5c":"\u5906","\u2f22":"\u590a","\u30bf":"\u5915","\u2f23":"\u5915","\ud87e\udc5d":"\u591a","\ud87e\udc5e":"\u5922","\u2f24":"\u5927","\ufa7e":"\u5944","\uf90c":"\u5948","\uf909":"\u5951","\ufa7f":"\u5954","\ud87e\udc5f":"\u5962","\uf981":"\u5973","\u2f25":"\u5973","\ud87e\udc60":"\ud845\udea8","\ud87e\udc61":"\ud845\udeea","\ud87e\udc65":"\u59d8","\ud87e\udc62":"\u59ec","\ud87e\udc63":"\u5a1b","\ud87e\udc64":"\u5a27","\ufa80":"\u5a62","\ud87e\udc66":"\u5a66","\u5b00":"\u5aaf","\ud87e\udc67":"\u36ee","\ud87e\udc68":"\u36fc","\ud87e\udd86":"\u5ab5","\ud87e\udc69":"\u5b08","\ufa81":"\u5b28","\ud87e\udc6a":"\u5b3e","\ud87e\udc6b":"\u5b3e","\u2f26":"\u5b50","\u2f27":"\u5b80","\ufa04":"\u5b85","\ud87e\udc6c":"\ud846\uddc8","\ud87e\udc6d":"\u5bc3","\ud87e\udc6e":"\u5bd8","\uf95f":"\u5be7","\uf9aa":"\u5be7","\ud87e\udc6f":"\u5be7","\uf9bc":"\u5bee","\ud87e\udc70":"\u5bf3","\ud87e\udc71":"\ud846\udf18","\u2f28":"\u5bf8","\ud87e\udc72":"\u5bff","\ud87e\udc73":"\u5c06","\u2f29":"\u5c0f","\ud87e\udc75":"\u5c22","\u2e90":"\u5c22","\u2f2a":"\u5c22","\u2e8f":"\u5c23","\ud87e\udc76":"\u3781","\u2f2b":"\u5c38","\uf9bd":"\u5c3f","\ud87e\udc77":"\u5c60","\uf94b":"\u5c62","\ufa3b":"\u5c64","\uf9df":"\u5c65","\ufa3c":"\u5c6e","\ud87e\udc78":"\u5c6e","\u2f2c":"\u5c6e","\ud87e\udcf8":"\ud847\udd0b","\u2f2d":"\u5c71","\ud87e\udc79":"\u5cc0","\ud87e\udc7a":"\u5c8d","\ud87e\udc7b":"\ud847\udde4","\ud87e\udc7d":"\ud847\udde6","\uf9d5":"\u5d19","\ud87e\udc7c":"\u5d43","\uf921":"\u5d50","\ud87e\udc7f":"\u5d6b","\ud87e\udc7e":"\u5d6e","\ud87e\udc80":"\u5d7c","\ud87e\uddf4":"\u5db2","\uf9ab":"\u5dba","\u2f2e":"\u5ddb","\ud87e\udc82":"\u5de2","\u30a8":"\u5de5","\u2f2f":"\u5de5","\u2f30":"\u5df1","\u2e92":"\u5df3","\ud87e\udc83":"\u382f","\ud87e\udc84":"\u5dfd","\u2f31":"\u5dfe","\u5e32":"\u5e21","\ud87e\udc85":"\u5e28","\ud87e\udc86":"\u5e3d","\ud87e\udc87":"\u5e69","\ud87e\udc88":"\u3862","\ud87e\udc89":"\ud848\udd83","\u2f32":"\u5e72","\uf98e":"\u5e74","\ud87e\udd39":"\ud848\udd9f","\u2e93":"\u5e7a","\u2f33":"\u5e7a","\u2f34":"\u5e7f","\ufa01":"\u5ea6","\ud87e\udc8a":"\u387c","\ud87e\udc8b":"\u5eb0","\ud87e\udc8c":"\u5eb3","\ud87e\udc8d":"\u5eb6","\uf928":"\u5eca","\ud87e\udc8e":"\u5eca","\uf9a2":"\u5ec9","\ufa82":"\u5ed2","\ufa0b":"\u5ed3","\ufa83":"\u5ed9","\uf982":"\u5eec","\u2f35":"\u5ef4","\ud87e\udc90":"\u5efe","\u2f36":"\u5efe","\ud87e\udc91":"\ud848\udf31","\ud87e\udc92":"\ud848\udf31","\uf943":"\u5f04","\u2f37":"\u5f0b","\u2f38":"\u5f13","\ud87e\udc94":"\u5f22","\ud87e\udc95":"\u5f22","\u2f39":"\u5f50","\u2e94":"\u5f51","\ud87e\udc74":"\u5f53","\ud87e\udc96":"\u38c7","\u2f3a":"\u5f61","\ud87e\udc99":"\u5f62","\ufa84":"\u5f69","\ud87e\udc9a":"\u5f6b","\u2f3b":"\u5f73","\uf9d8":"\u5f8b","\ud87e\udc9b":"\u38e3","\ud87e\udc9c":"\u5f9a","\uf966":"\u5fa9","\ufa85":"\u5fad","\u2f3c":"\u5fc3","\u2e96":"\u5fc4","\u2e97":"\u38fa","\ud87e\udc9d":"\u5fcd","\ud87e\udc9e":"\u5fd7","\uf9a3":"\u5ff5","\ud87e\udc9f":"\u5ff9","\uf960":"\u6012","\uf9ac":"\u601c","\ufa6b":"\u6075","\ud87e\udca2":"\u391c","\ud87e\udca1":"\u393a","\ud87e\udca0":"\u6081","\ufa3d":"\u6094","\ud87e\udca3":"\u6094","\ud87e\udca5":"\u60c7","\ufa86":"\u60d8","\uf9b9":"\u60e1","\ud87e\udca4":"\ud849\uded4","\ufa88":"\u6108","\ufa3e":"\u6168","\uf9d9":"\u6144","\ud87e\udca6":"\u6148","\ud87e\udca7":"\u614c","\ud87e\udca9":"\u614c","\ufa87":"\u614e","\ud87e\udca8":"\u614e","\ufa8a":"\u6160","\ud87e\udcaa":"\u617a","\ufa3f":"\u618e","\ufa89":"\u618e","\ud87e\udcab":"\u618e","\uf98f":"\u6190","\ud87e\udcad":"\u61a4","\ud87e\udcae":"\u61af","\ud87e\udcac":"\u61b2","\ufad0":"\ud84a\udc44","\ufacf":"\ud84a\udc4a","\ud87e\udcaf":"\u61de","\ufa40":"\u61f2","\ufa8b":"\u61f2","\ud87e\udcb0":"\u61f2","\uf90d":"\u61f6","\ud87e\udcb1":"\u61f6","\uf990":"\u6200","\u2f3d":"\u6208","\ud87e\udcb2":"\u6210","\ud87e\udcb3":"\u621b","\uf9d2":"\u622e","\ufa8c":"\u6234","\u2f3e":"\u6236","\u6238":"\u6236","\u2f3f":"\u624b","\u2e98":"\u624c","\ud87e\udcb4":"\u625d","\ud87e\udcb5":"\u62b1","\uf925":"\u62c9","\uf95b":"\u62cf","\ufa02":"\u62d3","\ud87e\udcb6":"\u62d4","\ud87e\udcba":"\u62fc","\uf973":"\u62fe","\ud87e\udcb8":"\ud84a\udf0c","\ud87e\udcb9":"\u633d","\ud87e\udcb7":"\u6350","\ud87e\udcbb":"\u6368","\uf9a4":"\u637b","\ud87e\udcbc":"\u6383","\uf975":"\u63a0","\ud87e\udcc1":"\u63a9","\ufa8d":"\u63c4","\ud87e\udcbd":"\u63e4","\ufa8f":"\u6452","\ud87e\udcbe":"\ud84a\udff1","\ufa8e":"\u641c","\ud87e\udcbf":"\u6422","\ud87e\udcc0":"\u63c5","\ud87e\udcc3":"\u6469","\ud87e\udcc6":"\u6477","\ud87e\udcc4":"\u647e","\ud87e\udcc2":"\u3a2e","\u6409":"\u3a41","\uf991":"\u649a","\ud87e\udcc5":"\u649d","\uf930":"\u64c4","\ud87e\udcc7":"\u3a6c","\u2f40":"\u652f","\u2f41":"\u6534","\u2e99":"\u6535","\ufa41":"\u654f","\ud87e\udcc8":"\u654f","\ufa90":"\u6556","\ud87e\udcc9":"\u656c","\uf969":"\u6578","\ud87e\udcca":"\ud84c\udc0a","\u2f42":"\u6587","\u2eeb":"\u6589","\u2f43":"\u6597","\uf9be":"\u6599","\u2f44":"\u65a4","\u2f45":"\u65b9","\uf983":"\u65c5","\u2f46":"\u65e0","\u2e9b":"\u65e1","\ufa42":"\u65e2","\ud87e\udccb":"\u65e3","\u2f47":"\u65e5","\uf9e0":"\u6613","\u66f6":"\u3ada","\ud87e\udcd1":"\u3ae4","\ud87e\udccd":"\u6649","\u6669":"\u665a","\ufa12":"\u6674","\ufa91":"\u6674","\ufa43":"\u6691","\ud87e\udccf":"\u6691","\uf9c5":"\u6688","\ud87e\udcd0":"\u3b08","\ud87e\udcd5":"\u669c","\ufa06":"\u66b4","\uf98b":"\u66c6","\ud87e\udcce":"\u3b19","\ud87e\udc97":"\ud84c\udeb8","\u2f48":"\u66f0","\uf901":"\u66f4","\ud87e\udccc":"\u66f8","\u2f49":"\u6708","\ud87e\udd80":"\ud84c\udf5f","\u80a6":"\u670c","\u80d0":"\u670f","\u80ca":"\u6710","\u8101":"\u6713","\u80f6":"\u3b35","\uf929":"\u6717","\ufa92":"\u6717","\ud87e\udcd8":"\u6717","\u8127":"\u6718","\ufa93":"\u671b","\ud87e\udcd9":"\u671b","\u5e50":"\u3b3a","\u4420":"\u3b3b","\ud87e\udd89":"\ud84c\udf93","\u81a7":"\u6723","\ud87e\udd8a":"\ud84c\udf9c","\u2f4a":"\u6728","\uf9e1":"\u674e","\ud87e\udcdc":"\u6753","\ufa94":"\u6756","\ud87e\udcdb":"\u675e","\ud87e\udcdd":"\ud84c\udfc3","\u67ff":"\u676e","\uf9c8":"\u677b","\ud87e\udce0":"\u6785","\uf9f4":"\u6797","\ud87e\udcde":"\u3b49","\ufad1":"\ud84c\udfd5","\uf9c9":"\u67f3","\ud87e\udcdf":"\u67fa","\uf9da":"\u6817","\ud87e\udce5":"\u681f","\ud87e\udce1":"\u6852","\ud87e\udce3":"\ud84d\udc6d","\uf97a":"\u6881","\ufa44":"\u6885","\ud87e\udce2":"\u6885","\ud87e\udce4":"\u688e","\uf9e2":"\u68a8","\ud87e\udce6":"\u6914","\ud87e\udce8":"\u6942","\ufad2":"\u3b9d","\ud87e\udce7":"\u3b9d","\u69e9":"\u3ba3","\u6a27":"\u699d","\ud87e\udce9":"\u69a3","\ud87e\udcea":"\u69ea","\uf914":"\u6a02","\uf95c":"\u6a02","\uf9bf":"\u6a02","\uf94c":"\u6a13","\ud87e\udcec":"\ud84d\udea3","\ud87e\udceb":"\u6aa8","\uf931":"\u6ad3","\ud87e\udced":"\u6adb","\uf91d":"\u6b04","\ud87e\udcee":"\u3c18","\u2f4b":"\u6b20","\ud87e\udcef":"\u6b21","\ud87e\udcf0":"\ud84e\udca7","\ud87e\udcf1":"\u6b54","\ud87e\udcf2":"\u3c4e","\u2f4c":"\u6b62","\u2eed":"\u6b6f","\ud87e\udcf3":"\u6b72","\uf98c":"\u6b77","\ufa95":"\u6b79","\u2f4d":"\u6b79","\u2e9e":"\u6b7a","\ud87e\udcf4":"\u6b9f","\uf9a5":"\u6bae","\u2f4e":"\u6bb3","\uf970":"\u6bba","\ufa96":"\u6bba","\ud87e\udcf5":"\u6bba","\ud87e\udcf6":"\u6bbb","\ud87e\udcf7":"\ud84e\ude8d","\u2f4f":"\u6bcb","\u2e9f":"\u6bcd","\ud87e\udcf9":"\ud84e\udefa","\u2f50":"\u6bd4","\u2f51":"\u6bdb","\u2f52":"\u6c0f","\u2ea0":"\u6c11","\u2f53":"\u6c14","\u2f54":"\u6c34","\u2ea1":"\u6c35","\u2ea2":"\u6c3a","\ud87e\udcfa":"\u6c4e","\ud87e\udcfe":"\u6c67","\uf972":"\u6c88","\ud87e\udcfc":"\u6cbf","\uf968":"\u6ccc","\ud87e\udcfd":"\u6ccd","\uf9e3":"\u6ce5","\ud87e\udcfb":"\ud84f\udcbc","\uf915":"\u6d1b","\ufa05":"\u6d1e","\ud87e\udd07":"\u6d34","\ud87e\udd00":"\u6d3e","\uf9ca":"\u6d41","\ufa97":"\u6d41","\ud87e\udd02":"\u6d41","\ud87e\udcff":"\u6d16","\ud87e\udd03":"\u6d69","\uf92a":"\u6d6a","\ufa45":"\u6d77","\ud87e\udd01":"\u6d77","\ud87e\udd04":"\u6d78","\ud87e\udd05":"\u6d85","\ud87e\udd06":"\ud84f\udd1e","\uf9f5":"\u6dcb","\uf94d":"\u6dda","\uf9d6":"\u6dea","\ud87e\udd0e":"\u6df9","\ufa46":"\u6e1a","\ud87e\udd08":"\u6e2f","\ud87e\udd09":"\u6e6e","\u6f59":"\u6e88","\ufa99":"\u6ecb","\ud87e\udd0b":"\u6ecb","\uf9cb":"\u6e9c","\uf9ec":"\u6eba","\ud87e\udd0c":"\u6ec7","\uf904":"\u6ed1","\ufa98":"\u6edb","\ud87e\udd0a":"\u3d33","\uf94e":"\u6f0f","\ufa47":"\u6f22","\ufa9a":"\u6f22","\uf992":"\u6f23","\ud87e\udd0d":"\ud84f\uded1","\ud87e\udd0f":"\u6f6e","\ud87e\udd10":"\ud84f\udf5e","\ud87e\udd11":"\ud84f\udf8e","\ud87e\udd12":"\u6fc6","\uf922":"\u6feb","\uf984":"\u6ffe","\ud87e\udd15":"\u701b","\ufa9b":"\u701e","\ud87e\udd14":"\u701e","\ud87e\udd13":"\u7039","\ud87e\udd17":"\u704a","\ud87e\udd16":"\u3d96","\u2f55":"\u706b","\u2ea3":"\u706c","\ud87e\udc35":"\u7070","\ud87e\udd19":"\u7077","\ud87e\udd18":"\u707d","\uf9fb":"\u7099","\ud87e\udd1a":"\u70ad","\uf99f":"\u70c8","\uf916":"\u70d9","\ufa48":"\u716e","\ufa9c":"\u716e","\ud87e\udd1d":"\ud850\ude63","\ud87e\udd1c":"\u7145","\uf993":"\u7149","\ufa6c":"\ud850\udeee","\ud87e\udd1e":"\u719c","\uf9c0":"\u71ce","\uf9ee":"\u71d0","\ud87e\udd1f":"\ud850\udfab","\uf932":"\u7210","\uf91e":"\u721b","\ud87e\udd20":"\u7228","\u2f56":"\u722a","\ufa49":"\u722b","\u2ea4":"\u722b","\ufa9e":"\u7235","\ud87e\udd21":"\u7235","\u2f57":"\u7236","\u2f58":"\u723b","\u2ea6":"\u4e2c","\u2f59":"\u723f","\u2f5a":"\u7247","\ud87e\udd22":"\u7250","\u2f5b":"\u7259","\ud87e\udd23":"\ud851\ude08","\u2f5c":"\u725b","\uf946":"\u7262","\ud87e\udd24":"\u7280","\ud87e\udd25":"\u7295","\u2f5d":"\u72ac","\u2ea8":"\u72ad","\ufa9f":"\u72af","\uf9fa":"\u72c0","\ud87e\udd26":"\ud851\udf35","\uf92b":"\u72fc","\ufa16":"\u732a","\ufaa0":"\u732a","\ud87e\udd27":"\ud852\udc14","\uf9a7":"\u7375","\ud87e\udd28":"\u737a","\u2f5e":"\u7384","\uf961":"\u7387","\uf9db":"\u7387","\u2f5f":"\u7389","\ud87e\udd29":"\u738b","\ud87e\udd2a":"\u3eac","\ud87e\udd2b":"\u73a5","\uf9ad":"\u73b2","\ud87e\udd2c":"\u3eb8","\ud87e\udd2d":"\u3eb8","\uf917":"\u73de","\uf9cc":"\u7409","\uf9e4":"\u7406","\ufa4a":"\u7422","\ud87e\udd2e":"\u7447","\ud87e\udd2f":"\u745c","\uf9ae":"\u7469","\ufaa1":"\u7471","\ud87e\udd30":"\u7471","\ud87e\udd31":"\u7485","\uf994":"\u7489","\uf9ef":"\u7498","\ud87e\udd32":"\u74ca","\u2f60":"\u74dc","\u2f61":"\u74e6","\ud87e\udd33":"\u3f1b","\ufaa2":"\u7506","\u2f62":"\u7518","\u2f63":"\u751f","\ud87e\udd34":"\u7524","\u2f64":"\u7528","\u2f65":"\u7530","\ufaa3":"\u753b","\ud87e\udd36":"\u753e","\ud87e\udd35":"\ud853\udc36","\uf9cd":"\u7559","\uf976":"\u7565","\uf962":"\u7570","\ud87e\udd38":"\u7570","\ud87e\udd37":"\ud853\udc92","\u2f66":"\u758b","\u2f67":"\u7592","\uf9e5":"\u75e2","\ud87e\udd3a":"\u7610","\ufaa5":"\u761f","\ufaa4":"\u761d","\uf9c1":"\u7642","\uf90e":"\u7669","\u2f68":"\u7676","\u2f69":"\u767d","\ud87e\udd3b":"\ud853\udfa1","\ud87e\udd3c":"\ud853\udfb8","\u2f6a":"\u76ae","\u2f6b":"\u76bf","\ud87e\udd3d":"\ud854\udc44","\ud87e\udd3e":"\u3ffc","\ufa17":"\u76ca","\ufaa6":"\u76ca","\ufaa7":"\u76db","\uf933":"\u76e7","\ud87e\udd3f":"\u4008","\u2f6c":"\u76ee","\ufaa8":"\u76f4","\ud87e\udd40":"\u76f4","\ud87e\udd42":"\ud854\udcf2","\ud87e\udd41":"\ud854\udcf3","\uf96d":"\u7701","\ufad3":"\u4018","\ud87e\udd43":"\ud854\udd19","\ud87e\udd45":"\u771e","\ud87e\udd46":"\u771f","\ud87e\udd47":"\u771f","\ud87e\udd44":"\ud854\udd33","\ufaaa":"\u7740","\ufaa9":"\u774a","\ud87e\udd48":"\u774a","\u9fc3":"\u4039","\ufad4":"\u4039","\ud87e\udd49":"\u4039","\u6663":"\u403f","\ud87e\udd4b":"\u4046","\ud87e\udd4a":"\u778b","\ufad5":"\ud854\ude49","\ufa9d":"\u77a7","\u2f6d":"\u77db","\u2f6e":"\u77e2","\u2f6f":"\u77f3","\ud87e\udd4c":"\u4096","\ud87e\udd4d":"\ud855\udc1d","\u784f":"\u7814","\ud87e\udd4e":"\u784e","\uf9ce":"\u786b","\uf93b":"\u788c","\ud87e\udd4f":"\u788c","\ufa4b":"\u7891","\uf947":"\u78ca","\ufaab":"\u78cc","\ud87e\udd50":"\u78cc","\uf964":"\u78fb","\ud87e\udd51":"\u40e3","\uf985":"\u792a","\u2f70":"\u793a","\u2ead":"\u793b","\ufa18":"\u793c","\ufa4c":"\u793e","\ufa4e":"\u7948","\ufa4d":"\u7949","\ud87e\udd52":"\ud855\ude26","\ufa4f":"\u7950","\ufa50":"\u7956","\ud87e\udd53":"\u7956","\ufa51":"\u795d","\ufa19":"\u795e","\ufa1a":"\u7965","\ufa61":"\u8996","\ufab8":"\u8996","\uf93c":"\u797f","\ud87e\udd54":"\ud855\ude9a","\ufa52":"\u798d","\ufa53":"\u798e","\ufa1b":"\u798f","\ud87e\udd56":"\u798f","\ud87e\udd55":"\ud855\udec5","\uf9b6":"\u79ae","\u2f71":"\u79b8","\u2f72":"\u79be","\uf995":"\u79ca","\ud87e\udd58":"\u412f","\ud87e\udd57":"\u79eb","\uf956":"\u7a1c","\ud87e\udd5a":"\u7a4a","\ufa54":"\u7a40","\ud87e\udd59":"\u7a40","\ud87e\udd5b":"\u7a4f","\u2f73":"\u7a74","\ufa55":"\u7a81","\ud87e\udd5c":"\ud856\udd7c","\ufaac":"\u7ab1","\uf9f7":"\u7acb","\u2f74":"\u7acb","\u2eef":"\u7adc","\ud87e\udd5d":"\ud856\udea7","\ud87e\udd5e":"\ud856\udea7","\ud87e\udd5f":"\u7aee","\u2f75":"\u7af9","\uf9f8":"\u7b20","\ufa56":"\u7bc0","\ufaad":"\u7bc0","\ud87e\udd60":"\u4202","\ud87e\udd61":"\ud856\udfab","\ud87e\udd62":"\u7bc6","\ud87e\udd64":"\u4227","\ud87e\udd63":"\u7bc9","\ud87e\udd65":"\ud857\udc80","\ufad6":"\ud857\udcd0","\uf9a6":"\u7c3e","\uf944":"\u7c60","\u2f76":"\u7c73","\ufaae":"\u7c7b","\uf9f9":"\u7c92","\ufa1d":"\u7cbe","\ud87e\udd66":"\u7cd2","\ufa03":"\u7cd6","\ud87e\udd68":"\u7ce8","\ud87e\udd67":"\u42a0","\ud87e\udd69":"\u7ce3","\uf97b":"\u7ce7","\u2f77":"\u7cf8","\u2eaf":"\u7cf9","\ud87e\udd6b":"\ud857\udf86","\ud87e\udd6a":"\u7d00","\uf9cf":"\u7d10","\uf96a":"\u7d22","\uf94f":"\u7d2f","\u7d76":"\u7d55","\ud87e\udd6c":"\u7d63","\ufaaf":"\u7d5b","\uf93d":"\u7da0","\uf957":"\u7dbe","\ud87e\udd6e":"\u7dc7","\uf996":"\u7df4","\ufa57":"\u7df4","\ufab0":"\u7df4","\ud87e\udd6f":"\u7e02","\ud87e\udd6d":"\u4301","\ufa58":"\u7e09","\uf950":"\u7e37","\ufa59":"\u7e41","\ud87e\udd70":"\u7e45","\ud87e\udc98":"\ud858\uddda","\ud87e\udd71":"\u4334","\u2f78":"\u7f36","\ud87e\udd72":"\ud858\ude28","\ufab1":"\u7f3e","\ud87e\udd73":"\ud858\ude47","\u2f79":"\u7f51","\u2eab":"\u7f52","\u2eb2":"\u7f52","\u2eb1":"\u7f53","\ud87e\udd74":"\u4359","\ufa5a":"\u7f72","\ud87e\udd75":"\ud858\uded9","\uf9e6":"\u7f79","\ud87e\udd76":"\u7f7a","\uf90f":"\u7f85","\ud87e\udd77":"\ud858\udf3e","\u2f7a":"\u7f8a","\ud87e\udd78":"\u7f95","\uf9af":"\u7f9a","\ufa1e":"\u7fbd","\u2f7b":"\u7fbd","\ud87e\udd79":"\u7ffa","\uf934":"\u8001","\u2f7c":"\u8001","\u2eb9":"\u8002","\ufa5b":"\u8005","\ufab2":"\u8005","\ud87e\udd7a":"\u8005","\u2f7d":"\u800c","\ud87e\udd7b":"\ud859\udcda","\u2f7e":"\u8012","\ud87e\udd7c":"\ud859\udd23","\u2f7f":"\u8033","\uf9b0":"\u8046","\ud87e\udd7d":"\u8060","\ud87e\udd7e":"\ud859\udda8","\uf997":"\u806f","\ud87e\udd7f":"\u8070","\uf945":"\u807e","\u2f80":"\u807f","\u2eba":"\u8080","\u2f81":"\u8089","\uf953":"\u808b","\ud87e\udcd6":"\u80ad","\ud87e\udd82":"\u80b2","\ud87e\udd81":"\u43d5","\ud87e\udcd7":"\u43d9","\u8141":"\u80fc","\ud87e\udd83":"\u8103","\ud87e\udd85":"\u813e","\ud87e\udd84":"\u440b","\ud87e\udcda":"\u6721","\ud87e\udd87":"\ud859\udfa7","\ud87e\udd88":"\ud859\udfb5","\u6726":"\u4443","\uf926":"\u81d8","\u2f82":"\u81e3","\uf9f6":"\u81e8","\u2f83":"\u81ea","\ufa5c":"\u81ed","\u2f84":"\u81f3","\u2f85":"\u81fc","\ud87e\udc93":"\u8201","\ud87e\udd8b":"\u8201","\ud87e\udd8c":"\u8204","\u2f86":"\u820c","\ufa6d":"\u8218","\u2f87":"\u821b","\u2f88":"\u821f","\ud87e\udd8e":"\u446b","\u2f89":"\u826e","\uf97c":"\u826f","\u2f8a":"\u8272","\u2f8b":"\u8278","\ufa5d":"\u8279","\ufa5e":"\u8279","\u2ebe":"\u8279","\u2ebf":"\u8279","\u2ec0":"\u8279","\ud87e\udd90":"\u828b","\ud87e\udd8f":"\u8291","\ud87e\udd91":"\u829d","\ud87e\udd93":"\u82b1","\ud87e\udd94":"\u82b3","\ud87e\udd95":"\u82bd","\uf974":"\u82e5","\ud87e\udd98":"\u82e5","\ud87e\udd96":"\u82e6","\ud87e\udd97":"\ud85a\udf3c","\uf9fe":"\u8336","\ufab3":"\u8352","\ud87e\udd9a":"\u8363","\ud87e\udd99":"\u831d","\ud87e\udd9c":"\u8323","\ud87e\udd9d":"\u83bd","\ud87e\udda0":"\u8353","\uf93e":"\u83c9","\ud87e\udda1":"\u83ca","\ud87e\udda2":"\u83cc","\ud87e\udda3":"\u83dc","\ud87e\udd9e":"\u83e7","\ufab4":"\u83ef","\uf958":"\u83f1","\ufa5f":"\u8457","\ud87e\udd9f":"\u8457","\ud87e\udda4":"\ud85b\udc36","\ud87e\udd9b":"\u83ad","\uf918":"\u843d","\uf96e":"\u8449","\u853f":"\u848d","\ud87e\udda6":"\ud85b\udcd5","\ud87e\udda5":"\ud85b\udd6b","\uf999":"\u84ee","\ud87e\udda8":"\u84f1","\ud87e\udda9":"\u84f3","\uf9c2":"\u84fc","\ud87e\uddaa":"\u8516","\ud87e\udda7":"\u452b","\ud87e\uddac":"\u8564","\ud87e\uddad":"\ud85b\udf2c","\uf923":"\u85cd","\ud87e\uddae":"\u455d","\ud87e\uddb0":"\ud85b\udfb1","\ud87e\uddaf":"\u4561","\uf9f0":"\u85fa","\uf935":"\u8606","\ud87e\uddb2":"\u456b","\ufa20":"\u8612","\uf91f":"\u862d","\ud87e\uddb1":"\ud85c\udcd2","\u8641":"\u8637","\uf910":"\u863f","\u2f8c":"\u864d","\u2ec1":"\u864e","\ud87e\uddb3":"\u8650","\uf936":"\u865c","\ud87e\uddb4":"\u865c","\ud87e\uddb5":"\u8667","\ud87e\uddb6":"\u8669","\u2f8d":"\u866b","\ud87e\uddb7":"\u86a9","\ud87e\uddb8":"\u8688","\ud87e\uddba":"\u86e2","\ud87e\uddb9":"\u870e","\ud87e\uddbc":"\u8728","\ud87e\uddbd":"\u876b","\ud87e\uddc0":"\u87e1","\ufab5":"\u8779","\ud87e\uddbb":"\u8779","\ud87e\uddbe":"\u8786","\ud87e\uddbf":"\u45d7","\ud87e\uddab":"\ud85c\udfca","\uf911":"\u87ba","\ud87e\uddc1":"\u8801","\ud87e\uddc2":"\u45f9","\uf927":"\u881f","\u2f8e":"\u8840","\ufa08":"\u884c","\u2f8f":"\u884c","\ud87e\uddc3":"\u8860","\ud87e\uddc4":"\u8863","\u2f90":"\u8863","\u2ec2":"\u8864","\uf9a0":"\u88c2","\ud87e\uddc5":"\ud85d\ude67","\uf9e7":"\u88cf","\ud87e\uddc6":"\u88d7","\ud87e\uddc7":"\u88de","\uf9e8":"\u88e1","\uf912":"\u88f8","\ud87e\uddc9":"\u88fa","\ud87e\uddc8":"\u4635","\ufa60":"\u8910","\ufab6":"\u8941","\uf924":"\u8964","\u2f91":"\u897e","\u2ec4":"\u897f","\u2ec3":"\u8980","\ufab7":"\u8986","\ufa0a":"\u898b","\u2f92":"\u898b","\ud87e\uddcb":"\ud85e\udcae","\u2ec5":"\u89c1","\u2f93":"\u89d2","\u2f94":"\u8a00","\ud87e\uddcc":"\ud85e\udd66","\u8a7d":"\u8a2e","\u8a1e":"\u46b6","\ud87e\uddcd":"\u46be","\ud87e\uddce":"\u46c7","\ud87e\uddcf":"\u8aa0","\uf96f":"\u8aaa","\uf9a1":"\u8aaa","\ufab9":"\u8abf","\ufabb":"\u8acb","\uf97d":"\u8ad2","\uf941":"\u8ad6","\ufabe":"\u8aed","\ud87e\uddd0":"\u8aed","\ufa22":"\u8af8","\ufaba":"\u8af8","\uf95d":"\u8afe","\ufabd":"\u8afe","\ufa62":"\u8b01","\ufabc":"\u8b01","\ufa63":"\u8b39","\ufabf":"\u8b39","\uf9fc":"\u8b58","\uf95a":"\u8b80","\u8b8f":"\u8b86","\ufac0":"\u8b8a","\ud87e\uddd1":"\u8b8a","\u2ec8":"\u8ba0","\u2f95":"\u8c37","\u2f96":"\u8c46","\uf900":"\u8c48","\ud87e\uddd2":"\u8c55","\u2f97":"\u8c55","\u8c63":"\u8c5c","\u2f98":"\u8c78","\ud87e\uddd3":"\ud85f\udca8","\u2f99":"\u8c9d","\ud87e\uddd4":"\u8cab","\ud87e\uddd5":"\u8cc1","\uf948":"\u8cc2","\uf903":"\u8cc8","\ufa64":"\u8cd3","\ufa65":"\u8d08","\ufac1":"\u8d08","\ud87e\uddd6":"\u8d1b","\u2ec9":"\u8d1d","\u2f9a":"\u8d64","\u2f9b":"\u8d70","\ud87e\uddd7":"\u8d77","\u8d86":"\u8d7f","\ufad7":"\ud85f\uded3","\ud87e\uddd8":"\ud85f\udf2f","\u2f9c":"\u8db3","\ud87e\uddda":"\u8dcb","\ud87e\udddb":"\u8dbc","\u8dfa":"\u8de5","\uf937":"\u8def","\ud87e\udddc":"\u8df0","\u8e9b":"\u8e97","\u2f9d":"\u8eab","\uf902":"\u8eca","\u2f9e":"\u8eca","\ud87e\uddde":"\u8ed4","\u8f27":"\u8eff","\uf998":"\u8f26","\uf9d7":"\u8f2a","\ufac2":"\u8f38","\ud87e\udddf":"\u8f38","\ufa07":"\u8f3b","\uf98d":"\u8f62","\u2ecb":"\u8f66","\u2f9f":"\u8f9b","\ud87e\udd8d":"\u8f9e","\uf971":"\u8fb0","\u2fa0":"\u8fb0","\u2fa1":"\u8fb5","\ufa66":"\u8fb6","\u2ecc":"\u8fb6","\u2ecd":"\u8fb6","\ud87e\udc81":"\u5de1","\uf99a":"\u9023","\ufa25":"\u9038","\ufa67":"\u9038","\ufac3":"\u9072","\uf9c3":"\u907c","\ud87e\udde0":"\ud861\uddd2","\ud87e\udde1":"\ud861\udded","\uf913":"\u908f","\u2fa2":"\u9091","\ud87e\udde2":"\u9094","\uf92c":"\u90ce","\u90de":"\u90ce","\ufa2e":"\u90ce","\ud87e\udde3":"\u90f1","\ufa26":"\u90fd","\ud87e\udde5":"\ud861\udf2e","\ud87e\udde4":"\u9111","\ud87e\udde6":"\u911b","\u2fa3":"\u9149","\uf919":"\u916a","\ufac4":"\u9199","\uf9b7":"\u91b4","\u2fa4":"\u91c6","\uf9e9":"\u91cc","\u2fa5":"\u91cc","\uf97e":"\u91cf","\uf90a":"\u91d1","\u2fa6":"\u91d1","\uf9b1":"\u9234","\ud87e\udde7":"\u9238","\ufac5":"\u9276","\ud87e\udde8":"\u92d7","\ud87e\udde9":"\u92d8","\ud87e\uddea":"\u927c","\uf93f":"\u9304","\uf99b":"\u934a","\u93ae":"\u93ad","\ud87e\uddeb":"\u93f9","\ud87e\uddec":"\u9415","\ud87e\udded":"\ud862\udffa","\u2ed0":"\u9485","\u2ed1":"\u9577","\u2fa7":"\u9577","\u2ed2":"\u9578","\u2ed3":"\u957f","\u2fa8":"\u9580","\ud87e\uddee":"\u958b","\ud87e\uddef":"\u4995","\uf986":"\u95ad","\ud87e\uddf0":"\u95b7","\ud87e\uddf1":"\ud863\udd77","\u2ed4":"\u95e8","\u2fa9":"\u961c","\u2ecf":"\u961d","\u2ed6":"\u961d","\uf9c6":"\u962e","\uf951":"\u964b","\ufa09":"\u964d","\uf959":"\u9675","\uf9d3":"\u9678","\ufac6":"\u967c","\uf9dc":"\u9686","\uf9f1":"\u96a3","\ud87e\uddf2":"\u49e6","\u2faa":"\u96b6","\ufa2f":"\u96b7","\u96b8":"\u96b7","\uf9b8":"\u96b7","\u2fab":"\u96b9","\ud87e\uddf3":"\u96c3","\uf9ea":"\u96e2","\ufa68":"\u96e3","\ufac7":"\u96e3","\u2fac":"\u96e8","\uf9b2":"\u96f6","\uf949":"\u96f7","\ud87e\uddf5":"\u9723","\ud87e\uddf6":"\ud864\udd45","\uf938":"\u9732","\uf9b3":"\u9748","\u2fad":"\u9751","\u2ed8":"\u9752","\ufa1c":"\u9756","\ufac8":"\u9756","\ud87e\udc1c":"\ud864\udddf","\u2fae":"\u975e","\u2faf":"\u9762","\ud87e\uddf7":"\ud864\ude1a","\u2fb0":"\u9769","\ud87e\uddf8":"\u4a6e","\ud87e\uddf9":"\u4a76","\u2fb1":"\u97cb","\ufac9":"\u97db","\ud87e\uddfa":"\u97e0","\u2ed9":"\u97e6","\u2fb2":"\u97ed","\ud87e\uddfb":"\ud865\udc0a","\u2fb3":"\u97f3","\ufa69":"\u97ff","\ufaca":"\u97ff","\u2fb4":"\u9801","\ud87e\uddfc":"\u4ab2","\ufacb":"\u980b","\ud87e\uddfe":"\u980b","\ud87e\uddff":"\u980b","\uf9b4":"\u9818","\ud87e\ude00":"\u9829","\ud87e\uddfd":"\ud865\udc96","\ufa6a":"\u983b","\ufacc":"\u983b","\uf9d0":"\u985e","\u2eda":"\u9875","\u2fb5":"\u98a8","\ud87e\ude01":"\ud865\uddb6","\u2edb":"\u98ce","\u2fb6":"\u98db","\u2edc":"\u98de","\u2edd":"\u98df","\u2fb7":"\u98df","\u2edf":"\u98e0","\ud87e\ude02":"\u98e2","\ufa2a":"\u98ef","\ufa2b":"\u98fc","\ud87e\ude03":"\u4b33","\ufa2c":"\u9928","\ud87e\ude04":"\u9929","\u2ee0":"\u9963","\u2fb8":"\u9996","\u2fb9":"\u9999","\ud87e\ude05":"\u99a7","\u2fba":"\u99ac","\ud87e\ude06":"\u99c2","\uf91a":"\u99f1","\ud87e\ude07":"\u99fe","\uf987":"\u9a6a","\u2ee2":"\u9a6c","\u2fbb":"\u9aa8","\ud87e\ude08":"\u4bce","\u2fbc":"\u9ad8","\u2fbd":"\u9adf","\ud87e\ude09":"\ud866\udf30","\ufacd":"\u9b12","\ud87e\ude0a":"\u9b12","\u2fbe":"\u9b25","\u2fbf":"\u9b2f","\u2fc0":"\u9b32","\u2fc1":"\u9b3c","\u2ee4":"\u9b3c","\u2fc2":"\u9b5a","\uf939":"\u9b6f","\ud87e\ude0b":"\u9c40","\uf9f2":"\u9c57","\u2ee5":"\u9c7c","\u2fc3":"\u9ce5","\ud87e\ude0c":"\u9cfd","\ud87e\ude0d":"\u4cce","\ud87e\ude0f":"\u9d67","\ud87e\ude0e":"\u4ced","\ud87e\ude10":"\ud868\udcce","\ufa2d":"\u9db4","\ud87e\ude12":"\ud868\udd05","\ud87e\ude11":"\u4cf8","\uf93a":"\u9dfa","\ud87e\ude13":"\ud868\ude0e","\uf920":"\u9e1e","\u9e43":"\u9e42","\u2fc4":"\u9e75","\uf940":"\u9e7f","\u2fc5":"\u9e7f","\ud87e\ude14":"\ud868\ude91","\uf988":"\u9e97","\uf9f3":"\u9e9f","\u2fc6":"\u9ea5","\u2ee8":"\u9ea6","\ud87e\ude15":"\u9ebb","\u2fc7":"\u9ebb","\ud87e\udc8f":"\ud868\udf92","\u2fc8":"\u9ec3","\u2ee9":"\u9ec4","\u2fc9":"\u9ecd","\uf989":"\u9ece","\ud87e\ude16":"\u4d56","\u2fca":"\u9ed1","\u9ed2":"\u9ed1","\ufa3a":"\u58a8","\ud87e\ude17":"\u9ef9","\u2fcb":"\u9ef9","\u2fcc":"\u9efd","\ud87e\ude19":"\u9f05","\ud87e\ude18":"\u9efe","\u2fcd":"\u9f0e","\ud87e\ude1a":"\u9f0f","\u2fce":"\u9f13","\ud87e\ude1b":"\u9f16","\u2fcf":"\u9f20","\ud87e\ude1c":"\u9f3b","\u2fd0":"\u9f3b","\ufad8":"\u9f43","\u2fd1":"\u9f4a","\u2eec":"\u9f50","\u2fd2":"\u9f52","\ud87e\ude1d":"\ud869\ude00","\u2eee":"\u9f7f","\uf9c4":"\u9f8d","\u2fd3":"\u9f8d","\ufad9":"\u9f8e","\u2ef0":"\u9f99","\uf907":"\u9f9c","\uf908":"\u9f9c","\uface":"\u9f9c","\u2fd4":"\u9f9c","\u2ef3":"\u9f9f","\u2fd5":"\u9fa0"}')},function(e,t,n){"use strict";var r=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixScheduler=o;var i=r(n(5));n(1);function o(e,t){this.retryAlgorithm=e||o.RETRY_BACKOFF_RATELIMIT,this.queueAlgorithm=t||o.QUEUE_MESSAGES,this._queues={},this._activeQueues=[],this._procFn=null}function s(e){e._procFn&&i.forEach(i.filter(i.keys(e._queues),(function(t){return-1===e._activeQueues.indexOf(t)&&e._queues[t].length>0})),(function(t){e._activeQueues.push(t),c("Spinning up queue: '%s'",t),a(e,t)}))}function a(e,t){var n=function(e,t){var n=e._queues[t];if(!i.isArray(n))return null;return n[0]}(e,t);if(!n){var r=e._activeQueues.indexOf(t);return r>=0&&e._activeQueues.splice(r,1),void c("Stopping queue '%s' as it is now empty",t)}c("Queue '%s' has %s pending events",t,e._queues[t].length),Promise.resolve().then((function(){return e._procFn(n.event)})).then((function(r){u(e,t),c("Queue '%s' sent event %s",t,n.event.getId()),n.defer.resolve(r),a(e,t)}),(function(r){n.attempts+=1;var i=e.retryAlgorithm(n.event,n.attempts,r);c("retry(%s) err=%s event_id=%s waitTime=%s",n.attempts,r,n.event.getId(),i),-1===i?(c("Queue '%s' giving up on event %s",t,n.event.getId()),u(e,t),n.defer.reject(r),a(e,t)):setTimeout((function(){a(e,t)}),i)}))}function u(e,t){var n=e._queues[t];return i.isArray(n)?n.shift():null}function c(){}o.prototype.getQueueForEvent=function(e){var t=this.queueAlgorithm(e);return t&&this._queues[t]?i.map(this._queues[t],(function(e){return e.event})):null},o.prototype.removeEventFromQueue=function(e){var t=this.queueAlgorithm(e);if(!t||!this._queues[t])return!1;var n=!1;return i.removeElement(this._queues[t],(function(t){if(t.event.getId()===e.getId())return n=!0,!0})),n},o.prototype.setProcessFunction=function(e){this._procFn=e,s(this)},o.prototype.queueEvent=function(e){var t=this.queueAlgorithm(e);if(!t)return null;this._queues[t]||(this._queues[t]=[]);var n=i.defer();return this._queues[t].push({event:e,defer:n,attempts:0}),c("Queue algorithm dumped event %s into queue '%s'",e.getId(),t),s(this),n.promise},o.RETRY_BACKOFF_RATELIMIT=function(e,t,n){if(400===n.httpStatus||403===n.httpStatus||401===n.httpStatus)return-1;if("rejected"===n.cors)return-1;if("M_TOO_LARGE"===n.name)return-1;if("M_LIMIT_EXCEEDED"===n.name){var r=n.data.retry_after_ms;if(r)return r}return t>4?-1:1e3*Math.pow(2,t)},o.QUEUE_MESSAGES=function(e){return"m.room.message"===e.getType()||e.hasAssocation()?"message":null}},function(e,t,n){"use strict";(function(e){var r=n(6),i=n(2),o=n(3),s=n(10),a=n(4),u=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixClient=j,t.CRYPTO_ENABLED=void 0;var c=u(n(46)),l=n(11),d=n(103),f=n(48),p=n(110),h=n(16),v=n(27),g=n(116),y=n(118),m=n(51),_=n(119),b=a(n(5)),k=n(33),S=n(34),E=a(n(68)),w=a(n(17)),x=n(50),I=n(123),T=n(1),R=n(126),O=n(74),C=n(73),D=n(41),P=n(47),A=n(28),M=n(76),U=n(75),N=(0,R.isCryptoAvailable)();t.CRYPTO_ENABLED=N;var L=216e5;function K(e,t,n){for(var r=[],i=0,o=Object.entries(e);i<o.length;i++){var a=s(o[i],2),u=a[0],c=a[1];try{var l=B(c,t);l.session_id=u,l.room_id=n,r.push(l)}catch(d){T.logger.log("Failed to decrypt megolm session from backup",d)}}return r}function B(e,t){return JSON.parse(t.decrypt(e.session_data.ephemeral,e.session_data.mac,e.session_data.ciphertext))}function j(e){var t=this;e.baseUrl=b.ensureNoTrailingSlash(e.baseUrl),e.idBaseUrl=b.ensureNoTrailingSlash(e.idBaseUrl),d.MatrixBaseApis.call(this,e),this.olmVersion=null,this.reEmitter=new x.ReEmitter(this),this.usingExternalCrypto=e.usingExternalCrypto,this.store=e.store||new y.StubStore,this.deviceId=e.deviceId||null;var n=e.userId||null;if(this.credentials={userId:n},e.deviceToImport?this.deviceId?T.logger.warn("not importing device because device ID is provided to constructor independently of exported data"):this.credentials.userId?T.logger.warn("not importing device because user ID is provided to constructor independently of exported data"):e.deviceToImport.deviceId?(this.deviceId=e.deviceToImport.deviceId,this.credentials.userId=e.deviceToImport.userId,this._exportedOlmDeviceToImport=e.deviceToImport.olmDevice):T.logger.warn("not importing device because no device ID in exported data"):e.pickleKey&&(this.pickleKey=e.pickleKey),this.scheduler=e.scheduler,this.scheduler){var r=this;this.scheduler.setProcessFunction(function(){var e=o(i.mark((function e(t){var n,o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.getRoom(t.getRoomId()),t.status!==h.EventStatus.SENDING&&$(n,t,h.EventStatus.SENDING),e.next=4,W(r,t);case 4:return o=e.sent,n&&n.updatePendingEvent(t,h.EventStatus.SENT,o.event_id),e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}this.clientRunning=!1;var s=(0,m.createNewMatrixCall)(this);this._supportsVoip=!1,s?(this._callEventHandler=new _.CallEventHandler(this),this._supportsVoip=!0):this._callEventHandler=null,this._syncingRetry=null,this._syncApi=null,this._peekSync=null,this._isGuest=!1,this._ongoingScrollbacks={},this.timelineSupport=Boolean(e.timelineSupport),this.urlPreviewCache={},this._notifTimelineSet=null,this.unstableClientRelationAggregation=!!e.unstableClientRelationAggregation,this._crypto=null,this._cryptoStore=e.cryptoStore,this._sessionStore=e.sessionStore,this._verificationMethods=e.verificationMethods,this._cryptoCallbacks=e.cryptoCallbacks||{},this._forceTURN=e.forceTURN||!1,this._fallbackICEServerAllowed=e.fallbackICEServerAllowed||!1,this._roomList=new I.RoomList(this._cryptoStore),this._pushProcessor=new P.PushProcessor(this),this._serverVersionsPromise=null,this._cachedCapabilities=null,this._clientWellKnown=void 0,this._clientWellKnownPromise=void 0,this.on("Event.decrypted",(function(e){var n=e.getPushActions(),r=t._pushProcessor.actionsForEvent(e);e.setPushActions(r);var i=t.getRoom(e.getRoomId());if(i){var o=i.getUnreadNotificationCount("highlight"),s=!(!n||!n.tweaks)&&!!n.tweaks.highlight,a=!(!r||!r.tweaks)&&!!r.tweaks.highlight;if((s!==a||o>0)&&!i.hasUserReadEvent(t.getUserId(),e.getId())){var u=o;a&&!s&&u++,!a&&s&&u--,i.setUnreadNotificationCount("highlight",u),i.getUnreadNotificationCount("total")<u&&i.setUnreadNotificationCount("total",u)}}})),this.on("Room.receipt",(function(e,n){if(n&&t.isRoomEncrypted(n.roomId)){var r=e.getContent();if(!(Object.keys(r).filter((function(e){return Object.keys(r[e]["m.read"]).includes(t.getUserId())})).length>0))return;for(var i=n.getLiveTimeline().getEvents(),o=0,s=i.length-1;s>=0;s--){if(s===i.length-20)return;var a=i[s];if(n.hasUserReadEvent(t.getUserId(),a.getId()))break;var u=t.getPushActionsForEvent(a);o+=u.tweaks&&u.tweaks.highlight?1:0}n.setUnreadNotificationCount("highlight",o)}}))}function q(e,t,n,r,i,o){return F.apply(this,arguments)}function F(){return(F=o(i.mark((function e(t,n,r,o,s,a){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t._crypto){e.next=2;break}throw new Error("End-to-End encryption disabled");case 2:return e.next=4,t._crypto.setDeviceVerification(n,r,o,s,a);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e,t){var n,i=r(t);try{var o=function(){var t=n.value;e.prototype[t]=function(){var e;if(!this._crypto)throw new Error("End-to-end encryption disabled");return(e=this._crypto)[t].apply(e,arguments)}};for(i.s();!(n=i.n()).done;)o()}catch(s){i.e(s)}finally{i.f()}}function G(e,t,n,r){return Promise.resolve().then((function(){var r=function(e,t,n){if(t.isEncrypted())return null;if(!e.isRoomEncrypted(t.getRoomId()))return null;if(!e._crypto&&e.usingExternalCrypto)return null;if("m.reaction"===t.getType())return null;if(!e._crypto)throw new Error("This room is configured to use encryption, but your client does not support encryption.");return e._crypto.encryptEvent(t,n)}(e,n,t);return r?($(t,n,h.EventStatus.ENCRYPTING),r.then((function(){$(t,n,h.EventStatus.SENDING)}))):null})).then((function(){var r;return e.scheduler&&(r=e.scheduler.queueEvent(n))&&e.scheduler.getQueueForEvent(n).length>1&&$(t,n,h.EventStatus.QUEUED),r||(r=W(e,n),t&&(r=r.then((function(e){return t.updatePendingEvent(n,h.EventStatus.SENT,e.event_id),e})))),r})).then((function(e){return r&&r(null,e),e}),(function(e){T.logger.error("Error sending event",e.stack||e);try{n.error=e,$(t,n,h.EventStatus.NOT_SENT),e.event=n,r&&r(e)}catch(i){T.logger.error("Exception in error handler!",i.stack||e)}throw e}))}function H(e,t,n){return"m.reaction"===n?n:e.isRoomEncrypted(t)?"m.room.encrypted":n}function $(e,t,n){e?e.updatePendingEvent(t,n):t.setStatus(n)}function W(e,t){var n=t.getTxnId();n||(n=e.makeTxnId(),t.setTxnId(n));var r,i={$roomId:t.getRoomId(),$eventType:t.getWireType(),$stateKey:t.getStateKey(),$txnId:n};if(t.isState()){var o="/rooms/$roomId/state/$eventType";t.getStateKey()&&t.getStateKey().length>0&&(o="/rooms/$roomId/state/$eventType/$stateKey"),r=b.encodeUri(o,i)}else if(t.isRedaction()){r=b.encodeUri("/rooms/$roomId/redact/$redactsEventId/$txnId",Object.assign({$redactsEventId:t.event.redacts},i))}else r=b.encodeUri("/rooms/$roomId/send/$eventType/$txnId",i);return e._http.authedRequest(void 0,"PUT",r,void 0,t.getWireContent()).then((function(e){return T.logger.log("Event sent to ".concat(t.getRoomId()," with event id ").concat(e.event_id)),e}))}function z(e,t,n,r,i,o){b.isFunction(i)&&(o=i,i=void 0);var s=b.encodeUri("/rooms/$room_id/$membership",{$room_id:t,$membership:r});return e._http.authedRequest(o,"POST",s,void 0,{user_id:n,reason:i})}function Y(e){e._supportsVoip&&e.turnServer().then((function(t){if(t.uris){T.logger.log("Got TURN URIs: "+t.uris+" refresh in "+t.ttl+" secs");var n={urls:t.uris,username:t.username,credential:t.password};e._turnServers=[n],e._checkTurnServersTimeoutID=setTimeout((function(){Y(e)}),1e3*(t.ttl||3600)*.9)}}),(function(t){T.logger.error("Failed to get TURN URIs"),e._checkTurnServersTimeoutID=setTimeout((function(){Y(e)}),6e4)}))}function Q(e,t,n){e&&e(n),t(n)}function J(e,t,n){e&&e(null,n),t(n)}function X(e,t){var n=Boolean(t&&t.preventReEmit);return function(t){var r=new h.MatrixEvent(t);return r.isEncrypted()&&(n||e.reEmitter.reEmit(r,["Event.decrypted"]),r.attemptDecryption(e._crypto)),n||e.reEmitter.reEmit(r,["Event.replaced"]),r}}b.inherits(j,l.EventEmitter),b.extend(j.prototype,d.MatrixBaseApis.prototype),j.prototype.rehydrateDevice=o(i.mark((function t(){var n,r,o,s,a;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._crypto){t.next=2;break}throw new Error("Cannot rehydrate device after crypto is initialized");case 2:if(this._cryptoCallbacks.getDehydrationKey){t.next=4;break}return t.abrupt("return");case 4:return t.prev=4,t.next=7,this._http.authedRequest(void 0,"GET","/dehydrated_device",void 0,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"});case 7:n=t.sent,t.next=14;break;case 10:return t.prev=10,t.t0=t.catch(4),T.logger.info("could not get dehydrated device",t.t0.toString()),t.abrupt("return");case 14:if(n.device_data&&n.device_id){t.next=17;break}return T.logger.info("no dehydrated device found"),t.abrupt("return");case 17:if(r=new e.Olm.Account,t.prev=18,(o=n.device_data).algorithm===U.DEHYDRATION_ALGORITHM){t.next=23;break}return T.logger.warn("Wrong algorithm for dehydrated device"),t.abrupt("return");case 23:return T.logger.log("unpickling dehydrated device"),t.next=26,this._cryptoCallbacks.getDehydrationKey(o,(function(e){r.unpickle(new Uint8Array(e),o.account)}));case 26:return s=t.sent,r.unpickle(s,o.account),T.logger.log("unpickled device"),t.next=31,this._http.authedRequest(void 0,"POST","/dehydrated_device/claim",void 0,{device_id:n.device_id},{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"});case 31:if(!0!==t.sent.success){t.next=41;break}return this.deviceId=n.device_id,T.logger.info("using dehydrated device"),a=this.pickleKey||"DEFAULT_KEY",this._exportedOlmDeviceToImport={pickledAccount:r.pickle(a),sessions:[],pickleKey:a},r.free(),t.abrupt("return",this.deviceId);case 41:return r.free(),T.logger.info("not using dehydrated device"),t.abrupt("return");case 44:t.next=50;break;case 46:t.prev=46,t.t1=t.catch(18),r.free(),T.logger.warn("could not unpickle",t.t1);case 50:case"end":return t.stop()}}),t,this,[[4,10],[18,46]])}))),j.prototype.setDehydrationKey=function(){var e=o(i.mark((function e(t){var n,r,o=arguments;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>1&&void 0!==o[1]?o[1]:{},r=o.length>2&&void 0!==o[2]?o[2]:void 0,this._crypto){e.next=5;break}return T.logger.warn("not dehydrating device if crypto is not enabled"),e.abrupt("return");case 5:return e.next=7,this._crypto._dehydrationManager.setKeyAndQueueDehydration(t,n,r);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),j.prototype.createDehydratedDevice=function(){var e=o(i.mark((function e(t){var n,r,o=arguments;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>1&&void 0!==o[1]?o[1]:{},r=o.length>2&&void 0!==o[2]?o[2]:void 0,this._crypto){e.next=5;break}return T.logger.warn("not dehydrating device if crypto is not enabled"),e.abrupt("return");case 5:return e.next=7,this._crypto._dehydrationManager.setKey(t,n,r);case 7:return e.next=9,this._crypto._dehydrationManager.dehydrateDevice();case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),j.prototype.exportDevice=o(i.mark((function e(){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._crypto){e.next=3;break}return T.logger.warn("not exporting device if crypto is not enabled"),e.abrupt("return");case 3:return e.t0=this.credentials.userId,e.t1=this.deviceId,e.next=7,this._crypto._olmDevice.export();case 7:return e.t2=e.sent,e.abrupt("return",{userId:e.t0,deviceId:e.t1,olmDevice:e.t2});case 9:case"end":return e.stop()}}),e,this)}))),j.prototype.clearStores=function(){if(this._clientRunning)throw new Error("Cannot clear stores while client is running");var e=[];return e.push(this.store.deleteAllData()),this._cryptoStore&&e.push(this._cryptoStore.deleteAllData()),Promise.all(e)},j.prototype.getUserId=function(){return this.credentials&&this.credentials.userId?this.credentials.userId:null},j.prototype.getDomain=function(){return this.credentials&&this.credentials.userId?this.credentials.userId.replace(/^.*?:/,""):null},j.prototype.getUserIdLocalpart=function(){return this.credentials&&this.credentials.userId?this.credentials.userId.split(":")[0].substring(1):null},j.prototype.getDeviceId=function(){return this.deviceId},j.prototype.supportsVoip=function(){return this._supportsVoip},j.prototype.setForceTURN=function(e){this._forceTURN=e},j.prototype.getSyncState=function(){return this._syncApi?this._syncApi.getSyncState():null},j.prototype.getSyncStateData=function(){return this._syncApi?this._syncApi.getSyncStateData():null},j.prototype.isInitialSyncComplete=function(){var e=this.getSyncState();return!!e&&("PREPARED"===e||"SYNCING"===e)},j.prototype.isGuest=function(){return this._isGuest},j.prototype.getScheduler=function(){return this.scheduler},j.prototype.setGuest=function(e){this._isGuest=e},j.prototype.retryImmediately=function(){return this._syncApi.retryImmediately()},j.prototype.getNotifTimelineSet=function(){return this._notifTimelineSet},j.prototype.setNotifTimelineSet=function(e){this._notifTimelineSet=e},j.prototype.getCapabilities=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=(new Date).getTime();return this._cachedCapabilities&&!t&&n<this._cachedCapabilities.expiration?(T.logger.log("Returning cached capabilities"),Promise.resolve(this._cachedCapabilities.capabilities)):this._http.authedRequest(void 0,"GET","/capabilities").catch((function(e){return T.logger.error(e),null})).then((function(t){t||(t={});var r=t.capabilities||{},i=Object.keys(r).length?L:6e4+5e3*Math.random();return e._cachedCapabilities={capabilities:r,expiration:n+i},T.logger.log("Caching capabilities: ",r),r}))},j.prototype.initCrypto=o(i.mark((function e(){var t,n;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,R.isCryptoAvailable)()){e.next=2;break}throw new Error("End-to-end encryption not supported in this js-sdk build: did you remember to load the olm library?");case 2:if(!this._crypto){e.next=5;break}return T.logger.warn("Attempt to re-initialise e2e encryption on MatrixClient"),e.abrupt("return");case 5:if(this._sessionStore){e.next=7;break}throw new Error("Cannot enable encryption: no sessionStore provided");case 7:if(this._cryptoStore){e.next=9;break}throw new Error("Cannot enable encryption: no cryptoStore provided");case 9:return T.logger.log("Crypto: Starting up crypto store..."),e.next=12,this._cryptoStore.startup();case 12:return T.logger.log("Crypto: initialising roomlist..."),e.next=15,this._roomList.init();case 15:if(null!==(t=this.getUserId())){e.next=18;break}throw new Error("Cannot enable encryption on MatrixClient with unknown userId: ensure userId is passed in createClient().");case 18:if(null!==this.deviceId){e.next=20;break}throw new Error("Cannot enable encryption on MatrixClient with unknown deviceId: ensure deviceId is passed in createClient().");case 20:return n=new R.Crypto(this,this._sessionStore,t,this.deviceId,this.store,this._cryptoStore,this._roomList,this._verificationMethods),this.reEmitter.reEmit(n,["crypto.keyBackupFailed","crypto.keyBackupSessionsRemaining","crypto.roomKeyRequest","crypto.roomKeyRequestCancellation","crypto.warning","crypto.devicesUpdated","crypto.willUpdateDevices","deviceVerificationChanged","userTrustStatusChanged","crossSigning.keysChanged"]),T.logger.log("Crypto: initialising crypto object..."),e.next=25,n.init({exportedOlmDevice:this._exportedOlmDeviceToImport,pickleKey:this.pickleKey});case 25:delete this._exportedOlmDeviceToImport,this.olmVersion=R.Crypto.getOlmVersion(),n.registerEventHandlers(this),this._crypto=n;case 29:case"end":return e.stop()}}),e,this)}))),j.prototype.isCryptoEnabled=function(){return null!==this._crypto},j.prototype.getDeviceEd25519Key=function(){return this._crypto?this._crypto.getDeviceEd25519Key():null},j.prototype.getDeviceCurve25519Key=function(){return this._crypto?this._crypto.getDeviceCurve25519Key():null},j.prototype.uploadKeys=function(){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.uploadDeviceKeys()},j.prototype.downloadKeys=function(e,t){return null===this._crypto?Promise.reject(new Error("End-to-end encryption disabled")):this._crypto.downloadKeys(e,t)},j.prototype.getStoredDevicesForUser=function(e){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.getStoredDevicesForUser(e)||[]},j.prototype.getStoredDevice=function(e,t){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.getStoredDevice(e,t)||null},j.prototype.setDeviceVerified=function(e,t,n){void 0===n&&(n=!0);var r=q(this,e,t,n,null);return e==this.credentials.userId&&this._crypto.checkKeyBackup(),r},j.prototype.setDeviceBlocked=function(e,t,n){return void 0===n&&(n=!0),q(this,e,t,null,n)},j.prototype.setDeviceKnown=function(e,t,n){return void 0===n&&(n=!0),q(this,e,t,null,null,n)},j.prototype.requestVerificationDM=function(e,t){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.requestVerificationDM(e,t)},j.prototype.findVerificationRequestDMInProgress=function(e){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.findVerificationRequestDMInProgress(e)},j.prototype.getVerificationRequestsToDeviceInProgress=function(e){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.getVerificationRequestsToDeviceInProgress(e)},j.prototype.requestVerification=function(e,t){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.requestVerification(e,t)},j.prototype.beginKeyVerification=function(e,t,n){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.beginKeyVerification(e,t,n)},j.prototype.setGlobalBlacklistUnverifiedDevices=function(e){if(null===this._crypto)throw new Error("End-to-end encryption disabled");this._crypto.setGlobalBlacklistUnverifiedDevices(e)},j.prototype.getGlobalBlacklistUnverifiedDevices=function(){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.getGlobalBlacklistUnverifiedDevices()},j.prototype.setGlobalErrorOnUnknownDevices=function(e){if(null===this._crypto)throw new Error("End-to-end encryption disabled");this._crypto.setGlobalErrorOnUnknownDevices(e)},j.prototype.getGlobalErrorOnUnknownDevices=function(){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.getGlobalErrorOnUnknownDevices()},V(j,["getCrossSigningId","getStoredCrossSigningForUser","checkUserTrust","checkDeviceTrust","checkOwnCrossSigningTrust","checkCrossSigningPrivateKey","legacyDeviceVerification","prepareToEncrypt","isCrossSigningReady","bootstrapCrossSigning","getCryptoTrustCrossSignedDevices","setCryptoTrustCrossSignedDevices","countSessionsNeedingBackup"]),V(j,["getEventEncryptionInfo","createRecoveryKeyFromPassphrase","isSecretStorageReady","bootstrapSecretStorage","addSecretStorageKey","hasSecretStorageKey","storeSecret","getSecret","isSecretStored","requestSecret","getDefaultSecretStorageKeyId","setDefaultSecretStorageKeyId","checkSecretStorageKey","checkSecretStoragePrivateKey"]),j.prototype.getEventSenderDeviceInfo=function(){var e=o(i.mark((function e(t){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._crypto){e.next=2;break}return e.abrupt("return",null);case 2:return e.abrupt("return",this._crypto.getEventSenderDeviceInfo(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),j.prototype.isEventSenderVerified=function(){var e=o(i.mark((function e(t){var n;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getEventSenderDeviceInfo(t);case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return",!1);case 5:return e.abrupt("return",n.isVerified());case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),j.prototype.cancelAndResendEventRoomKeyRequest=function(e){return e.cancelAndResendKeyRequest(this._crypto,this.getUserId())},j.prototype.setRoomEncryption=function(e,t){if(!this._crypto)throw new Error("End-to-End encryption disabled");return this._crypto.setRoomEncryption(e,t)},j.prototype.isRoomEncrypted=function(e){var t=this.getRoom(e);return!!t&&(!!t.currentState.getStateEvents("m.room.encryption","")||this._roomList.isRoomEncrypted(e))},j.prototype.forceDiscardSession=function(e){if(!this._crypto)throw new Error("End-to-End encryption disabled");this._crypto.forceDiscardSession(e)},j.prototype.exportRoomKeys=function(){return this._crypto?this._crypto.exportRoomKeys():Promise.reject(new Error("End-to-end encryption disabled"))},j.prototype.importRoomKeys=function(e,t){if(!this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.importRoomKeys(e,t)},j.prototype.checkKeyBackup=function(){return this._crypto.checkKeyBackup()},j.prototype.getKeyBackupVersion=function(){return this._http.authedRequest(void 0,"GET","/room_keys/version",void 0,void 0,{prefix:k.PREFIX_UNSTABLE}).then((function(e){if(e.algorithm!==w.MEGOLM_BACKUP_ALGORITHM){var t="Unknown backup algorithm: "+e.algorithm;return Promise.reject(t)}if("object"===typeof e.auth_data&&e.auth_data.public_key)return e;return Promise.reject("Invalid backup data returned")})).catch((function(e){if("M_NOT_FOUND"===e.errcode)return null;throw e}))},j.prototype.isKeyBackupTrusted=function(e){return this._crypto.isKeyBackupTrusted(e)},j.prototype.getKeyBackupEnabled=function(){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto._checkedForBackup?Boolean(this._crypto.backupKey):null},j.prototype.enableKeyBackup=function(t){if(null===this._crypto)throw new Error("End-to-end encryption disabled");this._crypto.backupInfo=t,this._crypto.backupKey&&this._crypto.backupKey.free(),this._crypto.backupKey=new e.Olm.PkEncryption,this._crypto.backupKey.set_recipient_key(t.auth_data.public_key),this.emit("crypto.keyBackupStatus",!0),this._crypto.scheduleKeyBackupSend()},j.prototype.disableKeyBackup=function(){if(null===this._crypto)throw new Error("End-to-end encryption disabled");this._crypto.backupInfo=null,this._crypto.backupKey&&this._crypto.backupKey.free(),this._crypto.backupKey=null,this.emit("crypto.keyBackupStatus",!1)},j.prototype.prepareKeyBackupVersion=function(){var e=o(i.mark((function e(t){var n,r,o,s,a,u,c,l,d=arguments;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=d.length>1&&void 0!==d[1]?d[1]:{},r=n.secureSecretStorage,o=void 0!==r&&r,null!==this._crypto){e.next=3;break}throw new Error("End-to-end encryption disabled");case 3:return e.next=5,this.createRecoveryKeyFromPassphrase(t);case 5:if(s=e.sent,a=s.keyInfo,u=s.encodedPrivateKey,c=s.privateKey,!o){e.next=13;break}return e.next=12,this.storeSecret("m.megolm_backup.v1",(0,w.encodeBase64)(c));case 12:T.logger.info("Key backup private key stored in secret storage");case 13:return l={public_key:a.pubkey},a.passphrase&&(l.private_key_salt=a.passphrase.salt,l.private_key_iterations=a.passphrase.iterations),e.abrupt("return",{algorithm:w.MEGOLM_BACKUP_ALGORITHM,auth_data:l,recovery_key:u});case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),j.prototype.isKeyBackupKeyStored=o(i.mark((function e(){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.isSecretStored("m.megolm_backup.v1",!1));case 1:case"end":return e.stop()}}),e,this)}))),j.prototype.createKeyBackupVersion=function(){var e=o(i.mark((function e(t){var n,r;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._crypto){e.next=2;break}throw new Error("End-to-end encryption disabled");case 2:return n={algorithm:t.algorithm,auth_data:t.auth_data},e.next=5,this._crypto._signObject(n.auth_data);case 5:if(!this._cryptoCallbacks.getCrossSigningKey||!this._crypto._crossSigningInfo.getId()){e.next=8;break}return e.next=8,this._crypto._crossSigningInfo.signObject(n.auth_data,"master");case 8:return e.next=10,this._http.authedRequest(void 0,"POST","/room_keys/version",void 0,n,{prefix:k.PREFIX_UNSTABLE});case 10:return r=e.sent,e.next=13,this.checkKeyBackup();case 13:return this.getKeyBackupEnabled()||T.logger.error("Key backup not usable even though we just created it"),e.abrupt("return",r);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),j.prototype.deleteKeyBackupVersion=function(e){if(null===this._crypto)throw new Error("End-to-end encryption disabled");this._crypto.backupInfo&&this._crypto.backupInfo.version===e&&this.disableKeyBackup();var t=b.encodeUri("/room_keys/version/$version",{$version:e});return this._http.authedRequest(void 0,"DELETE",t,void 0,void 0,{prefix:k.PREFIX_UNSTABLE})},j.prototype._makeKeyBackupPath=function(e,t,n){return{path:void 0!==t?b.encodeUri("/room_keys/keys/$roomId/$sessionId",{$roomId:e,$sessionId:t}):void 0!==e?b.encodeUri("/room_keys/keys/$roomId",{$roomId:e}):"/room_keys/keys",queryData:void 0===n?void 0:{version:n}}},j.prototype.sendKeyBackup=function(e,t,n,r){if(null===this._crypto)throw new Error("End-to-end encryption disabled");var i=this._makeKeyBackupPath(e,t,n);return this._http.authedRequest(void 0,"PUT",i.path,i.queryData,r,{prefix:k.PREFIX_UNSTABLE})},j.prototype.scheduleAllGroupSessionsForBackup=o(i.mark((function e(){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._crypto){e.next=2;break}throw new Error("End-to-end encryption disabled");case 2:return e.next=4,this._crypto.scheduleAllGroupSessionsForBackup();case 4:case"end":return e.stop()}}),e,this)}))),j.prototype.flagAllGroupSessionsForBackup=function(){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.flagAllGroupSessionsForBackup()},j.prototype.isValidRecoveryKey=function(e){try{return(0,O.decodeRecoveryKey)(e),!0}catch(t){return!1}},j.prototype.keyBackupKeyFromPassword=function(e,t){return(0,C.keyFromAuthData)(t.auth_data,e)},j.prototype.keyBackupKeyFromRecoveryKey=function(e){return(0,O.decodeRecoveryKey)(e)},j.RESTORE_BACKUP_ERROR_BAD_KEY="RESTORE_BACKUP_ERROR_BAD_KEY",j.prototype.restoreKeyBackupWithPassword=function(){var e=o(i.mark((function e(t,n,r,o,s){var a;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,C.keyFromAuthData)(o.auth_data,t);case 2:return a=e.sent,e.abrupt("return",this._restoreKeyBackup(a,n,r,o,s));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}(),j.prototype.restoreKeyBackupWithSecretStorage=function(){var e=o(i.mark((function e(t,n,r,o){var a,u,c,l,d,f;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSecret("m.megolm_backup.v1");case 2:if(a=e.sent,!(u=(0,R.fixBackupKey)(a))){e.next=12;break}return e.next=7,this._crypto.getSecretStorageKey();case 7:return c=e.sent,l=s(c,1),d=l[0],e.next=12,this.storeSecret("m.megolm_backup.v1",u,[d]);case 12:return f=(0,w.decodeBase64)(u||a),e.abrupt("return",this._restoreKeyBackup(f,n,r,t,o));case 14:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),j.prototype.restoreKeyBackupWithRecoveryKey=function(e,t,n,r,i){var o=(0,O.decodeRecoveryKey)(e);return this._restoreKeyBackup(o,t,n,r,i)},j.prototype.restoreKeyBackupWithCache=function(){var e=o(i.mark((function e(t,n,r,o){var s;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._crypto.getSessionBackupPrivateKey();case 2:if(s=e.sent){e.next=5;break}throw new Error("Couldn't get key");case 5:return e.abrupt("return",this._restoreKeyBackup(s,t,n,r,o));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),j.prototype._restoreKeyBackup=function(t,n,i,o){var a=this,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},c=u.cacheCompleteCallback,l=u.progressCallback;if(null===this._crypto)throw new Error("End-to-end encryption disabled");var d,f=0,p=[],h=this._makeKeyBackupPath(n,i,o.version),v=new e.Olm.PkDecryption;try{d=v.init_with_private_key(t)}catch(g){throw v.free(),g}return d!==o.auth_data.public_key?Promise.reject({errcode:j.RESTORE_BACKUP_ERROR_BAD_KEY}):(this._crypto.storeSessionBackupPrivateKey(t).catch((function(e){T.logger.warn("Error caching session backup key:",e)})).then(c),l&&l({stage:"fetch"}),this._http.authedRequest(void 0,"GET",h.path,h.queryData,void 0,{prefix:k.PREFIX_UNSTABLE}).then((function(e){if(e.rooms)for(var t=0,o=Object.entries(e.rooms);t<o.length;t++){var u=s(o[t],2),c=u[0],d=u[1];if(d.sessions){f+=Object.keys(d.sessions).length;var h,y=K(d.sessions,v,c),m=r(y);try{for(m.s();!(h=m.n()).done;){var _=h.value;_.room_id=c,p.push(_)}}catch(k){m.e(k)}finally{m.f()}}}else if(e.sessions)f=Object.keys(e.sessions).length,p=K(e.sessions,v,n);else{f=1;try{var b=B(e,v);b.room_id=n,b.session_id=i,p.push(b)}catch(g){T.logger.log("Failed to decrypt megolm session from backup",g)}}return a.importRoomKeys(p,{progressCallback:l,untrusted:!0,source:"backup"})})).then((function(){return a._crypto.setTrustedBackupPubKey(d)})).then((function(){return{total:f,imported:p.length}})).finally((function(){v.free()})))},j.prototype.deleteKeysFromBackup=function(e,t,n){if(null===this._crypto)throw new Error("End-to-end encryption disabled");var r=this._makeKeyBackupPath(e,t,n);return this._http.authedRequest(void 0,"DELETE",r.path,r.queryData,void 0,{prefix:k.PREFIX_UNSTABLE})},j.prototype.getGroup=function(e){return this.store.getGroup(e)},j.prototype.getGroups=function(){return this.store.getGroups()},j.prototype.getMediaConfig=function(e){return this._http.authedRequest(e,"GET","/config",void 0,void 0,{prefix:k.PREFIX_MEDIA_R0})},j.prototype.getRoom=function(e){return this.store.getRoom(e)},j.prototype.getRooms=function(){return this.store.getRooms()},j.prototype.getVisibleRooms=function(){var e,t=this.store.getRooms(),n=new Set,i=r(t);try{for(i.s();!(e=i.n()).done;){var o=e.value.currentState.getStateEvents("m.room.create","");if(o){var s=o.getContent().predecessor;s&&s.room_id&&n.add(s.room_id)}}}catch(a){i.e(a)}finally{i.f()}return t.filter((function(e){return!e.currentState.getStateEvents("m.room.tombstone","")||!n.has(e.roomId)}))},j.prototype.getUser=function(e){return this.store.getUser(e)},j.prototype.getUsers=function(){return this.store.getUsers()},j.prototype.setAccountData=function(e,t,n){var r=this,i=b.encodeUri("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:e}),o=(0,k.retryNetworkOperation)(5,(function(){return r._http.authedRequest(void 0,"PUT",i,void 0,t)}));return n&&o.then((function(e){return n(null,e)}),n),o},j.prototype.getAccountData=function(e){return this.store.getAccountData(e)},j.prototype.getAccountDataFromServer=function(){var e=o(i.mark((function e(t){var n,r,o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isInitialSyncComplete()){e.next=5;break}if(n=this.store.getAccountData(t)){e.next=4;break}return e.abrupt("return",null);case 4:return e.abrupt("return",n.getContent());case 5:return r=b.encodeUri("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:t}),e.prev=6,e.next=9,this._http.authedRequest(void 0,"GET",r,void 0);case 9:return o=e.sent,e.abrupt("return",o);case 13:if(e.prev=13,e.t0=e.catch(6),!e.t0.data||"M_NOT_FOUND"!==e.t0.data.errcode){e.next=17;break}return e.abrupt("return",null);case 17:throw e.t0;case 18:case"end":return e.stop()}}),e,this,[[6,13]])})));return function(t){return e.apply(this,arguments)}}(),j.prototype.getIgnoredUsers=function(){var e=this.getAccountData("m.ignored_user_list");return e&&e.getContent()&&e.getContent().ignored_users?Object.keys(e.getContent().ignored_users):[]},j.prototype.setIgnoredUsers=function(e,t){var n={ignored_users:{}};return e.map((function(e){return n.ignored_users[e]={}})),this.setAccountData("m.ignored_user_list",n,t)},j.prototype.isUserIgnored=function(e){return-1!==this.getIgnoredUsers().indexOf(e)},j.prototype.joinRoom=function(e,t,n){if(b.isFunction(t))throw new Error("Expected 'opts' object, got function.");void 0===(t=t||{}).syncRoom&&(t.syncRoom=!0);var r=this.getRoom(e);if(r&&r.hasMembershipState(this.credentials.userId,"join"))return Promise.resolve(r);var i=Promise.resolve();t.inviteSignUrl&&(i=this._http.requestOtherUrl(void 0,"POST",t.inviteSignUrl,{mxid:this.credentials.userId}));var o={};t.viaServers&&(o.server_name=t.viaServers);var s={qsStringifyOptions:{arrayFormat:"repeat"}},a=this;return new Promise((function(r,u){i.then((function(t){var n={};t&&(n.third_party_signed=t);var r=b.encodeUri("/join/$roomid",{$roomid:e});return a._http.authedRequest(void 0,"POST",r,o,n,s)})).then((function(e){var n=e.room_id,r=new p.SyncApi(a,a._clientOpts).createRoom(n);return t.syncRoom,Promise.resolve(r)})).then((function(e){J(n,r,e)}),(function(e){Q(n,u,e)}))}))},j.prototype.resendEvent=function(e,t){return $(t,e,h.EventStatus.SENDING),G(this,t,e)},j.prototype.cancelPendingEvent=function(e){if([h.EventStatus.QUEUED,h.EventStatus.NOT_SENT].indexOf(e.status)<0)throw new Error("cannot cancel an event with status "+e.status);this.scheduler&&this.scheduler.removeEventFromQueue(e),$(this.getRoom(e.getRoomId()),e,h.EventStatus.CANCELLED)},j.prototype.setRoomName=function(e,t,n){return this.sendStateEvent(e,"m.room.name",{name:t},void 0,n)},j.prototype.setRoomTopic=function(e,t,n){return this.sendStateEvent(e,"m.room.topic",{topic:t},void 0,n)},j.prototype.getRoomTags=function(e,t){var n=b.encodeUri("/user/$userId/rooms/$roomId/tags/",{$userId:this.credentials.userId,$roomId:e});return this._http.authedRequest(t,"GET",n,void 0)},j.prototype.setRoomTag=function(e,t,n,r){var i=b.encodeUri("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this._http.authedRequest(r,"PUT",i,void 0,n)},j.prototype.deleteRoomTag=function(e,t,n){var r=b.encodeUri("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this._http.authedRequest(n,"DELETE",r,void 0,void 0)},j.prototype.setRoomAccountData=function(e,t,n,r){var i=b.encodeUri("/user/$userId/rooms/$roomId/account_data/$type",{$userId:this.credentials.userId,$roomId:e,$type:t});return this._http.authedRequest(r,"PUT",i,void 0,n)},j.prototype.setPowerLevel=function(e,t,n,r,i){var o={users:{}};r&&"m.room.power_levels"===r.getType()&&(o=b.deepCopy(r.getContent())),o.users[t]=n;var s=b.encodeUri("/rooms/$roomId/state/m.room.power_levels",{$roomId:e});return this._http.authedRequest(i,"PUT",s,void 0,o)},j.prototype.sendEvent=function(e,t,n,r,i){return this._sendCompleteEvent(e,{type:t,content:n},r,i)},j.prototype._sendCompleteEvent=function(e,t,n,r){b.isFunction(n)&&(r=n,n=void 0),n||(n=this.makeTxnId());var i=new h.MatrixEvent(Object.assign(t,{event_id:"~"+e+":"+n,user_id:this.credentials.userId,sender:this.credentials.userId,room_id:e,origin_server_ts:(new Date).getTime()})),o=this.getRoom(e),s=i.getAssociatedId();if(s&&s.startsWith("~")){var a=o.getPendingEvents().find((function(e){return e.getId()===s}));a.once("Event.localEventIdReplaced",(function(){i.updateAssociatedId(a.getId())}))}var u=i.getType();return T.logger.log("sendEvent of type ".concat(u," in ").concat(e," with txnId ").concat(n)),i.setTxnId(n),i.setStatus(h.EventStatus.SENDING),o&&o.addPendingEvent(i,n),i.status===h.EventStatus.NOT_SENT?Promise.reject(new Error("Event blocked by other events not yet sent")):G(this,o,i,r)},j.prototype.redactEvent=function(e,t,n,r){var i=("object"===typeof r?r:{}).reason,o="function"===typeof r?r:void 0;return this._sendCompleteEvent(e,{type:"m.room.redaction",content:{reason:i},redacts:t},n,o)},j.prototype.sendMessage=function(e,t,n,r){return b.isFunction(n)&&(r=n,n=void 0),this.sendEvent(e,"m.room.message",t,n,r)},j.prototype.sendTextMessage=function(e,t,n,r){var i=E.makeTextMessage(t);return this.sendMessage(e,i,n,r)},j.prototype.sendNotice=function(e,t,n,r){var i=E.makeNotice(t);return this.sendMessage(e,i,n,r)},j.prototype.sendEmoteMessage=function(e,t,n,r){var i=E.makeEmoteMessage(t);return this.sendMessage(e,i,n,r)},j.prototype.sendImageMessage=function(e,t,n,r,i){b.isFunction(r)&&(i=r,r=void 0),r||(r="Image");var o={msgtype:"m.image",url:t,info:n,body:r};return this.sendMessage(e,o,i)},j.prototype.sendStickerMessage=function(e,t,n,r,i){b.isFunction(r)&&(i=r,r=void 0),r||(r="Sticker");var o={url:t,info:n,body:r};return this.sendEvent(e,"m.sticker",o,i,void 0)},j.prototype.sendHtmlMessage=function(e,t,n,r){var i=E.makeHtmlMessage(t,n);return this.sendMessage(e,i,r)},j.prototype.sendHtmlNotice=function(e,t,n,r){var i=E.makeHtmlNotice(t,n);return this.sendMessage(e,i,r)},j.prototype.sendHtmlEmote=function(e,t,n,r){var i=E.makeHtmlEmote(t,n);return this.sendMessage(e,i,r)},j.prototype.sendReceipt=function(e,t,n,r){if("function"===typeof n&&(r=n,n={}),this.isGuest())return Promise.resolve({});var i=b.encodeUri("/rooms/$roomId/receipt/$receiptType/$eventId",{$roomId:e.getRoomId(),$receiptType:t,$eventId:e.getId()}),o=this._http.authedRequest(r,"POST",i,void 0,n||{}),s=this.getRoom(e.getRoomId());return s&&s._addLocalEchoReceipt(this.credentials.userId,e,t),o},j.prototype.sendReadReceipt=function(){var e=o(i.mark((function e(t,n,r){var o,s,a;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"===typeof n&&(r=n,n={}),n||(n={}),o=t.getId(),!(s=this.getRoom(t.getRoomId()))||!s.hasPendingEvent(o)){e.next=6;break}throw new Error("Cannot set read receipt to a pending event (".concat(o,")"));case 6:return a={"m.hidden":Boolean(n.hidden)},e.abrupt("return",this.sendReceipt(t,"m.read",a,r));case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),j.prototype.setRoomReadMarkers=function(){var e=o(i.mark((function e(t,n,r,o){var s,a;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(s=this.getRoom(t))||!s.hasPendingEvent(n)){e.next=3;break}throw new Error("Cannot set read marker to a pending event (".concat(n,")"));case 3:if(!r){e.next=8;break}if(a=r.getId(),!s||!s.hasPendingEvent(a)){e.next=7;break}throw new Error("Cannot set read receipt to a pending event (".concat(a,")"));case 7:s&&s._addLocalEchoReceipt(this.credentials.userId,r,"m.read");case 8:return e.abrupt("return",this.setRoomReadMarkersHttpRequest(t,n,a,o));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),j.prototype.getUrlPreview=function(e,t,n){var r=(t=6e4*Math.floor(t/6e4))+"_"+e,i=this.urlPreviewCache[r];if(i)return n&&i.then(n).catch(n),i;var o=this._http.authedRequest(n,"GET","/preview_url",{url:e,ts:t},void 0,{prefix:k.PREFIX_MEDIA_R0});return this.urlPreviewCache[r]=o,o},j.prototype.sendTyping=function(e,t,n,r){if(this.isGuest())return Promise.resolve({});var i=b.encodeUri("/rooms/$roomId/typing/$userId",{$roomId:e,$userId:this.credentials.userId}),o={typing:t};return t&&(o.timeout=n||2e4),this._http.authedRequest(r,"PUT",i,void 0,o)},j.prototype.getRoomUpgradeHistory=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.getRoom(e);if(!n)return[];for(var r=[n],i=n.currentState.getStateEvents("m.room.create","");i;){T.logger.log("Looking at ".concat(i.getId()));var o=i.getContent().predecessor;if(!o||!o.room_id)break;T.logger.log("Looking at predecessor ".concat(o.room_id));var s=this.getRoom(o.room_id);if(!s)break;if(t){var a=s.currentState.getStateEvents("m.room.tombstone","");if(!a||a.getContent().replacement_room!==s.roomId)break}r.splice(0,0,s),i=s.currentState.getStateEvents("m.room.create","")}for(var u=n.currentState.getStateEvents("m.room.tombstone","");u;){var c=this.getRoom(u.getContent().replacement_room);if(!c)break;if(c.roomId===n.roomId)break;if(t){if(!(i=c.currentState.getStateEvents("m.room.create",""))||!i.getContent().predecessor)break;var l=i.getContent().predecessor;if(l.room_id!==n.roomId)break}r.push(c);var d=new Set(r.map((function(e){return e.roomId})));if(d.size<r.length)return r.slice(0,r.length-1);u=(n=c).currentState.getStateEvents("m.room.tombstone","")}return r},j.prototype.invite=function(e,t,n){return z(this,e,t,"invite",void 0,n)},j.prototype.inviteByEmail=function(e,t,n){return this.inviteByThreePid(e,"email",t,n)},j.prototype.inviteByThreePid=function(){var e=o(i.mark((function e(t,n,r,o){var s,a,u,c;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=b.encodeUri("/rooms/$roomId/invite",{$roomId:t}),a=this.getIdentityServerUrl(!0)){e.next=4;break}return e.abrupt("return",Promise.reject(new k.MatrixError({error:"No supplied identity server URL",errcode:"ORG.MATRIX.JSSDK_MISSING_PARAM"})));case 4:if(u={id_server:a,medium:n,address:r},e.t0=this.identityServer&&this.identityServer.getAccessToken,!e.t0){e.next=10;break}return e.next=9,this.doesServerAcceptIdentityAccessToken();case 9:e.t0=e.sent;case 10:if(!e.t0){e.next=15;break}return e.next=13,this.identityServer.getAccessToken();case 13:(c=e.sent)&&(u.id_access_token=c);case 15:return e.abrupt("return",this._http.authedRequest(o,"POST",s,void 0,u));case 16:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),j.prototype.leave=function(e,t){return z(this,e,void 0,"leave",void 0,t)},j.prototype.leaveRoomChain=function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.getRoomUpgradeHistory(e),o=i;if(!n){o=[];var s,a=r(i);try{for(a.s();!(s=a.n()).done;){var u=s.value;if(o.push(u),u.roomId===e)break}}catch(v){a.e(v)}finally{a.f()}}var c,l={},d=[],f=function(e){return t.leave(e).then((function(){l[e]=null})).catch((function(t){return l[e]=t,null}))},p=r(o);try{for(p.s();!(c=p.n()).done;){var h=c.value;d.push(f(h.roomId))}}catch(v){p.e(v)}finally{p.f()}return Promise.all(d).then((function(){return l}))},j.prototype.ban=function(e,t,n,r){return z(this,e,t,"ban",n,r)},j.prototype.forget=function(e,t,n){void 0===t&&(t=!0);var r=z(this,e,void 0,"forget",void 0,n);if(!t)return r;var i=this;return r.then((function(t){return i.store.removeRoom(e),i.emit("deleteRoom",e),t}))},j.prototype.unban=function(e,t,n){var r=b.encodeUri("/rooms/$roomId/unban",{$roomId:e}),i={user_id:t};return this._http.authedRequest(n,"POST",r,void 0,i)},j.prototype.kick=function(e,t,n,r){return function(e,t,n,r,i,o){b.isFunction(i)&&(o=i,i=void 0);var s=b.encodeUri("/rooms/$roomId/state/m.room.member/$userId",{$roomId:t,$userId:n});return e._http.authedRequest(o,"PUT",s,void 0,{membership:r,reason:i})}(this,e,t,"leave",n,r)},j.prototype.getPushActionsForEvent=function(e){return e.getPushActions()||e.setPushActions(this._pushProcessor.actionsForEvent(e)),e.getPushActions()},j.prototype.setProfileInfo=function(e,t,n){var r=b.encodeUri("/profile/$userId/$info",{$userId:this.credentials.userId,$info:e});return this._http.authedRequest(n,"PUT",r,void 0,t)},j.prototype.setDisplayName=function(){var e=o(i.mark((function e(t,n){var r,o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setProfileInfo("displayname",{displayname:t},n);case 2:return r=e.sent,(o=this.getUser(this.getUserId()))&&(o.displayName=t,o.emit("User.displayName",o.events.presence,o)),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),j.prototype.setAvatarUrl=function(){var e=o(i.mark((function e(t,n){var r,o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setProfileInfo("avatar_url",{avatar_url:t},n);case 2:return r=e.sent,(o=this.getUser(this.getUserId()))&&(o.avatarUrl=t,o.emit("User.avatarUrl",o.events.presence,o)),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),j.prototype.mxcUrlToHttp=function(e,t,n,r,i){return(0,S.getHttpUriForMxc)(this.baseUrl,e,t,n,r,i)},j.prototype._unstable_setStatusMessage=function(e){var t=this,n="im.vector.user_status";return Promise.all(this.getRooms().map((function(r){var i="join"===r.getMyMembership(),o=2===r.getInvitedAndJoinedMemberCount();return i&&o&&r.currentState.mayClientSendStateEvent(n,t)?t.sendStateEvent(r.roomId,n,{status:e},t.getUserId()):Promise.resolve()})))},j.prototype.setPresence=function(e,t){var n=b.encodeUri("/presence/$userId/status",{$userId:this.credentials.userId});"string"===typeof e&&(e={presence:e});if(-1==["offline","online","unavailable"].indexOf(e.presence))throw new Error("Bad presence value: "+e.presence);return this._http.authedRequest(t,"PUT",n,void 0,e)},j.prototype.scrollback=function(e,t,n){b.isFunction(t)&&(n=t,t=void 0),t=t||30;var r=0,i=this._ongoingScrollbacks[e.roomId]||{};if(i.promise)return i.promise;if(i.errorTs){var o=Date.now()-i.errorTs;r=Math.max(3e3-o,0)}if(null===e.oldState.paginationToken)return Promise.resolve(e);var s=this.store.scrollback(e,t).length;if(s===t)return Promise.resolve(e);t-=s;var a=this,u=new Promise((function(i,o){(0,b.sleep)(r).then((function(){return a._createMessagesRequest(e.roomId,e.oldState.paginationToken,t,"b")})).then((function(t){var r=b.map(t.chunk,X(a));if(t.state){var o=b.map(t.state,X(a));e.currentState.setUnknownStateEvents(o)}e.addEventsToTimeline(r,!0,e.getLiveTimeline()),e.oldState.paginationToken=t.end,0===t.chunk.length&&(e.oldState.paginationToken=null),a.store.storeEvents(e,r,t.end,!0),a._ongoingScrollbacks[e.roomId]=null,J(n,i,e)}),(function(t){a._ongoingScrollbacks[e.roomId]={errorTs:Date.now()},Q(n,o,t)}))}));return i={promise:u,errorTs:null},this._ongoingScrollbacks[e.roomId]=i,u},j.prototype.getEventTimeline=function(e,t){if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(e.getTimelineForEvent(t))return Promise.resolve(e.getTimelineForEvent(t));var n=b.encodeUri("/rooms/$roomId/context/$eventId",{$roomId:e.room.roomId,$eventId:t}),r=void 0;this._clientOpts.lazyLoadMembers&&(r={filter:JSON.stringify(f.Filter.LAZY_LOADING_MESSAGES_FILTER)});var i=this;return i._http.authedRequest(void 0,"GET",n,r).then((function(n){if(!n.event)throw new Error("'event' not in '/context' result - homeserver too old?");if(e.getTimelineForEvent(t))return e.getTimelineForEvent(t);n.events_after.reverse();var r=n.events_after.concat([n.event]).concat(n.events_before),o=b.map(r,i.getEventMapper()),s=e.getTimelineForEvent(o[0].getId());if(s){var a=b.map(n.state,i.getEventMapper());s.getState(v.EventTimeline.BACKWARDS).setUnknownStateEvents(a)}else(s=e.addTimeline()).initialiseState(b.map(n.state,i.getEventMapper())),s.getState(v.EventTimeline.FORWARDS).paginationToken=n.end;return e.addEventsToTimeline(o,!0,s,n.start),e.getTimelineForEvent(t)||s}))},j.prototype._createMessagesRequest=function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,o=b.encodeUri("/rooms/$roomId/messages",{$roomId:e});void 0===n&&(n=30);var s={from:t,limit:n,dir:r},a=null;return this._clientOpts.lazyLoadMembers&&(a=Object.assign({},f.Filter.LAZY_LOADING_MESSAGES_FILTER)),i&&(a=a||{},Object.assign(a,i.getRoomTimelineFilterComponent())),a&&(s.filter=JSON.stringify(a)),this._http.authedRequest(void 0,"GET",o,s)},j.prototype.paginateEventTimeline=function(e,t){var n=e.getTimelineSet()===this._notifTimelineSet,r=(t=t||{}).backwards||!1;if(n&&!r)throw new Error("paginateNotifTimeline can only paginate backwards");var i=r?v.EventTimeline.BACKWARDS:v.EventTimeline.FORWARDS,o=e.getPaginationToken(i);if(!o)return Promise.resolve(!1);var s,a,u=e._paginationRequests[i];if(u)return u;var c=this;if(n)"/notifications",s={limit:"limit"in t?t.limit:30,only:"highlight"},o&&"end"!==o&&(s.from=o),a=this._http.authedRequest(void 0,"GET","/notifications",s,void 0).then((function(t){for(var n=t.next_token,o=[],s=0;s<t.notifications.length;s++){var a=t.notifications[s],u=c.getEventMapper()(a.event);u.setPushActions(P.PushProcessor.actionListToActionsObject(a.actions)),u.event.room_id=a.room_id,o[s]=u}return e.getTimelineSet().addEventsToTimeline(o,r,e,n),r&&!t.next_token&&e.setPaginationToken(null,i),!!t.next_token})).finally((function(){e._paginationRequests[i]=null})),e._paginationRequests[i]=a;else{if(!this.getRoom(e.getRoomId()))throw new Error("Unknown room "+e.getRoomId());(a=this._createMessagesRequest(e.getRoomId(),o,t.limit,i,e.getFilter())).then((function(t){if(t.state){var n=e.getState(i),o=b.map(t.state,c.getEventMapper());n.setUnknownStateEvents(o)}var s=t.end,a=b.map(t.chunk,c.getEventMapper());return e.getTimelineSet().addEventsToTimeline(a,r,e,s),r&&t.end==t.start&&e.setPaginationToken(null,i),t.end!=t.start})).finally((function(){e._paginationRequests[i]=null})),e._paginationRequests[i]=a}return a},j.prototype.resetNotifTimelineSet=function(){this._notifTimelineSet&&this._notifTimelineSet.resetLiveTimeline("end",null)},j.prototype.peekInRoom=function(e){return this._peekSync&&this._peekSync.stopPeeking(),this._peekSync=new p.SyncApi(this,this._clientOpts),this._peekSync.peek(e)},j.prototype.stopPeeking=function(){this._peekSync&&(this._peekSync.stopPeeking(),this._peekSync=null)},j.prototype.setGuestAccess=function(e,t){var n=this.sendStateEvent(e,"m.room.guest_access",{guest_access:t.allowJoin?"can_join":"forbidden"}),r=Promise.resolve();return t.allowRead&&(r=this.sendStateEvent(e,"m.room.history_visibility",{history_visibility:"world_readable"})),Promise.all([r,n])},j.prototype.requestRegisterEmailToken=function(e,t,n,r){return this._requestTokenFromEndpoint("/register/email/requestToken",{email:e,client_secret:t,send_attempt:n,next_link:r})},j.prototype.requestRegisterMsisdnToken=function(e,t,n,r,i){return this._requestTokenFromEndpoint("/register/msisdn/requestToken",{country:e,phone_number:t,client_secret:n,send_attempt:r,next_link:i})},j.prototype.requestAdd3pidEmailToken=function(e,t,n,r){return this._requestTokenFromEndpoint("/account/3pid/email/requestToken",{email:e,client_secret:t,send_attempt:n,next_link:r})},j.prototype.requestAdd3pidMsisdnToken=function(e,t,n,r,i){return this._requestTokenFromEndpoint("/account/3pid/msisdn/requestToken",{country:e,phone_number:t,client_secret:n,send_attempt:r,next_link:i})},j.prototype.requestPasswordEmailToken=function(e,t,n,r){return this._requestTokenFromEndpoint("/account/password/email/requestToken",{email:e,client_secret:t,send_attempt:n,next_link:r})},j.prototype.requestPasswordMsisdnToken=function(e,t,n,r,i){return this._requestTokenFromEndpoint("/account/password/msisdn/requestToken",{country:e,phone_number:t,client_secret:n,send_attempt:r,next_link:i})},j.prototype._requestTokenFromEndpoint=function(){var e=o(i.mark((function e(t,n){var r,o,s;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object.assign({},n),e.next=3,this.doesServerSupportSeparateAddAndBind();case 3:if(e.t0=!e.sent,!e.t0){e.next=6;break}e.t0=this.idBaseUrl;case 6:if(!e.t0){e.next=21;break}if((o=c.default.parse(this.idBaseUrl)).host){e.next=10;break}throw new Error("Invalid ID server URL: "+this.idBaseUrl);case 10:if(r.id_server=o.host,e.t1=this.identityServer&&this.identityServer.getAccessToken,!e.t1){e.next=16;break}return e.next=15,this.doesServerAcceptIdentityAccessToken();case 15:e.t1=e.sent;case 16:if(!e.t1){e.next=21;break}return e.next=19,this.identityServer.getAccessToken();case 19:(s=e.sent)&&(r.id_access_token=s);case 21:return e.abrupt("return",this._http.request(void 0,"POST",t,void 0,r));case 22:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),j.prototype.getRoomPushRule=function(e,t){if(!this.pushRules)throw new Error("SyncApi.sync() must be done before accessing to push rules.");for(var n=0;n<this.pushRules[e].room.length;n++){var r=this.pushRules[e].room[n];if(r.rule_id===t)return r}},j.prototype.setRoomMutePushRule=function(e,t,n){var r,i,o=this,s=this.getRoomPushRule(e,t);if(s&&0<=s.actions.indexOf("dont_notify")&&(i=!0),n?s?i||(r=b.defer(),this.deletePushRule(e,"room",s.rule_id).then((function(){o.addPushRule(e,"room",t,{actions:["dont_notify"]}).then((function(){r.resolve()}),(function(e){r.reject(e)}))}),(function(e){r.reject(e)})),r=r.promise):r=this.addPushRule(e,"room",t,{actions:["dont_notify"]}):i&&(r=this.deletePushRule(e,"room",s.rule_id)),r)return new Promise((function(e,t){r.then((function(){o.getPushRules().then((function(t){o.pushRules=t,e()}),(function(e){t(e)}))}),(function(e){o.getPushRules().then((function(n){o.pushRules=n,t(e)}),(function(n){t(e)}))}))}))},j.prototype.searchMessageText=function(e,t){var n={search_term:e.query};return"keys"in e&&(n.keys=e.keys),this.search({body:{search_categories:{room_events:n}}},t)},j.prototype.searchRoomEvents=function(e){var t={search_categories:{room_events:{search_term:e.term,filter:e.filter,order_by:"recent",event_context:{before_limit:1,after_limit:1,include_profile:!0}}}},n={_query:t,results:[],highlights:[]};return this.search({body:t}).then(this._processRoomEventsSearch.bind(this,n))},j.prototype.backPaginateRoomEventsSearch=function(e){if(!e.next_batch)return Promise.reject(new Error("Cannot backpaginate event search any further"));if(e.pendingRequest)return e.pendingRequest;var t={body:e._query,next_batch:e.next_batch},n=this.search(t).then(this._processRoomEventsSearch.bind(this,e)).finally((function(){e.pendingRequest=null}));return e.pendingRequest=n,n},j.prototype._processRoomEventsSearch=function(e,t){var n=t.search_categories.room_events;e.count=n.count,e.next_batch=n.next_batch;var r={};n.highlights.forEach((function(e){r[e]=1})),e.highlights.forEach((function(e){r[e]=1})),e.highlights=Object.keys(r);for(var i=0;i<n.results.length;i++){var o=g.SearchResult.fromJson(n.results[i],this.getEventMapper());e.results.push(o)}return e},j.prototype.syncLeftRooms=function(){if(this._syncedLeftRooms)return Promise.resolve([]);if(this._syncLeftRoomsPromise)return this._syncLeftRoomsPromise;var e=this,t=new p.SyncApi(this,this._clientOpts);return this._syncLeftRoomsPromise=t.syncLeftRooms(),this._syncLeftRoomsPromise.then((function(t){T.logger.log("Marking success of sync left room request"),e._syncedLeftRooms=!0})).finally((function(){e._syncLeftRoomsPromise=null})),this._syncLeftRoomsPromise},j.prototype.createFilter=function(e){var t=this,n=b.encodeUri("/user/$userId/filter",{$userId:this.credentials.userId});return this._http.authedRequest(void 0,"POST",n,void 0,e).then((function(n){var r=f.Filter.fromJson(t.credentials.userId,n.filter_id,e);return t.store.storeFilter(r),r}))},j.prototype.getFilter=function(e,t,n){if(n){var r=this.store.getFilter(e,t);if(r)return Promise.resolve(r)}var i=this,o=b.encodeUri("/user/$userId/filter/$filterId",{$userId:e,$filterId:t});return this._http.authedRequest(void 0,"GET",o,void 0,void 0).then((function(n){var r=f.Filter.fromJson(e,t,n);return i.store.storeFilter(r),r}))},j.prototype.getOrCreateFilter=function(){var e=o(i.mark((function e(t,n){var r,o,s,a,u,c;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.store.getFilterIdByName(t),o=void 0,!r){e.next=15;break}return e.prev=3,e.next=6,this.getFilter(this.credentials.userId,r,!0);case 6:(s=e.sent)&&(a=s.getDefinition(),u=n.getDefinition(),b.deepCompare(a,u)&&(o=r)),e.next=14;break;case 10:if(e.prev=10,e.t0=e.catch(3),"M_UNKNOWN"===e.t0.errcode||"M_NOT_FOUND"===e.t0.errcode){e.next=14;break}throw e.t0;case 14:o||this.store.setFilterIdByName(t,void 0);case 15:if(!o){e.next=17;break}return e.abrupt("return",o);case 17:return e.next=19,this.createFilter(n.getDefinition());case 19:return c=e.sent,this.store.setFilterIdByName(t,c.filterId),e.abrupt("return",c.filterId);case 22:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(t,n){return e.apply(this,arguments)}}(),j.prototype.getOpenIdToken=function(){var e=b.encodeUri("/user/$userId/openid/request_token",{$userId:this.credentials.userId});return this._http.authedRequest(void 0,"POST",e,void 0,{})},j.prototype.turnServer=function(e){return this._http.authedRequest(e,"GET","/voip/turnServer")},j.prototype.getTurnServers=function(){return this._turnServers||[]},j.prototype.setFallbackICEServerAllowed=function(e){this._fallbackICEServerAllowed=e},j.prototype.isFallbackICEServerAllowed=function(){return this._fallbackICEServerAllowed},j.prototype.isSynapseAdministrator=function(){var e=b.encodeUri("/_synapse/admin/v1/users/$userId/admin",{$userId:this.getUserId()});return this._http.authedRequest(void 0,"GET",e,void 0,void 0,{prefix:""}).then((function(e){return e.admin}))},j.prototype.whoisSynapseUser=function(e){var t=b.encodeUri("/_synapse/admin/v1/whois/$userId",{$userId:e});return this._http.authedRequest(void 0,"GET",t,void 0,void 0,{prefix:""})},j.prototype.deactivateSynapseUser=function(e){var t=b.encodeUri("/_synapse/admin/v1/deactivate/$userId",{$userId:e});return this._http.authedRequest(void 0,"POST",t,void 0,void 0,{prefix:""})},j.prototype.startClient=function(){var e=o(i.mark((function e(t){var n,r=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.clientRunning){e.next=2;break}return e.abrupt("return");case 2:this.clientRunning=!0,"number"===typeof t&&(t={initialSyncLimit:t}),(n=this.getUserId())&&this.store.storeUser(new A.User(n)),this._crypto&&(this._crypto.uploadDeviceKeys(),this._crypto.start()),Y(this),this._syncApi&&(T.logger.error("Still have sync object whilst not running: stopping old one"),this._syncApi.stop()),(t=Object.assign({},t)).crypto=this._crypto,t.canResetEntireTimeline=function(e){return!!r._canResetTimelineCallback&&r._canResetTimelineCallback(e)},this._clientOpts=t,this._syncApi=new p.SyncApi(this,t),this._syncApi.sync(),void 0!==t.clientWellKnownPollPeriod&&(this._clientWellKnownIntervalID=setInterval((function(){r._fetchClientWellKnown()}),1e3*t.clientWellKnownPollPeriod),this._fetchClientWellKnown());case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),j.prototype._fetchClientWellKnown=o(i.mark((function e(){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._clientWellKnownPromise=M.AutoDiscovery.getRawClientConfig(this.getDomain()),e.next=3,this._clientWellKnownPromise;case 3:this._clientWellKnown=e.sent,this.emit("WellKnown.client",this._clientWellKnown);case 5:case"end":return e.stop()}}),e,this)}))),j.prototype.getClientWellKnown=function(){return this._clientWellKnown},j.prototype.waitForClientWellKnown=function(){return this._clientWellKnownPromise},j.prototype._storeClientOptions=function(){var e=["boolean","string","number"],t=Object.entries(this._clientOpts).filter((function(t){var n=s(t,2),r=(n[0],n[1]);return e.includes(typeof r)})).reduce((function(e,t){var n=s(t,2),r=n[0],i=n[1];return e[r]=i,e}),{});return this.store.storeClientOptions(t)},j.prototype.stopClient=function(){T.logger.log("stopping MatrixClient"),this.clientRunning=!1,this._syncApi&&(this._syncApi.stop(),this._syncApi=null),this._crypto&&this._crypto.stop(),this._peekSync&&this._peekSync.stopPeeking(),this._callEventHandler&&(this._callEventHandler.stop(),this._callEventHandler=null),e.clearTimeout(this._checkTurnServersTimeoutID),void 0!==this._clientWellKnownIntervalID&&e.clearInterval(this._clientWellKnownIntervalID)},j.prototype.getVersions=function(){var e=this;return this._serverVersionsPromise||(this._serverVersionsPromise=this._http.request(void 0,"GET","/_matrix/client/versions",void 0,void 0,{prefix:""}).catch((function(t){throw e._serverVersionsPromise=null,t}))),this._serverVersionsPromise},j.prototype.isVersionSupported=function(){var e=o(i.mark((function e(t){var n,r;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getVersions();case 2:return n=e.sent,r=n.versions,e.abrupt("return",r&&r.includes(t));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),j.prototype.doesServerSupportLazyLoading=o(i.mark((function e(){var t,n,r;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getVersions();case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",!1);case 5:return n=t.versions,r=t.unstable_features,e.abrupt("return",n&&n.includes("r0.5.0")||r&&r["m.lazy_load_members"]);case 8:case"end":return e.stop()}}),e,this)}))),j.prototype.doesServerRequireIdServerParam=o(i.mark((function e(){var t,n,r;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getVersions();case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",!0);case 5:if(!(n=t.versions)||!n.includes("r0.6.0")){e.next=8;break}return e.abrupt("return",!1);case 8:if(r=t.unstable_features){e.next=11;break}return e.abrupt("return",!0);case 11:if(void 0!==r["m.require_identity_server"]){e.next=15;break}return e.abrupt("return",!0);case 15:return e.abrupt("return",r["m.require_identity_server"]);case 16:case"end":return e.stop()}}),e,this)}))),j.prototype.doesServerAcceptIdentityAccessToken=o(i.mark((function e(){var t,n,r;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getVersions();case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",!1);case 5:return n=t.versions,r=t.unstable_features,e.abrupt("return",n&&n.includes("r0.6.0")||r&&r["m.id_access_token"]);case 8:case"end":return e.stop()}}),e,this)}))),j.prototype.doesServerSupportSeparateAddAndBind=o(i.mark((function e(){var t,n,r;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getVersions();case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",!1);case 5:return n=t.versions,r=t.unstable_features,e.abrupt("return",n&&n.includes("r0.6.0")||r&&r["m.separate_add_and_bind"]);case 8:case"end":return e.stop()}}),e,this)}))),j.prototype.doesServerSupportUnstableFeature=function(){var e=o(i.mark((function e(t){var n,r;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getVersions();case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return",!1);case 5:return r=n.unstable_features,e.abrupt("return",r&&!!r[t]);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),j.prototype.doesServerForceEncryptionForPreset=function(){var e=o(i.mark((function e(t){var n,r;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getVersions();case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return",!1);case 5:return r=n.unstable_features,e.abrupt("return",r&&!!r["io.element.e2ee_forced.".concat(t)]);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),j.prototype.hasLazyLoadMembersEnabled=function(){return!!this._clientOpts.lazyLoadMembers},j.prototype.setCanResetTimelineCallback=function(e){this._canResetTimelineCallback=e},j.prototype.getCanResetTimelineCallback=function(){return this._canResetTimelineCallback},j.prototype.relations=function(){var e=o(i.mark((function e(t,n,r,o){var s,a,u,c,l,d,f,p=arguments;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=p.length>4&&void 0!==p[4]?p[4]:{},a=H(this,t,o),e.next=4,this.fetchRelations(t,n,r,a,s);case 4:if(u=e.sent,c=this.getEventMapper(),u.original_event&&(l=c(u.original_event)),d=u.chunk.map(c),"m.room.encrypted"!==a){e.next=13;break}return f=l?d.concat(l):d,e.next=12,Promise.all(f.map((function(e){return new Promise((function(t){return e.once("Event.decrypted",t)}))})));case 12:d=d.filter((function(e){return e.getType()===o}));case 13:return e.abrupt("return",{originalEvent:l,events:d,nextBatch:u.next_batch});case 14:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),j.prototype.getEventMapper=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return X(this,e)},j.prototype.getCrossSigningCacheCallbacks=function(){return this._crypto&&this._crypto._crossSigningInfo.getCacheCallbacks()},j.prototype.generateClientSecret=function(){return(0,D.randomString)(32)}}).call(this,n(9))},function(e,t,n){(function(e,r){var i;!function(o){t&&t.nodeType,e&&e.nodeType;var s="object"==typeof r&&r;s.global!==s&&s.window!==s&&s.self;var a,u=2147483647,c=36,l=/^xn--/,d=/[^\x20-\x7E]/,f=/[\x2E\u3002\uFF0E\uFF61]/g,p={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},h=Math.floor,v=String.fromCharCode;function g(e){throw new RangeError(p[e])}function y(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function m(e,t){var n=e.split("@"),r="";return n.length>1&&(r=n[0]+"@",e=n[1]),r+y((e=e.replace(f,".")).split("."),t).join(".")}function _(e){for(var t,n,r=[],i=0,o=e.length;i<o;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<o?56320==(64512&(n=e.charCodeAt(i++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--):r.push(t);return r}function b(e){return y(e,(function(e){var t="";return e>65535&&(t+=v((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=v(e)})).join("")}function k(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function S(e,t,n){var r=0;for(e=n?h(e/700):e>>1,e+=h(e/t);e>455;r+=c)e=h(e/35);return h(r+36*e/(e+38))}function E(e){var t,n,r,i,o,s,a,l,d,f,p,v=[],y=e.length,m=0,_=128,k=72;for((n=e.lastIndexOf("-"))<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&g("not-basic"),v.push(e.charCodeAt(r));for(i=n>0?n+1:0;i<y;){for(o=m,s=1,a=c;i>=y&&g("invalid-input"),((l=(p=e.charCodeAt(i++))-48<10?p-22:p-65<26?p-65:p-97<26?p-97:c)>=c||l>h((u-m)/s))&&g("overflow"),m+=l*s,!(l<(d=a<=k?1:a>=k+26?26:a-k));a+=c)s>h(u/(f=c-d))&&g("overflow"),s*=f;k=S(m-o,t=v.length+1,0==o),h(m/t)>u-_&&g("overflow"),_+=h(m/t),m%=t,v.splice(m++,0,_)}return b(v)}function w(e){var t,n,r,i,o,s,a,l,d,f,p,y,m,b,E,w=[];for(y=(e=_(e)).length,t=128,n=0,o=72,s=0;s<y;++s)(p=e[s])<128&&w.push(v(p));for(r=i=w.length,i&&w.push("-");r<y;){for(a=u,s=0;s<y;++s)(p=e[s])>=t&&p<a&&(a=p);for(a-t>h((u-n)/(m=r+1))&&g("overflow"),n+=(a-t)*m,t=a,s=0;s<y;++s)if((p=e[s])<t&&++n>u&&g("overflow"),p==t){for(l=n,d=c;!(l<(f=d<=o?1:d>=o+26?26:d-o));d+=c)E=l-f,b=c-f,w.push(v(k(f+E%b,0))),l=h(E/b);w.push(v(k(l,0))),o=S(n,m,r==i),n=0,++r}++n,++t}return w.join("")}a={version:"1.4.1",ucs2:{decode:_,encode:b},decode:E,encode:w,toASCII:function(e){return m(e,(function(e){return d.test(e)?"xn--"+w(e):e}))},toUnicode:function(e){return m(e,(function(e){return l.test(e)?E(e.slice(4).toLowerCase()):e}))}},void 0===(i=function(){return a}.call(t,n,t,e))||(e.exports=i)}()}).call(this,n(98)(e),n(9))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";e.exports={isString:function(e){return"string"===typeof e},isObject:function(e){return"object"===typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t,n){"use strict";t.decode=t.parse=n(101),t.encode=t.stringify=n(102)},function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,n,o){t=t||"&",n=n||"=";var s={};if("string"!==typeof e||0===e.length)return s;var a=/\+/g;e=e.split(t);var u=1e3;o&&"number"===typeof o.maxKeys&&(u=o.maxKeys);var c=e.length;u>0&&c>u&&(c=u);for(var l=0;l<c;++l){var d,f,p,h,v=e[l].replace(a,"%20"),g=v.indexOf(n);g>=0?(d=v.substr(0,g),f=v.substr(g+1)):(d=v,f=""),p=decodeURIComponent(d),h=decodeURIComponent(f),r(s,p)?i(s[p])?s[p].push(h):s[p]=[s[p],h]:s[p]=h}return s};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,n){"use strict";var r=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,n,a){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"===typeof e?o(s(e),(function(s){var a=encodeURIComponent(r(s))+n;return i(e[s])?o(e[s],(function(e){return a+encodeURIComponent(r(e))})).join(t):a+encodeURIComponent(r(e[s]))})).join(t):a?encodeURIComponent(r(a))+n+encodeURIComponent(r(e)):""};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function o(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var s=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},function(e,t,n){"use strict";(function(e){var r=n(2),i=n(6),o=n(3),s=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixBaseApis=p;var a=n(61),u=n(1),c=n(47),l=s(n(5)),d=n(33);function f(e,t){switch(e){case a.SERVICE_TYPES.IS:return t+d.PREFIX_IDENTITY_V2+"/terms";case a.SERVICE_TYPES.IM:return t+"/_matrix/integrations/v1/terms";default:throw new Error("Unsupported service type")}}function p(e){l.checkObjectHasKeys(e,["baseUrl","request"]),this.baseUrl=e.baseUrl,this.idBaseUrl=e.idBaseUrl,this.identityServer=e.identityServer;var t={baseUrl:e.baseUrl,idBaseUrl:e.idBaseUrl,accessToken:e.accessToken,request:e.request,prefix:d.PREFIX_R0,onlyData:!0,extraParams:e.queryParams,localTimeoutMs:e.localTimeoutMs,useAuthorizationHeader:e.useAuthorizationHeader};this._http=new d.MatrixHttpApi(this,t),this._txnCtr=0}p.prototype.getHomeserverUrl=function(){return this.baseUrl},p.prototype.getIdentityServerUrl=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e&&(this.idBaseUrl.startsWith("http://")||this.idBaseUrl.startsWith("https://"))?this.idBaseUrl.split("://")[1]:this.idBaseUrl},p.prototype.setIdentityServerUrl=function(e){this.idBaseUrl=l.ensureNoTrailingSlash(e),this._http.setIdBaseUrl(this.idBaseUrl)},p.prototype.getAccessToken=function(){return this._http.opts.accessToken||null},p.prototype.isLoggedIn=function(){return void 0!==this._http.opts.accessToken},p.prototype.makeTxnId=function(){return"m"+(new Date).getTime()+"."+this._txnCtr++},p.prototype.isUsernameAvailable=function(e){return this._http.authedRequest(void 0,"GET","/register/available",{username:e}).then((function(e){return e.available}))},p.prototype.register=function(e,t,n,r,i,o,s,a){!0===i?i={email:!0}:null!==i&&void 0!==i||(i={}),"function"===typeof s&&(a=s,s=void 0),n&&(r.session=n);var u={auth:r};return void 0!==e&&null!==e&&(u.username=e),void 0!==t&&null!==t&&(u.password=t),i.email&&(u.bind_email=!0),i.msisdn&&(u.bind_msisdn=!0),void 0!==o&&null!==o&&(u.guest_access_token=o),void 0!==s&&null!==s&&(u.inhibit_login=s),void 0!==t&&null!==t&&(u.x_show_msisdn=!0),this.registerRequest(u,void 0,a)},p.prototype.registerGuest=function(e,t){return(e=e||{}).body=e.body||{},this.registerRequest(e.body,"guest",t)},p.prototype.registerRequest=function(e,t,n){var r={};return t&&(r.kind=t),this._http.request(n,"POST","/register",r,e)},p.prototype.loginFlows=function(e){return this._http.request(e,"GET","/login")},p.prototype.login=function(e,t,n){var r=this,i={type:e};return l.extend(i,t),this._http.authedRequest((function(e,t){t&&t.access_token&&t.user_id&&(r._http.opts.accessToken=t.access_token,r.credentials={userId:t.user_id}),n&&n(e,t)}),"POST","/login",void 0,i)},p.prototype.loginWithPassword=function(e,t,n){return this.login("m.login.password",{user:e,password:t},n)},p.prototype.loginWithSAML2=function(e,t){return this.login("m.login.saml2",{relay_state:e},t)},p.prototype.getCasLoginUrl=function(e){return this.getSsoLoginUrl(e,"cas")},p.prototype.getSsoLoginUrl=function(e,t,n){void 0===t&&(t="sso");var r=d.PREFIX_R0,i="/login/"+t+"/redirect";return n&&(i+="/"+n,r="/_matrix/client/unstable/org.matrix.msc2858"),this._http.getUrl(i,{redirectUrl:e},r)},p.prototype.loginWithToken=function(e,t){return this.login("m.login.token",{token:e},t)},p.prototype.logout=function(e){return this._http.authedRequest(e,"POST","/logout")},p.prototype.deactivateAccount=function(e,t){if("function"===typeof t)throw new Error("deactivateAccount no longer accepts a callback parameter");var n={};return e&&(n.auth=e),void 0!==t&&(n.erase=t),this._http.authedRequest(void 0,"POST","/account/deactivate",void 0,n)},p.prototype.getFallbackAuthUrl=function(e,t){var n=l.encodeUri("/auth/$loginType/fallback/web",{$loginType:e});return this._http.getUrl(n,{session:t},d.PREFIX_R0)},p.prototype.createRoom=function(){var e=o(r.mark((function e(t,n){var o,s,a,u;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=(t.invite_3pid||[]).filter((function(e){return!e.id_access_token})),e.t0=o.length>0&&this.identityServer&&this.identityServer.getAccessToken,!e.t0){e.next=6;break}return e.next=5,this.doesServerAcceptIdentityAccessToken();case 5:e.t0=e.sent;case 6:if(!e.t0){e.next=11;break}return e.next=9,this.identityServer.getAccessToken();case 9:if(s=e.sent){a=i(o);try{for(a.s();!(u=a.n()).done;)u.value.id_access_token=s}catch(r){a.e(r)}finally{a.f()}}case 11:return e.abrupt("return",this._http.authedRequest(n,"POST","/createRoom",void 0,t));case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),p.prototype.fetchRelations=function(){var e=o(r.mark((function e(t,n,i,o,s){var a,u,c,f;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={},s.from&&(a.from=s.from),u=l.encodeParams(a),c=l.encodeUri("/rooms/$roomId/relations/$eventId/$relationType/$eventType?"+u,{$roomId:t,$eventId:n,$relationType:i,$eventType:o}),e.next=6,this._http.authedRequest(void 0,"GET",c,null,null,{prefix:d.PREFIX_UNSTABLE});case 6:return f=e.sent,e.abrupt("return",f);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}(),p.prototype.roomState=function(e,t){var n=l.encodeUri("/rooms/$roomId/state",{$roomId:e});return this._http.authedRequest(t,"GET",n)},p.prototype.fetchRoomEvent=function(e,t,n){var r=l.encodeUri("/rooms/$roomId/event/$eventId",{$roomId:e,$eventId:t});return this._http.authedRequest(n,"GET",r)},p.prototype.members=function(e,t,n,r,i){var o={};t&&(o.membership=t),n&&(o.not_membership=n),r&&(o.at=r);var s=l.encodeParams(o),a=l.encodeUri("/rooms/$roomId/members?"+s,{$roomId:e});return this._http.authedRequest(i,"GET",a)},p.prototype.upgradeRoom=function(e,t){var n=l.encodeUri("/rooms/$roomId/upgrade",{$roomId:e});return this._http.authedRequest(void 0,"POST",n,void 0,{new_version:t})},p.prototype.getGroupSummary=function(e){var t=l.encodeUri("/groups/$groupId/summary",{$groupId:e});return this._http.authedRequest(void 0,"GET",t)},p.prototype.getGroupProfile=function(e){var t=l.encodeUri("/groups/$groupId/profile",{$groupId:e});return this._http.authedRequest(void 0,"GET",t)},p.prototype.setGroupProfile=function(e,t){var n=l.encodeUri("/groups/$groupId/profile",{$groupId:e});return this._http.authedRequest(void 0,"POST",n,void 0,t)},p.prototype.setGroupJoinPolicy=function(e,t){var n=l.encodeUri("/groups/$groupId/settings/m.join_policy",{$groupId:e});return this._http.authedRequest(void 0,"PUT",n,void 0,{"m.join_policy":t})},p.prototype.getGroupUsers=function(e){var t=l.encodeUri("/groups/$groupId/users",{$groupId:e});return this._http.authedRequest(void 0,"GET",t)},p.prototype.getGroupInvitedUsers=function(e){var t=l.encodeUri("/groups/$groupId/invited_users",{$groupId:e});return this._http.authedRequest(void 0,"GET",t)},p.prototype.getGroupRooms=function(e){var t=l.encodeUri("/groups/$groupId/rooms",{$groupId:e});return this._http.authedRequest(void 0,"GET",t)},p.prototype.inviteUserToGroup=function(e,t){var n=l.encodeUri("/groups/$groupId/admin/users/invite/$userId",{$groupId:e,$userId:t});return this._http.authedRequest(void 0,"PUT",n,void 0,{})},p.prototype.removeUserFromGroup=function(e,t){var n=l.encodeUri("/groups/$groupId/admin/users/remove/$userId",{$groupId:e,$userId:t});return this._http.authedRequest(void 0,"PUT",n,void 0,{})},p.prototype.addUserToGroupSummary=function(e,t,n){var r=l.encodeUri(n?"/groups/$groupId/summary/$roleId/users/$userId":"/groups/$groupId/summary/users/$userId",{$groupId:e,$roleId:n,$userId:t});return this._http.authedRequest(void 0,"PUT",r,void 0,{})},p.prototype.removeUserFromGroupSummary=function(e,t){var n=l.encodeUri("/groups/$groupId/summary/users/$userId",{$groupId:e,$userId:t});return this._http.authedRequest(void 0,"DELETE",n,void 0,{})},p.prototype.addRoomToGroupSummary=function(e,t,n){var r=l.encodeUri(n?"/groups/$groupId/summary/$categoryId/rooms/$roomId":"/groups/$groupId/summary/rooms/$roomId",{$groupId:e,$categoryId:n,$roomId:t});return this._http.authedRequest(void 0,"PUT",r,void 0,{})},p.prototype.removeRoomFromGroupSummary=function(e,t){var n=l.encodeUri("/groups/$groupId/summary/rooms/$roomId",{$groupId:e,$roomId:t});return this._http.authedRequest(void 0,"DELETE",n,void 0,{})},p.prototype.addRoomToGroup=function(e,t,n){void 0===n&&(n=!0);var r=l.encodeUri("/groups/$groupId/admin/rooms/$roomId",{$groupId:e,$roomId:t});return this._http.authedRequest(void 0,"PUT",r,void 0,{"m.visibility":{type:n?"public":"private"}})},p.prototype.updateGroupRoomVisibility=function(e,t,n){var r=l.encodeUri("/groups/$groupId/admin/rooms/$roomId/config/m.visibility",{$groupId:e,$roomId:t});return this._http.authedRequest(void 0,"PUT",r,void 0,{type:n?"public":"private"})},p.prototype.removeRoomFromGroup=function(e,t){var n=l.encodeUri("/groups/$groupId/admin/rooms/$roomId",{$groupId:e,$roomId:t});return this._http.authedRequest(void 0,"DELETE",n,void 0,{})},p.prototype.acceptGroupInvite=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=l.encodeUri("/groups/$groupId/self/accept_invite",{$groupId:e});return this._http.authedRequest(void 0,"PUT",n,void 0,t||{})},p.prototype.joinGroup=function(e){var t=l.encodeUri("/groups/$groupId/self/join",{$groupId:e});return this._http.authedRequest(void 0,"PUT",t,void 0,{})},p.prototype.leaveGroup=function(e){var t=l.encodeUri("/groups/$groupId/self/leave",{$groupId:e});return this._http.authedRequest(void 0,"PUT",t,void 0,{})},p.prototype.getJoinedGroups=function(){var e=l.encodeUri("/joined_groups");return this._http.authedRequest(void 0,"GET",e)},p.prototype.createGroup=function(e){var t=l.encodeUri("/create_group");return this._http.authedRequest(void 0,"POST",t,void 0,e)},p.prototype.getPublicisedGroups=function(e){var t=l.encodeUri("/publicised_groups");return this._http.authedRequest(void 0,"POST",t,void 0,{user_ids:e})},p.prototype.setGroupPublicity=function(e,t){var n=l.encodeUri("/groups/$groupId/self/update_publicity",{$groupId:e});return this._http.authedRequest(void 0,"PUT",n,void 0,{publicise:t})},p.prototype.getStateEvent=function(e,t,n,r){var i={$roomId:e,$eventType:t,$stateKey:n},o=l.encodeUri("/rooms/$roomId/state/$eventType",i);return void 0!==n&&(o=l.encodeUri(o+"/$stateKey",i)),this._http.authedRequest(r,"GET",o)},p.prototype.sendStateEvent=function(e,t,n,r,i){var o={$roomId:e,$eventType:t,$stateKey:r},s=l.encodeUri("/rooms/$roomId/state/$eventType",o);return void 0!==r&&(s=l.encodeUri(s+"/$stateKey",o)),this._http.authedRequest(i,"PUT",s,void 0,n)},p.prototype.roomInitialSync=function(e,t,n){l.isFunction(t)&&(n=t,t=void 0);var r=l.encodeUri("/rooms/$roomId/initialSync",{$roomId:e});return t||(t=30),this._http.authedRequest(n,"GET",r,{limit:t})},p.prototype.setRoomReadMarkersHttpRequest=function(e,t,n,r){var i=l.encodeUri("/rooms/$roomId/read_markers",{$roomId:e}),o={"m.fully_read":t,"m.read":n,"m.hidden":Boolean(!!r&&r.hidden)};return this._http.authedRequest(void 0,"POST",i,void 0,o)},p.prototype.getJoinedRooms=function(){var e=l.encodeUri("/joined_rooms");return this._http.authedRequest(void 0,"GET",e)},p.prototype.getJoinedRoomMembers=function(e){var t=l.encodeUri("/rooms/$roomId/joined_members",{$roomId:e});return this._http.authedRequest(void 0,"GET",t)},p.prototype.publicRooms=function(e,t){"function"==typeof e&&(t=e,e={}),void 0===e&&(e={});var n={};return e.server&&(n.server=e.server,delete e.server),0===Object.keys(e).length&&0===Object.keys(n).length?this._http.authedRequest(t,"GET","/publicRooms"):this._http.authedRequest(t,"POST","/publicRooms",n,e)},p.prototype.createAlias=function(e,t,n){var r=l.encodeUri("/directory/room/$alias",{$alias:e}),i={room_id:t};return this._http.authedRequest(n,"PUT",r,void 0,i)},p.prototype.deleteAlias=function(e,t){var n=l.encodeUri("/directory/room/$alias",{$alias:e});return this._http.authedRequest(t,"DELETE",n,void 0,void 0)},p.prototype.unstableGetLocalAliases=function(e,t){var n=l.encodeUri("/rooms/$roomId/aliases",{$roomId:e}),r=d.PREFIX_UNSTABLE+"/org.matrix.msc2432";return this._http.authedRequest(t,"GET",n,null,null,{prefix:r})},p.prototype.getRoomIdForAlias=function(e,t){var n=l.encodeUri("/directory/room/$alias",{$alias:e});return this._http.authedRequest(t,"GET",n)},p.prototype.resolveRoomAlias=function(e,t){var n=l.encodeUri("/directory/room/$alias",{$alias:e});return this._http.request(t,"GET",n)},p.prototype.getRoomDirectoryVisibility=function(e,t){var n=l.encodeUri("/directory/list/room/$roomId",{$roomId:e});return this._http.authedRequest(t,"GET",n)},p.prototype.setRoomDirectoryVisibility=function(e,t,n){var r=l.encodeUri("/directory/list/room/$roomId",{$roomId:e});return this._http.authedRequest(n,"PUT",r,void 0,{visibility:t})},p.prototype.setRoomDirectoryVisibilityAppService=function(e,t,n,r){var i=l.encodeUri("/directory/list/appservice/$networkId/$roomId",{$networkId:e,$roomId:t});return this._http.authedRequest(r,"PUT",i,void 0,{visibility:n})},p.prototype.searchUserDirectory=function(e){var t={search_term:e.term};return void 0!==e.limit&&(t.limit=e.limit),this._http.authedRequest(void 0,"POST","/user_directory/search",void 0,t)},p.prototype.uploadContent=function(e,t){return this._http.uploadContent(e,t)},p.prototype.cancelUpload=function(e){return this._http.cancelUpload(e)},p.prototype.getCurrentUploads=function(){return this._http.getCurrentUploads()},p.prototype.getProfileInfo=function(e,t,n){l.isFunction(t)&&(n=t,t=void 0);var r=t?l.encodeUri("/profile/$userId/$info",{$userId:e,$info:t}):l.encodeUri("/profile/$userId",{$userId:e});return this._http.authedRequest(n,"GET",r)},p.prototype.getThreePids=function(e){return this._http.authedRequest(e,"GET","/account/3pid",void 0,void 0)},p.prototype.addThreePid=function(e,t,n){var r={threePidCreds:e,bind:t};return this._http.authedRequest(n,"POST","/account/3pid",null,r)},p.prototype.addThreePidOnly=function(){var e=o(r.mark((function e(t){var n,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="/account/3pid/add",e.next=3,this.isVersionSupported("r0.6.0");case 3:if(!e.sent){e.next=7;break}e.t0=d.PREFIX_R0,e.next=8;break;case 7:e.t0=d.PREFIX_UNSTABLE;case 8:return i=e.t0,e.abrupt("return",this._http.authedRequest(void 0,"POST",n,null,t,{prefix:i}));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),p.prototype.bindThreePid=function(){var e=o(r.mark((function e(t){var n,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="/account/3pid/bind",e.next=3,this.isVersionSupported("r0.6.0");case 3:if(!e.sent){e.next=7;break}e.t0=d.PREFIX_R0,e.next=8;break;case 7:e.t0=d.PREFIX_UNSTABLE;case 8:return i=e.t0,e.abrupt("return",this._http.authedRequest(void 0,"POST",n,null,t,{prefix:i}));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),p.prototype.unbindThreePid=function(){var e=o(r.mark((function e(t,n){var i,o,s;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="/account/3pid/unbind",o={medium:t,address:n,id_server:this.getIdentityServerUrl(!0)},e.next=4,this.isVersionSupported("r0.6.0");case 4:if(!e.sent){e.next=8;break}e.t0=d.PREFIX_R0,e.next=9;break;case 8:e.t0=d.PREFIX_UNSTABLE;case 9:return s=e.t0,e.abrupt("return",this._http.authedRequest(void 0,"POST",i,null,o,{prefix:s}));case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),p.prototype.deleteThreePid=function(e,t){var n={medium:e,address:t};return this._http.authedRequest(void 0,"POST","/account/3pid/delete",null,n)},p.prototype.setPassword=function(e,t,n){var r={auth:e,new_password:t};return this._http.authedRequest(n,"POST","/account/password",null,r)},p.prototype.getDevices=function(){return this._http.authedRequest(void 0,"GET","/devices",void 0,void 0)},p.prototype.setDeviceDetails=function(e,t){var n=l.encodeUri("/devices/$device_id",{$device_id:e});return this._http.authedRequest(void 0,"PUT",n,void 0,t)},p.prototype.deleteDevice=function(e,t){var n=l.encodeUri("/devices/$device_id",{$device_id:e}),r={};return t&&(r.auth=t),this._http.authedRequest(void 0,"DELETE",n,void 0,r)},p.prototype.deleteMultipleDevices=function(e,t){var n={devices:e};t&&(n.auth=t);return this._http.authedRequest(void 0,"POST","/delete_devices",void 0,n)},p.prototype.getPushers=function(e){return this._http.authedRequest(e,"GET","/pushers",void 0,void 0)},p.prototype.setPusher=function(e,t){return this._http.authedRequest(t,"POST","/pushers/set",null,e)},p.prototype.getPushRules=function(e){return this._http.authedRequest(e,"GET","/pushrules/").then((function(e){return c.PushProcessor.rewriteDefaultRules(e)}))},p.prototype.addPushRule=function(e,t,n,r,i){var o=l.encodeUri("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:n});return this._http.authedRequest(i,"PUT",o,void 0,r)},p.prototype.deletePushRule=function(e,t,n,r){var i=l.encodeUri("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:n});return this._http.authedRequest(r,"DELETE",i)},p.prototype.setPushRuleEnabled=function(e,t,n,r,i){var o=l.encodeUri("/pushrules/"+e+"/$kind/$ruleId/enabled",{$kind:t,$ruleId:n});return this._http.authedRequest(i,"PUT",o,void 0,{enabled:r})},p.prototype.setPushRuleActions=function(e,t,n,r,i){var o=l.encodeUri("/pushrules/"+e+"/$kind/$ruleId/actions",{$kind:t,$ruleId:n});return this._http.authedRequest(i,"PUT",o,void 0,{actions:r})},p.prototype.search=function(e,t){var n={};return e.next_batch&&(n.next_batch=e.next_batch),this._http.authedRequest(t,"POST","/search",n,e.body)},p.prototype.uploadKeysRequest=function(e,t,n){return this._http.authedRequest(n,"POST","/keys/upload",void 0,e)},p.prototype.uploadKeySignatures=function(e){return this._http.authedRequest(void 0,"POST","/keys/signatures/upload",void 0,e,{prefix:d.PREFIX_UNSTABLE})},p.prototype.downloadKeysForUsers=function(e,t){if(l.isFunction(t))throw new Error("downloadKeysForUsers no longer accepts a callback parameter");var n={device_keys:{}};return"token"in(t=t||{})&&(n.token=t.token),e.forEach((function(e){n.device_keys[e]=[]})),this._http.authedRequest(void 0,"POST","/keys/query",void 0,n)},p.prototype.claimOneTimeKeys=function(e,t,n){var r={};void 0===t&&(t="signed_curve25519");for(var i=0;i<e.length;++i){var o=e[i][0],s=e[i][1],a=r[o]||{};r[o]=a,a[s]=t}var u={one_time_keys:r};n&&(u.timeout=n);return this._http.authedRequest(void 0,"POST","/keys/claim",void 0,u)},p.prototype.getKeyChanges=function(e,t){var n={from:e,to:t};return this._http.authedRequest(void 0,"GET","/keys/changes",n,void 0)},p.prototype.uploadDeviceSigningKeys=function(e,t){var n=Object.assign({},t);return e&&Object.assign(n,{auth:e}),this._http.authedRequest(void 0,"POST","/keys/device_signing/upload",void 0,n,{prefix:d.PREFIX_UNSTABLE})},p.prototype.registerWithIdentityServer=function(e){if(!this.idBaseUrl)throw new Error("No Identity Server base URL set");var t=this.idBaseUrl+d.PREFIX_IDENTITY_V2+"/account/register";return this._http.requestOtherUrl(void 0,"POST",t,null,e)},p.prototype.requestEmailToken=function(){var e=o(r.mark((function e(t,n,i,o,s,a){var u;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u={client_secret:n,email:t,send_attempt:i,next_link:o},e.next=3,this._http.idServerRequest(s,"POST","/validate/email/requestToken",u,d.PREFIX_IDENTITY_V2,a);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o,s){return e.apply(this,arguments)}}(),p.prototype.requestMsisdnToken=function(){var e=o(r.mark((function e(t,n,i,o,s,a,u){var c;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c={client_secret:i,country:t,phone_number:n,send_attempt:o,next_link:s},e.next=3,this._http.idServerRequest(a,"POST","/validate/msisdn/requestToken",c,d.PREFIX_IDENTITY_V2,u);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o,s,a){return e.apply(this,arguments)}}(),p.prototype.submitMsisdnToken=function(){var e=o(r.mark((function e(t,n,i,o){var s;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={sid:t,client_secret:n,token:i},e.next=3,this._http.idServerRequest(void 0,"POST","/validate/msisdn/submitToken",s,d.PREFIX_IDENTITY_V2,o);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),p.prototype.submitMsisdnTokenOtherUrl=function(e,t,n,r){var i={sid:t,client_secret:n,token:r};return this._http.requestOtherUrl(void 0,"POST",e,void 0,i)},p.prototype.getIdentityHashDetails=function(e){return this._http.idServerRequest(void 0,"GET","/hash_details",null,d.PREFIX_IDENTITY_V2,e)},p.prototype.identityHashedLookup=function(){var t=o(r.mark((function t(n,i){var o,s,a,u,c,l,f,p,h,v,g;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o={},t.next=3,this.getIdentityHashDetails(i);case 3:if((s=t.sent)&&s.lookup_pepper&&s.algorithms){t.next=6;break}throw new Error("Unsupported identity server: bad response");case 6:if(o.pepper=s.lookup_pepper,a={},!s.algorithms.includes("sha256")){t.next=14;break}u=new e.Olm.Utility,o.addresses=n.map((function(e){var t=e[0].toLowerCase(),n=e[1].toLowerCase(),r=u.sha256("".concat(t," ").concat(n," ").concat(o.pepper)).replace(/\+/g,"-").replace(/\//g,"_");return a[r]=e[0],r})),o.algorithm="sha256",t.next=20;break;case 14:if(!s.algorithms.includes("none")){t.next=19;break}o.addresses=n.map((function(e){var t=e[0].toLowerCase(),n=e[1].toLowerCase(),r="".concat(t," ").concat(n);return a[r]=e[0],r})),o.algorithm="none",t.next=20;break;case 19:throw new Error("Unsupported identity server: unknown hash algorithm");case 20:return t.next=22,this._http.idServerRequest(void 0,"POST","/lookup",o,d.PREFIX_IDENTITY_V2,i);case 22:if((c=t.sent)&&c.mappings){t.next=25;break}return t.abrupt("return",[]);case 25:l=[],f=0,p=Object.keys(c.mappings);case 27:if(!(f<p.length)){t.next=37;break}if(h=p[f],v=c.mappings[h],g=a[h]){t.next=33;break}throw new Error("Identity server returned more results than expected");case 33:l.push({address:g,mxid:v});case 34:f++,t.next=27;break;case 37:return t.abrupt("return",l);case 38:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}(),p.prototype.lookupThreePid=function(){var e=o(r.mark((function e(t,n,i,o){var s,a,u;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.identityHashedLookup([[n,t]],o);case 2:if(s=e.sent,a=s.find((function(e){return e.address===n}))){e.next=7;break}return i&&i(null,{}),e.abrupt("return",{});case 7:return u={address:n,medium:t,mxid:a.mxid},i&&i(null,u),e.abrupt("return",u);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),p.prototype.bulkLookupThreePids=function(){var e=o(r.mark((function e(t,n){var o,s,a,u,c;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.identityHashedLookup(t.map((function(e){return[e[1],e[0]]})),n);case 2:o=e.sent,s=[],a=i(o);try{for(c=function(){var e=u.value,n=t.find((function(t){return t[1]===e.address}));if(!n)throw new Error("Identity sever returned unexpected results");s.push([n[0],e.address,e.mxid])},a.s();!(u=a.n()).done;)c()}catch(r){a.e(r)}finally{a.f()}return e.abrupt("return",{threepids:s});case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),p.prototype.getIdentityAccount=function(e){return this._http.idServerRequest(void 0,"GET","/account",void 0,d.PREFIX_IDENTITY_V2,e)},p.prototype.sendToDevice=function(e,t,n){var r=l.encodeUri("/sendToDevice/$eventType/$txnId",{$eventType:e,$txnId:n||this.makeTxnId()}),i={messages:t},o=Object.keys(t).reduce((function(e,n){return e[n]=Object.keys(t[n]),e}),{});return u.logger.log("PUT ".concat(r),o),this._http.authedRequest(void 0,"PUT",r,void 0,i)},p.prototype.getThirdpartyProtocols=function(){return this._http.authedRequest(void 0,"GET","/thirdparty/protocols",void 0,void 0).then((function(e){if(!e||"object"!==typeof e)throw new Error("/thirdparty/protocols did not return an object: ".concat(e));return e}))},p.prototype.getThirdpartyLocation=function(e,t){var n=l.encodeUri("/thirdparty/location/$protocol",{$protocol:e});return this._http.authedRequest(void 0,"GET",n,t,void 0)},p.prototype.getThirdpartyUser=function(e,t){var n=l.encodeUri("/thirdparty/user/$protocol",{$protocol:e});return this._http.authedRequest(void 0,"GET",n,t,void 0)},p.prototype.getTerms=function(e,t){var n=f(e,t);return this._http.requestOtherUrl(void 0,"GET",n)},p.prototype.agreeToTerms=function(e,t,n,r){var i=f(e,t),o={Authorization:"Bearer "+n};return this._http.requestOtherUrl(void 0,"POST",i,null,{user_accepts:r},{headers:o})},p.prototype.reportEvent=function(e,t,n,r){var i=l.encodeUri("/rooms/$roomId/report/$eventId",{$roomId:e,$eventId:t});return this._http.authedRequest(void 0,"POST",i,null,{score:n,reason:r})}}).call(this,n(9))},function(e,t,n){var r=n(105),i=n(22);e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!==typeof t?i(e):t}},function(e,t){function n(t){return"function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?e.exports=n=function(e){return typeof e}:e.exports=n=function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(t)}e.exports=n},function(e,t){e.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}},function(e,t,n){"use strict";var r=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,i=/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/,o=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,s=/\\([\u000b\u0020-\u00ff])/g,a=/([\\"])/g,u=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;function c(e){var t=String(e);if(o.test(t))return t;if(t.length>0&&!i.test(t))throw new TypeError("invalid parameter value");return'"'+t.replace(a,"\\$1")+'"'}function l(e){this.parameters=Object.create(null),this.type=e}t.format=function(e){if(!e||"object"!==typeof e)throw new TypeError("argument obj is required");var t=e.parameters,n=e.type;if(!n||!u.test(n))throw new TypeError("invalid type");var r=n;if(t&&"object"===typeof t)for(var i,s=Object.keys(t).sort(),a=0;a<s.length;a++){if(i=s[a],!o.test(i))throw new TypeError("invalid parameter name");r+="; "+i+"="+c(t[i])}return r},t.parse=function(e){if(!e)throw new TypeError("argument string is required");var t="object"===typeof e?function(e){var t;"function"===typeof e.getHeader?t=e.getHeader("content-type"):"object"===typeof e.headers&&(t=e.headers&&e.headers["content-type"]);if("string"!==typeof t)throw new TypeError("content-type header is missing from object");return t}(e):e;if("string"!==typeof t)throw new TypeError("argument string is required to be a string");var n=t.indexOf(";"),i=-1!==n?t.substr(0,n).trim():t.trim();if(!u.test(i))throw new TypeError("invalid media type");var o=new l(i.toLowerCase());if(-1!==n){var a,c,d;for(r.lastIndex=n;c=r.exec(t);){if(c.index!==n)throw new TypeError("invalid parameter format");n+=c[0].length,a=c[1].toLowerCase(),'"'===(d=c[2])[0]&&(d=d.substr(1,d.length-2).replace(s,"$1")),o.parameters[a]=d}if(n!==t.length)throw new TypeError("invalid parameter format")}return o}},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.setNow=function(e){a=e||Date.now},t.setTimeout=function(e,t){(t=t||0)<0&&(t=0);var n=Array.prototype.slice.call(arguments,2),r=a()+t,i=o++;var c={runAt:r,func:e,params:n,key:i},d=l(s,(function(e){return e.runAt-r}));return s.splice(d,0,c),u(),i},t.clearTimeout=function(e){if(0===s.length)return;var t;for(t=0;t<s.length;t++){if(s[t].key==e){s.splice(t,1);break}}0===t&&u()};var r,i=n(1),o=0,s=[];var a=Date.now;function u(){r&&e.clearTimeout(r);var t=s[0];if(t){var n=a(),i=Math.min(t.runAt-n,1e3);r=e.setTimeout(c,i)}}function c(){for(var t,n=a(),r=[];;){var o=s[0];if(!o||o.runAt>n)break;(t=s.shift()).key,r.push(t)}u();for(var c=0;c<r.length;c++){t=r[c];try{t.func.apply(e,t.params)}catch(l){i.logger.error("Uncaught exception in callback function",l.stack||l)}}}function l(e,t){for(var n=0,r=e.length;n<r;){var i=n+r>>1;t(e[i])>0?r=i:n=i+1}return n}}).call(this,n(9))},function(e,t,n){"use strict";function r(e){this.filter_json=e,this.types=e.types||null,this.not_types=e.not_types||[],this.rooms=e.rooms||null,this.not_rooms=e.not_rooms||[],this.senders=e.senders||null,this.not_senders=e.not_senders||[],this.contains_url=e.contains_url||null}Object.defineProperty(t,"__esModule",{value:!0}),t.FilterComponent=r,r.prototype.check=function(e){return this._checkFields(e.getRoomId(),e.getSender(),e.getType(),!!e.getContent()&&void 0!==e.getContent().url)},r.prototype._checkFields=function(e,t,n,r){for(var i={rooms:function(t){return e===t},senders:function(e){return t===e},types:function(e){return function(e,t){if(t.endsWith("*")){var n=t.slice(0,-1);return e.substr(0,n.length)===n}return e===t}(n,e)}},o=0;o<Object.keys(i).length;o++){var s=Object.keys(i)[o],a=i[s];if(this["not_"+s].filter(a).length>0)return!1;var u=this[s];if(u&&u.length>0)if(!u.some(a))return!1}var c=this.filter_json.contains_url;return void 0===c||c===r},r.prototype.filter=function(e){return e.filter(this.check,this)},r.prototype.limit=function(){return void 0!==this.filter_json.limit?this.filter_json.limit:10}},function(e,t,n){"use strict";(function(e){var r=n(6),i=n(2),o=n(3),s=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.SyncApi=m;var a=n(28),u=n(63),c=n(66),l=s(n(5)),d=n(48),f=n(27),p=n(47),h=n(1),v=n(36);function g(e,t){return"FILTER_SYNC_"+e+(t?"_"+t:"")}function y(){var e;(e=h.logger).log.apply(e,arguments)}function m(e,t){this.client=e,(t=t||{}).initialSyncLimit=void 0===t.initialSyncLimit?8:t.initialSyncLimit,t.resolveInvitesToProfiles=t.resolveInvitesToProfiles||!1,t.pollTimeout=t.pollTimeout||3e4,t.pendingEventOrdering=t.pendingEventOrdering||"chronological",t.canResetEntireTimeline||(t.canResetEntireTimeline=function(e){return!1}),this.opts=t,this._peekRoomId=null,this._currentSyncRequest=null,this._syncState=null,this._syncStateData=null,this._catchingUp=!1,this._running=!1,this._keepAliveTimer=null,this._connectionReturnedDefer=null,this._notifEvents=[],this._failedSyncCount=0,this._storeIsInvalid=!1,e.getNotifTimelineSet()&&e.reEmitter.reEmit(e.getNotifTimelineSet(),["Room.timeline","Room.timelineReset"])}function _(e,t){var n=new a.User(t);return e.reEmitter.reEmit(n,["User.avatarUrl","User.displayName","User.presence","User.currentlyActive","User.lastPresenceTs"]),n}m.prototype.createRoom=function(e){var t=this.client,n=t.timelineSupport,r=t.unstableClientRelationAggregation,i=new u.Room(e,t,t.getUserId(),{lazyLoadMembers:this.opts.lazyLoadMembers,pendingEventOrdering:this.opts.pendingEventOrdering,timelineSupport:n,unstableClientRelationAggregation:r});return t.reEmitter.reEmit(i,["Room.name","Room.timeline","Room.redaction","Room.redactionCancelled","Room.receipt","Room.tags","Room.timelineReset","Room.localEchoUpdated","Room.accountData","Room.myMembership","Room.replaceEvent"]),this._registerStateListeners(i),i},m.prototype.createGroup=function(e){var t=this.client,n=new c.Group(e);return t.reEmitter.reEmit(n,["Group.profile","Group.myMembership"]),t.store.storeGroup(n),n},m.prototype._registerStateListeners=function(e){var t=this.client;t.reEmitter.reEmit(e.currentState,["RoomState.events","RoomState.members","RoomState.newMember"]),e.currentState.on("RoomState.newMember",(function(e,n,r){r.user=t.getUser(r.userId),t.reEmitter.reEmit(r,["RoomMember.name","RoomMember.typing","RoomMember.powerLevel","RoomMember.membership"])}))},m.prototype._deregisterStateListeners=function(e){e.currentState.removeAllListeners("RoomState.events"),e.currentState.removeAllListeners("RoomState.members"),e.currentState.removeAllListeners("RoomState.newMember")},m.prototype.syncLeftRooms=function(){var e=this.client,t=this,n=new d.Filter(this.client.credentials.userId);n.setTimelineLimit(1),n.setIncludeLeaveRooms(!0);var r=this.opts.pollTimeout+8e4,i={timeout:0};return e.getOrCreateFilter(g(e.credentials.userId,"LEFT_ROOMS"),n).then((function(t){return i.filter=t,e._http.authedRequest(void 0,"GET","/sync",i,void 0,r)})).then((function(n){var r=[];n.rooms&&n.rooms.leave&&(r=t._mapSyncResponseToRoomArray(n.rooms.leave));var i=[];return r.forEach((function(n){var r=n.room;if(i.push(r),n.isBrandNewRoom){n.timeline=n.timeline||{};var o=t._mapSyncEventsFormat(n.timeline,r),s=t._mapSyncEventsFormat(n.state,r);r.getLiveTimeline().setPaginationToken(n.timeline.prev_batch,f.EventTimeline.BACKWARDS),t._processRoomEvents(r,s,o),r.recalculate(),e.store.storeRoom(r),e.emit("Room",r),t._processEventsForNotifs(r,o)}})),i}))},m.prototype.peek=function(e){var t=this,n=this.client;return this._peekRoomId=e,this.client.roomInitialSync(e,20).then((function(r){r.messages=r.messages||{},r.messages.chunk=r.messages.chunk||[],r.state=r.state||[];var i=t.createRoom(e),o=l.map(l.deepCopy(r.state),n.getEventMapper()),s=l.map(r.state,n.getEventMapper()),a=l.map(r.messages.chunk,n.getEventMapper());return r.presence&&l.isArray(r.presence)&&r.presence.map(n.getEventMapper()).forEach((function(e){var t=n.store.getUser(e.getContent().user_id);t?t.setPresenceEvent(e):((t=_(n,e.getContent().user_id)).setPresenceEvent(e),n.store.storeUser(t)),n.emit("event",e)})),r.messages.start&&(i.oldState.paginationToken=r.messages.start),i.oldState.setStateEvents(o),i.currentState.setStateEvents(s),t._resolveInvites(i),i.recalculate(),i.addEventsToTimeline(a.reverse(),!0,i.getLiveTimeline(),r.messages.start),n.store.storeRoom(i),n.emit("Room",i),t._peekPoll(i),i}))},m.prototype.stopPeeking=function(){this._peekRoomId=null},m.prototype._peekPoll=function(e,t){if(this._peekRoomId===e.roomId){var n=this;this.client._http.authedRequest(void 0,"GET","/events",{room_id:e.roomId,timeout:3e4,from:t},void 0,5e4).then((function(t){if(n._peekRoomId===e.roomId){t.chunk.filter((function(e){return"m.presence"===e.type})).map(n.client.getEventMapper()).forEach((function(e){var t=n.client.store.getUser(e.getContent().user_id);t?t.setPresenceEvent(e):((t=_(n.client,e.getContent().user_id)).setPresenceEvent(e),n.client.store.storeUser(t)),n.client.emit("event",e)}));var r=t.chunk.filter((function(t){return t.room_id===e.roomId&&t.event_id})).map(n.client.getEventMapper());e.addLiveEvents(r),n._peekPoll(e,t.end)}else y("Stopped peeking in room %s",e.roomId)}),(function(r){h.logger.error("[%s] Peek poll failed: %s",e.roomId,r),setTimeout((function(){n._peekPoll(e,t)}),3e4)}))}else y("Stopped peeking in room %s",e.roomId)},m.prototype.getSyncState=function(){return this._syncState},m.prototype.getSyncStateData=function(){return this._syncStateData},m.prototype.recoverFromSyncStartupError=function(){var e=o(i.mark((function e(t,n){var r;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:return r=this._startKeepAlives(),this._updateSyncState("ERROR",{error:n}),e.next=6,r;case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),m.prototype._wasLazyLoadingToggled=function(){var e=o(i.mark((function e(t){var n,r;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!!t,n=!1,e.next=4,this.client.store.isNewlyCreated();case 4:if(e.sent){e.next=11;break}return e.next=8,this.client.store.getClientOptions();case 8:return(r=e.sent)&&(n=!!r.lazyLoadMembers),e.abrupt("return",n!==t);case 11:return e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),m.prototype._shouldAbortSync=function(e){return"M_UNKNOWN_TOKEN"===e.errcode&&(h.logger.warn("Token no longer valid - assuming logout"),this.stop(),!0)},m.prototype.sync=function(){var t=this,n=this.client,r=this;this._running=!0,e.window&&(this._onOnlineBound=this._onOnline.bind(this),e.window.addEventListener("online",this._onOnlineBound,!1));var s=Promise.resolve(),a=null;function u(){return c.apply(this,arguments)}function c(){return(c=o(i.mark((function e(){var t;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,y("Getting push rules..."),e.next=4,n.getPushRules();case 4:t=e.sent,y("Got push rules"),n.pushRules=t,e.next=19;break;case 9:if(e.prev=9,e.t0=e.catch(0),h.logger.error("Getting push rules failed",e.t0),!r._shouldAbortSync(e.t0)){e.next=14;break}return e.abrupt("return");case 14:return y("Waiting for saved sync before retrying push rules..."),e.next=17,r.recoverFromSyncStartupError(s,e.t0);case 17:return u(),e.abrupt("return");case 19:f();case 20:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function l(){var e=new d.Filter(n.credentials.userId);return e.setTimelineLimit(r.opts.initialSyncLimit),e}var f=function(){var e=o(i.mark((function e(){var r,o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y("Checking lazy load status..."),t.opts.lazyLoadMembers&&n.isGuest()&&(t.opts.lazyLoadMembers=!1),!t.opts.lazyLoadMembers){e.next=8;break}return y("Checking server lazy load support..."),e.next=6,n.doesServerSupportLazyLoading();case 6:e.sent?(y("Enabling lazy load on sync filter..."),t.opts.filter||(t.opts.filter=l()),t.opts.filter.setLazyLoadMembers(!0)):(y("LL: lazy loading requested but not supported by server, so disabling"),t.opts.lazyLoadMembers=!1);case 8:return y("Checking whether lazy loading has changed in store..."),e.next=11,t._wasLazyLoadingToggled(t.opts.lazyLoadMembers);case 11:if(!e.sent){e.next=19;break}return t._storeIsInvalid=!0,r=v.InvalidStoreError.TOGGLED_LAZY_LOADING,o=new v.InvalidStoreError(r,!!t.opts.lazyLoadMembers),t._updateSyncState("ERROR",{error:o}),h.logger.warn("InvalidStoreError: store is not usable: stopping sync."),e.abrupt("return");case 19:return t.opts.lazyLoadMembers&&t.opts.crypto&&t.opts.crypto.enableLazyLoading(),e.prev=20,y("Storing client options..."),e.next=24,t.client._storeClientOptions();case 24:y("Stored client options"),e.next=31;break;case 27:throw e.prev=27,e.t0=e.catch(20),h.logger.error("Storing client options failed",e.t0),e.t0;case 31:p();case 32:case"end":return e.stop()}}),e,null,[[20,27]])})));return function(){return e.apply(this,arguments)}}();function p(){return m.apply(this,arguments)}function m(){return(m=o(i.mark((function e(){var t,o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y("Getting filter..."),t=r.opts.filter?r.opts.filter:l(),e.prev=2,e.next=5,n.getOrCreateFilter(g(n.credentials.userId),t);case 5:o=e.sent,e.next=18;break;case 8:if(e.prev=8,e.t0=e.catch(2),h.logger.error("Getting filter failed",e.t0),!r._shouldAbortSync(e.t0)){e.next=13;break}return e.abrupt("return");case 13:return y("Waiting for saved sync before retrying filter..."),e.next=16,r.recoverFromSyncStartupError(s,e.t0);case 16:return p(),e.abrupt("return");case 18:return n.resetNotifTimelineSet(),null===r._currentSyncRequest&&(y("Sending first sync request..."),r._currentSyncRequest=r._doSyncRequest({filterId:o},a)),y("Waiting for saved sync before starting sync processing..."),e.next=23,s;case 23:r._sync({filterId:o});case 24:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}n.isGuest()?r._sync({}):(y("Getting saved sync token..."),s=n.store.getSavedSyncToken().then((function(e){return y("Got saved sync token"),a=e,y("Getting saved sync..."),n.store.getSavedSync()})).then((function(e){if(y("Got reply from saved sync, exists? ".concat(!!e)),e)return r._syncFromCache(e)})).catch((function(e){h.logger.error("Getting saved sync failed",e)})),u())},m.prototype.stop=function(){y("SyncApi.stop"),e.window&&(e.window.removeEventListener("online",this._onOnlineBound,!1),this._onOnlineBound=void 0),this._running=!1,this._currentSyncRequest&&this._currentSyncRequest.abort(),this._keepAliveTimer&&(clearTimeout(this._keepAliveTimer),this._keepAliveTimer=null)},m.prototype.retryImmediately=function(){return!!this._connectionReturnedDefer&&(this._startKeepAlives(0),!0)},m.prototype._syncFromCache=function(){var e=o(i.mark((function e(t){var n,r,o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y("sync(): not doing HTTP hit, instead returning stored /sync data"),n=t.nextBatch,this.client.store.setSyncToken(n),r={oldSyncToken:null,nextSyncToken:n,catchingUp:!1,fromCache:!0},o={next_batch:n,rooms:t.roomsData,groups:t.groupsData,account_data:{events:t.accountData}},e.prev=5,e.next=8,this._processSyncResponse(r,o);case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(5),h.logger.error("Error processing cached sync",e.t0.stack||e.t0);case 13:this._storeIsInvalid||this._updateSyncState("PREPARED",r);case 14:case"end":return e.stop()}}),e,this,[[5,10]])})));return function(t){return e.apply(this,arguments)}}(),m.prototype._sync=function(){var e=o(i.mark((function e(t){var n,r,o,s;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.client,this._running){e.next=6;break}return y("Sync no longer running: exiting."),this._connectionReturnedDefer&&(this._connectionReturnedDefer.reject(),this._connectionReturnedDefer=null),this._updateSyncState("STOPPED"),e.abrupt("return");case 6:return r=n.store.getSyncToken(),e.prev=7,null===this._currentSyncRequest&&(this._currentSyncRequest=this._doSyncRequest(t,r)),e.next=11,this._currentSyncRequest;case 11:o=e.sent,e.next=18;break;case 14:return e.prev=14,e.t0=e.catch(7),this._onSyncError(e.t0,t),e.abrupt("return");case 18:return e.prev=18,this._currentSyncRequest=null,e.finish(18);case 21:return n.store.setSyncToken(o.next_batch),this._failedSyncCount=0,e.next=25,n.store.setSyncData(o);case 25:if(s={oldSyncToken:r,nextSyncToken:o.next_batch,catchingUp:this._catchingUp},!this.opts.crypto){e.next=29;break}return e.next=29,this.opts.crypto.onSyncWillProcess(s);case 29:return e.prev=29,e.next=32,this._processSyncResponse(s,o);case 32:e.next=38;break;case 34:e.prev=34,e.t1=e.catch(29),h.logger.error("Caught /sync error",e.t1.stack||e.t1),this.client.emit("sync.unexpectedError",e.t1);case 38:if(s.catchingUp=this._catchingUp,t.hasSyncedBefore||(this._updateSyncState("PREPARED",s),t.hasSyncedBefore=!0),!this.opts.crypto){e.next=43;break}return e.next=43,this.opts.crypto.onSyncCompleted(s);case 43:if(this._updateSyncState("SYNCING",s),!n.store.wantsSave()){e.next=49;break}if(!this.opts.crypto){e.next=48;break}return e.next=48,this.opts.crypto.saveDeviceList(0);case 48:n.store.save();case 49:this._sync(t);case 50:case"end":return e.stop()}}),e,this,[[7,14,18,21],[29,34]])})));return function(t){return e.apply(this,arguments)}}(),m.prototype._doSyncRequest=function(e,t){var n=this._getSyncParams(e,t);return this.client._http.authedRequest(void 0,"GET","/sync",n,void 0,n.timeout+8e4)},m.prototype._getSyncParams=function(e,t){var n=this.opts.pollTimeout;("SYNCING"!==this.getSyncState()||this._catchingUp)&&(this._catchingUp=!0,n=0);var r=e.filterId;this.client.isGuest()&&!r&&(r=this._getGuestFilter());var i={filter:r,timeout:n};return this.opts.disablePresence&&(i.set_presence="offline"),t?i.since=t:i._cacheBuster=Date.now(),"ERROR"!=this.getSyncState()&&"RECONNECTING"!=this.getSyncState()||(i.timeout=0),i},m.prototype._onSyncError=function(e,t){var n=this;if(!this._running)return y("Sync no longer running: exiting"),this._connectionReturnedDefer&&(this._connectionReturnedDefer.reject(),this._connectionReturnedDefer=null),void this._updateSyncState("STOPPED");h.logger.error("/sync error %s",e),h.logger.error(e),this._shouldAbortSync(e)||(this._failedSyncCount++,h.logger.log("Number of consecutive failed sync requests:",this._failedSyncCount),y("Starting keep-alive"),this._startKeepAlives().then((function(e){e&&"ERROR"===n.getSyncState()&&n._updateSyncState("CATCHUP",{oldSyncToken:null,nextSyncToken:null,catchingUp:!0}),n._sync(t)})),this._currentSyncRequest=null,this._updateSyncState(this._failedSyncCount>=3?"ERROR":"RECONNECTING",{error:e}))},m.prototype._processSyncResponse=function(){var e=o(i.mark((function e(t,n){var r,s,a,u,c,d,v,g,m,b;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.client,s=this,n.presence&&l.isArray(n.presence.events)&&n.presence.events.map(r.getEventMapper()).forEach((function(e){var t=r.store.getUser(e.getSender());t?t.setPresenceEvent(e):((t=_(r,e.getSender())).setPresenceEvent(e),r.store.storeUser(t)),r.emit("event",e)})),n.account_data&&l.isArray(n.account_data.events)&&(a=n.account_data.events.map(r.getEventMapper()),u=a.reduce((function(e,t){return e[t.getId()]=r.store.getAccountData(t.getType()),e}),{}),r.store.storeAccountDataEvents(a),a.forEach((function(e){if("m.push_rules"===e.getType()){var t=e.getContent();r.pushRules=p.PushProcessor.rewriteDefaultRules(t)}var n=u[e.getId()];return r.emit("accountData",e,n),e}))),n.to_device&&l.isArray(n.to_device.events)&&n.to_device.events.length>0?(c=[],n.to_device.events.map(r.getEventMapper()).map((function(e){if("m.key.verification.cancel"===e.getType()){var t=e.getContent().transaction_id;t&&c.push(t)}return e})).forEach((function(e){var t=e.getContent();if("m.room.message"!=e.getType()||"m.bad.encrypted"!=t.msgtype){if("m.key.verification.start"===e.getType()||"m.key.verification.request"===e.getType()){var n=t.transaction_id;c.includes(n)&&e.flagCancelled()}r.emit("toDeviceEvent",e)}else h.logger.log("Ignoring undecryptable to-device event from "+e.getSender())}))):this._catchingUp=!1,n.groups&&(n.groups.invite&&this._processGroupSyncEntry(n.groups.invite,"invite"),n.groups.join&&this._processGroupSyncEntry(n.groups.join,"join"),n.groups.leave&&this._processGroupSyncEntry(n.groups.leave,"leave")),d=[],v=[],g=[],n.rooms&&(n.rooms.invite&&(d=this._mapSyncResponseToRoomArray(n.rooms.invite)),n.rooms.join&&(v=this._mapSyncResponseToRoomArray(n.rooms.join)),n.rooms.leave&&(g=this._mapSyncResponseToRoomArray(n.rooms.leave))),this._notifEvents=[],d.forEach((function(e){var t=e.room,n=s._mapSyncEventsFormat(e.invite_state,t);s._processRoomEvents(t,n),e.isBrandNewRoom&&(t.recalculate(),r.store.storeRoom(t),r.emit("Room",t)),n.forEach((function(e){r.emit("event",e)})),t.updateMyMembership("invite")})),e.next=14,l.promiseMapSeries(v,function(){var e=o(i.mark((function e(n){var a,u,c,d,p,h,v,g,m,b,k;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k=function(){return(k=o(i.mark((function e(t){var n;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.emit("event",t),!t.isState()||"m.room.encryption"!=t.getType()||!s.opts.crypto){e.next=4;break}return e.next=4,s.opts.crypto.onCryptoEvent(t);case 4:t.isState()&&"im.vector.user_status"===t.getType()&&((n=r.store.getUser(t.getStateKey()))?n._unstable_updateStatusMessage(t):((n=_(r,t.getStateKey()))._unstable_updateStatusMessage(t),r.store.storeUser(n)));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)},b=function(e){return k.apply(this,arguments)},a=n.room,u=s._mapSyncEventsFormat(n.state,a),c=s._mapSyncEventsFormat(n.timeline,a),d=s._mapSyncEventsFormat(n.ephemeral),p=s._mapSyncEventsFormat(n.account_data),n.unread_notifications&&(a.setUnreadNotificationCount("total",n.unread_notifications.notification_count),(!(h=r.isRoomEncrypted(a.roomId))||h&&a.getUnreadNotificationCount("highlight")<=0)&&a.setUnreadNotificationCount("highlight",n.unread_notifications.highlight_count)),n.timeline=n.timeline||{},!n.isBrandNewRoom){e.next=13;break}a.getLiveTimeline().setPaginationToken(n.timeline.prev_batch,f.EventTimeline.BACKWARDS),e.next=27;break;case 13:if(!n.timeline.limited){e.next=27;break}v=!0,g=c.length-1;case 16:if(!(g>=0)){e.next=26;break}if(m=c[g].getId(),!a.getTimelineForEvent(m)){e.next=23;break}return y("Already have event "+m+" in limited sync - not resetting"),v=!1,c.splice(0,g),e.abrupt("break",26);case 23:g--,e.next=16;break;case 26:v&&(s._deregisterStateListeners(a),a.resetLiveTimeline(n.timeline.prev_batch,s.opts.canResetEntireTimeline(a.roomId)?null:t.oldSyncToken),r.resetNotifTimelineSet(),s._registerStateListeners(a));case 27:return s._processRoomEvents(a,u,c,t.fromCache),n.summary&&a.setSummary(n.summary),a.addEphemeralEvents(d),a.addAccountData(p),a.recalculate(),n.isBrandNewRoom&&(r.store.storeRoom(a),r.emit("Room",a)),s._processEventsForNotifs(a,c),e.next=36,l.promiseMapSeries(u,b);case 36:return e.next=38,l.promiseMapSeries(c,b);case 38:d.forEach((function(e){r.emit("event",e)})),p.forEach((function(e){r.emit("event",e)})),a.updateMyMembership("join");case 41:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 14:if(g.forEach((function(e){var t=e.room,n=s._mapSyncEventsFormat(e.state,t),i=s._mapSyncEventsFormat(e.timeline,t),o=s._mapSyncEventsFormat(e.account_data);s._processRoomEvents(t,n,i),t.addAccountData(o),t.recalculate(),e.isBrandNewRoom&&(r.store.storeRoom(t),r.emit("Room",t)),s._processEventsForNotifs(t,i),n.forEach((function(e){r.emit("event",e)})),i.forEach((function(e){r.emit("event",e)})),o.forEach((function(e){r.emit("event",e)})),t.updateMyMembership("leave")})),t.oldSyncToken&&this._notifEvents.length&&(this._notifEvents.sort((function(e,t){return e.getTs()-t.getTs()})),this._notifEvents.forEach((function(e){r.getNotifTimelineSet().addLiveEvent(e)}))),!n.device_lists){e.next=22;break}if(!this.opts.crypto){e.next=22;break}return e.next=20,this.opts.crypto.handleDeviceListChanges(t,n.device_lists);case 20:e.next=22;break;case 22:this.opts.crypto&&n.device_one_time_keys_count&&(m=n.device_one_time_keys_count.signed_curve25519||0,this.opts.crypto.updateOneTimeKeyCount(m)),this.opts.crypto&&n["org.matrix.msc2732.device_unused_fallback_key_types"]&&(b=n["org.matrix.msc2732.device_unused_fallback_key_types"],this.opts.crypto.setNeedsNewFallback(b instanceof Array&&!b.includes("signed_curve25519")));case 24:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),m.prototype._startKeepAlives=function(e){void 0===e&&(e=2e3+Math.floor(5e3*Math.random())),null!==this._keepAliveTimer&&clearTimeout(this._keepAliveTimer);var t=this;return e>0?t._keepAliveTimer=setTimeout(t._pokeKeepAlive.bind(t),e):t._pokeKeepAlive(),this._connectionReturnedDefer||(this._connectionReturnedDefer=l.defer()),this._connectionReturnedDefer.promise},m.prototype._pokeKeepAlive=function(e){void 0===e&&(e=!1);var t=this;function n(){clearTimeout(t._keepAliveTimer),t._connectionReturnedDefer&&(t._connectionReturnedDefer.resolve(e),t._connectionReturnedDefer=null)}this.client._http.request(void 0,"GET","/_matrix/client/versions",void 0,void 0,{prefix:"",localTimeoutMs:15e3}).then((function(){n()}),(function(r){400==r.httpStatus||404==r.httpStatus?t._keepAliveTimer=setTimeout(n,2e3):(e=!0,t._keepAliveTimer=setTimeout(t._pokeKeepAlive.bind(t,e),5e3+Math.floor(5e3*Math.random())),t._updateSyncState("ERROR",{error:r}))}))},m.prototype._processGroupSyncEntry=function(e,t){for(var n=0,r=Object.keys(e);n<r.length;n++){var i=r[n],o=e[i],s=this.client.store.getGroup(i),a=null===s;null===s&&(s=this.createGroup(i)),o.profile&&s.setProfile(o.profile.name,o.profile.avatar_url),o.inviter&&s.setInviter({userId:o.inviter}),s.setMyMembership(t),a&&this.client.emit("Group",s)}},m.prototype._mapSyncResponseToRoomArray=function(e){var t=this.client,n=this;return l.keys(e).map((function(r){var i=e[r],o=t.store.getRoom(r),s=!1;return o||(o=n.createRoom(r),s=!0),i.room=o,i.isBrandNewRoom=s,i}))},m.prototype._mapSyncEventsFormat=function(e,t){if(!e||!l.isArray(e.events))return[];var n=this.client.getEventMapper();return e.events.map((function(e){return t&&(e.room_id=t.roomId),n(e)}))},m.prototype._resolveInvites=function(e){if(e&&this.opts.resolveInvitesToProfiles){var t=this.client;e.getMembersWithMembership("invite").forEach((function(n){if(!n._requestedProfileInfo){n._requestedProfileInfo=!0;var r=t.getUser(n.userId);(r?Promise.resolve({avatar_url:r.avatarUrl,displayname:r.displayName}):t.getProfileInfo(n.userId)).then((function(t){var r=n.events.member;"invite"===r.getContent().membership&&(r.getContent().avatar_url=t.avatar_url,r.getContent().displayname=t.displayname,n.setMembershipEvent(r,e.currentState))}),(function(e){}))}}))}},m.prototype._processRoomEvents=function(e,t,n,i){var o=e.getLiveTimeline(),s=0==o.getEvents().length;if(s){var a,u=r(t);try{for(u.s();!(a=u.n()).done;){var c=a.value;this.client.getPushActionsForEvent(c)}}catch(l){u.e(l)}finally{u.f()}o.initialiseState(t)}this._resolveInvites(e),e.recalculate(),s||(e.oldState.setStateEvents(t||[]),e.currentState.setStateEvents(t||[])),e.addLiveEvents(n||[],null,i)},m.prototype._processEventsForNotifs=function(e,t){if(this.client.getNotifTimelineSet())for(var n=0;n<t.length;n++){var r=this.client.getPushActionsForEvent(t[n]);r&&r.notify&&r.tweaks&&r.tweaks.highlight&&this._notifEvents.push(t[n])}},m.prototype._getGuestFilter=function(){return this.client._guestRooms?JSON.stringify({room:{timeline:{limit:20}}}):"{}"},m.prototype._updateSyncState=function(e,t){var n=this._syncState;this._syncState=e,this._syncStateData=t,this.client.emit("sync",this._syncState,n,t)},m.prototype._onOnline=function(){y("Browser thinks we are back online"),this._startKeepAlives(0)}}).call(this,n(9))},function(e,t,n){"use strict";var r=n(35),i=n(7),o=n(8),s=n(22),a=n(13),u=n(14),c=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.Relations=void 0;var l=c(n(21)),d=n(11),f=n(16),p=n(1),h=function(e){a(n,e);var t=u(n);function n(e,r,o){var a;return i(this,n),a=t.call(this),(0,l.default)(s(a),"_onEventStatus",(function(e,t){e.isSending()?t===f.EventStatus.CANCELLED&&(e.removeListener("Event.status",a._onEventStatus),a._removeEvent(e)):e.removeListener("Event.status",a._onEventStatus)})),(0,l.default)(s(a),"_onBeforeRedaction",(function(e){a._relations.has(e)&&(a._relations.delete(e),"m.annotation"===a.relationType?a._removeAnnotationFromAggregation(e):"m.replace"===a.relationType&&a._targetEvent&&a._targetEvent.makeReplaced(a.getLastReplacement()),e.removeListener("Event.beforeRedaction",a._onBeforeRedaction),a.emit("Relations.redaction",e))})),a.relationType=e,a.eventType=r,a._relations=new Set,a._annotationsByKey={},a._annotationsBySender={},a._sortedAnnotationsByKey=[],a._targetEvent=null,a}return o(n,[{key:"addEvent",value:function(e){if(!this._relations.has(e)){var t=e.getRelation();if(t){var n=t.rel_type,r=e.getType();this.relationType===n&&this.eventType===r?(e.isSending()&&e.on("Event.status",this._onEventStatus),this._relations.add(e),"m.annotation"===this.relationType?this._addAnnotationToAggregation(e):"m.replace"===this.relationType&&this._targetEvent&&this._targetEvent.makeReplaced(this.getLastReplacement()),e.on("Event.beforeRedaction",this._onBeforeRedaction),this.emit("Relations.add",e)):p.logger.error("Event relation info doesn't match this container")}else p.logger.error("Event must have relation info")}}},{key:"_removeEvent",value:function(e){if(this._relations.has(e)){var t=e.getRelation();if(t){var n=t.rel_type,r=e.getType();this.relationType===n&&this.eventType===r?(this._relations.delete(e),"m.annotation"===this.relationType?this._removeAnnotationFromAggregation(e):"m.replace"===this.relationType&&this._targetEvent&&this._targetEvent.makeReplaced(this.getLastReplacement()),this.emit("Relations.remove",e)):p.logger.error("Event relation info doesn't match this container")}else p.logger.error("Event must have relation info")}}},{key:"getRelations",value:function(){return r(this._relations)}},{key:"_addAnnotationToAggregation",value:function(e){var t=e.getRelation().key;if(t){var n=this._annotationsByKey[t];n||(n=this._annotationsByKey[t]=new Set,this._sortedAnnotationsByKey.push([t,n])),n.add(e),this._sortedAnnotationsByKey.sort((function(e,t){var n=e[1];return t[1].size-n.size}));var r=e.getSender(),i=this._annotationsBySender[r];i||(i=this._annotationsBySender[r]=new Set),i.add(e)}}},{key:"_removeAnnotationFromAggregation",value:function(e){var t=e.getRelation().key;if(t){var n=this._annotationsByKey[t];n&&(n.delete(e),this._sortedAnnotationsByKey.sort((function(e,t){var n=e[1];return t[1].size-n.size})));var r=e.getSender(),i=this._annotationsBySender[r];i&&i.delete(e)}}},{key:"getSortedAnnotationsByKey",value:function(){return"m.annotation"!==this.relationType?null:this._sortedAnnotationsByKey}},{key:"getAnnotationsBySender",value:function(){return"m.annotation"!==this.relationType?null:this._annotationsBySender}},{key:"getLastReplacement",value:function(){var e=this;if("m.replace"!==this.relationType)return null;if(!this._targetEvent)return null;var t=this._targetEvent.getServerAggregatedRelation("m.replace"),n=t&&t.origin_server_ts;return this.getRelations().reduce((function(t,r){return r.getSender()!==e._targetEvent.getSender()||n&&n>r.getTs()||t&&t.getTs()>r.getTs()?t:r}),null)}},{key:"setTargetEvent",value:function(e){if(!this._targetEvent&&(this._targetEvent=e,"m.replace"===this.relationType)){var t=this.getLastReplacement();t&&this._targetEvent.makeReplaced(t)}}}]),n}(d.EventEmitter);t.Relations=h},function(e,t,n){var r=n(58);e.exports=function(e){if(Array.isArray(e))return r(e)}},function(e,t){e.exports=function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RoomSummary=function(e,t){this.roomId=e,this.info=t}},function(e,t,n){"use strict";var r=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.SearchResult=s;var i=r(n(5)),o=n(117);function s(e,t){this.rank=e,this.context=t}s.fromJson=function(e,t){var n=e.context||{},r=n.events_before||[],a=n.events_after||[],u=new o.EventContext(t(e.result));return u.setPaginateToken(n.start,!0),u.addEvents(i.map(r,t),!0),u.addEvents(i.map(a,t),!1),u.setPaginateToken(n.end,!1),new s(e.rank,u)}},function(e,t,n){"use strict";function r(e){this._timeline=[e],this._ourEventIndex=0,this._paginateTokens={b:null,f:null},this._paginateRequests={b:null,f:null}}Object.defineProperty(t,"__esModule",{value:!0}),t.EventContext=r,r.prototype.getEvent=function(){return this._timeline[this._ourEventIndex]},r.prototype.getTimeline=function(){return this._timeline},r.prototype.getOurEventIndex=function(){return this._ourEventIndex},r.prototype.getPaginateToken=function(e){return this._paginateTokens[e?"b":"f"]},r.prototype.setPaginateToken=function(e,t){this._paginateTokens[t?"b":"f"]=e},r.prototype.addEvents=function(e,t){t?(this._timeline=e.concat(this._timeline),this._ourEventIndex+=e.length):this._timeline=this._timeline.concat(e)}},function(e,t,n){"use strict";function r(){this.fromToken=null}Object.defineProperty(t,"__esModule",{value:!0}),t.StubStore=r,r.prototype={isNewlyCreated:function(){return Promise.resolve(!0)},getSyncToken:function(){return this.fromToken},setSyncToken:function(e){this.fromToken=e},storeGroup:function(e){},getGroup:function(e){return null},getGroups:function(){return[]},storeRoom:function(e){},getRoom:function(e){return null},getRooms:function(){return[]},removeRoom:function(e){},getRoomSummaries:function(){return[]},storeUser:function(e){},getUser:function(e){return null},getUsers:function(){return[]},scrollback:function(e,t){return[]},storeEvents:function(e,t,n,r){},storeFilter:function(e){},getFilter:function(e,t){return null},getFilterIdByName:function(e){return null},setFilterIdByName:function(e,t){},storeAccountDataEvents:function(e){},getAccountData:function(e){},setSyncData:function(e){return Promise.resolve()},wantsSave:function(){return!1},save:function(){},startup:function(){return Promise.resolve()},getSavedSync:function(){return Promise.resolve(null)},getSavedSyncToken:function(){return Promise.resolve(null)},deleteAllData:function(){return Promise.resolve()},getOutOfBandMembers:function(){return Promise.resolve(null)},setOutOfBandMembers:function(){return Promise.resolve()},clearOutOfBandMembers:function(){return Promise.resolve()},getClientOptions:function(){return Promise.resolve()},storeClientOptions:function(){return Promise.resolve()}}},function(e,t,n){"use strict";var r=n(6),i=n(7),o=n(8),s=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.CallEventHandler=void 0;var a=s(n(21)),u=n(1),c=n(51),l=n(67),d=function(){function e(t){var n=this;i(this,e),(0,a.default)(this,"client",void 0),(0,a.default)(this,"calls",void 0),(0,a.default)(this,"callEventBuffer",void 0),(0,a.default)(this,"candidateEventsByCall",void 0),(0,a.default)(this,"evaluateEventBuffer",(function(){if("SYNCING"===n.client.getSyncState()){if(n.callEventBuffer.some((function(e){return e.isBeingDecrypted()})))return;var e,t=new Set,i=r(n.callEventBuffer);try{for(i.s();!(e=i.n()).done;){var o=e.value;o.getType()!==l.EventType.CallAnswer&&o.getType()!==l.EventType.CallHangup||t.add(o.getContent().call_id)}}catch(d){i.e(d)}finally{i.f()}var s,a=r(n.callEventBuffer);try{for(a.s();!(s=a.n()).done;){var c=s.value;if(c.getType()!==l.EventType.CallInvite||!t.has(c.getContent().call_id))try{n.handleCallEvent(c)}catch(c){u.logger.error("Caught exception handling call event",c)}}}catch(d){a.e(d)}finally{a.f()}n.callEventBuffer=[]}})),(0,a.default)(this,"onEvent",(function(e){(0===e.getType().indexOf("m.call.")||e.isBeingDecrypted())&&n.callEventBuffer.push(e),(e.isBeingDecrypted()||e.isDecryptionFailure())&&e.once("Event.decrypted",(function(){if(-1!==e.getType().indexOf("m.call."))if(n.callEventBuffer.includes(e))n.evaluateEventBuffer();else try{n.handleCallEvent(e)}catch(t){u.logger.error("Caught exception handling call event",t)}}))})),this.client=t,this.calls=new Map,this.callEventBuffer=[],this.candidateEventsByCall=new Map,this.client.on("sync",this.evaluateEventBuffer),this.client.on("event",this.onEvent)}return o(e,[{key:"stop",value:function(){this.client.removeListener("sync",this.evaluateEventBuffer),this.client.removeListener("event",this.onEvent)}},{key:"handleCallEvent",value:function(e){var t=e.getContent(),n=t.call_id?this.calls.get(t.call_id):void 0;if(e.getType()===l.EventType.CallInvite){if(e.getSender()===this.client.credentials.userId)return;if(e.getLocalAge()>t.lifetime-3e3)return;if(n&&n.state===c.CallState.Ended)return;if(n&&u.logger.log("WARN: Already have a MatrixCall with id ".concat(t.call_id," but got an ")+"invite. Clobbering."),!(n=(0,c.createNewMatrixCall)(this.client,e.getRoomId(),{forceTURN:this.client._forceTURN})))return void u.logger.log("Incoming call ID "+t.call_id+" but this client doesn't support WebRTC");if(n.callId=t.call_id,n.initWithInvite(e),this.calls.set(n.callId,n),this.candidateEventsByCall.get(n.callId)){var i,o=r(this.candidateEventsByCall.get(n.callId));try{for(o.s();!(i=o.n()).done;){var s=i.value;n.onRemoteIceCandidatesReceived(s)}}catch(v){o.e(v)}finally{o.f()}}var a,d,f=r(this.calls.values());try{for(f.s();!(d=f.n()).done;){var p=d.value,h=[c.CallState.WaitLocalMedia,c.CallState.CreateOffer,c.CallState.InviteSent].includes(p.state);if(n.roomId===p.roomId&&p.direction===c.CallDirection.Outbound&&h){a=p;break}}}catch(v){f.e(v)}finally{f.f()}a?a.state===c.CallState.WaitLocalMedia||a.state===c.CallState.CreateOffer||a.callId>n.callId?(u.logger.log("Glare detected: answering incoming call "+n.callId+" and canceling outgoing call "+a.callId),a.replacedBy(n),n.answer()):(u.logger.log("Glare detected: rejecting incoming call "+n.callId+" and keeping outgoing call "+a.callId),n.hangup(c.CallErrorCode.Replaced,!0)):this.client.emit("Call.incoming",n)}else if(e.getType()===l.EventType.CallAnswer){if(!n)return;e.getSender()===this.client.credentials.userId?n.state===c.CallState.Ringing&&n.onAnsweredElsewhere(t):n.onAnswerReceived(e)}else if(e.getType()===l.EventType.CallCandidates){if(e.getSender()===this.client.credentials.userId)return;n?n.onRemoteIceCandidatesReceived(e):(this.candidateEventsByCall.has(t.call_id)||this.candidateEventsByCall.set(t.call_id,[]),this.candidateEventsByCall.get(t.call_id).push(e))}else if([l.EventType.CallHangup,l.EventType.CallReject].includes(e.getType()))n?n.state!==c.CallState.Ended&&(e.getType()===l.EventType.CallHangup?n.onHangupReceived(t):n.onRejectReceived(t),this.calls.delete(t.call_id)):(n=(0,c.createNewMatrixCall)(this.client,e.getRoomId()))&&(n.callId=t.call_id,n.initWithHangup(e),this.calls.set(t.call_id,n));else if(e.getType()===l.EventType.CallSelectAnswer){if(!n)return;if(e.getContent().party_id===n.ourPartyId)return;n.onSelectAnswerReceived(e)}else if(e.getType()===l.EventType.CallNegotiate){if(!n)return;if(e.getContent().party_id===n.ourPartyId)return;n.onNegotiateReceived(e)}}}]),e}();t.CallEventHandler=d},function(e,t,n){"use strict";t.byteLength=function(e){var t=c(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=c(e),s=r[0],a=r[1],u=new o(function(e,t,n){return 3*(t+n)/4-n}(0,s,a)),l=0,d=a>0?s-4:s;for(n=0;n<d;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=255&t;2===a&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,u[l++]=255&t);1===a&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,u[l++]=t>>8&255,u[l++]=255&t);return u},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,o=[],s=16383,a=0,u=n-i;a<u;a+=s)o.push(l(e,a,a+s>u?u:a+s));1===i?(t=e[n-1],o.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],o.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return o.join("")};for(var r=[],i=[],o="undefined"!==typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,u=s.length;a<u;++a)r[a]=s[a],i[s.charCodeAt(a)]=a;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var i,o,s=[],a=t;a<n;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(r[(o=i)>>18&63]+r[o>>12&63]+r[o>>6&63]+r[63&o]);return s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var o,s,a=8*i-r-1,u=(1<<a)-1,c=u>>1,l=-7,d=n?i-1:0,f=n?-1:1,p=e[t+d];for(d+=f,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=256*o+e[t+d],d+=f,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=r;l>0;s=256*s+e[t+d],d+=f,l-=8);if(0===o)o=1-c;else{if(o===u)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),o-=c}return(p?-1:1)*s*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var s,a,u,c=8*o-i-1,l=(1<<c)-1,d=l>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,h=r?1:-1,v=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),(t+=s+d>=1?f/u:f*Math.pow(2,1-d))*u>=2&&(s++,u/=2),s+d>=l?(a=0,s=l):s+d>=1?(a=(t*u-1)*Math.pow(2,i),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,i),s=0));i>=8;e[n+p]=255&a,p+=h,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;e[n+p]=255&s,p+=h,s/=256,c-=8);e[n+p-h]|=128*v}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";var r=n(2),i=n(3),o=n(7),s=n(8);Object.defineProperty(t,"__esModule",{value:!0}),t.RoomList=void 0;var a=n(20),u=function(){function e(t){o(this,e),this._cryptoStore=t,this._roomEncryption={}}return s(e,[{key:"init",value:function(){var e=i(r.mark((function e(){var t=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._cryptoStore.doTxn("readwrite",[a.IndexedDBCryptoStore.STORE_ROOMS],(function(e){t._cryptoStore.getEndToEndRooms(e,(function(e){t._roomEncryption=e}))}));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getRoomEncryption",value:function(e){return this._roomEncryption[e]||null}},{key:"isRoomEncrypted",value:function(e){return Boolean(this.getRoomEncryption(e))}},{key:"setRoomEncryption",value:function(){var e=i(r.mark((function e(t,n){var i=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._roomEncryption[t]=n,e.next=3,this._cryptoStore.doTxn("readwrite",[a.IndexedDBCryptoStore.STORE_ROOMS],(function(e){i._cryptoStore.storeEndToEndRoom(t,n,e)}));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}();t.RoomList=u},function(e,t,n){"use strict";var r=n(15),i=n(6),o=n(2),s=n(3),a=n(10),u=n(7),c=n(8),l=n(13),d=n(14);Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStorageCryptoStore=void 0;var f=n(1),p=n(43),h="crypto.",v="crypto.account",g="crypto.cross_signing_keys",y="crypto.notified_error_devices",m="crypto.device_data",_="crypto.inboundgroupsessions/",b="crypto.sessionsneedingbackup";function k(e){return"crypto.sessions/"+e}function S(e){return"crypto.session.problems/"+e}function E(e,t){return _+e+"/"+t}function w(e,t){return"crypto.inboundgroupsessions.withheld/"+e+"/"+t}function x(e){return"crypto.rooms/"+e}var I=function(e){l(n,e);var t=d(n);function n(e){var r;return u(this,n),(r=t.call(this)).store=e,r}return c(n,[{key:"countEndToEndSessions",value:function(e,t){for(var n=0,r=0;r<this.store.length;++r)this.store.key(r).startsWith(k(""))&&++n;t(n)}},{key:"_getEndToEndSessions",value:function(e,t,n){for(var r=T(this.store,k(e)),i={},o=0,s=Object.entries(r||{});o<s.length;o++){var u=a(s[o],2),c=u[0],l=u[1];i[c]="string"===typeof l?{session:l}:l}return i}},{key:"getEndToEndSession",value:function(e,t,n,r){r(this._getEndToEndSessions(e)[t]||{})}},{key:"getEndToEndSessions",value:function(e,t,n){n(this._getEndToEndSessions(e)||{})}},{key:"getAllEndToEndSessions",value:function(e,t){for(var n=0;n<this.store.length;++n)if(this.store.key(n).startsWith(k("")))for(var r=this.store.key(n).split("/")[1],i=0,o=Object.values(this._getEndToEndSessions(r));i<o.length;i++){t(o[i])}}},{key:"storeEndToEndSession",value:function(e,t,n,r){var i=this._getEndToEndSessions(e)||{};i[t]=n,R(this.store,k(e),i)}},{key:"storeEndToEndSessionProblem",value:function(){var e=s(o.mark((function e(t,n,r){var i,s;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=S(t),(s=T(this.store,i)||[]).push({type:n,fixed:r,time:Date.now()}),s.sort((function(e,t){return e.time-t.time})),R(this.store,i,s);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getEndToEndSessionProblem",value:function(){var e=s(o.mark((function e(t,n){var r,s,a,u,c,l;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=S(t),(s=T(this.store,r)||[]).length){e.next=4;break}return e.abrupt("return",null);case 4:a=s[s.length-1],u=i(s),e.prev=6,u.s();case 8:if((c=u.n()).done){e.next=14;break}if(!((l=c.value).time>n)){e.next=12;break}return e.abrupt("return",Object.assign({},l,{fixed:a.fixed}));case 12:e.next=8;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(6),u.e(e.t0);case 19:return e.prev=19,u.f(),e.finish(19);case 22:if(!a.fixed){e.next=26;break}return e.abrupt("return",null);case 26:return e.abrupt("return",a);case 27:case"end":return e.stop()}}),e,this,[[6,16,19,22]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"filterOutNotifiedErrorDevices",value:function(){var e=s(o.mark((function e(t){var n,s,a,u,c,l,d;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=T(this.store,y)||{},s=[],a=i(t);try{for(a.s();!(u=a.n()).done;)c=u.value,l=c.userId,d=c.deviceInfo,l in n?d.deviceId in n[l]||(s.push(c),n[l][d.deviceId]=!0):(s.push(c),n[l]=r({},d.deviceId,!0))}catch(o){a.e(o)}finally{a.f()}return R(this.store,y,n),e.abrupt("return",s);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getEndToEndInboundGroupSession",value:function(e,t,n,r){r(T(this.store,E(e,t)),T(this.store,w(e,t)))}},{key:"getAllEndToEndInboundGroupSessions",value:function(e,t){for(var n=0;n<this.store.length;++n){var r=this.store.key(n);r.startsWith(_)&&t({senderKey:r.substr(_.length,43),sessionId:r.substr(_.length+44),sessionData:T(this.store,r)})}t(null)}},{key:"addEndToEndInboundGroupSession",value:function(e,t,n,r){T(this.store,E(e,t))||this.storeEndToEndInboundGroupSession(e,t,n,r)}},{key:"storeEndToEndInboundGroupSession",value:function(e,t,n,r){R(this.store,E(e,t),n)}},{key:"storeEndToEndInboundGroupSessionWithheld",value:function(e,t,n,r){R(this.store,w(e,t),n)}},{key:"getEndToEndDeviceData",value:function(e,t){t(T(this.store,m))}},{key:"storeEndToEndDeviceData",value:function(e,t){R(this.store,m,e)}},{key:"storeEndToEndRoom",value:function(e,t,n){R(this.store,x(e),t)}},{key:"getEndToEndRooms",value:function(e,t){for(var n={},r=x(""),i=0;i<this.store.length;++i){var o=this.store.key(i);if(o.startsWith(r))n[o.substr(r.length)]=T(this.store,o)}t(n)}},{key:"getSessionsNeedingBackup",value:function(e){var t=this,n=T(this.store,b)||{},r=[];for(var i in n){if(Object.prototype.hasOwnProperty.call(n,i))if("break"===function(){var n=i.substr(0,43),o=i.substr(44);if(t.getEndToEndInboundGroupSession(n,o,null,(function(e){r.push({senderKey:n,sessionId:o,sessionData:e})})),e&&i.length>=e)return"break"}())break}return Promise.resolve(r)}},{key:"countSessionsNeedingBackup",value:function(){var e=T(this.store,b)||{};return Promise.resolve(Object.keys(e).length)}},{key:"unmarkSessionsNeedingBackup",value:function(e){var t,n=T(this.store,b)||{},r=i(e);try{for(r.s();!(t=r.n()).done;){var o=t.value;delete n[o.senderKey+"/"+o.sessionId]}}catch(s){r.e(s)}finally{r.f()}return R(this.store,b,n),Promise.resolve()}},{key:"markSessionsNeedingBackup",value:function(e){var t,n=T(this.store,b)||{},r=i(e);try{for(r.s();!(t=r.n()).done;){var o=t.value;n[o.senderKey+"/"+o.sessionId]=!0}}catch(s){r.e(s)}finally{r.f()}return R(this.store,b,n),Promise.resolve()}},{key:"deleteAllData",value:function(){return this.store.removeItem(v),Promise.resolve()}},{key:"getAccount",value:function(e,t){t(T(this.store,v))}},{key:"storeAccount",value:function(e,t){R(this.store,v,t)}},{key:"getCrossSigningKeys",value:function(e,t){t(T(this.store,g))}},{key:"getSecretStorePrivateKey",value:function(e,t,n){t(T(this.store,h+"ssss_cache.".concat(n)))}},{key:"storeCrossSigningKeys",value:function(e,t){R(this.store,g,t)}},{key:"storeSecretStorePrivateKey",value:function(e,t,n){R(this.store,h+"ssss_cache.".concat(t),n)}},{key:"doTxn",value:function(e,t,n){return Promise.resolve(n(null))}}],[{key:"exists",value:function(e){for(var t=e.length,n=0;n<t;n++)if(e.key(n).startsWith(h))return!0;return!1}}]),n}(p.MemoryCryptoStore);function T(e,t){try{return JSON.parse(e.getItem(t))}catch(n){f.logger.log("Error: Failed to get key %s: %s",t,n.stack||n),f.logger.log(n.stack)}return null}function R(e,t,n){e.setItem(t,JSON.stringify(n))}t.LocalStorageCryptoStore=I},function(e,t,n){"use strict";var r=n(6),i=n(2),o=n(3),s=n(7),a=n(8),u=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.upgradeDatabase=function(e,t){c.logger.log("Upgrading IndexedDBCryptoStore from version ".concat(t)+" to ".concat(9)),t<1&&function(e){var t=e.createObjectStore("outgoingRoomKeyRequests",{keyPath:"requestId"});t.createIndex("session",["requestBody.room_id","requestBody.session_id"]),t.createIndex("state","state")}(e);t<2&&e.createObjectStore("account");if(t<3){e.createObjectStore("sessions",{keyPath:["deviceKey","sessionId"]}).createIndex("deviceKey","deviceKey")}t<4&&e.createObjectStore("inbound_group_sessions",{keyPath:["senderCurve25519Key","sessionId"]});t<5&&e.createObjectStore("device_data");t<6&&e.createObjectStore("rooms");t<7&&e.createObjectStore("sessions_needing_backup",{keyPath:["senderCurve25519Key","sessionId"]});t<8&&e.createObjectStore("inbound_group_sessions_withheld",{keyPath:["senderCurve25519Key","sessionId"]});if(t<9){e.createObjectStore("session_problems",{keyPath:["deviceKey","time"]}).createIndex("deviceKey","deviceKey"),e.createObjectStore("notified_error_devices",{keyPath:["userId","deviceId"]})}},t.Backend=t.VERSION=void 0;var c=n(1),l=u(n(5));t.VERSION=9;var d=function(){function e(t){var n=this;s(this,e),this._db=t,t.onversionchange=function(e){c.logger.log("versionchange for indexeddb ".concat(n._dbName,": closing")),t.close()}}return a(e,[{key:"getOrAddOutgoingRoomKeyRequest",value:function(e){var t=this,n=e.requestBody;return new Promise((function(r,i){var o=t._db.transaction("outgoingRoomKeyRequests","readwrite");o.onerror=i,t._getOutgoingRoomKeyRequest(o,n,(function(t){if(t)return c.logger.log("already have key request outstanding for "+"".concat(n.room_id," / ").concat(n.session_id,": ")+"not sending another"),void r(t);c.logger.log("enqueueing key request for ".concat(n.room_id," / ")+n.session_id),o.oncomplete=function(){r(e)},o.objectStore("outgoingRoomKeyRequests").add(e)}))}))}},{key:"getOutgoingRoomKeyRequest",value:function(e){var t=this;return new Promise((function(n,r){var i=t._db.transaction("outgoingRoomKeyRequests","readonly");i.onerror=r,t._getOutgoingRoomKeyRequest(i,e,(function(e){n(e)}))}))}},{key:"_getOutgoingRoomKeyRequest",value:function(e,t,n){e.objectStore("outgoingRoomKeyRequests").index("session").openCursor([t.room_id,t.session_id]).onsuccess=function(e){var r=e.target.result;if(r){var i=r.value;l.deepCompare(i.requestBody,t)?n(i):r.continue()}else n(null)}}},{key:"getOutgoingRoomKeyRequestByState",value:function(e){if(0===e.length)return Promise.resolve(null);var t,n=0;var r=this._db.transaction("outgoingRoomKeyRequests","readonly"),i=r.objectStore("outgoingRoomKeyRequests"),o=e[n];return i.index("state").openCursor(o).onsuccess=function r(i){var o=i.target.result;if(o)t=o.value;else if(!(++n>=e.length)){var s=e[n];i.target.source.openCursor(s).onsuccess=r}},p(r).then((function(){return t}))}},{key:"getAllOutgoingRoomKeyRequestsByState",value:function(e){var t=this;return new Promise((function(n,r){var i=t._db.transaction("outgoingRoomKeyRequests","readonly").objectStore("outgoingRoomKeyRequests").index("state").getAll(e);i.onsuccess=function(e){return n(e.target.result)},i.onerror=function(e){return r(e.target.error)}}))}},{key:"getOutgoingRoomKeyRequestsByTarget",value:function(e,t,n){var r=0,i=[];var o=this._db.transaction("outgoingRoomKeyRequests","readonly"),s=o.objectStore("outgoingRoomKeyRequests"),a=n[r];return s.index("state").openCursor(a).onsuccess=function o(s){var a=s.target.result;if(a){var u=a.value;u.recipients.includes({userId:e,deviceId:t})&&i.push(u),a.continue()}else{if(++r>=n.length)return;var c=n[r];s.target.source.openCursor(c).onsuccess=o}},p(o).then((function(){return i}))}},{key:"updateOutgoingRoomKeyRequest",value:function(e,t,n){var r=null;var i=this._db.transaction("outgoingRoomKeyRequests","readwrite");return i.objectStore("outgoingRoomKeyRequests").openCursor(e).onsuccess=function(e){var i=e.target.result;if(i){var o=i.value;o.state==t?(Object.assign(o,n),i.update(o),r=o):c.logger.warn("Cannot update room key request from ".concat(t," ")+"as it was already updated to ".concat(o.state))}},p(i).then((function(){return r}))}},{key:"deleteOutgoingRoomKeyRequest",value:function(e,t){var n=this._db.transaction("outgoingRoomKeyRequests","readwrite");return n.objectStore("outgoingRoomKeyRequests").openCursor(e).onsuccess=function(e){var n=e.target.result;if(n){var r=n.value;r.state==t?n.delete():c.logger.warn("Cannot delete room key request in state ".concat(r.state," ")+"(expected ".concat(t,")"))}},p(n)}},{key:"getAccount",value:function(e,t){var n=e.objectStore("account").get("-");n.onsuccess=function(){try{t(n.result||null)}catch(r){f(e,r)}}}},{key:"storeAccount",value:function(e,t){e.objectStore("account").put(t,"-")}},{key:"getCrossSigningKeys",value:function(e,t){var n=e.objectStore("account").get("crossSigningKeys");n.onsuccess=function(){try{t(n.result||null)}catch(r){f(e,r)}}}},{key:"getSecretStorePrivateKey",value:function(e,t,n){var r=e.objectStore("account").get("ssss_cache:".concat(n));r.onsuccess=function(){try{t(r.result||null)}catch(n){f(e,n)}}}},{key:"storeCrossSigningKeys",value:function(e,t){e.objectStore("account").put(t,"crossSigningKeys")}},{key:"storeSecretStorePrivateKey",value:function(e,t,n){e.objectStore("account").put(n,"ssss_cache:".concat(t))}},{key:"countEndToEndSessions",value:function(e,t){var n=e.objectStore("sessions").count();n.onsuccess=function(){try{t(n.result)}catch(r){f(e,r)}}}},{key:"getEndToEndSessions",value:function(e,t,n){var r=t.objectStore("sessions").index("deviceKey").openCursor(e),i={};r.onsuccess=function(){var e=r.result;if(e)i[e.value.sessionId]={session:e.value.session,lastReceivedMessageTs:e.value.lastReceivedMessageTs},e.continue();else try{n(i)}catch(o){f(t,o)}}}},{key:"getEndToEndSession",value:function(e,t,n,r){var i=n.objectStore("sessions").get([e,t]);i.onsuccess=function(){try{i.result?r({session:i.result.session,lastReceivedMessageTs:i.result.lastReceivedMessageTs}):r(null)}catch(e){f(n,e)}}}},{key:"getAllEndToEndSessions",value:function(e,t){var n=e.objectStore("sessions").openCursor();n.onsuccess=function(){try{var r=n.result;r?(t(r.value),r.continue()):t(null)}catch(i){f(e,i)}}}},{key:"storeEndToEndSession",value:function(e,t,n,r){r.objectStore("sessions").put({deviceKey:e,sessionId:t,session:n.session,lastReceivedMessageTs:n.lastReceivedMessageTs})}},{key:"storeEndToEndSessionProblem",value:function(){var e=o(i.mark((function e(t,n,r){var o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=this._db.transaction("session_problems","readwrite"),o.objectStore("session_problems").put({deviceKey:t,type:n,fixed:r,time:Date.now()}),e.abrupt("return",p(o));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getEndToEndSessionProblem",value:function(){var e=o(i.mark((function e(t,n){var o,s,a,u,c;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=this._db.transaction("session_problems","readwrite"),a=s.objectStore("session_problems"),u=a.index("deviceKey"),(c=u.getAll(t)).onsuccess=function(e){var t=c.result;if(t.length){t.sort((function(e,t){return e.time-t.time}));var i,s=t[t.length-1],a=r(t);try{for(a.s();!(i=a.n()).done;){var u=i.value;if(u.time>n)return void(o=Object.assign({},u,{fixed:s.fixed}))}}catch(l){a.e(l)}finally{a.f()}o=s.fixed?null:s}else o=null},e.next=7,p(s);case 7:return e.abrupt("return",o);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"filterOutNotifiedErrorDevices",value:function(){var e=o(i.mark((function e(t){var n,r,o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._db.transaction("notified_error_devices","readwrite"),r=n.objectStore("notified_error_devices"),o=[],e.next=5,Promise.all(t.map((function(e){return new Promise((function(t){var n=e.userId,i=e.deviceInfo,s=r.get([n,i.deviceId]);s.onsuccess=function(){s.result||(r.put({userId:n,deviceId:i.deviceId}),o.push(e)),t()}}))})));case 5:return e.abrupt("return",o);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getEndToEndInboundGroupSession",value:function(e,t,n,r){var i=!1,o=!1,s=n.objectStore("inbound_group_sessions").get([e,t]);s.onsuccess=function(){try{i=s.result?s.result.session:null,!1!==o&&r(i,o)}catch(e){f(n,e)}};var a=n.objectStore("inbound_group_sessions_withheld").get([e,t]);a.onsuccess=function(){try{o=a.result?a.result.session:null,!1!==i&&r(i,o)}catch(e){f(n,e)}}}},{key:"getAllEndToEndInboundGroupSessions",value:function(e,t){var n=e.objectStore("inbound_group_sessions").openCursor();n.onsuccess=function(){var r=n.result;if(r){try{t({senderKey:r.value.senderCurve25519Key,sessionId:r.value.sessionId,sessionData:r.value.session})}catch(i){f(e,i)}r.continue()}else try{t(null)}catch(i){f(e,i)}}}},{key:"addEndToEndInboundGroupSession",value:function(e,t,n,r){var i=r.objectStore("inbound_group_sessions").add({senderCurve25519Key:e,sessionId:t,session:n});i.onerror=function(n){"ConstraintError"===i.error.name?(n.stopPropagation(),n.preventDefault(),c.logger.log("Ignoring duplicate inbound group session: "+e+" / "+t)):f(r,new Error("Failed to add inbound group session: "+i.error))}}},{key:"storeEndToEndInboundGroupSession",value:function(e,t,n,r){r.objectStore("inbound_group_sessions").put({senderCurve25519Key:e,sessionId:t,session:n})}},{key:"storeEndToEndInboundGroupSessionWithheld",value:function(e,t,n,r){r.objectStore("inbound_group_sessions_withheld").put({senderCurve25519Key:e,sessionId:t,session:n})}},{key:"getEndToEndDeviceData",value:function(e,t){var n=e.objectStore("device_data").get("-");n.onsuccess=function(){try{t(n.result||null)}catch(r){f(e,r)}}}},{key:"storeEndToEndDeviceData",value:function(e,t){t.objectStore("device_data").put(e,"-")}},{key:"storeEndToEndRoom",value:function(e,t,n){n.objectStore("rooms").put(t,e)}},{key:"getEndToEndRooms",value:function(e,t){var n={},r=e.objectStore("rooms").openCursor();r.onsuccess=function(){var i=r.result;if(i)n[i.key]=i.value,i.continue();else try{t(n)}catch(o){f(e,o)}}}},{key:"getSessionsNeedingBackup",value:function(e){var t=this;return new Promise((function(n,r){var i=[],o=t._db.transaction(["sessions_needing_backup","inbound_group_sessions"],"readonly");o.onerror=r,o.oncomplete=function(){n(i)};var s=o.objectStore("sessions_needing_backup"),a=o.objectStore("inbound_group_sessions"),u=s.openCursor();u.onsuccess=function(){var t=u.result;if(t){var n=a.get(t.key);n.onsuccess=function(){i.push({senderKey:n.result.senderCurve25519Key,sessionId:n.result.sessionId,sessionData:n.result.session})},(!e||i.length<e)&&t.continue()}}}))}},{key:"countSessionsNeedingBackup",value:function(e){e||(e=this._db.transaction("sessions_needing_backup","readonly"));var t=e.objectStore("sessions_needing_backup");return new Promise((function(e,n){var r=t.count();r.onerror=n,r.onsuccess=function(){return e(r.result)}}))}},{key:"unmarkSessionsNeedingBackup",value:function(e,t){t||(t=this._db.transaction("sessions_needing_backup","readwrite"));var n=t.objectStore("sessions_needing_backup");return Promise.all(e.map((function(e){return new Promise((function(t,r){var i=n.delete([e.senderKey,e.sessionId]);i.onsuccess=t,i.onerror=r}))})))}},{key:"markSessionsNeedingBackup",value:function(e,t){t||(t=this._db.transaction("sessions_needing_backup","readwrite"));var n=t.objectStore("sessions_needing_backup");return Promise.all(e.map((function(e){return new Promise((function(t,r){var i=n.put({senderCurve25519Key:e.senderKey,sessionId:e.sessionId});i.onsuccess=t,i.onerror=r}))})))}},{key:"doTxn",value:function(e,t,n){var r=this._db.transaction(t,e),i=p(r),o=n(r);return i.then((function(){return o}))}}]),e}();function f(e,t){e._mx_abortexception=t;try{e.abort()}catch(t){}}function p(e){return new Promise((function(t,n){e.oncomplete=function(){void 0!==e._mx_abortexception&&n(e._mx_abortexception),t()},e.onerror=function(t){void 0!==e._mx_abortexception?n(e._mx_abortexception):(c.logger.log("Error performing indexeddb txn",t),n(t.target.error))},e.onabort=function(t){void 0!==e._mx_abortexception?n(e._mx_abortexception):(c.logger.log("Error performing indexeddb txn",t),n(t.target.error))}}))}t.Backend=d},function(e,t,n){"use strict";(function(e,r){var i,o=n(7),s=n(10),a=n(2),u=n(3),c=n(6),l=n(15),d=n(4),f=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.isCryptoAvailable=function(){return Boolean(e.Olm)},t.Crypto=F,t.fixBackupKey=V,t.verificationMethods=void 0;var p=f(n(37)),h=n(11),v=n(50),g=n(1),y=d(n(5)),m=n(70),_=d(n(17)),b=n(129),k=n(38),S=d(n(71)),E=n(39),w=n(130),x=n(131),I=n(132),T=n(20),R=n(72),O=n(133),C=n(73),D=n(74),P=n(54),A=n(137),M=n(138),U=n(139),N=n(36),L=n(40),K=n(75),B=k.DeviceInfo.DeviceVerification,j=(l(i={},R.ReciprocateQRCode.NAME,R.ReciprocateQRCode),l(i,O.SAS.NAME,O.SAS),l(i,R.SHOW_QR_CODE_METHOD,U.IllegalMethod),l(i,R.SCAN_QR_CODE_METHOD,U.IllegalMethod),i),q={RECIPROCATE_QR_CODE:R.ReciprocateQRCode.NAME,SAS:O.SAS.NAME};t.verificationMethods=q;function F(e,t,n,r,i,o,s,l){var d=this;if(this._onDeviceListUserCrossSigningUpdated=this._onDeviceListUserCrossSigningUpdated.bind(this),this._trustCrossSignedDevices=!0,this._reEmitter=new v.ReEmitter(this),this._baseApis=e,this._sessionStore=t,this._userId=n,this._deviceId=r,this._clientStore=i,this._cryptoStore=o,this._roomList=s,l){this._verificationMethods=new Map;var f,p=c(l);try{for(p.s();!(f=p.n()).done;){var h=f.value;"string"===typeof h?j[h]&&this._verificationMethods.set(h,j[h]):h.NAME?this._verificationMethods.set(h.NAME,h):g.logger.warn("Excluding unknown verification method ".concat(h))}}catch(w){p.e(w)}finally{p.f()}}else this._verificationMethods=j;this.backupInfo=null,this.backupKey=null,this._checkedForBackup=!1,this._sendingBackups=!1,this._olmDevice=new m.OlmDevice(o),this._deviceList=new b.DeviceList(e,o,this._olmDevice),this._deviceList.on("userCrossSigningUpdated",this._onDeviceListUserCrossSigningUpdated),this._reEmitter.reEmit(this._deviceList,["crypto.devicesUpdated","crypto.willUpdateDevices"]),this._lastOneTimeKeyCheck=null,this._oneTimeKeyCheckInProgress=!1,this._roomEncryptors={},this._roomDecryptors={},this._supportedAlgorithms=y.keys(S.DECRYPTION_CLASSES),this._deviceKeys={},this._globalBlacklistUnverifiedDevices=!1,this._globalErrorOnUnknownDevices=!0,this._outgoingRoomKeyRequestManager=new I.OutgoingRoomKeyRequestManager(e,this._deviceId,this._cryptoStore),this._receivedRoomKeyRequests=[],this._receivedRoomKeyRequestCancellations=[],this._processingRoomKeyRequests=!1,this._lazyLoadMembers=!1,this._roomDeviceTrackingState={},this._lastNewSessionForced={},this._toDeviceVerificationRequests=new M.ToDeviceRequests,this._inRoomVerificationRequests=new A.InRoomRequests,this._sendKeyRequestsImmediately=!1;var _=this._baseApis._cryptoCallbacks||{},k=(0,E.createCryptoStoreCacheCallbacks)(o,this._olmDevice);this._crossSigningInfo=new E.CrossSigningInfo(n,_,k),this._secretStorage=new x.SecretStorage(e,_),this._dehydrationManager=new K.DehydrationManager(this),!_.getCrossSigningKey&&_.getSecretStorageKey&&(_.getCrossSigningKey=function(){var e=u(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",E.CrossSigningInfo.getFromSecretStorage(t,d._secretStorage));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}function V(e){if("string"!==typeof e||e.indexOf(",")<0)return null;var t=Uint8Array.from(e.split(","),(function(e){return parseInt(e)}));return _.encodeBase64(t)}function G(e){if(!e._oneTimeKeyCheckInProgress){var t=Date.now();if(!(null!==e._lastOneTimeKeyCheck&&t-e._lastOneTimeKeyCheck<6e4)){e._lastOneTimeKeyCheck=t;var n=e._olmDevice.maxNumberOfOneTimeKeys(),r=Math.floor(n/2);e._oneTimeKeyCheckInProgress=!0,Promise.resolve().then((function(){return void 0!==e._oneTimeKeyCount?Promise.resolve(e._oneTimeKeyCount):e._baseApis.uploadKeysRequest({}).then((function(e){return e.one_time_key_counts.signed_curve25519||0}))})).then((function(e){return function(e){return i.apply(this,arguments)}(e)})).catch((function(e){g.logger.error("Error uploading one-time keys",e.stack||e)})).finally((function(){e._oneTimeKeyCount=void 0,e._oneTimeKeyCheckInProgress=!1}))}}function i(){return(i=u(a.mark((function t(n){var i,o;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r>n||e.getNeedsNewFallback())){t.next=21;break}if(!(r>n)){t.next=6;break}return g.logger.info("generating oneTimeKeys"),i=Math.min(r-n,5),t.next=6,e._olmDevice.generateOneTimeKeys(i);case 6:if(!e.getNeedsNewFallback()){t.next=10;break}return g.logger.info("generating fallback key"),t.next=10,e._olmDevice.generateFallbackKey();case 10:return g.logger.info("calling _uploadOneTimeKeys"),t.next=13,H(e);case 13:if(!(o=t.sent).one_time_key_counts||!o.one_time_key_counts.signed_curve25519){t.next=18;break}n=o.one_time_key_counts.signed_curve25519,t.next=19;break;case 18:throw new Error("response for uploading keys does not contain one_time_key_counts.signed_curve25519");case 19:t.next=0;break;case 21:case"end":return t.stop()}}),t)})))).apply(this,arguments)}}function H(e){return $.apply(this,arguments)}function $(){return($=u(a.mark((function e(t){var n,r,i,o,u,c,l,d,f,p,h,v,g,y;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],r={},!t.getNeedsNewFallback()){e.next=8;break}return e.next=5,t._olmDevice.getFallbackKey();case 5:for(i=e.sent,o=0,u=Object.entries(i.curve25519);o<u.length;o++)c=s(u[o],2),l=c[0],d=c[1],f={key:d,fallback:!0},r["signed_curve25519:"+l]=f,n.push(t._signObject(f));t.setNeedsNewFallback(!1);case 8:return e.next=10,t._olmDevice.getOneTimeKeys();case 10:for(v in p=e.sent,h={},p.curve25519)p.curve25519.hasOwnProperty(v)&&(g={key:p.curve25519[v]},h["signed_curve25519:"+v]=g,n.push(t._signObject(g)));return e.next=15,Promise.all(n);case 15:return e.next=17,t._baseApis.uploadKeysRequest({one_time_keys:h,"org.matrix.msc2732.fallback_keys":r});case 17:return y=e.sent,e.next=20,t._olmDevice.markKeysAsPublished();case 20:return e.abrupt("return",y);case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}y.inherits(F,h.EventEmitter),F.prototype.init=function(){var t=u(a.mark((function t(n){var r,i,o,s,u,c=this;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=(r=n||{}).exportedOlmDevice,o=r.pickleKey,g.logger.log("Crypto: initialising Olm..."),t.next=4,e.Olm.init();case 4:return g.logger.log(i?"Crypto: initialising Olm device from exported device...":"Crypto: initialising Olm device..."),t.next=7,this._olmDevice.init({fromExportedDevice:i,pickleKey:o});case 7:return g.logger.log("Crypto: loading device list..."),t.next=10,this._deviceList.load();case 10:return this._deviceKeys["ed25519:"+this._deviceId]=this._olmDevice.deviceEd25519Key,this._deviceKeys["curve25519:"+this._deviceId]=this._olmDevice.deviceCurve25519Key,g.logger.log("Crypto: fetching own devices..."),(s=this._deviceList.getRawStoredDevicesForUser(this._userId))||(s={}),s[this._deviceId]||(g.logger.log("Crypto: adding this device to the store..."),u={keys:this._deviceKeys,algorithms:this._supportedAlgorithms,verified:B.VERIFIED,known:!0},s[this._deviceId]=u,this._deviceList.storeDevicesForUser(this._userId,s),this._deviceList.saveIfDirty()),t.next=18,this._cryptoStore.doTxn("readonly",[T.IndexedDBCryptoStore.STORE_ACCOUNT],(function(e){c._cryptoStore.getCrossSigningKeys(e,(function(e){e&&0!==Object.keys(e).length&&(g.logger.log("Loaded cross-signing public keys from crypto store"),c._crossSigningInfo.setKeys(e))}))}));case 18:this._deviceList.startTrackingDeviceList(this._userId),g.logger.log("Crypto: checking for key backup..."),this._checkAndStartKeyBackup();case 21:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),F.prototype.getCryptoTrustCrossSignedDevices=function(){return this._trustCrossSignedDevices},F.prototype.setCryptoTrustCrossSignedDevices=function(e){this._trustCrossSignedDevices=e;var t,n=c(this._deviceList.getKnownUserIds());try{for(n.s();!(t=n.n()).done;)for(var r=t.value,i=this._deviceList.getRawStoredDevicesForUser(r),o=0,s=Object.keys(i);o<s.length;o++){var a=s[o],u=this.checkDeviceTrust(r,a);if(!u.isLocallyVerified()&&u.isCrossSigningVerified()){var l=this._deviceList.getStoredDevice(r,a);this.emit("deviceVerificationChanged",r,a,l)}}}catch(d){n.e(d)}finally{n.f()}},F.prototype.createRecoveryKeyFromPassphrase=function(){var t=u(a.mark((function t(n){var r,i,o,s,u;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=new e.Olm.PkDecryption,t.prev=1,i={},!n){t.next=11;break}return t.next=6,(0,C.keyFromPassphrase)(n);case 6:o=t.sent,i.passphrase={algorithm:"m.pbkdf2",iterations:o.iterations,salt:o.salt},i.pubkey=r.init_with_private_key(o.key),t.next=12;break;case 11:i.pubkey=r.generate_key();case 12:return s=r.get_private_key(),u=(0,D.encodeRecoveryKey)(s),t.abrupt("return",{keyInfo:i,encodedPrivateKey:u,privateKey:s});case 15:return t.prev=15,r&&r.free(),t.finish(15);case 18:case"end":return t.stop()}}),t,null,[[1,,15,18]])})));return function(e){return t.apply(this,arguments)}}(),F.prototype.isCrossSigningReady=u(a.mark((function e(){var t,n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._crossSigningInfo.getId(),e.next=3,this._crossSigningInfo.isStoredInKeyCache();case 3:if(e.t0=e.sent,e.t0){e.next=8;break}return e.next=7,this._crossSigningInfo.isStoredInSecretStorage(this._secretStorage);case 7:e.t0=e.sent;case 8:return n=e.t0,e.abrupt("return",!(!t||!n));case 10:case"end":return e.stop()}}),e,this)}))),F.prototype.isSecretStorageReady=u(a.mark((function e(){var t,n,r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._secretStorage.hasKey();case 2:return t=e.sent,e.next=5,this._crossSigningInfo.isStoredInSecretStorage(this._secretStorage);case 5:return n=e.sent,r=!this._baseApis.getKeyBackupEnabled()||this._baseApis.isKeyBackupKeyStored(),e.abrupt("return",!!(t&&n&&r));case 8:case"end":return e.stop()}}),e,this)}))),F.prototype.bootstrapCrossSigning=u(a.mark((function e(){var t,n,r,i,o,s,c,l,d,f,p,h,v,y,m=this,_=arguments;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=_.length>0&&void 0!==_[0]?_[0]:{},n=t.authUploadDeviceSigningKeys,r=t.setupNewCrossSigning,g.logger.log("Bootstrapping cross-signing"),i=this._baseApis._cryptoCallbacks,o=new w.EncryptionSetupBuilder(this._baseApis.store.accountData,i),s=new E.CrossSigningInfo(this._userId,o.crossSigningCallbacks,o.crossSigningCallbacks),c=function(){var e=u(a.mark((function e(){var t,r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s.resetKeys(),e.next=3,m._signObject(s.keys.master);case 3:return o.addCrossSigningKeys(n,s.keys),t=m._deviceList.getStoredDevice(m._userId,m._deviceId),e.next=7,s.signDevice(m._userId,t);case 7:if(r=e.sent,o.addKeySignature(m._userId,m._deviceId,r),!m.backupInfo){e.next=13;break}return e.next=12,s.signObject(m.backupInfo.auth_data,"master");case 12:o.addSessionBackup(m.backupInfo);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),l=this._crossSigningInfo.getId(),e.next=9,this._crossSigningInfo.isStoredInKeyCache();case 9:return d=e.sent,e.next=12,this._crossSigningInfo.isStoredInSecretStorage(this._secretStorage);case 12:if(f=e.sent,p=d||f,g.logger.log({setupNewCrossSigning:r,publicKeysOnDevice:l,privateKeysInCache:d,privateKeysInStorage:f,privateKeysExistSomewhere:p}),p&&!r){e.next=21;break}return g.logger.log("Cross-signing private keys not found locally or in secret storage, creating new keys"),e.next=19,c();case 19:e.next=29;break;case 21:if(!l||!d){e.next=25;break}g.logger.log("Cross-signing public keys trusted and private keys found locally"),e.next=29;break;case 25:if(!f){e.next=29;break}return g.logger.log("Cross-signing private keys not found locally, but they are available in secret storage, reading storage and caching locally"),e.next=29,this.checkOwnCrossSigningTrust();case 29:if(!(h=o.crossSigningCallbacks.privateKeys).size||this._baseApis._cryptoCallbacks.saveCrossSigningKeys){e.next=38;break}return v=new x.SecretStorage(o.accountDataClientAdapter,o.ssssCryptoCallbacks),e.next=34,v.hasKey();case 34:if(!e.sent){e.next=38;break}return g.logger.log("Storing new cross-signing private keys in secret storage"),e.next=38,E.CrossSigningInfo.storeInSecretStorage(h,v);case 38:return y=o.buildOperation(),e.next=41,y.apply(this);case 41:return e.next=43,o.persist(this);case 43:g.logger.log("Cross-signing ready");case 44:case"end":return e.stop()}}),e,this)}))),F.prototype.bootstrapSecretStorage=u(a.mark((function e(){var t,n,r,i,o,c,d,f,p,h,v,y,m,b,k,S,I,T,R,O,C,P,A,M,U,N,L,K,B,j,q,F,G=this,H=arguments;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=H.length>0&&void 0!==H[0]?H[0]:{},n=t.createSecretStorageKey,r=void 0===n?u(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{});case 1:case"end":return e.stop()}}),e)}))):n,i=t.keyBackupInfo,o=t.setupNewKeyBackup,c=t.setupNewSecretStorage,d=t.getKeyBackupPassphrase,g.logger.log("Bootstrapping Secure Secret Storage"),f=this._baseApis._cryptoCallbacks,p=new w.EncryptionSetupBuilder(this._baseApis.store.accountData,f),h=new x.SecretStorage(p.accountDataClientAdapter,p.ssssCryptoCallbacks),v=null,y=function(){var e=u(a.mark((function e(t,n){var r,i,o;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},n&&(t.key=n),e.next=4,h.addKey(x.SECRET_STORAGE_ALGORITHM_V1_AES,t);case 4:return r=e.sent,i=r.keyId,o=r.keyInfo,n&&p.ssssCryptoCallbacks.addPrivateKey(i,o,n),e.next=10,h.setDefaultKeyId(i);case 10:return e.abrupt("return",i);case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),m=function(){var e=u(a.mark((function e(t,n){var r,i,o,s,u;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.mac){e.next=16;break}return e.next=3,G._baseApis._cryptoCallbacks.getSecretStorageKey({keys:l({},t,n)},"");case 3:if(!(r=e.sent)){e.next=16;break}return i=r[1],p.ssssCryptoCallbacks.addPrivateKey(t,n,i),e.next=9,x.SecretStorage._calculateKeyCheck(i);case 9:return o=e.sent,s=o.iv,u=o.mac,n.iv=s,n.mac=u,e.next=16,p.setAccountData("m.secret_storage.key.".concat(t),n);case 16:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),b=function(){var e=u(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=G._crossSigningInfo.getId(),!e.t0){e.next=5;break}return e.next=4,G._crossSigningInfo.isStoredInKeyCache("master");case 4:e.t0=e.sent;case 5:if(!e.t0){e.next=17;break}return e.prev=6,g.logger.log("Adding cross-signing signature to key backup"),e.next=10,G._crossSigningInfo.signObject(t,"master");case 10:e.next=15;break;case 12:e.prev=12,e.t1=e.catch(6),g.logger.error("Signing key backup with cross-signing keys failed",e.t1);case 15:e.next=18;break;case 17:g.logger.warn("Cross-signing keys not available, skipping signature on key backup");case 18:case"end":return e.stop()}}),e,null,[[6,12]])})));return function(t){return e.apply(this,arguments)}}(),e.next=11,this.getSecretStorageKey();case 11:if(k=e.sent,S=s(k||[null,null],2),I=S[0],T=S[1],R=!c&&T&&T.algorithm===x.SECRET_STORAGE_ALGORITHM_V1_AES,g.logger.log({keyBackupInfo:i,setupNewKeyBackup:o,setupNewSecretStorage:c,storageExists:R,oldKeyInfo:T}),R||i){e.next=27;break}return g.logger.log("Secret storage does not exist, creating new storage key"),e.next=19,r();case 19:return O=e.sent,C=O.keyInfo,P=O.privateKey,e.next=24,y(C,P);case 24:v=e.sent,e.next=53;break;case 27:if(R||!i){e.next=49;break}return g.logger.log("Secret storage does not exist, using key backup key"),e.next=31,this.getSessionBackupPrivateKey();case 31:if(e.t0=e.sent,e.t0){e.next=36;break}return e.next=35,d();case 35:e.t0=e.sent;case 36:return A=e.t0,M={},i.auth_data.private_key_salt&&i.auth_data.private_key_iterations&&(M.passphrase={algorithm:"m.pbkdf2",iterations:i.auth_data.private_key_iterations,salt:i.auth_data.private_key_salt,bits:256}),e.next=41,y(M,A);case 41:return v=e.sent,e.next=44,h.store("m.megolm_backup.v1",_.encodeBase64(A),[v]);case 44:return e.next=46,b(i.auth_data);case 46:p.addSessionBackup(i),e.next=53;break;case 49:if(g.logger.log("Secret storage exists"),!T||T.algorithm!==x.SECRET_STORAGE_ALGORITHM_V1_AES){e.next=53;break}return e.next=53,m(I,T);case 53:if(e.t2=!this._baseApis._cryptoCallbacks.saveCrossSigningKeys,!e.t2){e.next=58;break}return e.next=57,this.isCrossSigningReady();case 57:e.t2=e.sent;case 58:if(e.t1=e.t2,!e.t1){e.next=66;break}if(e.t3=v,e.t3){e.next=65;break}return e.next=64,this._crossSigningInfo.isStoredInSecretStorage(h);case 64:e.t3=!e.sent;case 65:e.t1=e.t3;case 66:if(!e.t1){e.next=73;break}return g.logger.log("Copying cross-signing private keys from cache to secret storage"),e.next=70,this._crossSigningInfo.getCrossSigningKeysFromCache();case 70:return U=e.sent,e.next=73,E.CrossSigningInfo.storeInSecretStorage(U,h);case 73:if(!o||i){e.next=87;break}return g.logger.log("Creating new message key backup version"),e.next=77,this._baseApis.prepareKeyBackupVersion(null,{secureSecretStorage:!1});case 77:return N=e.sent,L=(0,D.decodeRecoveryKey)(N.recovery_key),e.next=81,h.store("m.megolm_backup.v1",_.encodeBase64(L));case 81:return K={algorithm:N.algorithm,auth_data:N.auth_data},e.next=84,b(K.auth_data);case 84:return e.next=86,this._signObject(K.auth_data);case 86:p.addSessionBackup(K);case 87:return e.next=89,h.get("m.megolm_backup.v1");case 89:if(!(B=e.sent)){e.next=99;break}if(g.logger.info("Got session backup key from secret storage: caching"),!(j=V(B))){e.next=96;break}return e.next=96,h.store("m.megolm_backup.v1",j,[v||I]);case 96:return q=new Uint8Array(_.decodeBase64(j||B)),e.next=99,p.addSessionBackupPrivateKeyToCache(q);case 99:return F=p.buildOperation(),e.next=102,F.apply(this);case 102:return e.next=104,p.persist(this);case 104:g.logger.log("Secure Secret Storage ready");case 105:case"end":return e.stop()}}),e,this)}))),F.prototype.addSecretStorageKey=function(e,t,n){return this._secretStorage.addKey(e,t,n)},F.prototype.hasSecretStorageKey=function(e){return this._secretStorage.hasKey(e)},F.prototype.getSecretStorageKey=function(e){return this._secretStorage.getKey(e)},F.prototype.storeSecret=function(e,t,n){return this._secretStorage.store(e,t,n)},F.prototype.getSecret=function(e){return this._secretStorage.get(e)},F.prototype.isSecretStored=function(e,t){return this._secretStorage.isStored(e,t)},F.prototype.requestSecret=function(e,t){return t||(t=Object.keys(this._deviceList.getRawStoredDevicesForUser(this._userId))),this._secretStorage.request(e,t)},F.prototype.getDefaultSecretStorageKeyId=function(){return this._secretStorage.getDefaultKeyId()},F.prototype.setDefaultSecretStorageKeyId=function(e){return this._secretStorage.setDefaultKeyId(e)},F.prototype.checkSecretStorageKey=function(e,t){return this._secretStorage.checkKey(e,t)},F.prototype.checkSecretStoragePrivateKey=function(t,n){var r=null;try{return(r=new e.Olm.PkDecryption).init_with_private_key(t)===n}finally{r&&r.free()}},F.prototype.getSessionBackupPrivateKey=u(a.mark((function e(){var t,n,i,o=this;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){o._cryptoStore.doTxn("readonly",[T.IndexedDBCryptoStore.STORE_ACCOUNT],(function(t){o._cryptoStore.getSecretStorePrivateKey(t,e,"m.megolm_backup.v1")}))}));case 2:if(!(t=e.sent)||"string"!==typeof t){e.next=7;break}return t=new Uint8Array(_.decodeBase64(V(t)||t)),e.next=7,this.storeSessionBackupPrivateKey(t);case 7:if(!t||!t.ciphertext){e.next=13;break}return n=r.from(this._olmDevice._pickleKey),e.next=11,(0,L.decryptAES)(t,n,"m.megolm_backup.v1");case 11:i=e.sent,t=_.decodeBase64(i);case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this)}))),F.prototype.storeSessionBackupPrivateKey=function(){var e=u(a.mark((function e(t){var n,i=this;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof Uint8Array){e.next=2;break}throw new Error("storeSessionBackupPrivateKey expects Uint8Array, got ".concat(t));case 2:return n=r.from(this._olmDevice._pickleKey),e.next=5,(0,L.encryptAES)(_.encodeBase64(t),n,"m.megolm_backup.v1");case 5:return t=e.sent,e.abrupt("return",this._cryptoStore.doTxn("readwrite",[T.IndexedDBCryptoStore.STORE_ACCOUNT],(function(e){i._cryptoStore.storeSecretStorePrivateKey(e,"m.megolm_backup.v1",t)})));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),F.prototype.checkCrossSigningPrivateKey=function(t,n){var r=null;try{return(r=new e.Olm.PkSigning).init_with_seed(t)===n}finally{r&&r.free()}},F.prototype._afterCrossSigningLocalKeyChange=u(a.mark((function e(){var t,n,r,i,o,u,d,f,p,h,v,y,m,_,b=this;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g.logger.info("Starting cross-signing key change post-processing"),t=this._deviceList.getStoredDevice(this._userId,this._deviceId),e.next=4,this._crossSigningInfo.signDevice(this._userId,t);case 4:if(n=e.sent,g.logger.info("Starting background key sig upload for ".concat(this._deviceId)),function e(t){var r=t.shouldEmit;return b._baseApis.uploadKeySignatures(l({},b._userId,l({},b._deviceId,n))).then((function(t){var n=(t||{}).failures;if(Object.keys(n||[]).length>0)throw r&&b._baseApis.emit("crypto.keySignatureUploadFailure",n,"_afterCrossSigningLocalKeyChange",e),new N.KeySignatureUploadError("Key upload failed",{failures:n});g.logger.info("Finished background key sig upload for ".concat(b._deviceId))})).catch((function(e){g.logger.error("Error during background key sig upload for ".concat(b._deviceId),e)}))}({shouldEmit:!0}),!(r=this._baseApis._cryptoCallbacks.shouldUpgradeDeviceVerifications)){e.next=53;break}g.logger.info("Starting device verification upgrade"),i={},o=0,u=Object.entries(this._deviceList._crossSigningInfo);case 13:if(!(o<u.length)){e.next=22;break}return d=s(u[o],2),f=d[0],p=d[1],e.next=17,this._checkForDeviceVerificationUpgrade(f,E.CrossSigningInfo.fromStorage(p,f));case 17:(h=e.sent)&&(i[f]=h);case 19:o++,e.next=13;break;case 22:if(!(Object.keys(i).length>0)){e.next=52;break}return g.logger.info("Found ".concat(Object.keys(i).length," verif users to upgrade")),e.prev=24,e.next=27,r({users:i});case 27:if(!(v=e.sent)){e.next=47;break}y=c(v),e.prev=30,y.s();case 32:if((m=y.n()).done){e.next=39;break}if(!((_=m.value)in i)){e.next=37;break}return e.next=37,this._baseApis.setDeviceVerified(_,i[_].crossSigningInfo.getId());case 37:e.next=32;break;case 39:e.next=44;break;case 41:e.prev=41,e.t0=e.catch(30),y.e(e.t0);case 44:return e.prev=44,y.f(),e.finish(44);case 47:e.next=52;break;case 49:e.prev=49,e.t1=e.catch(24),g.logger.log("shouldUpgradeDeviceVerifications threw an error: not upgrading",e.t1);case 52:g.logger.info("Finished device verification upgrade");case 53:g.logger.info("Finished cross-signing key change post-processing");case 54:case"end":return e.stop()}}),e,this,[[24,49],[30,41,44,47]])}))),F.prototype._checkForDeviceVerificationUpgrade=function(){var e=u(a.mark((function e(t,n){var r,i,o;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this._crossSigningInfo.checkUserTrust(n),!n.firstUse||r.verified){e.next=8;break}return i=this._deviceList.getRawStoredDevicesForUser(t),e.next=5,this._checkForValidDeviceSignature(t,n.keys.master,i);case 5:if(!(o=e.sent).length){e.next=8;break}return e.abrupt("return",{devices:o.map((function(e){return k.DeviceInfo.fromStorage(i[e],e)})),crossSigningInfo:n});case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),F.prototype._checkForValidDeviceSignature=function(){var e=u(a.mark((function e(t,n,r){var i,o,u,c,l,d,f;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=[],!(r&&n.signatures&&n.signatures[t])){e.next=18;break}o=0,u=Object.keys(n.signatures[t]);case 3:if(!(o<u.length)){e.next=18;break}if(c=u[o],l=c.split(":",2),d=s(l,2),!((f=d[1])in r)||r[f].verified!==B.VERIFIED){e.next=15;break}return e.prev=7,e.next=10,_.verifySignature(this._olmDevice,n,t,f,r[f].keys[c]);case 10:i.push(f),e.next=15;break;case 13:e.prev=13,e.t0=e.catch(7);case 15:o++,e.next=3;break;case 18:return e.abrupt("return",i);case 19:case"end":return e.stop()}}),e,this,[[7,13]])})));return function(t,n,r){return e.apply(this,arguments)}}(),F.prototype.getCrossSigningId=function(e){return this._crossSigningInfo.getId(e)},F.prototype.getStoredCrossSigningForUser=function(e){return this._deviceList.getStoredCrossSigningForUser(e)},F.prototype.checkUserTrust=function(e){var t=this._deviceList.getStoredCrossSigningForUser(e);return t?this._crossSigningInfo.checkUserTrust(t):new E.UserTrustLevel(!1,!1,!1)},F.prototype.checkDeviceTrust=function(e,t){var n=this._deviceList.getStoredDevice(e,t);return this._checkDeviceInfoTrust(e,n)},F.prototype._checkDeviceInfoTrust=function(e,t){var n=!(!t||!t.isVerified()),r=this._deviceList.getStoredCrossSigningForUser(e);if(t&&r){var i=this._trustCrossSignedDevices||e===this._userId;return this._crossSigningInfo.checkDeviceTrust(r,t,n,i)}return new E.DeviceTrustLevel(!1,!1,n,!1)},F.prototype._onDeviceListUserCrossSigningUpdated=function(){var e=u(a.mark((function e(t){var n,r,i,o,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==this._userId){e.next=15;break}if(n=this._deviceList.getStoredCrossSigningForUser(t),r=n?n.getId():null,i=this._crossSigningInfo.getId(),o=i!==r,!i||!r||o){e.next=10;break}return e.next=8,this.checkOwnCrossSigningTrust();case 8:e.next=13;break;case 10:this._storeTrustedSelfKeys(null),this.emit("crossSigning.keysChanged",{}),this.emit("userTrustStatusChanged",this._userId,this.checkUserTrust(t));case 13:e.next=20;break;case 15:return e.next=17,this._checkDeviceVerifications(t);case 17:(s=this._deviceList.getStoredCrossSigningForUser(t))&&(s.updateCrossSigningVerifiedBefore(this.checkUserTrust(t).isCrossSigningVerified()),this._deviceList.setRawStoredCrossSigningForUser(t,s.toStorage())),this.emit("userTrustStatusChanged",t,this.checkUserTrust(t));case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),F.prototype.checkOwnCrossSigningTrust=u(a.mark((function e(){var t,n,r,i,o,s,u,c,d,f,p,h,v,y,m,_,b,k,S,E,w=this;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._userId,e.next=3,this.downloadKeys([this._userId]);case 3:if(n=this._deviceList.getStoredCrossSigningForUser(t)){e.next=7;break}return g.logger.error("Got cross-signing update event for user "+t+" but no new cross-signing information found!"),e.abrupt("return");case 7:if(r=n.getId(),!(i=this._crossSigningInfo.getId()!==r)){e.next=27;break}return g.logger.info("Got new master public key",r),g.logger.info("Attempting to retrieve cross-signing master private key"),o=null,e.prev=13,e.next=16,this._crossSigningInfo.getCrossSigningKey("master",r);case 16:s=e.sent,o=s[1],g.logger.info("Got cross-signing master private key"),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(13),g.logger.error("Cross-signing master private key not available",e.t0);case 24:return e.prev=24,o&&o.free(),e.finish(24);case 27:if(u=this._crossSigningInfo.getId("self_signing"),c=this._crossSigningInfo.getId("user_signing"),this._storeTrustedSelfKeys(n.keys),d=u!==n.getId("self_signing"),f=c!==n.getId("user_signing"),p={},!d){e.next=56;break}return g.logger.info("Got new self-signing key",n.getId("self_signing")),g.logger.info("Attempting to retrieve cross-signing self-signing private key"),h=null,e.prev=37,e.next=40,this._crossSigningInfo.getCrossSigningKey("self_signing",n.getId("self_signing"));case 40:v=e.sent,h=v[1],g.logger.info("Got cross-signing self-signing private key"),e.next=48;break;case 45:e.prev=45,e.t1=e.catch(37),g.logger.error("Cross-signing self-signing private key not available",e.t1);case 48:return e.prev=48,h&&h.free(),e.finish(48);case 51:return y=this._deviceList.getStoredDevice(this._userId,this._deviceId),e.next=54,this._crossSigningInfo.signDevice(this._userId,y);case 54:m=e.sent,p[this._deviceId]=m;case 56:if(!f){e.next=74;break}return g.logger.info("Got new user-signing key",n.getId("user_signing")),g.logger.info("Attempting to retrieve cross-signing user-signing private key"),_=null,e.prev=60,e.next=63,this._crossSigningInfo.getCrossSigningKey("user_signing",n.getId("user_signing"));case 63:b=e.sent,_=b[1],g.logger.info("Got cross-signing user-signing private key"),e.next=71;break;case 68:e.prev=68,e.t2=e.catch(60),g.logger.error("Cross-signing user-signing private key not available",e.t2);case 71:return e.prev=71,_&&_.free(),e.finish(71);case 74:if(!i){e.next=80;break}return k=this._crossSigningInfo.keys.master,e.next=78,this._signObject(k);case 78:S=k.signatures[this._userId]["ed25519:"+this._deviceId],p[this._crossSigningInfo.getId()]=Object.assign({},k,{signatures:l({},this._userId,l({},"ed25519:"+this._deviceId,S))});case 80:if((E=Object.keys(p)).length&&function e(t){var n=t.shouldEmit;return g.logger.info("Starting background key sig upload for ".concat(E)),w._baseApis.uploadKeySignatures(l({},w._userId,p)).then((function(t){var r=(t||{}).failures;if(g.logger.info("Finished background key sig upload for ".concat(E)),Object.keys(r||[]).length>0)throw n&&w._baseApis.emit("crypto.keySignatureUploadFailure",r,"checkOwnCrossSigningTrust",e),new N.KeySignatureUploadError("Key upload failed",{failures:r})})).catch((function(e){g.logger.error("Error during background key sig upload for ".concat(E),e)}))}({shouldEmit:!0}),this.emit("userTrustStatusChanged",t,this.checkUserTrust(t)),!i){e.next=87;break}return this._baseApis.emit("crossSigning.keysChanged",{}),e.next=87,this._afterCrossSigningLocalKeyChange();case 87:return e.next=89,this.checkKeyBackup();case 89:case"end":return e.stop()}}),e,this,[[13,21,24,27],[37,45,48,51],[60,68,71,74]])}))),F.prototype._storeTrustedSelfKeys=function(){var e=u(a.mark((function e(t){var n=this;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t?this._crossSigningInfo.setKeys(t):this._crossSigningInfo.clearKeys(),e.next=3,this._cryptoStore.doTxn("readwrite",[T.IndexedDBCryptoStore.STORE_ACCOUNT],(function(e){n._cryptoStore.storeCrossSigningKeys(e,n._crossSigningInfo.keys)}));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),F.prototype._checkDeviceVerifications=function(){var e=u(a.mark((function e(t){var n,r,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._baseApis._cryptoCallbacks.shouldUpgradeDeviceVerifications){e.next=3;break}return e.abrupt("return");case 3:if(g.logger.info("Starting device verification upgrade for ".concat(t)),!this._crossSigningInfo.keys.user_signing){e.next=17;break}if(!(r=this._deviceList.getStoredCrossSigningForUser(t))){e.next=17;break}return e.next=9,this._checkForDeviceVerificationUpgrade(t,r);case 9:if(!(i=e.sent)){e.next=17;break}return e.next=13,n({users:l({},t,i)});case 13:if(!e.sent.includes(t)){e.next=17;break}return e.next=17,this._baseApis.setDeviceVerified(t,r.getId());case 17:g.logger.info("Finished device verification upgrade for ".concat(t));case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),F.prototype._checkAndStartKeyBackup=u(a.mark((function e(){var t,n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(g.logger.log("Checking key backup status..."),!this._baseApis.isGuest()){e.next=5;break}return g.logger.log("Skipping key backup check since user is guest"),this._checkedForBackup=!0,e.abrupt("return",null);case 5:return e.prev=5,e.next=8,this._baseApis.getKeyBackupVersion();case 8:t=e.sent,e.next=16;break;case 11:return e.prev=11,e.t0=e.catch(5),g.logger.log("Error checking for active key backup",e.t0),404===e.t0.httpStatus&&(this._checkedForBackup=!0),e.abrupt("return",null);case 16:return this._checkedForBackup=!0,e.next=19,this.isKeyBackupTrusted(t);case 19:if(!(n=e.sent).usable||this.backupInfo){e.next=25;break}g.logger.log("Found usable key backup v"+t.version+": enabling key backups"),this._baseApis.enableKeyBackup(t),e.next=44;break;case 25:if(n.usable||!this.backupInfo){e.next=30;break}g.logger.log("No usable key backup: disabling key backup"),this._baseApis.disableKeyBackup(),e.next=44;break;case 30:if(n.usable||this.backupInfo){e.next=34;break}g.logger.log("No usable key backup: not enabling key backup"),e.next=44;break;case 34:if(!n.usable||!this.backupInfo){e.next=44;break}if(t.version===this.backupInfo.version){e.next=43;break}return g.logger.log("On backup version "+this.backupInfo.version+" but found version "+t.version+": switching."),this._baseApis.disableKeyBackup(),this._baseApis.enableKeyBackup(t),e.next=41,this.scheduleAllGroupSessionsForBackup();case 41:e.next=44;break;case 43:g.logger.log("Backup version "+t.version+" still current");case 44:return e.abrupt("return",{backupInfo:t,trustInfo:n});case 45:case"end":return e.stop()}}),e,this,[[5,11]])}))),F.prototype.setTrustedBackupPubKey=function(){var e=u(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._sessionStore.setLocalTrustedBackupPubKey(t),e.next=3,this.checkKeyBackup();case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),F.prototype.checkKeyBackup=u(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkedForBackup=!1,e.abrupt("return",this._checkAndStartKeyBackup());case 2:case"end":return e.stop()}}),e,this)}))),F.prototype.isKeyBackupTrusted=function(){var e=u(a.mark((function e(t){var n,r,i,o,s,u,c,l,d,f;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={usable:!1,trusted_locally:!1,sigs:[]},t&&t.algorithm&&t.auth_data&&t.auth_data.public_key&&t.auth_data.signatures){e.next=4;break}return g.logger.info("Key backup is absent or missing required data"),e.abrupt("return",n);case 4:r=this._sessionStore.getLocalTrustedBackupPubKey(),t.auth_data.public_key===r&&(g.logger.info("Backup public key "+r+" is trusted locally"),n.trusted_locally=!0),i=t.auth_data.signatures[this._userId]||[],o=0,s=Object.keys(i);case 8:if(!(o<s.length)){e.next=54;break}if(u=s[o],"ed25519"===(c=u.split(":"))[0]){e.next=14;break}return g.logger.log("Ignoring unknown signature type: "+c[0]),e.abrupt("continue",51);case 14:if(l={deviceId:c[1]},(d=this._crossSigningInfo.getId())!==l.deviceId){e.next=30;break}return l.crossSigningId=!0,e.prev=18,e.next=21,_.verifySignature(this._olmDevice,t.auth_data,this._userId,l.deviceId,d);case 21:l.valid=!0,e.next=28;break;case 24:e.prev=24,e.t0=e.catch(18),g.logger.warning("Bad signature from cross signing key "+d,e.t0),l.valid=!1;case 28:return n.sigs.push(l),e.abrupt("continue",51);case 30:if(!(f=this._deviceList.getStoredDevice(this._userId,l.deviceId))){e.next=48;break}return l.device=f,e.next=35,this.checkDeviceTrust(this._userId,l.deviceId);case 35:return l.deviceTrust=e.sent,e.prev=36,e.next=39,_.verifySignature(this._olmDevice,t.auth_data,this._userId,f.deviceId,f.getFingerprint());case 39:l.valid=!0,e.next=46;break;case 42:e.prev=42,e.t1=e.catch(36),g.logger.info("Bad signature from key ID "+u+" userID "+this._userId+" device ID "+f.deviceId+" fingerprint: "+f.getFingerprint(),t.auth_data,e.t1),l.valid=!1;case 46:e.next=50;break;case 48:l.valid=null,g.logger.info("Ignoring signature from unknown key "+u);case 50:n.sigs.push(l);case 51:o++,e.next=8;break;case 54:return n.usable=n.sigs.some((function(e){return e.valid&&(e.device&&e.deviceTrust.isVerified()||e.crossSigningId)})),n.usable|=n.trusted_locally,e.abrupt("return",n);case 57:case"end":return e.stop()}}),e,this,[[18,24],[36,42]])})));return function(t){return e.apply(this,arguments)}}(),F.prototype.enableLazyLoading=function(){this._lazyLoadMembers=!0},F.prototype.registerEventHandlers=function(e){var t=this;e.on("RoomMember.membership",(function(e,n,r){try{t._onRoomMembership(e,n,r)}catch(i){g.logger.error("Error handling membership change:",i)}})),e.on("toDeviceEvent",t._onToDeviceEvent.bind(t));var n=t._onTimelineEvent.bind(t);e.on("Room.timeline",n),e.on("Event.decrypted",n)},F.prototype.start=function(){this._outgoingRoomKeyRequestManager.start()},F.prototype.stop=function(){this._outgoingRoomKeyRequestManager.stop(),this._deviceList.stop(),this._dehydrationManager.stop()},F.getOlmVersion=function(){return m.OlmDevice.getOlmVersion()},F.prototype.getDeviceEd25519Key=function(){return this._olmDevice.deviceEd25519Key},F.prototype.getDeviceCurve25519Key=function(){return this._olmDevice.deviceCurve25519Key},F.prototype.setGlobalBlacklistUnverifiedDevices=function(e){this._globalBlacklistUnverifiedDevices=e},F.prototype.getGlobalBlacklistUnverifiedDevices=function(){return this._globalBlacklistUnverifiedDevices},F.prototype.setGlobalErrorOnUnknownDevices=function(e){this._globalErrorOnUnknownDevices=e},F.prototype.getGlobalErrorOnUnknownDevices=function(){return this._globalErrorOnUnknownDevices},F.prototype.uploadDeviceKeys=function(){var e=this,t=e._userId,n=e._deviceId,r={algorithms:e._supportedAlgorithms,device_id:n,keys:e._deviceKeys,user_id:t};return e._signObject(r).then((function(){return e._baseApis.uploadKeysRequest({device_keys:r})}))},F.prototype.updateOneTimeKeyCount=function(e){if(!isFinite(e))throw new TypeError("Parameter for updateOneTimeKeyCount has to be a number");this._oneTimeKeyCount=e},F.prototype.setNeedsNewFallback=function(e){this._needsNewFallback=!!e},F.prototype.getNeedsNewFallback=function(){return this._needsNewFallback},F.prototype.downloadKeys=function(e,t){return this._deviceList.downloadKeys(e,t)},F.prototype.getStoredDevicesForUser=function(e){return this._deviceList.getStoredDevicesForUser(e)},F.prototype.getStoredDevice=function(e,t){return this._deviceList.getStoredDevice(e,t)},F.prototype.saveDeviceList=function(e){return this._deviceList.saveIfDirty(e)},F.prototype.setDeviceVerification=function(){var e=u(a.mark((function e(t,n,r,i,o){var s,c,d,f,p,h,v,y,m,_,b=this;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===r&&(r=null),void 0===i&&(i=null),void 0===o&&(o=null),!(s=this._deviceList.getStoredCrossSigningForUser(t))||s.getId()!==n){e.next=23;break}if(null===i&&null===o){e.next=7;break}throw new Error("Cannot set blocked or known for a cross-signing key");case 7:if(r){e.next=9;break}throw new Error("Cannot set a cross-signing key as unverified");case 9:if(this._crossSigningInfo.getId()||t!==this._crossSigningInfo.userId||(this._storeTrustedSelfKeys(s.keys),this.emit("userTrustStatusChanged",this._userId,this.checkUserTrust(t))),t===this._userId){e.next=22;break}return g.logger.info("Master key "+s.getId()+" for "+t+" marked verified. Signing..."),e.next=14,this._crossSigningInfo.signUser(s);case 14:if(!(c=e.sent)){e.next=19;break}return d=function(){var e=u(a.mark((function e(r){var i,o,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.shouldEmit,g.logger.info("Uploading signature for "+t+"..."),e.next=4,b._baseApis.uploadKeySignatures(l({},t,l({},n,c)));case 4:if(o=e.sent,s=(o||{}).failures,!(Object.keys(s||[]).length>0)){e.next=9;break}throw i&&b._baseApis.emit("crypto.keySignatureUploadFailure",s,"setDeviceVerification",d),new N.KeySignatureUploadError("Key upload failed",{failures:s});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=19,d({shouldEmit:!0});case 19:return e.abrupt("return",c);case 22:return e.abrupt("return",s);case 23:if((f=this._deviceList.getRawStoredDevicesForUser(t))&&f[n]){e.next=26;break}throw new Error("Unknown device "+t+":"+n);case 26:if(p=f[n],h=p.verified,r?h=B.VERIFIED:null!==r&&h==B.VERIFIED&&(h=B.UNVERIFIED),i?h=B.BLOCKED:null!==i&&h==B.BLOCKED&&(h=B.UNVERIFIED),v=p.known,null!==o&&(v=o),p.verified===h&&p.known===v||(p.verified=h,p.known=v,this._deviceList.storeDevicesForUser(t,f),this._deviceList.saveIfDirty()),!r||t!==this._userId){e.next=47;break}if(g.logger.info("Own device "+n+" marked verified: signing"),!this.checkDeviceTrust(t,n).isCrossSigningVerified()){e.next=40;break}g.logger.log("Own device ".concat(n," already cross-signing verified")),e.next=43;break;case 40:return e.next=42,this._crossSigningInfo.signDevice(t,k.DeviceInfo.fromStorage(p,n));case 42:y=e.sent;case 43:if(!y){e.next=47;break}return m=function(){var e=u(a.mark((function e(r){var i,o,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.shouldEmit,g.logger.info("Uploading signature for "+n),e.next=4,b._baseApis.uploadKeySignatures(l({},t,l({},n,y)));case 4:if(o=e.sent,s=(o||{}).failures,!(Object.keys(s||[]).length>0)){e.next=9;break}throw i&&b._baseApis.emit("crypto.keySignatureUploadFailure",s,"setDeviceVerification",m),new N.KeySignatureUploadError("Key upload failed",{failures:s});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=47,m({shouldEmit:!0});case 47:return _=k.DeviceInfo.fromStorage(p,n),this.emit("deviceVerificationChanged",t,n,_),e.abrupt("return",_);case 50:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}(),F.prototype.findVerificationRequestDMInProgress=function(e){return this._inRoomVerificationRequests.findRequestInProgress(e)},F.prototype.getVerificationRequestsToDeviceInProgress=function(e){return this._toDeviceVerificationRequests.getRequestsInProgress(e)},F.prototype.requestVerificationDM=function(e,t){var n=this._inRoomVerificationRequests.findRequestInProgress(t);if(n)return Promise.resolve(n);var r=new A.InRoomChannel(this._baseApis,t,e);return this._requestVerificationWithChannel(e,r,this._inRoomVerificationRequests)},F.prototype.requestVerification=function(e,t){t||(t=Object.keys(this._deviceList.getRawStoredDevicesForUser(e)));var n=this._toDeviceVerificationRequests.findRequestInProgress(e,t);if(n)return Promise.resolve(n);var r=new M.ToDeviceChannel(this._baseApis,e,t,M.ToDeviceChannel.makeTransactionId());return this._requestVerificationWithChannel(e,r,this._toDeviceVerificationRequests)},F.prototype._requestVerificationWithChannel=function(){var e=u(a.mark((function e(t,n,r){var i,o;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new P.VerificationRequest(n,this._verificationMethods,this._baseApis),n.transactionId&&r.setRequestByChannel(n,i),e.next=4,i.sendRequest();case 4:return(o=r.getRequestByChannel(n))?i=o:(g.logger.log("Crypto: adding new request to "+"requestsByTxnId with id ".concat(n.transactionId," ").concat(n.roomId)),r.setRequestByChannel(n,i)),e.abrupt("return",i);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),F.prototype.beginKeyVerification=function(e,t,n){var r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(i){if(!(r=this._toDeviceVerificationRequests.getRequestBySenderAndTxnId(t,i)))throw new Error("No request found for user ".concat(t," with ")+"transactionId ".concat(i))}else{i=M.ToDeviceChannel.makeTransactionId();var o=new M.ToDeviceChannel(this._baseApis,t,[n],i,n);r=new P.VerificationRequest(o,this._verificationMethods,this._baseApis),this._toDeviceVerificationRequests.setRequestBySenderAndTxnId(t,i,r)}return r.beginKeyVerification(e,{userId:t,deviceId:n})},F.prototype.legacyDeviceVerification=function(){var e=u(a.mark((function e(t,n,r){var i,o,s,u;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=M.ToDeviceChannel.makeTransactionId(),o=new M.ToDeviceChannel(this._baseApis,t,[n],i,n),s=new P.VerificationRequest(o,this._verificationMethods,this._baseApis),this._toDeviceVerificationRequests.setRequestBySenderAndTxnId(t,i,s),u=s.beginKeyVerification(r,{userId:t,deviceId:n}),e.next=7,Promise.race([u.verify(),s.waitFor((function(e){return e.started}))]);case 7:return e.abrupt("return",s);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),F.prototype.getOlmSessionsForUser=function(){var e=u(a.mark((function e(t){var n,r,i,o,s,u;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.getStoredDevicesForUser(t)||[],r={},i=0;case 3:if(!(i<n.length)){e.next=13;break}return o=n[i],s=o.getIdentityKey(),e.next=8,this._olmDevice.getSessionInfoForDevice(s);case 8:u=e.sent,r[o.deviceId]={deviceIdKey:s,sessions:u};case 10:++i,e.next=3;break;case 13:return e.abrupt("return",r);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),F.prototype.getEventSenderDeviceInfo=function(e){var t=e.getSenderKey(),n=e.getWireContent().algorithm;if(!t||!n)return null;if(e.getForwardingCurve25519KeyChain().length>0)return null;if(e.isKeySourceUntrusted())return null;var r=this._deviceList.getDeviceByIdentityKey(n,t);if(null===r)return null;var i=e.getClaimedEd25519Key();return i?i!==r.getFingerprint()?(g.logger.warn("Event "+e.getId()+" claims ed25519 key "+i+" but sender device has key "+r.getFingerprint()),null):r:(g.logger.warn("Event "+e.getId()+" claims no ed25519 key: cannot verify sending device"),null)},F.prototype.getEventEncryptionInfo=function(e){var t={};if(t.senderKey=e.getSenderKey(),t.algorithm=e.getWireContent().algorithm,!t.senderKey||!t.algorithm)return t.encrypted=!1,t;t.encrypted=!0,e.getForwardingCurve25519KeyChain().length>0||e.isKeySourceUntrusted()?t.authenticated=!1:t.authenticated=!0,t.sender=this._deviceList.getDeviceByIdentityKey(t.algorithm,t.senderKey);var n=e.getClaimedEd25519Key();return n||(g.logger.warn("Event "+e.getId()+" claims no ed25519 key: cannot verify sending device"),t.mismatchedSender=!0),t.sender&&n!==t.sender.getFingerprint()&&(g.logger.warn("Event "+e.getId()+" claims ed25519 key "+n+"but sender device has key "+t.sender.getFingerprint()),t.mismatchedSender=!0),t},F.prototype.forceDiscardSession=function(e){var t=this._roomEncryptors[e];if(void 0===t)throw new Error("Room not encrypted");if(void 0===t.forceDiscardSession)throw new Error("Room encryption algorithm doesn't support session discarding");t.forceDiscardSession()},F.prototype.setRoomEncryption=function(){var e=u(a.mark((function e(t,n,r){var i,o,s,u;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.algorithm){e.next=3;break}return g.logger.log("Ignoring setRoomEncryption with no algorithm"),e.abrupt("return");case 3:if(!(i=this._roomList.getRoomEncryption(t))){e.next=8;break}if(JSON.stringify(i)==JSON.stringify(n)){e.next=8;break}return g.logger.error("Ignoring m.room.encryption event which requests a change of config in "+t),e.abrupt("return");case 8:if(!this._roomEncryptors[t]){e.next=11;break}return e.abrupt("return");case 11:if(o=null,i||(o=this._roomList.setRoomEncryption(t,n)),s=S.ENCRYPTION_CLASSES[n.algorithm]){e.next=16;break}throw new Error("Unable to encrypt with "+n.algorithm);case 16:if(u=new s({userId:this._userId,deviceId:this._deviceId,crypto:this,olmDevice:this._olmDevice,baseApis:this._baseApis,roomId:t,config:n}),this._roomEncryptors[t]=u,!o){e.next=21;break}return e.next=21,o;case 21:if(this._lazyLoadMembers){e.next=28;break}return g.logger.log("Enabling encryption in "+t+"; starting to track device lists for all users therein"),e.next=25,this.trackRoomDevices(t);case 25:this.inhibitDeviceQuery||this._deviceList.refreshOutdatedDeviceLists(),e.next=29;break;case 28:g.logger.log("Enabling encryption in "+t);case 29:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),F.prototype.trackRoomDevices=function(e){var t=this,n=function(){var n=u(a.mark((function n(){var r;return a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t._roomEncryptors[e]){n.next=2;break}return n.abrupt("return");case 2:if(r=t._clientStore.getRoom(e)){n.next=5;break}throw new Error("Unable to start tracking devices in unknown room ".concat(e));case 5:return g.logger.log("Starting to track devices for room ".concat(e," ...")),n.next=8,r.getEncryptionTargetMembers();case 8:n.sent.forEach((function(e){t._deviceList.startTrackingDeviceList(e.userId)}));case 10:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),r=this._roomDeviceTrackingState[e];return r||(r=n(),this._roomDeviceTrackingState[e]=r.catch((function(n){throw t._roomDeviceTrackingState[e]=null,n}))),r},F.prototype.ensureOlmSessionsForUsers=function(e){for(var t={},n=0;n<e.length;++n){var r=e[n];t[r]=[];for(var i=this.getStoredDevicesForUser(r)||[],o=0;o<i.length;++o){var s=i[o];s.getIdentityKey()!=this._olmDevice.deviceCurve25519Key&&(s.verified!=B.BLOCKED&&t[r].push(s))}}return _.ensureOlmSessionsForDevices(this._olmDevice,this._baseApis,t)},F.prototype.exportRoomKeys=u(a.mark((function e(){var t,n=this;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,this._cryptoStore.doTxn("readonly",[T.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS],(function(e){n._cryptoStore.getAllEndToEndInboundGroupSessions(e,(function(e){if(null!==e){var r=n._olmDevice.exportInboundGroupSession(e.senderKey,e.sessionId,e.sessionData);delete r.first_known_index,r.algorithm=_.MEGOLM_ALGORITHM,t.push(r)}}))}));case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)}))),F.prototype.importRoomKeys=function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=0,i=0,o=e.length;function s(){n.progressCallback({stage:"load_keys",successes:r,failures:i,total:o})}return Promise.all(e.map((function(e){return e.room_id&&e.algorithm?t._getRoomDecryptor(e.room_id,e.algorithm).importRoomKey(e,n).finally((function(e){r++,n.progressCallback&&s()})):(g.logger.warn("ignoring room key entry with missing fields",e),i++,n.progressCallback&&s(),null)})))},F.prototype.scheduleKeyBackupSend=u(a.mark((function e(){var t,n,r,i=arguments;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:1e4,!this._sendingBackups){e.next=3;break}return e.abrupt("return");case 3:return this._sendingBackups=!0,e.prev=4,n=Math.random()*t,e.next=8,(0,y.sleep)(n);case 8:r=0;case 9:if(this.backupKey){e.next=12;break}return e.abrupt("return");case 12:return e.prev=12,e.next=15,this._backupPendingKeys(200);case 15:if(0!==e.sent){e.next=18;break}return e.abrupt("return");case 18:r=0,e.next=31;break;case 21:if(e.prev=21,e.t0=e.catch(12),r++,g.logger.log("Key backup request failed",e.t0),!e.t0.data){e.next=31;break}if("M_NOT_FOUND"!=e.t0.data.errcode&&"M_WRONG_ROOM_KEYS_VERSION"!=e.t0.data.errcode){e.next=31;break}return e.next=29,this.checkKeyBackup();case 29:throw this.emit("crypto.keyBackupFailed",e.t0.data.errcode),e.t0;case 31:if(!r){e.next=34;break}return e.next=34,(0,y.sleep)(1e3*Math.pow(2,Math.min(r-1,4)));case 34:e.next=9;break;case 36:return e.prev=36,this._sendingBackups=!1,e.finish(36);case 39:case"end":return e.stop()}}),e,this,[[4,,36,39],[12,21]])}))),F.prototype._backupPendingKeys=function(){var e=u(a.mark((function e(t){var n,r,i,o,s,u,l,d,f,p,h,v,g,y;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._cryptoStore.getSessionsNeedingBackup(t);case 2:if((n=e.sent).length){e.next=5;break}return e.abrupt("return",0);case 5:return e.next=7,this._cryptoStore.countSessionsNeedingBackup();case 7:r=e.sent,this.emit("crypto.keyBackupSessionsRemaining",r),i={},o=c(n),e.prev=11,o.s();case 13:if((s=o.n()).done){e.next=33;break}return u=s.value,l=u.sessionData.room_id,void 0===i[l]&&(i[l]={sessions:{}}),e.next=19,this._olmDevice.exportInboundGroupSession(u.senderKey,u.sessionId,u.sessionData);case 19:(d=e.sent).algorithm=_.MEGOLM_ALGORITHM,delete d.session_id,delete d.room_id,f=d.first_known_index,delete d.first_known_index,p=this.backupKey.encrypt(JSON.stringify(d)),h=(d.forwarding_curve25519_key_chain||[]).length,v=this._deviceList.getUserByIdentityKey(_.MEGOLM_ALGORITHM,u.senderKey),g=this._deviceList.getDeviceByIdentityKey(_.MEGOLM_ALGORITHM,u.senderKey),y=this._checkDeviceInfoTrust(v,g).isVerified(),i[l].sessions[u.sessionId]={first_message_index:f,forwarded_count:h,is_verified:y,session_data:p};case 31:e.next=13;break;case 33:e.next=38;break;case 35:e.prev=35,e.t0=e.catch(11),o.e(e.t0);case 38:return e.prev=38,o.f(),e.finish(38);case 41:return e.next=43,this._baseApis.sendKeyBackup(void 0,void 0,this.backupInfo.version,{rooms:i});case 43:return e.next=45,this._cryptoStore.unmarkSessionsNeedingBackup(n);case 45:return e.next=47,this._cryptoStore.countSessionsNeedingBackup();case 47:return r=e.sent,this.emit("crypto.keyBackupSessionsRemaining",r),e.abrupt("return",n.length);case 50:case"end":return e.stop()}}),e,this,[[11,35,38,41]])})));return function(t){return e.apply(this,arguments)}}(),F.prototype.backupGroupSession=function(){var e=u(a.mark((function e(t,n,r,i,o,s,u){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.backupInfo){e.next=2;break}throw new Error("Key backups are not enabled");case 2:return e.next=4,this._cryptoStore.markSessionsNeedingBackup([{senderKey:n,sessionId:i}]);case 4:this.scheduleKeyBackupSend();case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o,s,a){return e.apply(this,arguments)}}(),F.prototype.scheduleAllGroupSessionsForBackup=u(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.flagAllGroupSessionsForBackup();case 2:this.scheduleKeyBackupSend(0);case 3:case"end":return e.stop()}}),e,this)}))),F.prototype.flagAllGroupSessionsForBackup=u(a.mark((function e(){var t,n=this;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._cryptoStore.doTxn("readwrite",[T.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,T.IndexedDBCryptoStore.STORE_BACKUP],(function(e){n._cryptoStore.getAllEndToEndInboundGroupSessions(e,(function(t){null!==t&&n._cryptoStore.markSessionsNeedingBackup([t],e)}))}));case 2:return e.next=4,this._cryptoStore.countSessionsNeedingBackup();case 4:return t=e.sent,this.emit("crypto.keyBackupSessionsRemaining",t),e.abrupt("return",t);case 7:case"end":return e.stop()}}),e,this)}))),F.prototype.countSessionsNeedingBackup=function(){return this._cryptoStore.countSessionsNeedingBackup()},F.prototype.prepareToEncrypt=function(e){var t=e.roomId,n=this._roomEncryptors[t];n&&n.prepareToEncrypt(e)},F.prototype.encryptEvent=function(){var e=u(a.mark((function e(t,n){var r,i,o,s,u;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}throw new Error("Cannot send encrypted messages in unknown rooms");case 2:if(r=t.getRoomId(),i=this._roomEncryptors[r]){e.next=6;break}throw new Error("Room was previously configured to use encryption, but is no longer. Perhaps the homeserver is hiding the configuration event.");case 6:return this._roomDeviceTrackingState[r]||this.trackRoomDevices(r),e.next=9,this._roomDeviceTrackingState[r];case 9:return o=t.getContent(),(s=o["m.relates_to"])&&delete(o=Object.assign({},o))["m.relates_to"],e.next=14,i.encryptMessage(n,t.getType(),o);case 14:u=e.sent,s&&(u["m.relates_to"]=s),t.makeEncrypted("m.room.encrypted",u,this._olmDevice.deviceCurve25519Key,this._olmDevice.deviceEd25519Key);case 17:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),F.prototype.decryptEvent=function(e){if(e.isRedacted())return Promise.resolve({clearEvent:{room_id:e.getRoomId(),type:"m.room.message",content:{}}});var t=e.getWireContent();return this._getRoomDecryptor(e.getRoomId(),t.algorithm).decryptEvent(e)},F.prototype.handleDeviceListChanges=function(){var e=u(a.mark((function e(t,n){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.oldSyncToken){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this._evalDeviceListChanges(n);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),F.prototype.requestRoomKey=function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._outgoingRoomKeyRequestManager.queueRoomKeyRequest(e,t,r).then((function(){n._sendKeyRequestsImmediately&&n._outgoingRoomKeyRequestManager.sendQueuedRequests()})).catch((function(e){g.logger.error("Error requesting key for event",e)}))},F.prototype.cancelRoomKeyRequest=function(e){this._outgoingRoomKeyRequestManager.cancelRoomKeyRequest(e).catch((function(e){g.logger.warn("Error clearing pending room key requests",e)}))},F.prototype.cancelAndResendAllOutgoingKeyRequests=function(){return this._outgoingRoomKeyRequestManager.cancelAndResendAllOutgoingRequests()},F.prototype.onCryptoEvent=function(){var e=u(a.mark((function e(t){var n,r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getRoomId(),r=t.getContent(),e.prev=2,e.next=5,this.setRoomEncryption(n,r,!0);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),g.logger.error("Error configuring encryption in room "+n+":",e.t0);case 10:case"end":return e.stop()}}),e,this,[[2,7]])})));return function(t){return e.apply(this,arguments)}}(),F.prototype.onSyncWillProcess=function(){var e=u(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.oldSyncToken||(g.logger.log("Initial sync performed - resetting device tracking state"),this._deviceList.stopTrackingAllDeviceLists(),this._deviceList.startTrackingDeviceList(this._userId),this._roomDeviceTrackingState={}),this._sendKeyRequestsImmediately=!1;case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),F.prototype.onSyncCompleted=function(){var e=u(a.mark((function e(t){var n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.nextSyncToken,this._deviceList.setSyncToken(t.nextSyncToken),this._deviceList.saveIfDirty(),this._deviceList.lastKnownSyncToken=n,this._deviceList.startTrackingDeviceList(this._userId),this._deviceList.refreshOutdatedDeviceLists(),t.catchingUp||(G(this),this._processReceivedRoomKeyRequests(),this._outgoingRoomKeyRequestManager.sendQueuedRequests(),this._sendKeyRequestsImmediately=!0);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),F.prototype._evalDeviceListChanges=function(){var e=u(a.mark((function e(t){var n,r=this;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.changed&&Array.isArray(t.changed)&&t.changed.forEach((function(e){r._deviceList.invalidateUserDeviceList(e)})),!(t.left&&Array.isArray(t.left)&&t.left.length)){e.next=8;break}return e.t0=Set,e.next=5,this._getTrackedE2eUsers();case 5:e.t1=e.sent,n=new e.t0(e.t1),t.left.forEach((function(e){n.has(e)||r._deviceList.stopTrackingDeviceList(e)}));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),F.prototype._getTrackedE2eUsers=u(a.mark((function e(){var t,n,r,i,o,s,u,l;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=c(this._getTrackedE2eRooms()),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=13;break}return i=r.value,e.next=8,i.getEncryptionTargetMembers();case 8:o=e.sent,s=c(o);try{for(s.s();!(u=s.n()).done;)l=u.value,t.push(l.userId)}catch(a){s.e(a)}finally{s.f()}case 11:e.next=4;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(2),n.e(e.t0);case 18:return e.prev=18,n.f(),e.finish(18);case 21:return e.abrupt("return",t);case 22:case"end":return e.stop()}}),e,this,[[2,15,18,21]])}))),F.prototype._getTrackedE2eRooms=function(){var e=this;return this._clientStore.getRooms().filter((function(t){if(!e._roomEncryptors[t.roomId])return!1;if(!e._roomDeviceTrackingState[t.roomId])return!1;var n=t.getMyMembership();return"join"===n||"invite"===n}))},F.prototype._onToDeviceEvent=function(e){var t=this;try{g.logger.log("received to_device ".concat(e.getType()," from: ")+"".concat(e.getSender()," id: ").concat(e.getId())),"m.room_key"==e.getType()||"m.forwarded_room_key"==e.getType()?this._onRoomKeyEvent(e):"m.room_key_request"==e.getType()?this._onRoomKeyRequestEvent(e):"m.secret.request"===e.getType()?this._secretStorage._onRequestReceived(e):"m.secret.send"===e.getType()?this._secretStorage._onSecretReceived(e):"org.matrix.room_key.withheld"===e.getType()?this._onRoomKeyWithheldEvent(e):e.getContent().transaction_id?this._onKeyVerificationMessage(e):"m.bad.encrypted"===e.getContent().msgtype?this._onToDeviceBadEncrypted(e):e.isBeingDecrypted()&&e.once("Event.decrypted",(function(e){t._onToDeviceEvent(e)}))}catch(n){g.logger.error("Error handling toDeviceEvent:",n)}},F.prototype._onRoomKeyEvent=function(e){var t=e.getContent();t.room_id&&t.algorithm?(this._checkedForBackup||this._checkAndStartKeyBackup(),this._getRoomDecryptor(t.room_id,t.algorithm).onRoomKeyEvent(e)):g.logger.error("key event is missing fields")},F.prototype._onRoomKeyWithheldEvent=function(e){var t=e.getContent();if(("m.no_olm"===t.code||t.room_id&&t.session_id)&&t.algorithm&&t.sender_key){g.logger.info("Got room key withheld event from ".concat(e.getSender()," (").concat(t.sender_key,") ")+"for ".concat(t.algorithm,"/").concat(t.room_id,"/").concat(t.session_id," ")+"with reason ".concat(t.code," (").concat(t.reason,")"));var n=this._getRoomDecryptor(t.room_id,t.algorithm);if(n.onRoomKeyWithheldEvent&&n.onRoomKeyWithheldEvent(e),!t.room_id){var r,i=this._getRoomDecryptors(t.algorithm),o=c(i);try{for(o.s();!(r=o.n()).done;){r.value.retryDecryptionFromSender(t.sender_key)}}catch(s){o.e(s)}finally{o.f()}}}else g.logger.error("key withheld event is missing fields")},F.prototype._onKeyVerificationMessage=function(e){var t=this;if(M.ToDeviceChannel.validateEvent(e,this._baseApis)){this._handleVerificationEvent(e,this._toDeviceVerificationRequests,(function(e){if(M.ToDeviceChannel.canCreateRequest(M.ToDeviceChannel.getEventType(e))){var n=e.getContent(),r=n&&n.from_device;if(r){var i=e.getSender(),o=new M.ToDeviceChannel(t._baseApis,i,[r]);return new P.VerificationRequest(o,t._verificationMethods,t._baseApis)}}}))}},F.prototype._onTimelineEvent=function(e,t,n,r){var i=this,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s=o.liveEvent;if(A.InRoomChannel.validateEvent(e,this._baseApis)){var a=function(e){var t=new A.InRoomChannel(i._baseApis,e.getRoomId());return new P.VerificationRequest(t,i._verificationMethods,i._baseApis)};this._handleVerificationEvent(e,this._inRoomVerificationRequests,a,s)}},F.prototype._handleVerificationEvent=function(){var e=u(a.mark((function e(t,n,r){var i,o,s,u=arguments;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=!(u.length>3&&void 0!==u[3])||u[3],o=n.getRequest(t),s=!1,o){e.next=10;break}if(o=r(t)){e.next=8;break}return g.logger.log("Crypto: could not find VerificationRequest for "+"".concat(t.getType(),", and could not create one, so ignoring.")),e.abrupt("return");case 8:s=!0,n.setRequest(t,o);case 10:return t.setVerificationRequest(o),e.prev=11,e.next=14,o.channel.handleEvent(t,o,i);case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(11),g.logger.error("error while handling verification event: "+e.t0.message);case 19:s&&!o.initiatedByMe&&!o.invalid&&!o.observeOnly&&this._baseApis.emit("crypto.verification.request",o);case 21:case"end":return e.stop()}}),e,this,[[11,16]])})));return function(t,n,r){return e.apply(this,arguments)}}(),F.prototype._onToDeviceBadEncrypted=function(){var e=u(a.mark((function e(t){var n,r,i,o,s,u,d,f,p,h,v,y,m,b=this;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.getWireContent(),r=t.getSender(),i=n.algorithm,o=n.sender_key,s=function(){var e,t=b._getRoomDecryptors(_.MEGOLM_ALGORITHM),n=c(t);try{for(n.s();!(e=n.n()).done;){e.value.retryDecryptionFromSender(o)}}catch(r){n.e(r)}finally{n.f()}},void 0!==r&&void 0!==o&&void 0!==o){e.next=7;break}return e.abrupt("return");case 7:if(this._lastNewSessionForced[r]=this._lastNewSessionForced[r]||{},!((u=this._lastNewSessionForced[r][o]||0)+36e5>Date.now())){e.next=15;break}return g.logger.debug("New session already forced with device "+r+":"+o+" at "+u+": not forcing another"),e.next=13,this._olmDevice.recordSessionProblem(o,"wedged",!0);case 13:return s(),e.abrupt("return");case 15:if(d=this._deviceList.getDeviceByIdentityKey(i,o)){e.next=26;break}return e.next=19,this.downloadKeys([r],!1);case 19:if(d=this._deviceList.getDeviceByIdentityKey(i,o)){e.next=26;break}return g.logger.info("Couldn't find device for identity key "+o+": not re-establishing session"),e.next=24,this._olmDevice.recordSessionProblem(o,"wedged",!1);case 24:return s(),e.abrupt("return");case 26:return(f={})[r]=[d],e.next=30,_.ensureOlmSessionsForDevices(this._olmDevice,this._baseApis,f,!0);case 30:return this._lastNewSessionForced[r][o]=Date.now(),p={algorithm:_.OLM_ALGORITHM,sender_key:this._olmDevice.deviceCurve25519Key,ciphertext:{}},e.next=34,_.encryptMessageForDevice(p.ciphertext,this._userId,this._deviceId,this._olmDevice,r,d,{type:"m.dummy"});case 34:return e.next=36,this._olmDevice.recordSessionProblem(o,"wedged",!0);case 36:return s(),e.next=39,this._baseApis.sendToDevice("m.room.encrypted",l({},r,l({},d.deviceId,p)));case 39:return e.next=41,this._outgoingRoomKeyRequestManager.getOutgoingSentRoomKeyRequest(r,d.deviceId);case 41:h=e.sent,v=c(h);try{for(v.s();!(y=v.n()).done;)m=y.value,this.requestRoomKey(m.requestBody,m.recipients,!0)}catch(a){v.e(a)}finally{v.f()}case 44:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),F.prototype._onRoomMembership=function(e,t,n){var r=t.roomId,i=this._roomEncryptors[r];i&&(this._roomDeviceTrackingState[r]&&("join"==t.membership?(g.logger.log("Join event for "+t.userId+" in "+r),this._deviceList.startTrackingDeviceList(t.userId)):"invite"==t.membership&&this._clientStore.getRoom(r).shouldEncryptForInvitedMembers()&&(g.logger.log("Invite event for "+t.userId+" in "+r),this._deviceList.startTrackingDeviceList(t.userId))),i.onRoomMembership(e,t,n))},F.prototype._onRoomKeyRequestEvent=function(e){var t=e.getContent();if("request"===t.action){var n=new W(e);this._receivedRoomKeyRequests.push(n)}else if("request_cancellation"===t.action){var r=new z(e);this._receivedRoomKeyRequestCancellations.push(r)}},F.prototype._processReceivedRoomKeyRequests=u(a.mark((function e(){var t,n,r=this;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._processingRoomKeyRequests){e.next=2;break}return e.abrupt("return");case 2:return this._processingRoomKeyRequests=!0,e.prev=3,t=this._receivedRoomKeyRequests,this._receivedRoomKeyRequests=[],n=this._receivedRoomKeyRequestCancellations,this._receivedRoomKeyRequestCancellations=[],e.next=10,Promise.all(t.map((function(e){return r._processReceivedRoomKeyRequest(e)})));case 10:return e.next=12,Promise.all(n.map((function(e){return r._processReceivedRoomKeyRequestCancellation(e)})));case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),g.logger.error("Error processing room key requsts: ".concat(e.t0));case 17:return e.prev=17,this._processingRoomKeyRequests=!1,e.finish(17);case 20:case"end":return e.stop()}}),e,this,[[3,14,17,20]])}))),F.prototype._processReceivedRoomKeyRequest=function(){var e=u(a.mark((function e(t){var n,r,i,o,s,u,c,l;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.userId,r=t.deviceId,i=t.requestBody,o=i.room_id,s=i.algorithm,g.logger.log("m.room_key_request from ".concat(n,":").concat(r)+" for ".concat(o," / ").concat(i.session_id," (id ").concat(t.requestId,")")),n===this._userId){e.next=24;break}if(this._roomEncryptors[o]){e.next=10;break}return g.logger.debug("room key request for unencrypted room ".concat(o)),e.abrupt("return");case 10:if(u=this._roomEncryptors[o],c=this._deviceList.getStoredDevice(n,r)){e.next=15;break}return g.logger.debug("Ignoring keyshare for unknown device ".concat(n,":").concat(r)),e.abrupt("return");case 15:return e.prev=15,e.next=18,u.reshareKeyWithDevice(i.sender_key,i.session_id,n,c);case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(15),g.logger.warn("Failed to re-share keys for session "+i.session_id+" with device "+n+":"+c.deviceId,e.t0);case 23:return e.abrupt("return");case 24:if(r!==this._deviceId){e.next=27;break}return g.logger.log("Ignoring room key request from ourselves"),e.abrupt("return");case 27:if(this._roomDecryptors[o]){e.next=30;break}return g.logger.log("room key request for unencrypted room ".concat(o)),e.abrupt("return");case 30:if(l=this._roomDecryptors[o][s]){e.next=34;break}return g.logger.log("room key request for unknown alg ".concat(s," in room ").concat(o)),e.abrupt("return");case 34:return e.next=36,l.hasKeysForKeyRequest(t);case 36:if(e.sent){e.next=39;break}return g.logger.log("room key request for unknown session ".concat(o," / ")+i.session_id),e.abrupt("return");case 39:if(t.share=function(){l.shareKeysWithDevice(t)},!this.checkDeviceTrust(n,r).isVerified()){e.next=44;break}return g.logger.log("device is already verified: sharing keys"),t.share(),e.abrupt("return");case 44:this.emit("crypto.roomKeyRequest",t);case 45:case"end":return e.stop()}}),e,this,[[15,20]])})));return function(t){return e.apply(this,arguments)}}(),F.prototype._processReceivedRoomKeyRequestCancellation=function(){var e=u(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:g.logger.log("m.room_key_request cancellation for ".concat(t.userId,":")+"".concat(t.deviceId," (id ").concat(t.requestId,")")),this.emit("crypto.roomKeyRequestCancellation",t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),F.prototype._getRoomDecryptor=function(e,t){var n,r;if((e=e||null)&&((n=this._roomDecryptors[e])||(this._roomDecryptors[e]=n={}),r=n[t]))return r;var i=S.DECRYPTION_CLASSES[t];if(!i)throw new S.DecryptionError("UNKNOWN_ENCRYPTION_ALGORITHM",'Unknown encryption algorithm "'+t+'".');return r=new i({userId:this._userId,crypto:this,olmDevice:this._olmDevice,baseApis:this._baseApis,roomId:e}),n&&(n[t]=r),r},F.prototype._getRoomDecryptors=function(e){for(var t=[],n=0,r=Object.values(this._roomDecryptors);n<r.length;n++){var i=r[n];e in i&&t.push(i[e])}return t},F.prototype._signObject=function(){var e=u(a.mark((function e(t){var n,r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.signatures||{},r=t.unsigned,delete t.signatures,delete t.unsigned,n[this._userId]=n[this._userId]||{},e.next=7,this._olmDevice.sign(p.default.stringify(t));case 7:n[this._userId]["ed25519:"+this._deviceId]=e.sent,t.signatures=n,void 0!==r&&(t.unsigned=r);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}();var W=function e(t){o(this,e);var n=t.getContent();this.userId=t.getSender(),this.deviceId=n.requesting_device_id,this.requestId=n.request_id,this.requestBody=n.body||{},this.share=function(){throw new Error("don't know how to share keys for this request yet")}},z=function e(t){o(this,e);var n=t.getContent();this.userId=t.getSender(),this.deviceId=n.requesting_device_id,this.requestId=n.request_id}}).call(this,n(9),n(19).Buffer)},function(e,t,n){"use strict";var r=n(2),i=n(3),o=n(4),s=n(1),a=o(n(5)),u=o(n(17)),c=n(38),l=n(52),d=c.DeviceInfo.DeviceVerification;function f(e){(0,a.polyfillSuper)(this,l.EncryptionAlgorithm,e),this._sessionPrepared=!1,this._prepPromise=null}function p(e){(0,a.polyfillSuper)(this,l.DecryptionAlgorithm,e)}a.inherits(f,l.EncryptionAlgorithm),f.prototype._ensureSession=function(e){if(this._prepPromise)return this._prepPromise;if(this._sessionPrepared)return Promise.resolve();var t=this;return this._prepPromise=t._crypto.downloadKeys(e).then((function(n){return t._crypto.ensureOlmSessionsForUsers(e)})).then((function(){t._sessionPrepared=!0})).finally((function(){t._prepPromise=null})),this._prepPromise},f.prototype.encryptMessage=function(){var e=i(r.mark((function e(t,n,i){var o,s,c,l,f,p,h,v,g,y,m;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getEncryptionTargetMembers();case 2:return o=e.sent,s=a.map(o,(function(e){return e.userId})),c=this,e.next=7,this._ensureSession(s);case 7:l={room_id:t.roomId,type:n,content:i},f={algorithm:u.OLM_ALGORITHM,sender_key:c._olmDevice.deviceCurve25519Key,ciphertext:{}},p=[],h=0;case 11:if(!(h<s.length)){e.next=29;break}v=s[h],g=c._crypto.getStoredDevicesForUser(v),y=0;case 15:if(!(y<g.length)){e.next=26;break}if(m=g[y],m.getIdentityKey()!=c._olmDevice.deviceCurve25519Key){e.next=20;break}return e.abrupt("continue",23);case 20:if(m.verified!=d.BLOCKED){e.next=22;break}return e.abrupt("continue",23);case 22:p.push(u.encryptMessageForDevice(f.ciphertext,c._userId,c._deviceId,c._olmDevice,v,m,l));case 23:++y,e.next=15;break;case 26:++h,e.next=11;break;case 29:return e.next=31,Promise.all(p).then((function(){return f}));case 31:return e.abrupt("return",e.sent);case 32:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),a.inherits(p,l.DecryptionAlgorithm),p.prototype.decryptEvent=function(){var e=i(r.mark((function e(t){var n,i,o,s,a,u,c;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.getWireContent(),i=n.sender_key,o=n.ciphertext){e.next=5;break}throw new l.DecryptionError("OLM_MISSING_CIPHERTEXT","Missing ciphertext");case 5:if(this._olmDevice.deviceCurve25519Key in o){e.next=7;break}throw new l.DecryptionError("OLM_NOT_INCLUDED_IN_RECIPIENTS","Not included in recipients");case 7:return s=o[this._olmDevice.deviceCurve25519Key],e.prev=8,e.next=11,this._decryptMessage(i,s);case 11:a=e.sent,e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(8),new l.DecryptionError("OLM_BAD_ENCRYPTED_MESSAGE","Bad Encrypted Message",{sender:i,err:e.t0});case 17:if((u=JSON.parse(a)).recipient==this._userId){e.next=20;break}throw new l.DecryptionError("OLM_BAD_RECIPIENT","Message was intented for "+u.recipient);case 20:if(u.recipient_keys.ed25519==this._olmDevice.deviceEd25519Key){e.next=22;break}throw new l.DecryptionError("OLM_BAD_RECIPIENT_KEY","Message not intended for this device",{intended:u.recipient_keys.ed25519,our_key:this._olmDevice.deviceEd25519Key});case 22:if(u.sender==t.getSender()){e.next=24;break}throw new l.DecryptionError("OLM_FORWARDED_MESSAGE","Message forwarded from "+u.sender,{reported_sender:t.getSender()});case 24:if(u.room_id===t.getRoomId()){e.next=26;break}throw new l.DecryptionError("OLM_BAD_ROOM","Message intended for room "+u.room_id,{reported_room:t.room_id});case 26:return c=u.keys||{},e.abrupt("return",{clearEvent:u,senderCurve25519Key:i,claimedEd25519Key:c.ed25519||null});case 28:case"end":return e.stop()}}),e,this,[[8,14]])})));return function(t){return e.apply(this,arguments)}}(),p.prototype._decryptMessage=function(){var e=i(r.mark((function e(t,n){var i,o=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0===n.type){e.next=4;break}return e.abrupt("return",this._reallyDecryptMessage(t,n));case 4:return i=this._olmDevice._olmPrekeyPromise.then((function(){return o._reallyDecryptMessage(t,n)})),this._olmDevice._olmPrekeyPromise=i.catch((function(){})),e.next=8,i;case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),p.prototype._reallyDecryptMessage=function(){var e=i(r.mark((function e(t,n){var i,o,a,u,c,l;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._olmDevice.getSessionIdsForDevice(t);case 2:i=e.sent,o={},a=0;case 5:if(!(a<i.length)){e.next=26;break}return u=i[a],e.prev=7,e.next=10,this._olmDevice.decryptMessage(t,u,n.type,n.body);case 10:return c=e.sent,s.logger.log("Decrypted Olm message from "+t+" with session "+u),e.abrupt("return",c);case 15:return e.prev=15,e.t0=e.catch(7),e.next=19,this._olmDevice.matchesSession(t,u,n.type,n.body);case 19:if(!e.sent){e.next=22;break}throw new Error("Error decrypting prekey message with existing session id "+u+": "+e.t0.message);case 22:o[u]=e.t0.message;case 23:a++,e.next=5;break;case 26:if(0===n.type){e.next=30;break}if(0!==i.length){e.next=29;break}throw new Error("No existing sessions");case 29:throw new Error("Error decrypting non-prekey message with existing sessions: "+JSON.stringify(o));case 30:return e.prev=30,e.next=33,this._olmDevice.createInboundSession(t,n.type,n.body);case 33:l=e.sent,e.next=40;break;case 36:throw e.prev=36,e.t1=e.catch(30),o["(new)"]=e.t1.message,new Error("Error decrypting prekey message: "+JSON.stringify(o));case 40:return s.logger.log("created new inbound Olm session ID "+l.session_id+" with "+t),e.abrupt("return",l.payload);case 42:case"end":return e.stop()}}),e,this,[[7,15],[30,36]])})));return function(t,n){return e.apply(this,arguments)}}(),(0,l.registerAlgorithm)(u.OLM_ALGORITHM,f,p)},function(e,t,n){"use strict";var r=n(35),i=n(15),o=n(6),s=n(2),a=n(10),u=n(3),c=n(4),l=n(1),d=c(n(5)),f=c(n(17)),p=n(52),h=n(70);function v(e){this.sessionId=e,this.useCount=0,this.creationTime=(new Date).getTime(),this.sharedWithDevices={},this.blockedDevicesNotified={}}function g(e){(0,d.polyfillSuper)(this,p.EncryptionAlgorithm,e),this._setupPromise=Promise.resolve(),this._outboundSessions={},this._sessionRotationPeriodMsgs=100,this._sessionRotationPeriodMs=6048e5,void 0!==e.config.rotation_period_ms&&(this._sessionRotationPeriodMs=e.config.rotation_period_ms),void 0!==e.config.rotation_period_msgs&&(this._sessionRotationPeriodMsgs=e.config.rotation_period_msgs)}function y(e){(0,d.polyfillSuper)(this,p.DecryptionAlgorithm,e),this._pendingEvents={},this.olmlib=f}v.prototype.needsRotation=function(e,t){var n=(new Date).getTime()-this.creationTime;return(this.useCount>=e||n>=t)&&(l.logger.log("Rotating megolm session after "+this.useCount+" messages, "+n+"ms"),!0)},v.prototype.markSharedWithDevice=function(e,t,n){this.sharedWithDevices[e]||(this.sharedWithDevices[e]={}),this.sharedWithDevices[e][t]=n},v.prototype.markNotifiedBlockedDevice=function(e,t){this.blockedDevicesNotified[e]||(this.blockedDevicesNotified[e]={}),this.blockedDevicesNotified[e][t]=!0},v.prototype.sharedWithTooManyDevices=function(e){for(var t in this.sharedWithDevices)if(this.sharedWithDevices.hasOwnProperty(t)){if(!e.hasOwnProperty(t))return l.logger.log("Starting new megolm session because we shared with "+t),!0;for(var n in this.sharedWithDevices[t])if(this.sharedWithDevices[t].hasOwnProperty(n)&&!e[t].hasOwnProperty(n))return l.logger.log("Starting new megolm session because we shared with "+t+":"+n),!0}},d.inherits(g,p.EncryptionAlgorithm),g.prototype._ensureOutboundSession=function(){var e=u(s.mark((function e(t,n,r){var i,c,d,p,h=this;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=function(){return i},c=function(){var e=u(s.mark((function e(c){var d,p,v,g,y,m,_,b,k,S,E,w,x,I,T,R,O;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=c)&&i.needsRotation(h._sessionRotationPeriodMsgs,h._sessionRotationPeriodMs)&&(l.logger.log("Starting new megolm session because we need to rotate."),i=null),i&&i.sharedWithTooManyDevices(t)&&(i=null),i){e.next=10;break}return l.logger.log("Starting new megolm session for room ".concat(h._roomId)),e.next=7,h._prepareNewSession();case 7:i=e.sent,l.logger.log("Started new megolm session ".concat(i.sessionId," ")+"for room ".concat(h._roomId)),h._outboundSessions[i.sessionId]=i;case 10:d={},p=0,v=Object.entries(t);case 12:if(!(p<v.length)){e.next=27;break}g=a(v[p],2),y=g[0],m=g[1],_=0,b=Object.entries(m);case 15:if(!(_<b.length)){e.next=24;break}if(k=a(b[_],2),S=k[0],E=k[1],E.getIdentityKey()!=h._olmDevice.deviceCurve25519Key){e.next=20;break}return e.abrupt("continue",21);case 20:i.sharedWithDevices[y]&&void 0!==i.sharedWithDevices[y][S]||(d[y]=d[y]||[],d[y].push(E));case 21:_++,e.next=15;break;case 24:p++,e.next=12;break;case 27:return w=h._olmDevice.getOutboundGroupSessionKey(i.sessionId),x={type:"m.room_key",content:{algorithm:f.MEGOLM_ALGORITHM,room_id:h._roomId,session_id:i.sessionId,session_key:w.key,chain_index:w.chain_index}},e.next=31,f.getExistingOlmSessions(h._olmDevice,h._baseApis,d);case 31:return I=e.sent,T=a(I,2),R=T[0],O=T[1],e.next=37,Promise.all([u(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h._shareKeyWithOlmSessions(i,w,x,O);case 2:case"end":return e.stop()}}),e)})))(),u(s.mark((function e(){var t,n,a;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],n=Date.now(),a=[],e.next=5,h._shareKeyWithDevices(i,w,x,R,t,r?1e4:2e3,a);case 5:if(r||!(Date.now()-n<1e4)){e.next=9;break}u(s.mark((function e(){var n,r,u,c,l,d,f,p,v,g,y,m;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n={},r=new Set,u=o(a);try{for(u.s();!(c=u.n()).done;)l=c.value,r.add(l)}catch(s){u.e(s)}finally{u.f()}d=[],f=o(t);try{for(f.s();!(p=f.n()).done;)v=p.value,g=v.userId,y=v.deviceInfo,m=g.slice(g.indexOf(":")+1),r.has(m)?(n[g]=n[g]||[],n[g].push(y)):d.push({userId:g,deviceInfo:y})}catch(s){f.e(s)}finally{f.f()}return e.next=9,h._shareKeyWithDevices(i,w,x,n,d,3e4);case 9:return e.next=11,h._notifyFailedOlmDevices(i,w,d);case 11:case"end":return e.stop()}}),e)})))(),e.next=11;break;case 9:return e.next=11,h._notifyFailedOlmDevices(i,w,t);case 11:case"end":return e.stop()}}),e)})))(),u(s.mark((function e(){var t,r,o,u,c,l,d,f,p,v,g;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t={},r=0,o=Object.entries(n);r<o.length;r++)for(u=a(o[r],2),c=u[0],l=u[1],d=0,f=Object.entries(l);d<f.length;d++)p=a(f[d],2),v=p[0],g=p[1],i.blockedDevicesNotified[c]&&void 0!==i.blockedDevicesNotified[c][v]||(t[c]=t[c]||{},t[c][v]={device:g});return e.next=4,h._notifyBlockedDevices(i,t);case 4:case"end":return e.stop()}}),e)})))()]);case 37:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),p=this._setupPromise.then(c),this._setupPromise=p.then(d,d),e.abrupt("return",p.then(d));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),g.prototype._prepareNewSession=u(s.mark((function e(){var t,n;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._olmDevice.createOutboundGroupSession(),n=this._olmDevice.getOutboundGroupSessionKey(t),e.next=4,this._olmDevice.addInboundGroupSession(this._roomId,this._olmDevice.deviceCurve25519Key,[],t,n.key,{ed25519:this._olmDevice.deviceEd25519Key});case 4:return this._crypto.backupInfo&&this._crypto.backupGroupSession(this._roomId,this._olmDevice.deviceCurve25519Key,[],t,n.key).catch((function(e){l.logger.log("Failed to back up megolm session",e)})),e.abrupt("return",new v(t));case 6:case"end":return e.stop()}}),e,this)}))),g.prototype._getDevicesWithoutSessions=function(e,t,n){n=n||[];for(var r=0,i=Object.entries(t);r<i.length;r++){var s,u=a(i[r],2),c=u[0],l=u[1],d=e[c],f=o(l);try{for(f.s();!(s=f.n()).done;){var p=s.value,h=p.deviceId;d[h].sessionId||(n.push({userId:c,deviceInfo:p}),delete d[h])}}catch(v){f.e(v)}finally{f.f()}}return n},g.prototype._splitDevices=function(e){for(var t=[],n=[t],r=0,i=Object.entries(e);r<i.length;r++){for(var o=a(i[r],2),s=o[0],u=o[1],c=0,l=Object.values(u);c<l.length;c++){var d=l[c];t.push({userId:s,deviceInfo:d.device})}t.length>20&&(t=[],n.push(t))}return 0===t.length&&n.pop(),n},g.prototype._encryptAndSendKeysToDevices=function(e,t,n,r){for(var i=this,o={},s=[],a=0;a<n.length;a++){var u={algorithm:f.OLM_ALGORITHM,sender_key:this._olmDevice.deviceCurve25519Key,ciphertext:{}},c=n[a],d=c.userId,p=c.deviceInfo,h=p.deviceId;o[d]||(o[d]={}),o[d][h]=u,s.push(f.encryptMessageForDevice(u.ciphertext,this._userId,this._deviceId,this._olmDevice,d,p,r))}return Promise.all(s).then((function(){for(var n=0,r=Object.keys(o);n<r.length;n++){for(var s=r[n],a=0,u=Object.keys(o[s]);a<u.length;a++){var c=u[a];0===Object.keys(o[s][c].ciphertext).length&&(l.logger.log("No ciphertext for device "+s+":"+c+": pruning"),delete o[s][c])}0===Object.keys(o[s]).length&&(l.logger.log("Pruned all devices for user "+s),delete o[s])}if(0!==Object.keys(o).length)return i._baseApis.sendToDevice("m.room.encrypted",o).then((function(){for(var n=0,r=Object.keys(o);n<r.length;n++)for(var i=r[n],s=0,a=Object.keys(o[i]);s<a.length;s++){var u=a[s];e.markSharedWithDevice(i,u,t)}}));l.logger.log("No users left to send to: aborting")}))},g.prototype._sendBlockedNotificationsToDevices=function(){var e=u(s.mark((function e(t,n,r){var i,a,u,c,l,d,f,p,h,v,g,y,m,_,b;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i={},a=o(n);try{for(a.s();!(u=a.n()).done;)c=u.value,l=c.userId,d=c.deviceInfo,f=d.deviceInfo,p=f.deviceId,(h=Object.assign({},r)).code=d.code,h.reason=d.reason,"m.no_olm"===h.code&&(delete h.room_id,delete h.session_id),i[l]||(i[l]={}),i[l][p]=h}catch(s){a.e(s)}finally{a.f()}return e.next=5,this._baseApis.sendToDevice("org.matrix.room_key.withheld",i);case 5:for(v=0,g=Object.keys(i);v<g.length;v++)for(y=g[v],m=0,_=Object.keys(i[y]);m<_.length;m++)b=_[m],t.markNotifiedBlockedDevice(y,b);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),g.prototype.reshareKeyWithDevice=function(){var e=u(s.mark((function e(t,n,r,o){var a,u,c,d,p;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this._outboundSessions[n]){e.next=4;break}return l.logger.debug("megolm session ".concat(n," not found: not re-sharing keys")),e.abrupt("return");case 4:if(void 0!==a.sharedWithDevices[r]){e.next=7;break}return l.logger.debug("megolm session ".concat(n," never shared with user ").concat(r)),e.abrupt("return");case 7:if(void 0!==(u=a.sharedWithDevices[r][o.deviceId])){e.next=11;break}return l.logger.debug("megolm session ID "+n+" never shared with device "+r+":"+o.deviceId),e.abrupt("return");case 11:return e.next=13,this._olmDevice.getInboundGroupSessionKey(this._roomId,t,n,u);case 13:if(c=e.sent){e.next=17;break}return l.logger.warn("No inbound session key found for megolm ".concat(n,": not re-sharing keys")),e.abrupt("return");case 17:return e.next=19,f.ensureOlmSessionsForDevices(this._olmDevice,this._baseApis,i({},r,[o]));case 19:return d={type:"m.forwarded_room_key",content:{algorithm:f.MEGOLM_ALGORITHM,room_id:this._roomId,session_id:n,session_key:c.key,chain_index:c.chain_index,sender_key:t,sender_claimed_ed25519_key:c.sender_claimed_ed25519_key,forwarding_curve25519_key_chain:c.forwarding_curve25519_key_chain}},p={algorithm:f.OLM_ALGORITHM,sender_key:this._olmDevice.deviceCurve25519Key,ciphertext:{}},e.next=23,f.encryptMessageForDevice(p.ciphertext,this._userId,this._deviceId,this._olmDevice,r,o,d);case 23:return e.next=25,this._baseApis.sendToDevice("m.room.encrypted",i({},r,i({},o.deviceId,p)));case 25:l.logger.debug("Re-shared key for megolm session ".concat(n," ")+"with ".concat(r,":").concat(o.deviceId));case 26:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),g.prototype._shareKeyWithDevices=function(){var e=u(s.mark((function e(t,n,r,i,o,a,u){var c;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.ensureOlmSessionsForDevices(this._olmDevice,this._baseApis,i,a,u);case 2:return c=e.sent,this._getDevicesWithoutSessions(c,i,o),e.next=6,this._shareKeyWithOlmSessions(t,n,r,c);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o,s,a){return e.apply(this,arguments)}}(),g.prototype._shareKeyWithOlmSessions=function(){var e=u(s.mark((function e(t,n,r,i){var o,a;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=this._splitDevices(i),a=0;case 2:if(!(a<o.length)){e.next=16;break}return e.prev=3,e.next=6,this._encryptAndSendKeysToDevices(t,n.chain_index,o[a],r);case 6:l.logger.log("Completed megolm keyshare for ".concat(t.sessionId," ")+"in ".concat(this._roomId," (slice ").concat(a+1,"/").concat(o.length,")")),e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(3),l.logger.log("megolm keyshare for ".concat(t.sessionId," in ").concat(this._roomId," ")+"(slice ".concat(a+1,"/").concat(o.length,") failed")),e.t0;case 13:a++,e.next=2;break;case 16:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(t,n,r,i){return e.apply(this,arguments)}}(),g.prototype._notifyFailedOlmDevices=function(){var e=u(s.mark((function e(t,n,r){var i,a,u,c,l,d,f,p,v,g,y,m,_;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=o(r);try{for(i.s();!(a=i.n()).done;)u=a.value,c=u.userId,l=u.deviceInfo,d=l.deviceId,t.markSharedWithDevice(c,d,n.chain_index)}catch(s){i.e(s)}finally{i.f()}return e.next=4,this._olmDevice.filterOutNotifiedErrorDevices(r);case 4:f=e.sent,p={},v=o(f);try{for(v.s();!(g=v.n()).done;)y=g.value,m=y.userId,_=y.deviceInfo,p[m]=p[m]||{},p[m][_.deviceId]={device:{code:"m.no_olm",reason:h.WITHHELD_MESSAGES["m.no_olm"],deviceInfo:_}}}catch(s){v.e(s)}finally{v.f()}return e.next=10,this._notifyBlockedDevices(t,p);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),g.prototype._notifyBlockedDevices=function(){var e=u(s.mark((function e(t,n){var r,i,o;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={room_id:this._roomId,session_id:t.sessionId,algorithm:f.MEGOLM_ALGORITHM,sender_key:this._olmDevice.deviceCurve25519Key},i=this._splitDevices(n),o=0;case 3:if(!(o<i.length)){e.next=17;break}return e.prev=4,e.next=7,this._sendBlockedNotificationsToDevices(t,i[o],r);case 7:l.logger.log("Completed blacklist notification for ".concat(t.sessionId," ")+"in ".concat(this._roomId," (slice ").concat(o+1,"/").concat(i.length,")")),e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(4),l.logger.log("blacklist notification for ".concat(t.sessionId," in ")+"".concat(this._roomId," (slice ").concat(o+1,"/").concat(i.length,") failed")),e.t0;case 14:o++,e.next=3;break;case 17:case"end":return e.stop()}}),e,this,[[4,10]])})));return function(t,n){return e.apply(this,arguments)}}(),g.prototype.prepareToEncrypt=function(e){var t=this;this.encryptionPreparation||(l.logger.debug("Preparing to encrypt events for ".concat(this._roomId)),this.encryptionPreparation=u(s.mark((function n(){var r,i,o,u;return s.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t._getDevicesInRoom(e);case 2:return r=n.sent,i=a(r,2),o=i[0],u=i[1],t._crypto.getGlobalErrorOnUnknownDevices()&&t._removeUnknownDevices(o),n.next=9,t._ensureOutboundSession(o,u,!0);case 9:delete t.encryptionPreparation;case 10:case"end":return n.stop()}}),n)})))())},g.prototype.encryptMessage=function(){var e=u(s.mark((function e(t,n,r){var i,o,u,c,d,p,h,v;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l.logger.log("Starting to encrypt event for ".concat(this._roomId)),!this.encryptionPreparation){e.next=9;break}return e.prev=2,e.next=5,this.encryptionPreparation;case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:return e.next=11,this._getDevicesInRoom(t);case 11:return i=e.sent,o=a(i,2),u=o[0],c=o[1],this._crypto.getGlobalErrorOnUnknownDevices()&&this._checkForUnknownDevices(u),e.next=18,this._ensureOutboundSession(u,c);case 18:return d=e.sent,p={room_id:this._roomId,type:n,content:r},h=this._olmDevice.encryptGroupMessage(d.sessionId,JSON.stringify(p)),v={algorithm:f.MEGOLM_ALGORITHM,sender_key:this._olmDevice.deviceCurve25519Key,ciphertext:h,session_id:d.sessionId,device_id:this._deviceId},d.useCount++,e.abrupt("return",v);case 24:case"end":return e.stop()}}),e,this,[[2,7]])})));return function(t,n,r){return e.apply(this,arguments)}}(),g.prototype.forceDiscardSession=function(){this._setupPromise=this._setupPromise.then((function(){return null}))},g.prototype._checkForUnknownDevices=function(e){var t={};if(Object.keys(e).forEach((function(n){Object.keys(e[n]).forEach((function(r){var i=e[n][r];i.isUnverified()&&!i.isKnown()&&(t[n]||(t[n]={}),t[n][r]=i)}))})),Object.keys(t).length)throw new p.UnknownDeviceError("This room contains unknown devices which have not been verified. We strongly recommend you verify them before continuing.",t)},g.prototype._removeUnknownDevices=function(e){for(var t=0,n=Object.entries(e);t<n.length;t++){for(var r=a(n[t],2),i=r[0],o=r[1],s=0,u=Object.entries(o);s<u.length;s++){var c=a(u[s],2),l=c[0],d=c[1];d.isUnverified()&&!d.isKnown()&&delete o[l]}0===Object.keys(o).length&&delete e[i]}},g.prototype._getDevicesInRoom=function(){var e=u(s.mark((function e(t){var n,r,i,o,a,u,c,l,f,p;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getEncryptionTargetMembers();case 2:return n=e.sent,r=d.map(n,(function(e){return e.userId})),i=this._crypto.getGlobalBlacklistUnverifiedDevices(),"boolean"===typeof t.getBlacklistUnverifiedDevices()&&(i=t.getBlacklistUnverifiedDevices()),e.next=8,this._crypto.downloadKeys(r,!1);case 8:o=e.sent,a={},e.t0=s.keys(o);case 11:if((e.t1=e.t0()).done){e.next=27;break}if(u=e.t1.value,o.hasOwnProperty(u)){e.next=15;break}return e.abrupt("continue",11);case 15:c=o[u],e.t2=s.keys(c);case 17:if((e.t3=e.t2()).done){e.next=25;break}if(l=e.t3.value,c.hasOwnProperty(l)){e.next=21;break}return e.abrupt("continue",17);case 21:f=this._crypto.checkDeviceTrust(u,l),(c[l].isBlocked()||!f.isVerified()&&i)&&(a[u]||(a[u]={}),(p=c[l].isBlocked()?{code:"m.blacklisted",reason:h.WITHHELD_MESSAGES["m.blacklisted"]}:{code:"m.unverified",reason:h.WITHHELD_MESSAGES["m.unverified"]}).deviceInfo=c[l],a[u][l]=p,delete c[l]),e.next=17;break;case 25:e.next=11;break;case 27:return e.abrupt("return",[o,a]);case 28:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),d.inherits(y,p.DecryptionAlgorithm);var m={no_olm:"The sender was unable to establish a secure channel.",unknown:"The secure channel with the sender was corrupted."};y.prototype.decryptEvent=function(){var e=u(s.mark((function e(t){var n,r,i,o,a,u;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=t.getWireContent()).sender_key&&n.session_id&&n.ciphertext){e.next=3;break}throw new p.DecryptionError("MEGOLM_MISSING_FIELDS","Missing fields in input");case 3:return this._addEventToPendingList(t),e.prev=4,e.next=7,this._olmDevice.decryptGroupMessage(t.getRoomId(),n.sender_key,n.session_id,n.ciphertext,t.getId(),t.getTs());case 7:r=e.sent,e.next=17;break;case 10:if(e.prev=10,e.t0=e.catch(4),"DecryptionError"!==e.t0.name){e.next=14;break}throw e.t0;case 14:throw i="OLM_DECRYPT_GROUP_MESSAGE_ERROR",e.t0&&"OLM.UNKNOWN_MESSAGE_INDEX"===e.t0.message&&(this._requestKeysForEvent(t),i="OLM_UNKNOWN_MESSAGE_INDEX"),new p.DecryptionError(i,e.t0?e.t0.toString():"Unknown Error: Error is undefined",{session:n.sender_key+"|"+n.session_id});case 17:if(null!==r){e.next=27;break}return this._requestKeysForEvent(t),e.next=21,this._olmDevice.sessionMayHaveProblems(n.sender_key,t.getTs()-12e4);case 21:if(!(o=e.sent)){e.next=26;break}throw a=m[o.type]||m.unknown,o.fixed&&(a+=" Trying to create a new secure channel and re-requesting the keys."),new p.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",a,{session:n.sender_key+"|"+n.session_id});case 26:throw new p.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID","The sender's device has not sent us the keys for this message.",{session:n.sender_key+"|"+n.session_id});case 27:if(this._removeEventFromPendingList(t),(u=JSON.parse(r.result)).room_id===t.getRoomId()){e.next=31;break}throw new p.DecryptionError("MEGOLM_BAD_ROOM","Message intended for room "+u.room_id);case 31:return e.abrupt("return",{clearEvent:u,senderCurve25519Key:r.senderKey,claimedEd25519Key:r.keysClaimed.ed25519,forwardingCurve25519KeyChain:r.forwardingCurve25519KeyChain,untrusted:r.untrusted});case 32:case"end":return e.stop()}}),e,this,[[4,10]])})));return function(t){return e.apply(this,arguments)}}(),y.prototype._requestKeysForEvent=function(e){var t=e.getWireContent(),n=e.getKeyRequestRecipients(this._userId);this._crypto.requestRoomKey({room_id:e.getRoomId(),algorithm:t.algorithm,sender_key:t.sender_key,session_id:t.session_id},n)},y.prototype._addEventToPendingList=function(e){var t=e.getWireContent(),n=t.sender_key,r=t.session_id;this._pendingEvents[n]||(this._pendingEvents[n]=new Map);var i=this._pendingEvents[n];i.has(r)||i.set(r,new Set),i.get(r).add(e)},y.prototype._removeEventFromPendingList=function(e){var t=e.getWireContent(),n=t.sender_key,r=t.session_id,i=this._pendingEvents[n],o=i&&i.get(r);o&&(o.delete(e),0===o.size&&i.delete(n),0===i.size&&delete this._pendingEvents[n])},y.prototype.onRoomKeyEvent=function(e){var t,n=this,r=e.getContent(),i=r.session_id,o=e.getSenderKey(),s=[],a=!1;if(r.room_id&&i&&r.session_key){if(o){if("m.forwarded_room_key"==e.getType()){if(a=!0,s=r.forwarding_curve25519_key_chain,d.isArray(s)||(s=[]),(s=s.slice()).push(o),!(o=r.sender_key))return void l.logger.error("forwarded_room_key event is missing sender_key field");var u=r.sender_claimed_ed25519_key;if(!u)return void l.logger.error("forwarded_room_key_event is missing sender_claimed_ed25519_key field");t={ed25519:u}}else t=e.getKeysClaimed();return this._olmDevice.addInboundGroupSession(r.room_id,o,s,i,r.session_key,t,a).then((function(){n._retryDecryption(o,i).then((function(e){e&&n._crypto.cancelRoomKeyRequest({algorithm:r.algorithm,room_id:r.room_id,session_id:r.session_id,sender_key:o})}))})).then((function(){n._crypto.backupInfo&&n._crypto.backupGroupSession(r.room_id,o,s,r.session_id,r.session_key,t,a).catch((function(e){l.logger.log("Failed to back up megolm session",e)}))})).catch((function(e){l.logger.error("Error handling m.room_key_event: ".concat(e))}))}l.logger.error("key event has no sender key (not encrypted?)")}else l.logger.error("key event is missing fields")},y.prototype.onRoomKeyWithheldEvent=function(){var e=u(s.mark((function e(t){var n,r,o,a,u;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.getContent(),r=n.sender_key,"m.no_olm"!==n.code){e.next=36;break}return o=t.getSender(),l.logger.warn("".concat(o,":").concat(r," was unable to establish an olm session with us")),e.next=7,this._olmDevice.getSessionIdForDevice(r);case 7:if(!e.sent){e.next=13;break}return l.logger.debug("New session already created.  Not creating a new one."),e.next=11,this._olmDevice.recordSessionProblem(r,"no_olm",!0);case 11:return this.retryDecryptionFromSender(r),e.abrupt("return");case 13:if(a=this._crypto._deviceList.getDeviceByIdentityKey(n.algorithm,r)){e.next=24;break}return e.next=17,this._crypto.downloadKeys([o],!1);case 17:if(a=this._crypto._deviceList.getDeviceByIdentityKey(n.algorithm,r)){e.next=24;break}return l.logger.info("Couldn't find device for identity key "+r+": not establishing session"),e.next=22,this._olmDevice.recordSessionProblem(r,"no_olm",!1);case 22:return this.retryDecryptionFromSender(r),e.abrupt("return");case 24:return e.next=26,f.ensureOlmSessionsForDevices(this._olmDevice,this._baseApis,i({},o,[a]),!1);case 26:return u={algorithm:f.OLM_ALGORITHM,sender_key:this._olmDevice.deviceCurve25519Key,ciphertext:{}},e.next=29,f.encryptMessageForDevice(u.ciphertext,this._userId,this._deviceId,this._olmDevice,o,a,{type:"m.dummy"});case 29:return e.next=31,this._olmDevice.recordSessionProblem(r,"no_olm",!0);case 31:return this.retryDecryptionFromSender(r),e.next=34,this._baseApis.sendToDevice("m.room.encrypted",i({},o,i({},a.deviceId,u)));case 34:e.next=38;break;case 36:return e.next=38,this._olmDevice.addInboundGroupSessionWithheld(n.room_id,r,n.session_id,n.code,n.reason);case 38:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),y.prototype.hasKeysForKeyRequest=function(e){var t=e.requestBody;return this._olmDevice.hasInboundSessionKeys(t.room_id,t.sender_key,t.session_id)},y.prototype.shareKeysWithDevice=function(e){var t=this,n=e.userId,r=e.deviceId,o=this._crypto.getStoredDevice(n,r),s=e.requestBody;this.olmlib.ensureOlmSessionsForDevices(this._olmDevice,this._baseApis,i({},n,[o])).then((function(e){return e[n][r].sessionId?(l.logger.log("sharing keys for session "+s.sender_key+"|"+s.session_id+" with device "+n+":"+r),t._buildKeyForwardingMessage(s.room_id,s.sender_key,s.session_id)):null})).then((function(e){var s={algorithm:f.OLM_ALGORITHM,sender_key:t._olmDevice.deviceCurve25519Key,ciphertext:{}};return t.olmlib.encryptMessageForDevice(s.ciphertext,t._userId,t._deviceId,t._olmDevice,n,o,e).then((function(){var e=i({},n,i({},r,s));return t._baseApis.sendToDevice("m.room.encrypted",e)}))}))},y.prototype._buildKeyForwardingMessage=function(){var e=u(s.mark((function e(t,n,r){var i;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._olmDevice.getInboundGroupSessionKey(t,n,r);case 2:return i=e.sent,e.abrupt("return",{type:"m.forwarded_room_key",content:{algorithm:f.MEGOLM_ALGORITHM,room_id:t,sender_key:n,sender_claimed_ed25519_key:i.sender_claimed_ed25519_key,session_id:r,session_key:i.key,chain_index:i.chain_index,forwarding_curve25519_key_chain:i.forwarding_curve25519_key_chain}});case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),y.prototype.importRoomKey=function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._olmDevice.addInboundGroupSession(e.room_id,e.sender_key,e.forwarding_curve25519_key_chain,e.session_id,e.session_key,e.sender_claimed_keys,!0,n.untrusted?{untrusted:n.untrusted}:{}).then((function(){t._crypto.backupInfo&&"backup"!==n.source&&t._crypto.backupGroupSession(e.room_id,e.sender_key,e.forwarding_curve25519_key_chain,e.session_id,e.session_key,e.sender_claimed_keys,!0).catch((function(e){l.logger.log("Failed to back up megolm session",e)})),t._retryDecryption(e.sender_key,e.session_id)}))},y.prototype._retryDecryption=function(){var e=u(s.mark((function e(t,n){var i,o,a=this;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this._pendingEvents[t]){e.next=3;break}return e.abrupt("return",!0);case 3:if(o=i.get(n)){e.next=6;break}return e.abrupt("return",!0);case 6:return l.logger.debug("Retrying decryption on events",r(o)),e.next=9,Promise.all(r(o).map(function(){var e=u(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.attemptDecryption(a._crypto,!0);case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()));case 9:return e.abrupt("return",!(this._pendingEvents[t]||{})[n]);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),y.prototype.retryDecryptionFromSender=function(){var e=u(s.mark((function e(t){var n,i=this;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._pendingEvents[t]){e.next=3;break}return e.abrupt("return",!0);case 3:return delete this._pendingEvents[t],e.next=6,Promise.all(r(n).map(function(){var e=u(s.mark((function e(t){var n,o;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a(t,2),n[0],o=n[1],e.next=3,Promise.all(r(o).map(function(){var e=u(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.attemptDecryption(i._crypto);case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:return e.abrupt("return",!this._pendingEvents[t]);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),(0,p.registerAlgorithm)(f.MEGOLM_ALGORITHM,g,y)},function(e,t,n){"use strict";var r=n(6),i=n(10),o=n(2),s=n(3),a=n(7),u=n(8),c=n(22),l=n(13),d=n(14),f=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.DeviceList=void 0;var p=n(11),h=n(1),v=n(38),g=n(39),y=f(n(17)),m=n(20),_=n(5),b=function(e){l(n,e);var t=d(n);function n(e,r,i){var o;return a(this,n),(o=t.call(this))._cryptoStore=r,o._devices={},o._crossSigningInfo={},o._userByIdentityKey={},o._deviceTrackingStatus={},o._syncToken=null,o._serialiser=new k(e,i,c(o)),o._keyDownloadsInProgressByUser={},o._dirty=!1,o._savePromise=null,o._resolveSavePromise=null,o._savePromiseTime=null,o._saveTimer=null,o._hasFetched=null,o}return u(n,[{key:"load",value:function(){var e=s(o.mark((function e(){var t,n,r,i=this;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._cryptoStore.doTxn("readonly",[m.IndexedDBCryptoStore.STORE_DEVICE_DATA],(function(e){i._cryptoStore.getEndToEndDeviceData(e,(function(e){i._hasFetched=Boolean(e&&e.devices),i._devices=e?e.devices:{},i._crossSigningInfo=e&&e.crossSigningInfo||{},i._deviceTrackingStatus=e?e.trackingStatus:{},i._syncToken=e?e.syncToken:null,i._userByIdentityKey={};for(var t=0,n=Object.keys(i._devices);t<n.length;t++)for(var r=n[t],o=i._devices[r],s=0,a=Object.keys(o);s<a.length;s++){var u=a[s],c=o[u].keys["curve25519:"+u];void 0!==c&&(i._userByIdentityKey[c]=r)}}))}));case 2:for(t=0,n=Object.keys(this._deviceTrackingStatus);t<n.length;t++)r=n[t],2==this._deviceTrackingStatus[r]&&(this._deviceTrackingStatus[r]=1);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){null!==this._saveTimer&&clearTimeout(this._saveTimer)}},{key:"saveIfDirty",value:function(){var e=s(o.mark((function e(t){var n,r,i,s=this;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._dirty){e.next=2;break}return e.abrupt("return",Promise.resolve(!1));case 2:return void 0===t&&(t=500),n=Date.now+t,this._savePromiseTime&&n<this._savePromiseTime&&(clearTimeout(this._saveTimer),this._saveTimer=null,this._savePromiseTime=null),null===(r=this._savePromise)&&(r=new Promise((function(e,t){s._resolveSavePromise=e})),this._savePromise=r),null===this._saveTimer&&(i=this._resolveSavePromise,this._savePromiseTime=n,this._saveTimer=setTimeout((function(){h.logger.log("Saving device tracking data",s._syncToken),s._savePromiseTime=null,s._saveTimer=null,s._savePromise=null,s._resolveSavePromise=null,s._cryptoStore.doTxn("readwrite",[m.IndexedDBCryptoStore.STORE_DEVICE_DATA],(function(e){s._cryptoStore.storeEndToEndDeviceData({devices:s._devices,crossSigningInfo:s._crossSigningInfo,trackingStatus:s._deviceTrackingStatus,syncToken:s._syncToken},e)})).then((function(){s._dirty=!1,i()}),(function(e){h.logger.error("Failed to save device tracking data",s._syncToken),h.logger.error(e)}))}),t)),e.abrupt("return",r);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getSyncToken",value:function(){return this._syncToken}},{key:"setSyncToken",value:function(e){this._syncToken=e}},{key:"downloadKeys",value:function(e,t){var n=this,r=[],i=[];if(e.forEach((function(e){var o=n._deviceTrackingStatus[e];n._keyDownloadsInProgressByUser[e]?(h.logger.log("downloadKeys: already have a download in progress for "+"".concat(e,": awaiting its result")),i.push(n._keyDownloadsInProgressByUser[e])):(t||3!=o)&&r.push(e)})),0!=r.length){h.logger.log("downloadKeys: downloading for",r);var o=this._doKeyDownload(r);i.push(o)}return 0===i.length&&h.logger.log("downloadKeys: already have all necessary keys"),Promise.all(i).then((function(){return n._getDevicesFromStore(e)}))}},{key:"_getDevicesFromStore",value:function(e){var t={},n=this;return e.map((function(e){t[e]={},(n.getStoredDevicesForUser(e)||[]).map((function(n){t[e][n.deviceId]=n}))})),t}},{key:"getKnownUserIds",value:function(){return Object.keys(this._devices)}},{key:"getStoredDevicesForUser",value:function(e){var t=this._devices[e];if(!t)return null;var n=[];for(var r in t)t.hasOwnProperty(r)&&n.push(v.DeviceInfo.fromStorage(t[r],r));return n}},{key:"getRawStoredDevicesForUser",value:function(e){return this._devices[e]}},{key:"getStoredCrossSigningForUser",value:function(e){return this._crossSigningInfo[e]?g.CrossSigningInfo.fromStorage(this._crossSigningInfo[e],e):null}},{key:"storeCrossSigningForUser",value:function(e,t){this._crossSigningInfo[e]=t,this._dirty=!0}},{key:"getStoredDevice",value:function(e,t){var n=this._devices[e];if(n&&n[t])return v.DeviceInfo.fromStorage(n[t],t)}},{key:"getUserByIdentityKey",value:function(e,t){return e!==y.OLM_ALGORITHM&&e!==y.MEGOLM_ALGORITHM?null:this._userByIdentityKey[t]}},{key:"getDeviceByIdentityKey",value:function(e,t){var n=this.getUserByIdentityKey(e,t);if(!n)return null;var r=this._devices[n];if(!r)return null;for(var i in r)if(r.hasOwnProperty(i)){var o=r[i];for(var s in o.keys){if(o.keys.hasOwnProperty(s))if(0===s.indexOf("curve25519:"))if(o.keys[s]==t)return v.DeviceInfo.fromStorage(o,i)}}return null}},{key:"storeDevicesForUser",value:function(e,t){if(void 0!==this._devices[e])for(var n=0,r=Object.entries(this._devices[e]);n<r.length;n++){var o=i(r[n],2),s=o[0],a=o[1].keys["curve25519:"+s];delete this._userByIdentityKey[a]}this._devices[e]=t;for(var u=0,c=Object.entries(t);u<c.length;u++){var l=i(c[u],2),d=l[0],f=l[1].keys["curve25519:"+d];this._userByIdentityKey[f]=e}this._dirty=!0}},{key:"startTrackingDeviceList",value:function(e){if("string"!==typeof e)throw new Error("userId must be a string; was "+e);this._deviceTrackingStatus[e]||(h.logger.log("Now tracking device list for "+e),this._deviceTrackingStatus[e]=1,this._dirty=!0)}},{key:"stopTrackingDeviceList",value:function(e){this._deviceTrackingStatus[e]&&(h.logger.log("No longer tracking device list for "+e),this._deviceTrackingStatus[e]=0,this._dirty=!0)}},{key:"stopTrackingAllDeviceLists",value:function(){for(var e=0,t=Object.keys(this._deviceTrackingStatus);e<t.length;e++){var n=t[e];this._deviceTrackingStatus[n]=0}this._dirty=!0}},{key:"invalidateUserDeviceList",value:function(e){this._deviceTrackingStatus[e]&&(h.logger.log("Marking device list outdated for",e),this._deviceTrackingStatus[e]=1,this._dirty=!0)}},{key:"refreshOutdatedDeviceLists",value:function(){this.saveIfDirty();for(var e=[],t=0,n=Object.keys(this._deviceTrackingStatus);t<n.length;t++){var r=n[t];1==this._deviceTrackingStatus[r]&&e.push(r)}return this._doKeyDownload(e)}},{key:"_setRawStoredDevicesForUser",value:function(e,t){if(void 0!==this._devices[e])for(var n=0,r=Object.entries(this._devices[e]);n<r.length;n++){var o=i(r[n],2),s=o[0],a=o[1].keys["curve25519:"+s];delete this._userByIdentityKey[a]}this._devices[e]=t;for(var u=0,c=Object.entries(t);u<c.length;u++){var l=i(c[u],2),d=l[0],f=l[1].keys["curve25519:"+d];this._userByIdentityKey[f]=e}}},{key:"setRawStoredCrossSigningForUser",value:function(e,t){this._crossSigningInfo[e]=t}},{key:"_doKeyDownload",value:function(e){var t=this;if(0===e.length)return Promise.resolve();var n=this._serialiser.updateDevicesForUsers(e,this._syncToken).then((function(){r(!0)}),(function(t){throw h.logger.error("Error downloading keys for "+e+":",t),r(!1),t}));e.forEach((function(e){t._keyDownloadsInProgressByUser[e]=n,1==t._deviceTrackingStatus[e]&&(t._deviceTrackingStatus[e]=2)}));var r=function(r){t.emit("crypto.willUpdateDevices",e,!t._hasFetched),e.forEach((function(e){(t._dirty=!0,t._keyDownloadsInProgressByUser[e]===n)?(delete t._keyDownloadsInProgressByUser[e],2==t._deviceTrackingStatus[e]&&(r?(t._deviceTrackingStatus[e]=3,h.logger.log("Device list for",e,"now up to date")):t._deviceTrackingStatus[e]=1)):h.logger.log("Another update in the queue for",e,"- not marking up-to-date")})),t.saveIfDirty(),t.emit("crypto.devicesUpdated",e,!t._hasFetched),t._hasFetched=!0};return n}}]),n}(p.EventEmitter);t.DeviceList=b;var k=function(){function e(t,n,r){a(this,e),this._baseApis=t,this._olmDevice=n,this._deviceList=r,this._downloadInProgress=!1,this._keyDownloadsQueuedByUser={},this._queuedQueryDeferred=null,this._syncToken=null}return u(e,[{key:"updateDevicesForUsers",value:function(e,t){var n=this;return e.forEach((function(e){n._keyDownloadsQueuedByUser[e]=!0})),this._queuedQueryDeferred||(this._queuedQueryDeferred=(0,_.defer)()),this._syncToken=t,this._downloadInProgress?(h.logger.log("Queued key download for",e),this._queuedQueryDeferred.promise):this._doQueuedQueries()}},{key:"_doQueuedQueries",value:function(){var e=this;if(this._downloadInProgress)throw new Error("DeviceListUpdateSerialiser._doQueuedQueries called with request active");var t=Object.keys(this._keyDownloadsQueuedByUser);this._keyDownloadsQueuedByUser={};var n=this._queuedQueryDeferred;this._queuedQueryDeferred=null,h.logger.log("Starting key download for",t),this._downloadInProgress=!0;var i={};return this._syncToken&&(i.token=this._syncToken),this._baseApis.downloadKeysForUsers(t,i).then(function(){var n=s(o.mark((function n(i){var s,a,u,c,l,d,f;return o.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:s=i.device_keys||{},a=i.master_keys||{},u=i.self_signing_keys||{},c=i.user_signing_keys||{},l=r(t),n.prev=5,l.s();case 7:if((d=l.n()).done){n.next=21;break}return f=d.value,n.next=11,(0,_.sleep)(5);case 11:return n.prev=11,n.next=14,e._processQueryResponseForUser(f,s[f],{master:a[f],self_signing:u[f],user_signing:c[f]});case 14:n.next=19;break;case 16:n.prev=16,n.t0=n.catch(11),h.logger.error("Error processing keys for ".concat(f,":"),n.t0);case 19:n.next=7;break;case 21:n.next=26;break;case 23:n.prev=23,n.t1=n.catch(5),l.e(n.t1);case 26:return n.prev=26,l.f(),n.finish(26);case 29:case"end":return n.stop()}}),n,null,[[5,23,26,29],[11,16]])})));return function(e){return n.apply(this,arguments)}}()).then((function(){h.logger.log("Completed key download for "+t),e._downloadInProgress=!1,n.resolve(),e._queuedQueryDeferred&&e._doQueuedQueries()}),(function(r){h.logger.warn("Error downloading keys for "+t+":",r),e._downloadInProgress=!1,n.reject(r)})),n.promise}},{key:"_processQueryResponseForUser",value:function(){var e=s(o.mark((function e(t,n,r){var i,s,a,u;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h.logger.log("got device keys for "+t+":",n),h.logger.log("got cross-signing keys for "+t+":",r),i={},(s=this._deviceList.getRawStoredDevicesForUser(t))&&Object.keys(s).forEach((function(e){var t=v.DeviceInfo.fromStorage(s[e],e);i[e]=t})),e.next=7,S(this._olmDevice,t,i,n||{},this._baseApis.getUserId(),this._baseApis.deviceId);case 7:a={},Object.keys(i).forEach((function(e){a[e]=i[e].toStorage()})),this._deviceList._setRawStoredDevicesForUser(t,a),r&&(r.master||r.self_signing||r.user_signing)&&((u=this._deviceList.getStoredCrossSigningForUser(t)||new g.CrossSigningInfo(t)).setKeys(r),this._deviceList.setRawStoredCrossSigningForUser(t,u.toStorage()),this._deviceList.emit("userCrossSigningUpdated",t));case 11:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),e}();function S(e,t,n,r,i,o){return E.apply(this,arguments)}function E(){return(E=s(o.mark((function e(t,n,r,i,s,a){var u,c,l,d;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u=!1,e.t0=o.keys(r);case 2:if((e.t1=e.t0()).done){e.next=15;break}if(c=e.t1.value,r.hasOwnProperty(c)){e.next=6;break}return e.abrupt("continue",2);case 6:if(c in i){e.next=13;break}if(n!==s||c!==a){e.next=10;break}return h.logger.warn("Local device ".concat(c," missing from sync, skipping removal")),e.abrupt("continue",2);case 10:h.logger.log("Device "+n+":"+c+" has been removed"),delete r[c],u=!0;case 13:e.next=2;break;case 15:e.t2=o.keys(i);case 16:if((e.t3=e.t2()).done){e.next=33;break}if(l=e.t3.value,i.hasOwnProperty(l)){e.next=20;break}return e.abrupt("continue",16);case 20:if((d=i[l]).user_id===n){e.next=24;break}return h.logger.warn("Mismatched user_id "+d.user_id+" in keys from "+n+":"+l),e.abrupt("continue",16);case 24:if(d.device_id===l){e.next=27;break}return h.logger.warn("Mismatched device_id "+d.device_id+" in keys from "+n+":"+l),e.abrupt("continue",16);case 27:return e.next=29,w(t,r,d);case 29:if(!e.sent){e.next=31;break}u=!0;case 31:e.next=16;break;case 33:return e.abrupt("return",u);case 34:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e,t,n){return x.apply(this,arguments)}function x(){return(x=s(o.mark((function e(t,n,r){var i,s,a,u,c,l,d;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.keys){e.next=2;break}return e.abrupt("return",!1);case 2:if(i=r.device_id,s=r.user_id,a="ed25519:"+i,u=r.keys[a]){e.next=9;break}return h.logger.warn("Device "+s+":"+i+" has no ed25519 key"),e.abrupt("return",!1);case 9:return c=r.unsigned||{},l=r.signatures||{},e.prev=11,e.next=14,y.verifySignature(t,r,s,i,u);case 14:e.next=20;break;case 16:return e.prev=16,e.t0=e.catch(11),h.logger.warn("Unable to verify signature on device "+s+":"+i+":"+e.t0),e.abrupt("return",!1);case 20:if(!(i in n)){e.next=27;break}if((d=n[i]).getFingerprint()==u){e.next=25;break}return h.logger.warn("Ed25519 key for device "+s+":"+i+" has changed"),e.abrupt("return",!1);case 25:e.next=28;break;case 27:n[i]=d=new v.DeviceInfo(i);case 28:return d.keys=r.keys||{},d.algorithms=r.algorithms||[],d.unsigned=c,d.signatures=l,e.abrupt("return",!0);case 33:case"end":return e.stop()}}),e,null,[[11,16]])})))).apply(this,arguments)}},function(e,t,n){"use strict";var r=n(13),i=n(14),o=n(6),s=n(10),a=n(2),u=n(3),c=n(7),l=n(8);Object.defineProperty(t,"__esModule",{value:!0}),t.EncryptionSetupOperation=t.EncryptionSetupBuilder=void 0;var d=n(1),f=n(16),p=n(11),h=n(39),v=n(20),g=n(33),y=function(){function e(t,n){c(this,e),this.accountDataClientAdapter=new _(t),this.crossSigningCallbacks=new b,this.ssssCryptoCallbacks=new k(n),this._crossSigningKeys=null,this._keySignatures=null,this._keyBackupInfo=null}return l(e,[{key:"addCrossSigningKeys",value:function(e,t){this._crossSigningKeys={authUpload:e,keys:t}}},{key:"addSessionBackup",value:function(e){this._keyBackupInfo=e}},{key:"addSessionBackupPrivateKeyToCache",value:function(e){this._sessionBackupPrivateKey=e}},{key:"addKeySignature",value:function(e,t,n){this._keySignatures||(this._keySignatures={});var r=this._keySignatures[e]||{};this._keySignatures[e]=r,r[t]=n}},{key:"setAccountData",value:function(e,t){return this.accountDataClientAdapter.setAccountData(e,t)}},{key:"buildOperation",value:function(){var e=this.accountDataClientAdapter._values;return new m(e,this._crossSigningKeys,this._keyBackupInfo,this._keySignatures)}},{key:"persist",value:function(){var e=u(a.mark((function e(t){var n,r,i,o,s,u=this;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._crossSigningKeys){e.next=14;break}n=(0,h.createCryptoStoreCacheCallbacks)(t._cryptoStore,t._olmDevice),r=0,i=["master","self_signing","user_signing"];case 3:if(!(r<i.length)){e.next=12;break}return o=i[r],d.logger.log("Cache ".concat(o," cross-signing private key locally")),s=this.crossSigningCallbacks.privateKeys.get(o),e.next=9,n.storeCrossSigningKeyCache(o,s);case 9:r++,e.next=3;break;case 12:return e.next=14,t._cryptoStore.doTxn("readwrite",[v.IndexedDBCryptoStore.STORE_ACCOUNT],(function(e){t._cryptoStore.storeCrossSigningKeys(e,u._crossSigningKeys.keys)}));case 14:if(!this._sessionBackupPrivateKey){e.next=17;break}return e.next=17,t.storeSessionBackupPrivateKey(this._sessionBackupPrivateKey);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();t.EncryptionSetupBuilder=y;var m=function(){function e(t,n,r,i){c(this,e),this._accountData=t,this._crossSigningKeys=n,this._keyBackupInfo=r,this._keySignatures=i}return l(e,[{key:"apply",value:function(){var e=u(a.mark((function e(t){var n,r,i,u,c,l,d,f,p,h,v,y;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t._baseApis,!this._crossSigningKeys){e.next=7;break}for(r={},i=0,u=Object.entries(this._crossSigningKeys.keys);i<u.length;i++)c=s(u[i],2),l=c[0],d=c[1],r[l+"_key"]=d;return e.next=6,this._crossSigningKeys.authUpload((function(e){return n.uploadDeviceSigningKeys(e,r)}));case 6:t._crossSigningInfo.setKeys(this._crossSigningKeys.keys);case 7:if(!this._accountData){e.next=25;break}f=o(this._accountData),e.prev=9,f.s();case 11:if((p=f.n()).done){e.next=17;break}return h=s(p.value,2),v=h[0],y=h[1],e.next=15,n.setAccountData(v,y);case 15:e.next=11;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(9),f.e(e.t0);case 22:return e.prev=22,f.f(),e.finish(22);case 25:if(!this._keySignatures){e.next=28;break}return e.next=28,n.uploadKeySignatures(this._keySignatures);case 28:if(!this._keyBackupInfo){e.next=36;break}if(!this._keyBackupInfo.version){e.next=34;break}return e.next=32,n._http.authedRequest(void 0,"PUT","/room_keys/version/"+this._keyBackupInfo.version,void 0,{algorithm:this._keyBackupInfo.algorithm,auth_data:this._keyBackupInfo.auth_data},{prefix:g.PREFIX_UNSTABLE});case 32:e.next=36;break;case 34:return e.next=36,n._http.authedRequest(void 0,"POST","/room_keys/version",void 0,this._keyBackupInfo,{prefix:g.PREFIX_UNSTABLE});case 36:case"end":return e.stop()}}),e,this,[[9,19,22,25]])})));return function(t){return e.apply(this,arguments)}}()}]),e}();t.EncryptionSetupOperation=m;var _=function(e){r(n,e);var t=i(n);function n(e){var r;return c(this,n),(r=t.call(this))._existingValues=e,r._values=new Map,r}return l(n,[{key:"getAccountDataFromServer",value:function(e){return Promise.resolve(this.getAccountData(e))}},{key:"getAccountData",value:function(e){var t=this._values.get(e);if(t)return t;var n=this._existingValues[e];return n?n.getContent():null}},{key:"setAccountData",value:function(e,t){var n=this,r=this._values.get(e);return this._values.set(e,t),Promise.resolve().then((function(){var i=new f.MatrixEvent({type:e,content:t});n.emit("accountData",i,r)}))}}]),n}(p.EventEmitter),b=function(){function e(){c(this,e),this.privateKeys=new Map}return l(e,[{key:"getCrossSigningKeyCache",value:function(e,t){return this.getCrossSigningKey(e,t)}},{key:"storeCrossSigningKeyCache",value:function(e,t){return this.privateKeys.set(e,t),Promise.resolve()}},{key:"getCrossSigningKey",value:function(e,t){return Promise.resolve(this.privateKeys.get(e))}},{key:"saveCrossSigningKeys",value:function(e){for(var t=0,n=Object.entries(e);t<n.length;t++){var r=s(n[t],2),i=r[0],o=r[1];this.privateKeys.set(i,o)}}}]),e}(),k=function(){function e(t){c(this,e),this._privateKeys=new Map,this._delegateCryptoCallbacks=t}return l(e,[{key:"getSecretStorageKey",value:function(){var e=u(a.mark((function e(t,n){var r,i,o,u,c,l,d,f,p;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.keys,i=0,o=Object.keys(r);case 2:if(!(i<o.length)){e.next=10;break}if(u=o[i],!(c=this._privateKeys.get(u))){e.next=7;break}return e.abrupt("return",[u,c]);case 7:i++,e.next=2;break;case 10:if(!this._delegateCryptoCallbacks){e.next=16;break}return e.next=13,this._delegateCryptoCallbacks.getSecretStorageKey({keys:r},n);case 13:return(l=e.sent)&&(d=s(l,2),f=d[0],p=d[1],this._privateKeys.set(f,p)),e.abrupt("return",l);case 16:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"addPrivateKey",value:function(e,t,n){this._privateKeys.set(e,n),this._delegateCryptoCallbacks&&this._delegateCryptoCallbacks.cacheSecretStorageKey&&this._delegateCryptoCallbacks.cacheSecretStorageKey(e,t,n)}}]),e}()},function(e,t,n){"use strict";var r=n(10),i=n(15),o=n(6),s=n(2),a=n(3),u=n(7),c=n(8),l=n(13),d=n(14),f=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.SecretStorage=t.SECRET_STORAGE_ALGORITHM_V1_AES=void 0;var p=n(11),h=n(1),v=f(n(17)),g=n(41),y=n(40),m="m.secret_storage.v1.aes-hmac-sha2";t.SECRET_STORAGE_ALGORITHM_V1_AES=m;var _=function(e){l(n,e);var t=d(n);function n(e,r){var i;return u(this,n),(i=t.call(this))._baseApis=e,i._cryptoCallbacks=r,i._requests={},i._incomingRequests={},i}return c(n,[{key:"getDefaultKeyId",value:function(){var e=a(s.mark((function e(){var t;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._baseApis.getAccountDataFromServer("m.secret_storage.default_key");case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",null);case 5:return e.abrupt("return",t.key);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setDefaultKeyId",value:function(e){var t=this;return new Promise(function(){var n=a(s.mark((function n(r,i){var o;return s.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=function n(i){"m.secret_storage.default_key"===i.getType()&&i.getContent().key===e&&(t._baseApis.removeListener("accountData",n),r())},t._baseApis.on("accountData",o),n.prev=2,n.next=5,t._baseApis.setAccountData("m.secret_storage.default_key",{key:e});case 5:n.next=11;break;case 7:n.prev=7,n.t0=n.catch(2),t._baseApis.removeListener("accountData",o),i(n.t0);case 11:case"end":return n.stop()}}),n,null,[[2,7]])})));return function(e,t){return n.apply(this,arguments)}}())}},{key:"addKey",value:function(){var e=a(s.mark((function e(t,r,i){var o,a,u,c;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o={algorithm:t},r||(r={}),r.name&&(o.name=r.name),t!==m){e.next=15;break}if(r.passphrase&&(o.passphrase=r.passphrase),!r.key){e.next=13;break}return e.next=8,n._calculateKeyCheck(r.key);case 8:a=e.sent,u=a.iv,c=a.mac,o.iv=u,o.mac=c;case 13:e.next=16;break;case 15:throw new Error("Unknown key algorithm ".concat(r.algorithm));case 16:if(i){e.next=21;break}case 17:i=(0,g.randomString)(32);case 18:return e.next=20,this._baseApis.getAccountDataFromServer("m.secret_storage.key.".concat(i));case 20:if(e.sent){e.next=17;break}case 21:return e.next=23,this._baseApis.setAccountData("m.secret_storage.key.".concat(i),o);case 23:return e.abrupt("return",{keyId:i,keyInfo:o});case 24:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getKey",value:function(){var e=a(s.mark((function e(t){var n;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=4;break}return e.next=3,this.getDefaultKeyId();case 3:t=e.sent;case 4:if(t){e.next=6;break}return e.abrupt("return",null);case 6:return e.next=8,this._baseApis.getAccountDataFromServer("m.secret_storage.key."+t);case 8:return n=e.sent,e.abrupt("return",n?[t,n]:null);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hasKey",value:function(){var e=a(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getKey(t);case 2:return e.abrupt("return",!!e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkKey",value:function(){var e=a(s.mark((function e(t,r){var i,o;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.algorithm!==m){e.next=12;break}if(!r.mac){e.next=9;break}return e.next=4,n._calculateKeyCheck(t,r.iv);case 4:return i=e.sent,o=i.mac,e.abrupt("return",r.mac.replace(/=+$/g,"")===o.replace(/=+$/g,""));case 9:return e.abrupt("return",!0);case 10:e.next=13;break;case 12:throw new Error("Unknown algorithm");case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"store",value:function(){var e=a(s.mark((function e(t,n,a){var u,c,l,d,f,p,v,g,y,_;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u={},a){e.next=8;break}return e.next=4,this.getDefaultKeyId();case 4:if(c=e.sent){e.next=7;break}throw new Error("No keys specified and no default key present");case 7:a=[c];case 8:if(0!==a.length){e.next=10;break}throw new Error("Zero keys given to encrypt with!");case 10:l=o(a),e.prev=11,l.s();case 13:if((d=l.n()).done){e.next=35;break}return f=d.value,e.next=17,this._baseApis.getAccountDataFromServer("m.secret_storage.key."+f);case 17:if(p=e.sent){e.next=20;break}throw new Error("Unknown key: "+f);case 20:if(p.algorithm!==m){e.next=32;break}return v=i({},f,p),e.next=24,this._getSecretStorageKey(v,t);case 24:return g=e.sent,y=r(g,2),_=y[1],e.next=29,_.encrypt(n);case 29:u[f]=e.sent,e.next=33;break;case 32:h.logger.warn("unknown algorithm for secret storage key "+f+": "+p.algorithm);case 33:e.next=13;break;case 35:e.next=40;break;case 37:e.prev=37,e.t0=e.catch(11),l.e(e.t0);case 40:return e.prev=40,l.f(),e.finish(40);case 43:return e.next=45,this._baseApis.setAccountData(t,{encrypted:u});case 45:case"end":return e.stop()}}),e,this,[[11,37,40,43]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_fixupStoredSecret",value:function(){var e=a(s.mark((function e(t,n){var r,i;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==(r=Object.keys(n)).length||"encrypted"===r[0]||!n[r[0]].passthrough){e.next=13;break}return e.next=4,this.hasKey(r[0]);case 4:if(!e.sent){e.next=13;break}return h.logger.log("Fixing up passthrough secret: "+t),e.next=9,this.storePassthrough(t,r[0]);case 9:return e.next=11,this._baseApis.getAccountDataFromServer(t);case 11:return i=e.sent,e.abrupt("return",i);case 13:return e.abrupt("return",null);case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=a(s.mark((function e(t){var n,i,o,a,u,c,l,d,f,p,h,g;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._baseApis.getAccountDataFromServer(t);case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return");case 5:if(n.encrypted){e.next=11;break}return e.next=8,this._fixupStoredSecret(t,n);case 8:if((n=e.sent)&&n.encrypted){e.next=11;break}throw new Error("Content is not encrypted!");case 11:i={},o=0,a=Object.keys(n.encrypted);case 13:if(!(o<a.length)){e.next=23;break}return u=a[o],e.next=17,this._baseApis.getAccountDataFromServer("m.secret_storage.key."+u);case 17:c=e.sent,l=n.encrypted[u],c.algorithm===m&&l.iv&&l.ciphertext&&l.mac&&(i[u]=c);case 20:o++,e.next=13;break;case 23:if(0!==Object.keys(i).length){e.next=25;break}throw new Error("Could not decrypt ".concat(t," because none of ")+"the keys it is encrypted with are for a supported algorithm");case 25:return e.prev=25,e.next=28,this._getSecretStorageKey(i,t);case 28:if(p=e.sent,h=r(p,2),d=h[0],f=h[1],!(g=n.encrypted[d]).passthrough){e.next=35;break}return e.abrupt("return",(0,v.encodeBase64)(f.get_private_key()));case 35:return e.next=37,f.decrypt(g);case 37:return e.abrupt("return",e.sent);case 38:return e.prev=38,f&&f.free&&f.free(),e.finish(38);case 41:case"end":return e.stop()}}),e,this,[[25,,38,41]])})));return function(t){return e.apply(this,arguments)}}()},{key:"isStored",value:function(){var e=a(s.mark((function e(t,n){var r,i,o,a,u,c,l;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._baseApis.getAccountDataFromServer(t);case 2:if(r=e.sent){e.next=5;break}return e.abrupt("return",null);case 5:if(r.encrypted){e.next=11;break}return e.next=8,this._fixupStoredSecret(t,r);case 8:if((r=e.sent)&&r.encrypted){e.next=11;break}return e.abrupt("return",null);case 11:void 0===n&&(n=!0),i={},o=0,a=Object.keys(r.encrypted);case 14:if(!(o<a.length)){e.next=26;break}return u=a[o],e.next=18,this._baseApis.getAccountDataFromServer("m.secret_storage.key."+u);case 18:if(c=e.sent){e.next=21;break}return e.abrupt("continue",23);case 21:l=r.encrypted[u],c.algorithm===m&&l.iv&&l.ciphertext&&l.mac&&(i[u]=c);case 23:o++,e.next=14;break;case 26:return e.abrupt("return",Object.keys(i).length?i:null);case 27:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"request",value:function(e,t){var n,r=this,s=this._baseApis.makeTxnId(),a=this._requests[s]={name:e,devices:t},u=new Promise((function(e,t){a.resolve=e,a.reject=t})),c={name:e,action:"request",requesting_device_id:this._baseApis.deviceId,request_id:s},l={},d=o(t);try{for(d.s();!(n=d.n()).done;){l[n.value]=c}}catch(f){d.e(f)}finally{d.f()}return h.logger.info("Request secret ".concat(e," from ").concat(t,", id ").concat(s)),this._baseApis.sendToDevice("m.secret.request",i({},this._baseApis.getUserId(),l)),{request_id:s,promise:u,cancel:function(e){var n,u={action:"request_cancellation",requesting_device_id:r._baseApis.deviceId,request_id:s},c={},l=o(t);try{for(l.s();!(n=l.n()).done;){c[n.value]=u}}catch(f){l.e(f)}finally{l.f()}r._baseApis.sendToDevice("m.secret.request",i({},r._baseApis.getUserId(),c)),a.reject(new Error(e||"Cancelled"))}}}},{key:"_onRequestReceived",value:function(){var e=a(s.mark((function e(t){var n,r,o,a,u,c,l;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.getSender(),r=t.getContent(),n===this._baseApis.getUserId()&&(r.name&&r.action&&r.requesting_device_id&&r.request_id)){e.next=4;break}return e.abrupt("return");case 4:if(o=r.requesting_device_id,"request_cancellation"!==r.action){e.next=9;break}this._incomingRequests[o]&&this._incomingRequests[o][r.request_id]&&(h.logger.info("received request cancellation for secret ("+n+", "+o+", "+r.request_id+")"),this.baseApis.emit("crypto.secrets.requestCancelled",{user_id:n,device_id:o,request_id:r.request_id})),e.next=32;break;case 9:if("request"!==r.action){e.next=32;break}if(o!==this._baseApis.deviceId){e.next=12;break}return e.abrupt("return");case 12:if(h.logger.info("received request for secret ("+n+", "+o+", "+r.request_id+")"),this._cryptoCallbacks.onSecretRequested){e.next=15;break}return e.abrupt("return");case 15:return e.next=17,this._cryptoCallbacks.onSecretRequested(n,o,r.request_id,r.name,this._baseApis.checkDeviceTrust(n,o));case 17:if(!(a=e.sent)){e.next=31;break}return h.logger.info("Preparing ".concat(r.name," secret for ").concat(o)),u={type:"m.secret.send",content:{request_id:r.request_id,secret:a}},c={algorithm:v.OLM_ALGORITHM,sender_key:this._baseApis._crypto._olmDevice.deviceCurve25519Key,ciphertext:{}},e.next=24,v.ensureOlmSessionsForDevices(this._baseApis._crypto._olmDevice,this._baseApis,i({},n,[this._baseApis.getStoredDevice(n,o)]));case 24:return e.next=26,v.encryptMessageForDevice(c.ciphertext,this._baseApis.getUserId(),this._baseApis.deviceId,this._baseApis._crypto._olmDevice,n,this._baseApis.getStoredDevice(n,o),u);case 26:l=i({},n,i({},o,c)),h.logger.info("Sending ".concat(r.name," secret for ").concat(o)),this._baseApis.sendToDevice("m.room.encrypted",l),e.next=32;break;case 31:h.logger.info("Request denied for ".concat(r.name," secret for ").concat(o));case 32:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_onSecretReceived",value:function(e){if(e.getSender()===this._baseApis.getUserId()){var t=e.getContent();h.logger.log("got secret share for request",t.request_id);var n=this._requests[t.request_id];if(n){var r=this._baseApis._crypto._deviceList.getDeviceByIdentityKey(v.OLM_ALGORITHM,e.getSenderKey());if(!r)return void h.logger.log("secret share from unknown device with key",e.getSenderKey());if(!n.devices.includes(r.deviceId))return void h.logger.log("unsolicited secret share from device",r.deviceId);h.logger.log("Successfully received secret ".concat(n.name," ")+"from ".concat(r.deviceId)),n.resolve(t.secret)}}}},{key:"_getSecretStorageKey",value:function(){var e=a(s.mark((function e(t,n){var i,o,u,c,l;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._cryptoCallbacks.getSecretStorageKey){e.next=2;break}throw new Error("No getSecretStorageKey callback supplied");case 2:return e.next=4,this._cryptoCallbacks.getSecretStorageKey({keys:t},n);case 4:if(i=e.sent){e.next=7;break}throw new Error("getSecretStorageKey callback returned falsey");case 7:if(!(i.length<2)){e.next=9;break}throw new Error("getSecretStorageKey callback returned invalid data");case 9:if(o=r(i,2),u=o[0],c=o[1],t[u]){e.next=12;break}throw new Error("App returned unknown key from getSecretStorageKey!");case 12:if(t[u].algorithm!==m){e.next=17;break}return l={encrypt:function(){var e=a(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,y.encryptAES)(t,c,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),decrypt:function(){var e=a(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,y.decryptAES)(t,c,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},e.abrupt("return",[u,l]);case 17:throw new Error("Unknown key type: "+t[u].algorithm);case 18:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}],[{key:"_calculateKeyCheck",value:function(){var e=a(s.mark((function e(t,n){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,y.encryptAES)("\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",t,"",n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(p.EventEmitter);t.SecretStorage=_},function(e,t,n){"use strict";(function(e){var r=n(6),i=n(2),o=n(3),s=n(7),a=n(8),u=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.OutgoingRoomKeyRequestManager=t.ROOM_KEY_REQUEST_STATES=void 0;var c=n(1),l=u(n(5)),d={UNSENT:0,SENT:1,CANCELLATION_PENDING:2,CANCELLATION_PENDING_AND_WILL_RESEND:3};t.ROOM_KEY_REQUEST_STATES=d;var f=function(){function t(e,n,r){s(this,t),this._baseApis=e,this._deviceId=n,this._cryptoStore=r,this._sendOutgoingRoomKeyRequestsTimer=null,this._sendOutgoingRoomKeyRequestsRunning=!1,this._clientRunning=!1}return a(t,[{key:"start",value:function(){this._clientRunning=!0}},{key:"stop",value:function(){c.logger.log("stopping OutgoingRoomKeyRequestManager"),this._clientRunning=!1}},{key:"sendQueuedRequests",value:function(){this._startTimer()}},{key:"queueRoomKeyRequest",value:function(){var e=o(i.mark((function e(t,n){var r,o,s,a,u,l=arguments;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.length>2&&void 0!==l[2]&&l[2],e.next=3,this._cryptoStore.getOutgoingRoomKeyRequest(t);case 3:if(o=e.sent){e.next=9;break}return e.next=7,this._cryptoStore.getOrAddOutgoingRoomKeyRequest({requestBody:t,recipients:n,requestId:this._baseApis.makeTxnId(),state:d.UNSENT});case 7:e.next=36;break;case 9:e.t0=o.state,e.next=e.t0===d.CANCELLATION_PENDING_AND_WILL_RESEND||e.t0===d.UNSENT?12:e.t0===d.CANCELLATION_PENDING?13:e.t0===d.SENT?17:35;break;case 12:return e.abrupt("return");case 13:return s=r?d.CANCELLATION_PENDING_AND_WILL_RESEND:d.SENT,e.next=16,this._cryptoStore.updateOutgoingRoomKeyRequest(o.requestId,d.CANCELLATION_PENDING,{state:s,cancellationTxnId:this._baseApis.makeTxnId()});case 16:return e.abrupt("break",36);case 17:if(!r){e.next=34;break}return a=d.CANCELLATION_PENDING_AND_WILL_RESEND,e.next=21,this._cryptoStore.updateOutgoingRoomKeyRequest(o.requestId,d.SENT,{state:a,cancellationTxnId:this._baseApis.makeTxnId(),requestTxnId:this._baseApis.makeTxnId()});case 21:if(u=e.sent){e.next=26;break}return e.next=25,this.queueRoomKeyRequest(t,n,r);case 25:return e.abrupt("return",e.sent);case 26:return e.prev=26,e.next=29,this._sendOutgoingRoomKeyRequestCancellation(u,!0);case 29:e.next=34;break;case 31:e.prev=31,e.t1=e.catch(26),c.logger.error("Error sending room key request cancellation; will retry later.",e.t1);case 34:return e.abrupt("break",36);case 35:throw new Error("unhandled state: "+o.state);case 36:case"end":return e.stop()}}),e,this,[[26,31]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"cancelRoomKeyRequest",value:function(e){var t=this;return this._cryptoStore.getOutgoingRoomKeyRequest(e).then((function(n){if(n)switch(n.state){case d.CANCELLATION_PENDING:case d.CANCELLATION_PENDING_AND_WILL_RESEND:return;case d.UNSENT:return c.logger.log("deleting unnecessary room key request for "+p(e)),t._cryptoStore.deleteOutgoingRoomKeyRequest(n.requestId,d.UNSENT);case d.SENT:return t._cryptoStore.updateOutgoingRoomKeyRequest(n.requestId,d.SENT,{state:d.CANCELLATION_PENDING,cancellationTxnId:t._baseApis.makeTxnId()}).then((function(n){n?t._sendOutgoingRoomKeyRequestCancellation(n).catch((function(e){c.logger.error("Error sending room key request cancellation; will retry later.",e),t._startTimer()})):c.logger.log("Tried to cancel room key request for "+p(e)+" but it was already cancelled in another tab")}));default:throw new Error("unhandled state: "+n.state)}}))}},{key:"getOutgoingSentRoomKeyRequest",value:function(e,t){return this._cryptoStore.getOutgoingRoomKeyRequestsByTarget(e,t,[d.SENT])}},{key:"cancelAndResendAllOutgoingRequests",value:function(){var e=o(i.mark((function e(){var t,n=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._cryptoStore.getAllOutgoingRoomKeyRequestsByState(d.SENT);case 2:return t=e.sent,e.abrupt("return",Promise.all(t.map((function(e){var t=e.requestBody,r=e.recipients;return n.queueRoomKeyRequest(t,r,!0)}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_startTimer",value:function(){var t=this;if(!this._sendOutgoingRoomKeyRequestsTimer){this._sendOutgoingRoomKeyRequestsTimer=e.setTimeout((function(){if(t._sendOutgoingRoomKeyRequestsRunning)throw new Error("RoomKeyRequestSend already in progress!");t._sendOutgoingRoomKeyRequestsRunning=!0,t._sendOutgoingRoomKeyRequests().finally((function(){t._sendOutgoingRoomKeyRequestsRunning=!1})).catch((function(e){c.logger.warn("error in OutgoingRoomKeyRequestManager: ".concat(e))}))}),500)}}},{key:"_sendOutgoingRoomKeyRequests",value:function(){var e=this;return this._clientRunning?this._cryptoStore.getOutgoingRoomKeyRequestByState([d.CANCELLATION_PENDING,d.CANCELLATION_PENDING_AND_WILL_RESEND,d.UNSENT]).then((function(t){if(t){var n;switch(t.state){case d.UNSENT:n=e._sendOutgoingRoomKeyRequest(t);break;case d.CANCELLATION_PENDING:n=e._sendOutgoingRoomKeyRequestCancellation(t);break;case d.CANCELLATION_PENDING_AND_WILL_RESEND:n=e._sendOutgoingRoomKeyRequestCancellation(t,!0)}return n.then((function(){return e._sendOutgoingRoomKeyRequests()})).catch((function(t){c.logger.error("Error sending room key request; will retry later.",t),e._sendOutgoingRoomKeyRequestsTimer=null}))}e._sendOutgoingRoomKeyRequestsTimer=null})):(this._sendOutgoingRoomKeyRequestsTimer=null,Promise.resolve())}},{key:"_sendOutgoingRoomKeyRequest",value:function(e){var t=this;c.logger.log("Requesting keys for ".concat(p(e.requestBody))+" from ".concat(h(e.recipients))+"(id ".concat(e.requestId,")"));var n={action:"request",requesting_device_id:this._deviceId,request_id:e.requestId,body:e.requestBody};return this._sendMessageToDevices(n,e.recipients,e.requestTxnId||e.requestId).then((function(){return t._cryptoStore.updateOutgoingRoomKeyRequest(e.requestId,d.UNSENT,{state:d.SENT})}))}},{key:"_sendOutgoingRoomKeyRequestCancellation",value:function(e,t){var n=this;c.logger.log("Sending cancellation for key request for "+"".concat(p(e.requestBody)," to ")+"".concat(h(e.recipients)," ")+"(cancellation id ".concat(e.cancellationTxnId,")"));var r={action:"request_cancellation",requesting_device_id:this._deviceId,request_id:e.requestId};return this._sendMessageToDevices(r,e.recipients,e.cancellationTxnId).then((function(){return t?n._cryptoStore.updateOutgoingRoomKeyRequest(e.requestId,d.CANCELLATION_PENDING_AND_WILL_RESEND,{state:d.UNSENT}):n._cryptoStore.deleteOutgoingRoomKeyRequest(e.requestId,d.CANCELLATION_PENDING)}))}},{key:"_sendMessageToDevices",value:function(e,t,n){var i,o={},s=r(t);try{for(s.s();!(i=s.n()).done;){var a=i.value;o[a.userId]||(o[a.userId]={}),o[a.userId][a.deviceId]=e}}catch(u){s.e(u)}finally{s.f()}return this._baseApis.sendToDevice("m.room_key_request",o,n)}}]),t}();function p(e){return e.room_id+" / "+e.session_id}function h(e){return"["+l.map(e,(function(e){return"".concat(e.userId,":").concat(e.deviceId)})).join(",")+"]"}t.OutgoingRoomKeyRequestManager=f}).call(this,n(9))},function(e,t,n){"use strict";(function(e){var r=n(10),i=n(2),o=n(3),s=n(7),a=n(8),u=n(13),c=n(14),l=n(6),d=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.SAS=void 0;var f,p=n(53),h=d(n(37)),v=n(30),g=n(1),y="m.key.verification.start",m=["m.key.verification.accept","m.key.verification.key","m.key.verification.mac"],_=(0,v.errorFactory)("m.mismatched_sas","Mismatched short authentication string"),b=(0,v.errorFactory)("m.mismatched_commitment","Mismatched commitment");var k=[["\ud83d\udc36","dog"],["\ud83d\udc31","cat"],["\ud83e\udd81","lion"],["\ud83d\udc0e","horse"],["\ud83e\udd84","unicorn"],["\ud83d\udc37","pig"],["\ud83d\udc18","elephant"],["\ud83d\udc30","rabbit"],["\ud83d\udc3c","panda"],["\ud83d\udc13","rooster"],["\ud83d\udc27","penguin"],["\ud83d\udc22","turtle"],["\ud83d\udc1f","fish"],["\ud83d\udc19","octopus"],["\ud83e\udd8b","butterfly"],["\ud83c\udf37","flower"],["\ud83c\udf33","tree"],["\ud83c\udf35","cactus"],["\ud83c\udf44","mushroom"],["\ud83c\udf0f","globe"],["\ud83c\udf19","moon"],["\u2601\ufe0f","cloud"],["\ud83d\udd25","fire"],["\ud83c\udf4c","banana"],["\ud83c\udf4e","apple"],["\ud83c\udf53","strawberry"],["\ud83c\udf3d","corn"],["\ud83c\udf55","pizza"],["\ud83c\udf82","cake"],["\u2764\ufe0f","heart"],["\ud83d\ude42","smiley"],["\ud83e\udd16","robot"],["\ud83c\udfa9","hat"],["\ud83d\udc53","glasses"],["\ud83d\udd27","spanner"],["\ud83c\udf85","santa"],["\ud83d\udc4d","thumbs up"],["\u2602\ufe0f","umbrella"],["\u231b","hourglass"],["\u23f0","clock"],["\ud83c\udf81","gift"],["\ud83d\udca1","light bulb"],["\ud83d\udcd5","book"],["\u270f\ufe0f","pencil"],["\ud83d\udcce","paperclip"],["\u2702\ufe0f","scissors"],["\ud83d\udd12","lock"],["\ud83d\udd11","key"],["\ud83d\udd28","hammer"],["\u260e\ufe0f","telephone"],["\ud83c\udfc1","flag"],["\ud83d\ude82","train"],["\ud83d\udeb2","bicycle"],["\u2708\ufe0f","aeroplane"],["\ud83d\ude80","rocket"],["\ud83c\udfc6","trophy"],["\u26bd","ball"],["\ud83c\udfb8","guitar"],["\ud83c\udfba","trumpet"],["\ud83d\udd14","bell"],["\u2693\ufe0f","anchor"],["\ud83c\udfa7","headphones"],["\ud83d\udcc1","folder"],["\ud83d\udccc","pin"]];var S={decimal:function(e){return[1e3+(e[0]<<5|e[1]>>3),1e3+((7&e[1])<<10|e[2]<<2|e[3]>>6),1e3+((63&e[3])<<7|e[4]>>1)]},emoji:function(e){return[e[0]>>2,(3&e[0])<<4|e[1]>>4,(15&e[1])<<2|e[2]>>6,63&e[2],e[3]>>2,(3&e[3])<<4|e[4]>>4,(15&e[4])<<2|e[5]>>6].map((function(e){return k[e]}))}};function E(e,t){var n,r={},i=l(t);try{for(i.s();!(n=i.n()).done;){var o=n.value;o in S&&(r[o]=S[o](e))}}catch(s){i.e(s)}finally{i.f()}return r}var w={"hkdf-hmac-sha256":"calculate_mac","hmac-sha256":"calculate_mac_long_kdf"};function x(e,t){return function(){for(var n=e[w[t]],r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];var s=n.apply(e,i);return g.logger.log("SAS calculateMAC:",t,i,s),s}}var I={"curve25519-hkdf-sha256":function(e,t,n){var r="".concat(e._baseApis.getUserId(),"|").concat(e._baseApis.deviceId,"|")+"".concat(e.ourSASPubKey,"|"),i="".concat(e.userId,"|").concat(e.deviceId,"|").concat(e.theirSASPubKey,"|"),o="MATRIX_KEY_VERIFICATION_SAS|"+(e.initiatedByMe?r+i:i+r)+e._channel.transactionId;return t.generate_bytes(o,n)},curve25519:function(e,t,n){var r="".concat(e._baseApis.getUserId()).concat(e._baseApis.deviceId),i="".concat(e.userId).concat(e.deviceId),o="MATRIX_KEY_VERIFICATION_SAS"+(e.initiatedByMe?r+i:i+r)+e._channel.transactionId;return t.generate_bytes(o,n)}},T=["curve25519-hkdf-sha256","curve25519"],R=["sha256"],O=["hkdf-hmac-sha256","hmac-sha256"],C=Object.keys(S),D=new Set(T),P=new Set(R),A=new Set(O),M=new Set(C);function U(e,t){return e instanceof Array?e.filter((function(e){return t.has(e)})):[]}var N=function(t){u(l,t);var n=c(l);function l(){return s(this,l),n.apply(this,arguments)}return a(l,[{key:"_doVerification",value:function(){var t=o(i.mark((function t(){var n;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.Olm.init();case 2:return f=f||new e.Olm.Utility,t.next=5,this._baseApis.downloadKeys([this.userId]);case 5:n=!1;case 6:if(t.prev=6,!this.initiatedByMe){t.next=13;break}return t.next=10,this._doSendVerification();case 10:return t.abrupt("return",t.sent);case 13:return t.next=15,this._doRespondVerification();case 15:return t.abrupt("return",t.sent);case 16:t.next=26;break;case 18:if(t.prev=18,t.t0=t.catch(6),!(t.t0 instanceof p.SwitchStartEventError)){t.next=25;break}this.startEvent=t.t0.startEvent,n=!0,t.next=26;break;case 25:throw t.t0;case 26:if(n){t.next=6;break}case 27:case"end":return t.stop()}}),t,this,[[6,18]])})));return function(){return t.apply(this,arguments)}}()},{key:"canSwitchStartEvent",value:function(e){if(e.getType()!==y)return!1;var t=e.getContent();return t&&t.method===l.NAME&&this._waitingForAccept}},{key:"_sendStart",value:function(){var e=o(i.mark((function e(){var t;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._channel.completeContent(y,{method:l.NAME,from_device:this._baseApis.deviceId,key_agreement_protocols:T,hashes:R,message_authentication_codes:O,short_authentication_string:C}),e.next=3,this._channel.sendCompleted(y,t);case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_doSendVerification",value:function(){var t=o(i.mark((function t(){var n,s,a,u,c,l,d,g,y,m,k,S,w,x=this;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._waitingForAccept=!0,!this.startEvent){t.next=5;break}n=this._channel.completedContentFromEvent(this.startEvent),t.next=8;break;case 5:return t.next=7,this._sendStart();case 7:n=t.sent;case 8:if(this.initiatedByMe){t.next=10;break}throw new p.SwitchStartEventError(this.startEvent);case 10:return t.prev=10,t.next=13,this._waitForEvent("m.key.verification.accept");case 13:s=t.sent;case 14:return t.prev=14,this._waitingForAccept=!1,t.finish(14);case 17:if(a=s.getContent(),u=U(a.short_authentication_string,M),D.has(a.key_agreement_protocol)&&P.has(a.hash)&&A.has(a.message_authentication_code)&&u.length){t.next=21;break}throw(0,v.newUnknownMethodError)();case 21:if("string"===typeof a.commitment){t.next=23;break}throw(0,v.newInvalidMessageError)();case 23:return c=a.key_agreement_protocol,l=a.message_authentication_code,d=a.commitment,g=new e.Olm.SAS,t.prev=27,this.ourSASPubKey=g.get_pubkey(),t.next=31,this._send("m.key.verification.key",{key:this.ourSASPubKey});case 31:return t.next=33,this._waitForEvent("m.key.verification.key");case 33:if(s=t.sent,a=s.getContent(),y=a.key+h.default.stringify(n),f.sha256(y)===d){t.next=38;break}throw b();case 38:return this.theirSASPubKey=a.key,g.set_their_key(a.key),m=I[c](this,g,6),k=new Promise((function(e,t){x.sasEvent={sas:E(m,u),confirm:function(){var n=o(i.mark((function n(){return i.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,x._sendMAC(g,l);case 3:e(),n.next=9;break;case 6:n.prev=6,n.t0=n.catch(0),t(n.t0);case 9:case"end":return n.stop()}}),n,null,[[0,6]])})));return function(){return n.apply(this,arguments)}}(),cancel:function(){return t((0,v.newUserCancelledError)())},mismatch:function(){return t(_())}},x.emit("show_sas",x.sasEvent)})),t.next=44,Promise.all([this._waitForEvent("m.key.verification.mac").then((function(e){return x._expectedEvent="m.key.verification.done",e})),k]);case 44:return S=t.sent,w=r(S,1),s=w[0],a=s.getContent(),t.next=50,this._checkMAC(g,a,l);case 50:return t.prev=50,g.free(),t.finish(50);case 53:case"end":return t.stop()}}),t,this,[[10,,14,17],[27,,50,53]])})));return function(){return t.apply(this,arguments)}}()},{key:"_doRespondVerification",value:function(){var t=o(i.mark((function t(){var n,s,a,u,c,l,d,p,g,y,m,b,k=this;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this._channel.completedContentFromEvent(this.startEvent),s=U(T,new Set(n.key_agreement_protocols))[0],a=U(R,new Set(n.hashes))[0],u=U(O,new Set(n.message_authentication_codes))[0],c=U(n.short_authentication_string,M),void 0!==s&&void 0!==a&&void 0!==u&&c.length){t.next=7;break}throw(0,v.newUnknownMethodError)();case 7:return l=new e.Olm.SAS,t.prev=8,d=l.get_pubkey()+h.default.stringify(n),t.next=12,this._send("m.key.verification.accept",{key_agreement_protocol:s,hash:a,message_authentication_code:u,short_authentication_string:c,commitment:f.sha256(d)});case 12:return t.next=14,this._waitForEvent("m.key.verification.key");case 14:return p=t.sent,n=p.getContent(),this.theirSASPubKey=n.key,l.set_their_key(n.key),this.ourSASPubKey=l.get_pubkey(),t.next=21,this._send("m.key.verification.key",{key:this.ourSASPubKey});case 21:return g=I[s](this,l,6),y=new Promise((function(e,t){k.sasEvent={sas:E(g,c),confirm:function(){var n=o(i.mark((function n(){return i.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,k._sendMAC(l,u);case 3:e(),n.next=9;break;case 6:n.prev=6,n.t0=n.catch(0),t(n.t0);case 9:case"end":return n.stop()}}),n,null,[[0,6]])})));return function(){return n.apply(this,arguments)}}(),cancel:function(){return t((0,v.newUserCancelledError)())},mismatch:function(){return t(_())}},k.emit("show_sas",k.sasEvent)})),t.next=25,Promise.all([this._waitForEvent("m.key.verification.mac").then((function(e){return k._expectedEvent="m.key.verification.done",e})),y]);case 25:return m=t.sent,b=r(m,1),p=b[0],n=p.getContent(),t.next=31,this._checkMAC(l,n,u);case 31:return t.prev=31,l.free(),t.finish(31);case 34:case"end":return t.stop()}}),t,this,[[8,,31,34]])})));return function(){return t.apply(this,arguments)}}()},{key:"_sendMAC",value:function(e,t){var n={},r=[],i="MATRIX_KEY_VERIFICATION_MAC"+this._baseApis.getUserId()+this._baseApis.deviceId+this.userId+this.deviceId+this._channel.transactionId,o="ed25519:".concat(this._baseApis.deviceId);n[o]=x(e,t)(this._baseApis.getDeviceEd25519Key(),i+o),r.push(o);var s=this._baseApis.getCrossSigningId();if(s){var a="ed25519:".concat(s);n[a]=x(e,t)(s,i+a),r.push(a)}var u=x(e,t)(r.sort().join(","),i+"KEY_IDS");return this._send("m.key.verification.mac",{mac:n,keys:u})}},{key:"_checkMAC",value:function(){var e=o(i.mark((function e(t,n,r){var o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o="MATRIX_KEY_VERIFICATION_MAC"+this.userId+this.deviceId+this._baseApis.getUserId()+this._baseApis.deviceId+this._channel.transactionId,n.keys===x(t,r)(Object.keys(n.mac).sort().join(","),o+"KEY_IDS")){e.next=3;break}throw(0,v.newKeyMismatchError)();case 3:return e.next=5,this._verifyKeys(this.userId,n.mac,(function(e,n,i){if(i!==x(t,r)(n.keys[e],o+e))throw(0,v.newKeyMismatchError)()}));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"events",get:function(){return m}}],[{key:"NAME",get:function(){return"m.sas.v1"}}]),l}(p.VerificationBase);t.SAS=N}).call(this,n(9))},function(e,t,n){var r=n(135);e.exports=r("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")},function(e,t,n){"use strict";var r=n(136).Buffer;e.exports=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<e.length;i++){var o=e.charAt(i),s=o.charCodeAt(0);if(255!==t[s])throw new TypeError(o+" is ambiguous");t[s]=i}var a=e.length,u=e.charAt(0),c=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function d(e){if("string"!==typeof e)throw new TypeError("Expected String");if(0===e.length)return r.alloc(0);var n=0;if(" "!==e[n]){for(var i=0,o=0;e[n]===u;)i++,n++;for(var s=(e.length-n)*c+1>>>0,l=new Uint8Array(s);e[n];){var d=t[e.charCodeAt(n)];if(255===d)return;for(var f=0,p=s-1;(0!==d||f<o)&&-1!==p;p--,f++)d+=a*l[p]>>>0,l[p]=d%256>>>0,d=d/256>>>0;if(0!==d)throw new Error("Non-zero carry");o=f,n++}if(" "!==e[n]){for(var h=s-o;h!==s&&0===l[h];)h++;var v=r.allocUnsafe(i+(s-h));v.fill(0,0,i);for(var g=i;h!==s;)v[g++]=l[h++];return v}}}return{encode:function(t){if((Array.isArray(t)||t instanceof Uint8Array)&&(t=r.from(t)),!r.isBuffer(t))throw new TypeError("Expected Buffer");if(0===t.length)return"";for(var n=0,i=0,o=0,s=t.length;o!==s&&0===t[o];)o++,n++;for(var c=(s-o)*l+1>>>0,d=new Uint8Array(c);o!==s;){for(var f=t[o],p=0,h=c-1;(0!==f||p<i)&&-1!==h;h--,p++)f+=256*d[h]>>>0,d[h]=f%a>>>0,f=f/a>>>0;if(0!==f)throw new Error("Non-zero carry");i=p,o++}for(var v=c-i;v!==c&&0===d[v];)v++;for(var g=u.repeat(n);v<c;++v)g+=e.charAt(d[v]);return g},decodeUnsafe:d,decode:function(e){var t=d(e);if(t)return t;throw new Error("Non-base"+a+" character")}}}},function(e,t,n){var r=n(19),i=r.Buffer;function o(e,t){for(var n in e)t[n]=e[n]}function s(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(o(r,t),t.Buffer=s),s.prototype=Object.create(i.prototype),o(i,s),s.from=function(e,t,n){if("number"===typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},s.alloc=function(e,t,n){if("number"!==typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"===typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},s.allocUnsafe=function(e){if("number"!==typeof e)throw new TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!==typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},function(e,t,n){"use strict";var r=n(6),i=n(2),o=n(3),s=n(7),a=n(8);Object.defineProperty(t,"__esModule",{value:!0}),t.InRoomRequests=t.InRoomChannel=void 0;var u=n(54),c=n(1),l="m.room.message",d="m.reference",f="m.relates_to",p=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;s(this,e),this._client=t,this._roomId=n,this.userId=r,this._requestEventId=null}return a(e,[{key:"getTimestamp",value:function(e){return e.getTs()}},{key:"handleEvent",value:function(){var t=o(i.mark((function t(n,r,o){var s,a,u,l,d,f;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!r.hasEventId(n.getId())){t.next=2;break}return t.abrupt("return");case 2:if(s=e.getEventType(n),n.getRoomId()===this._roomId){t.next=5;break}return t.abrupt("return");case 5:if(null===this.userId&&(a=e.getOtherPartyUserId(n,this._client))&&(this.userId=a),u=this._client.getUserId(),l=n.getSender(),null===this.userId){t.next=12;break}if(l===u||l===this.userId){t.next=12;break}return c.logger.log("InRoomChannel: ignoring verification event from "+"non-participating sender ".concat(l)),t.abrupt("return");case 12:return null===this._requestEventId&&(this._requestEventId=e.getTransactionId(n)),d=!!n.getUnsigned().transaction_id,f=n.getSender()===this._client.getUserId(),t.next=17,r.handleEvent(s,n,o,d,f);case 17:return t.abrupt("return",t.sent);case 18:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"completedContentFromEvent",value:function(e){var t=Object.assign({},e.getContent());return t[f]=e.getRelation(),t}},{key:"completeContent",value:function(e,t){return t=Object.assign({},t),e!==u.REQUEST_TYPE&&e!==u.READY_TYPE&&e!==u.START_TYPE||(t.from_device=this._client.getDeviceId()),e===u.REQUEST_TYPE?t={body:this._client.getUserId()+" is requesting to verify your key, but your client does not support in-chat key verification.  You will need to use legacy key verification to verify keys.",msgtype:u.REQUEST_TYPE,to:this.userId,from_device:t.from_device,methods:t.methods}:t[f]={rel_type:d,event_id:this.transactionId},t}},{key:"send",value:function(e,t){var n=this.completeContent(e,t);return this.sendCompleted(e,n)}},{key:"sendCompleted",value:function(){var e=o(i.mark((function e(t,n){var r,o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t,t===u.REQUEST_TYPE&&(r=l),e.next=4,this._client.sendEvent(this._roomId,r,n);case 4:o=e.sent,t===u.REQUEST_TYPE&&(this._requestEventId=o.event_id);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"receiveStartFromOtherDevices",get:function(){return!0}},{key:"roomId",get:function(){return this._roomId}},{key:"transactionId",get:function(){return this._requestEventId}}],[{key:"getOtherPartyUserId",value:function(t,n){if(e.getEventType(t)===u.REQUEST_TYPE){var r=n.getUserId(),i=t.getSender(),o=t.getContent().to;return i===r?o:o===r?i:void 0}}},{key:"canCreateRequest",value:function(e){return e===u.REQUEST_TYPE}},{key:"getTransactionId",value:function(t){if(e.getEventType(t)===u.REQUEST_TYPE)return t.getId();var n=t.getRelation();return n&&n.rel_type===d?n.event_id:void 0}},{key:"validateEvent",value:function(t,n){var r=e.getTransactionId(t);if("string"!==typeof r||0===r.length)return!1;var i=e.getEventType(t),o=t.getContent();if(i===u.REQUEST_TYPE){if(!o||"string"!==typeof o.to||!o.to.length)return c.logger.log("InRoomChannel: validateEvent: no valid to "+(o&&o.to)),!1;if(!e.getOtherPartyUserId(t,n))return c.logger.log("InRoomChannel: validateEvent: "+"not directed to or sent by me: ".concat(t.getSender())+", ".concat(o&&o.to)),!1}return u.VerificationRequest.validateEvent(i,t,n)}},{key:"getEventType",value:function(e){var t=e.getType();if(t===l){var n=e.getContent();if(n)if(n.msgtype===u.REQUEST_TYPE)return u.REQUEST_TYPE}return t&&t!==u.REQUEST_TYPE?t:""}}]),e}();t.InRoomChannel=p;var h=function(){function e(){s(this,e),this._requestsByRoomId=new Map}return a(e,[{key:"getRequest",value:function(e){var t=e.getRoomId(),n=p.getTransactionId(e);return this._getRequestByTxnId(t,n)}},{key:"getRequestByChannel",value:function(e){return this._getRequestByTxnId(e.roomId,e.transactionId)}},{key:"_getRequestByTxnId",value:function(e,t){var n=this._requestsByRoomId.get(e);if(n)return n.get(t)}},{key:"setRequest",value:function(e,t){this._setRequest(e.getRoomId(),p.getTransactionId(e),t)}},{key:"setRequestByChannel",value:function(e,t){this._setRequest(e.roomId,e.transactionId,t)}},{key:"_setRequest",value:function(e,t,n){var r=this._requestsByRoomId.get(e);r||(r=new Map,this._requestsByRoomId.set(e,r)),r.set(t,n)}},{key:"removeRequest",value:function(e){var t=e.getRoomId(),n=this._requestsByRoomId.get(t);n&&(n.delete(p.getTransactionId(e)),0===n.size&&this._requestsByRoomId.delete(t))}},{key:"findRequestInProgress",value:function(e){var t=this._requestsByRoomId.get(e);if(t){var n,i=r(t.values());try{for(i.s();!(n=i.n()).done;){var o=n.value;if(o.pending)return o}}catch(s){i.e(s)}finally{i.f()}}}}]),e}();t.InRoomRequests=h},function(e,t,n){"use strict";var r=n(15),i=n(2),o=n(3),s=n(6),a=n(7),u=n(8);Object.defineProperty(t,"__esModule",{value:!0}),t.ToDeviceRequests=t.ToDeviceChannel=void 0;var c=n(41),l=n(1),d=n(54),f=n(30),p=n(16),h=function(){function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;a(this,e),this._client=t,this.userId=n,this._devices=r,this.transactionId=i,this._deviceId=o}return u(e,[{key:"isToDevices",value:function(e){var t=this;if(e.length===this._devices.length){var n,r=s(e);try{var i=function(){var e=n.value;if(!t._devices.find((function(t){return t.deviceId===e.deviceId})))return{v:!1}};for(r.s();!(n=r.n()).done;){var o=i();if("object"===typeof o)return o.v}}catch(a){r.e(a)}finally{r.f()}return!0}return!1}},{key:"getTimestamp",value:function(e){var t=e.getContent();return t&&t.timestamp}},{key:"handleEvent",value:function(){var e=o(i.mark((function e(t,n,r){var o,s,a,u,c,l,p,h,v=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.getType(),s=t.getContent(),o!==d.REQUEST_TYPE&&o!==d.READY_TYPE&&o!==d.START_TYPE){e.next=9;break}if(this.transactionId||(this.transactionId=s.transaction_id),a=s.from_device,!this._deviceId&&this._devices.includes(a)&&(this._deviceId=a),this._deviceId&&this._deviceId===a){e.next=9;break}return u=this.completeContent((0,f.errorFromEvent)((0,f.newUnexpectedMessageError)())),e.abrupt("return",this._sendToDevices(d.CANCEL_TYPE,u,[a]));case 9:return c=n.phase===d.PHASE_STARTED||n.phase===d.PHASE_READY,e.next=12,n.handleEvent(t.getType(),t,r,!1,!1);case 12:if(l=n.phase===d.PHASE_STARTED||n.phase===d.PHASE_READY,!(o===d.START_TYPE||o===d.READY_TYPE)||c||!l||!this._deviceId){e.next=20;break}if(!(p=this._devices.filter((function(e){return e!==v._deviceId}))).length){e.next=20;break}return h=this.completeContent({code:"m.accepted",reason:"Verification request accepted by another device"}),e.next=20,this._sendToDevices(d.CANCEL_TYPE,h,p);case 20:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"completedContentFromEvent",value:function(e){return e.getContent()}},{key:"completeContent",value:function(e,t){return t=Object.assign({},t),this.transactionId&&(t.transaction_id=this.transactionId),e!==d.REQUEST_TYPE&&e!==d.READY_TYPE&&e!==d.START_TYPE||(t.from_device=this._client.getDeviceId()),e===d.REQUEST_TYPE&&(t.timestamp=Date.now()),t}},{key:"send",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t!==d.REQUEST_TYPE&&t!==d.START_TYPE||this.transactionId||(this.transactionId=e.makeTransactionId());var r=this.completeContent(t,n);return this.sendCompleted(t,r)}},{key:"sendCompleted",value:function(){var e=o(i.mark((function e(t,n){var r,o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==d.REQUEST_TYPE){e.next=6;break}return e.next=3,this._sendToDevices(t,n,this._devices);case 3:r=e.sent,e.next=9;break;case 6:return e.next=8,this._sendToDevices(t,n,[this._deviceId]);case 8:r=e.sent;case 9:return o=new p.MatrixEvent({sender:this._client.getUserId(),content:n,type:t}),e.next=12,this._request.handleEvent(t,o,!0,!0,!0);case 12:return e.abrupt("return",r);case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_sendToDevices",value:function(e,t,n){if(n.length){var i,o={},a=s(n);try{for(a.s();!(i=a.n()).done;){o[i.value]=t}}catch(u){a.e(u)}finally{a.f()}return this._client.sendToDevice(e,r({},this.userId,o))}return Promise.resolve()}},{key:"deviceId",get:function(){return this._deviceId}}],[{key:"getEventType",value:function(e){return e.getType()}},{key:"getTransactionId",value:function(e){var t=e.getContent();return t&&t.transaction_id}},{key:"canCreateRequest",value:function(e){return e===d.REQUEST_TYPE||e===d.START_TYPE}},{key:"validateEvent",value:function(e,t){if(e.isCancelled())return l.logger.warn("Ignoring flagged verification request from "+e.getSender()),!1;var n=e.getContent();if(!n)return l.logger.warn("ToDeviceChannel.validateEvent: invalid: no content"),!1;if(!n.transaction_id)return l.logger.warn("ToDeviceChannel.validateEvent: invalid: no transaction_id"),!1;var r=e.getType();if(r===d.REQUEST_TYPE){if(!Number.isFinite(n.timestamp))return l.logger.warn("ToDeviceChannel.validateEvent: invalid: no timestamp"),!1;if(e.getSender()===t.getUserId()&&n.from_device==t.getDeviceId())return l.logger.warn("ToDeviceChannel.validateEvent: invalid: from own device"),!1}return d.VerificationRequest.validateEvent(r,e,t)}},{key:"makeTransactionId",value:function(){return(0,c.randomString)(32)}}]),e}();t.ToDeviceChannel=h;var v=function(){function e(){a(this,e),this._requestsByUserId=new Map}return u(e,[{key:"getRequest",value:function(e){return this.getRequestBySenderAndTxnId(e.getSender(),h.getTransactionId(e))}},{key:"getRequestByChannel",value:function(e){return this.getRequestBySenderAndTxnId(e.userId,e.transactionId)}},{key:"getRequestBySenderAndTxnId",value:function(e,t){var n=this._requestsByUserId.get(e);if(n)return n.get(t)}},{key:"setRequest",value:function(e,t){this.setRequestBySenderAndTxnId(e.getSender(),h.getTransactionId(e),t)}},{key:"setRequestByChannel",value:function(e,t){this.setRequestBySenderAndTxnId(e.userId,e.transactionId,t)}},{key:"setRequestBySenderAndTxnId",value:function(e,t,n){var r=this._requestsByUserId.get(e);r||(r=new Map,this._requestsByUserId.set(e,r)),r.set(t,n)}},{key:"removeRequest",value:function(e){var t=e.getSender(),n=this._requestsByUserId.get(t);n&&(n.delete(h.getTransactionId(e)),0===n.size&&this._requestsByUserId.delete(t))}},{key:"findRequestInProgress",value:function(e,t){var n=this._requestsByUserId.get(e);if(n){var r,i=s(n.values());try{for(i.s();!(r=i.n()).done;){var o=r.value;if(o.pending&&o.channel.isToDevices(t))return o}}catch(a){i.e(a)}finally{i.f()}}}},{key:"getRequestsInProgress",value:function(e){var t=this._requestsByUserId.get(e);return t?Array.from(t.values()).filter((function(e){return e.pending})):[]}}]),e}();t.ToDeviceRequests=v},function(e,t,n){"use strict";var r=n(32),i=n(2),o=n(3),s=n(7),a=n(8),u=n(13),c=n(14);Object.defineProperty(t,"__esModule",{value:!0}),t.IllegalMethod=void 0;var l=function(e){u(n,e);var t=c(n);function n(){return s(this,n),t.apply(this,arguments)}return a(n,[{key:"_doVerification",value:function(){var e=o(i.mark((function e(){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Verification is not possible with this method");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}],[{key:"factory",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return r(n,t)}},{key:"NAME",get:function(){return"org.matrix.illegal_method"}}]),n}(n(53).VerificationBase);t.IllegalMethod=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TimelineWindow=o,t.TimelineIndex=s;var r=n(27),i=(n(1),function(){});function o(e,t,n){n=n||{},this._client=e,this._timelineSet=t,this._start=null,this._end=null,this._eventCount=0,this._windowLimit=n.windowLimit||1e3}function s(e,t){this.timeline=e,this.index=t}o.prototype.load=function(e,t){var n=this;t=t||20;var r=function(r){var i,o=r.getEvents();if(e){for(var a=0;a<o.length;a++)if(o[a].getId()==e){i=a;break}if(void 0===i)throw new Error("getEventTimeline result didn't include requested event")}else i=o.length;var u=Math.min(o.length,i+Math.ceil(t/2)),c=Math.max(0,u-t);n._start=new s(r,c-r.getBaseIndex()),n._end=new s(r,u-r.getBaseIndex()),n._eventCount=u-c};if(e){var i=this._timelineSet.getTimelineForEvent(e);return i?(r(i),Promise.resolve(i)):this._client.getEventTimeline(this._timelineSet,e).then(r)}return r(this._timelineSet.getLiveTimeline()),Promise.resolve()},o.prototype.getTimelineIndex=function(e){if(e==r.EventTimeline.BACKWARDS)return this._start;if(e==r.EventTimeline.FORWARDS)return this._end;throw new Error("Invalid direction '"+e+"'")},o.prototype.extend=function(e,t){var n=this.getTimelineIndex(e);if(!n)return i("TimelineWindow: no timeline yet"),!1;var o=e==r.EventTimeline.BACKWARDS?n.retreat(t):n.advance(t);if(o){this._eventCount+=o,i("TimelineWindow: increased cap by "+o+" (now "+this._eventCount+")");var s=this._eventCount-this._windowLimit;return s>0&&this.unpaginate(s,e!=r.EventTimeline.BACKWARDS),!0}return!1},o.prototype.canPaginate=function(e){var t=this.getTimelineIndex(e);if(!t)return i("TimelineWindow: no timeline yet"),!1;if(e==r.EventTimeline.BACKWARDS){if(t.index>t.minIndex())return!0}else if(t.index<t.maxIndex())return!0;return Boolean(t.timeline.getNeighbouringTimeline(e)||t.timeline.getPaginationToken(e))},o.prototype.paginate=function(e,t,n,o){void 0===n&&(n=!0),void 0===o&&(o=5);var s=this.getTimelineIndex(e);if(!s)return i("TimelineWindow: no timeline yet"),Promise.resolve(!1);if(s.pendingPaginate)return s.pendingPaginate;if(this.extend(e,t))return Promise.resolve(!0);if(!n||0===o)return Promise.resolve(!1);if(!s.timeline.getPaginationToken(e))return i("TimelineWindow: no token"),Promise.resolve(!1);i("TimelineWindow: starting request");var a=this,u=this._client.paginateEventTimeline(s.timeline,{backwards:e==r.EventTimeline.BACKWARDS,limit:t}).finally((function(){s.pendingPaginate=null})).then((function(n){return i("TimelineWindow: request completed with result "+n),!!n&&a.paginate(e,t,!0,o-1)}));return s.pendingPaginate=u,u},o.prototype.unpaginate=function(e,t){var n=t?this._start:this._end;if(e>this._eventCount||e<0)throw new Error("Attemting to unpaginate "+e+" events, but only have "+this._eventCount+" in the timeline");for(;e>0;){var r=t?n.advance(e):n.retreat(e);if(r<=0)throw new Error("Unable to unpaginate any further, but still have "+this._eventCount+" events");e-=r,this._eventCount-=r,i("TimelineWindow.unpaginate: dropped "+r+" (now "+this._eventCount+")")}},o.prototype.getEvents=function(){if(!this._start)return[];for(var e=[],t=this._start.timeline;;){var n=t.getEvents(),i=0,o=n.length;t===this._start.timeline&&(i=this._start.index+t.getBaseIndex()),t===this._end.timeline&&(o=this._end.index+t.getBaseIndex());for(var s=i;s<o;s++)e.push(n[s]);if(t===this._end.timeline)break;t=t.getNeighbouringTimeline(r.EventTimeline.FORWARDS)}return e},s.prototype.minIndex=function(){return-1*this.timeline.getBaseIndex()},s.prototype.maxIndex=function(){return this.timeline.getEvents().length-this.timeline.getBaseIndex()},s.prototype.advance=function(e){if(!e)return 0;var t;if(e<0){if((t=Math.max(e,this.minIndex()-this.index))<0)return this.index+=t,t}else if((t=Math.min(e,this.maxIndex()-this.index))>0)return this.index+=t,t;var n=this.timeline.getNeighbouringTimeline(e<0?r.EventTimeline.BACKWARDS:r.EventTimeline.FORWARDS);return n?(this.timeline=n,this.index=e<0?this.maxIndex():this.minIndex(),i("paginate: switched to new neighbour"),this.advance(e)):0},s.prototype.retreat=function(e){return-1*this.advance(-1*e)}},function(e,t,n){"use strict";var r=n(6),i=n(2),o=n(3),s=n(4),a=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.InteractiveAuth=p;var u=a(n(46)),c=s(n(5)),l=n(1),d="m.login.email.identity",f="m.login.msisdn";function p(e){this._matrixClient=e.matrixClient,this._data=e.authData||{},this._requestCallback=e.doRequest,this._busyChangedCallback=e.busyChanged,this._stateUpdatedCallback=e.stateUpdated||e.startAuthStage,this._resolveFunc=null,this._rejectFunc=null,this._inputs=e.inputs||{},this._requestEmailTokenCallback=e.requestEmailToken,e.sessionId&&(this._data.session=e.sessionId),this._clientSecret=e.clientSecret||this._matrixClient.generateClientSecret(),this._emailSid=e.emailSid,void 0===this._emailSid&&(this._emailSid=null),this._requestingEmailToken=!1,this._chosenFlow=null,this._currentStage=null,this._submitPromise=null}p.prototype={attemptAuth:function(){var e=this;return new Promise((function(t,n){if(e._resolveFunc=t,e._rejectFunc=n,e._data&&e._data.flows)e._startNextAuthStage();else{e._busyChangedCallback&&e._busyChangedCallback(!0);var r=null;e._data.session&&(r={session:e._data.session}),e._doRequest(r).finally((function(){e._busyChangedCallback&&e._busyChangedCallback(!1)}))}}))},poll:function(){var e=o(i.mark((function e(){var t,n,r;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._data.session){e.next=2;break}return e.abrupt("return");case 2:if(this._resolveFunc){e.next=4;break}return e.abrupt("return");case 4:if(!this._submitPromise){e.next=6;break}return e.abrupt("return");case 6:if(t={},this._currentStage!=d){e.next=16;break}if(!this._emailSid){e.next=16;break}return n={sid:this._emailSid,client_secret:this._clientSecret},e.next=12,this._matrixClient.doesServerRequireIdServerParam();case 12:if(!e.sent){e.next=15;break}r=u.default.parse(this._matrixClient.getIdentityServerUrl()),n.id_server=r.host;case 15:t={type:d,threepid_creds:n,threepidCreds:n};case 16:this.submitAuthDict(t,!0);case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),getSessionId:function(){return this._data?this._data.session:void 0},getClientSecret:function(){return this._clientSecret},getStageParams:function(e){var t={};return this._data&&this._data.params&&(t=this._data.params),t[e]},getChosenFlow:function(){return this._chosenFlow},submitAuthDict:function(){var e=o(i.mark((function e(t,n){var r;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._resolveFunc){e.next=2;break}throw new Error("submitAuthDict() called before attemptAuth()");case 2:!n&&this._busyChangedCallback&&this._busyChangedCallback(!0);case 3:if(!this._submitPromise){e.next=13;break}return e.prev=4,e.next=7,this._submitPromise;case 7:e.next=11;break;case 9:e.prev=9,e.t0=e.catch(4);case 11:e.next=3;break;case 13:return this._data.session?(r={session:this._data.session},c.extend(r,t)):r=t,e.prev=14,this._submitPromise=this._doRequest(r,n),e.next=18,this._submitPromise;case 18:return e.prev=18,this._submitPromise=null,!n&&this._busyChangedCallback&&this._busyChangedCallback(!1),e.finish(18);case 22:case"end":return e.stop()}}),e,this,[[4,9],[14,,18,22]])})));return function(t,n){return e.apply(this,arguments)}}(),getEmailSid:function(){return this._emailSid},setEmailSid:function(e){this._emailSid=e},_doRequest:function(){var e=o(i.mark((function e(t,n){var r,o,s,a;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._requestCallback(t,n);case 3:r=e.sent,this._resolveFunc(r),this._resolveFunc=null,this._rejectFunc=null,e.next=34;break;case 9:e.prev=9,e.t0=e.catch(0),o=e.t0.data?e.t0.data.flows:null,s=this._data.flows||Boolean(o),401===e.t0.httpStatus&&e.t0.data&&s||(n?l.logger.log("Background poll request failed doing UI auth: ignoring",e.t0):this._rejectFunc(e.t0)),e.t0.data.flows||e.t0.data.completed||e.t0.data.session||(e.t0.data.flows=this._data.flows,e.t0.data.completed=this._data.completed,e.t0.data.session=this._data.session),this._data=e.t0.data;try{this._startNextAuthStage()}catch(i){this._rejectFunc(i),this._resolveFunc=null,this._rejectFunc=null}if(this._emailSid||this._requestingEmailToken||!this._chosenFlow.stages.includes("m.login.email.identity")){e.next=34;break}return this._requestingEmailToken=!0,e.prev=19,e.next=22,this._requestEmailTokenCallback(this._inputs.emailAddress,this._clientSecret,1,this._data.session);case 22:a=e.sent,this._emailSid=a.sid,e.next=31;break;case 26:e.prev=26,e.t1=e.catch(19),this._rejectFunc(e.t1),this._resolveFunc=null,this._rejectFunc=null;case 31:return e.prev=31,this._requestingEmailToken=!1,e.finish(31);case 34:case"end":return e.stop()}}),e,this,[[0,9],[19,26,31,34]])})));return function(t,n){return e.apply(this,arguments)}}(),_startNextAuthStage:function(){var e=this._chooseStage();if(!e)throw new Error("No incomplete flows from the server");if(this._currentStage=e,"m.login.dummy"!==e)if(this._data&&this._data.errcode||this._data.error)this._stateUpdatedCallback(e,{errcode:this._data.errcode||"",error:this._data.error||""});else{var t={};e==d&&(t.emailSid=this._emailSid),this._stateUpdatedCallback(e,t)}else this.submitAuthDict({type:"m.login.dummy"})},_chooseStage:function(){null===this._chosenFlow&&(this._chosenFlow=this._chooseFlow()),l.logger.log("Active flow => %s",JSON.stringify(this._chosenFlow));var e=this._firstUncompletedStage(this._chosenFlow);return l.logger.log("Next stage: %s",e),e},_chooseFlow:function(){var e,t=this._data.flows||[],n=Boolean(this._inputs.emailAddress)||Boolean(this._emailSid),i=Boolean(this._inputs.phoneCountry)&&Boolean(this._inputs.phoneNumber),o=r(t);try{for(o.s();!(e=o.n()).done;){var s,a=e.value,u=!1,c=!1,l=r(a.stages);try{for(l.s();!(s=l.n()).done;){var p=s.value;p===d?u=!0:p==f&&(c=!0)}}catch(h){l.e(h)}finally{l.f()}if(u==n&&c==i)return a}}catch(h){o.e(h)}finally{o.f()}var h=new Error("No appropriate authentication flow found");throw h.name="NoAuthFlowFoundError",h.required_stages=[],n&&h.required_stages.push(d),i&&h.required_stages.push(f),h.available_flows=t,h},_firstUncompletedStage:function(e){for(var t=(this._data||{}).completed||[],n=0;n<e.stages.length;++n){var r=e.stages[n];if(-1===t.indexOf(r))return r}}}},function(e,t,n){"use strict";(function(e){var r=n(2),i=n(3),o=n(6),s=n(10),a=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedDBStore=g;var u=n(60),c=a(n(5)),l=n(11),d=n(143),f=n(144),p=n(28),h=n(16),v=n(1);function g(t){if(u.MemoryStore.call(this,t),!t.indexedDB)throw new Error("Missing required option: indexedDB");if(t.workerScript){var n=t.workerApi;n||(n=e.Worker),this.backend=new f.RemoteIndexedDBStoreBackend(t.workerScript,t.dbName,n)}else this.backend=new d.LocalIndexedDBStoreBackend(t.indexedDB,t.dbName);this.startedUp=!1,this._syncTs=0,this._userModifiedMap={}}function y(e,t){return i(r.mark((function n(){var i,o,s,a,c=arguments;return r.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:for(i=c.length,o=new Array(i),s=0;s<i;s++)o[s]=c[s];return n.prev=1,n.next=4,e.call.apply(e,[this].concat(o));case 4:return n.abrupt("return",n.sent);case 7:return n.prev=7,n.t0=n.catch(1),v.logger.error("IndexedDBStore failure, degrading to MemoryStore",n.t0),this.emit("degraded",n.t0),n.prev=11,v.logger.log("IndexedDBStore trying to delete degraded data"),n.next=15,this.backend.clearDatabase();case 15:v.logger.log("IndexedDBStore delete after degrading succeeeded"),n.next=21;break;case 18:n.prev=18,n.t1=n.catch(11),v.logger.warn("IndexedDBStore delete after degrading failed",n.t1);case 21:if(Object.setPrototypeOf(this,u.MemoryStore.prototype),!t){n.next=26;break}return n.next=25,(a=u.MemoryStore.prototype[t]).call.apply(a,[this].concat(o));case 25:return n.abrupt("return",n.sent);case 26:case"end":return n.stop()}}),n,this,[[1,7],[11,18]])})))}c.inherits(g,u.MemoryStore),c.extend(g.prototype,l.EventEmitter.prototype),g.exists=function(e,t){return d.LocalIndexedDBStoreBackend.exists(e,t)},g.prototype.startup=function(){var e=this;return this.startedUp?(v.logger.log("IndexedDBStore.startup: already started"),Promise.resolve()):(v.logger.log("IndexedDBStore.startup: connecting to backend"),this.backend.connect().then((function(){return v.logger.log("IndexedDBStore.startup: loading presence events"),e.backend.getUserPresenceEvents()})).then((function(t){v.logger.log("IndexedDBStore.startup: processing presence events"),t.forEach((function(t){var n=s(t,2),r=n[0],i=n[1],o=new p.User(r);i&&o.setPresenceEvent(new h.MatrixEvent(i)),e._userModifiedMap[o.userId]=o.getLastModifiedTime(),e.storeUser(o)}))})))},g.prototype.getSavedSync=y((function(){return this.backend.getSavedSync()}),"getSavedSync"),g.prototype.isNewlyCreated=y((function(){return this.backend.isNewlyCreated()}),"isNewlyCreated"),g.prototype.getSavedSyncToken=y((function(){return this.backend.getNextBatchToken()}),"getSavedSyncToken"),g.prototype.deleteAllData=y((function(){return u.MemoryStore.prototype.deleteAllData.call(this),this.backend.clearDatabase().then((function(){v.logger.log("Deleted indexeddb data.")}),(function(e){throw v.logger.error("Failed to delete indexeddb data: ".concat(e)),e}))})),g.prototype.wantsSave=function(){return Date.now()-this._syncTs>3e5},g.prototype.save=function(e){return e||this.wantsSave()?this._reallySave():Promise.resolve()},g.prototype._reallySave=y((function(){this._syncTs=Date.now();var e,t=[],n=o(this.getUsers());try{for(n.s();!(e=n.n()).done;){var r=e.value;this._userModifiedMap[r.userId]!==r.getLastModifiedTime()&&(r.events.presence&&(t.push([r.userId,r.events.presence.event]),this._userModifiedMap[r.userId]=r.getLastModifiedTime()))}}catch(i){n.e(i)}finally{n.f()}return this.backend.syncToDatabase(t)})),g.prototype.setSyncData=y((function(e){return this.backend.setSyncData(e)}),"setSyncData"),g.prototype.getOutOfBandMembers=y((function(e){return this.backend.getOutOfBandMembers(e)}),"getOutOfBandMembers"),g.prototype.setOutOfBandMembers=y((function(e,t){return u.MemoryStore.prototype.setOutOfBandMembers.call(this,e,t),this.backend.setOutOfBandMembers(e,t)}),"setOutOfBandMembers"),g.prototype.clearOutOfBandMembers=y((function(e){return u.MemoryStore.prototype.clearOutOfBandMembers.call(this),this.backend.clearOutOfBandMembers(e)}),"clearOutOfBandMembers"),g.prototype.getClientOptions=y((function(){return this.backend.getClientOptions()}),"getClientOptions"),g.prototype.storeClientOptions=y((function(e){return u.MemoryStore.prototype.storeClientOptions.call(this,e),this.backend.storeClientOptions(e)}),"storeClientOptions")}).call(this,n(9))},function(e,t,n){"use strict";var r=n(6),i=n(2),o=n(3),s=n(10),a=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.LocalIndexedDBStoreBackend=y;var u=n(77),c=a(n(5)),l=a(n(69)),d=n(1);function f(e,t,n){var r=e.openCursor(t);return new Promise((function(e,t){var i=[];r.onerror=function(e){t(new Error("Query failed: "+e.target.errorCode))},r.onsuccess=function(t){var r=t.target.result;r?(i.push(n(r)),r.continue()):e(i)}}))}function p(e){return new Promise((function(t,n){e.oncomplete=function(e){t(e)},e.onerror=function(e){n(e.target.error)}}))}function h(e){return new Promise((function(t,n){e.onsuccess=function(e){t(e)},e.onerror=function(e){n(e.target.error)}}))}function v(e){return new Promise((function(t,n){e.onsuccess=function(){return t(e)},e.onerror=function(e){return n(e)}}))}function g(e){return h(e).then((function(e){return e.target.result}))}function y(e,t){this.indexedDB=e,this._dbName="matrix-js-sdk:"+(t||"default"),this.db=null,this._disconnected=!0,this._syncAccumulator=new u.SyncAccumulator,this._isNewlyCreated=!1}y.exists=function(e,t){return t="matrix-js-sdk:"+(t||"default"),l.exists(e,t)},y.prototype={connect:function(){var e=this;if(!this._disconnected)return d.logger.log("LocalIndexedDBStoreBackend.connect: already connected or connecting"),Promise.resolve();this._disconnected=!1,d.logger.log("LocalIndexedDBStoreBackend.connect: connecting...");var t=this.indexedDB.open(this._dbName,3);return t.onupgradeneeded=function(t){var n=t.target.result,r=t.oldVersion;d.logger.log("LocalIndexedDBStoreBackend.connect: upgrading from ".concat(r)),r<1&&(e._isNewlyCreated=!0,function(e){e.createObjectStore("users",{keyPath:["userId"]}),e.createObjectStore("accountData",{keyPath:["type"]}),e.createObjectStore("sync",{keyPath:["clobber"]})}(n)),r<2&&function(e){e.createObjectStore("oob_membership_events",{keyPath:["room_id","state_key"]}).createIndex("room","room_id")}(n),r<3&&function(e){e.createObjectStore("client_options",{keyPath:["clobber"]})}(n)},t.onblocked=function(){d.logger.log("can't yet open LocalIndexedDBStoreBackend because it is open elsewhere")},d.logger.log("LocalIndexedDBStoreBackend.connect: awaiting connection..."),h(t).then((function(t){return d.logger.log("LocalIndexedDBStoreBackend.connect: connected"),e.db=t.target.result,e.db.onversionchange=function(){e.db.close()},e._init()}))},isNewlyCreated:function(){return Promise.resolve(this._isNewlyCreated)},_init:function(){var e=this;return Promise.all([this._loadAccountData(),this._loadSyncData()]).then((function(t){var n=s(t,2),r=n[0],i=n[1];d.logger.log("LocalIndexedDBStoreBackend: loaded initial data"),e._syncAccumulator.accumulate({next_batch:i.nextBatch,rooms:i.roomsData,groups:i.groupsData,account_data:{events:r}},!0)}))},getOutOfBandMembers:function(e){var t=this;return new Promise((function(n,r){var i=t.db.transaction(["oob_membership_events"],"readonly").objectStore("oob_membership_events").index("room"),o=IDBKeyRange.only(e),s=i.openCursor(o),a=[],u=!1;s.onsuccess=function(e){var t=e.target.result;if(!t)return a.length||u?n(a):n(null);var r=t.value;r.oob_written?u=!0:a.push(r),t.continue()},s.onerror=function(e){r(e)}})).then((function(t){return d.logger.log("LL: got ".concat(t&&t.length)+" membershipEvents from storage for room ".concat(e," ...")),t}))},setOutOfBandMembers:function(){var e=o(i.mark((function e(t,n){var r,o,s;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.logger.log("LL: backend about to store ".concat(n.length)+" members for ".concat(t)),r=this.db.transaction(["oob_membership_events"],"readwrite"),o=r.objectStore("oob_membership_events"),n.forEach((function(e){o.put(e)})),s={room_id:t,oob_written:!0,state_key:0},o.put(s),e.next=8,p(r);case 8:d.logger.log("LL: backend done storing for ".concat(t,"!"));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),clearOutOfBandMembers:function(){var e=o(i.mark((function e(t){var n,r,o,a,u,c,l,f,p,h,y,m,_;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.db.transaction(["oob_membership_events"],"readonly"),r=n.objectStore("oob_membership_events"),o=r.index("room"),a=IDBKeyRange.only(t),u=g(o.openKeyCursor(a,"next")).then((function(e){return e&&e.primaryKey[1]})),c=g(o.openKeyCursor(a,"prev")).then((function(e){return e&&e.primaryKey[1]})),e.next=8,Promise.all([u,c]);case 8:return l=e.sent,f=s(l,2),p=f[0],h=f[1],y=this.db.transaction(["oob_membership_events"],"readwrite"),m=y.objectStore("oob_membership_events"),_=IDBKeyRange.bound([t,p],[t,h]),d.logger.log("LL: Deleting all users + marker in storage for "+"room ".concat(t,", with key range:"),[t,p],[t,h]),e.next=18,v(m.delete(_));case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),clearDatabase:function(){var e=this;return new Promise((function(t,n){d.logger.log("Removing indexeddb instance: ".concat(e._dbName));var r=e.indexedDB.deleteDatabase(e._dbName);r.onblocked=function(){d.logger.log("can't yet delete indexeddb ".concat(e._dbName)+" because it is open elsewhere")},r.onerror=function(e){d.logger.warn("unable to delete js-sdk store indexeddb: ".concat(e.target.error)),t()},r.onsuccess=function(){d.logger.log("Removed indexeddb instance: ".concat(e._dbName)),t()}}))},getSavedSync:function(e){void 0===e&&(e=!0);var t=this._syncAccumulator.getJSON();return t.nextBatch?e?Promise.resolve(c.deepCopy(t)):Promise.resolve(t):Promise.resolve(null)},getNextBatchToken:function(){return Promise.resolve(this._syncAccumulator.getNextBatchToken())},setSyncData:function(e){var t=this;return Promise.resolve().then((function(){t._syncAccumulator.accumulate(e)}))},syncToDatabase:function(e){var t=this._syncAccumulator.getJSON(!0);return Promise.all([this._persistUserPresenceEvents(e),this._persistAccountData(t.accountData),this._persistSyncData(t.nextBatch,t.roomsData,t.groupsData)])},_persistSyncData:function(e,t,n){var r=this;return d.logger.log("Persisting sync data up to ",e),c.promiseTry((function(){var i=r.db.transaction(["sync"],"readwrite");return i.objectStore("sync").put({clobber:"-",nextBatch:e,roomsData:t,groupsData:n}),p(i)}))},_persistAccountData:function(e){var t=this;return c.promiseTry((function(){for(var n=t.db.transaction(["accountData"],"readwrite"),r=n.objectStore("accountData"),i=0;i<e.length;i++)r.put(e[i]);return p(n)}))},_persistUserPresenceEvents:function(e){var t=this;return c.promiseTry((function(){var n,i=t.db.transaction(["users"],"readwrite"),o=i.objectStore("users"),s=r(e);try{for(s.s();!(n=s.n()).done;){var a=n.value;o.put({userId:a[0],event:a[1]})}}catch(u){s.e(u)}finally{s.f()}return p(i)}))},getUserPresenceEvents:function(){var e=this;return c.promiseTry((function(){return f(e.db.transaction(["users"],"readonly").objectStore("users"),void 0,(function(e){return[e.value.userId,e.value.event]}))}))},_loadAccountData:function(){var e=this;return d.logger.log("LocalIndexedDBStoreBackend: loading account data..."),c.promiseTry((function(){return f(e.db.transaction(["accountData"],"readonly").objectStore("accountData"),void 0,(function(e){return e.value})).then((function(e){return d.logger.log("LocalIndexedDBStoreBackend: loaded account data"),e}))}))},_loadSyncData:function(){var e=this;return d.logger.log("LocalIndexedDBStoreBackend: loading sync data..."),c.promiseTry((function(){return f(e.db.transaction(["sync"],"readonly").objectStore("sync"),void 0,(function(e){return e.value})).then((function(e){return d.logger.log("LocalIndexedDBStoreBackend: loaded sync data"),e.length>1&&d.logger.warn("loadSyncData: More than 1 sync row found."),e.length>0?e[0]:{}}))}))},getClientOptions:function(){var e=this;return Promise.resolve().then((function(){return f(e.db.transaction(["client_options"],"readonly").objectStore("client_options"),void 0,(function(e){if(e.value&&e.value&&e.value.options)return e.value.options})).then((function(e){return e[0]}))}))},storeClientOptions:function(){var e=o(i.mark((function e(t){var n;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.db.transaction(["client_options"],"readwrite"),n.objectStore("client_options").put({clobber:"-",options:t}),e.next=5,p(n);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteIndexedDBStoreBackend=o;var r=n(1),i=n(5);function o(e,t,n){this._workerScript=e,this._dbName=t,this._workerApi=n,this._worker=null,this._nextSeq=0,this._inFlight={},this._startPromise=null}o.prototype={connect:function(){var e=this;return this._ensureStarted().then((function(){return e._doCmd("connect")}))},clearDatabase:function(){var e=this;return this._ensureStarted().then((function(){return e._doCmd("clearDatabase")}))},isNewlyCreated:function(){return this._doCmd("isNewlyCreated")},getSavedSync:function(){return this._doCmd("getSavedSync")},getNextBatchToken:function(){return this._doCmd("getNextBatchToken")},setSyncData:function(e){return this._doCmd("setSyncData",[e])},syncToDatabase:function(e){return this._doCmd("syncToDatabase",[e])},getOutOfBandMembers:function(e){return this._doCmd("getOutOfBandMembers",[e])},setOutOfBandMembers:function(e,t){return this._doCmd("setOutOfBandMembers",[e,t])},clearOutOfBandMembers:function(e){return this._doCmd("clearOutOfBandMembers",[e])},getClientOptions:function(){return this._doCmd("getClientOptions")},storeClientOptions:function(e){return this._doCmd("storeClientOptions",[e])},getUserPresenceEvents:function(){return this._doCmd("getUserPresenceEvents")},_ensureStarted:function(){return null===this._startPromise&&(this._worker=new this._workerApi(this._workerScript),this._worker.onmessage=this._onWorkerMessage.bind(this),this._startPromise=this._doCmd("_setupWorker",[this._dbName]).then((function(){r.logger.log("IndexedDB worker is ready")}))),this._startPromise},_doCmd:function(e,t){var n=this;return Promise.resolve().then((function(){var r=n._nextSeq++,o=(0,i.defer)();return n._inFlight[r]=o,n._worker.postMessage({command:e,seq:r,args:t}),o.promise}))},_onWorkerMessage:function(e){var t=e.data;if("cmd_success"==t.command||"cmd_fail"==t.command){if(void 0===t.seq)return void r.logger.error("Got reply from worker with no seq");var n=this._inFlight[t.seq];if(void 0===n)return void r.logger.error("Got reply for unknown seq "+t.seq);if(delete this._inFlight[t.seq],"cmd_success"==t.command)n.resolve(t.result);else{var i=new Error(t.error.message);i.name=t.error.name,n.reject(i)}}else r.logger.warn("Unrecognised message from worker: "+t)}}},function(e,t,n){"use strict";var r=n(6),i=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.WebStorageSessionStore=a;var o=i(n(5)),s=(n(1),"session.e2e.");function a(e){if(this.store=e,!o.isFunction(e.getItem)||!o.isFunction(e.setItem)||!o.isFunction(e.removeItem)||!o.isFunction(e.key)||"number"!==typeof e.length)throw new Error("Supplied webStore does not meet the WebStorage API interface")}a.prototype={removeEndToEndAccount:function(){this.store.removeItem(u)},getEndToEndAccount:function(){return this.store.getItem(u)},getAllEndToEndDevices:function(){for(var e=f(""),t={},n=0;n<this.store.length;++n){var r=this.store.key(n),i=r.substr(e.length);r.startsWith(e)&&(t[i]=v(this.store,r))}return t},getEndToEndDeviceTrackingStatus:function(){return v(this.store,l)},getEndToEndDeviceSyncToken:function(){return v(this.store,c)},removeEndToEndDeviceData:function(){y(this.store,f("")),y(this.store,l),y(this.store,c)},getEndToEndSessions:function(e){return v(this.store,p(e))},getAllEndToEndSessions:function(){var e,t=g(this.store,p("")),n={},i=r(t);try{for(i.s();!(e=i.n()).done;){var o=e.value;n[o.substr(p("").length)]=v(this.store,o)}}catch(s){i.e(s)}finally{i.f()}return n},removeAllEndToEndSessions:function(){y(this.store,p(""))},getAllEndToEndInboundGroupSessionKeys:function(){for(var e=s+"inboundgroupsessions/",t=[],n=0;n<this.store.length;n++){var r=this.store.key(n);r.startsWith(e)&&t.push({senderKey:r.substr(e.length,43),sessionId:r.substr(e.length+44)})}return t},getEndToEndInboundGroupSession:function(e,t){var n=function(e,t){return s+"inboundgroupsessions/"+e+"/"+t}(e,t);return this.store.getItem(n)},removeAllEndToEndInboundGroupSessions:function(){y(this.store,s+"inboundgroupsessions/")},getAllEndToEndRooms:function(){var e,t=g(this.store,h("")),n={},i=r(t);try{for(i.s();!(e=i.n()).done;){var o=e.value;n[o.substr(h("").length)]=v(this.store,o)}}catch(s){i.e(s)}finally{i.f()}return n},removeAllEndToEndRooms:function(){y(this.store,h(""))},setLocalTrustedBackupPubKey:function(e){this.store.setItem(d,e)},getLocalTrustedBackupPubKey:function(){return this.store.getItem(d)}};var u=s+"account",c=s+"device_sync_token",l=s+"device_tracking",d=s+"trusted_backup_pubkey";function f(e){return s+"devices/"+e}function p(e){return s+"sessions/"+e}function h(e){return s+"rooms/"+e}function v(e,t){try{return JSON.parse(e.getItem(t))}catch(n){m("Failed to get key %s: %s",t,n),m(n.stack)}return null}function g(e,t){for(var n=[],r=0;r<e.length;++r){var i=e.key(r);i.startsWith(t)&&n.push(i)}return n}function y(e,t){for(var n=[],r=0;r<e.length;++r){var i=e.key(r);i.startsWith(t)&&n.push(i)}for(var o=0,s=n;o<s.length;o++){var a=s[o];e.removeItem(a)}}function m(){}},function(e,t,n){var r,i,o;i=[],void 0===(o="function"===typeof(r=function(){var e=XMLHttpRequest;if(!e)throw new Error("missing XMLHttpRequest");n.log={trace:o,debug:o,info:o,warn:o,error:o};var t=18e4;function n(e,t){if("function"!==typeof t)throw new Error("Bad callback given: "+t);if(!e)throw new Error("No options given");var r=e.onResponse;if((e="string"===typeof e?{uri:e}:JSON.parse(JSON.stringify(e))).onResponse=r,e.verbose&&(n.log=s()),e.url&&(e.uri=e.url,delete e.url),!e.uri&&""!==e.uri)throw new Error("options.uri is a required argument");if("string"!=typeof e.uri)throw new Error("options.uri must be a string");for(var a=["proxy","_redirectsFollowed","maxRedirects","followRedirect"],u=0;u<a.length;u++)if(e[a[u]])throw new Error("options."+a[u]+" is not supported");if(e.callback=t,e.method=e.method||"GET",e.headers=e.headers||{},e.body=e.body||null,e.timeout=e.timeout||n.DEFAULT_TIMEOUT,e.headers.host)throw new Error("Options.headers.host is not supported");e.json&&(e.headers.accept=e.headers.accept||"application/json","GET"!==e.method&&(e.headers["content-type"]="application/json"),"boolean"!==typeof e.json?e.body=JSON.stringify(e.json):"string"!==typeof e.body&&(e.body=JSON.stringify(e.body)));var l=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")};if(e.qs){var d="string"==typeof e.qs?e.qs:l(e.qs);-1!==e.uri.indexOf("?")?e.uri=e.uri+"&"+d:e.uri=e.uri+"?"+d}var f=function(e){var t={};t.boundry="-------------------------------"+Math.floor(1e9*Math.random());var n=[];for(var r in e)e.hasOwnProperty(r)&&n.push("--"+t.boundry+'\nContent-Disposition: form-data; name="'+r+'"\n\n'+e[r]+"\n");return n.push("--"+t.boundry+"--"),t.body=n.join(""),t.length=t.body.length,t.type="multipart/form-data; boundary="+t.boundry,t};if(e.form){if("string"==typeof e.form)throw"form name unsupported";if("POST"===e.method){var p=(e.encoding||"application/x-www-form-urlencoded").toLowerCase();switch(e.headers["content-type"]=p,p){case"application/x-www-form-urlencoded":e.body=l(e.form).replace(/%20/g,"+");break;case"multipart/form-data":var h=f(e.form);e.body=h.body,e.headers["content-type"]=h.type;break;default:throw new Error("unsupported encoding:"+p)}}}return e.onResponse=e.onResponse||o,!0===e.onResponse&&(e.onResponse=t,e.callback=o),!e.headers.authorization&&e.auth&&(e.headers.authorization="Basic "+c(e.auth.username+":"+e.auth.password)),i(e)}var r=0;function i(t){var i=new e,o=!1,s=u(t.uri),a="withCredentials"in i;if(r+=1,i.seq_id=r,i.id=r+": "+t.method+" "+t.uri,i._id=i.id,s&&!a){var c=new Error("Browser does not support cross-origin request: "+t.uri);return c.cors="unsupported",t.callback(c,i)}function l(){o=!0;var e=new Error("ETIMEDOUT");return e.code="ETIMEDOUT",e.duration=t.timeout,n.log.error("Timeout",{id:i._id,milliseconds:t.timeout}),t.callback(e,i)}i.timeoutTimer=setTimeout(l,t.timeout);var d={response:!1,loading:!1,end:!1};return i.onreadystatechange=f,i.open(t.method,t.uri,!0),s&&(i.withCredentials=!!t.withCredentials),i.send(t.body),i;function f(r){if(o)return n.log.debug("Ignoring timed out state change",{state:i.readyState,id:i.id});if(n.log.debug("State change",{state:i.readyState,id:i.id,timed_out:o}),i.readyState===e.OPENED)for(var s in n.log.debug("Request started",{id:i.id}),t.headers)i.setRequestHeader(s,t.headers[s]);else i.readyState===e.HEADERS_RECEIVED?p():i.readyState===e.LOADING?(p(),h()):i.readyState===e.DONE&&(p(),h(),v())}function p(){if(!d.response){if(d.response=!0,n.log.debug("Got response",{id:i.id,status:i.status}),clearTimeout(i.timeoutTimer),i.statusCode=i.status,s&&0==i.statusCode){var e=new Error("CORS request rejected: "+t.uri);return e.cors="rejected",d.loading=!0,d.end=!0,t.callback(e,i)}t.onResponse(null,i)}}function h(){d.loading||(d.loading=!0,n.log.debug("Response body loading",{id:i.id}))}function v(){if(!d.end){if(d.end=!0,n.log.debug("Request done",{id:i.id}),i.body=i.responseText,t.json)try{i.body=JSON.parse(i.responseText)}catch(e){return t.callback(e,i)}t.callback(null,i,i.body)}}}function o(){}function s(){var e,t,n={},r=["trace","debug","info","warn","error"];for(t=0;t<r.length;t++)n[e=r[t]]=o,"undefined"!==typeof console&&console&&console[e]&&(n[e]=a(console,e));return n}function a(e,t){return n;function n(n,r){return"object"===typeof r&&(n+=" "+JSON.stringify(r)),e[t].call(e,n)}}function u(e){var t,n=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;try{t=location.href}catch(o){(t=document.createElement("a")).href="",t=t.href}var r=n.exec(t.toLowerCase())||[],i=n.exec(e.toLowerCase());return!(!i||i[1]==r[1]&&i[2]==r[2]&&(i[3]||("http:"===i[1]?80:443))==(r[3]||("http:"===r[1]?80:443)))}function c(e){var t,n,r,i,o,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a=0,u=0,c="",l=[];if(!e)return e;do{t=(o=e.charCodeAt(a++)<<16|e.charCodeAt(a++)<<8|e.charCodeAt(a++))>>18&63,n=o>>12&63,r=o>>6&63,i=63&o,l[u++]=s.charAt(t)+s.charAt(n)+s.charAt(r)+s.charAt(i)}while(a<e.length);switch(c=l.join(""),e.length%3){case 1:c=c.slice(0,-2)+"==";break;case 2:c=c.slice(0,-1)+"="}return c}return n.withCredentials=!1,n.DEFAULT_TIMEOUT=t,n.defaults=function(e,t){var r=function(t){return function(n,r){for(var i in n="string"===typeof n?{uri:n}:JSON.parse(JSON.stringify(n)),e)void 0===n[i]&&(n[i]=e[i]);return t(n,r)}},i=r(n);return i.get=r(n.get),i.post=r(n.post),i.put=r(n.put),i.head=r(n.head),i},["get","put","post","head"].forEach((function(e){var t=e.toUpperCase();n[e.toLowerCase()]=function(e){"string"===typeof e?e={method:t,uri:e}:(e=JSON.parse(JSON.stringify(e))).method=t;var r=[e].concat(Array.prototype.slice.apply(arguments,[1]));return n.apply(this,r)}})),n.couch=function(e,t){return"string"===typeof e&&(e={uri:e}),e.json=!0,e.body&&(e.json=e.body),delete e.body,t=t||o,n(e,r);function r(e,n,r){if(e)return t(e,n,r);if((n.statusCode<200||n.statusCode>299)&&r.error){for(var i in e=new Error("CouchDB error: "+(r.error.reason||r.error.error)),r)e[i]=r[i];return t(e,n,r)}return t(e,n,r)}},n})?r.apply(t,i):r)||(e.exports=o)},function(e,t,n){"use strict";var r=n(148),i=n(149),o=n(78);e.exports={formats:o,parse:i,stringify:r}},function(e,t,n){"use strict";var r=n(55),i=n(78),o=Object.prototype.hasOwnProperty,s={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},a=Array.isArray,u=Array.prototype.push,c=function(e,t){u.apply(e,a(t)?t:[t])},l=Date.prototype.toISOString,d=i.default,f={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:r.encode,encodeValuesOnly:!1,format:d,formatter:i.formatters[d],indices:!1,serializeDate:function(e){return l.call(e)},skipNulls:!1,strictNullHandling:!1},p=function e(t,n,i,o,s,u,l,d,p,h,v,g,y){var m,_=t;if("function"===typeof l?_=l(n,_):_ instanceof Date?_=h(_):"comma"===i&&a(_)&&(_=r.maybeMap(_,(function(e){return e instanceof Date?h(e):e})).join(",")),null===_){if(o)return u&&!g?u(n,f.encoder,y,"key"):n;_=""}if("string"===typeof(m=_)||"number"===typeof m||"boolean"===typeof m||"symbol"===typeof m||"bigint"===typeof m||r.isBuffer(_))return u?[v(g?n:u(n,f.encoder,y,"key"))+"="+v(u(_,f.encoder,y,"value"))]:[v(n)+"="+v(String(_))];var b,k=[];if("undefined"===typeof _)return k;if(a(l))b=l;else{var S=Object.keys(_);b=d?S.sort(d):S}for(var E=0;E<b.length;++E){var w=b[E],x=_[w];if(!s||null!==x){var I=a(_)?"function"===typeof i?i(n,w):n:n+(p?"."+w:"["+w+"]");c(k,e(x,I,i,o,s,u,l,d,p,h,v,g,y))}}return k};e.exports=function(e,t){var n,r=e,u=function(e){if(!e)return f;if(null!==e.encoder&&void 0!==e.encoder&&"function"!==typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||f.charset;if("undefined"!==typeof e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=i.default;if("undefined"!==typeof e.format){if(!o.call(i.formatters,e.format))throw new TypeError("Unknown format option provided.");n=e.format}var r=i.formatters[n],s=f.filter;return("function"===typeof e.filter||a(e.filter))&&(s=e.filter),{addQueryPrefix:"boolean"===typeof e.addQueryPrefix?e.addQueryPrefix:f.addQueryPrefix,allowDots:"undefined"===typeof e.allowDots?f.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"===typeof e.charsetSentinel?e.charsetSentinel:f.charsetSentinel,delimiter:"undefined"===typeof e.delimiter?f.delimiter:e.delimiter,encode:"boolean"===typeof e.encode?e.encode:f.encode,encoder:"function"===typeof e.encoder?e.encoder:f.encoder,encodeValuesOnly:"boolean"===typeof e.encodeValuesOnly?e.encodeValuesOnly:f.encodeValuesOnly,filter:s,formatter:r,serializeDate:"function"===typeof e.serializeDate?e.serializeDate:f.serializeDate,skipNulls:"boolean"===typeof e.skipNulls?e.skipNulls:f.skipNulls,sort:"function"===typeof e.sort?e.sort:null,strictNullHandling:"boolean"===typeof e.strictNullHandling?e.strictNullHandling:f.strictNullHandling}}(t);"function"===typeof u.filter?r=(0,u.filter)("",r):a(u.filter)&&(n=u.filter);var l,d=[];if("object"!==typeof r||null===r)return"";l=t&&t.arrayFormat in s?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var h=s[l];n||(n=Object.keys(r)),u.sort&&n.sort(u.sort);for(var v=0;v<n.length;++v){var g=n[v];u.skipNulls&&null===r[g]||c(d,p(r[g],g,h,u.strictNullHandling,u.skipNulls,u.encode?u.encoder:null,u.filter,u.sort,u.allowDots,u.serializeDate,u.formatter,u.encodeValuesOnly,u.charset))}var y=d.join(u.delimiter),m=!0===u.addQueryPrefix?"?":"";return u.charsetSentinel&&("iso-8859-1"===u.charset?m+="utf8=%26%2310003%3B&":m+="utf8=%E2%9C%93&"),y.length>0?m+y:""}},function(e,t,n){"use strict";var r=n(55),i=Object.prototype.hasOwnProperty,o=Array.isArray,s={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:r.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},a=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},u=function(e,t){return e&&"string"===typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},c=function(e,t,n,r){if(e){var o=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,s=/(\[[^[\]]*])/g,a=n.depth>0&&/(\[[^[\]]*])/.exec(o),c=a?o.slice(0,a.index):o,l=[];if(c){if(!n.plainObjects&&i.call(Object.prototype,c)&&!n.allowPrototypes)return;l.push(c)}for(var d=0;n.depth>0&&null!==(a=s.exec(o))&&d<n.depth;){if(d+=1,!n.plainObjects&&i.call(Object.prototype,a[1].slice(1,-1))&&!n.allowPrototypes)return;l.push(a[1])}return a&&l.push("["+o.slice(a.index)+"]"),function(e,t,n,r){for(var i=r?t:u(t,n),o=e.length-1;o>=0;--o){var s,a=e[o];if("[]"===a&&n.parseArrays)s=[].concat(i);else{s=n.plainObjects?Object.create(null):{};var c="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,l=parseInt(c,10);n.parseArrays||""!==c?!isNaN(l)&&a!==c&&String(l)===c&&l>=0&&n.parseArrays&&l<=n.arrayLimit?(s=[])[l]=i:s[c]=i:s={0:i}}i=s}return i}(l,t,n,r)}};e.exports=function(e,t){var n=function(e){if(!e)return s;if(null!==e.decoder&&void 0!==e.decoder&&"function"!==typeof e.decoder)throw new TypeError("Decoder has to be a function.");if("undefined"!==typeof e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t="undefined"===typeof e.charset?s.charset:e.charset;return{allowDots:"undefined"===typeof e.allowDots?s.allowDots:!!e.allowDots,allowPrototypes:"boolean"===typeof e.allowPrototypes?e.allowPrototypes:s.allowPrototypes,arrayLimit:"number"===typeof e.arrayLimit?e.arrayLimit:s.arrayLimit,charset:t,charsetSentinel:"boolean"===typeof e.charsetSentinel?e.charsetSentinel:s.charsetSentinel,comma:"boolean"===typeof e.comma?e.comma:s.comma,decoder:"function"===typeof e.decoder?e.decoder:s.decoder,delimiter:"string"===typeof e.delimiter||r.isRegExp(e.delimiter)?e.delimiter:s.delimiter,depth:"number"===typeof e.depth||!1===e.depth?+e.depth:s.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"===typeof e.interpretNumericEntities?e.interpretNumericEntities:s.interpretNumericEntities,parameterLimit:"number"===typeof e.parameterLimit?e.parameterLimit:s.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"===typeof e.plainObjects?e.plainObjects:s.plainObjects,strictNullHandling:"boolean"===typeof e.strictNullHandling?e.strictNullHandling:s.strictNullHandling}}(t);if(""===e||null===e||"undefined"===typeof e)return n.plainObjects?Object.create(null):{};for(var l="string"===typeof e?function(e,t){var n,c={},l=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,d=t.parameterLimit===1/0?void 0:t.parameterLimit,f=l.split(t.delimiter,d),p=-1,h=t.charset;if(t.charsetSentinel)for(n=0;n<f.length;++n)0===f[n].indexOf("utf8=")&&("utf8=%E2%9C%93"===f[n]?h="utf-8":"utf8=%26%2310003%3B"===f[n]&&(h="iso-8859-1"),p=n,n=f.length);for(n=0;n<f.length;++n)if(n!==p){var v,g,y=f[n],m=y.indexOf("]="),_=-1===m?y.indexOf("="):m+1;-1===_?(v=t.decoder(y,s.decoder,h,"key"),g=t.strictNullHandling?null:""):(v=t.decoder(y.slice(0,_),s.decoder,h,"key"),g=r.maybeMap(u(y.slice(_+1),t),(function(e){return t.decoder(e,s.decoder,h,"value")}))),g&&t.interpretNumericEntities&&"iso-8859-1"===h&&(g=a(g)),y.indexOf("[]=")>-1&&(g=o(g)?[g]:g),i.call(c,v)?c[v]=r.combine(c[v],g):c[v]=g}return c}(e,n):e,d=n.plainObjects?Object.create(null):{},f=Object.keys(l),p=0;p<f.length;++p){var h=f[p],v=c(h,l[h],n,"string"===typeof e);d=r.merge(d,v,n)}return r.compact(d)}}]]);
//# sourceMappingURL=2.a1223741.chunk.js.map