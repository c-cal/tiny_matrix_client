(this.webpackJsonptiny_matrix_client=this.webpackJsonptiny_matrix_client||[]).push([[0],{149:function(e,t,a){e.exports=a(292)},154:function(e,t,a){},291:function(e,t,a){},292:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(147),o=a.n(s),c=(a(154),a(68)),i=a(32),l=a(33),u=a(35),m=a(34),p=a(36),d=a(148),h=a.n(d);a(291);function f(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function g(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?f(a,!0).forEach((function(t){Object(c.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):f(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var v=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).setupClient=function(e){a.setState({client:e}),e.startClient(),e.once("sync",(function(e,t,n){console.log(e),a.setState({isClientReady:!0})}))},a.state={client:null,isClientReady:!1},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"container"},r.a.createElement(C,null),this.state.isClientReady?r.a.createElement(E,{client:this.state.client}):r.a.createElement(b,{setupClient:this.setupClient}))}}]),t}(n.Component),b=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).handleChange=function(e){return a.setState(Object(c.a)({},e.target.id,e.target.value))},a.handleSubmit=function(e){var t=h.a.createClient(a.state.server);t.login("m.login.password",{user:a.state.username,password:a.state.password}).then((function(e){return a.props.setupClient(t)})).catch((function(e){return alert(e.message)})),e.preventDefault()},a.state={server:"https://matrix.org",username:"",password:""},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"col-sm-5 mx-auto"},r.a.createElement("form",{onSubmit:this.handleSubmit},r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"input-group flex-nowrap"},r.a.createElement("div",{className:"input-group-prepend"},r.a.createElement("span",{className:"input-group-text"},r.a.createElement("i",{className:"fas fa-at fa-fw"}))),r.a.createElement("input",{className:"form-control",id:"server",type:"url",autoComplete:"url",placeholder:"Server URL",value:this.state.server,onChange:this.handleChange,required:!0}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"input-group flex-nowrap"},r.a.createElement("div",{className:"input-group-prepend"},r.a.createElement("span",{className:"input-group-text"},r.a.createElement("i",{className:"fas fa-user fa-fw"}))),r.a.createElement("input",{className:"form-control",id:"username",type:"text",autoComplete:"username",placeholder:"Username",value:this.state.username,onChange:this.handleChange,required:!0}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"input-group flex-nowrap"},r.a.createElement("div",{className:"input-group-prepend"},r.a.createElement("span",{className:"input-group-text"},r.a.createElement("i",{className:"fas fa-key fa-fw"}))),r.a.createElement("input",{className:"form-control",id:"password",type:"password",autoComplete:"current-password",placeholder:"Password",value:this.state.password,onChange:this.handleChange,required:!0}))),r.a.createElement("input",{className:"btn btn-outline-primary btn-block",type:"submit",value:"Log in"})))}}]),t}(n.Component),E=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).setCurrentRoomId=function(e){a.setState({currentRoomId:e})},a.sendMessage=function(e){var t=a.state.currentRoomId;if(null!==t){var n={body:e,msgtype:"m.text"};a.props.client.sendEvent(t,"m.room.message",n,"").then((function(e){console.log("message sent successfully")})).catch((function(e){console.log(e)}))}},a.state={messages:{},currentRoomId:null},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.client.on("Room.timeline",(function(t,a,n){if("m.room.message"===t.getType()){var r=e.state.messages,s=a.roomId in r?r[a.roomId]:[];s.push({eventId:t.getId(),date:t.getDate().toLocaleString(),body:t.getContent().body,senderName:t.sender.name}),e.setState((function(e){return{messages:g({},e.messages,Object(c.a)({},a.roomId,s))}}))}}))}},{key:"render",value:function(){var e=this.state,t=e.currentRoomId,a=e.messages,n=t in a?a[t]:[];return r.a.createElement("div",{className:"chat"},r.a.createElement(y,{client:this.props.client,setCurrentRoomId:this.setCurrentRoomId}),r.a.createElement(O,{messages:n}),r.a.createElement(j,{sendMessage:this.sendMessage}))}}]),t}(n.Component),y=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).handleChange=function(e){var t=e.target.value;a.setState({selectedRoom:t}),a.props.setCurrentRoomId(t)},a.state={rooms:[],selectedRoomId:void 0},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.client.getRooms();this.setState({rooms:e})}},{key:"listRooms",value:function(){return this.state.rooms.map((function(e){return r.a.createElement("option",{key:e.roomId,value:e.roomId},e.name)}))}},{key:"render",value:function(){var e=this.listRooms();return r.a.createElement("div",{className:"input-group flex-nowrap mb-3"},r.a.createElement("div",{className:"input-group-prepend"},r.a.createElement("span",{className:"input-group-text"},"Current room")),r.a.createElement("select",{className:"custom-select",value:this.state.selectedRoomId,onChange:this.handleChange},e))}}]),t}(n.Component),O=function(e){function t(){return Object(i.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"listMessages",value:function(){return this.props.messages.map((function(e){return r.a.createElement("li",{className:"message",key:e.eventId},r.a.createElement("div",null,e.senderName," - ",e.date),r.a.createElement("div",null,e.body))}))}},{key:"render",value:function(){var e=this.listMessages();return r.a.createElement("ul",{className:"message-list"},e)}}]),t}(n.Component),j=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).handleChange=function(e){a.setState({message:e.target.value})},a.handleSubmit=function(e){a.props.sendMessage(a.state.message),a.setState({message:""}),e.preventDefault()},a.state={message:""},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement("form",{onSubmit:this.handleSubmit},r.a.createElement("div",{className:"input-group flex-nowrap"},r.a.createElement("input",{className:"form-control",type:"text",placeholder:"Type your message",value:this.state.message,onChange:this.handleChange}),r.a.createElement("div",{className:"input-group-append"},r.a.createElement("button",{className:"btn btn-outline-secondary",type:"submit"},r.a.createElement("i",{className:"fas fa-comment-dots"})))))}}]),t}(n.Component);function C(){return r.a.createElement("header",{className:"text-center mb-3"},r.a.createElement("h1",null,"Tiny ",r.a.createElement("a",{href:"https://matrix.org/"},r.a.createElement("img",{src:"https://matrix.org/images/matrix-logo.svg",alt:""}))," client"))}var N=v;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(N,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[149,1,2]]]);
//# sourceMappingURL=main.f6a08015.chunk.js.map